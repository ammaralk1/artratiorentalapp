RewriteEngine On

# Remove www and always redirect to HTTPS
RewriteCond %{HTTP_HOST} ^www\.art-ratio\.com$ [NC]
RewriteRule ^ https://art-ratio.com%{REQUEST_URI} [L,R=301]

# Force HTTPS for the bare domain
RewriteCond %{HTTP_HOST} ^art-ratio\.com$ [NC]
RewriteCond %{HTTPS} off
RewriteRule ^ https://art-ratio.com%{REQUEST_URI} [L,R=301]

# Catch-all HTTPS redirect (covers any other host variations)
RewriteCond %{HTTPS} !=on
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
Header always set X-Content-Type-Options "nosniff"
Header always set X-Frame-Options "SAMEORIGIN"

# Serve the canonical CSP from the web server so that frame-ancestors is enforced.
# Keep any fallback <meta http-equiv="Content-Security-Policy"> definitions aligned,
# but omit frame-ancestors there to avoid browser warnings.
<IfModule mod_headers.c>
  Header always set Content-Security-Policy "default-src 'self' blob:; script-src 'self' https://cdn.jsdelivr.net https://img1.wsimg.com 'sha256-94H6wmHzcbPXq0z+knAQNqjjdZFteAhu/+clJVBM808='; connect-src 'self' https://art-ratio.com https://*.art-ratio.com https://cdn.jsdelivr.net https://img1.wsimg.com https://csp.secureserver.net; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://fonts.googleapis.com; img-src 'self' data: blob: https://art-ratio.com https://*.art-ratio.com https://cdn.jsdelivr.net https://img1.wsimg.com https://*.sirv.com; font-src 'self' https://fonts.gstatic.com data:; object-src 'none'; base-uri 'self'; form-action 'self'; frame-ancestors 'self'; frame-src 'self'; worker-src 'self' blob:; upgrade-insecure-requests;"
</IfModule>
