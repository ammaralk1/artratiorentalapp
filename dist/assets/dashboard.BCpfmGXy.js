const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./reports.CFlWeUhA.js","./uiBridge.BLZZT8b9.js","./calculations.QotUySi5.js","./reservationsService.BVFzAFJb.js","./auth.CP5w673l.js","./auth.CpB-XPAW.css","./state.8QT2vnmV.js","./maintenanceService.BBDSN8Y9.js","./canvasColorUtils.CviLtv6S.js","./reservationsUI.C0J3iDLb.js","./controller.-x1aeNLE.js","./details.DJ7jDfu0.js","./equipment.7fUfsgtk.js","./reservationPdf.ByND10uz.js","./view.BhtMOu_G.js","./quotePdf.kDBbUcue.js","./reservationsActions.CGM14Hel.js","./projectsService.r7Dg857l.js","./calendar.2xV-mSYC.js","./maintenance.B_nes0tq.js","./dashboardMetrics.TgL7SY5d.js"])))=>i.map(i=>d[i]);
import{u as j,e as K,f as Ae,s as we,d as Y,b as Q,h as Be,t as y,n as _,j as A,a as Le,c as Pe,i as Re,l as Fe}from"./auth.CP5w673l.js";import"./dashboard.657mLCh9.js";import{_ as E,g as xe,w as De}from"./uiBridge.BLZZT8b9.js";import{r as Ce}from"./customers.8KKdHmmL.js";import{r as ge,E as ue,a as Ne,c as Me,i as je,u as $e}from"./equipment.7fUfsgtk.js";import{a as Oe,n as ye,b as Ve}from"./state.8QT2vnmV.js";import{i as Ue}from"./dashboardShell.DF2kUed9.js";const He={},te="__ART_RATIO_LAST_DASHBOARD_TAB__",w="__ART_RATIO_LAST_DASHBOARD_SUB_TAB__",W="create-tab",oe=/^[a-z0-9\-]+$/i,ze=typeof import.meta<"u"&&He&&!1;function h(...e){ze&&console.log(...e)}function ne(e){if(!(!e||typeof e.scrollIntoView!="function"))try{const t=e.closest("[data-tab-scroll-track]");if(!t)return;const n={behavior:"smooth",block:"nearest",inline:"center"};e.scrollIntoView(n);const s=t.closest("[data-tab-scroll]");s&&window.requestAnimationFrame(()=>{s.dispatchEvent(new CustomEvent("tabScroll:update",{bubbles:!0}))})}catch(t){console.warn("âš ï¸ [tabs.js] Failed to keep tab visible",t)}}function F(e){try{if(typeof window>"u"||!window.localStorage)return null;const t=window.localStorage.getItem(e);return!t||!oe.test(t)?null:t}catch(t){return console.warn("âš ï¸ [tabs.js] Failed to read stored tab",t),null}}function ae(e,t){try{if(typeof window>"u"||!window.localStorage)return;if(!t||!oe.test(t)){window.localStorage.removeItem(e);return}window.localStorage.setItem(e,t)}catch(n){console.warn("âš ï¸ [tabs.js] Failed to persist tab",n)}}function he(e){try{if(typeof window>"u"||!window.localStorage)return;window.localStorage.removeItem(e)}catch(t){console.warn("âš ï¸ [tabs.js] Failed to clear stored tab",t)}}let R=null,T=null,x=!1,S=null,de=null,D=null,ie=null,C=null,V=null,J=null,X=null,Z=null,le=!1,me=!1;function Ke(){return V||(V=E(()=>import("./reports.CFlWeUhA.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]),import.meta.url).then(e=>{try{typeof e.initReports=="function"&&e.initReports()}catch(t){console.error("âŒ [tabs.js] Failed to initialise reports module",t)}return e}).catch(e=>{throw console.error("âŒ [tabs.js] Failed to load reports module",e),V=null,e})),V}function ve(){return J||(J=E(()=>import("./reservationsUI.C0J3iDLb.js"),__vite__mapDeps([9,10,4,5,11,6,3,12,13,14,15,8,16,17,1]),import.meta.url)),J}function Qe(){return X||(X=E(()=>import("./calendar.2xV-mSYC.js"),__vite__mapDeps([18,6,4,5,16,12,3,11,14]),import.meta.url)),X}function We(){return Z||(Z=E(()=>import("./maintenance.B_nes0tq.js"),__vite__mapDeps([19,4,5,12,6,7]),import.meta.url)),Z}function Ye(){h("ğŸš€ [tabs.js] setupTabs()");const e=Array.from(document.querySelectorAll("[data-tab]")),t=document.querySelectorAll(".tab-content-wrapper > .tab");h("ğŸ“Œ tabButtons:",e),h("ğŸ“Œ tabContents:",t);const n=(a,{skipStore:o=!1,skipRender:l=!1}={})=>{if(!a)return;const p=e.filter(u=>u?.getAttribute("data-tab")===a),b=document.getElementById(a);if(!(!p.length||!b)&&(e.forEach(u=>{const d=u?.getAttribute("data-tab")===a;u.classList.toggle("active",d),d?(u.setAttribute("aria-selected","true"),u.setAttribute("tabindex","0"),ne(u)):(u.setAttribute("aria-selected","false"),u.setAttribute("tabindex","-1"))}),t.forEach(u=>{const d=u.id===a;u.style.display=d?"block":"none",u.classList.toggle("active",d)}),R=a,ae(te,a),typeof document<"u"&&document.dispatchEvent(new CustomEvent("dashboard:tabChanged",{detail:{tabId:a}})),o||j({dashboardTab:a}).catch(u=>{console.warn("âš ï¸ [tabs.js] Failed to store dashboard tab preference",u)}),a!=="reservations-tab"&&(T=null,S=null,he(w),o||j({dashboardSubTab:null}).catch(u=>{console.warn("âš ï¸ [tabs.js] Failed to clear sub-tab preference",u)})),!l&&a==="customers-tab"&&(h("ğŸ‘¤ Rendering customers"),Ce()),!l&&a==="equipment-tab"&&(h("ğŸ“¦ Rendering equipment"),ge()),!l&&a==="maintenance-tab"&&(h("ğŸ› ï¸ Rendering maintenance"),We().then(u=>{try{!le&&typeof u.initMaintenance=="function"?(u.initMaintenance(),le=!0):u.renderMaintenance?.()}catch(d){console.error("âŒ [tabs.js] Failed to initialise/render maintenance",d)}}).catch(u=>console.error("âŒ [tabs.js] Unable to load maintenance module",u))),!l&&a==="technicians-tab"&&(h("ğŸ› ï¸ Rendering technicians"),Oe()),a==="reservations-tab")){if(h("ğŸ“… Rendering reservations"),!l){try{const u=document.getElementById("reservations-tab");if(u&&!u.querySelector("[data-reservations-skeleton]")){const d=document.createElement("div");d.setAttribute("data-reservations-skeleton",""),d.setAttribute("aria-busy","true"),d.style.padding="1rem",d.style.display="grid",d.style.gap="12px";const m='<div class="loading loading-spinner loading-md text-primary" role="status" aria-label="Loading" style="justify-self:center;margin:6px 0;"></div>',f='<div style="height:12px;background:rgba(148,163,184,0.25);border-radius:8px"></div>'.repeat(6);d.innerHTML=m+f,u.prepend(d)}}catch{}ve().then(async u=>{try{u.setupReservationEvents?.()}catch{}try{u.renderReservations?.()}catch{}try{const d=u?.initializeReservationUI;!me&&typeof d=="function"&&(await d(),me=!0)}catch{}try{const m=document.getElementById("reservations-tab")?.querySelector("[data-reservations-skeleton]");m&&m.remove()}catch{}}).catch(u=>console.error("âŒ [tabs.js] Unable to load reservations UI module",u))}if(!S){const u=F(w);S=T||u||W}Ge(),S&&(U(S),S=null)}};ie=n;const s=a=>{if(!a||a.dataset.tabKeyboardBound==="true")return;const o=a.getAttribute("aria-orientation")==="vertical";a.addEventListener("keydown",l=>{const p=l.key,b=Array.from(a.querySelectorAll('[role="tab"], .tab-button, .sub-tab-button')).filter(L=>L.matches("[data-tab], [data-sub-tab]"));if(!b.length)return;const u=l.target,d=Math.max(0,b.indexOf(u));let m=d;const f=()=>{m=(d-1+b.length)%b.length},g=()=>{m=(d+1)%b.length},M=()=>{m=0},G=()=>{m=b.length-1};let k=!1;switch(p){case"ArrowLeft":o||(f(),k=!0);break;case"ArrowRight":o||(g(),k=!0);break;case"ArrowUp":o&&(f(),k=!0);break;case"ArrowDown":o&&(g(),k=!0);break;case"Home":M(),k=!0;break;case"End":G(),k=!0;break;case"Enter":case" ":k=!0,u?.click();break}if(k){l.preventDefault();const L=b[m];L&&L!==u&&(L.focus(),L.click())}}),a.dataset.tabKeyboardBound="true"};document.querySelectorAll('[role="tablist"]').forEach(s),e.forEach(a=>{a&&(a.getAttribute("type")||a.setAttribute("type","button"),a.setAttribute("role","tab"),a.hasAttribute("tabindex")||a.setAttribute("tabindex",a.classList.contains("active")?"0":"-1"),a.addEventListener("click",()=>{const o=a.getAttribute("data-tab");if(h("ğŸ–±ï¸ Tab clicked:",o),n(o),o==="reservations-tab"){const l=T||F(w)||W;typeof D=="function"?D(l):S=l}else j({dashboardSubTab:null}).catch(l=>{console.warn("âš ï¸ [tabs.js] Failed to clear sub-tab preference",l)})}))});const r=a=>{const o=document.querySelector("[data-tab].active"),l=F(te),p=e[0]?.getAttribute("data-tab")||null;let b=null;try{const g=typeof window<"u"&&window.location&&typeof window.location.hash=="string"?window.location.hash.replace(/^#/,""):"";g&&oe.test(g)&&document.getElementById(g)&&(b=g)}catch{}const d=[b,a?.dashboardTab,l,R,o?.getAttribute("data-tab"),p].filter(Boolean).find(g=>document.getElementById(g))||p;d&&(!x||d!==R)&&(h("â­ Initial tab:",d),n(d,{skipStore:!0}));const f=[a?.dashboardSubTab,F(w)].filter(Boolean).find(g=>document.getElementById(g));f&&(R==="reservations-tab"&&typeof D=="function"?(!x||f!==T)&&D(f,{skipStore:!0}):S=f),x||(document.body?.classList.remove("tabs-loading"),document.body?.classList.remove("no-js"),x=!0)},c=typeof K=="function"?K():null;r(c||null),Ae().then(a=>r(a||null)).catch(a=>{console.warn("âš ï¸ [tabs.js] Failed to load tab preferences",a),r(null)}),de||(de=we(a=>{if(!(!x||!a))if(a.dashboardTab&&a.dashboardTab!==R&&n(a.dashboardTab,{skipStore:!0}),R==="reservations-tab"){if(a.dashboardSubTab&&a.dashboardSubTab!==T)U(a.dashboardSubTab);else if(!a.dashboardSubTab&&T){const o=F(w);o?o!==T&&U(o):U(null)}}else a.dashboardSubTab&&(S=a.dashboardSubTab)}))}function Ge(){h("ğŸš€ [tabs.js] setupSubTabs()");const e=document.querySelectorAll("#reservations-tab .sub-tab-button"),t=document.querySelectorAll("#reservations-tab .sub-tab");if(h("ğŸ“Œ subTabButtons:",e),h("ğŸ“Œ subTabContents:",t),!e.length){console.warn("âš ï¸ [tabs.js] No reservation sub-tab buttons found");return}const n=Array.from(e).map(c=>c?.getAttribute("data-sub-tab")).filter(c=>typeof c=="string"&&c.trim().length>0),s=()=>n.length?n.includes(W)?W:n[0]:null,r=(c,{skipStore:a=!1}={})=>{if(!n.length)return;let o=c;(!o||!n.includes(o))&&(console.warn("âš ï¸ [tabs.js] Invalid sub-tab target, falling back to first available",{requested:o,available:n}),o=s());const l=document.querySelector(`#reservations-tab .sub-tab-button[data-sub-tab="${o}"]`),p=document.getElementById(o);if(!l||!p){console.warn("âš ï¸ [tabs.js] Unable to locate sub-tab button/content after fallback",{target:o});return}if(T===o&&l.classList.contains("active")&&p.classList.contains("active")&&p.getAttribute("aria-hidden")==="false"){p.removeAttribute("hidden"),p.style.display="block",p.setAttribute("aria-hidden","false"),T=o,ne(l),a||(ae(w,o),j({dashboardSubTab:o}).catch(u=>{console.warn("âš ï¸ [tabs.js] Failed to store sub-tab preference",u)}));return}e.forEach(u=>{u.classList.remove("active"),u.classList.contains("tab")&&u.classList.remove("tab-active"),u.setAttribute("aria-selected","false"),u.setAttribute("tabindex","-1")}),l.classList.add("active"),l.classList.contains("tab")&&l.classList.add("tab-active"),l.setAttribute("aria-selected","true"),l.setAttribute("tabindex","0"),ne(l),t.forEach(u=>{const d=u.id===o;u.classList.toggle("active",d),u.setAttribute("aria-hidden",d?"false":"true"),d?(u.removeAttribute("hidden"),u.style.display="block"):(u.setAttribute("hidden",""),u.style.display="none")}),T=o,ae(w,o),a||j({dashboardSubTab:o}).catch(u=>{console.warn("âš ï¸ [tabs.js] Failed to store sub-tab preference",u)}),typeof document<"u"&&document.dispatchEvent(new CustomEvent("reservations:subTabChanged",{detail:{subTabId:o}})),o==="my-reservations-tab"?(h("ğŸ“‹ Rendering reservations list"),setTimeout(()=>{ve().then(u=>{try{u.renderReservations?.()}catch(d){console.error("âŒ [tabs.js] Failed to render reservations list",d)}}).catch(u=>console.error("âŒ [tabs.js] Unable to load reservations UI module",u))},50)):o==="calendar-tab"?(h("ğŸ“… Rendering calendar view"),setTimeout(()=>{Qe().then(u=>{try{u.renderCalendar?.()}catch(d){console.error("âŒ [tabs.js] Failed to render calendar",d)}}).catch(u=>console.error("âŒ [tabs.js] Unable to load calendar module",u))},100)):o==="reports-tab"&&(h("ğŸ“Š Rendering reports view"),Ke().then(u=>{const{renderReports:d}=u;setTimeout(()=>{try{d?.()}catch(m){console.error("âŒ [tabs.js] Failed to render reports tab",m)}},50)}).catch(u=>{console.error("âŒ [tabs.js] Unable to load reports tab",u)}))};if(D=(c,a={})=>{c?r(c,a):(e.forEach(o=>{o.classList.remove("active"),o.classList.contains("tab")&&o.classList.remove("tab-active"),o.setAttribute("aria-selected","false"),o.setAttribute("tabindex","-1")}),t.forEach(o=>{o.classList.remove("active"),o.setAttribute("aria-hidden","true"),o.setAttribute("hidden",""),o.style.display="none"}),T=null,he(w))},e.forEach(c=>{c.dataset.subTabListenerAttached||(c.addEventListener("click",()=>{const a=c.getAttribute("data-sub-tab");h("ğŸ–±ï¸ Sub-tab clicked:",a),r(a)}),c.dataset.subTabListenerAttached="true")}),S)r(S,{skipStore:!0}),S=null;else{const c=document.querySelector("#reservations-tab .sub-tab-button.active"),a=s(),o=c?.getAttribute("data-sub-tab")||a;o&&(h("â­ Initial sub-tab:",o),r(o,{skipStore:!0}))}}function U(e){typeof D=="function"?D(e,{skipStore:!0}):e&&(S=e)}function Je(){try{if(typeof K=="function")return K()||{}}catch(e){console.warn("âš ï¸ [tabs.js] Failed to read cached preferences",e)}return{}}function Xe({attemptsLeft:e=0}={}){if(!x||typeof ie!="function")return!1;const t=Je(),n=Array.from(document.querySelectorAll("[data-tab]"));if(!n.length)return!1;const s=n[0]?.dataset.tab||null,c=[R,document.querySelector("[data-tab].active")?.getAttribute("data-tab")||null,t.dashboardTab,F(te),s].filter(Boolean).find(o=>document.getElementById(o));if(!c)return!1;const a=()=>{const o=document.querySelector(`[data-tab].active[data-tab="${c}"]`),l=document.getElementById(c);return!!(o&&l?.classList.contains("active")&&l?.style.display!=="none")};if(c==="reservations-tab"){const o=Array.from(document.querySelectorAll("#reservations-tab .sub-tab-button"));if(!o.length)return!1;const l=o[0]?.getAttribute("data-sub-tab")||null,b=[T,document.querySelector("#reservations-tab .sub-tab-button.active")?.getAttribute("data-sub-tab")||null,document.querySelector("#reservations-tab .sub-tab.active")?.id||null,t.dashboardSubTab,F(w),l].filter(Boolean).find(f=>document.getElementById(f)),u=document.querySelector("#reservations-tab .sub-tab-button.active"),d=document.querySelector("#reservations-tab .sub-tab.active"),m=d?.id||u?.getAttribute("data-sub-tab")||null;if(b&&m===b&&a())return d&&(d.removeAttribute("hidden"),d.style.display="block",d.setAttribute("aria-hidden","false")),!0;if(b)S=b;else if(e>0)return!1}else if(a())return!0;return ie(c,{skipStore:!0,skipRender:!0}),!0}function se(){if(!x)return;let e=0;const t=5;C&&(clearTimeout(C),C=null);const n=()=>{if(Xe({attemptsLeft:t-e})){C=null;return}if(e>=t){C=null;return}e+=1,C=setTimeout(n,50*(e+1))};n()}document.addEventListener("language:translationsReady",se);document.addEventListener("language:changed",se);document.addEventListener("theme:changed",se);let I=[],q=[],$=null,P=!1,be=!1;const i={};function Ze(){i.form=document.getElementById("equipment-package-form"),i.hiddenId=document.getElementById("equipment-package-id"),i.nameInput=document.getElementById("equipment-package-name"),i.codeInput=document.getElementById("equipment-package-code"),i.priceInput=document.getElementById("equipment-package-price"),i.descriptionInput=document.getElementById("equipment-package-description"),i.openSelector=document.getElementById("equipment-package-open-selector"),i.selectionWrapper=document.getElementById("equipment-package-selection-active"),i.selectionCounter=document.getElementById("equipment-package-selection-counter"),i.applySelection=document.getElementById("equipment-package-apply-selection"),i.cancelSelection=document.getElementById("equipment-package-cancel-selection"),i.itemsTableBody=document.querySelector("#equipment-package-items-table tbody"),i.itemsEmptyMessage=document.getElementById("equipment-package-items-empty"),i.resetButton=document.getElementById("equipment-package-reset"),i.submitButton=document.getElementById("equipment-package-submit"),i.tableBody=document.getElementById("equipment-packages-table-body"),i.emptyRow=document.getElementById("equipment-packages-empty-row"),i.countBadge=document.getElementById("equipment-packages-count"),i.applySelection&&(i.applySelection.style.display="none")}function Ie(){const{equipment:e=[]}=Y()||{};return Array.isArray(e)?e:[]}function ce(){const e=new Map;return Ie().forEach(t=>{const n=t?.id??t?.equipment_id??t?.equipmentId??null;n!=null&&e.set(String(n),t)}),e}function et(){const e=new Map;return Ie().forEach(t=>{const n=ye(t?.barcode);n&&!e.has(n)&&e.set(n,t)}),e}function N(e,{persist:t=!1}={}){I=Array.isArray(e)?e.map(Se):[],st(),t&&(Be({packages:I}),document.dispatchEvent(new CustomEvent("packages:changed",{detail:{packages:I}})))}function Se(e={}){const t=tt(e.items??e.equipment_ids??e.equipmentIds??[]);return{id:e.id!=null?String(e.id):"",package_code:e.package_code??e.code??e.slug??"",slug:e.slug??null,name:e.name??e.title??e.label??"",description:e.description??"",price:nt(e.price??e.total_price??e.package_price??0),is_active:at(e.is_active??e.active??!0),items:t,created_at:e.created_at??null,updated_at:e.updated_at??null}}function tt(e){return Array.isArray(e)||(e=[]),e.map(t=>{if(t==null)return null;if(typeof t=="number"||typeof t=="string"){const n=String(t).trim();return n?{equipment_id:n,quantity:1,unit_price:null}:null}if(typeof t=="object"){const n=t.equipment_id??t.equipmentId??t.id??t.item_id??t.itemId??null;if(n==null)return null;const s=Number.isFinite(Number(t.quantity??t.qty))?Number(t.quantity??t.qty):1,r=Number.isFinite(Number(t.unit_price??t.price))?Number(t.unit_price??t.price):null;return{equipment_id:String(n),quantity:s>0?s:1,unit_price:r}}return null}).filter(Boolean)}function nt(e){const t=Number.parseFloat(e);return Number.isFinite(t)?Math.round(t*100)/100:0}function at(e){if(e===!0||e===!1)return e;if(e==null)return!0;const t=String(e).trim().toLowerCase();return!(t==="0"||t==="false"||t==="no")}function it(e){const t=e?.quantity??e?.qty??1,n=Number.parseFloat(_(String(t)));return!Number.isFinite(n)||n<=0?1:n}function rt(e,t){const n=[e?.unit_price,e?.price];for(const r of n){if(r==null)continue;const c=Number.parseFloat(_(String(r)));if(Number.isFinite(c))return c}const s=e?.equipment_id??e?.equipmentId??e?.id;if(s!=null&&t instanceof Map){const r=t.get(String(s));if(r&&typeof r=="object"){const c=[r.unit_price,r.unitPrice,r.price,r.daily_rate,r.dailyRate];for(const a of c){if(a==null)continue;const o=Number.parseFloat(_(String(a)));if(Number.isFinite(o))return o}}}return 0}function ot(e=null){const t=e instanceof Map?e:ce();return q.reduce((n,s)=>{const r=it(s),c=rt(s,t),a=Number.isFinite(r)&&r>0?r:1,o=Number.isFinite(c)&&c>0?c:0;return n+a*o},0)}function pe(e){const t=i.priceInput;if(!t)return;const n=t.dataset.autoCalculated==="false",s=!!(t.value&&t.value.trim());if(n&&s)return;if(!Number.isFinite(e)||q.length===0){t.value="",t.dataset.autoCalculated="true";return}const r=e<0?0:e,c=Math.round(r*100)/100,a=Number.isInteger(c)?String(c):c.toFixed(2);t.value=a,t.dataset.autoCalculated="true"}function O(){if(!i.itemsTableBody||!i.itemsEmptyMessage)return;if(q.length===0){i.itemsTableBody.innerHTML="",i.itemsEmptyMessage.hidden=!1,pe(0);return}const e=ce(),t=q.map((s,r)=>{const c=e.get(String(s.equipment_id)),a=c?.desc||c?.name||y("equipment.packages.items.unknown","Ù…Ø¹Ø¯Ø© Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…"),o=c?.barcode?_(String(c.barcode)):"",l=_(String(s.quantity??1)),p=o?`${a} â€” ${o}`:a;return`
      <tr data-package-item-index="${r}">
        <td>${p}</td>
        <td>${l}</td>
        <td>
          <button type="button" class="btn btn-outline-danger btn-sm" data-action="remove-item" data-index="${r}">ğŸ—‘ï¸</button>
        </td>
      </tr>
    `});i.itemsTableBody.innerHTML=t.join(""),i.itemsEmptyMessage.hidden=!0;const n=ot(e);pe(n)}function st(){if(!i.tableBody||!i.emptyRow)return;if(!I.length){i.tableBody.innerHTML="",i.tableBody.appendChild(i.emptyRow),i.emptyRow.hidden=!1,i.countBadge&&(i.countBadge.textContent="0");return}const e=ce(),t=I.map(n=>{const s=Ve({...n,items:n.items}),r=s.map(o=>{const l=e.get(String(o.equipmentId??o.equipment_id)),p=l?.desc||l?.name||o.desc||y("equipment.packages.items.unknown","Ù…Ø¹Ø¯Ø© Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…"),b=_(String(o.qty??o.quantity??1)),u=o.barcode||l?.barcode,d=u?` (${_(String(u))})`:"";return`<li>${p}${d} Ã— ${b}</li>`}),c=s.reduce((o,l)=>o+(Number(l.qty??l.quantity??1)||0),0),a=`${_(n.price.toFixed(2))} ${y("reservations.create.summary.currency","SR")}`;return`
      <tr data-package-id="${n.id}">
        <td>${n.name||y("common.placeholder.empty","â€”")}</td>
        <td>${n.package_code||y("common.placeholder.empty","â€”")}</td>
        <td>${a}</td>
        <td>
          <details>
            <summary>${_(String(c||0))}</summary>
            <ul class="equipment-package-items-summary">${r.join("")}</ul>
          </details>
        </td>
        <td>
          <div class="d-flex gap-2">
            <button type="button" class="btn btn-sm btn-outline-primary" data-action="edit-package" data-id="${n.id}">âœï¸</button>
            <button type="button" class="btn btn-sm btn-outline-danger" data-action="delete-package" data-id="${n.id}">ğŸ—‘ï¸</button>
          </div>
        </td>
      </tr>
    `});i.tableBody.innerHTML=t.join(""),i.emptyRow.hidden=!0,i.countBadge&&(i.countBadge.textContent=_(String(I.length)))}function _e(){$=null,q=[],i.hiddenId&&(i.hiddenId.value=""),i.nameInput&&(i.nameInput.value=""),i.codeInput&&(i.codeInput.value=""),i.priceInput&&(i.priceInput.value="",i.priceInput.dataset.autoCalculated="true"),i.descriptionInput&&(i.descriptionInput.value=""),i.submitButton&&(i.submitButton.textContent=y("equipment.packages.form.actions.save","ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø­Ø²Ù…Ø©")),O(),B(!1)}function ct(e){$=e.id||null,q=e.items.map(t=>({...t})),i.hiddenId&&(i.hiddenId.value=$||""),i.nameInput&&(i.nameInput.value=e.name||""),i.codeInput&&(i.codeInput.value=e.package_code||""),i.priceInput&&(i.priceInput.value=e.price!=null?String(e.price):"",i.priceInput.dataset.autoCalculated=e.price!=null?"false":"true"),i.descriptionInput&&(i.descriptionInput.value=e.description||""),i.submitButton&&(i.submitButton.textContent=y("equipment.packages.form.actions.update","ğŸ’¾ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø²Ù…Ø©")),O(),B(!1)}function B(e=P){P=e,i.selectionWrapper&&(P?i.selectionWrapper.hidden=!1:i.selectionWrapper.hidden=!0),i.openSelector&&(i.openSelector.disabled=P),i.cancelSelection&&(i.cancelSelection.disabled=!P),Ee()}function Ee(){if(i.selectionCounter){if(!P){i.selectionCounter.textContent=y("equipment.packages.selection.counter","Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø¹Ù†Ø§ØµØ± Ø¨Ø¹Ø¯.");return}i.selectionCounter.textContent=y("equipment.packages.selection.autoMode","Ø£ÙŠ Ù…Ø¹Ø¯Ø© ØªØ®ØªØ§Ø±Ù‡Ø§ Ø³ØªÙØ¶Ø§Ù Ù…Ø¨Ø§Ø´Ø±Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø²Ù…Ø©. Ø§Ø³ØªØ®Ø¯Ù… Ø²Ø± Ø¥Ù„ØºØ§Ø¡ Ù„Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† ÙˆØ¶Ø¹ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±.")}}function ut(e){const t=e?.detail||{},n=!!t.active,s=t.selection||t.previous||{},r=s?.mode||s?.source||"";if(r!=="package-manager"&&r!=="equipment-packages"){!n&&P&&(B(!1),re());return}if(n){B(!0);return}B(!1),re()}function dt(e){const t=e?.detail;if(!t)return;const n=t.selection||{},s=n?.mode||n?.source||"";if(s!=="package-manager"&&s!=="equipment-packages")return;const r=Array.isArray(t.barcodes)?t.barcodes:[],c=Number.isInteger(t.quantity)&&t.quantity>0?t.quantity:1,a=r.length?r:t.barcode?[t.barcode]:[];if(!a.length)return;const o=et(),l=[],p=new Set;a.forEach(m=>{const f=ye(m);f&&!p.has(f)&&(p.add(f),l.push(f))});const b=Math.min(l.length,c);let u=0;const d=[];for(let m=0;m<b;m+=1){const f=l[m],g=o.get(f);if(!g)continue;const M=g?.id??g?.equipment_id??g?.equipmentId??null;if(M==null)continue;const G=g?.desc||g?.name||f,k=q.find(L=>L.equipment_id===String(M));k?k.quantity+=1:q.push({equipment_id:String(M),quantity:1,unit_price:Number.isFinite(Number(g?.price))?Number(g.price):null}),u+=1,d.push(G)}if(u>0){O(),Ee();const m=u===1?y("equipment.packages.selection.itemAddedSingle","âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© {name} Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø²Ù…Ø©"):y("equipment.packages.selection.itemAddedMulti","âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© {count} Ù…Ø¹Ø¯Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø²Ù…Ø©"),f=u===1?m.replace("{name}",d[0]||""):m.replace("{count}",_(String(u)));A(f)}else A(y("equipment.packages.selection.noMatch","âš ï¸ ØªØ¹Ø°Ø± Ø±Ø¨Ø· Ø§Ù„Ù…Ø¹Ø¯Ø§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© Ø¨Ø§Ù„Ø­Ø²Ù…ØŒ ØªØ­Ù‚Ù‚ Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"),4e3)}function lt(){B(!1),Me("package-cancel"),re()}function re(){i.form&&(i.form.scrollIntoView({behavior:"smooth",block:"start"}),setTimeout(()=>{i.nameInput?.focus()},200))}function ee(e){const t=i.priceInput;if(!t)return;const n=t.value;if(n==null)return;const s=n.replace(/[\u066B\u066C\u060CØŒ,]/gu,".");let c=_(s).replace(/[^0-9.]/gu,"");const a=c.indexOf(".");if(a!==-1){const o=c.slice(0,a+1),l=c.slice(a+1).replace(/\./g,"");c=`${o}${l}`}if(c!==n&&(t.value=c,typeof t.setSelectionRange=="function")){const o=c.length;try{t.setSelectionRange(o,o)}catch{}}e?.type==="input"&&(t.dataset.autoCalculated=c.trim()?"false":"true")}function mt(){const e=i.nameInput?.value.trim(),t=i.codeInput?.value.trim(),n=i.descriptionInput?.value.trim()??"",s=i.priceInput?.value??"",r=Number.parseFloat(_(s));if(!e)return A(y("equipment.packages.validation.nameRequired","âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø­Ø²Ù…Ø©")),null;if(!t)return A(y("equipment.packages.validation.codeRequired","âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø­Ø²Ù…Ø©")),null;if(!q.length)return A(y("equipment.packages.validation.itemsRequired","âš ï¸ Ø£Ø¶Ù Ø¹Ù†ØµØ±Ù‹Ø§ ÙˆØ§Ø­Ø¯Ù‹Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ø­Ø²Ù…Ø©")),null;const c=q.map(a=>({equipment_id:a.equipment_id,quantity:Number.isFinite(Number(a.quantity))?Number(a.quantity):1,unit_price:a.unit_price!=null&&Number.isFinite(Number(a.unit_price))?Number(a.unit_price):null}));return{package_code:t,name:e,description:n,price:Number.isFinite(r)?r:0,is_active:!0,items:c}}async function bt(e){if(e.preventDefault(),!i.form)return;const t=mt();if(t)try{let n;$?(n=await Q(`/packages/?id=${encodeURIComponent($)}`,{method:"PATCH",body:t}),A(y("equipment.packages.toast.updated","âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø²Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­"))):(n=await Q("/packages/",{method:"POST",body:t}),A(y("equipment.packages.toast.created","âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø²Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­")));const s=Se(n?.data??n),r=I.findIndex(c=>c.id===s.id);r>=0?I.splice(r,1,s):I=[s,...I],N(I,{persist:!0}),_e()}catch(n){console.error("[equipmentPackagesManager] handlePackageSubmit error",n);const s=n?.message||y("equipment.packages.toast.saveFailed","âŒ ØªØ¹Ø°Ø± Ø­ÙØ¸ Ø§Ù„Ø­Ø²Ù…Ø©");A(s,4e3)}}function pt(e){const t=e.target.closest('[data-action="remove-item"]');if(!t)return;const n=Number(t.dataset.index);Number.isNaN(n)||(q=q.filter((s,r)=>r!==n),O())}async function ft(e){const t=e.target.closest('[data-action="edit-package"]');if(t){const s=t.dataset.id;if(!s)return;const r=I.find(c=>c.id===s);if(!r)return;ct(r);return}const n=e.target.closest('[data-action="delete-package"]');if(n){const s=n.dataset.id;if(!s||!window.confirm(y("equipment.packages.confirm.delete","Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø­Ø²Ù…Ø©ØŸ")))return;try{await Q(`/packages/?id=${encodeURIComponent(s)}`,{method:"DELETE"}),I=I.filter(c=>c.id!==s),N(I,{persist:!0}),A(y("equipment.packages.toast.deleted","ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ø­Ø²Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­"))}catch(c){console.error("[equipmentPackagesManager] delete package error",c),A(y("equipment.packages.toast.deleteFailed","âŒ ØªØ¹Ø°Ø± Ø­Ø°Ù Ø§Ù„Ø­Ø²Ù…Ø©"),4e3)}}}async function Te(){try{const e=await Q("/packages/?all=1"),t=Array.isArray(e?.data)?e.data:Array.isArray(e)?e:[];N(t,{persist:!0})}catch(e){console.warn("[equipmentPackagesManager] Failed to fetch packages from API, falling back to cache",e);const{packages:t=[]}=Y()||{};N(t,{persist:!1})}}function gt(){const{packages:e=[]}=Y()||{};Array.isArray(e)&&e.length?N(e,{persist:!1}):N([],{persist:!1}),O(),B(!1)}function yt(){if(P){B(!0);return}B(!0),Ne({mode:"package-manager",source:"equipment-packages",activatedAt:Date.now()});const e=document.querySelector('[data-tab="equipment-tab"]');e&&e.click(),window.requestAnimationFrame(()=>{setTimeout(()=>{document.getElementById("search-equipment")?.focus();const t=document.getElementById("equipment-list");t&&t.scrollIntoView({behavior:"smooth",block:"start"})},200)})}function ht(){i.form&&(i.form.addEventListener("submit",bt),i.itemsTableBody?.addEventListener("click",pt),i.resetButton?.addEventListener("click",()=>{_e()}),i.tableBody?.addEventListener("click",ft),i.openSelector?.addEventListener("click",e=>{e.preventDefault(),yt()}),i.cancelSelection?.addEventListener("click",e=>{e.preventDefault(),lt()}),i.priceInput&&!i.priceInput.dataset.normalizedAttached&&(i.priceInput.addEventListener("input",ee),i.priceInput.addEventListener("blur",ee),i.priceInput.dataset.normalizedAttached="true",ee()),be||(document.addEventListener(ue.change,ut),document.addEventListener(ue.requestAdd,dt),be=!0))}function qe(){typeof document>"u"||(Ze(),i.form&&(gt(),ht(),Te()))}const vt=Object.freeze(Object.defineProperty({__proto__:null,initEquipmentPackages:qe,refreshPackagesFromApi:Te},Symbol.toStringTag,{value:"Module"}));function It(){try{const e=document.getElementById("equipment-back-to-top"),t=document.getElementById("equipment-tab");if(!e||!t)return;const n=240,s=()=>t.classList.contains("active")&&t.style.display!=="none",r=()=>{try{const a=s()&&(window.scrollY||window.pageYOffset||0)>n;e.style.display=a?"":"none"}catch{}},c=a=>{a.preventDefault();try{window.scrollTo({top:0,behavior:"smooth"})}catch{window.scrollTo(0,0)}};window.addEventListener("scroll",r,{passive:!0}),document.addEventListener("dashboard:tabChanged",r),e.addEventListener("click",c),setTimeout(r,0),setTimeout(r,250)}catch{}}function St(){const e=n=>{try{const s=n?.target;if(!s||!(s instanceof Element)||!s.classList?.contains("modal"))return;const r=document.activeElement;if(r&&s.contains(r)){try{r.blur()}catch{}try{document.body?.focus({preventScroll:!0})}catch{}}}catch{}};document.addEventListener("hide.bs.modal",e,!0),document.addEventListener("hidden.bs.modal",e,!0);const t=n=>{try{const r=(n.target instanceof Element?n.target:null)?.closest('[data-bs-dismiss="modal"], .btn-close');if(!r)return;try{r.blur()}catch{}try{document.body?.focus({preventScroll:!0})}catch{}}catch{}};document.addEventListener("click",t,!0)}Le();let v=null,H=null,z=null;function _t(){try{const e="reservations:create:draft",n=(()=>{try{if(typeof window<"u"&&window.sessionStorage){const r=window.sessionStorage.getItem(e);if(r)return JSON.parse(r)}}catch{}try{if(typeof window<"u"&&window.localStorage){const r=window.localStorage.getItem(e);if(r)return JSON.parse(r)}}catch{}return null})();if(!n)return;const s=(r,c)=>{const a=document.getElementById(r);a&&typeof c=="string"&&(a.value||(a.value=c))};s("res-start",n.startDate||""),s("res-end",n.endDate||""),s("res-start-time",n.startTime||""),s("res-end-time",n.endTime||"");try{const r=document.getElementById("res-customer-input"),c=document.getElementById("res-customer");r&&typeof n.customerLabel=="string"&&!r.value&&(r.value=n.customerLabel),c&&typeof n.customerId=="string"&&!c.value&&(c.value=n.customerId)}catch{}}catch{}}function Et(){return z||(z=E(()=>import("./dashboardMetrics.TgL7SY5d.js"),__vite__mapDeps([20,4,5]),import.meta.url).then(e=>{try{typeof e.initDashboardMetrics=="function"&&e.initDashboardMetrics()}catch(t){console.error("âŒ Failed to initialise dashboard metrics",t)}return e}).catch(e=>{throw console.error("âŒ Failed to load dashboard metrics module",e),z=null,e})),z}function Tt(){const e=()=>{Et()};typeof window<"u"&&typeof window.requestIdleCallback=="function"?window.requestIdleCallback(()=>{e()},{timeout:1500}):setTimeout(e,0)}function qt(){const e=async()=>{try{const t=[];t.push(E(()=>import("./projectsService.r7Dg857l.js"),__vite__mapDeps([17,4,5]),import.meta.url).then(n=>n.refreshProjectsFromApi().catch(()=>{})).catch(()=>{})),t.push(E(()=>import("./reservationsService.BVFzAFJb.js").then(n=>n.O),__vite__mapDeps([3,4,5,6]),import.meta.url).then(n=>n.refreshReservationsFromApi().catch(()=>{})).catch(()=>{})),t.push(E(()=>import("./state.8QT2vnmV.js").then(n=>n.Q),__vite__mapDeps([6,4,5]),import.meta.url).then(n=>n.refreshTechniciansFromApi().catch(()=>{})).catch(()=>{})),t.push(E(()=>import("./maintenanceService.BBDSN8Y9.js"),__vite__mapDeps([7,4,5]),import.meta.url).then(n=>n.refreshMaintenanceFromApi().catch(()=>{})).catch(()=>{})),t.push(E(()=>import("./equipment.7fUfsgtk.js").then(n=>n.e),__vite__mapDeps([12,4,5,6]),import.meta.url).then(n=>n.refreshEquipmentFromApi({showToastOnError:!1}).catch(()=>{})).catch(()=>{})),t.push(E(()=>Promise.resolve().then(()=>vt),void 0,import.meta.url).then(n=>n.refreshPackagesFromApi().catch(()=>{})).catch(()=>{})),t.push(E(()=>import("./reservationsUI.C0J3iDLb.js"),__vite__mapDeps([9,10,4,5,11,6,3,12,13,14,15,8,16,17,1]),import.meta.url).catch(()=>{})),await Promise.allSettled(t)}catch{}};typeof window<"u"&&typeof window.requestIdleCallback=="function"?window.requestIdleCallback(()=>{e()},{timeout:2500}):setTimeout(e,500)}async function fe(){if(!await Pe())return;Ue();try{_t()}catch{}Ye(),It(),Re(),ge(),qe(),je();try{St()}catch{}Tt(),qt();const t=document.getElementById("excel-upload");t&&t.addEventListener("change",async s=>{const r=s.target.files&&s.target.files[0];r&&(await $e(r),s.target.value="")});const n=document.getElementById("excel-upload-trigger");n&&t&&n.addEventListener("click",s=>{s.preventDefault(),t.click()}),document.getElementById("logout-btn")?.addEventListener("click",Fe),kt(),At()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{fe().catch(e=>{console.error("âŒ Failed to initialise app",e)})},{once:!0}):fe().catch(e=>{console.error("âŒ Failed to initialise app",e)});function kt(){document.querySelectorAll('input[type="datetime-local"]').forEach(e=>{e.addEventListener("input",()=>{const t=e.value;if(!t.includes("T"))return;const[n,s]=t.split("T"),[r]=s.split(":"),c=`${r.padStart(2,"0")}:00`,a=`${n}T${c}`;e.value!==a&&(e.value=a,setTimeout(()=>e.blur(),150))})})}function At(){const e=new URLSearchParams(window.location.search),t=e.get("reservationEditId"),n=e.get("reservationEditIndex");if(!t&&!n)return;v={reservationId:t,reservationIndex:n!=null?Number(n):null},ke(),e.delete("reservationEditId"),e.delete("reservationEditIndex");const s=e.toString(),r=`${window.location.pathname}${s?`?${s}`:""}${window.location.hash||""}`;window.history.replaceState({},document.title,r)}function wt(e){const t=document.getElementById(e);return!!(t?.classList.contains("active")&&t?.style.display!=="none")}function Bt(e){return new Promise(t=>{if(wt(e)){t();return}const n=r=>{r?.detail?.tabId===e&&(document.removeEventListener("dashboard:tabChanged",n),t())};document.addEventListener("dashboard:tabChanged",n),document.querySelector(`[data-tab="${e}"]`)?.click()})}function Lt(e){const t=document.querySelector(`#reservations-tab .sub-tab-button[data-sub-tab="${e}"]`),n=document.getElementById(e);return!!(t?.classList.contains("active")&&n?.classList.contains("active")&&n?.getAttribute("aria-hidden")==="false")}function Pt(e){return new Promise(t=>{if(Lt(e)){t();return}const n=r=>{r?.detail?.subTabId===e&&(document.removeEventListener("reservations:subTabChanged",n),t())};document.addEventListener("reservations:subTabChanged",n),document.querySelector(`#reservations-tab .sub-tab-button[data-sub-tab="${e}"]`)?.click()})}async function Rt(){const e=xe("openReservationEditor");if(typeof e=="function")return e;const t=await De("openReservationEditor");if(typeof t=="function")return t;throw new Error("Reservation editor handler is unavailable")}async function ke(){if(!v)return;if(H)return H;const e=(async()=>{const n=Y().reservations||[];let s=null;if(v.reservationId){const o=n.findIndex(l=>String(l?.id)===v.reservationId||String(l?.reservationId)===v.reservationId);o!==-1&&(s=o)}if(s===null&&typeof v.reservationIndex=="number"&&!Number.isNaN(v.reservationIndex)&&v.reservationIndex>=0&&v.reservationIndex<n.length&&(s=v.reservationIndex),s===null)return;const r="my-reservations-tab",c="reservations-tab",a=v;v=null;try{await Bt(c),await Pt(r);const o=await Rt();typeof o=="function"?o(s):(console.warn("âš ï¸ Pending reservation edit skipped: editor is not available"),v=a)}catch(o){console.error("âŒ Failed to open pending reservation editor",o),v=a}})();H=e;try{await e}finally{H=null}}document.addEventListener("reservations:changed",()=>{v&&ke()});
