const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./pdfPages.DYTU5-fU.js","./calculations.8elUez8P.js","./reservationsService.WomhPM7H.js","./auth.Dj0aj3LA.js","./auth.TtBtS3sI.css","./state.BaAA-ODE.js","./quotePdf.WC1ebubv.js","./canvasColorUtils.CviLtv6S.js","./a4Unified.Dl4l-Lzg.js","./preview.Cnfz6Ks6.js"])))=>i.map(i=>d[i]);
import{_ as K}from"./uiBridge.BpG-yai3.js";import{r as n,b as kt,d as Rt,t as c,f as st,g as S,h as y,c as q,i as yt,j as Bt,p as St,k as mt,a as qt,m as Nt,n as Ft,o as _t,q as Ht,s as jt,u as zt,v as Ot,w as Ut,x as Wt,y as Vt,z as Gt,A as Yt,B as Kt,C as Jt,D as Qt,E as Xt,F as Zt,G as te,H as ee,I as ne,J as gt}from"./calculations.8elUez8P.js";import{d as re,b as W,A as ae,n as X,p as se}from"./auth.Dj0aj3LA.js";import{M as oe,m as ie}from"./reservationsService.WomhPM7H.js";import{m as Et}from"./state.BaAA-ODE.js";import{mapMaintenanceFromApi as Ct}from"./maintenanceService.Bvi0GQic.js";import"./canvasColorUtils.CviLtv6S.js";function $t(t={}){return{id:t?.id!=null?String(t.id):"",customerName:t?.full_name??t?.customerName??t?.name??"",companyName:t?.company??t?.company_name??t?.companyName??"",phone:t?.phone??""}}function wt(t={}){const e=String(t?.barcode??"").trim(),r=t?.description??t?.name??"";return{id:t?.id!=null?String(t.id):"",barcode:e,desc:r,description:r,name:t?.name??r,category:t?.category??"",subcategory:t?.subcategory??"",status:t?.status??"",price:Number.parseFloat(t?.unit_price??t?.price??0)||0}}function At(t={}){const e=t?.title??t?.name??"",r=t?.project_code??t?.projectCode??"",s=t?.status??"",a=t?.confirmed===!0;return{id:t?.id!=null?String(t.id):"",title:e,code:r,status:s,confirmed:a}}function ce(){let t;try{t=re()}catch(g){return console.warn("âš ï¸ [reports] Failed to access cached data",g),!1}if(!t||typeof t!="object")return!1;const{reservations:e=[],customers:r=[],equipment:s=[],technicians:a=[],projects:o=[],maintenance:i=[]}=t;if(!(e.length||r.length||s.length||a.length||o.length))return!1;n.data.reservations=Array.isArray(e)?e.map(oe):[],n.data.customers=Array.isArray(r)?r.map($t):[],n.data.equipment=Array.isArray(s)?s.map(wt):[],n.data.technicians=Array.isArray(a)?a.map(Et):[],n.data.projects=Array.isArray(o)?o.map(At):[],n.data.projectsMap=new Map(n.data.projects.map(g=>[g.id,g])),n.data.maintenance=Array.isArray(i)?i.map(Ct):[],n.techniciansIndex=new Map((n.data.technicians||[]).map(g=>[String(g.id),g]));try{kt()}catch{}return!0}async function ot({silent:t=!1,force:e=!1,signature:r=null,autoRender:s=!1}={}){if(n.loading){r&&(n.pendingFetchSignature=r,n.pendingFetchForce=e||n.pendingFetchForce);return}const a=Date.now();if(!(!e&&r&&n.lastFetchSignature===r&&a-n.lastFetchAt<1200)){n.loading=!0,n.errorMessage="",t||n.callbacks.onBeforeRender?.();try{const{startDate:o,endDate:i}=Rt(n.filters||{}),u=E=>{if(!E)return null;const T=E.getFullYear(),b=String(E.getMonth()+1).padStart(2,"0"),w=String(E.getDate()).padStart(2,"0");return`${T}-${b}-${w}`},g=u(o),p=u(i),h=200;let f=0,m=[];const d=50;for(let E=0;E<d;E+=1){const T=new URLSearchParams;T.set("limit",String(h)),T.set("offset",String(f)),g&&T.set("start_date",g),p&&T.set("end_date",p);const b=n.filters||{};b?.status&&b.status!=="all"&&T.set("status",String(b.status)),b?.search&&T.set("search",String(b.search));const w=await W(`/reservations/?${T.toString()}`),B=Array.isArray(w?.data)?w.data:[];if(m=m.concat(B),B.length<h)break;f+=h}const[v,k,C,L,$]=await Promise.all([W("/customers/?limit=500"),W("/equipment/?limit=500"),W("/technicians/?limit=500"),W("/projects/?limit=500"),W("/maintenance/?limit=500")]);n.data.reservations=Array.isArray(m)?m.map(E=>ie(E)):[],n.data.customers=Array.isArray(v?.data)?v.data.map($t):[],n.data.equipment=Array.isArray(k?.data)?k.data.map(wt):[],n.data.technicians=Array.isArray(C?.data)?C.data.map(Et):[],n.data.projects=Array.isArray(L?.data)?L.data.map(At):[],n.data.projectsMap=new Map(n.data.projects.map(E=>[E.id,E])),n.data.maintenance=Array.isArray($?.data)?$.data.map(Ct):[],n.techniciansIndex=new Map((n.data.technicians||[]).map(E=>[String(E.id),E]));try{kt()}catch{}n.lastFetchSignature=r||null,n.lastFetchAt=Date.now()}catch(o){console.error("âŒ [reports] Failed to load reports data",o),n.errorMessage=o instanceof ae?o.message:c("reservations.reports.error.fetchFailed","ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±ØŒ Ø­Ø§ÙˆÙ„ Ù„Ø§Ø­Ù‚Ø§Ù‹"),(!n.data.projectsMap||!(n.data.projectsMap instanceof Map))&&(n.data.projectsMap=new Map)}finally{if(n.loading=!1,n.pendingFetchSignature){const o=n.pendingFetchSignature,i=n.pendingFetchForce;n.pendingFetchSignature=null,n.pendingFetchForce=!1,setTimeout(()=>{ot({silent:!0,force:i,signature:o,autoRender:!0}).catch(u=>{console.error("âŒ [reports] Queued refresh failed",u)})},0)}(!t||s)&&n.callbacks.onAfterRender?.()}}}function O(){const t=document.documentElement;return t.classList.contains("dark")||t.dataset.theme==="dark"?"dark":"light"}function H(t,e){const r=document.getElementById(t);if(r){if(!e||e.length===0){r.innerHTML=`<div class="text-sm text-base-content/60">${c("reservations.reports.progress.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§.","No data to display.")}</div>`;return}r.innerHTML=e.map(s=>{const a=Math.min(Math.max(s.percent??0,0),100),o=c("reservations.reports.progress.meta","{count} Ø­Ø¬Ø²","{count} reservations").replace("{count}",S(s.rawCount??s.value??0)),i=s.className?`reports-progress-fill ${s.className}`:"reports-progress-fill";return`
        <div class="reports-progress-row">
          <div class="reports-progress-top">
            <span>${s.label}</span>
            <span class="reports-progress-value">${S(s.percent??0)}%</span>
          </div>
          <div class="reports-progress-bar">
            <div class="${i}" style="width: ${a}%;"></div>
          </div>
          <div class="reports-progress-meta">${o}</div>
        </div>
      `}).join("")}}function I(t,e){const r=document.querySelector(`[data-chart-loading="${t}"]`);r&&(r.style.display=e?"":"none")}async function le(t){const e=document.getElementById("reports-volume-chart");if(!e)return;const r=Array.isArray(t)?t:[];if(n.lastTrendData=r,I("volume",!0),!r.length){n.charts.trend&&(n.charts.trend.destroy(),n.charts.trend=null),e.innerHTML=`<p class="text-base-content/60 text-sm">${c("reservations.reports.progress.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§.","No data to display.")}</p>`,I("volume",!1);return}try{const s=await st();if(!s){e.innerHTML=`<p class="text-base-content/60 text-sm">${c("reservations.reports.progress.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§.","No data to display.")}</p>`,I("volume",!1);return}const a=r.map(b=>b.label),o=r.map(b=>Math.round(b.count||0)),i=r.map(b=>Number(b.revenue||0)),u=r.map(b=>Number(b.netProfit||0)),g=r.map(b=>b.movingAvgRevenue!=null?Number(b.movingAvgRevenue):null),p=o.reduce((b,w)=>b+(Number.isFinite(w)?w:0),0),h=i.reduce((b,w)=>b+(Number.isFinite(w)?w:0),0),f=u.reduce((b,w)=>b+(Number.isFinite(w)?w:0),0);if(p===0&&h===0&&f===0){n.charts.trend&&(n.charts.trend.destroy(),n.charts.trend=null),e.innerHTML=`<p class="text-base-content/60 text-sm">${c("reservations.reports.progress.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§.","No data to display.")}</p>`;return}const m=[{name:c("reservations.reports.chart.volume.series.reservations","Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª","Reservations"),type:"column",data:o},{name:c("reservations.reports.chart.volume.series.revenue","Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª (SR)","Revenue (SR)"),type:"line",data:i,yAxisIndex:1},{name:c("reservations.reports.chart.volume.series.net","ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ (SR)","Net profit (SR)"),type:"line",data:u,yAxisIndex:1},{name:c("reservations.reports.chart.volume.series.movingAvg","Ù…ØªÙˆØ³Ø· Ù…ØªØ­Ø±Ùƒ (Ù£ Ø£Ø´Ù‡Ø±)","3-mo Moving Avg"),type:"line",data:g,yAxisIndex:1}],d=typeof window<"u"&&(window.innerWidth||document.documentElement?.clientWidth)||1024,C={chart:{type:"line",height:Number.isFinite(d)&&d<768?420:340,stacked:!1,toolbar:{show:!1},background:"transparent",fontFamily:"Tajawal, sans-serif",animations:{enabled:!0},events:{dataPointSelection:(b,w,B)=>{if(B?.dataPointIndex!=null){const R=n.lastTrendData[B.dataPointIndex];n.callbacks.onTrendDrilldown?.(R,B.dataPointIndex)}}}},theme:{mode:O()},stroke:{width:[0,4,4],curve:"smooth"},markers:{size:[0,4,4,0]},colors:["#6366f1","#22c55e","#f97316","#0ea5e9"],dataLabels:{enabled:!1},fill:{type:"solid",opacity:1},stroke:{curve:"smooth",width:[0,2,2,2],dashArray:[0,0,0,6]},xaxis:{categories:a,labels:{style:{colors:O()==="dark"?"#cbd5f5":"#475569"}}},yaxis:[{seriesName:c("reservations.reports.chart.volume.series.reservations","Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª","Reservations"),axisTicks:{show:!0},axisBorder:{show:!0,color:"#6366f1"},labels:{style:{colors:"#6366f1"},formatter:b=>S(b)},title:{text:c("reservations.reports.chart.volume.series.reservations","Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª","Reservations"),style:{color:"#6366f1"}}},{opposite:!0,seriesName:c("reservations.reports.chart.volume.series.revenue","Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª (SR)","Revenue (SR)"),axisTicks:{show:!0},axisBorder:{show:!0,color:"#22c55e"},labels:{style:{colors:"#22c55e"},formatter:b=>y(b)},title:{text:c("reservations.reports.chart.volume.series.revenue","Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª (SR)","Revenue (SR)"),style:{color:"#22c55e"}}}],legend:{position:"bottom"},tooltip:{shared:!0,intersect:!1,custom:({series:b,dataPointIndex:w,w:B})=>{const R=n.lastTrendData?.[w]||{},Z=a?.[w]||"",F=[],j=b?.[0]?.[w];j!=null&&F.push(`<div><span>ğŸ“¦</span> ${S(j)}</div>`);const U=b?.[1]?.[w];if(U!=null){const M=Number.isFinite(R.yoyChange)?`${R.yoyChange>=0?"+":""}${S(Math.round(R.yoyChange))}% YoY`:"",z=Number.isFinite(R.momChange)?`${R.momChange>=0?"+":""}${S(Math.round(R.momChange))}% MoM`:"",nt=[M,z].filter(Boolean).join(" Â· ");F.push(`<div><span>ğŸ’°</span> ${y(U)}${nt?` <small class="text-base-content/60">(${nt})</small>`:""}</div>`)}const tt=b?.[2]?.[w];tt!=null&&F.push(`<div><span>ğŸ§®</span> ${y(tt)}</div>`);const et=b?.[3]?.[w];return et!=null&&F.push(`<div><span>ğŸ“ˆ</span> ${y(et)}</div>`),`
            <div class="apex-tooltip">
              <div class="mb-1 font-semibold">${Z}</div>
              ${F.join("")}
            </div>
          `}}},L=O(),$=String(a.join("|")),E=n.chartsMeta.trend,T=n.charts.trend&&E.theme===L&&E.categoriesSig===$;n.charts.trend&&T?n.charts.trend.updateSeries(m,!0):n.charts.trend?(n.charts.trend.updateOptions({...C},!0,!0),n.charts.trend.updateSeries(m,!0)):(e.innerHTML="",n.charts.trend=new s(e,{...C,series:m}),n.charts.trend.render()),n.chartsMeta.trend={categoriesSig:$,theme:L},I("volume",!1)}catch(s){console.error("âš ï¸ [reports] Failed to render trend chart",s),e.innerHTML=`<p class="text-base-content/60 text-sm">${c("reservations.reports.progress.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§.","No data to display.")}</p>`,I("volume",!1)}}async function de(t){const e=document.getElementById("reports-status-chart"),r="reports-status-breakdown";if(!e)return;const s=Array.isArray(t)?t:[];n.lastStatusData=s,I("status",!0);const a=s.map(i=>Math.max(0,i.value||0)),o=a.reduce((i,u)=>i+u,0);if(!s.length||o===0){n.charts.status&&(n.charts.status.destroy(),n.charts.status=null),H(r,[]),e.innerHTML=`<p class="text-base-content/60 text-sm">${c("reservations.reports.progress.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§.","No data to display.")}</p>`,I("status",!1);return}try{const i=await st();if(!i){H(r,[]),e.innerHTML=`<p class="text-base-content/60 text-sm">${c("reservations.reports.progress.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§.","No data to display.")}</p>`,I("status",!1);return}const u=s.map(d=>d.label),g={chart:{type:"donut",height:300,fontFamily:"Tajawal, sans-serif",toolbar:{show:!1},background:"transparent",events:{dataPointSelection:(d,v,k)=>{if(k?.dataPointIndex!=null){const C=n.lastStatusData[k.dataPointIndex];C?.filterKey&&n.callbacks.onStatusDrilldown?.(C,k.dataPointIndex)}}}},theme:{mode:O()},labels:u,series:a,colors:["#22c55e","#f97316","#6366f1","#ef4444"],legend:{position:"bottom"},dataLabels:{formatter:d=>`${Math.round(d)}%`},plotOptions:{pie:{donut:{size:"68%",labels:{show:!0,total:{show:!0,label:c("reservations.reports.chart.status.title","ğŸ§¾ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª","Status distribution"),formatter:()=>S(a.reduce((d,v)=>d+v,0))}}}}},tooltip:{y:{formatter:(d,v)=>{const k=n.lastStatusData?.[v?.seriesIndex||0],C=k?`${S(k.percent)}%`:`${S(d)}%`;return`${k?S(k.rawCount??k.value??0):S(d)} / ${C}`}}}},p=O(),h=String(u.join("|")),f=n.chartsMeta.status,m=n.charts.status&&f.theme===p&&f.labelsSig===h;n.charts.status&&m?n.charts.status.updateSeries(a,!0):n.charts.status?(n.charts.status.updateOptions({...g},!0,!0),n.charts.status.updateSeries(a,!0)):(e.innerHTML="",n.charts.status=new i(e,{...g,series:a}),n.charts.status.render()),H(r,s),n.chartsMeta.status={labelsSig:h,theme:p},I("status",!1)}catch(i){console.error("âš ï¸ [reports] Failed to render status chart",i),H(r,[]),e.innerHTML=`<p class="text-base-content/60 text-sm">${c("reservations.reports.progress.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§.","No data to display.")}</p>`,I("status",!1)}}async function ue(t){const e=document.getElementById("reports-payment-chart"),r="reports-payment-breakdown";if(!e)return;const s=Array.isArray(t)?t:[];n.lastPaymentData=s,I("payment",!0);const a=s.map(i=>Math.max(0,i.value||0)),o=a.reduce((i,u)=>i+u,0);if(!s.length||o===0){n.charts.payment&&(n.charts.payment.destroy(),n.charts.payment=null),H(r,[]),e.innerHTML=`<p class="text-base-content/60 text-sm">${c("reservations.reports.progress.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§.","No data to display.")}</p>`,I("payment",!1);return}try{const i=await st();if(!i){H(r,[]),e.innerHTML=`<p class="text-base-content/60 text-sm">${c("reservations.reports.progress.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§.","No data to display.")}</p>`,I("payment",!1);return}const u=s.map(d=>d.label),g={chart:{type:"pie",height:300,fontFamily:"Tajawal, sans-serif",toolbar:{show:!1},background:"transparent",events:{dataPointSelection:(d,v,k)=>{if(k?.dataPointIndex!=null){const C=n.lastPaymentData[k.dataPointIndex];C?.filterKey&&n.callbacks.onPaymentDrilldown?.(C,k.dataPointIndex)}}}},theme:{mode:O()},labels:u,series:a,colors:["#00ac69","#f59e0b","#f43f5e"],legend:{position:"bottom"},dataLabels:{formatter:d=>`${Math.round(d)}%`},tooltip:{y:{formatter:(d,v)=>{const k=n.lastPaymentData?.[v?.seriesIndex||0],C=k?`${S(k.percent)}%`:`${S(d)}%`;return`${k?S(k.rawCount??k.value??0):S(d)} / ${C}`}}}},p=O(),h=String(u.join("|")),f=n.chartsMeta.payment,m=n.charts.payment&&f.theme===p&&f.labelsSig===h;n.charts.payment&&m?n.charts.payment.updateSeries(a,!0):n.charts.payment?(n.charts.payment.updateOptions({...g},!0,!0),n.charts.payment.updateSeries(a,!0)):(e.innerHTML="",n.charts.payment=new i(e,{...g,series:a}),n.charts.payment.render()),H(r,s),n.chartsMeta.payment={labelsSig:h,theme:p},I("payment",!1)}catch(i){console.error("âš ï¸ [reports] Failed to render payment chart",i),H(r,[]),e.innerHTML=`<p class="text-base-content/60 text-sm">${c("reservations.reports.progress.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§.","No data to display.")}</p>`,I("payment",!1)}}async function pe(t){const e=document.getElementById("reports-status-stacked-chart");if(!e)return;const r=Array.isArray(t)?t:[];if(!r.length){e.innerHTML=`<p class="text-base-content/60 text-sm">${c("reservations.reports.progress.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§.","No data to display.")}</p>`;return}try{const s=await st(),a=r.map(h=>h.label),o=r.map(h=>h.confirmed||0),i=r.map(h=>h.cancelled||0),u=[{name:c("reservations.reports.status.confirmedLabel","Ù…Ø¤ÙƒØ¯Ø©","Confirmed"),data:o},{name:c("reservations.reports.status.cancelledLabel","Ù…Ù„ØºØ§Ø©","Cancelled"),data:i}],g={chart:{type:"bar",height:320,stacked:!0,toolbar:{show:!1}},series:u,xaxis:{categories:a},plotOptions:{bar:{columnWidth:"55%",borderRadius:6}},colors:["#22c55e","#ef4444"],dataLabels:{enabled:!1},legend:{position:"bottom"}};e.innerHTML="",new s(e,g).render()}catch(s){console.error("[reports] failed to render stacked status chart",s)}}function me(t){const e=document.getElementById("reports-kpi-total"),r=document.getElementById("reports-kpi-total-meta"),s=document.getElementById("reports-kpi-revenue"),a=document.getElementById("reports-kpi-revenue-meta"),o=document.getElementById("reservations-revenue-breakdown"),i=document.getElementById("reports-kpi-outstanding"),u=document.getElementById("reports-kpi-outstanding-meta"),g=document.getElementById("reports-kpi-crew-cost"),p=document.getElementById("reports-kpi-crew-cost-meta"),h=document.getElementById("reports-kpi-equipment-cost"),f=document.getElementById("reports-kpi-equipment-cost-meta"),m=document.getElementById("reports-kpi-margin"),d=document.getElementById("reports-kpi-margin-meta"),v=document.getElementById("reports-kpi-net"),k=document.getElementById("reports-kpi-net-meta"),C=t.total||0,L=t.cancelled||0;t.activeTotal!=null?t.activeTotal:Math.max(0,C-L);const $=t.revenue||0;t.confirmed;const E=t.paidCount||0,T=t.unpaidCount||Math.max(0,(t.activeTotal||0)-E);t.average;const b=t.companyShareTotal||0,w=t.taxTotal||0,B=t.crewTotal||0,R=t.crewCostTotal||0,Z=t.equipmentTotal||0,F=t.equipmentCostTotal||0,j=t.netProfit||0,U=t.maintenanceExpense||0,tt=$>0?Math.round(j/$*100):0,et=t.outstandingTotal||0;if(e&&(e.textContent=S(C)),r){const M=c("reservations.reports.kpi.total.dynamicMeta","Ù…Ù†Ù‡Ø§ {count} Ù…ØºÙ„Ù‚Ø©","Includes {count} closed").replace("{count}",S(t.completed||0)),z=L>0?" "+c("reservations.reports.kpi.total.cancelledPart","â€¢ {count} Ù…Ù„ØºØ§Ø©","â€¢ {count} cancelled").replace("{count}",S(L)):"";r.textContent=M+z}if(s&&(s.textContent=y($)),a)if(C===0)a.textContent=c("reservations.reports.progress.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§.","No data to display.");else{const z=c("reservations.reports.kpi.revenue.metaLite","Ù†Ø³Ø¨Ø© Ø§Ù„Ø´Ø±ÙƒØ© {share}","Company share {share}").replace("{share}",y(b));a.textContent=z}if(o)if($>0){const M=[{label:c("reservations.reports.kpi.revenue.details.gross","Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯ Ø§Ù„ÙƒÙ„ÙŠ","Gross revenue"),value:y($),hint:c("reservations.reports.kpi.revenue.details.grossHint","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª (Ù‚Ø¨Ù„ Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª)","Total bookings value (before discounts)")},{label:c("reservations.reports.kpi.revenue.details.discount","Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª","Discounts"),value:t.discountTotal>0?`âˆ’${y(t.discountTotal)}`:y(0),hint:c("reservations.reports.kpi.revenue.details.discountHint","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø·Ø¨Ù‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù…Ø¤ÙƒØ¯Ø©","Sum of discounts applied to confirmed reservations")},{label:c("reservations.reports.kpi.revenue.details.share","Ù†Ø³Ø¨Ø© Ø§Ù„Ø´Ø±ÙƒØ©","Company share"),value:y(b),hint:c("reservations.reports.kpi.revenue.details.shareHint","ØªÙØ­Ø³Ø¨ Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…ØŒ ÙˆØªÙØ¶Ø§Ù Ù„Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ","Applied after discount and added to total")},{label:c("reservations.reports.kpi.revenue.details.tax","Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©","Tax"),value:y(w),hint:c("reservations.reports.kpi.revenue.details.taxHint","Ø¶Ø±ÙŠØ¨Ø© 15% Ø¹Ù„Ù‰ (Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ… + Ù†Ø³Ø¨Ø© Ø§Ù„Ø´Ø±ÙƒØ©)","15% VAT on (after-discount total + company share)")},{label:c("reservations.reports.kpi.revenue.details.crewGross","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ø§Ù‚Ù…","Crew total"),value:y(B),hint:c("reservations.reports.kpi.revenue.details.crewGrossHint","Ù‚ÙŠÙ…Ø© Ø§Ù„Ø·Ø§Ù‚Ù… Ù„Ù„Ø¹Ù…ÙŠÙ„","Crew price billed to client")},{label:c("reservations.reports.kpi.revenue.details.crew","ØªÙƒÙ„ÙØ© Ø§Ù„Ø·Ø§Ù‚Ù…","Crew cost"),value:y(R),hint:c("reservations.reports.kpi.revenue.details.crewHint","ØªÙƒÙ„ÙØ© Ø§Ù„Ø·Ø§Ù‚Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙƒØ©","Crew cost to company")},{label:c("reservations.reports.kpi.revenue.details.equipmentGross","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª","Equipment total"),value:y(Z),hint:c("reservations.reports.kpi.revenue.details.equipmentGrossHint","Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª Ù„Ù„Ø¹Ù…ÙŠÙ„","Equipment price billed to client")},{label:c("reservations.reports.kpi.revenue.details.equipment","ØªÙƒÙ„ÙØ© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª","Equipment cost"),value:y(F),hint:c("reservations.reports.kpi.revenue.details.equipmentHint","ØªÙƒÙ„ÙØ© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙƒØ©","Equipment cost to company")}];U>0&&M.push({label:c("reservations.reports.kpi.revenue.details.maintenance","Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„ØµÙŠØ§Ù†Ø©","Maintenance expenses"),value:`âˆ’${y(U)}`}),M.push({label:c("reservations.reports.kpi.revenue.details.net","ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­","Net profit"),value:y(j)}),o.innerHTML=M.map(({label:z,value:nt,hint:Dt})=>`
          <div class="reports-kpi-detail-row" title="${Dt||""}">
            <span class="reports-kpi-detail-label">${z}</span>
            <span class="reports-kpi-detail-value">${nt}</span>
          </div>
        `).join(""),o.classList.remove("hidden")}else o.innerHTML="",o.classList.add("hidden");if(i&&(i.textContent=y(et)),u){const M=c("reservations.reports.kpi.outstanding.meta","{count} Ø­Ø¬Ø² ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹/Ø¬Ø²Ø¦ÙŠØ§Ù‹","{count} unpaid/partial reservations").replace("{count}",S(T));u.textContent=M}if(g&&(g.textContent=y(R)),p){const M=c("reservations.reports.kpi.crewCost.meta","Ø§Ù„Ù…ÙÙˆØªØ±Ø© {billable}","Billed {billable}").replace("{billable}",y(B));p.textContent=M}if(h&&(h.textContent=y(F)),f){const M=c("reservations.reports.kpi.equipmentCost.meta","Ø§Ù„Ù…ÙÙˆØªØ±Ø© {billable}","Billed {billable}").replace("{billable}",y(Z));f.textContent=M}if(m&&(m.textContent=`${tt}%`),d){const M=c("reservations.reports.kpi.margin.meta","ØµØ§ÙÙŠ {net} / Ø¥ÙŠØ±Ø§Ø¯Ø§Øª {rev}","Net {net} / Revenue {rev}").replace("{net}",y(j)).replace("{rev}",y($));d.textContent=M}if(v&&(v.textContent=y(j)),k){const M=c("reservations.reports.kpi.net.meta","Ø¨Ø¹Ø¯ Ø§Ù„ØµÙŠØ§Ù†Ø© âˆ’ {maint}","After maintenance âˆ’ {maint}").replace("{maint}",y(U));k.textContent=M}}function A(t=""){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function Y(t=""){return String(t).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function he(t,e,r){const s=document.getElementById("reports-reservations-body");if(!s)return[];const a=(Array.isArray(t)?t:[]).filter(d=>at(d)?.confirmed);if(a.length===0)return s.innerHTML=`<tr><td colspan="8" class="text-base-content/60">${c("reservations.reports.table.emptyPeriod","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©.","No data for this period.")}</td></tr>`,[];const o=new Map((e||[]).map(d=>[String(d.id),d]));new Map((r||[]).map(d=>[String(d.id),d]));const i={code:c("reservations.reports.results.headers.id","Ø§Ù„Ø­Ø¬Ø²","Reservation"),customer:c("reservations.reports.results.headers.customer","Ø§Ù„Ø¹Ù…ÙŠÙ„","Customer"),company:c("reservations.reports.results.headers.company","Ø§Ù„Ø´Ø±ÙƒØ©","Company"),phone:c("reservations.reports.results.headers.phone","Ø§Ù„Ù‡Ø§ØªÙ","Phone"),date:c("reservations.reports.results.headers.date","Ø§Ù„ØªØ§Ø±ÙŠØ®","Date"),status:c("reservations.reports.results.headers.status","Ø§Ù„Ø­Ø§Ù„Ø©","Status"),payment:c("reservations.reports.results.headers.payment","Ø§Ù„Ø¯ÙØ¹","Payment"),paymentsCount:c("reservations.reports.results.headers.paymentsCount","Ø¹Ø¯Ø¯ Ø§Ù„Ø¯ÙØ¹Ø§Øª","Payments count"),days:c("reservations.reports.results.headers.days","Ø§Ù„Ø£ÙŠØ§Ù…","Days"),equipment:c("reservations.reports.results.headers.equipment","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª","Equipment"),crewGross:c("reservations.reports.results.headers.crewGross","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ø§Ù‚Ù…","Crew total"),crewCost:c("reservations.reports.results.headers.crewCost","ØªÙƒÙ„ÙØ© Ø§Ù„Ø·Ø§Ù‚Ù…","Crew cost"),equipmentCost:c("reservations.reports.results.headers.equipmentCost","ØªÙƒÙ„ÙØ© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª","Equipment cost"),discount:c("reservations.reports.results.headers.discount","Ø§Ù„Ø®ØµÙ…","Discount"),tax:c("reservations.reports.results.headers.tax","Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©","Tax"),total:c("reservations.reports.results.headers.total","Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ","Total"),share:c("reservations.reports.results.headers.share","Ù†Ø³Ø¨Ø© Ø§Ù„Ø´Ø±ÙƒØ©","Company share"),sharePercent:c("reservations.reports.results.headers.sharePercent","Ù†Ø³Ø¨Ø© Ø§Ù„Ø´Ø±ÙƒØ© %","Company share %"),shareAmount:c("reservations.reports.results.headers.shareAmount","Ù…Ø¨Ù„Øº Ù†Ø³Ø¨Ø© Ø§Ù„Ø´Ø±ÙƒØ©","Company share amount"),net:c("reservations.reports.results.headers.net","ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­","Net profit")},u=ye([...a]),{page:g,pageSize:p}=n.pagination,h=Math.max(0,(g-1)*p),m=u.slice(h,h+p).map(d=>{const v=be(d,o),k=o.get(String(d?.customerId)),L=(Array.isArray(d.paymentHistory)?d.paymentHistory:Array.isArray(d.payment_history)?d.payment_history:[]).length,$=q(d),E={[i.code]:v.code.text,[i.customer]:v.customer.text,[i.company]:k?.companyName||"",[i.phone]:k?.phone||"",[i.date]:v.date.text,[i.status]:v.status.text,[i.payment]:v.payment.text,[i.paymentsCount]:String(L),[i.days]:String($.rentalDays??0),[i.equipment]:y($.equipmentTotal),[i.crewGross]:y($.crewTotal),[i.crewCost]:y($.crewCostTotal??0),[i.equipmentCost]:y($.equipmentCostTotal??0),[i.discount]:y($.discountAmount??0),[i.tax]:y($.taxAmount??0),[i.total]:v.total.text,[i.share]:v.share.text,[i.sharePercent]:`${S($.companySharePercent??0)}%`,[i.shareAmount]:y($.companyShareAmount??0),[i.net]:v.net.text},T=c("common.placeholder.empty","â€”","â€”");return Object.keys(E).forEach(b=>{String(E[b]??"").trim()===""&&(E[b]=T)}),{formatted:v,exportRow:E}});return s.innerHTML=m.map(({formatted:d})=>`
      <tr data-drilldown="reservation" data-search="${Y(d.code.text)}">
        <td data-report-column="code">${d.code.html}</td>
        <td data-report-column="customer">${d.customer.html}</td>
        <td data-report-column="date">${d.date.html}</td>
        <td data-report-column="status">${d.status.html}</td>
        <td data-report-column="payment">${d.payment.html}</td>
        <td data-report-column="total">${d.total.html}</td>
        <td data-report-column="share">${d.share.html}</td>
        <td data-report-column="equipmentCost">${d.equipmentCost.html}</td>
        <td data-report-column="net">${d.net.html}</td>
      </tr>
    `).join(""),ve(u.length),fe(),m.map(({exportRow:d})=>d)}function fe(){const t=document.querySelector("#reports-reservations-table thead");t&&t.querySelectorAll("th.sortable").forEach(e=>{e.dataset.sortBound!=="true"&&(e.addEventListener("click",()=>{const r=e.dataset.sortKey;r&&(n.sort.key===r?n.sort.dir=n.sort.dir==="asc"?"desc":"asc":(n.sort.key=r,n.sort.dir="asc"),n.pagination.page=1,n.callbacks.onRender?.())}),e.dataset.sortBound="true")})}function ye(t){const{key:e,dir:r}=n.sort||{key:"date",dir:"desc"},s=r==="asc"?1:-1;return t.sort((a,o)=>s*ge(a,o,e))}function ge(t,e,r){switch(r){case"code":return String(t?.reservationId??t?.id??"").localeCompare(String(e?.reservationId??e?.id??""),"ar",{numeric:!0});case"customer":return String(t?.customerName??t?.customerId??"").localeCompare(String(e?.customerName??e?.customerId??""),"ar",{numeric:!0});case"date":return new Date(t?.start||0)-new Date(e?.start||0);case"status":{const s=at(t)?.statusValue||"",a=at(e)?.statusValue||"";return String(s).localeCompare(String(a),"ar")}case"total":{const s=q(t)?.finalTotal||0,a=q(e)?.finalTotal||0;return s-a}case"share":{const s=q(t)?.companyShareAmount||0,a=q(e)?.companyShareAmount||0;return s-a}case"equipmentCost":{const s=q(t)?.equipmentCostTotal||0,a=q(e)?.equipmentCostTotal||0;return s-a}case"net":{const s=q(t)?.netProfit||0,a=q(e)?.netProfit||0;return s-a}default:return new Date(t?.start||0)-new Date(e?.start||0)}}function at(t){if(!t)return yt(t);if(t.__reportsStatusCache)return t.__reportsStatusCache;const e=yt(t);return t.__reportsStatusCache=e,e}function ve(t){const e=document.getElementById("reports-table-pagination");if(!e)return;const{page:r,pageSize:s}=n.pagination,a=Math.max(1,Math.ceil(t/s)),o=r<=1?"disabled":"",i=r>=a?"disabled":"",u=t===0?0:(r-1)*s+1,g=Math.min(r*s,t);if(t<=s){e.innerHTML=`<div class="page-info">${S(u)}â€“${S(g)} / ${S(t)}</div>`;return}e.innerHTML=`
    <div class="pager">
      <button type="button" ${o} data-page="prev">â—€</button>
      <button type="button" ${i} data-page="next">â–¶</button>
    </div>
    <div class="page-info">${S(u)}â€“${S(g)} / ${S(t)}</div>
    <div class="pager page-size">
      <label>${c("reservations.reports.pageSize","Ù„ÙƒÙ„ ØµÙØ­Ø©","Per page")}</label>
      <button type="button" data-size="25">25</button>
      <button type="button" data-size="50">50</button>
      <button type="button" data-size="100">100</button>
    </div>
  `,e.querySelector('[data-page="prev"]')?.addEventListener("click",()=>{n.pagination.page>1&&(n.pagination.page-=1,n.callbacks.onRender?.())}),e.querySelector('[data-page="next"]')?.addEventListener("click",()=>{const p=Math.max(1,Math.ceil(t/n.pagination.pageSize));n.pagination.page<p&&(n.pagination.page+=1,n.callbacks.onRender?.())}),e.querySelectorAll("[data-size]")?.forEach(p=>{p.addEventListener("click",()=>{const h=Number(p.dataset.size);Number.isFinite(h)&&h>0&&(n.pagination.pageSize=h,n.pagination.page=1,n.callbacks.onRender?.())})})}function be(t,e,r){const s=t?.reservationId||t?.id||c("common.placeholder.empty","â€”","â€”"),a=X(String(s)),i=e.get(String(t?.customerId))?.customerName||c("reservations.reports.topCustomers.unknown","Ø¹Ù…ÙŠÙ„ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ","Unknown customer"),u=at(t),g=xe(u.statusValue),p=ke(u.statusValue,g),h=Array.isArray(t.paymentHistory)?t.paymentHistory:Array.isArray(t.payment_history)?t.payment_history:[],f=Se(u.paidStatus,h),m=h.length;let d=f.html;if(m>0){const b=c("reservations.paymentHistory.countLabel","{count} Ø¯ÙØ¹Ø©","{count} payments").replace("{count}",S(m));d=`<div class="reports-payment-cell">${f.html}<small class="reports-payment-subtext">${A(b)}</small></div>`}const v=Bt(t?.start),k=q(t),C=y(k.finalTotal),L=k.companySharePercent>0?`${S(k.companySharePercent)}% (${y(k.companyShareAmount)})`:c("reservations.reports.results.share.none","Ø¨Ø¯ÙˆÙ† Ù†Ø³Ø¨Ø© Ø§Ù„Ø´Ø±ÙƒØ©","No company share"),$=y(k.netProfit),E=y(k.equipmentCostTotal??0),T=A(i);return{code:{html:A(a),text:a},customer:{html:T,text:i},date:{html:A(v),text:v},status:p,payment:{html:d,text:f.text},total:{html:A(C),text:C},share:{html:A(L),text:L},net:{html:A($),text:$},equipmentCost:{html:A(E),text:E}}}function xe(t){switch(t){case"completed":return J(c("reservations.list.status.completed","ğŸ“ Ù…ØºÙ„Ù‚","Closed"));case"confirmed":return J(c("reservations.list.status.confirmed","âœ… Ù…Ø¤ÙƒØ¯","Confirmed"));case"pending":return J(c("reservations.list.status.pending","â³ ØºÙŠØ± Ù…Ø¤ÙƒØ¯","Pending"));case"cancelled":return J(c("reservations.list.status.cancelled","âŒ Ù…Ù„ØºÙŠ","Cancelled"));default:return X(t||c("common.placeholder.empty","â€”","â€”"))}}function ke(t,e){const r=J(e);return{html:`<span class="reservation-chip status-${["completed","confirmed","pending","cancelled"].includes(t)?t:"info"}">${A(r)}</span>`,text:r}}function Se(t,e=[]){const r=St(t),s=String(t??"").toLowerCase(),a=s==="paid"?"paid":s==="partial"?"partial":"unpaid";let o="";const i=c("reservations.create.summary.currency","Ø±ÙŠØ§Ù„","SR");Array.isArray(e)&&e.length&&(o=e.map(p=>{const h=p?.recordedAt?mt(p.recordedAt):c("common.placeholder.empty","â€”","â€”"),f=Number.isFinite(Number(p?.amount))&&Number(p.amount)>0?`${X(Number(p.amount).toFixed(2))} ${i}`:"",m=Number.isFinite(Number(p?.percentage))&&Number(p.percentage)>0?`${X(Number(p.percentage).toFixed(2))}%`:"",d=[h];return f&&d.push(f),m&&d.push(m),d.filter(Boolean).join(" â€¢ ")}).join(`
`));const u=o?` title="${Y(o)}"`:"";return{html:`<span class="reservation-chip status-${a}"${u}>${A(r)}</span>`,text:r}}function J(t){return X(String(t??"")).replace(/^[^A-Za-z0-9\u0600-\u06FF]+/,"").trim()||c("common.placeholder.empty","â€”","â€”")}function Lt(t){const e=mt(new Date).replace(/-/g,"");return`${c("reservations.reports.export.filePrefix","ØªÙ‚Ø±ÙŠØ±-Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª","reservations-report")}-${e}.${t}`}function Ee(t,e,r){const s=new Blob([t],{type:r}),a=URL.createObjectURL(s),o=document.createElement("a");o.href=a,o.download=e,document.body.appendChild(o),o.click(),document.body.removeChild(o),setTimeout(()=>URL.revokeObjectURL(a),4e3)}function dt(t){if(!t||!t.length)return;const e=Object.keys(t[0]),r=[e.join(",")];t.forEach(a=>{const o=e.map(i=>`"${String(a[i]??"").replace(/"/g,'""')}"`);r.push(o.join(","))});const s=`\uFEFF${r.join(`\r
`)}\r
`;Ee(s,Lt("csv"),"text/csv;charset=utf-8;")}async function Ce(t){try{const e=await qt();if(!e){dt(t);return}const r=e.utils.json_to_sheet(t),s=e.utils.book_new(),a=c("reservations.reports.export.sheetName","Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª","Reservations");e.utils.book_append_sheet(s,r,a),e.writeFile(s,Lt("xlsx"))}catch(e){console.error("âš ï¸ [reports] Excel export failed, falling back to CSV",e),dt(t)}}async function $e(t=[],e={}){const{exportReportsPdf:r}=await K(async()=>{const{exportReportsPdf:a}=await import("./pdfPages.DYTU5-fU.js");return{exportReportsPdf:a}},__vite__mapDeps([0,1,2,3,4,5,6,7]),import.meta.url),s=e?.action==="print"?"print":"save";await r(t,{action:s})}async function we(t,e){switch(t){case"pdf":await $e(e);break;case"excel":await Ce(e);break;case"csv":default:dt(e);break}}function Ae(t){const e=document.getElementById("reports-top-customers");if(e){if(!t||t.length===0){e.innerHTML=`<tr><td colspan="3" class="text-base-content/60">${c("reservations.reports.table.emptyPeriod","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©.","No data for this period.")}</td></tr>`;return}e.innerHTML=t.map(r=>`
      <tr class="hover:bg-base-200 cursor-pointer" data-drilldown="customer" data-search="${Y(r.name)}">
        <td>${A(r.name)}</td>
        <td>${S(r.count)}</td>
        <td>${y(r.revenue)}</td>
      </tr>
    `).join("")}}function Le(t){const e=document.getElementById("reports-top-equipment");if(e){if(!t||t.length===0){e.innerHTML=`<tr><td colspan="3" class="text-base-content/60">${c("reservations.reports.table.emptyPeriod","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©.","No data for this period.")}</td></tr>`;return}e.innerHTML=t.map(r=>`
      <tr class="hover:bg-base-200 cursor-pointer" data-drilldown="equipment" data-search="${Y(r.name)}">
        <td>${A(r.name)}</td>
        <td>${S(r.count)}</td>
        <td>${y(r.revenue)}</td>
      </tr>
    `).join("")}}function Te(t){const e=document.getElementById("reports-equipment-costs");if(e){if(!t||t.length===0){e.innerHTML=`<tr><td colspan="6" class="text-base-content/60">${c("reservations.reports.table.emptyPeriod","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©.","No data for this period.")}</td></tr>`;return}e.innerHTML=t.map(r=>`
      <tr class="hover:bg-base-200">
        <td>${A(r.name)}</td>
        <td>${S(r.quantity)}</td>
        <td>${S(r.days??0)}</td>
        <td>${y(r.billable)}</td>
        <td>${y(r.cost)}</td>
        <td>${y(r.net)}</td>
      </tr>
    `).join("")}}function Me(t){const e=document.getElementById("reports-crew-work");if(e){if(!t||t.length===0){e.innerHTML=`<tr><td colspan="5" class="text-base-content/60">${c("reservations.reports.table.emptyPeriod","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©.","No data for this period.")}</td></tr>`;return}e.innerHTML=t.map(r=>`
      <tr class="hover:bg-base-200 cursor-pointer" data-drilldown="technician" data-search="${Y(r.name)}">
        <td>${A(r.name)}</td>
        <td>${S(r.days)}</td>
        <td>${y(r.billable)}</td>
        <td>${y(r.cost)}</td>
        <td>${y(r.billable-r.cost)}</td>
      </tr>
    `).join("")}}function Ie(t){const e=document.getElementById("reports-payment-forecast");if(e){if(!t||t.length===0){e.innerHTML=`<tr><td colspan="3" class="text-base-content/60">${c("reservations.reports.table.emptyPeriod","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©.","No data for this period.")}</td></tr>`;return}e.innerHTML=t.map(r=>`
      <tr>
        <td>${r.date}</td>
        <td>${c("reservations.reports.forecast.count","{count} Ø­Ø¬ÙˆØ²Ø§Øª","{count} reservations").replace("{count}",String(r.count||0))}</td>
        <td>${y(r.amount||0)}</td>
      </tr>
    `).join("")}}function Pe(t){const e=document.getElementById("reports-top-outstanding");if(e){if(!t||t.length===0){e.innerHTML=`<tr><td colspan="3" class="text-base-content/60">${c("reservations.reports.table.emptyPeriod","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©.","No data for this period.")}</td></tr>`;return}e.innerHTML=t.map(r=>`
      <tr class="hover:bg-base-200 cursor-pointer" data-drilldown="reservation" data-search="${Y(r.code)}">
        <td>#${A(String(r.code))} â€” ${A(r.customer||"")}</td>
        <td>${A(St(r.paidStatus))}</td>
        <td>${y(r.outstanding)}</td>
      </tr>
    `).join("")}}function De(t,e=[]){const r=document.getElementById("reports-maintenance-costs");if(!r)return;const s=Array.isArray(t?.items)?t.items:[],a=Array.isArray(e)?e:[];if(!s.length){r.innerHTML=`<tr><td colspan="5" class="text-base-content/60">${c("reservations.reports.table.emptyPeriod","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©.","No data for this period.")}</td></tr>`;return}const o=c("reservations.reports.maintenance.noEquipment","Ù…Ø¹Ø¯Ø© ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ©","Unknown equipment"),i=c("reservations.reports.maintenance.noStatus","ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©","Not specified"),u=p=>{if(!p)return 0;const h=new Date(p).getTime();return Number.isFinite(h)?h:0},g=s.map(p=>{const h=a.find(v=>String(v.id)===String(p.id)),f=h?.equipmentDesc||h?.equipmentBarcode||o,m=h?.statusLabel||h?.status||i,d=h?.equipmentBarcode||"";return{...p,equipment:f,status:m,barcode:d}}).sort((p,h)=>u(h?.date)-u(p?.date));r.innerHTML=g.map(p=>{const h=p?.id!=null?`#${A(String(p.id))}`:c("common.placeholder.empty","â€”","â€”"),f=p?.date?mt(p.date):c("common.placeholder.empty","â€”","â€”"),m=A(p.equipment||o),d=A(p.status||i),v=p.barcode?`<div class="text-xs text-base-content/70">${A(p.barcode)}</div>`:"";return`
        <tr>
          <td>${h}</td>
          <td>${m}${v}</td>
          <td>${d}</td>
          <td>${f}</td>
          <td>${y(p.cost||0)}</td>
        </tr>
      `}).join("")}const x=n.filters;function Re(t){if(n.columnControlsBound)return;const e=document.getElementById("reports-column-controls");e&&(e.querySelectorAll("input[data-column-toggle]").forEach(r=>{const s=r.dataset.columnToggle;s&&(r.checked=n.columnPreferences[s]!==!1,r.addEventListener("change",()=>{n.columnPreferences[s]=r.checked,t()}))}),n.columnControlsBound=!0,t())}function Tt(){Object.entries(n.columnPreferences).forEach(([t,e])=>{document.querySelectorAll(`[data-report-column="${t}"]`).forEach(r=>{r.classList.toggle("hidden",!e)})})}function Be(t){if(n.exportHandlersBound)return;const e=document.querySelectorAll("[data-export]");e.length&&(e.forEach(r=>{r.addEventListener("click",async()=>{const{export:s=""}=r.dataset;if(s){r.disabled=!0;try{await t(s)}catch(a){console.error("âš ï¸ [reports] export failed",a)}finally{r.disabled=!1}}})}),n.exportHandlersBound=!0)}function qe(t,e){n.searchDebounceTimer&&(clearTimeout(n.searchDebounceTimer),n.searchDebounceTimer=null),n.searchDebounceTimer=setTimeout(()=>{x.search=t||"",e()},220)}function Ne(t,e){t&&(x.range="custom",x.start=t.startInput||null,x.end=t.endInput||null,e())}function Fe(t,e){t&&(x.status=x.status===t?"all":t,e())}function _e(t,e){t&&(x.payment=x.payment===t?"all":t,e())}function He(t,e){t&&(x.search=t,e())}function je({onClear:t}={}){const e=document.getElementById("reservations-active-filters");if(!e)return;const r=[],s=(a,o,i)=>{r.push(`<span class="filter-chip" data-chip="${a}">${o} <button type="button" aria-label="clear" data-clear="${a}">âœ•</button></span>`)};if(x.range&&x.range!=="all"||x.start||x.end){let a="";switch(x.range){case"thisWeek":a=c("reservations.reports.filters.range.thisWeek","Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹","This week");break;case"thisMonth":a=c("reservations.reports.filters.range.thisMonth","Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±","This month");break;case"thisQuarter":a=c("reservations.reports.filters.range.thisQuarter","Ù‡Ø°Ø§ Ø§Ù„Ø±Ø¨Ø¹","This quarter");break;case"thisYear":a=c("reservations.reports.filters.range.thisYear","Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø§Ù…","This year");break;case"custom":default:a=`${c("reservations.reports.filters.range.custom","Ù…Ø®ØµØµ","Custom")} (${x.start||c("common.placeholder.empty","â€”","â€”")} â†’ ${x.end||c("common.placeholder.empty","â€”","â€”")})`}s("range",a)}if(x.status&&x.status!=="all"){const a=c(`reservations.reports.filters.status.${x.status}`,x.status,x.status);s("status",a)}if(x.payment&&x.payment!=="all"){const a=c(`reservations.reports.filters.payment.${x.payment}`,x.payment,x.payment);s("payment",a)}if(x.share&&x.share!=="all"){const a=c(`reservations.reports.filters.share.${x.share}`,x.share,x.share);s("share",a)}x.search&&x.search.trim().length&&s("search",`ğŸ” ${x.search.trim()}`),e.innerHTML=r.join(""),e.querySelectorAll("[data-clear]").forEach(a=>{a.addEventListener("click",()=>{const o=a.dataset.clear;o&&(o==="range"?(x.range="all",x.start=null,x.end=null):o in x&&(o==="search"?x.search="":x[o]="all"),t?.(o))})})}function ze(t=[],e=[]){const r=document.getElementById("reports-quick-chips");if(!r)return;const s=Array.isArray(t)?t:[],a=Array.isArray(e)?e:[],o=x.status||"all",i=x.payment||"all",u=(m,d,v,k,C)=>`<button type="button" class="${`chip ${C?"chip-active":""}`}" data-quick-${k}="${m}" title="${d}">${d} <span class="chip-count">${v}</span></button>`,g=(m,d)=>m.find(v=>(v.filterKey||"").toLowerCase()===d),p=[];["confirmed","completed"].forEach(m=>{const d=g(s,m)||{label:m,rawCount:0};p.push(u(m,d.label||m,d.rawCount||0,"status",o===m))}),p.push('<span style="padding:0 6px;opacity:.6;">|</span>'),["paid","partial","unpaid"].forEach(m=>{const d=g(a,m)||{label:m,rawCount:0};p.push(u(m,d.label||m,d.rawCount||0,"payment",i===m))}),r.innerHTML=p.join("")}const l=n.filters,Oe=new Set(["all","confirmed","completed"]);function Mt(t){const e=t||"all";return Oe.has(e)?e:"all"}function ht(){l.status=Mt(l.status)}function ft(){const t={range:l.range,status:l.status,payment:l.payment,share:l.share,search:(l.search||"").trim(),start:l.start,end:l.end};return JSON.stringify(t)}function Q(){try{const t=document.querySelector(".dashboard-header"),e=Math.max(0,Math.round(t?.getBoundingClientRect()?.height||64));document.documentElement.style.setProperty("--reports-sticky-offset",`${e}px`)}catch{}}const It="reports.presets.v1";function rt(){try{const t=JSON.parse(localStorage.getItem(It)||"[]");return Array.isArray(t)?t:[]}catch{return[]}}function vt(t){try{localStorage.setItem(It,JSON.stringify(Array.isArray(t)?t:[]))}catch{}}function Ue(t){if(!t||!t.filters)return;const e=t.filters;l.range=e.range??l.range,l.status=e.status??l.status,l.payment=e.payment??l.payment,l.share=e.share??l.share,l.search=e.search??"",l.start=e.start??null,l.end=e.end??null,N(),D(),P()}function it(){const t=document.getElementById("reports-preset-select");if(!t)return;const e=rt();t.innerHTML='<option value="">â€”</option>'+e.map((r,s)=>`<option value="${s}">${r.name||"Preset"}</option>`).join("")}function We(){const t=document.getElementById("reports-preset-select"),e=document.getElementById("reports-preset-save"),r=document.getElementById("reports-preset-delete"),s=document.getElementById("reports-preset-share");!t||t.dataset.bound||(it(),t.addEventListener("change",()=>{const a=Number(t.value),o=rt();Number.isInteger(a)&&a>=0&&a<o.length&&Ue(o[a])}),e?.addEventListener("click",()=>{const a=window.prompt(c("reservations.reports.presets.savePrompt","Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù‚Ø§Ù„Ø¨","Enter preset name"),"Ù‚Ø§Ù„Ø¨");if(!a)return;const o=rt(),i={range:l.range,status:l.status,payment:l.payment,share:l.share,search:l.search||"",start:l.start||null,end:l.end||null},u=o.findIndex(g=>(g.name||"").toLowerCase()===a.toLowerCase());u>=0?o[u]={name:a,filters:i}:o.push({name:a,filters:i}),vt(o),it()}),r?.addEventListener("click",()=>{const a=Number(t.value),o=rt();!Number.isInteger(a)||a<0||a>=o.length||window.confirm(c("reservations.reports.presets.deleteConfirm","Ø­Ø°Ù Ø§Ù„Ù‚Ø§Ù„Ø¨ Ø§Ù„Ù…Ø®ØªØ§Ø±ØŸ","Delete selected preset?"))&&(o.splice(a,1),vt(o),it(),t.value="")}),s?.addEventListener("click",async()=>{try{D(),await new Promise(o=>setTimeout(o,140));const a=window.location.href;await(navigator.clipboard?.writeText?navigator.clipboard.writeText(a):Promise.reject()),console.log("[reports] Link copied")}catch{try{const o=document.createElement("a");o.href=window.location.href,o.target="_blank",document.body.appendChild(o),o.click(),o.remove()}catch{}}}),t.dataset.bound="true")}function bt(){gt(),_(),setTimeout(()=>{gt(),_(),ut(),Q()},0),ut(),Q()}let ct=null,lt=null;function _({refresh:t=!1}={}){ct&&clearTimeout(ct),ct=setTimeout(()=>{if(P(),t){const e=ft();ot({silent:!0,signature:e,autoRender:!0}).catch(()=>{})}},140)}function G(){_({refresh:!0})}function ut(t,e){if(!window.flatpickr)return;t&&(n.startDateInputRef=t),e&&(n.endDateInputRef=e);const r=n.startDateInputRef,s=n.endDateInputRef;if(!r&&!s)return;const a=Ve(),o=i=>{const u={dateFormat:"Y-m-d",allowInput:!0,disableMobile:!0,altInput:!1,...i};return a&&(u.locale=a),u};if(n.startDatePicker&&(n.startDatePicker.destroy(),n.startDatePicker=null),n.endDatePicker&&(n.endDatePicker.destroy(),n.endDatePicker=null),r&&(n.startDatePicker=window.flatpickr(r,o({onChange(i,u){l.start=u||null,l.start||l.end?l.range="custom":!l.end&&l.range==="custom"&&(l.range="all"),n.endDatePicker&&(i?.length?n.endDatePicker.set("minDate",i[0]):n.endDatePicker.set("minDate",null)),G()},onValueUpdate(i,u){l.start=u||null,l.start||l.end?l.range="custom":!l.end&&l.range==="custom"&&(l.range="all"),G()}}))),s&&(n.endDatePicker=window.flatpickr(s,o({onChange(i,u){l.end=u||null,l.start||l.end?l.range="custom":!l.start&&l.range==="custom"&&(l.range="all"),n.startDatePicker&&(i?.length?n.startDatePicker.set("maxDate",i[0]):n.startDatePicker.set("maxDate",null)),G()},onValueUpdate(i,u){l.end=u||null,l.start||l.end?l.range="custom":!l.start&&l.range==="custom"&&(l.range="all"),G()}}))),n.startDatePicker&&r){n.startDatePicker.setDate(r.value,!1);const i=n.endDatePicker?.selectedDates?.[0]||n.endDateInputRef?.value;i&&n.startDatePicker.set("maxDate",i)}if(n.endDatePicker&&s){n.endDatePicker.setDate(s.value,!1);const i=n.startDatePicker?.selectedDates?.[0]||n.startDateInputRef?.value;i&&n.endDatePicker.set("minDate",i)}}function Ve(){return(se()||"ar").toLowerCase().startsWith("ar")?window.flatpickr?.l10ns?.ar?"ar":null:window.flatpickr?.l10ns?.en?"en":null}function pt(t,e){t&&(t.classList.add("active"),t.classList.remove("hidden"))}function N(){ht();const t=document.getElementById("reports-range"),e=document.getElementById("reports-status-filter"),r=document.getElementById("reports-payment-filter"),s=document.getElementById("reports-share-filter"),a=document.getElementById("reports-search"),o=document.getElementById("reports-start"),i=document.getElementById("reports-end"),u=document.getElementById("reports-custom-range");t&&t.value!==l.range&&(t.value=l.range),e&&e.value!==l.status&&(e.value=l.status),r&&r.value!==l.payment&&(r.value=l.payment),s&&s.value!==l.share&&(s.value=l.share),a&&a.value!==l.search&&(a.value=l.search||""),o&&o.value!==(l.start||"")&&(o.value=l.start||""),i&&i.value!==(l.end||"")&&(i.value=l.end||""),pt(u)}function Ge(){try{const t=new URLSearchParams(window.location.search),e=s=>t.get(s),r=s=>s==null||s===""?null:s;l.range=e("range")||l.range,l.status=e("status")||l.status,l.payment=e("payment")||l.payment,l.share=e("share")||l.share,l.search=e("search")||"",l.start=r(e("start")),l.end=r(e("end")),(l.start||l.end)&&(l.range="custom"),ht()}catch{}}function D(){lt&&clearTimeout(lt),lt=setTimeout(()=>{try{const t=new URLSearchParams,e=(a,o,i)=>{o!=null&&o!==""&&o!==i&&t.set(a,o)};e("range",l.range,"all"),e("status",l.status,"all"),e("payment",l.payment,"all"),e("share",l.share,"all"),e("search",l.search,""),e("start",l.start,null),e("end",l.end,null);const r=t.toString(),s=r?`${location.pathname}?${r}`:location.pathname;window.history.replaceState({},"",s)}catch{}},120)}function Pt({active:t,icon:e,title:r,subtitle:s}){const a=document.getElementById("reports-empty-state");if(!a)return;const o=a.querySelector(".reports-empty-icon"),i=a.querySelector("h4"),u=a.querySelector("p");n.emptyDefaults.icon===null&&o&&(n.emptyDefaults.icon=o.textContent),n.emptyDefaults.title===null&&i&&(n.emptyDefaults.title=i.textContent),n.emptyDefaults.subtitle===null&&u&&(n.emptyDefaults.subtitle=u.textContent),a.classList.toggle("active",!!t),a.classList.toggle("hidden",!t),!(!o||!i||!u)&&(t?(o.textContent=e!==void 0?e:n.emptyDefaults.icon??o.textContent,i.textContent=r!==void 0?r:n.emptyDefaults.title??i.textContent,u.textContent=s!==void 0?s:n.emptyDefaults.subtitle??u.textContent):(o.textContent=n.emptyDefaults.icon??o.textContent,i.textContent=n.emptyDefaults.title??i.textContent,u.textContent=n.emptyDefaults.subtitle??u.textContent))}function Ye(t){Pt({active:!!t})}function xt(t){const e=document.getElementById("reports-kpi-skeleton"),r=document.getElementById("reservations-reports-kpis"),s=document.getElementById("reports-table-skeleton"),a=document.getElementById("reports-reservations-table"),o=document.getElementById("reservations-revenue-skeleton"),i=document.getElementById("reservations-revenue-breakdown");e&&r&&(e.style.display=t?"":"none",r.style.opacity=t?"0.4":"1"),s&&a&&(s.style.display=t?"":"none",a.style.opacity=t?"0.4":"1"),o&&i&&(o.style.display=t?"":"none",i.style.opacity=t?"0.4":"1")}function Ke(){if(n.drilldownBound)return;const t=document.getElementById("reports-top-customers"),e=document.getElementById("reports-top-equipment"),r=document.getElementById("reports-reservations-body"),s=document.getElementById("reports-quick-chips"),a=o=>{const i=o.target?.closest("[data-drilldown]");if(!i)return;const u=i.dataset.search||"";He(u,()=>{N(),P()})};t?.addEventListener("click",a),e?.addEventListener("click",a),r?.addEventListener("click",a),s?.addEventListener("click",o=>{const i=o.target?.closest("[data-quick-status], [data-quick-payment]");if(i){if(i.hasAttribute("data-quick-status")){const u=i.getAttribute("data-quick-status")||"all";l.status=l.status===u?"all":u}else if(i.hasAttribute("data-quick-payment")){const u=i.getAttribute("data-quick-payment")||"all";l.payment=l.payment===u?"all":u}N(),D(),P()}}),n.drilldownBound=!0}function V(){const t=ft();ot({silent:!0,signature:t,autoRender:!0}).catch(e=>{console.error("âŒ [reports] Background refresh failed",e)})}function P(){if(ht(),N(),D(),je({onClear:()=>{N(),D(),P()}}),n.loading){xt(!0);return}if(n.errorMessage){Pt({active:!0,icon:"âš ï¸",title:n.errorMessage,subtitle:c("reservations.reports.status.retry","Ø¬Ø±Ù‘Ø¨ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø£Ùˆ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©.")});return}xt(!1);const{reservations:t,customers:e,equipment:r,technicians:s,maintenance:a}=n.data,o=Nt(t,l,e,r,s),i=Ft(o),u=_t(a,l),g=Ht(i,u.total),p=jt(o),h=zt(o),f=Ot(o),m=Ut(o),d=Wt(o,e),v=Vt(o,r),k=Gt(o,s),C=Yt(o),L=Kt(o),$=Jt(o,e,5);me(g),le(p),de(h),pe(f),ue(m),ze(h,m),Ae(d),Le(v),Te(C),Pe($),Me(k),De(u,a);try{Ie(L)}catch{}const E=he(o,e,s);Tt(),Ye(o.length===0),n.lastSnapshot.filtered=o,n.lastSnapshot.metrics=g,n.lastSnapshot.trend=p,n.lastSnapshot.statusBreakdown=h,n.lastSnapshot.paymentBreakdown=m,n.lastSnapshot.tableRows=E,n.lastSnapshot.maintenance=u,n.lastSnapshot.outstanding=$,n.lastSnapshot.crewWork=k,n.lastSnapshot.equipmentCosts=C,n.lastSnapshot.paymentForecast=L}function rn(){if(n.initialized)return;n.initialized=!0;const t=document.getElementById("reports-range"),e=document.getElementById("reports-status-filter"),r=document.getElementById("reports-payment-filter"),s=document.getElementById("reports-share-filter"),a=document.getElementById("reports-start"),o=document.getElementById("reports-end"),i=document.getElementById("reports-custom-range"),u=document.getElementById("reports-search");if(!t)return;Ge(),N(),Q(),ce()&&P(),t.addEventListener("change",()=>{l.range=t.value,pt(i),l.range!=="custom"&&(l.start=null,l.end=null),D(),_({refresh:!0})}),e?.addEventListener("change",()=>{l.status=Mt(e.value),e.value=l.status,D(),_()}),r?.addEventListener("change",()=>{l.payment=r.value,D(),_()}),s?.addEventListener("change",()=>{l.share=s.value,D(),_()}),u?.addEventListener("input",()=>{const f=u.value||"";qe(f,()=>{N(),D(),_()})}),a?.addEventListener("change",()=>{l.start=a.value||null,(l.start||l.end)&&(l.range="custom"),D(),G()}),o?.addEventListener("change",()=>{l.end=o.value||null,(l.start||l.end)&&(l.range="custom"),D(),G()}),ut(a,o),pt(i),We(),n.languageListenerAttached||(document.addEventListener("language:changed",bt),document.addEventListener("language:translationsReady",bt),n.languageListenerAttached=!0),n.dataListenersAttached||(document.addEventListener("reservations:changed",V),document.addEventListener("customers:changed",V),document.addEventListener("equipment:changed",V),document.addEventListener("projects:changed",V),document.addEventListener("technicians:updated",V),window.addEventListener("maintenance:updated",V),n.dataListenersAttached=!0),Re?.(Tt),Be(async f=>{const m=n.lastSnapshot.tableRows||[];if(!m.length){console.warn("[reports] No reservation data to export");return}if(f==="pdf")try{const{exportA4ReportPdf:d}=await K(async()=>{const{exportA4ReportPdf:v}=await import("./a4Unified.Dl4l-Lzg.js");return{exportA4ReportPdf:v}},__vite__mapDeps([8,1,2,3,4,5]),import.meta.url);await d(m,{action:"save",strict:!0});return}catch(d){console.warn("[reports] page-based PDF export failed, falling back to legacy",d)}else if(f==="excel")try{const{exportA4ReportExcel:d}=await K(async()=>{const{exportA4ReportExcel:v}=await import("./a4Unified.Dl4l-Lzg.js");return{exportA4ReportExcel:v}},__vite__mapDeps([8,1,2,3,4,5]),import.meta.url);await d(m);return}catch(d){console.warn("[reports] A4-based Excel export failed, falling back to legacy",d)}else if(f==="csv")try{const{exportA4ReportCsv:d}=await K(async()=>{const{exportA4ReportCsv:v}=await import("./a4Unified.Dl4l-Lzg.js");return{exportA4ReportCsv:v}},__vite__mapDeps([8,1,2,3,4,5]),import.meta.url);await d(m);return}catch(d){console.warn("[reports] A4-based CSV export failed, falling back to legacy",d)}await we(f,m)});const p=document.getElementById("reports-preview-pdf");if(p&&!p.dataset.bound&&(p.addEventListener("click",async()=>{try{const f=await K(()=>import("./preview.Cnfz6Ks6.js"),__vite__mapDeps([9,1,2,3,4,5,8]),import.meta.url),m=n.lastSnapshot.tableRows||[];f.openReportsPdfPreview(m)}catch(f){console.error("âš ï¸ [reports] Failed to open PDF preview",f)}}),p.dataset.bound="true"),Ke(),n.themeListenerAttached||(document.addEventListener("theme:changed",()=>{setTimeout(()=>{P(),Q()},0)}),n.themeListenerAttached=!0),!n.stickyOffsetListenerAttached){const f=()=>Q();window.addEventListener("resize",f),setTimeout(f,100),setTimeout(f,500),n.stickyOffsetListenerAttached=!0}Qt(P),Xt(()=>{P()}),Zt(()=>{P()}),te(f=>{Ne(f,()=>{N(),P()})}),ee(f=>{Fe(f?.filterKey,()=>{N(),P()})}),ne(f=>{_e(f?.filterKey,()=>{N(),P()})});const h=ft();ot({signature:h}).catch(f=>{console.error("âŒ [reports] Failed to initialise reports data",f)})}export{rn as initReports,P as renderReports};
