const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./reservationsActions.6LSYyEm0.js","./auth.CCQxMlul.js","./auth.YjxhaAY7.css","./reservationsService.BZ_B5ddX.js","./technicians.DG4ImpgD.js","./uiBridge.BQ-CIM1z.js"])))=>i.map(i=>d[i]);
import{b as f,s as m,g as p,l as v,c as h,d as i,a as R,i as y,h as b,f as E,u as c,j as w,p as g}from"./controller.CjbY0Odr.js";import{n as J,m as Q,o as W,q as X,k as Z}from"./controller.CjbY0Odr.js";import{_ as I}from"./technicians.DG4ImpgD.js";import{i as T,j as _}from"./reservationsService.BZ_B5ddX.js";import{d as l,t as k}from"./auth.CCQxMlul.js";import{e as C}from"./reservationsActions.6LSYyEm0.js";import{ensureProjectsLoaded as F}from"./projectsService.Ze40Q0O8.js";import"./uiBridge.BQ-CIM1z.js";import"./quotePdf.WC1ebubv.js";import"./canvasColorUtils.CviLtv6S.js";let o=!1;function S(){document.querySelectorAll('input[type="time"]').forEach(t=>{t.setAttribute("step","300")})}function L(){return typeof window<"u"&&typeof window.flatpickr=="function"?window.flatpickr.bind(window):typeof globalThis<"u"&&typeof globalThis.flatpickr=="function"?globalThis.flatpickr.bind(globalThis):(console.warn("⚠️ Flatpickr غير متاح - سيتم تخطي تهيئة عناصر التاريخ"),null)}function A(){const e=L(),t={dateFormat:"Y-m-d",altInput:!0,altFormat:"Y-m-d",allowInput:!0,disableMobile:!0,altInputClass:"flatpickr-alt-input form-control"},n=[["#res-start",{}],["#res-end",{}],["#filter-start-date",{}],["#filter-end-date",{}],["#edit-res-start",{}],["#edit-res-end",{}]],r={enableTime:!0,noCalendar:!0,dateFormat:"H:i",altInput:!0,altFormat:"h:i K",time_24hr:!1,defaultHour:9,defaultMinute:0,disableMobile:!0,minuteIncrement:5,altInputClass:"flatpickr-alt-input form-control"},s=["#res-start-time","#res-end-time","#edit-res-start-time","#edit-res-end-time"];e&&(n.forEach(([a,u])=>{document.querySelector(a)&&e(a,{...t,...u})}),s.forEach(a=>{document.querySelector(a)&&e(a,{...r})}));const d=document.querySelector("#res-start-time");d&&d.dispatchEvent(new Event("change",{bubbles:!0}))}function q(){if(!o){S(),f(()=>i()),m(p()),T({onDraftChange:()=>{w();try{g()}catch{}},onEditChange:c}),v(),h(),o=!0;try{const e=()=>i();document.addEventListener("reservations:updated",e),window.addEventListener("reservations:updated",e)}catch{}}}function D(){const e=document.body;e&&e.dataset.reservationsTechListener!=="true"&&(document.addEventListener("technicians:updated",()=>{const{technicians:t=[]}=l();_(t),E(),c()}),e.dataset.reservationsTechListener="true")}function P(){try{const{reservations:e=[]}=l();return Array.isArray(e)&&e.length>0}catch{return!1}}function j(){const e=document.getElementById("reservations-list");if(!e||e.querySelector("[data-reservations-loader]"))return;const t=document.createElement("div");t.className="reservations-inline-loader",t.setAttribute("data-reservations-loader","true"),t.setAttribute("aria-live","polite");const n=k("reservations.list.loading","جارٍ تحميل الحجوزات...");t.innerHTML=`
    <div class="loading loading-spinner loading-lg text-primary" aria-hidden="true"></div>
    <p class="reservations-inline-loader__text">${n}</p>
  `,e.replaceChildren(t)}function x(){const e=document.getElementById("reservations-list");if(!e)return;const t=e.querySelector("[data-reservations-loader]");t&&t.remove()}async function N(){if(P())try{i()}catch{}else j();const[t,n]=await Promise.allSettled([C(),F({force:!0})]);t.status==="rejected"&&console.warn("⚠️ [reservations/events] Failed to load reservations from API",t.reason),n.status==="rejected"&&console.warn("⚠️ [reservations/events] Failed to pre-load projects for reservation form",n.reason),x();try{try{await(await I(()=>import("./reservationsActions.6LSYyEm0.js").then(s=>s.I),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url)).autoCloseExpiredStandaloneReservations?.()}catch(r){console.warn("⚠️ [reservations/events] auto-close standalone reservations skipped",r)}i()}catch(r){console.error("❌ [reservations/events] Failed to render reservations after load",r)}R(),y({onAfterSubmit:b}),o||q(),A(),D()}export{J as confirmReservation,Q as deleteReservation,p as getReservationsEditContext,b as handleReservationsMutation,y as initCreateReservationForm,N as initializeReservationUI,v as loadReservationForm,W as openReservationEditor,R as registerReservationGlobals,w as renderDraftReservationSummary,i as renderReservations,X as setFlatpickrValue,m as setupEditReservationModalEvents,h as setupEquipmentDescriptionInputs,q as setupReservationEvents,Z as showReservationDetails,c as updateEditReservationSummary};
