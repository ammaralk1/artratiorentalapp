import{s as l,g as m,l as f,a as p,b as i,r as v,i as h,h as b,c as R,u as o,d as w}from"./controller.CZdOCF2i.js";import{k as J,j as N,o as O,m as Q,f as W}from"./controller.CZdOCF2i.js";import{f as E}from"./constants.C1ukMqXE.js";import{k as y,l as k}from"./reservationsService.BCOrfu71.js";import{d as I}from"./auth.Cmln7owi.js";import{e as g}from"./reservationsActions.CMowEKtN.js";import{ensureProjectsLoaded as T}from"./projectsService.Yx4axacG.js";import"./details.CH9nEo-w.js";import"./state.C9op3oKW.js";import"./equipment.Bw96KC9p.js";import"./quotePdf.C2lQPEPC.js";import"./canvasColorUtils.CviLtv6S.js";import"./uiBridge.Dv6JMAlF.js";let n=!1;function F(){document.querySelectorAll('input[type="time"]').forEach(t=>{t.setAttribute("step","300")})}function C(){return typeof window<"u"&&typeof window.flatpickr=="function"?window.flatpickr.bind(window):typeof globalThis<"u"&&typeof globalThis.flatpickr=="function"?globalThis.flatpickr.bind(globalThis):(console.warn("⚠️ Flatpickr غير متاح - سيتم تخطي تهيئة عناصر التاريخ"),null)}function S(){const e=C(),t={dateFormat:"Y-m-d",altInput:!0,altFormat:"Y-m-d",allowInput:!0,disableMobile:!0,altInputClass:"flatpickr-alt-input form-control"},s=[["#res-start",{}],["#res-end",{}],["#filter-start-date",{}],["#filter-end-date",{}],["#edit-res-start",{}],["#edit-res-end",{}]],d={enableTime:!0,noCalendar:!0,dateFormat:"H:i",altInput:!0,altFormat:"h:i K",time_24hr:!1,defaultHour:9,defaultMinute:0,disableMobile:!0,minuteIncrement:5,altInputClass:"flatpickr-alt-input form-control"},c=["#res-start-time","#res-end-time","#edit-res-start-time","#edit-res-end-time"];e&&(s.forEach(([r,u])=>{document.querySelector(r)&&e(r,{...t,...u})}),c.forEach(r=>{document.querySelector(r)&&e(r,{...d})}));const a=document.querySelector("#res-start-time");a&&a.dispatchEvent(new Event("change",{bubbles:!0}))}function L(){if(!n){F(),E(()=>i()),l(m()),y({onDraftChange:w,onEditChange:o}),f(),p(),n=!0;try{const e=()=>i();document.addEventListener("reservations:updated",e),window.addEventListener("reservations:updated",e)}catch{}}}function D(){const e=document.body;e&&e.dataset.reservationsTechListener!=="true"&&(document.addEventListener("technicians:updated",()=>{const{technicians:t=[]}=I();k(t),R(),o()}),e.dataset.reservationsTechListener="true")}async function K(){await g();try{await T({force:!0})}catch(e){console.warn("⚠️ [reservations/events] Failed to pre-load projects for reservation form",e)}i(),v(),h({onAfterSubmit:b}),n||L(),S(),D()}export{J as confirmReservation,N as deleteReservation,m as getReservationsEditContext,b as handleReservationsMutation,h as initCreateReservationForm,K as initializeReservationUI,f as loadReservationForm,O as openReservationEditor,v as registerReservationGlobals,w as renderDraftReservationSummary,i as renderReservations,Q as setFlatpickrValue,l as setupEditReservationModalEvents,p as setupEquipmentDescriptionInputs,L as setupReservationEvents,W as showReservationDetails,o as updateEditReservationSummary};
