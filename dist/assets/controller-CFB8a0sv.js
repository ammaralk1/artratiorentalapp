import{w as Qs,e as M,t as r,n as p,j as g,y as Ys,f as te,k as gt,o as Xs,u as Gs}from"./auth-CXJ9BVF7.js";import{F as P,G as Ze,H as Ks,I as Ee,J as mt,K as yt,L as Js,M as Zs,N as Ie,O as de,P as qt,Q as en,R as Et,q as wt,S as It,T as tn,U as sn,s as Be,i as St,y as z,V as Ct,W as nn,X as an,Y as rn,d as ye,r as ae,c as xt,g as kt,Z as on,_ as cn,t as ln,C as dn,$ as un,a0 as mn,a1 as pn,a2 as vn,v as fn,x as hn}from"./projectsService-D4pKr09t.js";Qs({ar:{"dashboard.header.greeting":"👋 أهلاً بك في لوحة التحكم","dashboard.header.toggleLabel":"لوحة التحكم","dashboard.sidebar.title":"مركز التحكم","dashboard.sidebar.statsHeading":"ملخص اليوم","dashboard.sidebar.tabsHeading":"التبويبات","dashboard.sidebar.quickLinksHeading":"روابط سريعة","dashboard.hero.title":"مركز إدارة التأجير","dashboard.actions.addProject":"➕ إضافة مشروع","dashboard.metrics.projects.label":"المشاريع","dashboard.metrics.projects.caption":"مشاريع نشطة هذا الشهر","dashboard.metrics.reservations.label":"الحجوزات","dashboard.metrics.reservations.caption":"متابعة جدول الفعاليات","dashboard.metrics.equipment.label":"المعدات","dashboard.metrics.equipment.caption":"الأصول المتاحة حالياً","dashboard.metrics.technicians.label":"طاقم العمل","dashboard.metrics.technicians.caption":"أعضاء جاهزون للتكليف","dashboard.quickLinks.home":"الصفحة الرئيسية","dashboard.quickLinks.projects":"إدارة المشاريع","dashboard.quickLinks.reports":"تقارير المشاريع","dashboard.quickLinks.users":"إدارة المستخدمين","tabs.customers":"👤 العملاء","tabs.equipment":"🎥 المعدات","tabs.maintenance":"🛠️ الصيانة","tabs.technicians":"😎 طاقم العمل","tabs.reservations":"📅 الحجوزات","actions.close":"إغلاق","actions.cancel":"إلغاء","actions.goHome":"🏠 الرئيسية","customers.section.title":"📋 إدارة العملاء","customers.form.title":"إضافة / تعديل عميل","customers.form.hint":"حدّث بيانات العميل وسيتم مزامنتها مع الحجوزات والفواتير.","customers.form.labels.name":"👤 الاسم","customers.form.labels.phone":"📞 الجوال","customers.form.labels.email":"📧 البريد","customers.form.labels.address":"📍 العنوان","customers.form.labels.company":"🏢 الشركة","customers.form.labels.notes":"📝 الملاحظات","customers.form.placeholders.name":"اسم العميل","customers.form.placeholders.phone":"05xxxxxxxx","customers.form.placeholders.email":"example@email.com","customers.form.placeholders.address":"عنوان العميل","customers.form.placeholders.company":"اسم الشركة","customers.form.placeholders.notes":"معلومات إضافية أو تذكيرات","customers.form.actions.cancel":"إلغاء التعديل","customers.form.actions.submit":"➕ إضافة عميل","customers.form.actions.update":"💾 حفظ التعديل","customers.search.placeholder":"🔍 ابحث عن عميل بالاسم أو الجوال أو الشركة...","customers.table.headers.name":"👤 الاسم","customers.table.headers.phone":"📞 الجوال","customers.table.headers.company":"🏢 الشركة","customers.table.headers.notes":"📝 ملاحظات","customers.table.headers.actions":"⚙️ الإجراءات","customers.table.loading":"جاري التحميل...","customers.table.empty":"لا يوجد عملاء","customers.table.noResults":"لا توجد نتائج مطابقة","customers.actions.edit":"✏️ تعديل","customers.actions.delete":"🗑️ حذف","customers.toast.updateSuccess":"تم تحديث بيانات العميل بنجاح","customers.toast.createSuccess":"تمت إضافة العميل بنجاح","customers.toast.missingFields":"يرجى تعبئة الاسم ورقم الهاتف","customers.toast.deleteConfirm":"⚠️ هل أنت متأكد من حذف هذا العميل؟","customers.toast.deleteSuccess":"تم حذف العميل","equipment.section.title":"🎥 إدارة المعدات","equipment.actions.clearAll":"🗑️ مسح الكل","equipment.actions.uploadExcel":"📤 رفع من Excel","equipment.form.title":"إضافة معدة","equipment.form.hint":"أدخل بيانات المعدة ليتم حفظها ضمن قائمة المعدات.","equipment.form.labels.description":"📝 الوصف","equipment.form.placeholders.description":"وصف المعدة","equipment.form.labels.barcode":"🏷️ الباركود","equipment.form.placeholders.barcode":"الباركود","equipment.form.labels.price":"💵 السعر","equipment.form.placeholders.price":"0","equipment.form.labels.quantity":"🔢 الكمية","equipment.form.placeholders.quantity":"1","equipment.form.labels.image":"🖼️ رابط الصورة","equipment.form.placeholders.image":"https://...","equipment.form.labels.category":"📂 القسم","equipment.form.placeholders.category":"القسم","equipment.form.labels.subcategory":"📑 القسم الثانوي","equipment.form.placeholders.subcategory":"القسم الثانوي","equipment.form.labels.status":"⚙️ الحالة","equipment.form.options.available":"✅ متاح","equipment.form.options.booked":"📌 محجوز","equipment.form.options.maintenance":"🛠️ صيانة","equipment.form.options.retired":"📦 خارج الخدمة","equipment.form.actions.submit":"➕ إضافة معدة","equipment.filters.search":"🔍 ابحث عن معدة...","equipment.filters.status.all":"⚙️ كل الحالات","equipment.filters.category.all":"📂 كل الأقسام","equipment.filters.subcategory.all":"📑 كل الأقسام الثانوية","equipment.list.title":"📋 كل المعدات","equipment.list.loading":"⏳ جاري تحميل المعدات...","equipment.list.empty":"لا توجد معدات مسجلة بعد.","equipment.card.labels.description":"الوصف","equipment.card.labels.status":"الحالة","equipment.card.labels.alias":"الاسم","equipment.card.labels.quantity":"الكمية","equipment.card.labels.price":"السعر","equipment.card.labels.category":"القسم","equipment.card.labels.subcategory":"القسم الثانوي","equipment.card.labels.barcode":"الباركود","equipment.modal.title":"✏️ تعديل بيانات المعدة","equipment.modal.placeholders.image":"ضع رابط مباشر للصورة","equipment.modal.actions.cancel":"❌ إلغاء","equipment.modal.actions.save":"💾 حفظ التعديلات","equipment.toast.xlsxMissing":"⚠️ مكتبة Excel (XLSX) غير محملة. تحقق من الروابط في dashboard.html","equipment.toast.uploadSuccess":"✅ تم رفع المعدات بنجاح","equipment.toast.uploadEmpty":"⚠️ الملف لا يحتوي على بيانات يمكن استيرادها","equipment.toast.uploadFailed":"❌ حدث خطأ أثناء قراءة ملف الإكسل","equipment.toast.clearConfirm":"⚠️ هل أنت متأكد من حذف كل المعدات؟","equipment.toast.clearSuccess":"🗑️ تم مسح جميع المعدات","equipment.toast.deleteConfirm":"❌ هل أنت متأكد من حذف هذه المعدة؟","equipment.toast.deleteSuccess":"🗑️ تم حذف المعدة","equipment.toast.editSuccess":"✏️ تم تعديل بيانات المعدة","equipment.toast.addSuccess":"✅ تم إضافة المعدة","equipment.toast.updateSuccess":"✅ تم تحديث بيانات المعدة بنجاح","equipment.toast.missingFields":"⚠️ يرجى إدخال الوصف والباركود","equipment.toast.duplicateBarcode":"⚠️ هذا الباركود مستخدم مسبقًا","equipment.list.emptyFiltered":"⚠️ لا توجد معدات مطابقة.","equipment.list.countSuffix":"عنصر","equipment.item.imageAlt":"صورة","equipment.item.currency":"ريال","equipment.item.actions.edit":"✏️ تعديل","equipment.item.actions.delete":"🗑️ حذف","reservations.tabs.create":"➕ إنشاء حجز","reservations.tabs.mine":"📋 حجوزاتي","reservations.tabs.reports":"📊 تقارير","reservations.tabs.calendar":"📅 التقويم","reservations.create.title":"➕ إنشاء حجز جديد","reservations.create.labels.startDate":"📅 تاريخ البداية","reservations.create.labels.startTime":"⏰ وقت البداية","reservations.create.labels.endDate":"📅 تاريخ النهاية","reservations.create.labels.endTime":"⏰ وقت النهاية","reservations.create.labels.client":"👤 العميل","reservations.create.placeholders.client":"اكتب اسم العميل...","reservations.create.labels.project":"📁 المشروع المرتبط","reservations.create.placeholders.project":"اختر مشروعاً (اختياري)","reservations.create.labels.notes":"📝 ملاحظات","reservations.create.placeholders.notes":"اكتب أي ملاحظات إضافية...","reservations.create.equipment.title":"🎥 أضف المعدات","reservations.create.equipment.placeholders.barcode":"🔍 امسح أو أدخل الباركود ثم اضغط Enter","reservations.create.equipment.placeholders.description":"🎥 اكتب اسم المعدة ثم اضغط Enter","reservations.create.equipment.table.code":"الكود","reservations.create.equipment.table.description":"الوصف","reservations.create.equipment.table.price":"السعر","reservations.create.equipment.table.image":"الصورة","reservations.create.equipment.table.delete":"حذف","reservations.create.billing.title":"💵 الخصم والضريبة","reservations.create.billing.discount":"ادخل قيمة الخصم","reservations.create.billing.discountPercent":"٪ نسبة","reservations.create.billing.discountAmount":"💵 مبلغ","reservations.create.billing.companyShare":"🏦 نسبة الشركة","reservations.create.billing.companyShareToggle":"إضافة نسبة الشركة (10٪)","reservations.create.billing.taxLabel":"شامل الضريبة (15٪)","reservations.create.labels.paymentStatus":"💳 حالة الدفع","reservations.create.paymentStatus.paid":"مدفوع","reservations.create.paymentStatus.unpaid":"لم يتم الدفع","reservations.create.actions.submit":"💾 إنشاء الحجز","reservations.section.title":"📅 إدارة الحجوزات","reservations.crew.none":"لم يتم اختيار أي عضو من الطاقم.","reservations.crew.noneShort":"لم يتم اختيار أي عضو بعد","reservations.crew.selectedCount":"تم اختيار {count} عضو","reservations.crew.fallbackName":"عضو الطاقم {id}","reservations.crew.removeAria":"إزالة","reservations.crew.searchEmpty":"لا يوجد نتائج مطابقة.","reservations.create.equipment.noResults":"لا يوجد نتائج مطابقة.","reservations.create.equipment.noneAdded":"لا توجد معدات مضافة","reservations.create.equipment.none":"لا توجد معدات","reservations.create.summary.currency":"ريال","reservations.create.equipment.imageAlt":"صورة","reservations.summary.total":"💰 التكلفة الإجمالية: <strong>{total} {currency}</strong>","reservations.summary.totalAfterEdit":"💰 التكلفة بعد التعديل: <strong>{total} {currency}</strong>","reservations.summary.itemsCount":"📦 عدد المعدات: {count}","reservations.summary.crewCount":"😎 عدد الفريق: {count}","reservations.summary.companyShareLabel":"🏦 نسبة الشركة","reservations.summary.taxIncluded":"شامل الضريبة 15%","reservations.summary.taxExcluded":"غير شامل الضريبة","reservations.summary.paymentLabel":"💳 حالة الدفع: {status}","reservations.summary.itemsLabel":"📦 عدد المعدات","reservations.summary.durationLabel":"⏱️ عدد الأيام","reservations.summary.crewLabel":"😎 عدد الفريق","reservations.summary.taxLabelShort":"🧾 الضريبة","reservations.summary.paymentLabelShort":"💳 حالة الدفع","reservations.summary.taxIncludedValue":"شامل 15%","reservations.summary.taxExcludedValue":"غير شامل","reservations.summary.totalLabel":"💰 التكلفة الإجمالية","reservations.toast.customerNotFound":"⚠️ لم يتم العثور على العميل بالاسم المدخل","reservations.toast.invalidDateOrder":"⚠️ تاريخ البداية لا يمكن أن يكون بعد تاريخ النهاية","reservations.toast.reservationMissing":"⚠️ تعذر العثور على الحجز المطلوب","reservations.list.title":"📋 حجوزاتي","reservations.list.search.placeholder":"🔍 ابحث باسم العميل أو الكود...","reservations.list.filters.start":"📅 من تاريخ","reservations.list.filters.end":"📅 إلى تاريخ","reservations.list.filters.range.all":"⏱️ كل التواريخ","reservations.list.filters.range.today":"📅 اليوم","reservations.list.filters.range.week":"📆 هذا الأسبوع","reservations.list.filters.range.month":"🗓️ هذا الشهر","reservations.list.filters.status.all":"⚙️ كل الحالات","reservations.list.filters.status.confirmed":"✅ مؤكدة","reservations.list.filters.status.pending":"⏳ غير مؤكدة","reservations.list.filters.status.completed":"📁 منتهية","reservations.list.empty":"⚠️ لا توجد حجوزات بعد.","reservations.list.noResults":"🔍 لا توجد حجوزات مطابقة للبحث.","reservations.list.taxIncludedShort":"(شامل الضريبة)","reservations.list.unknownCustomer":"غير معروف","reservations.list.noNotes":"لا توجد ملاحظات","reservations.list.project.unlinked":"غير مرتبط بمشروع","reservations.list.itemsCountShort":"{count} عنصر","reservations.list.crew.separator":"، ","reservations.list.status.confirmed":"✅ مؤكد","reservations.list.status.pending":"⏳ غير مؤكد","reservations.list.payment.paid":"💳 مدفوع","reservations.list.payment.unpaid":"💳 غير مدفوع","reservations.list.status.completed":"📁 منتهي","reservations.list.ribbon.completed":"منتهي","reservations.list.actions.confirm":"✔️ تأكيد","reservations.list.labels.client":"👤 العميل","reservations.list.labels.project":"📁 المشروع","reservations.edit.modalTitle":"✏️ تعديل الحجز","reservations.edit.labels.id":"🆔 رقم الحجز","reservations.edit.labels.customer":"👤 العميل","reservations.edit.labels.project":"📁 المشروع المرتبط","reservations.edit.labels.startDate":"📅 تاريخ البداية","reservations.edit.labels.startTime":"⏰ وقت البداية","reservations.edit.labels.endDate":"📅 تاريخ النهاية","reservations.edit.labels.endTime":"⏰ وقت النهاية","reservations.edit.labels.discount":"💵 الخصم","reservations.edit.placeholders.discount":"ادخل قيمة الخصم","reservations.edit.discount.percent":"٪ نسبة","reservations.edit.discount.amount":"💵 مبلغ","reservations.edit.labels.tax":"شامل الضريبة (15%)","reservations.edit.labels.confirmed":"✅ تم التأكيد","reservations.edit.labels.paymentStatus":"💳 حالة الدفع","reservations.edit.payment.paid":"مدفوع","reservations.edit.payment.unpaid":"لم يتم الدفع","reservations.edit.labels.notes":"📝 الملاحظات","reservations.edit.placeholders.notes":"اكتب أي ملاحظات...","reservations.edit.labels.addEquipment":"🎥 إضافة معدة","reservations.edit.project.missing":"⚠️ المشروع غير متوفر (تم حذفه)","reservations.edit.placeholders.barcode":"🔍 امسح أو أدخل الباركود ثم اضغط Enter","reservations.edit.placeholders.description":"🎥 اكتب اسم المعدة ثم اضغط Enter","reservations.edit.table.headers.code":"الكود","reservations.edit.table.headers.description":"الوصف","reservations.edit.table.headers.price":"السعر","reservations.edit.table.headers.quantity":"الكمية","reservations.edit.table.headers.image":"الصورة","reservations.edit.table.headers.delete":"حذف","reservations.edit.table.empty":"لا توجد معدات","reservations.edit.actions.save":"💾 حفظ التعديلات","reservations.list.labels.start":"🗓️ بداية الحجز","reservations.list.labels.end":"🗓️ نهاية الحجز","reservations.list.labels.cost":"💵 التكلفة","reservations.list.labels.equipment":"📦 المعدات","reservations.list.labels.crew":"😎 الفريق","reservations.details.labels.discount":"الخصم","reservations.details.labels.companyShare":"🏦 نسبة الشركة","reservations.details.labels.subtotalAfterDiscount":"الإجمالي","reservations.details.labels.tax":"الضريبة (15%)","reservations.details.labels.crewTotal":"إجمالي الفريق","reservations.details.table.headers.code":"الكود","reservations.details.table.headers.description":"الوصف","reservations.details.table.headers.quantity":"الكمية","reservations.details.table.headers.price":"السعر","reservations.details.table.headers.image":"الصورة","reservations.details.noItems":"📦 لا توجد معدات ضمن هذا الحجز حالياً.","reservations.details.noCrew":"😎 لا يوجد فريق مرتبط بهذا الحجز.","reservations.details.project.unlinked":"غير مرتبط بأي مشروع.","reservations.details.technicians.roleUnknown":"غير محدد","reservations.details.technicians.phoneUnknown":"غير متوفر","reservations.details.technicians.wage":"{amount} {currency} / اليوم","reservations.details.labels.id":"🆔 رقم الحجز","reservations.details.section.bookingInfo":"بيانات الحجز","reservations.details.section.statusSummary":"ملخص الحالة","reservations.details.section.paymentSummary":"💳 ملخص الدفع","reservations.details.labels.finalTotal":"المجموع النهائي","reservations.details.section.crew":"😎 الفريق الفني","reservations.details.crew.count":"{count} عضو","reservations.details.section.items":"📦 المعدات المرتبطة","reservations.details.items.count":"{count} عنصر","reservations.details.actions.edit":"✏️ تعديل","reservations.details.actions.delete":"🗑️ حذف","reservations.details.actions.openProject":"📁 فتح المشروع","reservations.details.labels.customer":"العميل","reservations.details.labels.contact":"رقم التواصل","reservations.details.labels.project":"📁 المشروع المرتبط","reservations.details.labels.start":"بداية الحجز","reservations.details.labels.end":"نهاية الحجز","reservations.details.labels.notes":"ملاحظات","reservations.details.labels.itemsCount":"عدد المعدات","reservations.details.labels.itemsTotal":"إجمالي المعدات","reservations.details.labels.paymentStatus":"حالة الدفع","reservations.details.modalTitle":"📋 تفاصيل الحجز","reservations.calendar.title":"📅 التقويم","reservations.reports.title":"📊 تقارير الأداء","reservations.reports.subtitle":"نظرة شاملة على الحجوزات والإيرادات ونسب الإشغال خلال الفترة المحددة.","reservations.reports.filters.rangeLabel":"الفترة","reservations.reports.filters.range.last30":"آخر 30 يوم","reservations.reports.filters.range.thisWeek":"هذا الأسبوع","reservations.reports.filters.range.thisMonth":"هذا الشهر","reservations.reports.filters.range.thisQuarter":"هذا الربع","reservations.reports.filters.range.thisYear":"هذا العام","reservations.reports.filters.range.all":"كل الوقت","reservations.reports.filters.range.custom":"مخصص","reservations.reports.filters.startLabel":"من","reservations.reports.filters.endLabel":"إلى","reservations.reports.filters.statusLabel":"الحالة","reservations.reports.filters.status.all":"كل الحالات","reservations.reports.filters.status.confirmed":"مؤكدة","reservations.reports.filters.status.pending":"قيد التأكيد","reservations.reports.filters.status.completed":"منتهية","reservations.reports.filters.paymentLabel":"الدفع","reservations.reports.filters.payment.all":"الكل","reservations.reports.filters.payment.paid":"مدفوعة","reservations.reports.filters.payment.unpaid":"غير مدفوعة","reservations.reports.filters.searchLabel":"البحث","reservations.reports.filters.searchPlaceholder":"ابحث باسم العميل، رقم الحجز، أو المعدة...","reservations.reports.actions.refresh":"🔄 تحديث","reservations.reports.kpi.total.label":"إجمالي الحجوزات","reservations.reports.kpi.total.meta":"لم يتم تسجيل بيانات بعد","reservations.reports.kpi.revenue.label":"إجمالي الإيرادات","reservations.reports.kpi.revenue.meta":"متوسط الحجز —","reservations.reports.kpi.confirmation.label":"معدل التأكيد","reservations.reports.kpi.confirmation.meta":"الحجوزات المؤكدة —","reservations.reports.kpi.paid.label":"نسبة المدفوع","reservations.reports.kpi.paid.meta":"الحجوزات المدفوعة —","reservations.reports.kpi.total.dynamicMeta":"منها {count} منتهية","reservations.reports.kpi.revenue.average":"متوسط قيمة الحجز {value}","reservations.reports.kpi.confirmed.detail":"{count} حجوزات مؤكدة","reservations.reports.kpi.paid.detail":"{count} حجوزات مدفوعة","reservations.reports.status.confirmedLabel":"مؤكدة","reservations.reports.status.pendingLabel":"قيد التأكيد","reservations.reports.status.completedLabel":"منتهية","reservations.reports.payment.paidLabel":"مدفوعة","reservations.reports.payment.unpaidLabel":"غير مدفوعة","reservations.reports.progress.empty":"لا توجد بيانات لعرضها.","reservations.reports.progress.meta":"{count} حجز","reservations.reports.chart.volume.title":"📈 تطور الحجوزات","reservations.reports.chart.volume.hint":"آخر 6 أشهر","reservations.reports.chart.status.title":"📊 توزيع الحالات والدفع","reservations.reports.chart.status.hint":"نسب مئوية","reservations.reports.chart.status.statusLabel":"الحالات","reservations.reports.chart.status.paymentLabel":"الدفع","reservations.reports.topCustomers.title":"👥 أفضل العملاء","reservations.reports.topCustomers.hint":"حسب إجمالي الإيراد","reservations.reports.topCustomers.headers.customer":"العميل","reservations.reports.topCustomers.headers.count":"عدد الحجوزات","reservations.reports.topCustomers.headers.revenue":"الإيراد الكلي","reservations.reports.topCustomers.unknown":"عميل غير معروف","reservations.reports.table.empty":"لا توجد بيانات","reservations.reports.table.emptyPeriod":"لا توجد بيانات في هذه الفترة.","reservations.reports.results.title":"📄 تفاصيل الحجوزات","reservations.reports.results.hint":"أحدث الحجوزات المطابقة لعوامل التصفية","reservations.reports.results.headers.id":"الحجز","reservations.reports.results.headers.customer":"العميل","reservations.reports.results.headers.date":"التاريخ","reservations.reports.results.headers.status":"الحالة","reservations.reports.results.headers.payment":"الدفع","reservations.reports.results.headers.total":"الإجمالي","reservations.reports.topEquipment.title":"🎥 المعدات الأكثر استخدامًا","reservations.reports.topEquipment.hint":"عدد مرات الحجز","reservations.reports.topEquipment.headers.item":"المعدة","reservations.reports.topEquipment.headers.usage":"عدد مرات الاستخدام","reservations.reports.topEquipment.headers.revenue":"الإيراد المرتبط","reservations.reports.topEquipment.unknown":"معدة بدون اسم","reservations.reports.empty.title":"لا توجد بيانات ضمن المعايير الحالية","reservations.reports.empty.subtitle":"جرّب تغيير الفترة الزمنية أو إزالة عوامل التصفية لعرض نتائج أخرى.","calendar.buttons.today":"اليوم","calendar.buttons.month":"شهر","calendar.buttons.week":"أسبوع","calendar.buttons.day":"يوم","calendar.badges.confirmed":"مؤكد","calendar.badges.pending":"غير مؤكد","calendar.badges.paid":"مدفوع","calendar.badges.unpaid":"غير مدفوع","calendar.badges.completed":"منتهي","calendar.labels.unknownCustomer":"غير معروف","calendar.labels.unknownEquipment":"معدة بدون اسم","calendar.labels.currencySuffix":"ريال","calendar.labels.noEquipment":"لا توجد معدات","calendar.labels.noNotes":"لا توجد ملاحظات","calendar.labels.reservationId":"رقم الحجز","calendar.labels.customer":"العميل","calendar.labels.start":"بداية الحجز","calendar.labels.end":"نهاية الحجز","calendar.labels.notes":"الملاحظات","calendar.sections.crew":"😎 الفريق الفني","calendar.sections.equipment":"📦 المعدات","calendar.emptyStates.noCrew":"😎 لا يوجد فريق مرتبط بهذا الحجز.","calendar.table.headers.barcode":"الباركود","calendar.table.headers.description":"الوصف","calendar.table.headers.quantity":"الكمية","calendar.table.headers.price":"السعر","calendar.table.headers.image":"الصورة","calendar.summary.baseCost":"💵 إجمالي المعدات: <strong>{value} ريال</strong>","calendar.summary.discount":"💸 الخصم: <strong>{value}</strong>","calendar.summary.tax":"🧾 الضريبة (15%): <strong>{value} ريال</strong>","calendar.summary.total":"💰 المجموع النهائي: <strong>{value} ريال</strong>","calendar.alerts.cannotShowDetails":"لا يمكن عرض تفاصيل الحجز","calendar.alerts.cannotOpenModal":"لا يمكن فتح نافذة التفاصيل","calendar.modal.title":"📅 تفاصيل الحجز","reservations.toast.equipmentNameNotFound":"❌ لم يتم العثور على معدة بالاسم المدخل","reservations.toast.equipmentMaintenance":"⚠️ هذه المعدة قيد الصيانة ولا يمكن إضافتها حالياً","reservations.toast.equipmentMissingBarcode":"⚠️ هذه المعدة لا تحتوي على باركود معرف","reservations.toast.requireDatesBeforeAdd":"⚠️ يرجى تحديد تاريخ ووقت البداية والنهاية قبل إضافة المعدات","reservations.toast.equipmentDuplicate":"⚠️ هذه المعدة موجودة بالفعل في الحجز","reservations.toast.equipmentTimeConflict":"⚠️ لا يمكن إضافة المعدة لأنها محجوزة في نفس الفترة الزمنية","reservations.toast.equipmentMaintenanceStrict":"⚠️ لا يمكن إضافة معدة قيد الصيانة إلى الحجز","reservations.toast.requireOverallDates":"⚠️ يرجى تحديد تواريخ الحجز قبل إضافة المعدات","reservations.toast.equipmentTimeConflictSimple":"⚠️ هذه المعدة محجوزة في نفس الفترة الزمنية","reservations.toast.barcodeNotFound":"❌ الباركود غير موجود","reservations.toast.equipmentAdded":"✅ تم إضافة المعدة بنجاح","reservations.toast.barcodeNotInCatalog":"❌ الباركود غير موجود ضمن المعدات","reservations.toast.requireDates":"⚠️ يرجى تحديد تاريخ البداية والنهاية","reservations.toast.invalidDateRange":"⚠️ تأكد من أن تاريخ ووقت البداية يسبق تاريخ ووقت النهاية","reservations.toast.missingFields":"⚠️ تأكد من تعبئة جميع الحقول","reservations.toast.noItems":"⚠️ يجب إضافة معدة أو عضو واحد من الطاقم الفني على الأقل","reservations.toast.cannotCreateEquipmentMaintenance":"⚠️ لا يمكن إتمام الحجز لأن إحدى المعدات قيد الصيانة","reservations.toast.cannotCreateEquipmentConflict":"⚠️ لا يمكن إتمام الحجز، إحدى المعدات محجوزة في نفس الفترة الزمنية","reservations.toast.cannotCreateCrewConflict":"⚠️ لا يمكن إتمام الحجز، أحد أعضاء الطاقم مرتبط بحجز آخر في نفس الفترة","reservations.toast.projectNotFound":"⚠️ لم يتم العثور على المشروع المحدد. يرجى تحديث الصفحة أو اختيار مشروع آخر.","reservations.toast.technicianSelectionConflict":"⚠️ لا يمكن اختيار {names} لأنهم مرتبطون بحجز آخر في نفس الفترة الزمنية","reservations.toast.created":"✅ تم إنشاء الحجز","reservations.toast.notFound":"⚠️ تعذر العثور على بيانات الحجز","reservations.toast.updateNoItems":"⚠️ يجب إضافة معدة أو عضو واحد من الطاقم الفني على الأقل للحجز","reservations.toast.updateEquipmentMaintenance":"⚠️ لا يمكن حفظ التعديلات لأن إحدى المعدات قيد الصيانة","reservations.toast.updateEquipmentConflict":"⚠️ لا يمكن حفظ التعديلات بسبب تعارض في أحد المعدات","reservations.toast.updateCrewConflict":"⚠️ لا يمكن حفظ التعديلات بسبب تعارض في جدول أحد أعضاء الطاقم","reservations.toast.updated":"✅ تم حفظ التعديلات على الحجز","reservations.toast.confirmed":"✅ تم تأكيد الحجز","reservations.toast.confirmBlockedByProject":"⚠️ حالة هذا الحجز تتحكم بها حالة المشروع المرتبط ولا يمكن تأكيده من هنا","reservations.toast.deleteConfirm":"⚠️ هل أنت متأكد من حذف هذا الحجز؟","maintenance.section.title":"🛠️ إدارة الصيانة","maintenance.form.title":"➕ إنشاء تذكرة صيانة","maintenance.form.hint":"حدد المعدة المتضررة وسجّل المشكلة لإيقافها عن الاستخدام لحين الإصلاح.","maintenance.form.labels.barcode":"🏷️ الباركود","maintenance.form.placeholders.barcode":"🖨️ امسح أو أدخل الباركود ثم اضغط Enter","maintenance.form.labels.search":"🎥 البحث باسم المعدة","maintenance.form.placeholders.search":"اكتب اسم المعدة...","maintenance.form.labels.priority":"⚠️ الأولوية","maintenance.form.options.priority.high":"مرتفعة","maintenance.form.options.priority.medium":"متوسطة","maintenance.form.options.priority.low":"منخفضة","maintenance.form.selectedInfo":"لم يتم اختيار معدة بعد.","maintenance.form.labels.issue":"📝 وصف المشكلة","maintenance.form.placeholders.issue":"اشرح المشكلة أو الأعراض الظاهرة للمعدة","maintenance.form.actions.submit":"🛠️ إنشاء التذكرة","maintenance.form.blockedSuffix":"(صيانة)","maintenance.list.title":"📋 تذاكر الصيانة","maintenance.list.hint":"تابع حالة الأعطال وقم بإغلاق التذاكر بعد إتمام الإصلاح.","maintenance.filters.status.label":"الحالة","maintenance.filters.status.all":"كل الحالات","maintenance.filters.status.open":"قيد الصيانة","maintenance.filters.status.closed":"مغلقة","maintenance.table.headers.equipment":"المعدة","maintenance.table.headers.issue":"وصف المشكلة","maintenance.table.headers.priority":"الأولوية","maintenance.table.headers.created":"تاريخ الإنشاء","maintenance.table.headers.status":"الحالة","maintenance.table.headers.actions":"الإجراءات","maintenance.table.empty":"لا توجد تذاكر بعد.","maintenance.table.emptyFiltered":"لا توجد تذاكر ضمن هذا الفلتر.","maintenance.table.noName":"بدون اسم","maintenance.empty.title":"لا توجد تذاكر صيانة","maintenance.empty.subtitle":"عند إنشاء تذكرة جديدة ستظهر في هذه القائمة.","maintenance.table.noBarcode":"بدون باركود","maintenance.stats.open":"{count} قيد الصيانة","maintenance.stats.closed":"{count} مغلقة","maintenance.stats.total":"{count} إجمالي التذاكر","maintenance.status.open":"قيد الصيانة","maintenance.status.closed":"مغلقة","maintenance.status.inProgress":"قيد التنفيذ","maintenance.status.completed":"مكتملة","maintenance.status.cancelled":"ملغاة","maintenance.priority.high":"مرتفعة","maintenance.priority.medium":"متوسطة","maintenance.priority.low":"منخفضة","maintenance.actions.close":"🔧 إغلاق بعد الإصلاح","maintenance.actions.view":"👁️ عرض التقرير","maintenance.actions.delete":"🗑️ حذف التذكرة","maintenance.closeModal.title":"🔧 إغلاق تذكرة الصيانة","maintenance.closeModal.subtitle":"يرجى كتابة تقرير الإصلاح قبل إغلاق هذه التذكرة.","maintenance.closeModal.reportLabel":"📝 تقرير الإصلاح","maintenance.closeModal.reportPlaceholder":"اكتب تفاصيل الإصلاح والإجراءات المتخذة...","maintenance.closeModal.confirm":"✅ إغلاق التذكرة","maintenance.closeModal.cancel":"إلغاء","maintenance.closeModal.saving":"⏳ جاري الإغلاق...","maintenance.toast.equipmentBlocked":"⚠️ هذه المعدة قيد الصيانة ولا يمكن اختيارها حالياً","maintenance.toast.equipmentNotFoundBarcode":"❌ لم يتم العثور على معدة بهذا الباركود","maintenance.toast.equipmentNotFoundName":"❌ لم يتم العثور على معدة بالاسم المدخل","maintenance.toast.equipmentBecameBlocked":"⚠️ هذه المعدة أصبحت قيد الصيانة ولا يمكن اختيارها","maintenance.toast.selectEquipment":"⚠️ يرجى اختيار المعدة","maintenance.toast.selectedNotFound":"❌ لم يتم العثور على المعدة المختارة","maintenance.toast.equipmentAlreadyMaintenance":"⚠️ هذه المعدة بالفعل في حالة صيانة","maintenance.toast.ticketExists":"⚠️ توجد تذكرة صيانة مفتوحة لهذه المعدة","maintenance.toast.ticketCreated":"🛠️ تم إنشاء تذكرة الصيانة وإيقاف المعدة","maintenance.toast.storageError":"⚠️ تعذر حفظ بيانات الصيانة. يرجى المحاولة مجدداً.","maintenance.toast.submitError":"⚠️ تعذر إنشاء تذكرة الصيانة. يرجى المحاولة مجدداً.","maintenance.toast.loading":"⏳ يتم تحديث بيانات الصيانة، يرجى الانتظار لحظة...","maintenance.toast.ticketAlreadyClosed":"✅ تم تحديث التذاكر، ويبدو أن هذه التذكرة مغلقة مسبقاً","maintenance.toast.ticketClosed":"✅ تم إغلاق تذكرة الصيانة وإعادة المعدة إلى الحالة المتاحة","maintenance.toast.ticketDeleted":"🗑️ تم حذف تذكرة الصيانة","maintenance.toast.ticketDeleteConfirm":"⚠️ هل أنت متأكد من حذف تذكرة الصيانة؟","maintenance.toast.reportRequired":"⚠️ يرجى كتابة تقرير الإصلاح قبل الإغلاق","maintenance.prompt.closeReport":"أدخل تقرير الإصلاح / الإجراءات المتخذة:","maintenance.report.equipment":"المعدة","maintenance.report.barcode":"الباركود","maintenance.report.issue":"الوصف","maintenance.report.createdAt":"تاريخ الإنشاء","maintenance.report.closedAt":"تاريخ الإغلاق","maintenance.report.summary":"التقرير","maintenance.report.notAvailable":"غير متوفر","maintenance.report.none":"—","maintenance.info.barcodeLabel":"باركود","technicians.section.title":"😎 إدارة طاقم العمل","technicians.form.title":"إضافة / تعديل عضو طاقم","technicians.form.hint":"أدخل بيانات عضو الطاقم ليتم حفظها وتحديثها في سجلات الحجز.","technicians.form.labels.name":"😎 اسم العضو","technicians.form.labels.phone":"📞 الجوال","technicians.form.labels.role":"👔 الوظيفة","technicians.form.labels.department":"🧩 القسم","technicians.form.labels.wage":"💰 الأجر اليومي","technicians.form.labels.status":"⚙️ الحالة الأساسية","technicians.form.labels.notes":"📝 ملاحظات","technicians.form.placeholders.name":"اسم عضو الطاقم","technicians.form.placeholders.phone":"05xxxxxxxx","technicians.form.placeholders.role":"مثال: مصور","technicians.form.placeholders.department":"مثال: قسم الصوت","technicians.form.placeholders.wage":"0","technicians.form.placeholders.notes":"معلومات إضافية","technicians.form.actions.cancel":"إلغاء التعديل","technicians.form.actions.submit":"➕ إضافة عضو طاقم","technicians.form.actions.update":"💾 حفظ التعديل","technicians.picker.selectedLabel":"😎 طاقم العمل المشارك","technicians.picker.openButton":"➕ اختيار الطاقم","technicians.picker.editButton":"🔁 تعديل الطاقم","technicians.picker.modalTitle":"😎 اختيار طاقم العمل","technicians.picker.actions.apply":"تم","technicians.form.options.available":"✅ متاح","technicians.form.options.busy":"⛔ مشغول","technicians.search.placeholder":"🔍 ابحث عن عضو الطاقم بالاسم أو الجوال أو الوظيفة...","technicians.search.filters.allRoles":"👔 كل الوظائف","technicians.table.empty":"لا يوجد أعضاء في الطاقم بعد.","technicians.table.loading":"جاري التحميل...","technicians.table.headers.name":"😎 اسم العضو","technicians.table.headers.phone":"📞 الجوال","technicians.table.headers.role":"👔 الوظيفة","technicians.table.headers.department":"🧩 القسم","technicians.table.headers.wage":"💰 الأجر اليومي","technicians.table.headers.status":"⚙️ الحالة","technicians.table.headers.notes":"📝 ملاحظات","technicians.table.headers.actions":"⚙️ الإجراءات","technicians.status.available":"✅ متاح","technicians.status.busy":"⛔ مشغول","technicians.table.wageSuffix":"ريال","technicians.actions.edit":"✏️ تعديل","technicians.actions.delete":"🗑️ حذف","technicians.toast.missingName":"⚠️ يرجى إدخال اسم عضو الطاقم","technicians.toast.missingPhone":"⚠️ يرجى إدخال رقم التواصل","technicians.toast.missingRole":"⚠️ يرجى إدخال الوظيفة","technicians.toast.invalidWage":"⚠️ أدخل قيمة صحيحة للأجر اليومي","technicians.toast.addSuccess":"✅ تم إضافة عضو الطاقم","technicians.toast.updateSuccess":"💾 تم حفظ بيانات عضو الطاقم","technicians.toast.notFound":"⚠️ تعذر العثور على عضو الطاقم المطلوب","technicians.toast.unidentified":"⚠️ تعذر تحديد عضو الطاقم المطلوب","technicians.toast.dataNotFound":"⚠️ تعذر العثور على بيانات عضو الطاقم","technicians.toast.editReady":"✏️ يمكنك تعديل بيانات عضو الطاقم الآن ثم الضغط على حفظ التعديل","technicians.toast.deleteConfirm":"⚠️ هل أنت متأكد من حذف هذا العضو؟","technicians.toast.deleteSuccess":"🗑️ تم حذف عضو الطاقم"},en:{"dashboard.header.greeting":"👋 Welcome to the Dashboard","dashboard.header.toggleLabel":"Dashboard","dashboard.sidebar.title":"Control Center","dashboard.sidebar.statsHeading":"Today at a Glance","dashboard.sidebar.tabsHeading":"Dashboard Tabs","dashboard.sidebar.quickLinksHeading":"Quick Links","dashboard.hero.title":"Art Ratio","dashboard.actions.addProject":"➕ Add Project","dashboard.metrics.projects.label":"Projects","dashboard.metrics.projects.caption":"Active projects this month","dashboard.metrics.reservations.label":"Reservations","dashboard.metrics.reservations.caption":"Keep track of upcoming events","dashboard.metrics.equipment.label":"Equipment","dashboard.metrics.equipment.caption":"Assets available right now","dashboard.metrics.technicians.label":"Crew Members","dashboard.metrics.technicians.caption":"Team ready for assignments","dashboard.quickLinks.home":"Home","dashboard.quickLinks.projects":"Projects workspace","dashboard.quickLinks.reports":"Project reports","dashboard.quickLinks.users":"User management","tabs.customers":"👤 Clients","tabs.equipment":"🎥 Equipment","tabs.maintenance":"🛠️ Maintenance","tabs.technicians":"😎 Crew","tabs.reservations":"📅 Reservations","actions.close":"Close","actions.cancel":"Cancel","actions.goHome":"🏠 Home","customers.section.title":"📋 Client Management","customers.form.title":"Add / Edit Client","customers.form.hint":"Update client details and they will sync with bookings and invoices.","customers.form.labels.name":"👤 Client","customers.form.labels.phone":"📞 Phone","customers.form.labels.email":"📧 Email","customers.form.labels.address":"📍 Address","customers.form.labels.company":"🏢 Company","customers.form.labels.notes":"📝 Notes","customers.form.placeholders.name":"Client name","customers.form.placeholders.phone":"05xxxxxxxx","customers.form.placeholders.email":"name@email.com","customers.form.placeholders.address":"Client address","customers.form.placeholders.company":"Company name","customers.form.placeholders.notes":"Additional info or reminders","customers.form.actions.cancel":"Cancel edit","customers.form.actions.submit":"➕ Add Client","customers.form.actions.update":"💾 Update Client","customers.search.placeholder":"🔍 Search by name, phone, or company...","customers.table.headers.name":"👤 Client","customers.table.headers.phone":"📞 Phone","customers.table.headers.company":"🏢 Company","customers.table.headers.notes":"📝 Notes","customers.table.headers.actions":"⚙️ Actions","customers.table.loading":"Loading...","customers.table.empty":"No clients found","customers.table.noResults":"No matching results","customers.actions.edit":"✏️ Edit","customers.actions.delete":"🗑️ Delete","customers.toast.updateSuccess":"Client updated successfully","customers.toast.createSuccess":"Client added successfully","customers.toast.missingFields":"Please fill in the name and phone number","customers.toast.deleteConfirm":"⚠️ Are you sure you want to delete this client?","customers.toast.deleteSuccess":"Client removed","equipment.section.title":"🎥 Equipment Management","equipment.actions.clearAll":"🗑️ Clear All","equipment.actions.uploadExcel":"📤 Import from Excel","equipment.form.title":"Add Equipment","equipment.form.hint":"Enter equipment details to store them in the catalog.","equipment.form.labels.description":"📝 Description","equipment.form.placeholders.description":"Equipment description","equipment.form.labels.barcode":"🏷️ Barcode","equipment.form.placeholders.barcode":"Barcode","equipment.form.labels.price":"💵 Price","equipment.form.placeholders.price":"0","equipment.form.labels.quantity":"🔢 Quantity","equipment.form.placeholders.quantity":"1","equipment.form.labels.image":"🖼️ Image URL","equipment.form.placeholders.image":"https://...","equipment.form.labels.category":"📂 Category","equipment.form.placeholders.category":"Category","equipment.form.labels.subcategory":"📑 Subcategory","equipment.form.placeholders.subcategory":"Subcategory","equipment.form.labels.status":"⚙️ Status","equipment.form.options.available":"✅ Available","equipment.form.options.booked":"📌 Booked","equipment.form.options.maintenance":"🛠️ Maintenance","equipment.form.options.retired":"📦 Retired","equipment.form.actions.submit":"➕ Add Equipment","equipment.filters.search":"🔍 Search equipment...","equipment.filters.status.all":"⚙️ All statuses","equipment.filters.category.all":"📂 All categories","equipment.filters.subcategory.all":"📑 All subcategories","equipment.list.title":"📋 All Equipment","equipment.list.loading":"⏳ Loading equipment...","equipment.list.empty":"No equipment has been added yet.","equipment.card.labels.description":"Description","equipment.card.labels.status":"Status","equipment.card.labels.alias":"Name","equipment.card.labels.quantity":"Quantity","equipment.card.labels.price":"Price","equipment.card.labels.category":"Category","equipment.card.labels.subcategory":"Subcategory","equipment.card.labels.barcode":"Barcode","equipment.modal.title":"✏️ Edit Equipment","equipment.modal.placeholders.image":"Paste a direct image link","equipment.modal.actions.cancel":"❌ Cancel","equipment.modal.actions.save":"💾 Save Changes","equipment.toast.xlsxMissing":"⚠️ Excel library (XLSX) is not loaded. Check dashboard.html links","equipment.toast.uploadSuccess":"✅ Equipment imported successfully","equipment.toast.uploadEmpty":"⚠️ The file did not contain any rows to import","equipment.toast.uploadFailed":"❌ Something went wrong while reading the Excel file","equipment.toast.clearConfirm":"⚠️ Are you sure you want to delete all equipment?","equipment.toast.clearSuccess":"🗑️ All equipment cleared","equipment.toast.deleteConfirm":"❌ Are you sure you want to delete this equipment item?","equipment.toast.deleteSuccess":"🗑️ Equipment item deleted","equipment.toast.editSuccess":"✏️ Equipment updated","equipment.toast.addSuccess":"✅ Equipment added","equipment.toast.updateSuccess":"✅ Equipment updated successfully","equipment.toast.missingFields":"⚠️ Please enter the description and barcode","equipment.toast.duplicateBarcode":"⚠️ This barcode is already in use","equipment.list.emptyFiltered":"⚠️ No matching equipment.","equipment.list.countSuffix":"item(s)","equipment.item.imageAlt":"Image","equipment.item.currency":"SAR","equipment.item.actions.edit":"✏️ Edit","equipment.item.actions.delete":"🗑️ Delete","reservations.tabs.create":"➕ Create Reservation","reservations.tabs.mine":"📋 My Reservations","reservations.tabs.reports":"📊 Reports","reservations.tabs.calendar":"📅 Calendar","reservations.create.title":"➕ Create New Reservation","reservations.create.labels.startDate":"📅 Start date","reservations.create.labels.startTime":"⏰ Start time","reservations.create.labels.endDate":"📅 End date","reservations.create.labels.endTime":"⏰ End time","reservations.create.labels.client":"👤 Client","reservations.create.placeholders.client":"Type client name...","reservations.create.labels.project":"📁 Linked project","reservations.create.placeholders.project":"Select a project (optional)","reservations.create.labels.notes":"📝 Notes","reservations.create.placeholders.notes":"Add any additional notes...","reservations.create.equipment.title":"🎥 Add Equipment","reservations.create.equipment.placeholders.barcode":"🔍 Scan or enter a barcode then press Enter","reservations.create.equipment.placeholders.description":"🎥 Type the equipment name then press Enter","reservations.create.equipment.table.code":"Code","reservations.create.equipment.table.description":"Description","reservations.create.equipment.table.price":"Price","reservations.create.equipment.table.image":"Image","reservations.create.equipment.table.delete":"Delete","reservations.create.billing.title":"💵 Discount & Tax","reservations.create.billing.discount":"Enter discount value","reservations.create.billing.discountPercent":"% Percent","reservations.create.billing.discountAmount":"💵 Amount","reservations.create.billing.companyShare":"🏦 Company share","reservations.create.billing.companyShareToggle":"Include company share (10%)","reservations.create.billing.taxLabel":"Include VAT (15%)","reservations.create.labels.paymentStatus":"💳 Payment status","reservations.create.paymentStatus.paid":"Paid","reservations.create.paymentStatus.unpaid":"Unpaid","reservations.create.actions.submit":"💾 Create reservation","reservations.section.title":"📅 Reservation Management","reservations.crew.none":"No crew members selected yet.","reservations.crew.noneShort":"No crew members selected","reservations.crew.selectedCount":"{count} crew member(s) selected","reservations.crew.fallbackName":"Crew member {id}","reservations.crew.removeAria":"Remove","reservations.crew.searchEmpty":"No matching results.","reservations.create.equipment.noResults":"No matching equipment.","reservations.create.equipment.noneAdded":"No equipment added","reservations.create.equipment.none":"No equipment","reservations.create.summary.currency":"SAR","reservations.create.equipment.imageAlt":"Image","reservations.summary.total":"💰 Total cost: <strong>{total} {currency}</strong>","reservations.summary.totalAfterEdit":"💰 Updated total: <strong>{total} {currency}</strong>","reservations.summary.itemsCount":"📦 Items: {count}","reservations.summary.crewCount":"😎 Crew members: {count}","reservations.summary.companyShareLabel":"🏦 Company share","reservations.summary.taxIncluded":"Includes 15% VAT","reservations.summary.taxExcluded":"VAT not included","reservations.summary.paymentLabel":"💳 Payment status: {status}","reservations.summary.itemsLabel":"📦 Items","reservations.summary.durationLabel":"⏱️ Days","reservations.summary.crewLabel":"😎 Crew","reservations.summary.taxLabelShort":"🧾 VAT","reservations.summary.paymentLabelShort":"💳 Payment status","reservations.summary.taxIncludedValue":"Includes 15%","reservations.summary.taxExcludedValue":"Not included","reservations.summary.totalLabel":"💰 Total cost","reservations.toast.customerNotFound":"⚠️ Customer not found for the entered name","reservations.toast.invalidDateOrder":"⚠️ Start date cannot be after the end date","reservations.toast.reservationMissing":"⚠️ Unable to locate the selected reservation","reservations.list.title":"📋 My Reservations","reservations.list.search.placeholder":"🔍 Search by client name or code...","reservations.list.filters.start":"📅 From date","reservations.list.filters.end":"📅 To date","reservations.list.filters.range.all":"⏱️ All dates","reservations.list.filters.range.today":"📅 Today","reservations.list.filters.range.week":"📆 This week","reservations.list.filters.range.month":"🗓️ This month","reservations.list.filters.status.all":"⚙️ All statuses","reservations.list.filters.status.confirmed":"✅ Confirmed","reservations.list.filters.status.pending":"⏳ Pending","reservations.list.filters.status.completed":"📁 Completed","reservations.list.empty":"⚠️ No reservations yet.","reservations.list.noResults":"🔍 No reservations match the search.","reservations.list.taxIncludedShort":"(Tax included)","reservations.list.unknownCustomer":"Unknown","reservations.list.noNotes":"No notes","reservations.list.project.unlinked":"Not linked to a project","reservations.list.itemsCountShort":"{count} item(s)","reservations.list.crew.separator":", ","reservations.list.status.confirmed":"✅ Confirmed","reservations.list.status.pending":"⏳ Pending","reservations.list.payment.paid":"💳 Paid","reservations.list.payment.unpaid":"💳 Unpaid","reservations.list.status.completed":"📁 Completed","reservations.list.ribbon.completed":"Completed","reservations.list.actions.confirm":"✔️ Confirm","reservations.list.labels.client":"👤 Client","reservations.list.labels.project":"📁 Project","reservations.edit.modalTitle":"✏️ Edit Reservation","reservations.edit.labels.id":"🆔 Reservation ID","reservations.edit.labels.customer":"👤 Customer","reservations.edit.labels.project":"📁 Linked project","reservations.edit.labels.startDate":"📅 Start date","reservations.edit.labels.startTime":"⏰ Start time","reservations.edit.labels.endDate":"📅 End date","reservations.edit.labels.endTime":"⏰ End time","reservations.edit.labels.discount":"💵 Discount","reservations.edit.placeholders.discount":"Enter discount value","reservations.edit.discount.percent":"% Percent","reservations.edit.discount.amount":"💵 Amount","reservations.edit.labels.tax":"Include VAT (15%)","reservations.edit.labels.confirmed":"✅ Confirmed","reservations.edit.labels.paymentStatus":"💳 Payment status","reservations.edit.payment.paid":"Paid","reservations.edit.payment.unpaid":"Unpaid","reservations.edit.labels.notes":"📝 Notes","reservations.edit.placeholders.notes":"Add any notes...","reservations.edit.labels.addEquipment":"🎥 Add equipment","reservations.edit.project.missing":"⚠️ Project unavailable (deleted)","reservations.edit.placeholders.barcode":"🔍 Scan or enter a barcode then press Enter","reservations.edit.placeholders.description":"🎥 Type the equipment name then press Enter","reservations.edit.table.headers.code":"Code","reservations.edit.table.headers.description":"Description","reservations.edit.table.headers.price":"Price","reservations.edit.table.headers.quantity":"Qty","reservations.edit.table.headers.image":"Image","reservations.edit.table.headers.delete":"Delete","reservations.edit.table.empty":"No equipment","reservations.edit.actions.save":"💾 Save changes","reservations.list.labels.start":"🗓️ Start","reservations.list.labels.end":"🗓️ End","reservations.list.labels.cost":"💵 Cost","reservations.list.labels.equipment":"📦 Equipment","reservations.list.labels.crew":"😎 Crew","reservations.details.labels.discount":"Discount","reservations.details.labels.companyShare":"🏦 Company share","reservations.details.labels.subtotalAfterDiscount":"Subtotal","reservations.details.labels.tax":"Tax (15%)","reservations.details.labels.crewTotal":"Crew total","reservations.details.table.headers.code":"Code","reservations.details.table.headers.description":"Description","reservations.details.table.headers.quantity":"Qty","reservations.details.table.headers.price":"Price","reservations.details.table.headers.image":"Image","reservations.details.noItems":"📦 No equipment is linked to this reservation yet.","reservations.details.noCrew":"😎 No crew assigned to this reservation.","reservations.details.project.unlinked":"Not linked to any project.","reservations.details.technicians.roleUnknown":"Not specified","reservations.details.technicians.phoneUnknown":"Not available","reservations.details.technicians.wage":"{amount} {currency} / day","reservations.details.labels.id":"🆔 Reservation ID","reservations.details.section.bookingInfo":"Booking details","reservations.details.section.statusSummary":"Status summary","reservations.details.section.paymentSummary":"💳 Payment summary","reservations.details.labels.finalTotal":"Final total","reservations.details.section.crew":"😎 Crew members","reservations.details.crew.count":"{count} member(s)","reservations.details.section.items":"📦 Linked equipment","reservations.details.items.count":"{count} item(s)","reservations.details.actions.edit":"✏️ Edit","reservations.details.actions.delete":"🗑️ Delete","reservations.details.actions.openProject":"📁 Open project","reservations.details.labels.customer":"Customer","reservations.details.labels.contact":"Contact","reservations.details.labels.start":"Start","reservations.details.labels.end":"End","reservations.details.labels.notes":"Notes","reservations.details.labels.itemsCount":"Equipment count","reservations.details.labels.itemsTotal":"Equipment total","reservations.details.labels.paymentStatus":"Payment status","reservations.details.modalTitle":"📋 Reservation Details","reservations.calendar.title":"📅 Calendar","reservations.reports.title":"📊 Performance Reports","reservations.reports.subtitle":"A holistic view of reservations, revenue, and utilization for the selected period.","reservations.reports.filters.rangeLabel":"Period","reservations.reports.filters.range.last30":"Last 30 days","reservations.reports.filters.range.thisWeek":"This week","reservations.reports.filters.range.thisMonth":"This month","reservations.reports.filters.range.thisQuarter":"This quarter","reservations.reports.filters.range.thisYear":"This year","reservations.reports.filters.range.all":"All time","reservations.reports.filters.range.custom":"Custom","reservations.reports.filters.startLabel":"From","reservations.reports.filters.endLabel":"To","reservations.reports.filters.statusLabel":"Status","reservations.reports.filters.status.all":"All statuses","reservations.reports.filters.status.confirmed":"Confirmed","reservations.reports.filters.status.pending":"Pending confirmation","reservations.reports.filters.status.completed":"Completed","reservations.reports.filters.paymentLabel":"Payment","reservations.reports.filters.payment.all":"All","reservations.reports.filters.payment.paid":"Paid","reservations.reports.filters.payment.unpaid":"Unpaid","reservations.reports.filters.searchLabel":"Search","reservations.reports.filters.searchPlaceholder":"Search by customer, reservation number, or equipment...","reservations.reports.actions.refresh":"🔄 Refresh","reservations.reports.kpi.total.label":"Total reservations","reservations.reports.kpi.total.meta":"No data recorded yet","reservations.reports.kpi.revenue.label":"Total revenue","reservations.reports.kpi.revenue.meta":"Average reservation —","reservations.reports.kpi.confirmation.label":"Confirmation rate","reservations.reports.kpi.confirmation.meta":"Confirmed reservations —","reservations.reports.kpi.paid.label":"Paid ratio","reservations.reports.kpi.paid.meta":"Paid reservations —","reservations.reports.kpi.total.dynamicMeta":"Includes {count} completed","reservations.reports.kpi.revenue.average":"Average reservation value {value}","reservations.reports.kpi.confirmed.detail":"{count} confirmed reservations","reservations.reports.kpi.paid.detail":"{count} paid reservations","reservations.reports.status.confirmedLabel":"Confirmed","reservations.reports.status.pendingLabel":"Pending confirmation","reservations.reports.status.completedLabel":"Completed","reservations.reports.payment.paidLabel":"Paid","reservations.reports.payment.unpaidLabel":"Unpaid","reservations.reports.progress.empty":"No data to display.","reservations.reports.progress.meta":"{count} reservations","reservations.reports.chart.volume.title":"📈 Reservation trend","reservations.reports.chart.volume.hint":"Last 6 months","reservations.reports.chart.status.title":"📊 Status & payment breakdown","reservations.reports.chart.status.hint":"Percentages","reservations.reports.chart.status.statusLabel":"Status","reservations.reports.chart.status.paymentLabel":"Payment","reservations.reports.topCustomers.title":"👥 Top customers","reservations.reports.topCustomers.hint":"By total revenue","reservations.reports.topCustomers.headers.customer":"Customer","reservations.reports.topCustomers.headers.count":"Reservations","reservations.reports.topCustomers.headers.revenue":"Total revenue","reservations.reports.topCustomers.unknown":"Unknown customer","reservations.reports.table.empty":"No data available","reservations.reports.table.emptyPeriod":"No data for this period.","reservations.reports.results.title":"📄 Reservation Details","reservations.reports.results.hint":"Latest reservations matching the current filters","reservations.reports.results.headers.id":"Reservation","reservations.reports.results.headers.customer":"Customer","reservations.reports.results.headers.date":"Date","reservations.reports.results.headers.status":"Status","reservations.reports.results.headers.payment":"Payment","reservations.reports.results.headers.total":"Total","reservations.reports.topEquipment.title":"🎥 Most used equipment","reservations.reports.topEquipment.hint":"Total bookings","reservations.reports.topEquipment.headers.item":"Equipment","reservations.reports.topEquipment.headers.usage":"Usage count","reservations.reports.topEquipment.headers.revenue":"Linked revenue","reservations.reports.topEquipment.unknown":"Unnamed equipment","reservations.reports.empty.title":"No data matches the current filters","reservations.reports.empty.subtitle":"Try adjusting the date range or removing filters to see more results.","calendar.buttons.today":"Today","calendar.buttons.month":"Month","calendar.buttons.week":"Week","calendar.buttons.day":"Day","calendar.badges.confirmed":"Confirmed","calendar.badges.pending":"Pending","calendar.badges.paid":"Paid","calendar.badges.unpaid":"Unpaid","calendar.badges.completed":"Completed","calendar.labels.unknownCustomer":"Unknown","calendar.labels.unknownEquipment":"Unnamed equipment","calendar.labels.currencySuffix":"SAR","calendar.labels.noEquipment":"No equipment","calendar.labels.noNotes":"No notes","calendar.labels.reservationId":"Reservation ID","calendar.labels.customer":"Customer","calendar.labels.start":"Start","calendar.labels.end":"End","calendar.labels.notes":"Notes","calendar.sections.crew":"😎 Crew members","calendar.sections.equipment":"📦 Equipment","calendar.emptyStates.noCrew":"😎 No crew assigned to this reservation.","calendar.table.headers.barcode":"Barcode","calendar.table.headers.description":"Description","calendar.table.headers.quantity":"Qty","calendar.table.headers.price":"Price","calendar.table.headers.image":"Image","calendar.summary.baseCost":"💵 Equipment subtotal: <strong>{value} SAR</strong>","calendar.summary.discount":"💸 Discount: <strong>{value}</strong>","calendar.summary.tax":"🧾 Tax (15%): <strong>{value} SAR</strong>","calendar.summary.total":"💰 Grand total: <strong>{value} SAR</strong>","calendar.alerts.cannotShowDetails":"Unable to show reservation details","calendar.alerts.cannotOpenModal":"Unable to open details modal","calendar.modal.title":"📅 Reservation Details","reservations.toast.equipmentNameNotFound":"❌ No equipment found with that name","reservations.toast.equipmentMaintenance":"⚠️ This equipment is under maintenance and cannot be added","reservations.toast.equipmentMissingBarcode":"⚠️ This equipment has no barcode assigned","reservations.toast.requireDatesBeforeAdd":"⚠️ Set start and end date/time before adding equipment","reservations.toast.equipmentDuplicate":"⚠️ This equipment is already in the reservation","reservations.toast.equipmentTimeConflict":"⚠️ Cannot add equipment because it is booked in the same period","reservations.toast.equipmentMaintenanceStrict":"⚠️ Cannot add equipment while it is marked for maintenance","reservations.toast.requireOverallDates":"⚠️ Set the reservation dates before adding equipment","reservations.toast.equipmentTimeConflictSimple":"⚠️ This equipment is booked in the same period","reservations.toast.barcodeNotFound":"❌ Barcode not found","reservations.toast.equipmentAdded":"✅ Equipment added successfully","reservations.toast.barcodeNotInCatalog":"❌ Barcode not found in catalog","reservations.toast.requireDates":"⚠️ Please set start and end date","reservations.toast.invalidDateRange":"⚠️ Make sure start time is before end time","reservations.toast.missingFields":"⚠️ Please fill in all required fields","reservations.toast.noItems":"⚠️ Add at least one equipment item or crew member to the reservation","reservations.toast.cannotCreateEquipmentMaintenance":"⚠️ Cannot create reservation because an item is under maintenance","reservations.toast.cannotCreateEquipmentConflict":"⚠️ Cannot create reservation because an item is already booked","reservations.toast.cannotCreateCrewConflict":"⚠️ Cannot create reservation because a crew member has another booking in that period","reservations.toast.projectNotFound":"⚠️ Selected project was not found. Please refresh the page or choose another project.","reservations.toast.technicianSelectionConflict":"⚠️ Cannot select {names}; they are already booked for the selected time range","reservations.toast.created":"✅ Reservation created","reservations.toast.notFound":"⚠️ Unable to locate reservation data","reservations.toast.updateNoItems":"⚠️ Add at least one equipment item or crew member before saving","reservations.toast.updateEquipmentMaintenance":"⚠️ Cannot save changes because an item is under maintenance","reservations.toast.updateEquipmentConflict":"⚠️ Cannot save changes because an item conflicts with another booking","reservations.toast.updateCrewConflict":"⚠️ Cannot save changes because a crew member conflicts with another booking","reservations.toast.updated":"✅ Reservation updated","reservations.toast.confirmed":"✅ Reservation confirmed","reservations.toast.confirmBlockedByProject":"⚠️ This reservation is controlled by its linked project and cannot be confirmed here","reservations.toast.deleteConfirm":"⚠️ Are you sure you want to delete this reservation?","maintenance.section.title":"🛠️ Maintenance Management","maintenance.form.title":"➕ Create Maintenance Ticket","maintenance.form.hint":"Select the affected equipment and describe the issue to take it out of service.","maintenance.form.labels.barcode":"🏷️ Barcode","maintenance.form.placeholders.barcode":"🖨️ Scan or enter the barcode, then press Enter","maintenance.form.labels.search":"🎥 Search by equipment name","maintenance.form.placeholders.search":"Type the equipment name...","maintenance.form.labels.priority":"⚠️ Priority","maintenance.form.options.priority.high":"High","maintenance.form.options.priority.medium":"Medium","maintenance.form.options.priority.low":"Low","maintenance.form.selectedInfo":"No equipment selected yet.","maintenance.form.labels.issue":"📝 Issue description","maintenance.form.placeholders.issue":"Describe the issue or symptoms for the equipment","maintenance.form.actions.submit":"🛠️ Create Ticket","maintenance.form.blockedSuffix":"(In maintenance)","maintenance.list.title":"📋 Maintenance Tickets","maintenance.list.hint":"Track issues and close tickets once repairs are completed.","maintenance.filters.status.label":"Status","maintenance.filters.status.all":"All statuses","maintenance.filters.status.open":"In maintenance","maintenance.filters.status.closed":"Closed","maintenance.table.headers.equipment":"Equipment","maintenance.table.headers.issue":"Issue","maintenance.table.headers.priority":"Priority","maintenance.table.headers.created":"Created At","maintenance.table.headers.status":"Status","maintenance.table.headers.actions":"Actions","maintenance.table.empty":"No tickets yet.","maintenance.table.emptyFiltered":"No tickets match this filter.","maintenance.table.noName":"No name","maintenance.empty.title":"No maintenance tickets","maintenance.empty.subtitle":"Once you create a new ticket it will appear here.","maintenance.table.noBarcode":"No barcode","maintenance.stats.open":"{count} in maintenance","maintenance.stats.closed":"{count} closed","maintenance.stats.total":"{count} total tickets","maintenance.status.open":"In maintenance","maintenance.status.closed":"Closed","maintenance.status.inProgress":"In progress","maintenance.status.completed":"Completed","maintenance.status.cancelled":"Cancelled","maintenance.priority.high":"High","maintenance.priority.medium":"Medium","maintenance.priority.low":"Low","maintenance.actions.close":"🔧 Close after repair","maintenance.actions.view":"👁️ View report","maintenance.actions.delete":"🗑️ Delete ticket","maintenance.closeModal.title":"🔧 Close maintenance ticket","maintenance.closeModal.subtitle":"Please add a repair report before closing this ticket.","maintenance.closeModal.reportLabel":"📝 Repair report","maintenance.closeModal.reportPlaceholder":"Describe the repair work and actions taken...","maintenance.closeModal.confirm":"✅ Close ticket","maintenance.closeModal.cancel":"Cancel","maintenance.closeModal.saving":"⏳ Closing...","maintenance.toast.equipmentBlocked":"⚠️ This equipment is already under maintenance and can’t be selected","maintenance.toast.equipmentNotFoundBarcode":"❌ No equipment found with this barcode","maintenance.toast.equipmentNotFoundName":"❌ No equipment found with that name","maintenance.toast.equipmentBecameBlocked":"⚠️ This equipment is now under maintenance and can’t be selected","maintenance.toast.selectEquipment":"⚠️ Please select equipment","maintenance.toast.selectedNotFound":"❌ Selected equipment was not found","maintenance.toast.equipmentAlreadyMaintenance":"⚠️ This equipment is already marked as in maintenance","maintenance.toast.ticketExists":"⚠️ There is already an open maintenance ticket for this equipment","maintenance.toast.ticketCreated":"🛠️ Maintenance ticket created and equipment removed from service","maintenance.toast.storageError":"⚠️ Could not save maintenance data. Please try again.","maintenance.toast.submitError":"⚠️ Could not create the maintenance ticket. Please try again.","maintenance.toast.loading":"⏳ Maintenance data is refreshing, please wait a moment...","maintenance.toast.ticketAlreadyClosed":"✅ Tickets refreshed; this maintenance item appears to be already closed.","maintenance.toast.reportRequired":"⚠️ Please write the repair report before closing the ticket","maintenance.toast.ticketClosed":"✅ Maintenance ticket closed and equipment set to available","maintenance.toast.ticketDeleted":"🗑️ Maintenance ticket deleted","maintenance.toast.ticketDeleteConfirm":"⚠️ Are you sure you want to delete this maintenance ticket?","maintenance.prompt.closeReport":"Enter repair report / actions taken:","maintenance.report.equipment":"Equipment","maintenance.report.barcode":"Barcode","maintenance.report.issue":"Issue","maintenance.report.createdAt":"Created at","maintenance.report.closedAt":"Closed at","maintenance.report.summary":"Report","maintenance.report.notAvailable":"Not available","maintenance.report.none":"—","maintenance.info.barcodeLabel":"Barcode","technicians.section.title":"😎 Crew Management","technicians.form.title":"Add / Edit Crew Member","technicians.form.hint":"Enter crew member details to save and keep bookings updated.","technicians.form.labels.name":"😎 Crew Member","technicians.form.labels.phone":"📞 Phone","technicians.form.labels.role":"👔 Role","technicians.form.labels.department":"🧩 Department","technicians.form.labels.wage":"💰 Daily Rate","technicians.form.labels.status":"⚙️ Base Status","technicians.form.labels.notes":"📝 Notes","technicians.form.placeholders.name":"Crew member name","technicians.form.placeholders.phone":"05xxxxxxxx","technicians.form.placeholders.role":"e.g. Camera operator","technicians.form.placeholders.department":"e.g. Audio team","technicians.form.placeholders.wage":"0","technicians.form.placeholders.notes":"Additional information","technicians.form.actions.cancel":"Cancel edit","technicians.form.actions.submit":"➕ Add Crew Member","technicians.form.actions.update":"💾 Update Crew Member","technicians.picker.selectedLabel":"😎 Assigned crew","technicians.picker.openButton":"➕ Choose crew","technicians.picker.editButton":"🔁 Edit crew","technicians.picker.modalTitle":"😎 Select crew","technicians.picker.actions.apply":"Done","technicians.form.options.available":"✅ Available","technicians.form.options.busy":"⛔ Busy","technicians.search.placeholder":"🔍 Search crew member by name, phone, or role...","technicians.search.filters.allRoles":"👔 All roles","technicians.table.empty":"No crew members yet.","technicians.table.loading":"Loading...","technicians.table.headers.name":"😎 Crew Member","technicians.table.headers.phone":"📞 Phone","technicians.table.headers.role":"👔 Role","technicians.table.headers.department":"🧩 Department","technicians.table.headers.wage":"💰 Daily Rate","technicians.table.headers.status":"⚙️ Status","technicians.table.headers.notes":"📝 Notes","technicians.table.headers.actions":"⚙️ Actions","technicians.status.available":"✅ Available","technicians.status.busy":"⛔ Busy","technicians.table.wageSuffix":"SAR","technicians.actions.edit":"✏️ Edit","technicians.actions.delete":"🗑️ Delete","technicians.toast.missingName":"⚠️ Please enter the crew member name","technicians.toast.missingPhone":"⚠️ Please enter a contact number","technicians.toast.missingRole":"⚠️ Please enter the role","technicians.toast.invalidWage":"⚠️ Enter a valid daily wage","technicians.toast.addSuccess":"✅ Crew member added","technicians.toast.updateSuccess":"💾 Crew member updated","technicians.toast.notFound":"⚠️ Crew member not found","technicians.toast.unidentified":"⚠️ Unable to identify crew member","technicians.toast.dataNotFound":"⚠️ Crew member details not found","technicians.toast.editReady":"✏️ You can edit the crew member details now then press Save","technicians.toast.deleteConfirm":"⚠️ Are you sure you want to remove this crew member?","technicians.toast.deleteSuccess":"🗑️ Crew member removed"}});function Se(e={}){return e.image||e.imageUrl||e.img||""}function bn(e){if(!e)return null;const t=P(e),{equipment:s=[]}=M();return(s||[]).find(n=>P(n?.barcode)===t)||null}function et(e){const t=P(e);if(!t)return null;const{equipment:s=[]}=M();return(s||[]).find(n=>P(n?.barcode)===t)||null}function ue(e){return et(e)?.status==="صيانة"}const se=new Map;let Ue=null,Oe=null;function ee(){return Ue||(Ue=Object.getOwnPropertyDescriptor(HTMLSelectElement.prototype,"value")),Ue}function tt(e){return String(e||"").trim().toLowerCase().replace(/\s+/g," ")}function gn(e=""){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function yn(e,t){if(!e)return"";const s=e.getAttribute("placeholder")||e.dataset.placeholder||e.dataset.dropdownPlaceholder;if(s)return s;const n=e.dataset.placeholderKey||e.dataset.i18nPlaceholderKey||e.dataset.i18nPlaceholder;if(n)return r(n,s||"");const i=t.find(a=>a.value===""&&(a.disabled||a.hidden));return i?i.label:""}function qe(e){const{select:t}=e,s=Array.from(t.options).map(n=>({value:n.value,label:n.textContent.trim(),disabled:n.disabled,hidden:n.hidden,element:n,normalized:tt(n.textContent)}));e.options=s,e.placeholder=yn(t,s),e.list.innerHTML=s.filter(n=>n.label&&n.value!==""&&!n.disabled).map(n=>`<option value="${gn(n.label)}"></option>`).join("")}function Ye(e){const t=e.select.disabled;e.input.disabled=t}function qn(e){e.select.required&&(e.input.required=!0,e.select.required=!1)}function F(e){const{select:t,input:s,options:n}=e,i=t.value,a=n.find(o=>o.value===i);a?(s.value=a.label,s.dataset.autocompleteSelected=a.value):(s.value="",s.dataset.autocompleteSelected=""),s.placeholder=e.placeholder||""}function ce(e){e.dispatchEvent(new Event("change",{bubbles:!0}))}function ze(e,t=!1){const{select:s,input:n,options:i}=e,a=n.value.trim();if(!a){ee().set.call(s,""),F(e),ce(s);return}const o=tt(a);let c=i.filter(l=>l.normalized===o&&l.value!=="");if(c.length===0&&t&&(c=i.filter(l=>l.normalized.includes(o)&&l.value!=="")),c.length===1){ee().set.call(s,c[0].value),F(e),ce(s);return}const d=i.filter(l=>l.label===a&&l.value!=="");if(d.length===1){ee().set.call(s,d[0].value),F(e),ce(s);return}ee().set.call(s,""),F(e),ce(s)}function En(e){const{select:t,input:s,options:n}=e,i=s.value.trim();if(!i){ee().set.call(t,""),F(e),ce(t);return}const a=tt(i),o=n.find(c=>c.normalized===a&&c.value!=="");if(o){const c=ee();c.get.call(t)!==o.value?(c.set.call(t,o.value),F(e),ce(t)):F(e)}}function wn(e){const{select:t}=e;if(t.dataset.autocompleteValuePatched==="true")return;const s=ee();Object.defineProperty(t,"value",{configurable:!0,enumerable:s.enumerable,get(){return s.get.call(this)},set(n){s.get.call(this),s.set.call(this,n);const i=se.get(this);return i&&F(i),n}}),t.dataset.autocompleteValuePatched="true"}function In(e,t,s){Array.from(e.classList).forEach(i=>{i==="form-select"?s.classList.add("form-control"):(t.classList.add(i),s.classList.add(i))}),s.classList.add("dropdown-autocomplete__input"),t.classList.add("dropdown-autocomplete")}function Sn(e,t){if(!e.id)return;const s=e.ownerDocument.querySelector(`label[for="${e.id}"]`);s&&(s.dataset.originalFor||(s.dataset.originalFor=e.id),s.setAttribute("for",t.id))}function Cn(e){if(!e||se.has(e)||e.dataset.autocomplete==="false")return null;const t=e.ownerDocument||document,s=t.createElement("div"),n=t.createElement("input"),i=t.createElement("datalist"),a=e.id?`${e.id}-input`:"dropdown-autocomplete-input";let o=a,c=1;for(;t.getElementById(o);)o=`${a}-${c++}`;n.id=o,n.type="text",n.autocomplete="off";let d=e.id?`${e.id}-options`:"dropdown-options";for(c=1;t.getElementById(d);)d=`${d}-${c++}`;i.id=d,n.setAttribute("list",i.id),In(e,s,n);const m=e.parentNode;m&&m.insertBefore(s,e),s.appendChild(n),s.appendChild(i),s.appendChild(e),e.classList.add("dropdown-autocomplete__select"),e.setAttribute("tabindex","-1"),e.setAttribute("aria-hidden","true"),e.style.position="absolute",e.style.opacity="0",e.style.pointerEvents="none",e.style.width="0",e.style.height="0",e.name&&n.setAttribute("data-dropdown-name",e.name),qn({select:e,input:n}),Ye({select:e,input:n});const l={select:e,input:n,list:i,options:[],placeholder:"",observer:null};qe(l),F(l),wn(l),Sn(e,n);const h=()=>En(l),y=()=>ze(l,!0),v=()=>ze(l,!0);return n.addEventListener("input",h),n.addEventListener("change",v),n.addEventListener("blur",y),n.addEventListener("keydown",q=>{q.key==="Enter"&&(q.preventDefault(),ze(l,!0))}),e.addEventListener("change",()=>{const q=se.get(e);q&&(qe(q),F(q))}),l.observer=new MutationObserver(q=>{let I=!1;q.forEach(b=>{b.type==="childList"&&(I=!0),b.type==="attributes"&&b.attributeName==="disabled"&&Ye(l)}),I&&(qe(l),F(l))}),l.observer.observe(e,{childList:!0,subtree:!1,attributes:!0,attributeFilter:["disabled"]}),se.set(e,l),l}function xn(e){e&&(qe(e),F(e),Ye(e))}function Tt(){se.forEach(e=>{qe(e),F(e)})}function kn(){Oe||typeof document>"u"||(Oe=new MutationObserver(e=>{e.forEach(t=>{t.addedNodes.forEach(s=>{s instanceof Element&&(s.matches&&s.matches("select.form-select")&&pt({root:s,selector:null}),s.querySelectorAll?.("select.form-select").forEach(n=>{pt({root:n,selector:null})}))})})}),Oe.observe(document.body,{childList:!0,subtree:!0}))}function pt({root:e=document,selector:t="select.form-select"}={}){const s=e instanceof Document?e:e.ownerDocument||document,n=e instanceof Element||e instanceof Document?e:s;(t?n.querySelectorAll(t):[e].filter(a=>a instanceof HTMLSelectElement)).forEach(a=>Cn(a)),kn()}function Ae(e){const t=se.get(e);t&&xn(t)}document.addEventListener("language:changed",Tt);document.addEventListener("language:translationsReady",Tt);document.addEventListener("theme:changed",()=>{se.forEach(e=>{F(e)})});let Xe=null,At=[];function le(e,t){if(!e)return;const s=t??e.value;e.classList.remove("payment-status-select--paid","payment-status-select--unpaid"),s==="paid"?e.classList.add("payment-status-select--paid"):e.classList.add("payment-status-select--unpaid")}function Dt(e){At=Array.isArray(e)?[...e]:[]}function Lt(){return At}function st(e){return e&&Lt().find(t=>String(t.id)===String(e))||null}function Tn(e){if(!e)return"";const t=typeof e.title=="string"?e.title.trim():"";return t||r("projects.fallback.untitled","مشروع بدون اسم")}function An(){const e=document.getElementById("res-company-share");if(!e||!e.checked)return null;const t=e.dataset.companyShare??e.value??mt,s=p(String(t).replace("%","").trim()),n=parseFloat(s);return Number.isFinite(n)?n:mt}function Dn(e){if(!e)return!1;if(e.confirmed===!0)return!0;const t=typeof e.status=="string"?e.status.toLowerCase():"";return["confirmed","in_progress","completed"].includes(t)}function vt(e,t){if(!e)return"";if(e[t])return e[t];if(e[`${t}Datetime`])return e[`${t}Datetime`];if(e[`${t}datetime`])return e[`${t}datetime`];if(e[`${t}_datetime`])return e[`${t}_datetime`];const s=e[`${t}Date`]??e[`${t}_date`],n=e[`${t}Time`]??e[`${t}_time`];if(s){const i=typeof n=="string"&&n.trim()?n.trim():"00:00";return`${s}T${i}`}return""}function Ln(e){if(!e)return"";const t=e.customerName??e.full_name??e.fullName??e.name??e.customer_name??"";return typeof t=="string"?t.trim():String(t||"").trim()}function ne({selectedValue:e=""}={}){const t=document.getElementById("res-customer");if(!t)return;const s=Ze()||[],n=r("reservations.create.placeholders.client","اختر عميلًا (اختياري)"),i=String(e||t.value||"");t.innerHTML="";const a=document.createElement("option");a.value="",a.textContent=n,a.hidden=!0,a.disabled=!0,t.appendChild(a),s.filter(o=>o&&o.id!=null).map(o=>({value:String(o.id),label:Ln(o)||r("customers.fallback.unnamed","عميل بدون اسم")})).sort((o,c)=>o.label.localeCompare(c.label,void 0,{sensitivity:"base"})).forEach(o=>{const c=document.createElement("option");c.value=o.value,c.textContent=o.label,t.appendChild(c)}),i&&s.some(o=>String(o.id)===i)?t.value=i:t.value="",Ae(t),t.dataset.autocompleteListenerAttached||(t.addEventListener("change",()=>{N()}),t.dataset.autocompleteListenerAttached="true")}function nt({selectedValue:e="",projectsList:t=null}={}){const s=document.getElementById("res-project");if(!s)return;const n=Array.isArray(t)?t:Lt()||[],i=r("reservations.create.placeholders.project","اختر مشروعاً (اختياري)"),a=String(e||s.value||"");s.innerHTML="";const o=document.createElement("option");o.value="",o.textContent=i,o.hidden=!0,o.disabled=!0,s.appendChild(o),n.filter(c=>c&&c.id!=null).sort((c,d)=>String(d.createdAt||d.start||"").localeCompare(String(c.createdAt||c.start||""))).forEach(c=>{const d=document.createElement("option");d.value=String(c.id),d.textContent=Tn(c),s.appendChild(d)}),a&&n.some(c=>String(c.id)===a)?s.value=a:s.value="",Ae(s),s.dataset.autocompleteListenerAttached||(s.addEventListener("change",()=>{const c=s.value,d=c?st(c):null;d?$t(d,{skipProjectSelectUpdate:!0}):(Ce(),N())}),s.dataset.autocompleteListenerAttached="true")}function De(e,t,s){const{date:n,time:i}=yt(s),a=document.getElementById(e),o=document.getElementById(t);if(a){if(n)if(a._flatpickr){const c=a._flatpickr.config?.dateFormat||"Y-m-d";a._flatpickr.setDate(n,!1,c)}else a.value=n;else a._flatpickr?a._flatpickr.clear():a.value="";a.dispatchEvent(new Event("input",{bubbles:!0})),a.dispatchEvent(new Event("change",{bubbles:!0}))}if(o){if(i)if(o._flatpickr){const c=o._flatpickr.config?.dateFormat||"H:i";o._flatpickr.setDate(i,!1,c)}else o.value=i;else o._flatpickr?o._flatpickr.clear():o.value="";o.dispatchEvent(new Event("input",{bubbles:!0})),o.dispatchEvent(new Event("change",{bubbles:!0}))}}function $t(e,{forceNotes:t=!1,skipProjectSelectUpdate:s=!1}={}){if(!e)return;const n=e?.id!=null?String(e.id):"";s||nt({selectedValue:n});const a=(Ze()||[]).find(l=>String(l.id)===String(e.clientId)),o=a?.id!=null?String(a.id):"";ne(o?{selectedValue:o}:{selectedValue:""});const c=vt(e,"start"),d=vt(e,"end");c&&De("res-start","res-start-time",c),d&&De("res-end","res-end-time",d);const m=document.getElementById("res-notes");m&&e.description&&(t||!m.value)&&(m.value=e.description),Ce(),N()}function at({projectsList:e=null,preselectId:t=null}={}){const s=document.getElementById("res-project");if(!s)return;const{projects:n}=e?{projects:e}:M(),i=Array.isArray(n)?n:[];Dt(i);const a=t!=null?String(t):String(s.value||"");nt({selectedValue:a,projectsList:i}),Ce(),N()}function Ce(){const e=document.getElementById("res-project"),t=document.getElementById("res-tax");if(!t)return;if(!!e?.value)t.checked=!1,t.disabled=!0,t.classList.add("disabled");else{const n=t.disabled;t.disabled=!1,t.classList.remove("disabled"),n&&(t.checked=!1)}}function $n(){const e=new URLSearchParams(window.location.search),t=e.get("reservationProjectContext");if(!t)return;let s=null;try{const c=decodeURIComponent(t);s=JSON.parse(c)}catch(c){console.warn("⚠️ [reservations/createForm] Failed to decode project context",c)}e.delete("reservationProjectContext");const n=e.toString(),i=`${window.location.pathname}${n?`?${n}`:""}${window.location.hash||""}`;if(window.history.replaceState({},document.title,i),!s||!s.projectId)return;document.getElementById("res-project")&&(nt({selectedValue:String(s.projectId)}),Ce());const o=st(s.projectId);if(o?$t(o,{forceNotes:!!s.forceNotes}):N(),s.start&&De("res-start","res-start-time",s.start),s.end&&De("res-end","res-end-time",s.end),s.customerId){const d=(Ze()||[]).find(m=>String(m.id)===String(s.customerId));d?.id!=null&&ne({selectedValue:String(d.id)})}else ne({selectedValue:""})}function je(){const e=document.getElementById("res-start")?.value?.trim(),t=document.getElementById("res-end")?.value?.trim(),s=document.getElementById("res-start-time")?.value?.trim()||"00:00",n=document.getElementById("res-end-time")?.value?.trim()||"00:00";return!e||!t?{start:null,end:null}:{start:Ee(e,s),end:Ee(t,n)}}function Bt(e){const t=z(e);if(!t)return null;const s=Ct()||[],n=s.find(i=>z(i?.desc||i?.description||"")===t);return n||s.find(i=>z(i?.desc||i?.description||"").includes(t))||null}function jt(e,t="equipment-description-options"){const s=z(e);if(!s)return!1;const n=document.getElementById(t);return n&&n.options&&Array.from(n.options).some(o=>z(o.value)===s)?!0:(Ct()||[]).some(a=>z(a?.desc||a?.description||"")===s)}function me(){const e=document.getElementById("equipment-description-options"),t=document.getElementById("edit-res-equipment-description-options"),{equipment:s=[]}=M(),n=Array.isArray(s)?s:[];rn(n);const a=Array.from(new Set(n.map(o=>o?.desc||o?.description||"").filter(Boolean))).sort((o,c)=>o.localeCompare(c,"ar",{sensitivity:"base"})).map(o=>`<option value="${o}"></option>`).join("");e&&(e.innerHTML=a),t&&(t.innerHTML=a)}function We(e,t){const s=P(e);if(!s)return!1;const{start:n,end:i}=je();if(!n||!i)return g(r("reservations.toast.requireDatesBeforeAdd","⚠️ يرجى تحديد تاريخ ووقت البداية والنهاية قبل إضافة المعدات")),!1;if(Ie().some(c=>P(c.barcode)===s))return g(r("reservations.toast.equipmentDuplicate","⚠️ هذه المعدة موجودة بالفعل في الحجز")),!1;if(de(s,n,i))return g(r("reservations.toast.equipmentTimeConflict","⚠️ لا يمكن إضافة المعدة لأنها محجوزة في نفس الفترة الزمنية")),!1;const o=et(s);return o?ue(o.barcode)?(g(r("reservations.toast.equipmentMaintenance","⚠️ هذه المعدة قيد الصيانة ولا يمكن إضافتها حالياً")),!1):(qt({id:o.id,equipmentId:o.id,barcode:s,desc:o.desc,qty:1,price:o.price,image:Se(o)}),t&&(t.value=""),pe(),N(),g(r("reservations.toast.equipmentAdded","✅ تم إضافة المعدة بنجاح")),!0):(g(r("reservations.toast.barcodeNotFound","❌ الباركود غير موجود")),!1)}function Ge(e){if(!e)return;const t=e.value.trim();if(!t)return;const s=Bt(t);if(!s){g(r("reservations.toast.equipmentNameNotFound","❌ لم يتم العثور على معدة بالاسم المدخل"));return}if(bn(s.barcode)?.status==="صيانة"){g(r("reservations.toast.equipmentMaintenance","⚠️ هذه المعدة قيد الصيانة ولا يمكن إضافتها حالياً"));return}const i=P(s.barcode);if(!i){g(r("reservations.toast.equipmentMissingBarcode","⚠️ هذه المعدة لا تحتوي على باركود معرف"));return}const a={id:s.id,equipmentId:s.id,barcode:i,desc:s.desc||s.description||s.name||"",qty:1,price:Number.isFinite(Number(s.price))?Number(s.price):0,image:Se(s)},{start:o,end:c}=je();if(!o||!c){g(r("reservations.toast.requireDatesBeforeAdd","⚠️ يرجى تحديد تاريخ ووقت البداية والنهاية قبل إضافة المعدات"));return}if(Ie().some(l=>P(l.barcode)===i)){g(r("reservations.toast.equipmentDuplicate","⚠️ هذه المعدة موجودة بالفعل في الحجز"));return}if(de(i,o,c)){g(r("reservations.toast.equipmentTimeConflict","⚠️ لا يمكن إضافة المعدة لأنها محجوزة في نفس الفترة الزمنية"));return}if(ue(i)){g(r("reservations.toast.equipmentMaintenance","⚠️ هذه المعدة قيد الصيانة ولا يمكن إضافتها حالياً"));return}qt(a),pe(),N(),e.value=""}function Bn(){me();const e=document.getElementById("equipment-description");if(e&&!e.dataset.listenerAttached){e.addEventListener("keydown",s=>{s.key==="Enter"&&(s.preventDefault(),Ge(e))});const t=()=>{jt(e.value,"equipment-description-options")&&Ge(e)};e.addEventListener("input",t),e.addEventListener("change",t),e.dataset.listenerAttached="true"}}function pe(e="reservation-items"){const t=document.getElementById(e);if(!t)return;const s=Ie(),n=r("reservations.create.equipment.noneAdded","لا توجد معدات مضافة"),i=r("reservations.create.summary.currency","ريال"),a=r("reservations.create.equipment.imageAlt","صورة");if(s.length===0){t.innerHTML=`<tr><td colspan="5">${n}</td></tr>`;return}t.innerHTML=s.map((o,c)=>{const d=Se(o),m=`${p(String(o.price??0))} ${i}`,l=d?`<img src="${d}" alt="${a}" class="reservation-item-thumb">`:"-";return`
        <tr>
          <td>${o.barcode||"-"}</td>
          <td>${o.desc}</td>
          <td>${m}</td>
          <td>${l}</td>
          <td><button type="button" class="reservation-remove-button" data-action="remove-item" data-index="${c}">🗑️</button></td>
        </tr>
      `}).join("")}function N(){const e=document.getElementById("res-discount")?.value||"0",t=parseFloat(p(e))||0,s=document.getElementById("res-discount-type")?.value||"percent",n=!!document.getElementById("res-project")?.value,i=document.getElementById("res-tax"),a=n?!1:i?.checked||!1,o=document.getElementById("res-payment-status")?.value||"unpaid",{start:c,end:d}=je(),m=An(),l=document.getElementById("res-payment-status");le(l,o),Ks({selectedItems:Ie(),discount:t,discountType:s,applyTax:a,paidStatus:o,start:c,end:d,companySharePercent:m})}function jn(){const e=document.getElementById("res-discount");e&&!e.dataset.listenerAttached&&(e.addEventListener("input",a=>{a.target.value=p(a.target.value),N()}),e.dataset.listenerAttached="true");const t=document.getElementById("res-discount-type");t&&!t.dataset.listenerAttached&&(t.addEventListener("change",N),t.dataset.listenerAttached="true");const s=document.getElementById("res-tax");s&&!s.dataset.listenerAttached&&(s.addEventListener("change",N),s.dataset.listenerAttached="true");const n=document.getElementById("res-company-share");n&&!n.dataset.listenerAttached&&(n.addEventListener("change",N),n.dataset.listenerAttached="true");const i=document.getElementById("res-payment-status");i&&!i.dataset.listenerAttached&&(i.addEventListener("change",()=>{le(i),N()}),i.dataset.listenerAttached="true"),le(i)}function Rn(){const e=document.getElementById("res-start-time"),t=document.getElementById("res-end-time");if(!e||!t||e.dataset.timeSyncAttached)return;let s=!1;const n=()=>{const i=e.value?.trim();if(!i){N();return}const a=t.dataset.syncedWithStart;(!t.value?.trim()||a!=="false")&&(s=!0,t.value=i,t.dataset.syncedWithStart="true",t.dataset.syncedValue=i,t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0})),s=!1),N()};e.addEventListener("change",n),e.addEventListener("input",n),e.addEventListener("blur",n),t.addEventListener("input",()=>{s||(t.value===e.value?(t.dataset.syncedWithStart="true",t.dataset.syncedValue=t.value):t.dataset.syncedWithStart="false")}),t.value?.trim()||n(),e.dataset.timeSyncAttached="true"}async function ft(){const e=document.getElementById("res-customer"),t=document.getElementById("res-project"),s=e?.value?String(e.value):"",n=t?.value?String(t.value):"",{customers:i}=M(),a=i.find(D=>String(D.id)===s);if(!a){g(r("reservations.toast.customerNotFound","⚠️ لم يتم العثور على العميل بالاسم المدخل"));return}const o=a.id,c=document.getElementById("res-start").value,d=document.getElementById("res-end").value,m=document.getElementById("res-start-time")?.value||"00:00",l=document.getElementById("res-end-time")?.value||"00:00";if(!c||!d){g(r("reservations.toast.requireDates","⚠️ يرجى تحديد تاريخ البداية والنهاية"));return}const h=`${c}T${m}`,y=`${d}T${l}`,v=new Date(h),q=new Date(y);if(Number.isNaN(v.getTime())||Number.isNaN(q.getTime())||v>=q){g(r("reservations.toast.invalidDateRange","⚠️ تأكد من أن تاريخ ووقت البداية يسبق تاريخ ووقت النهاية"));return}const I=en(),b=Ie();if(b.length===0&&I.length===0){g(r("reservations.toast.noItems","⚠️ يجب إضافة معدة أو عضو واحد من الطاقم الفني على الأقل"));return}const u=document.getElementById("res-notes")?.value||"",f=parseFloat(p(document.getElementById("res-discount")?.value))||0,T=document.getElementById("res-discount-type")?.value||"percent",E=document.getElementById("res-payment-status")?.value||"unpaid",k=n?st(n):null,B=Dn(k);if(n&&!k){g(r("reservations.toast.projectNotFound","⚠️ لم يتم العثور على المشروع المحدد. حاول تحديث الصفحة."));return}for(const D of b)if(ue(D.barcode)){g(r("reservations.toast.cannotCreateEquipmentMaintenance","⚠️ لا يمكن إتمام الحجز لأن إحدى المعدات قيد الصيانة"));return}for(const D of b){const O=P(D.barcode);if(de(O,h,y)){g(r("reservations.toast.cannotCreateEquipmentConflict","⚠️ لا يمكن إتمام الحجز، إحدى المعدات محجوزة في نفس الفترة الزمنية"));return}}for(const D of I)if(Et(D,h,y)){g(r("reservations.toast.cannotCreateCrewConflict","⚠️ لا يمكن إتمام الحجز، أحد أعضاء الطاقم مرتبط بحجز آخر في نفس الفترة"));return}const C=document.getElementById("res-tax"),L=!!n?!1:C?.checked||!1,x=wt(b,f,T,L,I,{start:h,end:y}),H=Ys(),j=It({reservationCode:H,customerId:o,start:h,end:y,status:B?"confirmed":"pending",title:null,location:null,notes:u,projectId:n||null,totalAmount:x,discount:f,discountType:T,applyTax:L,paidStatus:E,confirmed:B,items:b.map(D=>({...D,equipmentId:D.equipmentId??D.id})),technicians:I});try{const D=await tn(j);sn(),me(),Be(),Nn(),g(r("reservations.toast.created","✅ تم إنشاء الحجز")),typeof Xe=="function"&&Xe({type:"created",reservation:D})}catch(D){console.error("❌ [reservations/createForm] Failed to create reservation",D);const O=St(D)?D.message:r("reservations.toast.createFailed","تعذر إنشاء الحجز، حاول مرة أخرى");g(O,"error")}}function Nn(){const e=document.getElementById("res-customer");e&&(e.value="",Ae(e)),document.getElementById("res-start").value="",document.getElementById("res-start-time").value="",document.getElementById("res-end").value="",document.getElementById("res-end-time").value="",document.getElementById("res-notes").value="",document.getElementById("res-discount").value="";const t=document.getElementById("res-tax");t&&(t.checked=!1,t.disabled=!1,t.classList.remove("disabled"));const s=document.getElementById("res-company-share");s&&(s.checked=!1);const n=document.getElementById("res-project");n&&(n.value="",Ae(n));const i=document.getElementById("equipment-description");i&&(i.value="");const a=document.getElementById("res-payment-status");a&&(a.value="unpaid",le(a,"unpaid")),nn(),an([]),pe(),Ce(),N()}function Pn(){const e=document.getElementById("reservation-items");!e||e.dataset.listenerAttached||(e.addEventListener("click",t=>{const s=t.target.closest('button[data-action="remove-item"]');if(!s)return;const n=Number(s.dataset.index);Zs(n),pe(),N()}),e.dataset.listenerAttached="true")}function Mn(){const e=document.getElementById("equipment-barcode");if(!e||e.dataset.listenerAttached)return;e.addEventListener("keydown",n=>{n.key==="Enter"&&(n.preventDefault(),We(e.value,e))});let t=null;const s=()=>{clearTimeout(t);const n=e.value;if(!n?.trim())return;const{start:i,end:a}=je();!i||!a||(t=setTimeout(()=>{We(n,e)},150))};e.addEventListener("input",s),e.addEventListener("change",()=>We(e.value,e)),e.dataset.listenerAttached="true"}function Fn(){const e=document.getElementById("reservation-form");e&&!e.dataset.listenerAttached&&(e.addEventListener("submit",async s=>{s.preventDefault(),await ft()}),e.dataset.listenerAttached="true");const t=document.getElementById("create-reservation-btn");t&&!t.dataset.listenerAttached&&(t.addEventListener("click",async s=>{s.preventDefault(),await ft()}),t.dataset.listenerAttached="true")}function ua({onAfterSubmit:e}={}){Xe=typeof e=="function"?e:null;const{customers:t,projects:s}=M();Js(t||[]),ne(),Dt(s||[]),at({projectsList:s}),me(),Bn(),Rn(),jn(),Pn(),Mn(),Fn(),$n(),N(),pe()}function Rt(){me(),at(),ne(),pe(),N()}if(typeof document<"u"){const e=()=>{ne(),at(),N()};document.addEventListener("language:changed",e),document.addEventListener("language:translationsReady",e)}function Nt(e){const t=new Date;if(t.setHours(0,0,0,0),e==="today")return{startDate:Z(t),endDate:Z(t)};if(e==="week"){const s=new Date(t),n=s.getDay(),i=n===0?6:n-1;s.setDate(s.getDate()-i);const a=new Date(s);return a.setDate(s.getDate()+6),{startDate:Z(s),endDate:Z(a)}}if(e==="month"){const s=new Date(t.getFullYear(),t.getMonth(),1),n=new Date(t.getFullYear(),t.getMonth()+1,0);return{startDate:Z(s),endDate:Z(n)}}return e==="upcoming"?{startDate:Z(t),endDate:""}:{startDate:"",endDate:""}}function Hn(){const e=document.getElementById("search-reservation"),t=document.getElementById("filter-start-date"),s=document.getElementById("filter-end-date"),n=document.getElementById("reservation-date-range"),i=document.getElementById("reservation-status-filter");let a=p(t?.value||"").trim(),o=p(s?.value||"").trim(),c=n?.value||"";if(new Set(["","today","week","month"]).has(c)||(c="",n&&(n.value=""),Le(t),Le(s),a="",o=""),!a&&!o&&c){const m=Nt(c);a=m.startDate,o=m.endDate}return{searchTerm:z(e?.value||""),startDate:a,endDate:o,status:i?.value||"",quickRange:c}}function ma(e){const t=()=>{typeof e=="function"&&e()},s=document.getElementById("search-reservation");s&&!s.dataset.listenerAttached&&(s.addEventListener("input",()=>{s.value=p(s.value),t()}),s.dataset.listenerAttached="true");const n=document.getElementById("filter-start-date");n&&!n.dataset.listenerAttached&&(n.addEventListener("change",()=>{const d=document.getElementById("reservation-date-range");d&&(d.value=""),t()}),n.dataset.listenerAttached="true");const i=document.getElementById("filter-end-date");i&&!i.dataset.listenerAttached&&(i.addEventListener("change",()=>{const d=document.getElementById("reservation-date-range");d&&(d.value=""),t()}),i.dataset.listenerAttached="true");const a=document.getElementById("reservation-date-range");a&&!a.dataset.listenerAttached&&(a.addEventListener("change",()=>{Vn(a.value),t()}),a.dataset.listenerAttached="true");const o=document.getElementById("reservation-status-filter");o&&!o.dataset.listenerAttached&&(o.addEventListener("change",t),o.dataset.listenerAttached="true");const c=document.getElementById("clear-filters");c&&!c.dataset.listenerAttached&&(c.addEventListener("click",()=>{s&&(s.value=""),Le(n),Le(i),a&&(a.value=""),o&&(o.value=""),t()}),c.dataset.listenerAttached="true")}function Vn(e){const t=document.getElementById("filter-start-date"),s=document.getElementById("filter-end-date");if(!t||!s)return;const{startDate:n,endDate:i}=Nt(e);t._flatpickr?n?t._flatpickr.setDate(n,!1,"Y-m-d"):t._flatpickr.clear():t.value=n,s._flatpickr?i?s._flatpickr.setDate(i,!1,"Y-m-d"):s._flatpickr.clear():s.value=i}function Z(e){if(!e)return"";const t=e.getTimezoneOffset()*6e4;return new Date(e.getTime()-t).toISOString().split("T")[0]}function Le(e){e&&(e._flatpickr&&e._flatpickr.clear(),e.value="")}function _n({reservations:e=[],filters:t={},customersMap:s,techniciansMap:n,projectsMap:i}){const a=e.map((u,f)=>({reservation:u,index:f})),o=t.searchTerm||"",c=t.searchReservationId||"",d=t.searchCustomerName||"",m=t.startDate||"",l=t.endDate||"",h=t.status||"",y=Object.prototype.hasOwnProperty.call(t,"customerId")?t.customerId:null,v=Object.prototype.hasOwnProperty.call(t,"technicianId")?t.technicianId:null,q=m?new Date(`${m}T00:00:00`):null,I=l?new Date(`${l}T23:59:59`):null,b=a.filter(({reservation:u})=>{const f=s.get(String(u.customerId)),T=i?.get?.(String(u.projectId)),E=u.start?new Date(u.start):null,k=ye(u),{effectiveConfirmed:B}=ae(u,T);if(y!=null&&String(u.customerId)!==String(y)||v!=null&&!(Array.isArray(u.technicians)?u.technicians.map(H=>String(H)):[]).includes(String(v))||h==="confirmed"&&!B||h==="pending"&&B||h==="completed"&&!k||q&&E&&E<q||I&&E&&E>I||c&&!z([u.reservationId,u.id].filter(Boolean).map(String).join(" ")).includes(c)||d&&!z(f?.customerName||"").includes(d))return!1;if(!o)return!0;const C=u.items?.map?.(x=>`${x.barcode} ${x.desc}`).join(" ")||"",A=(u.technicians||[]).map(x=>n.get(String(x))?.name).filter(Boolean).join(" ");return z([u.reservationId,f?.customerName,u.notes,C,A,T?.title].filter(Boolean).join(" ")).includes(o)});return b.sort((u,f)=>{const T=ye(u.reservation),E=ye(f.reservation);if(T!==E)return T?1:-1;const k=u.reservation.start?new Date(u.reservation.start).getTime():0;return(f.reservation.start?new Date(f.reservation.start).getTime():0)-k}),b}function Un({entries:e,customersMap:t,techniciansMap:s,projectsMap:n}){const i=r("reservations.create.summary.currency","ريال"),a=r("reservations.list.taxIncludedShort","(شامل الضريبة)"),o=r("reservations.list.unknownCustomer","غير معروف"),c=r("reservations.list.noNotes","لا توجد ملاحظات"),d=r("reservations.list.itemsCountShort","{count} عنصر"),m=r("reservations.list.crew.separator","، "),l=r("reservations.list.status.confirmed","✅ مؤكد"),h=r("reservations.list.status.pending","⏳ غير مؤكد"),y=r("reservations.list.payment.paid","💳 مدفوع"),v=r("reservations.list.payment.unpaid","💳 غير مدفوع"),q=r("reservations.list.actions.confirm","✔️ تأكيد"),I=r("reservations.list.project.unlinked","غير مرتبط بمشروع"),b=r("reservations.edit.project.missing","⚠️ المشروع غير متوفر (تم حذفه)"),u={client:r("reservations.list.labels.client","👤 العميل"),project:r("reservations.list.labels.project","📁 المشروع"),start:r("reservations.list.labels.start","🗓️ بداية الحجز"),end:r("reservations.list.labels.end","🗓️ نهاية الحجز"),cost:r("reservations.list.labels.cost","💵 التكلفة"),equipment:r("reservations.list.labels.equipment","📦 المعدات"),crew:r("reservations.list.labels.crew","😎 الفريق")};return e.map(({reservation:f,index:T})=>{const E=t.get(String(f.customerId)),k=f.projectId?n?.get?.(String(f.projectId)):null,B=ye(f),C=f.paid===!0||f.paid==="paid",{effectiveConfirmed:A,projectLinked:L}=ae(f,k);let x=A?`<span class="badge bg-success reservation-chip">${l}</span>`:`<span class="badge bg-warning text-dark reservation-chip">${h}</span>`,H=C?`<span class="badge bg-primary reservation-chip">${y}</span>`:`<span class="badge bg-danger reservation-chip">${v}</span>`,j=C?" tile-paid":" tile-unpaid";B&&(j+=" tile-completed");let D="";B&&(x=`<span class="badge reservation-chip chip-completed">${l}</span>`,H=`<span class="badge reservation-chip chip-completed">${C?y:v}</span>`,D=` data-completed-label="${r("reservations.list.ribbon.completed","منتهي").replace(/"/g,"&quot;")}"`);const O=!L&&!A?`<button class="btn btn-sm btn-success tile-confirm" data-reservation-index="${T}" data-action="confirm">${q}</button>`:"",G=f.items?.length||0,W=(f.technicians||[]).map(re=>s.get(String(re))).filter(Boolean),fe=W.map(re=>re.name).join(m)||"—",xe=p(String(f.reservationId??"")),_=f.start?p(te(f.start)):"-",he=f.end?p(te(f.end)):"-",$=p(String(f.cost??0)),Q=p(String(G)),Me=f.notes?p(f.notes):c,Fe=d.replace("{count}",Q),He=f.applyTax?`<small>${a}</small>`:"";let ke=I;return f.projectId&&(ke=k?.title?p(k.title):b),`
      <div class="reservation-tile${j}"${D} data-reservation-index="${T}" data-action="details">
        <div class="tile-top">
          <div class="tile-id">${xe}</div>
          <div class="tile-badges">
            ${x}
            ${H}
          </div>
        </div>
        <div class="tile-body">
          <div class="tile-row">
            <span class="tile-label">${u.client}</span>
            <span class="tile-value">${E?.customerName||o}</span>
          </div>
          <div class="tile-row">
            <span class="tile-label">${u.project}</span>
            <span class="tile-value">${ke}</span>
          </div>
          <div class="tile-row">
            <span class="tile-label">${u.start}</span>
            <span class="tile-value tile-inline">${_}</span>
          </div>
          <div class="tile-row">
            <span class="tile-label">${u.end}</span>
            <span class="tile-value tile-inline">${he}</span>
          </div>
          <div class="tile-row">
            <span class="tile-label">${u.cost}</span>
            <span class="tile-value">${$} ${i} ${He}</span>
          </div>
          <div class="tile-row">
            <span class="tile-label">${u.equipment}</span>
            <span class="tile-value">${Fe}</span>
          </div>
          <div class="tile-row">
            <span class="tile-label">${u.crew}</span>
            <span class="tile-value">${W.length?fe:"—"}</span>
          </div>
        </div>
        <div class="tile-footer">
          <span class="tile-notes">📝 ${Me}</span>
          ${O}
        </div>
      </div>
    `}).join("")}function Qe(e=""){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function On(e,t,s=[],n,i=null){const{projectLinked:a,effectiveConfirmed:o}=ae(e,i),c=e.paid===!0||e.paid==="paid",d=ye(e),m=e.items||[],{technicians:l=[]}=M(),h=[].concat(Array.isArray(s)?s:[]).concat(Array.isArray(l)?l:[]),y=new Map;h.forEach(w=>{if(!w||w.id==null)return;const R=String(w.id),V=y.get(R)||{};y.set(R,{...V,...w})});const v=(e.technicians||[]).map(w=>y.get(String(w))).filter(Boolean),q=gt(),I=xt(e.start,e.end),b=(w={})=>{const R=[w.dailyWage,w.daily_rate,w.dailyRate,w.wage,w.rate];for(const V of R){if(V==null)continue;const oe=parseFloat(p(String(V)));if(Number.isFinite(oe))return oe}return 0},f=m.reduce((w,R)=>w+(R.qty||1)*(R.price||0),0)*I,E=v.reduce((w,R)=>w+b(R),0)*I,k=f+E,B=parseFloat(e.discount)||0,C=e.discountType==="amount"?B:k*(B/100),A=Math.max(0,k-C),L=a?!1:e.applyTax,x=L?A*.15:0,H=Number(e.cost),j=Number.isFinite(H),D=A+x,O=a?Math.round(D):j?H:Math.round(D),G=e.companySharePercent??e.company_share_percent??e.companyShare??e.company_share,W=G!=null?parseFloat(p(String(G))):NaN,_=((e.companyShareEnabled??e.company_share_enabled??e.companyShareApplied)===!0||Number.isFinite(W)&&W>0)&&Number.isFinite(W)?W:0,he=_>0?Math.max(0,(Number.isFinite(O)?O:0)*(_/100)):0,$=p(String(e.reservationId??e.id??"")),Q=e.start?p(te(e.start)):"-",Me=e.end?p(te(e.end)):"-",Fe=p(String(v.length)),He=p(f.toFixed(2)),ke=p(C.toFixed(2)),re=p(A.toFixed(2)),ot=p(x.toFixed(2)),Ot=p((O??0).toFixed(2)),zt=p(String(I)),Y=r("reservations.create.summary.currency","ريال"),Wt=r("reservations.details.labels.discount","الخصم"),Qt=r("reservations.details.labels.tax","الضريبة (15%)"),Yt=r("reservations.details.labels.crewTotal","إجمالي الفريق"),Xt=r("reservations.details.labels.subtotalAfterDiscount","الإجمالي"),Gt=r("reservations.details.labels.duration","عدد الأيام"),Kt=r("reservations.details.labels.companyShare","🏦 نسبة الشركة"),ie={index:"#",code:r("reservations.details.table.headers.code","الكود"),description:r("reservations.details.table.headers.description","الوصف"),quantity:r("reservations.details.table.headers.quantity","الكمية"),price:r("reservations.details.table.headers.price","السعر"),image:r("reservations.details.table.headers.image","الصورة")},Jt=r("reservations.details.noItems","📦 لا توجد معدات ضمن هذا الحجز حالياً."),Zt=r("reservations.details.noCrew","😎 لا يوجد فريق مرتبط بهذا الحجز."),es=r("reservations.details.technicians.roleUnknown","غير محدد"),ts=r("reservations.details.technicians.phoneUnknown","غير متوفر"),ss=r("reservations.details.technicians.wage","{amount} {currency} / اليوم"),ns=r("reservations.list.status.confirmed","✅ مؤكد"),as=r("reservations.list.status.pending","⏳ غير مؤكد"),rs=r("reservations.list.payment.paid","💳 مدفوع"),is=r("reservations.list.payment.unpaid","💳 غير مدفوع"),os=r("reservations.list.status.completed","📁 منتهي"),cs=r("reservations.details.labels.id","🆔 رقم الحجز"),ls=r("reservations.details.section.bookingInfo","بيانات الحجز"),ds=r("reservations.details.section.paymentSummary","ملخص الدفع"),us=r("reservations.details.labels.finalTotal","المجموع النهائي"),ms=r("reservations.details.section.crew","😎 الفريق الفني"),ps=r("reservations.details.crew.count","{count} عضو"),vs=r("reservations.details.section.items","📦 المعدات المرتبطة"),fs=r("reservations.details.items.count","{count} عنصر"),hs=r("reservations.details.actions.edit","✏️ تعديل"),bs=r("reservations.details.actions.delete","🗑️ حذف"),gs=r("reservations.details.labels.customer","العميل"),ys=r("reservations.details.labels.contact","رقم التواصل"),qs=r("reservations.details.labels.project","📁 المشروع المرتبط");r("reservations.details.project.unlinked","غير مرتبط بأي مشروع.");const Es=r("reservations.edit.project.missing","⚠️ المشروع غير متوفر (تم حذفه)"),ws=r("reservations.details.actions.openProject","📁 فتح المشروع"),Is=r("reservations.details.labels.start","بداية الحجز"),Ss=r("reservations.details.labels.end","نهاية الحجز"),Cs=r("reservations.details.labels.notes","ملاحظات"),xs=r("reservations.list.noNotes","لا توجد ملاحظات"),ks=r("reservations.details.labels.itemsCount","عدد المعدات"),Ts=r("reservations.details.labels.itemsTotal","إجمالي المعدات"),As=r("reservations.details.labels.paymentStatus","حالة الدفع"),Ds=r("reservations.list.unknownCustomer","غير معروف"),ct=c?rs:is,lt=m.length,Ls=p(String(lt)),dt=fs.replace("{count}",Ls),$s=ps.replace("{count}",Fe),Bs=e.notes?p(e.notes):xs,js=p(E.toFixed(2)),Rs=p(String(_)),Ns=p(he.toFixed(2)),Ps=`${Rs}% (${Ns} ${Y})`,K=[{icon:"💳",label:As,value:ct},{icon:"📦",label:ks,value:dt},{icon:"⏱️",label:Gt,value:zt},{icon:"💼",label:Ts,value:`${He} ${Y}`}];K.push({icon:"😎",label:Yt,value:`${js} ${Y}`}),C>0&&K.push({icon:"💸",label:Wt,value:`${ke} ${Y}`}),K.push({icon:"📊",label:Xt,value:`${re} ${Y}`}),L&&x>0&&K.push({icon:"🧾",label:Qt,value:`${ot} ${Y}`}),_>0&&K.push({icon:"🏦",label:Kt,value:Ps}),K.push({icon:"💰",label:us,value:`${Ot} ${Y}`});const Ms=K.map(({icon:w,label:R,value:V})=>`
    <div class="summary-details-row">
      <span class="summary-details-label">${w} ${R}</span>
      <span class="summary-details-value">${V}</span>
    </div>
  `).join(""),ut=[{text:o?ns:as,className:o?"status-confirmed":"status-pending"},{text:ct,className:c?"status-paid":"status-unpaid"}];d&&ut.push({text:os,className:"status-completed"});const Fs=ut.map(({text:w,className:R})=>`<span class="status-chip ${R}">${w}</span>`).join(""),be=(w,R,V)=>`
    <div class="res-info-row">
      <span class="label">${w} ${R}</span>
      <span class="value">${V}</span>
    </div>
  `;let Ve="";if(e.projectId){let w=Qe(Es);if(i){const R=i.title||r("projects.fallback.untitled","مشروع بدون اسم");w=`${Qe(R)} <button type="button" class="btn btn-sm btn-outline-primary" data-action="open-project" data-project-id="${i.id}">${Qe(ws)}</button>`}Ve=`
      <div class="res-info-row">
        <span class="label">📁 ${qs}</span>
        <span class="value">${w}</span>
      </div>
    `}const J=[];J.push(be("👤",gs,t?.customerName||Ds)),J.push(be("📞",ys,t?.phone||"—")),J.push(be("🗓️",Is,Q)),J.push(be("🗓️",Ss,Me)),J.push(be("📝",Cs,Bs)),Ve&&J.push(Ve);const Hs=J.join(""),Vs=lt?m.map((w,R)=>{const V=Se(w),oe=p(String(w.barcode||"-")),_e=p(String(w.qty||1)),Te=p(String(w.price||0)),zs=p(String(R+1)),Ws=V?`<img src="${V}" alt="${w.desc||""}" class="reservation-modal-item-thumb">`:"-";return`
          <tr>
            <td>${zs}</td>
            <td>${oe}</td>
            <td>${w.desc||"-"}</td>
            <td>${_e}</td>
            <td>${Te} ${Y}</td>
            <td>${Ws}</td>
          </tr>
        `}).join(""):`<tr><td colspan="6" class="text-center">${Jt}</td></tr>`,_s=`
    <div class="table-responsive reservation-modal-items-wrapper">
      <table class="table table-sm table-hover align-middle reservation-modal-items-table">
        <thead>
          <tr>
            <th>${ie.index}</th>
            <th>${ie.code}</th>
            <th>${ie.description}</th>
            <th>${ie.quantity}</th>
            <th>${ie.price}</th>
            <th>${ie.image}</th>
          </tr>
        </thead>
        <tbody>${Vs}</tbody>
      </table>
    </div>
  `,Us=v.map((w,R)=>{const V=p(String(R+1)),oe=w.role||es,_e=w.phone||ts,Te=w.wage?ss.replace("{amount}",p(String(w.wage))).replace("{currency}",Y):"";return`
      <div class="reservation-technician-card">
        <div class="technician-card-head">
          <span class="technician-index">${V}</span>
          <span class="technician-name">${w.name}</span>
        </div>
        <div class="technician-card-body">
          <div>🎯 ${oe}</div>
          <div>📞 ${_e}</div>
          ${Te?`<div>💰 ${Te}</div>`:""}
        </div>
      </div>
    `}).join(""),Os=v.length?`<div class="reservation-technicians-grid">${Us}</div>`:`<ul class="reservation-modal-technicians"><li>${Zt}</li></ul>`;return`
    <div class="reservation-modal">
      <div class="reservation-modal-header">
        <div class="reservation-modal-id">
          <span>${cs}</span>
          <strong>${$}</strong>
        </div>
        <div class="status-chips">
          ${Fs}
        </div>
      </div>

      <div class="reservation-modal-grid">
        <div class="reservation-info-card">
          <h6>${ls}</h6>
          ${Hs}
        </div>
        <div class="reservation-summary-card">
          <div class="summary-icon">💳</div>
          <div class="summary-body">
            <h6 class="summary-heading">${ds}</h6>
            <div class="summary-details">
              ${Ms}
            </div>
          </div>
        </div>
      </div>

      <div class="reservation-technicians-section">
        <div class="section-title">
          <span>${ms}</span>
          <span class="count">${$s}</span>
        </div>
        ${Os}
      </div>

      <div class="reservation-items-section">
        <div class="section-title">
          <span>${vs}</span>
          <span class="count">${dt}</span>
        </div>
        ${_s}
      </div>

      <div class="reservation-modal-actions">
        <button type="button" class="btn btn-outline-primary" id="reservation-details-export-btn" data-index="${n}">
          ${r("reservations.details.actions.exportPdf","📄 تصدير PDF")}
        </button>
        <button type="button" class="btn btn-warning" id="reservation-details-edit-btn" data-index="${n}">${hs}</button>
        ${q?`<button type="button" class="btn btn-danger" id="reservation-details-delete-btn" data-index="${n}">${bs}</button>`:""}
      </div>
    </div>
  `}const zn="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js";function Wn(e){return new Promise((t,s)=>{const n=document.querySelector(`script[src="${e}"]`);if(n){n.addEventListener("load",()=>t()),n.addEventListener("error",a=>s(a)),n.readyState==="complete"&&t();return}const i=document.createElement("script");i.src=e,i.async=!0,i.onload=()=>t(),i.onerror=a=>s(a),document.head.appendChild(i)})}async function Qn(){window.html2pdf||await Wn(zn)}function S(e=""){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function Yn(e={}){const t=[e.dailyWage,e.daily_rate,e.dailyRate,e.wage,e.rate];for(const s of t){if(s==null)continue;const n=parseFloat(p(String(s)));if(Number.isFinite(n))return n}return 0}function Xn(e){const t=Be()||[],{technicians:s=[]}=M(),n=[].concat(Array.isArray(t)?t:[]).concat(Array.isArray(s)?s:[]),i=new Map;return n.forEach(a=>{if(!a||a.id==null)return;const o=String(a.id),c=i.get(o)||{};i.set(o,{...c,...a})}),(e.technicians||[]).map(a=>i.get(String(a))).filter(Boolean)}function Gn({reservation:e,customer:t,project:s,technicians:n,totals:i,rentalDays:a,currencyLabel:o}){const c=p(String(e?.reservationId??e?.id??"")),d=e.start?p(te(e.start)):"-",m=e.end?p(te(e.end)):"-",l=e.createdAt?p(te(e.createdAt)):"-",h=t?.full_name||t?.name||"-",y=t?.phone||"-",v=t?.email||"-",q=t?.company||t?.company_name||"-",I=s?.title||s?.name||r("reservations.details.project.none","غير مرتبط بمشروع"),b=p(String(a)),u=e?.notes||"",f=n.length?n.map(E=>{const k=S(E?.name||E?.full_name||"-"),B=S(E?.role||r("reservations.details.technicians.roleUnknown","غير محدد")),C=S(E?.phone||r("reservations.details.technicians.phoneUnknown","غير متوفر"));return`<li><strong>${k}</strong><br><span>${B}</span><br><span>${C}</span></li>`}).join(""):`<li>${S(r("reservations.details.noCrew","😎 لا يوجد فريق مرتبط بهذا الحجز."))}</li>`,T=Array.isArray(e.items)&&e.items.length?e.items.map((E,k)=>{const B=p(String(k+1)),C=S(E?.barcode||"-"),A=S(E?.desc||E?.description||"-"),L=p(String(E?.qty||1)),x=p(Number(E?.price||0).toFixed(2));return`<tr>
          <td>${B}</td>
          <td>${C}</td>
          <td>${A}</td>
          <td>${L}</td>
          <td>${x}</td>
        </tr>`}).join(""):`<tr>
        <td colspan="5" class="empty">${S(r("reservations.details.noItems","📦 لا توجد معدات ضمن هذا الحجز حالياً."))}</td>
      </tr>`;return`
    <div id="reservation-pdf-root" dir="rtl">
      <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap');
        #reservation-pdf-root {
          width: 210mm;
          min-height: 297mm;
          box-sizing: border-box;
          padding: 14mm 16mm;
          font-family: 'Tajawal', sans-serif;
          color: #111827;
          background: #ffffff;
        }
        #reservation-pdf-root h1,
        #reservation-pdf-root h2,
        #reservation-pdf-root h3,
        #reservation-pdf-root h4,
        #reservation-pdf-root h5,
        #reservation-pdf-root h6 {
          margin: 0;
        }
        .pdf-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 16px;
        }
        .pdf-header h1 {
          font-size: 22px;
          font-weight: 700;
        }
        .pdf-meta {
          display: grid;
          grid-template-columns: repeat(2, minmax(0, 1fr));
          gap: 8px 16px;
          margin-bottom: 18px;
        }
        .pdf-section {
          margin-bottom: 18px;
        }
        .pdf-section h3 {
          font-size: 16px;
          font-weight: 600;
          margin-bottom: 8px;
        }
        .pdf-section ul {
          list-style: none;
          padding: 0;
          margin: 0;
        }
        .pdf-section ul li {
          margin-bottom: 6px;
          line-height: 1.5;
        }
        table {
          width: 100%;
          border-collapse: collapse;
          font-size: 12px;
        }
        table th {
          background: #f3f4f6;
          padding: 8px;
          text-align: center;
        }
        table td {
          padding: 8px;
          border-bottom: 1px solid #e5e7eb;
          text-align: center;
        }
        table td:nth-child(3),
        table td:nth-child(4),
        table td:nth-child(5) {
          font-weight: 600;
        }
        table .empty {
          text-align: center;
          padding: 16px;
          font-weight: 500;
        }
        .totals-grid {
          display: grid;
          grid-template-columns: repeat(2, minmax(0, 1fr));
          gap: 8px 16px;
          margin: 12px 0;
          font-size: 13px;
        }
        .totals-grid div {
          display: flex;
          justify-content: space-between;
          background: #f9fafb;
          padding: 8px 12px;
          border-radius: 8px;
        }
        .totals-grid div span:first-child {
          font-weight: 600;
        }
        .notes {
          background: #f9fafb;
          border-radius: 8px;
          padding: 12px;
          min-height: 60px;
          white-space: pre-wrap;
          font-size: 12px;
        }
      </style>

      <div class="pdf-header">
        <h1>${S(r("reservations.details.export.title","تفاصيل الحجز"))}</h1>
        <div>
          <div>${S(r("reservations.details.labels.reservationId","رقم الحجز"))}: <strong>${c||"-"}</strong></div>
          <div>${S(r("reservations.details.labels.createdAt","تاريخ الإنشاء"))}: ${l}</div>
        </div>
      </div>

      <div class="pdf-meta">
        <div>${S(r("reservations.details.labels.customer","العميل"))}: <strong>${S(h)}</strong></div>
        <div>${S(r("reservations.details.labels.company","الشركة"))}: ${S(q)}</div>
        <div>${S(r("reservations.details.labels.phone","الهاتف"))}: ${S(y)}</div>
        <div>${S(r("reservations.details.labels.email","البريد"))}: ${S(v)}</div>
        <div>${S(r("reservations.details.labels.start","تاريخ البداية"))}: ${d}</div>
        <div>${S(r("reservations.details.labels.end","تاريخ النهاية"))}: ${m}</div>
        <div>${S(r("reservations.details.labels.duration","عدد الأيام"))}: ${b}</div>
        <div>${S(r("reservations.details.labels.project","المشروع"))}: ${S(I)}</div>
      </div>

      <div class="pdf-section">
        <h3>${S(r("reservations.details.labels.summary","الملخص المالي"))}</h3>
        <div class="totals-grid">
          <div><span>${S(r("reservations.details.labels.equipmentTotal","إجمالي المعدات"))}</span><span>${i.equipmentTotal} ${o}</span></div>
          <div><span>${S(r("reservations.details.labels.crewTotal","إجمالي الفريق"))}</span><span>${i.crewTotal} ${o}</span></div>
          <div><span>${S(r("reservations.details.labels.discount","الخصم"))}</span><span>${i.discountAmount} ${o}</span></div>
          <div><span>${S(r("reservations.details.labels.tax","الضريبة (15%)"))}</span><span>${i.taxAmount} ${o}</span></div>
          <div><span>${S(r("reservations.details.labels.total","الإجمالي النهائي"))}</span><span><strong>${i.finalTotal} ${o}</strong></span></div>
        </div>
      </div>

      <div class="pdf-section">
        <h3>${S(r("reservations.details.technicians.title","طاقم العمل"))}</h3>
        <ul>${f}</ul>
      </div>

      <div class="pdf-section">
        <h3>${S(r("reservations.details.items.title","المعدات"))}</h3>
        <table>
          <thead>
            <tr>
              <th>#</th>
              <th>${S(r("reservations.details.table.headers.code","الكود"))}</th>
              <th>${S(r("reservations.details.table.headers.description","الوصف"))}</th>
              <th>${S(r("reservations.details.table.headers.quantity","الكمية"))}</th>
              <th>${S(r("reservations.details.table.headers.price","السعر"))}</th>
            </tr>
          </thead>
          <tbody>
            ${T}
          </tbody>
        </table>
      </div>

      <div class="pdf-section">
        <h3>${S(r("reservations.details.labels.notes","ملاحظات الحجز"))}</h3>
        <div class="notes">${S(u)}</div>
      </div>
    </div>
  `}async function Kn({reservation:e,customer:t,project:s}){if(!e){g(r("reservations.toast.notFound","⚠️ تعذر العثور على بيانات الحجز"));return}await Qn();const n=Xn(e),{projectLinked:i}=ae(e,s),a=xt(e.start,e.end),d=(Array.isArray(e.items)?e.items:[]).reduce((L,x)=>L+(Number(x?.qty)||1)*(Number(x?.price)||0),0)*a,l=n.reduce((L,x)=>L+Yn(x),0)*a,h=d+l,y=parseFloat(e.discount)||0,v=e.discountType==="amount"?y:h*(y/100),q=Math.max(0,h-v),b=(i?!1:e.applyTax)?q*.15:0,u=Number(e.cost),f=Number.isFinite(u),T=q+b,E=i?Math.round(T):f?u:Math.round(T),k={equipmentTotal:p(d.toFixed(2)),crewTotal:p(l.toFixed(2)),discountAmount:p(v.toFixed(2)),taxAmount:p(b.toFixed(2)),finalTotal:p((E??0).toFixed(2))},B=r("reservations.create.summary.currency","ريال"),C=Gn({reservation:e,customer:t,project:s,technicians:n,totals:k,rentalDays:a,currencyLabel:B}),A=document.createElement("div");A.innerHTML=C,A.style.position="fixed",A.style.top="-10000px",A.style.left="0",A.style.zIndex="-1",document.body.appendChild(A);try{const x=`reservation-${p(String(e?.reservationId??e?.id??"export"))||"export"}.pdf`;await window.html2pdf().set({margin:[10,10,10,10],filename:x,html2canvas:{scale:2,useCORS:!0},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}}).from(A.firstElementChild).save()}finally{document.body.removeChild(A)}}function Jn({containerId:e="reservations-list",filters:t=null,onShowDetails:s,onConfirmReservation:n}={}){const i=Be(),{reservations:a=[],customers:o=[],technicians:c=[],projects:d=[]}=M(),m=Array.isArray(i)?i:c||[],l=new Map((d||[]).map(b=>[String(b.id),b])),h=document.getElementById(e);if(!h){console.warn("⚠️ [reservations/renderers] container not found",e);return}if(!a||a.length===0){h.innerHTML=`<p>${r("reservations.list.empty","⚠️ لا توجد حجوزات بعد.")}</p>`;return}const y=t||Hn(),v=new Map(o.map(b=>[String(b.id),b])),q=new Map(m.map(b=>[String(b.id),b])),I=_n({reservations:a,filters:y,customersMap:v,techniciansMap:q,projectsMap:l});if(I.length===0){h.innerHTML=`<p>${r("reservations.list.noResults","🔍 لا توجد حجوزات مطابقة للبحث.")}</p>`;return}h.innerHTML=`<div class="reservations-grid">${Un({entries:I,customersMap:v,techniciansMap:q,projectsMap:l})}</div>`,h.querySelectorAll('[data-action="details"]').forEach(b=>{const u=Number(b.dataset.reservationIndex);Number.isNaN(u)||b.addEventListener("click",()=>{typeof s=="function"&&s(u)})}),h.querySelectorAll('button[data-action="confirm"]').forEach(b=>{const u=Number(b.dataset.reservationIndex);Number.isNaN(u)||b.addEventListener("click",f=>{f.stopPropagation(),typeof n=="function"&&n(u,f)})})}function Zn(e,{onEdit:t,onDelete:s,getEditContext:n}={}){const{reservations:i=[],customers:a=[],projects:o=[]}=M(),c=i[e];if(!c)return g(r("reservations.toast.notFound","⚠️ تعذر العثور على بيانات الحجز")),!1;const d=a.find(u=>String(u.id)===String(c.customerId)),m=c.projectId?o.find(u=>String(u.id)===String(c.projectId)):null,l=document.getElementById("reservation-details-body");if(l){const u=Be()||[];l.innerHTML=On(c,d,u,e,m)}const h=document.getElementById("reservationDetailsModal"),y=()=>{h&&window.bootstrap?.Modal&&window.bootstrap.Modal.getInstance(h)?.hide()},v=document.getElementById("reservation-details-edit-btn");v&&(v.onclick=()=>{y(),typeof t=="function"&&t(e,{reservation:c,customer:d,getEditContext:n})});const q=document.getElementById("reservation-details-delete-btn");q&&(q.onclick=()=>{y(),typeof s=="function"&&s(e,{reservation:c,customer:d})});const I=l?.querySelector('[data-action="open-project"]');I&&m&&I.addEventListener("click",()=>{y();const u=m?.id!=null?String(m.id):"",f=u?`projects.html?project=${encodeURIComponent(u)}`:"projects.html";window.location.href=f});const b=document.getElementById("reservation-details-export-btn");return b&&(b.onclick=async()=>{try{await Kn({reservation:c,customer:d,project:m})}catch(u){console.error("❌ [reservations] export to PDF failed",u),g(r("reservations.details.actions.exportFailed","⚠️ تعذر تصدير الحجز إلى PDF"),"error")}}),h&&window.bootstrap?.Modal&&window.bootstrap.Modal.getOrCreateInstance(h).show(),!0}let we=null,X=[],Ke=null,U={};function Re(){return{index:we,items:X}}function Ne(e,t){we=typeof e=="number"?e:null,X=Array.isArray(t)?[...t]:[]}function Pt(){we=null,X=[],un()}function ea(e,t){return e?typeof t=="function"?t(e):window?.bootstrap?.Modal?window.bootstrap.Modal.getOrCreateInstance(e):typeof bootstrap<"u"&&bootstrap?.Modal?bootstrap.Modal.getOrCreateInstance(e):null:null}function ge(e=""){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function ta(e=[],t=null){const s=document.getElementById("edit-res-project");if(!s)return;const n=r("reservations.create.placeholders.project","اختر مشروعاً (اختياري)"),i=r("reservations.edit.project.missing","⚠️ المشروع غير متوفر (تم حذفه)"),a=t?.projectId?String(t.projectId):"",o=Array.isArray(e)?[...e].sort((d,m)=>String(m.createdAt||m.start||"").localeCompare(String(d.createdAt||d.start||""))):[],c=[`<option value="">${ge(n)}</option>`];o.forEach(d=>{c.push(`<option value="${ge(d.id)}">${ge(d.title||n)}</option>`)}),a&&!o.some(d=>String(d.id)===a)&&c.push(`<option value="${ge(a)}">${ge(i)}</option>`),s.innerHTML=c.join(""),a?s.value=a:s.value=""}function Mt(){const e=document.getElementById("edit-res-project"),t=document.getElementById("edit-res-tax");if(!t)return;if(!!e?.value)t.checked=!1,t.disabled=!0,t.classList.add("disabled");else{const n=t.disabled;t.disabled=!1,t.classList.remove("disabled"),n&&(t.checked=!1)}}function ht(e,{populateEquipmentDescriptionLists:t,setFlatpickrValue:s,splitDateTime:n,renderEditItems:i,updateEditReservationSummary:a,ensureModal:o}={}){const{customers:c,projects:d}=M(),l=kt()?.[e];if(!l){g(r("reservations.toast.notFound","⚠️ تعذر العثور على بيانات الحجز"));return}U={...U,reservation:l,projects:d||[]},t?.(),ta(d||[],l);const h=l.projectId&&d?.find?.(j=>String(j.id)===String(l.projectId))||null,{effectiveConfirmed:y,projectLinked:v}=ae(l,h),q=l.items?l.items.map(j=>({...j,equipmentId:j.equipmentId??j.equipment_id??j.id,barcode:P(j?.barcode)})):[];Ne(e,q);const I=r("reservations.list.unknownCustomer","غير معروف"),b=c?.find?.(j=>String(j.id)===String(l.customerId));document.getElementById("edit-res-index")?.setAttribute("value",String(e));const u=document.getElementById("edit-res-id");u&&(u.value=l.reservationId||l.id);const f=document.getElementById("edit-res-customer");f&&(f.value=b?.customerName||I);const T=typeof n=="function"?n(l.start):{date:"",time:""},E=typeof n=="function"?n(l.end):{date:"",time:""};s?.("edit-res-start",T.date),s?.("edit-res-start-time",T.time),s?.("edit-res-end",E.date),s?.("edit-res-end-time",E.time);const k=document.getElementById("edit-res-notes");k&&(k.value=l.notes||"");const B=document.getElementById("edit-res-discount");B&&(B.value=p(l.discount??0));const C=document.getElementById("edit-res-discount-type");C&&(C.value=l.discountType||"percent");const A=document.getElementById("edit-res-tax");A&&(A.checked=l.projectId?!1:!!l.applyTax);const L=document.getElementById("edit-res-confirmed");L&&(L.checked=y,L.disabled=v,L.classList.toggle("disabled",v),L.closest(".form-check")?.classList.toggle("disabled",v));const x=document.getElementById("edit-res-paid");x&&(x.value=l.paid===!0||l.paid==="paid"?"paid":"unpaid"),on((l.technicians||[]).map(j=>String(j))),i?.(q),Mt(),a?.();const H=document.getElementById("editReservationModal");Ke=ea(H,o),Ke?.show?.()}async function sa({combineDateTime:e,hasEquipmentConflict:t,hasTechnicianConflict:s,updateEditReservationSummary:n,renderReservations:i,populateEquipmentDescriptionLists:a,handleReservationsMutation:o}={}){if(we===null){console.warn("⚠️ [reservationsEdit.js] No reservation selected for editing");return}const c=document.getElementById("edit-res-start")?.value?.trim(),d=document.getElementById("edit-res-start-time")?.value?.trim()||"00:00",m=document.getElementById("edit-res-end")?.value?.trim(),l=document.getElementById("edit-res-end-time")?.value?.trim()||"00:00",h=document.getElementById("edit-res-notes")?.value||"",y=p(document.getElementById("edit-res-discount")?.value||"0"),v=parseFloat(y)||0,q=document.getElementById("edit-res-discount-type")?.value||"percent",I=document.getElementById("edit-res-confirmed")?.checked||!1,b=document.getElementById("edit-res-paid")?.value||"unpaid",u=document.getElementById("edit-res-project")?.value||"",f=cn();if(!c||!m){g(r("reservations.toast.requireDates","⚠️ يرجى تحديد تاريخ البداية والنهاية"));return}const T=typeof e=="function"?e:($,Q)=>`${$}T${Q||"00:00"}`,E=T(c,d),k=T(m,l);if(E&&k&&new Date(E)>new Date(k)){g(r("reservations.toast.invalidDateOrder","⚠️ تاريخ البداية لا يمكن أن يكون بعد تاريخ النهاية"));return}const C=kt()?.[we];if(!C){g(r("reservations.toast.reservationMissing","⚠️ تعذر العثور على الحجز المطلوب"));return}if(!Array.isArray(X)||X.length===0&&f.length===0){g(r("reservations.toast.updateNoItems","⚠️ يجب إضافة معدة أو عضو واحد من الطاقم الفني على الأقل للحجز"));return}for(const $ of X)if(ue($.barcode)){g(r("reservations.toast.updateEquipmentMaintenance","⚠️ لا يمكن حفظ التعديلات لأن إحدى المعدات قيد الصيانة"));return}const A=typeof t=="function"?t:()=>!1;for(const $ of X){const Q=P($.barcode);if(A(Q,E,k,C.id??C.reservationId)){g(r("reservations.toast.updateEquipmentConflict","⚠️ لا يمكن حفظ التعديلات بسبب تعارض في أحد المعدات"));return}}const L=typeof s=="function"?s:()=>!1;for(const $ of f)if(L($,E,k,C.id??C.reservationId)){g(r("reservations.toast.updateCrewConflict","⚠️ لا يمكن حفظ التعديلات بسبب تعارض في جدول أحد أعضاء الطاقم"));return}const x=document.getElementById("edit-res-tax"),H=Array.isArray(U.projects)&&U.projects.length?U.projects:M().projects||[],j=u&&H.find($=>String($.id)===String(u))||null,D={...C,projectId:u?String(u):null,confirmed:I},{effectiveConfirmed:O,projectLinked:G,projectStatus:W}=ae(D,j),fe=G?!1:x?.checked||!1,xe=wt(X,v,q,fe,f,{start:E,end:k});let _=C.status??"pending";G?_=j?.status??W??_:["completed","cancelled"].includes(String(_).toLowerCase())||(_=I?"confirmed":"pending");const he=It({reservationCode:C.reservationCode??C.reservationId??null,customerId:C.customerId,start:E,end:k,status:_,title:C.title??null,location:C.location??null,notes:h,projectId:u?String(u):null,totalAmount:xe,discount:v,discountType:q,applyTax:fe,paidStatus:b,confirmed:O,items:X.map($=>({...$,equipmentId:$.equipmentId??$.id})),technicians:f});try{const $=await ln(C.id||C.reservationId,he);await dn(),g(r("reservations.toast.updated","✅ تم حفظ التعديلات على الحجز")),n?.(),Pt(),o?.({type:"updated",reservation:$}),i?.(),a?.(),Ke?.hide?.()}catch($){console.error("❌ [reservationsEdit] Failed to update reservation",$);const Q=St($)?$.message:r("reservations.toast.updateFailed","تعذر تحديث بيانات الحجز");g(Q,"error")}}function pa(e={}){U={...e};const{updateEditReservationSummary:t,addEquipmentToEditingReservation:s,addEquipmentByDescription:n,renderEditItems:i}=U,a=document.getElementById("edit-res-discount");a&&!a.dataset.listenerAttached&&(a.addEventListener("input",()=>{a.value=p(a.value),t?.()}),a.dataset.listenerAttached="true");const o=document.getElementById("edit-res-discount-type");o&&!o.dataset.listenerAttached&&(o.addEventListener("change",()=>t?.()),o.dataset.listenerAttached="true");const c=document.getElementById("edit-res-tax");c&&!c.dataset.listenerAttached&&(c.addEventListener("change",()=>t?.()),c.dataset.listenerAttached="true");const d=document.getElementById("edit-res-project");d&&!d.dataset.listenerAttached&&(d.addEventListener("change",()=>{Mt();const v=document.getElementById("edit-res-confirmed");if(v){const q=Array.isArray(U.projects)&&U.projects.length?U.projects:M().projects||[],I=d.value&&q.find(E=>String(E.id)===String(d.value))||null,u={...U?.reservation??{},projectId:d.value||null,confirmed:v.checked},{effectiveConfirmed:f,projectLinked:T}=ae(u,I);v.checked=f,v.disabled=T,v.classList.toggle("disabled",T),v.closest(".form-check")?.classList.toggle("disabled",T)}t?.()}),d.dataset.listenerAttached="true");const m=document.getElementById("save-reservation-changes");m&&!m.dataset.listenerAttached&&(m.addEventListener("click",()=>{sa(U).catch(v=>{console.error("❌ [reservationsEdit] saveReservationChanges failed",v)})}),m.dataset.listenerAttached="true");const l=document.getElementById("edit-res-equipment-barcode");if(l&&!l.dataset.listenerAttached){l.addEventListener("keydown",I=>{I.key==="Enter"&&(I.preventDefault(),s?.(l))});let v=null;const q=()=>{if(clearTimeout(v),!l.value?.trim())return;const{start:I,end:b}=getEditReservationDateRange();!I||!b||(v=setTimeout(()=>{s?.(l)},150))};l.addEventListener("input",q),l.addEventListener("change",()=>s?.(l)),l.dataset.listenerAttached="true"}const h=document.getElementById("edit-res-equipment-description");h&&!h.dataset.listenerAttached&&(h.addEventListener("keydown",v=>{v.key==="Enter"&&(v.preventDefault(),n?.(h,"edit"))}),h.dataset.listenerAttached="true");const y=document.getElementById("editReservationModal");y&&!y.dataset.cleanupAttached&&(y.addEventListener("hidden.bs.modal",()=>{Pt(),t?.(),i?.([])}),y.dataset.cleanupAttached="true")}function rt(){const e=document.getElementById("edit-res-start")?.value?.trim(),t=document.getElementById("edit-res-end")?.value?.trim(),s=document.getElementById("edit-res-start-time")?.value?.trim()||"00:00",n=document.getElementById("edit-res-end-time")?.value?.trim()||"00:00";return!e||!t?{start:null,end:null}:{start:Ee(e,s),end:Ee(t,n)}}function Pe(e=[]){const t=document.getElementById("edit-res-items");if(!t)return;const s=r("reservations.create.equipment.none","لا توجد معدات"),n=r("reservations.create.summary.currency","ريال"),i=r("reservations.create.equipment.imageAlt","صورة");if(!e||e.length===0){t.innerHTML=`<tr><td colspan="6" class="text-center">${s}</td></tr>`,bt(t);return}t.innerHTML=e.map((a,o)=>{const c=Se(a),d=`${p(String(a.price??0))} ${n}`,m=p(String(a.qty||1)),l=c?`<img src="${c}" alt="${i}" class="reservation-item-thumb">`:"-";return`
        <tr>
          <td>${a.barcode||"-"}</td>
          <td>${a.desc||"-"}</td>
          <td>${d}</td>
          <td>${m}</td>
          <td>${l}</td>
          <td><button type="button" class="reservation-remove-button" data-action="remove-edit-item" data-item-index="${o}">🗑️</button></td>
        </tr>
      `}).join(""),bt(t)}function bt(e){!e||e.dataset.removeListenerAttached||(e.addEventListener("click",t=>{const s=t.target.closest('[data-action="remove-edit-item"]');if(!s)return;t.preventDefault();const n=Number(s.dataset.itemIndex);Number.isNaN(n)||na(n)}),e.dataset.removeListenerAttached="true")}function ve(){const e=document.getElementById("edit-res-summary");if(!e)return;const t=document.getElementById("edit-res-discount"),s=document.getElementById("edit-res-discount-type"),n=document.getElementById("edit-res-paid");n&&!n.dataset.listenerAttached&&(n.addEventListener("change",ve),n.dataset.listenerAttached="true"),le(n);const i=p(t?.value||"0");t&&(t.value=i);const a=parseFloat(i)||0,o=s?.value||"percent",c=!!document.getElementById("edit-res-project")?.value,d=document.getElementById("edit-res-tax"),m=c?!1:d?.checked||!1,l=n?.value||"unpaid";le(n,l);const{items:h=[]}=Re(),{start:y,end:v}=rt();e.innerHTML=mn({items:h,discount:a,discountType:o,applyTax:m,paidStatus:l,start:y,end:v})}function na(e){if(e==null)return;const{index:t,items:s}=Re();if(!Array.isArray(s))return;const n=s.filter((i,a)=>a!==e);Ne(t,n),Pe(n),ve()}function aa(e){const t=e?.value??"",s=P(t);if(!s)return;const n=et(s);if(!n){g(r("reservations.toast.barcodeNotInCatalog","❌ الباركود غير موجود ضمن المعدات"));return}if(ue(s)){g(r("reservations.toast.equipmentMaintenance","⚠️ هذه المعدة قيد الصيانة ولا يمكن إضافتها حالياً"));return}const i=P(s),{index:a,items:o=[]}=Re();if(o.findIndex(q=>P(q.barcode)===i)>-1){g(r("reservations.toast.equipmentDuplicate","⚠️ هذه المعدة موجودة بالفعل في الحجز"));return}const{start:d,end:m}=rt();if(!d||!m){g(r("reservations.toast.requireDatesBeforeAdd","⚠️ يرجى تحديد تاريخ ووقت البداية والنهاية قبل إضافة المعدات"));return}const{reservations:l=[]}=M(),h=a!=null&&l[a]||null,y=h?.id??h?.reservationId??null;if(de(i,d,m,y)){g(r("reservations.toast.equipmentTimeConflictSimple","⚠️ هذه المعدة محجوزة في نفس الفترة الزمنية"));return}const v=[...o,{id:n.id,equipmentId:n.id,barcode:i,desc:n.desc,qty:1,price:n.price,image:n.image||n.imageUrl||n.img||null}];Ne(a,v),e&&(e.value=""),Pe(v),ve()}function $e(e){if(!e)return;const t=e.value.trim();if(!t)return;const s=Bt(t),n=P(s?.barcode||t);if(!s||!n){g(r("reservations.toast.equipmentNameNotFound","❌ لم يتم العثور على معدة بالاسم المدخل"));return}if(ue(n)){g(r("reservations.toast.equipmentMaintenanceStrict","⚠️ لا يمكن إضافة معدة قيد الصيانة إلى الحجز"));return}const{start:i,end:a}=rt();if(!i||!a){g(r("reservations.toast.requireOverallDates","⚠️ يرجى تحديد تواريخ الحجز قبل إضافة المعدات"));return}const{index:o,items:c=[]}=Re();if(c.some(v=>P(v.barcode)===n)){g(r("reservations.toast.equipmentDuplicate","⚠️ هذه المعدة موجودة بالفعل في الحجز"));return}const{reservations:m=[]}=M(),l=o!=null&&m[o]||null,h=l?.id??l?.reservationId??null;if(de(n,i,a,h)){g(r("reservations.toast.equipmentTimeConflictSimple","⚠️ هذه المعدة محجوزة في نفس الفترة الزمنية"));return}const y=[...c,{id:s.id,equipmentId:s.id,barcode:n,desc:s.desc,qty:1,price:s.price,image:s.image||s.imageUrl||s.img||null}];Ne(o,y),Pe(y),ve(),e.value=""}function ra(){const e=document.getElementById("edit-res-equipment-description");if(e&&!e.dataset.listenerAttached){e.addEventListener("keydown",s=>{s.key==="Enter"&&(s.preventDefault(),$e(e))});const t=()=>{jt(e.value,"edit-res-equipment-description-options")&&$e(e)};e.addEventListener("input",t),e.addEventListener("change",t),e.dataset.listenerAttached="true"}}typeof document<"u"&&document.addEventListener("language:changed",()=>{ve()});function ia(e,t="create"){if(!(!e||!e.value.trim())){if(t==="create"){Ge(e);return}$e(e)}}function va(){me(),ra()}function oa(e,t){const s=document.getElementById(e);if(s){if(s._flatpickr){if(t){const n=s._flatpickr.config?.dateFormat||"Y-m-d";s._flatpickr.setDate(t,!1,n)}else s._flatpickr.clear();return}s.value=t||""}}function fa(){return fn().catch(e=>{console.warn("⚠️ [reservations/controller] Failed to refresh projects before loading form",e)}).finally(()=>{const{technicians:e}=M()||{};hn(e||[]),Rt()})}function it(e=null){Rt(),Ft(),typeof window.refreshCustomerReservationsViews=="function"&&window.refreshCustomerReservationsViews(),typeof window.refreshTechnicianReservationsViews=="function"&&window.refreshTechnicianReservationsViews();const t=e!=null?{detail:e}:{};document.dispatchEvent(new CustomEvent("reservations:changed",t))}function ca(e){return e?window?.bootstrap?.Modal?window.bootstrap.Modal.getOrCreateInstance(e):typeof bootstrap<"u"&&bootstrap?.Modal?bootstrap.Modal.getOrCreateInstance(e):null:null}function Je(){return{populateEquipmentDescriptionLists:me,setFlatpickrValue:oa,splitDateTime:yt,renderEditItems:Pe,updateEditReservationSummary:ve,addEquipmentByDescription:ia,addEquipmentToEditingReservation:aa,addEquipmentToEditingByDescription:$e,combineDateTime:Ee,hasEquipmentConflict:de,hasTechnicianConflict:Et,renderReservations:Ft,handleReservationsMutation:it,ensureModal:ca}}function Ft(e="reservations-list",t=null){Jn({containerId:e,filters:t,onShowDetails:Ht,onConfirmReservation:_t})}function Ht(e){return Zn(e,{getEditContext:Je,onEdit:(t,{reservation:s})=>{Ut(t,s)},onDelete:Vt})}function Vt(e){return gt()?window.confirm(r("reservations.toast.deleteConfirm","⚠️ هل أنت متأكد من حذف هذا الحجز؟"))?pn(e,{onAfterChange:it}):!1:(Xs(),!1)}function _t(e){return vn(e,{onAfterChange:it})}function Ut(e,t=null){if(document.getElementById("reservation-form")){try{localStorage.removeItem("pendingReservationEditId"),localStorage.removeItem("pendingReservationEditIndex")}catch(a){console.warn("⚠️ [reservations/controller] Unable to clear pending edit id (inline form)",a)}ht(e,Je());return}if(document.getElementById("editReservationModal")){try{localStorage.removeItem("pendingReservationEditId"),localStorage.removeItem("pendingReservationEditIndex")}catch(a){console.warn("⚠️ [reservations/controller] Unable to clear pending edit id (modal)",a)}ht(e,Je());return}const s=new URLSearchParams;if(t?.id||t?.reservationId){const a=t.id??t.reservationId;s.set("reservationEditId",String(a));try{localStorage.setItem("pendingReservationEditId",String(a)),localStorage.removeItem("pendingReservationEditIndex")}catch(o){console.warn("⚠️ [reservations/controller] Unable to persist pending edit id",o)}}else{s.set("reservationEditIndex",String(e));try{localStorage.setItem("pendingReservationEditIndex",String(e)),localStorage.removeItem("pendingReservationEditId")}catch(a){console.warn("⚠️ [reservations/controller] Unable to persist pending edit index",a)}}Gs({dashboardTab:"reservations-tab",dashboardSubTab:"my-reservations-tab"}).catch(a=>{console.warn("⚠️ [reservations/controller] Failed to persist tab preference",a)});const n=s.toString(),i=n?`dashboard.html?${n}#reservations`:"dashboard.html#reservations";window.location.href=i}function ha(){typeof window>"u"||(window.showReservationDetails=Ht,window.deleteReservation=Vt,window.confirmReservation=_t,window.editReservation=Ut)}export{Nt as a,ha as b,ua as c,ma as d,pa as e,va as f,Rt as g,Je as h,pt as i,N as j,it as k,fa as l,Ft as r,Ht as s,ve as u};
