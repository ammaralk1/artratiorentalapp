import{v as w,w as F,j as n,t as o}from"./auth.aM1-OylN.js";import{d as R,r as h}from"./uiBridge.9vs82jNX.js";import{s as A}from"./state.BKdaYTW2.js";import{g as u,f as I,y as l,a as S,O as C,P as x,u as P,r as j}from"./reservationsService.DkVqWgyD.js";function v(){const r=()=>{R(),h(),A()};if(typeof window<"u"){if(typeof window.requestIdleCallback=="function"){window.requestIdleCallback(r,{timeout:200});return}if(typeof window.requestAnimationFrame=="function"){window.requestAnimationFrame(r);return}}r()}let p=!1,y=null;function q(r){if(!r||typeof r!="object")return"";const a=Object.entries(r).filter(([c,e])=>e!=null).map(([c,e])=>[c,String(e)]);return a.length===0?"":JSON.stringify(a.sort(([c],[e])=>c.localeCompare(e)))}async function L(r={}){const{suppressError:a=!0,params:c=null,force:e=!1}=r??{},s=q(c);if(!e&&p&&u().length>0&&s===y)return u();try{const t=await j(c||{});return p=!0,y=s,t}catch(t){if(console.error("âŒ [reservationsActions] Failed to load reservations from API",t),!a)throw t;return u()}}async function O(r,{onAfterChange:a}={}){if(!w())return F(),!1;const e=u()[r];if(!e)return n(o("reservations.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø²")),!1;const s=e.id||e.reservationId;if(!s)return n(o("reservations.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø²")),!1;try{return await I(s),v(),a?.({type:"deleted",reservation:e}),n(o("reservations.toast.deleted","ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ø­Ø¬Ø²")),!0}catch(t){console.error("âŒ [reservationsActions] deleteReservation failed",t);const i=l(t)?t.message:o("reservations.toast.deleteFailed","ØªØ¹Ø°Ø± Ø­Ø°Ù Ø§Ù„Ø­Ø¬Ø²ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰");return n(i,"error"),!1}}async function B(r,{onAfterChange:a}={}){const e=u()[r];if(!e)return n(o("reservations.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø²")),!1;const s=e.id||e.reservationId;if(!s)return n(o("reservations.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø²")),!1;const{projectLinked:t}=S(e);if(t)return n(o("reservations.toast.confirmBlockedByProject","âš ï¸ Ø­Ø§Ù„Ø© Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø² ØªØªØ­ÙƒÙ… Ø¨Ù‡Ø§ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ù…Ø±ØªØ¨Ø· ÙˆÙ„Ø§ ÙŠÙ…ÙƒÙ† ØªØ£ÙƒÙŠØ¯Ù‡ Ù…Ù† Ù‡Ù†Ø§"),"info"),!1;try{const i=await C(s);return v(),a?.({type:"confirmed",reservation:i}),n(o("reservations.toast.confirmed","âœ… ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø²")),!0}catch(i){console.error("âŒ [reservationsActions] confirmReservation failed",i);const f=l(i)?i.message:o("reservations.toast.confirmFailed","ØªØ¹Ø°Ø± ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø²ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰");return n(f,"error"),!1}}async function D(r,a="",{onAfterChange:c}={}){const s=u()[r];if(!s)return n(o("reservations.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø²")),!1;const t=s.id||s.reservationId;if(!t)return n(o("reservations.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø²")),!1;if(String(s.status||"").toLowerCase()==="completed")return n(o("reservations.toast.alreadyClosed","âœ… Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø² Ù…ØºÙ„Ù‚ Ù…Ø³Ø¨Ù‚Ø§Ù‹")),!1;try{let f=s.notes?String(s.notes).trim():"";const d=(a||"").trim();if(d){const m=o("reservations.closeModal.notePrefix","Ù…Ù„Ø§Ø­Ø¸Ø© Ø¥ØºÙ„Ø§Ù‚");f=f?`${f}
${m}: ${d}`:`${m}: ${d}`}const g=await x(t,f);return v(),c?.({type:"closed",reservation:g}),n(o("reservations.toast.closed","âœ… ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø­Ø¬Ø²")),!0}catch(f){console.error("âŒ [reservationsActions] closeReservation failed",f);const d=l(f)?f.message:o("reservations.toast.closeFailed","ØªØ¹Ø°Ø± Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø­Ø¬Ø²ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰");return n(d,"error"),!1}}function $(r=""){const a=String(r||"");if(!a.trim())return"";const c=["Ù…Ù„Ø§Ø­Ø¸Ø© Ø¥ØºÙ„Ø§Ù‚","Close note"];let e=-1;for(const t of c){const i=a.lastIndexOf(t);i>e&&(e=i)}return e===-1?"":a.slice(0,e).replace(/\n$/,"")}async function M(r,{onAfterChange:a}={}){const e=u()[r];if(!e)return n(o("reservations.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø²")),!1;const s=e.id||e.reservationId;if(!s)return n(o("reservations.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø²")),!1;try{const t=$(e.notes||""),i=await P(s,{status:"confirmed",confirmed:!0,notes:t});return v(),a?.({type:"reopened",reservation:i}),n(o("reservations.toast.reopened","â†©ï¸ ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚")),!0}catch(t){console.error("âŒ [reservationsActions] reopenReservation failed",t);const i=l(t)?t.message:o("reservations.toast.reopenFailed","ØªØ¹Ø°Ø± Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰");return n(i,"error"),!1}}export{B as a,D as c,O as d,L as e,M as r};
