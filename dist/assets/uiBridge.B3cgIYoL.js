import{n as y,d as et,q as xt,t as l,b as G,j as h,h as tt,v as ge,w as we,A as Ct}from"./auth.B48gKpzV.js";import{n as $t,l as wt}from"./state.Dolaivyx.js";const kt="modulepreload",Mt=function(e,t){return new URL(e,t).href},Qe={},Sn=function(t,a,n){let i=Promise.resolve();if(a&&a.length>0){let u=function(p){return Promise.all(p.map(g=>Promise.resolve(g).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};const s=document.getElementsByTagName("link"),o=document.querySelector("meta[property=csp-nonce]"),c=o?.nonce||o?.getAttribute("nonce");i=u(a.map(p=>{if(p=Mt(p,n),p in Qe)return;Qe[p]=!0;const g=p.endsWith(".css"),m=g?'[rel="stylesheet"]':"";if(n)for(let b=s.length-1;b>=0;b--){const f=s[b];if(f.href===p&&(!g||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${p}"]${m}`))return;const d=document.createElement("link");if(d.rel=g?"stylesheet":kt,g||(d.as="script"),d.crossOrigin="",d.href=p,c&&d.setAttribute("nonce",c),document.head.appendChild(d),g)return new Promise((b,f)=>{d.addEventListener("load",b),d.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${p}`)))})}))}function r(s){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s}return i.then(s=>{for(const o of s||[])o.status==="rejected"&&r(o.reason);return t().catch(r)})},Ne="select.form-select:not([data-no-enhance]):not([multiple])",M=new WeakMap;let Ie=null,Ye=!1,T=null;function _n(e=document){e&&(e.querySelectorAll(Ne).forEach(t=>ce(t)),!Ie&&e===document&&(Ie=new MutationObserver(t=>{for(const a of t)a.addedNodes?.forEach(n=>{n instanceof Element&&(n.matches?.(Ne)&&ce(n),n.querySelectorAll?.(Ne).forEach(i=>ce(i)))})}),Ie.observe(document.body,{childList:!0,subtree:!0})),Ye||(Ye=!0,document.addEventListener("pointerdown",Dt,{capture:!0})))}function oe(e){if(!(e instanceof HTMLSelectElement))return;if(!e.dataset.enhancedSelect){ce(e);return}const t=e.closest(".enhanced-select");t&&(ke(t),ue(t),xe(t))}function ce(e){if(!(e instanceof HTMLSelectElement))return;if(e.dataset.enhancedSelect){oe(e);return}if(e.multiple||e.size>1)return;const t=document.createElement("div");t.className="enhanced-select";const a=e.parentNode;a&&a.insertBefore(t,e),t.appendChild(e),e.dataset.enhancedSelect="true",e.classList.add("enhanced-select__native"),e.setAttribute("tabindex","-1"),e.setAttribute("aria-hidden","true");const n=document.createElement("button");n.type="button",n.className="enhanced-select__trigger",n.setAttribute("aria-haspopup","listbox"),n.setAttribute("aria-expanded","false");const i=document.createElement("ul");i.className="enhanced-select__menu",i.setAttribute("role","listbox"),i.setAttribute("tabindex","-1"),t.append(n,i);const r={select:e,trigger:n,menu:i,observer:null,refreshRaf:null};M.set(t,r),n.addEventListener("click",()=>Tt(t)),n.addEventListener("keydown",s=>Rt(s,t)),i.addEventListener("click",s=>Ot(s,t)),i.addEventListener("keydown",s=>jt(s,t)),e.addEventListener("change",()=>{ue(t),nt(t)}),r.observer=new MutationObserver(s=>{let o=!1,c=!1;for(const u of s)u.type==="attributes"&&u.attributeName==="disabled"&&(c=!0),u.type==="childList"&&(o=!0);c&&xe(t),o&&Ft(r,t)}),r.observer.observe(e,{attributes:!0,attributeFilter:["disabled"],childList:!0}),ke(t),ue(t),xe(t)}function Ft(e,t){e&&(e.refreshRaf||(e.refreshRaf=requestAnimationFrame(()=>{e.refreshRaf=null,ke(t),ue(t)})))}function ke(e){const t=M.get(e);if(!t)return;const{select:a,menu:n}=t;if(!a||!n)return;const i=Array.from(a.options||[]),r=document.createDocumentFragment();i.forEach(s=>{const o=document.createElement("li");o.className="enhanced-select__option",o.textContent=s.textContent??s.value??"",o.dataset.value=s.value??"",o.setAttribute("role","option"),o.setAttribute("tabindex","-1"),s.disabled&&(o.setAttribute("aria-disabled","true"),o.classList.add("is-disabled")),s.selected&&(o.setAttribute("aria-selected","true"),o.dataset.selected="true",o.setAttribute("tabindex","0")),r.appendChild(o)}),n.innerHTML="",n.appendChild(r),nt(e)}function ue(e){const t=M.get(e);if(!t)return;const{select:a,trigger:n}=t;if(!a||!n)return;const i=a.selectedOptions?.[0]??a.options?.[a.selectedIndex],r=i?.textContent?.trim()||i?.value||"";n.textContent=r}function nt(e){const t=M.get(e);if(!t)return;const{select:a,menu:n}=t;if(!a||!n)return;const i=a.value;n.querySelectorAll(".enhanced-select__option").forEach(s=>{const o=s.dataset.value===i;s.toggleAttribute("aria-selected",o),s.dataset.selected=o?"true":"",s.setAttribute("tabindex",o?"0":"-1")})}function xe(e){const t=M.get(e);if(!t)return;const{select:a,trigger:n}=t,i=!!a?.disabled;e.classList.toggle("enhanced-select--disabled",i),n.disabled=i}function Tt(e){M.get(e)&&(e.getAttribute("data-open")==="true"?W(e):at(e))}function at(e){const t=M.get(e);if(!t)return;T&&T!==e&&W(T,{focusTrigger:!1}),e.setAttribute("data-open","true"),t.trigger.setAttribute("aria-expanded","true"),T=e;const a=t.menu.querySelector('.enhanced-select__option[aria-selected="true"]')??t.menu.querySelector(".enhanced-select__option:not([aria-disabled='true'])");a?a.focus():t.menu.focus()}function W(e,{focusTrigger:t=!0}={}){const a=M.get(e);a&&(e.setAttribute("data-open","false"),a.trigger.setAttribute("aria-expanded","false"),t&&a.trigger.focus({preventScroll:!0}),T===e&&(T=null))}function Dt(e){if(!T)return;const t=e.target;t instanceof Node&&(T.contains(t)||W(T,{focusTrigger:!1}))}function Rt(e,t){const a=e.key;a==="ArrowDown"||a==="ArrowUp"||a===" "||a==="Enter"?(e.preventDefault(),at(t)):a==="Escape"&&W(t)}function jt(e,t){const a=e.key,n=M.get(t);if(!n)return;const i=Array.from(n.menu.querySelectorAll(".enhanced-select__option:not([aria-disabled='true'])"));if(!i.length)return;const r=i.findIndex(s=>s===document.activeElement);if(a==="ArrowDown"||a==="ArrowUp"){e.preventDefault();const o=(r+(a==="ArrowDown"?1:-1)+i.length)%i.length;i[o].focus()}else if(a==="Home")e.preventDefault(),i[0].focus();else if(a==="End")e.preventDefault(),i[i.length-1].focus();else if(a==="Enter"||a===" "){e.preventDefault();const s=document.activeElement;s&&s.classList.contains("enhanced-select__option")&&it(s,t)}else a==="Escape"&&(e.preventDefault(),W(t))}function Ot(e,t){const a=e.target?.closest?.(".enhanced-select__option");a&&it(a,t)}function it(e,t){const a=M.get(t);if(!a||e.getAttribute("aria-disabled")==="true")return;const{select:n}=a,i=e.dataset.value??"";n.value!==i&&(n.value=i,n.dispatchEvent(new Event("change",{bubbles:!0}))),W(t)}const ae=Object.freeze({change:"reservationEquipmentSelection:change",requestAdd:"reservationEquipmentSelection:requestAdd"});let S=null;function be(e,t={}){typeof document>"u"||document.dispatchEvent(new CustomEvent(e,{detail:t}))}function st(e,t){if(typeof document>"u")return;const{body:a}=document;a&&(e?(a.classList.add("equipment-selection-active"),t&&(a.dataset.equipmentSelectionMode=t)):(a.classList.remove("equipment-selection-active"),a.dataset&&delete a.dataset.equipmentSelectionMode))}function rt(e={}){const t={...e};return t.barcode&&(t.barcode=y(String(t.barcode||"").trim())),t.start&&typeof t.start!="string"&&(t.start=String(t.start)),t.end&&typeof t.end!="string"&&(t.end=String(t.end)),t}function Bn(e={}){const t=rt({...e,activatedAt:Date.now()});return S=t,st(!0,t.mode||"create"),be(ae.change,{active:!0,selection:{...t}}),t}function Ln(e={}){if(!S)return null;const t=rt(e);let a=!1;return Object.entries(t).forEach(([n,i])=>{i==null||i===""||S[n]!==i&&(S[n]=i,a=!0)}),a?(S.updatedAt=Date.now(),be(ae.change,{active:!0,selection:{...S},reason:"selection-updated"}),{...S}):{...S}}function Ce(e="manual"){if(!S)return;const t=S;S=null,st(!1),be(ae.change,{active:!1,previous:t,reason:e})}function Ht(){return!!S}function Xt(){return S?{...S}:null}function Pt(e){if(!S)return!1;let t;if(typeof e=="string"||typeof e=="number"){const a=y(String(e??"").trim());if(!a)return!1;t={barcodes:[a],quantity:1}}else if(e&&typeof e=="object"){const{barcodes:a,barcode:n,quantity:i,groupKey:r,description:s}=e,o=Array.isArray(a)?a:[];n&&o.push(n);const c=o.map(p=>y(String(p??"").trim())).filter(p=>typeof p=="string"&&p.length>0);if(!c.length)return!1;const u=Number.isInteger(i)&&i>0?i:c.length;t={barcodes:c,quantity:Math.min(u,c.length)},r&&(t.groupKey=r),s&&(t.description=s)}else return!1;return be(ae.requestAdd,{...t,selection:{...S}}),!0}typeof document<"u"&&document.addEventListener("dashboard:tabChanged",e=>{const t=e?.detail?.tabId;!t||t==="equipment-tab"||Ce("tab-changed")});const Ut=et()||{};let D=(Ut.equipment||[]).map(Kt),$e=!1,K="",j=null,X=null,P=null,ye=!1,Ge=!1;function Vt(e){if(!e)return null;const t=window?.bootstrap?.Modal??(typeof bootstrap<"u"?bootstrap.Modal:null);return t?t.getOrCreateInstance(e):null}function zt(){document.dispatchEvent(new CustomEvent("equipment:changed"))}function Kt(e={}){return Me({...e,subcategory:e.subcategory??e.sub??"",description:e.description??e.desc??e.name??"",quantity:e.quantity??e.qty??0,unit_price:e.unit_price??e.price??0,image_url:e.image_url??e.imageUrl??e.image??""})}function qe(e={}){const t=Me(e),a=Qt(e);return(!Number.isFinite(t.cost)||Number(t.cost)===0)&&a&&Number.isFinite(Number(a.cost))&&Number(a.cost)>0&&(t.cost=Number(a.cost)),t}function Me(e={}){const t=e.id??e.equipment_id??e.equipmentId??e.item_id??e.itemId??null,a=e.description??e.desc??e.name??"",n=e.category??"",i=e.subcategory??e.sub??"",r=ie(e.quantity??e.qty??0),s=w(e.unit_price??e.price??0),o=w(e.unit_cost??e.unitCost??e.cost??e.rental_cost??e.rentalCost??e.purchase_price??e.purchasePrice??0),c=y(String(e.barcode??"").trim()),u=_(e.status??e.state??e.status_label??e.statusLabel??"available"),p=e.image_url??e.imageUrl??e.image??"",g=e.name??e.item_name??a,m=e.lessor??e.owner??e.lessor_name??e.lessorName??e.owner_name??e.ownerName??"";return{id:Yt(t)?String(t):"",category:n,sub:i,desc:a,name:g,qty:r,price:s,cost:o,barcode:c,status:u,image:p,imageUrl:p,lessor:m,created_at:e.created_at??null,updated_at:e.updated_at??null}}function Qt(e={}){const t=[e.id,e.equipment_id,e.equipmentId,e.item_id,e.itemId].map(n=>n!=null?String(n):"").filter(Boolean),a=y(String(e.barcode??"")).trim();return E().find(n=>{if(t.length&&t.some(i=>i&&String(n.id)===i))return!0;if(a){const i=y(String(n.barcode||"")).trim();if(i&&i===a)return!0}return!1})||null}function Yt(e){return e!=null&&e!==""}function ie(e){const t=Number.parseInt(e,10);return Number.isFinite(t)&&t>=0?t:0}function w(e){const t=Number.parseFloat(e);return Number.isFinite(t)?Math.round(t*100)/100:0}function We(e){!e||e.dataset.englishDigitsAttached||(e.addEventListener("input",()=>{const{selectionStart:t,selectionEnd:a,value:n}=e,i=y(n);if(i!==n&&(e.value=i,t!=null&&a!=null)){const r=i.length-n.length,s=t+r,o=a+r;e.setSelectionRange(s,o)}}),e.dataset.englishDigitsAttached="true")}function Gt(){const e=new Set(E().map(n=>y(String(n.barcode||"")).trim())),t=()=>{const n=Date.now().toString(36).toUpperCase(),i=Math.floor(Math.random()*65535).toString(36).toUpperCase().padStart(3,"0");return`EQ-${n}${i}`};let a="";for(let n=0;n<10;n++)if(a=t(),!e.has(a))return a;return a||t()}function Je(e){if(!e)return"";const t=y(String(e.barcode??"")).trim();if(t)return t;if(Array.isArray(e.variants))for(const a of e.variants){const n=y(String(a?.barcode??"")).trim();if(n)return n}return""}function Wt(e,t){const a=Je(e),n=Je(t);if(!a&&!n)return 0;if(!a)return 1;if(!n)return-1;const i=/^[0-9]+$/,r=i.test(a),s=i.test(n);if(r&&s){if(a.length!==n.length)return a.length-n.length;const u=a.localeCompare(n,"ar",{numeric:!0,sensitivity:"base"});if(u!==0)return u}else{if(r!==s)return r?-1:1;{const u=a.localeCompare(n,"ar",{numeric:!0,sensitivity:"base"});if(u!==0)return u}}const o=de(e?.desc||e?.description||e?.name||""),c=de(t?.desc||t?.description||t?.name||"");return o.localeCompare(c,"ar",{sensitivity:"base"})}function v(e=""){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function _(e){switch(String(e??"").trim().toLowerCase()){case"available":case"Ù…ØªØ§Ø­":case"Ù…ØªÙˆÙØ±":return"available";case"reserved":case"Ù…Ø­Ø¬ÙˆØ²":case"Ù…Ø¤Ø¬Ø±Ø©":case"rented":return"reserved";case"maintenance":case"ØµÙŠØ§Ù†Ø©":return"maintenance";case"retired":case"Ù…ØªÙˆÙ‚Ù":case"Ø®Ø§Ø±Ø¬ Ø§Ù„Ø®Ø¯Ù…Ø©":return"retired";default:return"available"}}function Jt(e){return _(e)}function le(){if(!Ht())return null;const e=Xt();return e?{...e}:null}function Zt(e){const t=le();if(!t)return{active:!1};const a=Array.isArray(e?.variants)&&e.variants.length?e.variants:[e],{start:n,end:i,ignoreReservationId:r=null}=t,s=t?.mode||t?.source||"",o=[],c=new Set;if(a.forEach(m=>{const d=$t(m?.barcode);!d||c.has(d)||(c.add(d),o.push({variant:m,barcode:d}))}),!o.length)return{active:!0,canSelect:!1,reason:l("reservations.toast.equipmentMissingBarcode","âš ï¸ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¹Ø¯Ø© Ù„Ø§ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨Ø§Ø±ÙƒÙˆØ¯ Ù…Ø¹Ø±Ù")};if(s==="package-manager"||s==="equipment-packages"){const m=Math.max(1,o.length||1);return{active:!0,canSelect:!0,barcode:o[0].barcode,availableBarcodes:o.map(({barcode:d})=>d),maxQuantity:m,reason:""}}const u=o.filter(({variant:m})=>{const d=_(m?.status);return d!=="maintenance"&&d!=="retired"});if(!n||!i)return{active:!0,canSelect:!1,barcode:u[0]?.barcode||o[0].barcode,reason:l("reservations.toast.requireDatesBeforeAdd","âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ ØªØ§Ø±ÙŠØ® ÙˆÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„Ù†Ù‡Ø§ÙŠØ© Ù‚Ø¨Ù„ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"),availableBarcodes:[],maxQuantity:0};const p=u.filter(({barcode:m})=>!wt(m,n,i,r));if(p.length)return{active:!0,canSelect:!0,barcode:p[0].barcode,availableBarcodes:p.map(({barcode:m})=>m),maxQuantity:p.length};let g=l("reservations.toast.equipmentUnavailable","âš ï¸ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¹Ø¯Ø© ØºÙŠØ± Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹");if(u.length>0)g=l("reservations.toast.equipmentTimeConflict","âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¹Ø¯Ø© Ù„Ø£Ù†Ù‡Ø§ Ù…Ø­Ø¬ÙˆØ²Ø© ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©");else{const m=new Set(o.map(({variant:d})=>_(d?.status)));m.has("maintenance")?g=l("reservations.toast.equipmentMaintenance","âš ï¸ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¹Ø¯Ø© Ù‚ÙŠØ¯ Ø§Ù„ØµÙŠØ§Ù†Ø© ÙˆÙ„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØªÙ‡Ø§ Ø­Ø§Ù„ÙŠØ§Ù‹"):m.has("reserved")?g=l("reservations.toast.equipmentReserved","âš ï¸ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¹Ø¯Ø© Ù…Ø­Ø¬ÙˆØ²Ø© Ø­Ø§Ù„ÙŠØ§Ù‹ ÙˆÙ„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØªÙ‡Ø§"):m.has("retired")&&(g=l("reservations.toast.equipmentRetired","âš ï¸ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¹Ø¯Ø© Ø®Ø§Ø±Ø¬ Ø§Ù„Ø®Ø¯Ù…Ø© Ø­Ø§Ù„ÙŠØ§Ù‹"))}return{active:!0,canSelect:!1,barcode:u[0]?.barcode||o[0].barcode,reason:g,availableBarcodes:[],maxQuantity:0}}function en(){const e=document.querySelector('[data-tab="reservations-tab"]');e&&(e.click(),window.requestAnimationFrame(()=>{setTimeout(()=>{document.querySelector("#sub-tab-trigger-create-tab")?.click();const t=document.getElementById("equipment-barcode");if(t)try{t.focus({preventScroll:!0})}catch{t.focus()}Ze(),setTimeout(Ze,150)},200)}))}function Ze(){if(typeof document>"u"||typeof window>"u")return;const e=document.getElementById("create-tab");if(!e)return;const t=e.querySelector(".reservation-equipment-table")||e.querySelector(".reservation-equipment-heading");if(!t)return;const a=110,n=t.getBoundingClientRect(),i=Math.max((window.scrollY||window.pageYOffset||0)+n.top-a,0),r={top:i,behavior:"smooth"};try{window.scrollTo(r)}catch{window.scrollTo(0,i)}}function ot(){if(typeof document>"u")return;const e=document.getElementById("equipment-selection-banner"),t=document.getElementById("equipment-selection-return"),a=document.getElementById("equipment-floating-return"),n=document.getElementById("equipment-selection-banner-title"),i=document.getElementById("equipment-selection-banner-hint");if(!e)return;const r=le();e.hidden=!r;const s=r?.mode||r?.source||"",o=s==="package-manager"||s==="equipment-packages",c=[t,a].filter(Boolean),u=p=>{c.forEach(g=>{g.textContent=p})};if(r?o?(n&&(n.textContent=l("equipment.packages.selection.bannerTitle","ğŸ“¦ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¹Ø¯Ø§Øª Ù„Ù„Ø­Ø²Ù…Ø©")),i&&(i.textContent=l("equipment.packages.selection.bannerHint","Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¹Ø¯Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù…Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø£Ø¯Ù†Ø§Ù‡ Ø«Ù… Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ù„Ø¥Ø¶Ø§ÙØªÙ‡Ø§ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø²Ù…Ø©.")),u(l("equipment.packages.selection.doneButton","âœ… Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø­Ø²Ù…Ø©"))):(n&&(n.textContent=l("reservations.create.equipment.selector.bannerTitle","ğŸ”— Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¹Ø¯Ø§Øª Ù„Ø­Ø¬Ø² Ø¬Ø¯ÙŠØ¯")),i&&(i.textContent=l("reservations.create.equipment.selector.bannerHint","Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø£Ø¯Ù†Ø§Ù‡ØŒ Ø«Ù… Ø£Ø¶Ù Ø§Ù„Ù…Ø¹Ø¯Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© Ù…Ø¨Ø§Ø´Ø±Ø© Ø¥Ù„Ù‰ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø­Ø¬Ø².")),u(l("reservations.create.equipment.selector.returnButton","â¬…ï¸ Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø¬Ø²"))):(n&&(n.textContent=l("reservations.create.equipment.selector.bannerTitle","ğŸ”— Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¹Ø¯Ø§Øª Ù„Ø­Ø¬Ø² Ø¬Ø¯ÙŠØ¯")),i&&(i.textContent=l("reservations.create.equipment.selector.bannerHint","Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø£Ø¯Ù†Ø§Ù‡ØŒ Ø«Ù… Ø£Ø¶Ù Ø§Ù„Ù…Ø¹Ø¯Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© Ù…Ø¨Ø§Ø´Ø±Ø© Ø¥Ù„Ù‰ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø­Ø¬Ø².")),u(l("reservations.create.equipment.selector.returnButton","â¬…ï¸ Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø¬Ø²"))),a&&(a.hidden=!r,r?a.setAttribute("aria-label",a.textContent.trim()):a.removeAttribute("aria-label")),r){const p=()=>{const g=le(),m=g?.mode||g?.source||"";m==="package-manager"||m==="equipment-packages"?Ce("package-finish-button"):(Ce("return-button"),en())};c.forEach(g=>{g.dataset.listenerAttached||(g.addEventListener("click",p),g.dataset.listenerAttached="true")})}}function E(){return D}function U(e){D=Array.isArray(e)?e.map(Me):[],tt({equipment:D}),zt()}function de(e){return String(e??"").trim().toLowerCase()}function tn(e){return String(e??"").trim().toLowerCase()}function R(e){if(!e)return"";const t=e.desc||e.description||e.name||"",a=de(t);if(a){const i=tn(e.lessor||"");return`${a}__lessor__${i}`}let n=de(e.category||"");return n||(n=y(String(e.barcode||"")).trim().toLowerCase()),n}function ct(e){const t=R(e);return t?E().filter(a=>R(a)===t):[]}function Q(e){const t=document.getElementById("equipment-details-cover");if(!t)return;const a=J(e);if(a){const n=v(e.desc||e.description||e.name||"");t.innerHTML=`<img src="${v(a)}" alt="${n}">`,t.classList.add("has-image")}else t.innerHTML='<span class="equipment-details-header__placeholder" aria-hidden="true">ğŸ“¦</span>',t.classList.remove("has-image")}function Fe(e){const t=document.getElementById("equipment-lessor-badge");if(!t)return;const a=(e?.lessor||"").trim();if(a){const n=l("equipment.modal.labels.lessor","ğŸ¢ Ø§Ù„Ù…Ø¤Ø¬Ø±");t.textContent=`${n}: ${a}`,t.hidden=!1}else t.hidden=!0,t.textContent="ğŸ¢"}function Te(){return{category:document.getElementById("edit-equipment-category"),subcategory:document.getElementById("edit-equipment-subcategory"),description:document.getElementById("edit-equipment-description"),quantity:document.getElementById("edit-equipment-quantity"),price:document.getElementById("edit-equipment-price"),cost:document.getElementById("edit-equipment-cost"),image:document.getElementById("edit-equipment-image"),barcode:document.getElementById("edit-equipment-barcode"),status:document.getElementById("edit-equipment-status"),lessor:document.getElementById("edit-equipment-lessor")}}function me(){const e=Te();return{category:e.category?.value??"",subcategory:e.subcategory?.value??"",description:e.description?.value??"",quantity:e.quantity?.value??"",price:e.price?.value??"",cost:e.cost?.value??"",image:e.image?.value??"",barcode:e.barcode?.value??"",status:e.status?.value??"",lessor:e.lessor?.value??""}}function ve(e={}){const t=Te();t.category&&(t.category.value=e.category??""),t.subcategory&&(t.subcategory.value=e.subcategory??""),t.description&&(t.description.value=e.description??""),t.quantity&&(t.quantity.value=e.quantity!=null?y(String(e.quantity)):""),t.price&&(t.price.value=e.price!=null?y(String(e.price)):""),t.cost&&(t.cost.value=e.cost!=null?y(String(e.cost)):""),t.image&&(t.image.value=e.image??""),t.barcode&&(t.barcode.value=e.barcode??""),t.status&&(t.status.value=e.status??""),t.lessor&&(t.lessor.value=e.lessor??"")}function Y(e){ye=e;const t=Te(),a=document.getElementById("equipment-edit-cancel"),n=document.getElementById("save-equipment-changes"),i=document.getElementById("edit-equipment-form");if(i&&i.classList.toggle("equipment-details-form--editing",e),[t.category,t.subcategory,t.description,t.quantity,t.price,t.cost,t.image,t.lessor].forEach(s=>{s&&(e?s.removeAttribute("disabled"):s.setAttribute("disabled","disabled"))}),a&&(a.hidden=!e,a.disabled=!e),n){n.disabled=!1;const s=e?"equipment.modal.actions.save":"equipment.modal.actions.edit",o=e?"ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª":"âœï¸ ØªØ¹Ø¯ÙŠÙ„";n.textContent=l(s,o),n.dataset.mode=e?"save":"view"}if(e){const s=t.description||t.category||t.subcategory;s&&setTimeout(()=>{s.focus(),typeof s.select=="function"&&s.select()},0)}}async function nn(e){if(!ge()){we();return}if(!e)return;try{await lt()}catch(a){console.error("âŒ [equipment.js] Unable to load XLSX",a),alert(l("equipment.toast.xlsxMissing","âš ï¸ Ù…ÙƒØªØ¨Ø© Excel (XLSX) ØºÙŠØ± Ù…Ø­Ù…Ù„Ø©."));return}const t=new FileReader;t.onload=async function(a){try{const n=new Uint8Array(a.target.result),i=XLSX.read(n,{type:"array"}),r=i.Sheets[i.SheetNames[0]],s=XLSX.utils.sheet_to_json(r,{defval:""});if(!Array.isArray(s)||s.length===0){h(l("equipment.toast.uploadEmpty","âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ù…Ù„Ù"));return}const o=[];let c=0;if(s.forEach(u=>{const p=u.Ø§Ù„Ù‚Ø³Ù…??u.category??"",g=u["Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ"]??u.subcategory??"",m=u.Ø§Ù„ÙˆØµÙ??u.description??u.name??"",d=u.Ø§Ù„ÙƒÙ…ÙŠØ©??u.quantity??0,b=u.Ø§Ù„Ø³Ø¹Ø±??u.price??0,f=u.Ø§Ù„ØªÙƒÙ„ÙØ©??u.cost??u.unit_cost??u.unitCost??0,q=u.Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯??u.barcode??"",B=u.Ø§Ù„ØµÙˆØ±Ø©??u.image_url??u.image??"",L=u.Ø§Ù„Ù…Ø¤Ø¬Ø±??u["Ø§Ù„Ù…Ø¤Ø¬Ø± "]??u.Lessor??u.lessor??u.lessor??"",I=y(String(q||"")).trim();if(!m||!I){c+=1;return}o.push(De({category:p,subcategory:g,description:m,quantity:d,unit_price:b,unit_cost:f,barcode:I,image_url:B,lessor:L}))}),!o.length){h(l("equipment.toast.uploadEmpty","âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ù…Ù„Ù"));return}try{const u=await G("/equipment/?bulk=1&update_existing=1&skip_duplicates=1",{method:"POST",body:o}),p=Array.isArray(u?.data)?u.data.map(qe):[];if(p.length){const q=[...E(),...p];U(q)}await se({showToastOnError:!1}),N();const g=u?.meta?.count??p.length,m=Number(u?.meta?.skipped_duplicates||0),d=Number(u?.meta?.updated||0),b=[];g&&b.push(`${g} âœ”ï¸`),d&&b.push(`${d} ğŸ”`);const f=(c||0)+m;f&&b.push(`${f} âš ï¸`),h(l("equipment.toast.uploadSuccess","âœ… ØªÙ… Ø±ÙØ¹ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­")+(b.length?` (${b.join(" / ")})`:""))}catch(u){const p=Z(u,"equipment.toast.uploadFailed","âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù Ø§Ù„Ø¥ÙƒØ³Ù„");h(p,"error")}}catch(n){console.error("âŒ [equipment.js] Failed to process Excel file",n),h(l("equipment.toast.uploadFailed","âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù Ø§Ù„Ø¥ÙƒØ³Ù„"),"error")}},t.onerror=function(){console.error("âŒ [equipment.js] FileReader error",t.error),h(l("equipment.toast.uploadFailed","âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù Ø§Ù„Ø¥ÙƒØ³Ù„"),"error")},t.readAsArrayBuffer(e)}async function ut({onlyAvailable:e=!1}={}){try{await lt()}catch(d){console.error("âŒ [equipment.js] Unable to load XLSX for download",d),h(l("equipment.toast.xlsxMissing","âš ï¸ Ù…ÙƒØªØ¨Ø© Excel (XLSX) ØºÙŠØ± Ù…Ø­Ù…Ù„Ø©."));return}const a=E().filter(d=>e?_(d.status)==="available":!0).map(d=>({Ø§Ù„Ù‚Ø³Ù…:d.category||"","Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ":d.sub||"",Ø§Ù„ÙˆØµÙ:d.desc||d.description||d.name||"",Ø§Ù„ÙƒÙ…ÙŠØ©:Number.isFinite(Number(d.qty))?Number(d.qty):0,Ø§Ù„Ø³Ø¹Ø±:Number.isFinite(Number(d.price))?Number(d.price):0,Ø§Ù„ØªÙƒÙ„ÙØ©:Number.isFinite(Number(d.cost))?Number(d.cost):0,Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯:d.barcode||"",Ø§Ù„ØµÙˆØ±Ø©:J(d)||"",Ø§Ù„Ù…Ø¤Ø¬Ø±:d.lessor||""})),n=XLSX.utils.json_to_sheet(a),i=XLSX.utils.book_new();XLSX.utils.book_append_sheet(i,n,"Equipment");const r=d=>String(d).padStart(2,"0"),s=new Date,o=s.getFullYear(),c=r(s.getMonth()+1),u=r(s.getDate()),p=r(s.getHours()),g=r(s.getMinutes()),m=`${e?"equipment-available":"equipment-all"}-${o}${c}${u}-${p}${g}.xlsx`;try{XLSX.writeFile(i,m,{compression:!0})}catch(d){console.error("âŒ [equipment.js] Failed to generate Excel file",d),h(l("equipment.toast.uploadFailed","âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù Ø§Ù„Ø¥ÙƒØ³Ù„"),"error")}}const an="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js";let ne=null;function lt(){return typeof XLSX<"u"?Promise.resolve():typeof window>"u"||typeof document>"u"?Promise.reject(new Error("XLSX library is not available in this environment")):ne||(ne=new Promise((e,t)=>{const a=document.querySelector('script[data-xlsx-loader="true"]');if(a){a.addEventListener("load",i,{once:!0}),a.addEventListener("error",r,{once:!0});return}const n=document.createElement("script");n.src=an,n.async=!0,n.defer=!0,n.dataset.xlsxLoader="true",n.addEventListener("load",i,{once:!0}),n.addEventListener("error",r,{once:!0}),document.head.appendChild(n);function i(){if(typeof XLSX>"u"){t(new Error("XLSX did not load correctly"));return}e()}function r(){t(new Error("Failed to load XLSX library"))}}).catch(e=>{throw console.warn("âš ï¸ [equipment.js] ensureXLSXLoaded failed",e),ne=null,e}),ne)}function De({category:e="",subcategory:t="",description:a="",quantity:n=0,unit_price:i=0,unit_cost:r=0,barcode:s="",status:o="Ù…ØªØ§Ø­",image_url:c="",lessor:u=""}){const p=y(String(s||"")).trim(),g=Jt(o);return{category:e?.trim()||null,subcategory:t?.trim()||null,name:a?.trim()||null,description:a?.trim()||null,quantity:ie(n),unit_price:w(i),unit_cost:w(r),cost:w(r),purchase_price:w(r),rental_cost:w(r),barcode:p,status:g,image_url:c?.trim()||null,lessor:(typeof u=="string"?u.trim():"")||null}}async function dt(){if(!ge()){we();return}if(confirm(l("equipment.toast.clearConfirm","âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ù…Ø¹Ø¯Ø§ØªØŸ")))try{const t=(await G("/equipment/?all=1",{method:"DELETE"}))?.meta?.deleted??0;await se({showToastOnError:!1}),h(l("equipment.toast.clearSuccess","ğŸ—‘ï¸ ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª")+(t?` (${t})`:""))}catch(e){const t=Z(e,"equipment.toast.clearFailed","âš ï¸ ØªØ¹Ø°Ø± Ø­Ø°Ù Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª");h(t,"error")}}function J(e){return e.image||e.imageUrl||e.img||""}function sn(e){const t=_(e),a={available:{label:l("equipment.form.options.available","âœ… Ù…ØªØ§Ø­"),className:"equipment-status-badge equipment-status-badge--available"},reserved:{label:l("equipment.form.options.booked","ğŸ“Œ Ù…Ø­Ø¬ÙˆØ²"),className:"equipment-status-badge equipment-status-badge--reserved"},maintenance:{label:l("equipment.form.options.maintenance","ğŸ› ï¸ ØµÙŠØ§Ù†Ø©"),className:"equipment-status-badge equipment-status-badge--maintenance"},retired:{label:l("equipment.form.options.retired","ğŸ“¦ Ø®Ø§Ø±Ø¬ Ø§Ù„Ø®Ø¯Ù…Ø©"),className:"equipment-status-badge equipment-status-badge--retired"}},{label:n,className:i}=a[t]||{label:e||"-",className:"equipment-status-badge equipment-status-badge--default"};return`<span class="${i}">${n}</span>`}function pe(){const e=document.getElementById("equipment-variants-section"),t=document.getElementById("equipment-variants-table-body"),a=document.getElementById("equipment-variants-count");if(e&&(e.hidden=!0),t){const n=l("equipment.modal.variants.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚Ø·Ø¹ Ù…Ø±ØªØ¨Ø·Ø© Ø£Ø®Ø±Ù‰.");t.innerHTML=`<tr><td colspan="4" class="text-center text-muted">${v(n)}</td></tr>`}a&&(a.textContent="0")}function mt(e){const t=document.getElementById("equipment-variants-section"),a=document.getElementById("equipment-variants-table-body"),n=document.getElementById("equipment-variants-count");if(!t||!a||!e)return;const r=j?.groupKey||R(e);if(!r){pe();return}const s=E().filter(m=>R(m)===r).sort((m,d)=>{const b=String(m.barcode||"").trim(),f=String(d.barcode||"").trim();return!b&&!f?0:b?f?b.localeCompare(f,"ar",{numeric:!0,sensitivity:"base"}):-1:1});if(!s.length){pe();return}t.hidden=!1,n&&(n.textContent=String(s.length));const o=l("equipment.modal.variants.current","Ø§Ù„Ø­Ø§Ù„ÙŠ"),c=l("equipment.modal.variants.select","Ø§Ø®ØªÙŠØ§Ø±"),u=l("equipment.form.labels.quantity","Ø§Ù„ÙƒÙ…ÙŠØ©"),p=E(),g=s.map(m=>{const d=m.id&&e.id?String(m.id)===String(e.id):String(m.barcode||"")===String(e.barcode||""),b=d?"equipment-variants-table__row--current":"",f=v(String(m.barcode||"-")),q=d?`<span class="equipment-variants-current-badge">${v(o)}</span>`:"",B=y(String(Number.isFinite(Number(m.qty))?Number(m.qty):0)),L=p.indexOf(m),I=v(l("equipment.item.actions.delete","ğŸ—‘ï¸ Ø­Ø°Ù")),C=L>=0?`<div class="table-action-buttons equipment-variant-actions">
            ${d?"":`<button type="button" class="btn btn-sm btn-secondary equipment-variant-action" data-variant-action="focus" data-variant-index="${L}">âœï¸ ${v(c)}</button>`}
            <button type="button" class="btn btn-sm btn-error equipment-variant-action equipment-variant-action--danger" data-variant-action="delete" data-variant-index="${L}">${I}</button>
          </div>`:"";return`
        <tr class="${b}">
          <td>
            ${f}
            ${q}
          </td>
          <td>${sn(m.status)}</td>
          <td>
            <span class="equipment-variants-qty" title="${v(u)}">${B}</span>
          </td>
          <td class="table-actions-cell">${C}</td>
        </tr>
      `}).join("");a.innerHTML=g}function rn({item:e,index:t}){const a=J(e),n=l("equipment.item.actions.delete","ğŸ—‘ï¸ Ø­Ø°Ù"),i=l("equipment.item.imageAlt","ØµÙˆØ±Ø©"),r=l("equipment.item.currency","SR"),s=ge(),o={description:l("equipment.card.labels.description","Ø§Ù„ÙˆØµÙ"),status:l("equipment.card.labels.status","Ø§Ù„Ø­Ø§Ù„Ø©"),alias:l("equipment.card.labels.alias","Ø§Ù„Ø§Ø³Ù…"),quantity:l("equipment.card.labels.quantity","Ø§Ù„ÙƒÙ…ÙŠØ©"),price:l("equipment.card.labels.price","Ø§Ù„Ø³Ø¹Ø±"),cost:l("equipment.card.labels.cost","Ø§Ù„ØªÙƒÙ„ÙØ©"),category:l("equipment.card.labels.category","Ø§Ù„Ù‚Ø³Ù…"),subcategory:l("equipment.card.labels.subcategory","Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ"),barcode:l("equipment.card.labels.barcode","Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯"),available:l("equipment.card.labels.available","Ù…ØªØ§Ø­")},c=Number.isFinite(Number(e.qty))?Number(e.qty):0,u=Number.isFinite(Number(e.price))?Number(e.price):0,p=Number.isFinite(Number(e.cost))?Number(e.cost):0,g=c.toLocaleString("en-US"),m=u.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:2}),d=p.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:2}),b=Number.isFinite(Number(e.reservedQty))?Number(e.reservedQty):0,f=Number.isFinite(Number(e.maintenanceQty))?Number(e.maintenanceQty):0,q=Number.isFinite(Number(e.availableQty))?Number(e.availableQty):Math.max(c-b-f,0),B=q.toLocaleString("en-US"),L=l("equipment.card.labels.availableOfTotal","Ù…Ù† Ø£ØµÙ„"),I=_(e.status);let C=`${v(o.available)}: ${v(B)} ${v(L)} ${v(g)}`,V="available";if(q===0){const F={reserved:{text:c===1?l("equipment.card.availability.reservedSingle","Ù…Ø¤Ø¬Ø±Ø©"):l("equipment.card.availability.reserved","Ù…Ø¤Ø¬Ø±Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„"),modifier:"reserved"},maintenance:{text:l("equipment.card.availability.maintenance","ØªØ­Øª Ø§Ù„ØµÙŠØ§Ù†Ø©"),modifier:"maintenance"},retired:{text:l("equipment.card.availability.retired","ØºÙŠØ± Ù…ØªØ§Ø­Ø©"),modifier:"retired"},default:{text:l("equipment.card.availability.unavailable","ØºÙŠØ± Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹"),modifier:"unavailable"}},x=F[I]||F.default;C=v(x.text),V=x.modifier}const z=`<span class="equipment-card__availability equipment-card__availability--${V}">${C}</span>`,$="",k=e.desc||e.name||l("common.placeholder.empty","â€”"),ee=e.name&&e.name!==e.desc?e.name:"",bt=`
    <div class="equipment-card__info-row equipment-card__info-row--center">
      ${[{label:o.quantity,value:g},{label:o.price,value:`${m} ${r}`},{label:o.cost,value:`${d} ${r}`}].map(({label:F,value:x})=>`
            <span class="equipment-card__info-item equipment-card__info-item--stacked">
              <span class="equipment-card__detail-label">${F}</span>
              <span class="equipment-card__detail-value">${x}</span>
            </span>
          `).join("")}
    </div>`,Oe=[e.category?{label:o.category,value:e.category}:null,e.sub?{label:o.subcategory,value:e.sub}:null].filter(Boolean),yt=Oe.length?`<div class="equipment-card__categories">${Oe.map(({label:F,value:x})=>`
            <div class="equipment-card__category">
              <span class="equipment-card__detail-label">${F}</span>
              <span class="equipment-card__detail-value">${x}</span>
            </div>
          `).join("")}</div>`:"",qt=ee?`<div class="equipment-card__alias">
        <span class="equipment-card__detail-label">${o.alias}</span>
        <span class="equipment-card__detail-value">${ee}</span>
      </div>`:"",He=(e.lessor||"").trim(),vt=He?`<div class="equipment-card__lessor"><span class="equipment-tag" title="${v(l("equipment.modal.labels.lessor","ğŸ¢ Ø§Ù„Ù…Ø¤Ø¬Ø±"))}">ğŸ¢ ${v(He)}</span></div>`:"",ht=`
    <div class="equipment-card__details">
      ${`
    <div class="equipment-card__description">
      <span class="equipment-card__label">${o.description}</span>
      <h3 class="equipment-card__title">${k}</h3>
    </div>
  `}
      ${bt}
    </div>
  `,Ee=[],A=Zt(e),Xe=A?.availableBarcodes?.length?A.availableBarcodes.join(","):A?.barcode?A.barcode:"";let Se="",_e="";if(A.active){const F=`equipment-select-qty-${t}`,x=!!A.canSelect,Be=x?Math.max(1,Number(A.maxQuantity||A.availableBarcodes?.length||1)):1,St=Math.max(1,Math.min(Be,99)),Ue=[];for(let te=1;te<=St;te+=1){const At=y(String(te));Ue.push(`<option value="${te}"${te===1?" selected":""}>${At}</option>`)}const _t=x?"":" disabled",Bt=l("reservations.create.equipment.selector.quantityLabel","Ø§Ù„ÙƒÙ…ÙŠØ©"),Ve=x?`${l("reservations.create.equipment.selector.availableHint","Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©")}: ${y(String(Be))}`:A.reason?A.reason:"";Se=`
      <div class="equipment-card__selection-controls">
        <label class="equipment-card__selection-label" for="${F}">${Bt}</label>
        <select class="equipment-card__quantity-select" id="${F}" data-equipment-select-quantity${_t}>
          ${Ue.join("")}
        </select>
        ${Ve?`<span class="equipment-card__selection-hint">${v(Ve)}</span>`:""}
      </div>
    `;const ze=le(),Ke=ze?.mode||ze?.source||"",Lt=Ke==="package-manager"||Ke==="equipment-packages"?l("equipment.packages.selection.addToPackage","â• Ø£Ø¶Ù Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø²Ù…Ø©"):l("reservations.create.equipment.selector.addToReservation","â• Ø£Ø¶Ù Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø¬Ø²"),Nt=x?"":" disabled",It=A.reason?` title="${v(A.reason)}"`:"",Le=['data-equipment-action="select-reservation"',`data-selection-max="${x?Be:0}"`];Xe&&Le.push(`data-selection-barcodes="${v(Xe)}"`),e.groupKey&&Le.push(`data-selection-group="${v(String(e.groupKey))}"`),_e=`
      <button type="button" class="btn btn-sm equipment-card__action-btn equipment-card__action-btn--select" ${Le.join(" ")}${Nt}${It}>${Lt}</button>
    `}s&&Ee.push(`<button type="button" class="btn btn-sm equipment-card__action-btn equipment-card__action-btn--delete" data-equipment-action="delete" data-equipment-index="${t}">${n}</button>`);const Pe=Ee.length?Ee.join(`
`):"",Et=v(k);return`
    <article
      class="equipment-card"
      data-equipment-index="${t}"
      ${e.groupKey?`data-equipment-group-key="${v(String(e.groupKey))}"`:""}
      data-equipment-card="true"
      role="listitem"
      tabindex="0"
      aria-label="${Et}"
    >
      <div class="equipment-card__header">
      <div class="equipment-card__status-block">
        ${$}
        ${z}
      </div>
        <div class="equipment-card__media-wrapper">
          <div class="equipment-card__media" aria-hidden="true">
            ${a?`<img src="${a}" alt="${i}" loading="lazy">`:'<div class="equipment-card__placeholder">ğŸ“¦</div>'}
          </div>
          ${ht}
        </div>
      </div>
      <div class="equipment-card__body">
        ${vt}
        ${yt}
        ${qt}
      </div>
      ${Se||_e||Pe?`<div class="equipment-card__actions equipment-card__actions--center">
            ${Se}
            ${_e}
            ${Pe}
          </div>`:""}
    </article>
  `}function on(e){const t=[...new Set(e.map(s=>s.category).filter(Boolean))],a=[...new Set(e.map(s=>s.sub).filter(Boolean))].sort((s,o)=>String(s).localeCompare(String(o),"ar",{sensitivity:"base"})),n=document.getElementById("filter-category"),i=document.getElementById("filter-sub");if(n){const s=n.value;for(;n.options.length>1;)n.remove(1);t.forEach(o=>{const c=document.createElement("option");c.value=o,c.textContent=o,n.appendChild(c)}),t.includes(s)&&(n.value=s),oe(n)}if(i){const s=i.value;for(;i.options.length>1;)i.remove(1);a.forEach(o=>{const c=document.createElement("option");c.value=o,c.textContent=o,i.appendChild(c)}),a.includes(s)&&(i.value=s),oe(i)}const r=document.getElementById("filter-status");r&&oe(r)}function pt(){if(typeof document>"u")return;const e=E(),t=[...new Set(e.map(r=>r.category).filter(Boolean))].sort((r,s)=>String(r).localeCompare(String(s),"ar",{sensitivity:"base"})),a=[...new Set(e.map(r=>r.sub).filter(Boolean))].sort((r,s)=>String(r).localeCompare(String(s),"ar",{sensitivity:"base"})),n=[...new Set(e.map(r=>r.lessor).filter(Boolean))].sort((r,s)=>String(r).localeCompare(String(s),"ar",{sensitivity:"base"})),i=(r,s)=>{const o=document.getElementById(r);if(o){for(;o.firstChild;)o.removeChild(o.firstChild);s.forEach(c=>{const u=document.createElement("option");u.value=String(c),o.appendChild(u)})}};i("new-equipment-category-list",t),i("new-equipment-sub-list",a),i("new-equipment-lessor-list",n)}function Re(){const e=et();let{equipment:t=[],reservations:a=[],maintenance:n=[]}=e;if(!Array.isArray(t)||t.length===0)return D=t||[],D;const i=new Date;let r=!1;const s=new Set((n||[]).filter(c=>c?.status==="open").map(c=>y(String(c?.equipmentBarcode??"")).trim().toLowerCase())),o=t.map(c=>{if(!c)return c;const u=_(c.status),p=y(String(c.barcode??"")).trim().toLowerCase(),g=p&&s.has(p);let m=g?"maintenance":"available";if(!g&&p)for(const d of a||[]){if(!cn(d,i))continue;if(d.items?.some(f=>y(String(f?.barcode??"")).trim().toLowerCase()===p)){m="reserved";break}}return m!==u?(r=!0,{...c,status:m}):{...c,status:m}});return r?U(o):(D=o,tt({equipment:D})),D}function cn(e,t){if(!e?.start||!e?.end)return!1;const a=String(e?.status||e?.reservationStatus||"").toLowerCase();if(a==="cancelled"||a==="canceled")return!1;const n=new Date(e.start),i=new Date(e.end);return Number.isNaN(n.getTime())||Number.isNaN(i.getTime())?!1:n<=t&&t<i}function Ae(e,{tone:t="",icon:a="ğŸ“¦"}={}){const n=["equipment-empty-state"];return t&&n.push(`equipment-empty-state--${t}`),`
    <div class="${n.join(" ")}">
      <div class="equipment-empty-state__icon" aria-hidden="true">${a}</div>
      <p class="equipment-empty-state__text">${e}</p>
    </div>
  `}function N(){const e=document.getElementById("equipment-list");if(!e)return;ot();const t=Re(),a=Array.isArray(t)?t:E(),n=new Map;a.forEach(f=>{if(!f)return;const q=R(f);q&&(n.has(q)||n.set(q,[]),n.get(q).push(f))});const i=Array.from(n.values()).map(f=>{const q=f[0],B=f.reduce(($,k)=>$+(Number.isFinite(Number(k.qty))?Number(k.qty):0),0),L=["maintenance","reserved","available","retired"],I=f.map($=>_($.status)).sort(($,k)=>L.indexOf($)-L.indexOf(k))[0]||"available",C=f.reduce(($,k)=>{const ee=ie(k?.qty??0)||0,he=_(k?.status);return he==="reserved"?$.reserved+=ee:he==="maintenance"&&($.maintenance+=ee),$},{reserved:0,maintenance:0}),V=Math.max(B-C.reserved-C.maintenance,0);return{item:{...q,qty:B,status:I,variants:f,groupKey:R(q),reservedQty:C.reserved,maintenanceQty:C.maintenance,availableQty:V},index:a.indexOf(q)}});i.sort((f,q)=>Wt(f.item,q.item));const r=document.getElementById("search-equipment")?.value||"",s=y(r).toLowerCase().trim(),o=document.getElementById("filter-category")?.value||"",c=document.getElementById("filter-sub")?.value||"",u=document.getElementById("filter-status")?.value||"",p=u?_(u):"";if($e&&!a.length){e.innerHTML=Ae(l("equipment.list.loading","â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª..."),{icon:"â³"});return}if(K&&!a.length){e.innerHTML=Ae(K,{tone:"error",icon:"âš ï¸"});return}const g=i.filter(({item:f})=>{const q=y(String(f.barcode??"")).toLowerCase().trim(),B=Array.isArray(f.variants)?f.variants.map(z=>y(String(z.barcode??"")).toLowerCase().trim()).filter(Boolean):[],L=!s||f.name&&f.name.toLowerCase().includes(s)||f.desc&&f.desc.toLowerCase().includes(s)||q&&q.includes(s)||B.some(z=>z.includes(s))||f.category&&f.category.toLowerCase().includes(s)||f.sub&&f.sub.toLowerCase().includes(s),I=!o||f.category===o,C=!c||f.sub===c,V=!p||_(f.status)===p;return L&&I&&C&&V}),m=s?l("equipment.list.emptyFiltered","âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø¯Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø©."):l("equipment.list.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø¯Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ø¨Ø¹Ø¯."),d=g;e.innerHTML=d.length?d.map(rn).join(""):Ae(m);const b=document.getElementById("equipment-list-count");if(b){const f=l("equipment.list.countSuffix","Ø¹Ù†ØµØ±"),q=y(String(d.length)),B=d.length?`${q} ${f}`:`0 ${f}`;b.textContent=B}on(a)}async function se({showToastOnError:e=!0}={}){$e=!0,K="",N();try{const t=await G("/equipment/?all=1"),a=t?.data??t;let n=[];Array.isArray(a)?n=a:a&&typeof a=="object"&&(Array.isArray(a.items)?n=a.items:Array.isArray(a.results)?n=a.results:Array.isArray(a.data)?n=a.data:Array.isArray(a.records)&&(n=a.records));const i=n.map(qe);U(i)}catch(t){t&&typeof t=="object"&&Number(t.status)===401?K="":(K=Z(t,"equipment.toast.fetchFailed","ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"),e&&h(K,"error"))}finally{$e=!1,N()}}function Z(e,t,a){if(e instanceof Ct){const n=e.payload?.errors;if(n&&typeof n=="object"){const i=Object.values(n)[0];if(Array.isArray(i))return i[0];if(typeof i=="string")return i}if(e.message)return e.message}return l(t,a)}async function un(e){e.preventDefault();const t=e.target,a=t.querySelector("#new-equipment-desc")?.value?.trim()||"",n=t.querySelector("#new-equipment-barcode")?.value||"",i=y(n).trim(),r=w(t.querySelector("#new-equipment-price")?.value||"0"),s=w(t.querySelector("#new-equipment-cost")?.value||"0"),o=ie(t.querySelector("#new-equipment-qty")?.value||"1"),c=t.querySelector("#new-equipment-image")?.value?.trim()||"",u=t.querySelector("#new-equipment-category")?.value?.trim()||"",p=t.querySelector("#new-equipment-sub")?.value?.trim()||"",g=t.querySelector("#new-equipment-lessor")?.value?.trim()||"",m=t.querySelector("#new-equipment-status")?.value||"Ù…ØªØ§Ø­";if(!a||!i){h(l("equipment.toast.missingFields","âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙˆØµÙ ÙˆØ§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯"));return}const d=De({category:u,subcategory:p,description:a,quantity:o,unit_price:r,unit_cost:s,barcode:i,status:m,image_url:c,lessor:g});try{const b=await G("/equipment/",{method:"POST",body:d}),f=qe(b?.data),q=Number.isFinite(Number(f?.cost))?Number(f.cost):Number.isFinite(Number(d.unit_cost))?Number(d.unit_cost):0,B={...f,cost:q},L=[...E(),B];U(L),N(),t.reset();const I=t.querySelector("#new-equipment-status");I&&(I.value="Ù…ØªØ§Ø­"),h(l("equipment.toast.addSuccess","âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¹Ø¯Ø©"))}catch(b){const f=Z(b,"equipment.toast.addFailed","ØªØ¹Ø°Ø± Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¹Ø¯Ø©");h(f,"error")}}async function ft(e){if(!ge()){we();return}const t=E(),a=t[e];if(a&&confirm(l("equipment.toast.deleteConfirm","âŒ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¹Ø¯Ø©ØŸ")))try{a.id&&await G(`/equipment/?id=${encodeURIComponent(a.id)}`,{method:"DELETE"});const n=[...t];n.splice(e,1),U(n),N(),h(l("equipment.toast.deleteSuccess","ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø¹Ø¯Ø©"))}catch(n){const i=Z(n,"equipment.toast.deleteFailed","ØªØ¹Ø°Ø± Ø­Ø°Ù Ø§Ù„Ù…Ø¹Ø¯Ø©ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø¬Ø¯Ø¯Ø§Ù‹");h(i,"error")}}async function ln(e,t){const a=E(),n=a[e];if(!n)throw new Error("Equipment item not found");if(!n.id){const r=[...a];r[e]={...r[e],...t},U(r),N();return}const i=De({category:t.category,subcategory:t.sub,description:t.desc,quantity:t.qty,unit_price:t.price,unit_cost:t.cost,barcode:t.barcode,status:t.status,image_url:t.image,lessor:t.lessor});try{const r=await G(`/equipment/?id=${encodeURIComponent(n.id)}`,{method:"PATCH",body:i}),s=qe(r?.data),o=Number.isFinite(Number(s?.cost))?Number(s.cost):Number.isFinite(Number(t.cost))?Number(t.cost):Number.isFinite(Number(n.cost))?Number(n.cost):0,c={...s,cost:o},u=[...a];u[e]=c,U(u),N(),h(l("equipment.toast.updateSuccess","âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­"))}catch(r){const s=Z(r,"equipment.toast.updateFailed","ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ø¯Ø©");throw h(s,"error"),r}}function re(){N()}function je(e){const a=E()[e];if(!a)return;X=e;const n=a;document.getElementById("edit-equipment-index").value=e,ve({category:n.category||"",subcategory:n.sub||"",description:n.desc||n.description||"",quantity:String(n.qty||0),price:n.price!=null?String(n.price):"0",cost:n.cost!=null?String(n.cost):"0",image:J(n)||"",barcode:n.barcode||"",status:n.status||_(n.status),lessor:n.lessor||""}),Y(!1),P=me(),Q(n),Fe(n),mt(n),j={groupKey:R(n),barcode:String(n.barcode||""),id:n.id||null},Vt(document.getElementById("editEquipmentModal"))?.show()}function dn(e){const t=e.target.closest('[data-equipment-action="select-reservation"]');if(t){e.preventDefault(),e.stopPropagation();const i=t.closest('[data-equipment-card="true"]'),r=i?.querySelector("[data-equipment-select-quantity]");let s=Number.parseInt(r?.value||"1",10);(!Number.isFinite(s)||s<=0)&&(s=1);const o=Number.parseInt(t.dataset.selectionMax||"0",10);Number.isFinite(o)&&o>0&&s>o&&(s=o);const u=(t.dataset.selectionBarcodes||"").split(",").map(d=>d.trim()).filter(d=>d.length>0),p=i?.querySelector(".equipment-card__title")?.textContent?.trim()||"",g=i?.dataset.equipmentGroupKey||t.dataset.selectionGroup||"";Pt({barcodes:u,quantity:s,groupKey:g,description:p})||h(l("reservations.create.equipment.selector.selectionInactive","âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø­Ø¬Ø² ÙˆØªÙØ¹ÙŠÙ„ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø¹Ø¯Ø§Øª Ù…Ù† Ø¬Ø¯ÙŠØ¯"));return}if(e.target.closest("[data-equipment-select-quantity]")||e.target.closest(".equipment-card__selection-controls"))return;const a=e.target.closest('[data-equipment-action="delete"]');if(a){e.preventDefault(),e.stopPropagation();const i=Number(a.dataset.equipmentIndex);Number.isNaN(i)||ft(i).catch(r=>{console.error("âŒ [equipment.js] deleteEquipment",r)});return}const n=e.target.closest('[data-equipment-card="true"]');if(n){const i=Number(n.dataset.equipmentIndex);Number.isNaN(i)||je(i)}}function mn(e){if(e.defaultPrevented||e.target.closest("[data-equipment-action]")||e.target.matches("[data-equipment-select-quantity]")||e.target.closest(".equipment-card__selection-controls"))return;const t=e.target.closest('[data-equipment-card="true"]');if(t&&(e.key==="Enter"||e.key===" ")){e.preventDefault();const a=Number(t.dataset.equipmentIndex);Number.isNaN(a)||je(a)}}function pn(e){const t=e.target.closest('[data-variant-action="focus"]');if(t){const n=Number(t.dataset.variantIndex);Number.isNaN(n)||je(n);return}const a=e.target.closest('[data-variant-action="delete"]');if(a){const n=Number(a.dataset.variantIndex);Number.isNaN(n)||ft(n).catch(i=>{console.error("âŒ [equipment.js] deleteEquipment",i)});return}}function gt(){if(!j||!document.getElementById("editEquipmentModal")?.classList.contains("show"))return;const a=E(),n=j.id?a.find(c=>String(c.id)===String(j.id)):null,i=j.groupKey,r=i?a.find(c=>R(c)===i):null,s=n||r;if(!s){pe();return}const o=a.findIndex(c=>c===s);if(o>=0){const c=document.getElementById("edit-equipment-index");c&&(c.value=String(o)),X=o}if(mt(s),Q(s),Fe(s),!ye){const c=s;ve({category:c.category||"",subcategory:c.sub||"",description:c.desc||c.description||"",quantity:String(c.qty||0),price:c.price!=null?String(c.price):"0",cost:c.cost!=null?String(c.cost):"0",image:J(c)||"",barcode:c.barcode||"",status:c.status||_(c.status),lessor:c.lessor||""}),P=me()}Q(s)}function fn(){document.getElementById("search-equipment")?.addEventListener("input",re),document.getElementById("filter-category")?.addEventListener("change",re),document.getElementById("filter-sub")?.addEventListener("change",re),document.getElementById("filter-status")?.addEventListener("change",re),document.getElementById("add-equipment-form")?.addEventListener("submit",un),We(document.getElementById("new-equipment-barcode")),pt();const e=document.getElementById("generate-equipment-barcode");e&&!e.dataset.listenerAttached&&(e.addEventListener("click",r=>{r.preventDefault();const s=document.getElementById("new-equipment-barcode");if(!s)return;const o=Gt();s.value=o,s.dispatchEvent(new Event("input",{bubbles:!0})),s.focus()}),e.dataset.listenerAttached="true");const t=document.getElementById("equipment-clear-btn");t&&!t.dataset.listenerAttached&&(t.addEventListener("click",r=>{r.preventDefault(),dt().catch(s=>{console.error("âŒ [equipment.js] clearEquipment",s)})}),t.dataset.listenerAttached="true");const a=document.getElementById("excel-download-trigger");a&&!a.dataset.listenerAttached&&(a.addEventListener("click",r=>{r.preventDefault(),ut().catch(s=>{console.error("âŒ [equipment.js] downloadEquipmentToExcel",s)})}),a.dataset.listenerAttached="true");const n=document.getElementById("equipment-list");n&&!n.dataset.listenerAttached&&(n.addEventListener("click",dn),n.addEventListener("keydown",mn),n.dataset.listenerAttached="true");const i=document.getElementById("equipment-variants-table-body");i&&!i.dataset.listenerAttached&&(i.addEventListener("click",pn),i.dataset.listenerAttached="true"),["edit-equipment-quantity","edit-equipment-price","edit-equipment-cost","edit-equipment-barcode"].forEach(r=>{const s=document.getElementById(r);We(s)})}document.getElementById("save-equipment-changes")?.addEventListener("click",async()=>{if(!ye){P=me(),Y(!0);return}const e=document.getElementById("edit-equipment-index").value,t=Number.parseInt(e,10);if(Number.isNaN(t)){h(l("equipment.toast.updateFailed","ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ø¯Ø©"),"error");return}const a={category:document.getElementById("edit-equipment-category").value,sub:document.getElementById("edit-equipment-subcategory").value,desc:document.getElementById("edit-equipment-description").value,qty:ie(document.getElementById("edit-equipment-quantity").value)||1,price:w(document.getElementById("edit-equipment-price").value)||0,cost:w(document.getElementById("edit-equipment-cost").value)||0,barcode:y(document.getElementById("edit-equipment-barcode").value).trim(),status:document.getElementById("edit-equipment-status").value,image:document.getElementById("edit-equipment-image").value,lessor:document.getElementById("edit-equipment-lessor").value};try{await ln(t,a);const n=E()[t];n&&(ve({category:n.category||"",subcategory:n.sub||"",description:n.desc||n.description||"",quantity:String(n.qty||0),price:n.price!=null?String(n.price):"0",cost:n.cost!=null?String(n.cost):"0",image:J(n)||"",barcode:n.barcode||"",status:n.status||_(n.status),lessor:n.lessor||""}),Q(n),Fe(n)),P=me(),Y(!1),gt()}catch(n){console.error("âŒ [equipment.js] editEquipment",n)}});document.addEventListener("DOMContentLoaded",()=>{fn(),N(),se();const e=document.getElementById("equipment-edit-cancel");e&&!e.dataset.listenerAttached&&(e.addEventListener("click",()=>{if(P&&ve(P),X!=null){const n=E()[X];if(n){const r=ct(n)[0]||n;Q(r)}}Y(!1)}),e.dataset.listenerAttached="true");const t=document.getElementById("save-equipment-changes");t&&!t.dataset.listenerAttached&&(t.dataset.listenerAttached="true",t.dataset.mode||(t.dataset.mode="view"))});document.addEventListener("language:changed",()=>{if(N(),Y(ye),X!=null){const t=E()[X];if(t){const n=ct(t)[0]||t;Q(n)}}});document.addEventListener("equipment:refreshRequested",()=>{se({showToastOnError:!1})});document.addEventListener(xt.USER_UPDATED,()=>{N()});document.addEventListener("equipment:changed",()=>{gt(),pt()});document.addEventListener("reservations:changed",()=>{Re(),N()});document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("editEquipmentModal");e&&!e.dataset.variantsListenerAttached&&(e.addEventListener("hidden.bs.modal",()=>{j=null,pe(),X=null,P=null,Y(!1)}),e.dataset.variantsListenerAttached="true")});typeof document<"u"&&!Ge&&(document.addEventListener(ae.change,()=>{ot(),N()}),Ge=!0);const Nn=Object.freeze(Object.defineProperty({__proto__:null,clearEquipment:dt,downloadEquipmentToExcel:ut,refreshEquipmentFromApi:se,renderEquipment:N,syncEquipmentStatuses:Re,uploadEquipmentFromExcel:nn},Symbol.toStringTag,{value:"Module"})),fe="reservations-ui:ready",O=typeof EventTarget<"u"?new EventTarget:null;let H={};function gn(e){return Object.freeze({...e})}function bn(){if(!O)return;const e=H,t=typeof CustomEvent=="function"?new CustomEvent(fe,{detail:e}):{type:fe,detail:e};typeof O.dispatchEvent=="function"&&O.dispatchEvent(t)}function In(e={}){if(!e||typeof e!="object")return H;const t={...H};return Object.entries(e).forEach(([a,n])=>{typeof n=="function"?t[a]=n:n===null&&delete t[a]}),H=gn(t),bn(),H}function yn(e){if(e)return H?.[e]}function An(e){const t=yn(e);return typeof t=="function"?Promise.resolve(t):new Promise(a=>{const n=i=>{const s=(i?.detail||H)?.[e];typeof s=="function"&&(O&&O.removeEventListener(fe,n),a(s))};O&&O.addEventListener(fe,n)})}export{ae as E,Sn as _,Bn as a,se as b,Ce as c,Ht as d,Ln as e,In as f,yn as g,Nn as h,_n as i,N as r,Re as s,nn as u,An as w};
