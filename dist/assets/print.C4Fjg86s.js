import{e as m}from"./calculations.DWxjbU9W.js";import{preloadImages as f,ensureFontsReady as u}from"./assets.B6gKQXMp.js";import"./reservationsService.BGgi72ed.js";import"./auth.Dym-pMl4.js";import"./state.D0_ft4YH.js";function p(e){try{if(!e)return!1;const o=!!e.querySelector(".callsheet-v1 .cs-header, .callsheet-v1 .cs-info td, .callsheet-v1 .cs-cast td"),c=!!Array.from(e.querySelectorAll(".callsheet-v1 table.cs-crew tbody tr")).find(a=>{try{return Array.from(a.querySelectorAll("td")).some(r=>(r.textContent||"").trim().length>0)}catch{return!1}}),t=!!Array.from(e.querySelectorAll("table.tpl-table tbody tr")).find(a=>{try{return Array.from(a.querySelectorAll("td")).some(s=>(s.textContent||"").trim().length>0)}catch{return!1}});return o||c||t}catch{return!0}}async function C(e){if(!e)throw new Error("No host");let o=null;try{o=await m()}catch{o=null}const c=document.createElement("div");Object.assign(c.style,{position:"fixed",top:"0",left:"-12000px",pointerEvents:"none",zIndex:"-1",backgroundColor:"#ffffff"});const t=document.createElement("div");t.id="templates-a4-root",t.setAttribute("data-render-context","export"),t.setAttribute("dir",e.getAttribute("dir")||document.documentElement.getAttribute("dir")||"rtl");const a=document.createElement("div");a.setAttribute("data-a4-pages","");const r=e.querySelector("[data-a4-pages]")?.cloneNode(!0)||e.cloneNode(!0);r.classList&&r.hasAttribute("data-a4-pages")?t.appendChild(r):(a.appendChild(r),t.appendChild(a)),c.appendChild(t),document.body.appendChild(c);try{try{const l=Array.from(t.querySelectorAll(".cs-logo img")).map(d=>d.getAttribute("src")).filter(Boolean);await f(l)}catch{}if(await u(),Array.from(t.querySelectorAll(".a4-page")).forEach(l=>{p(l)||l.parentElement?.removeChild(l)}),typeof o=="function"){await o().set({margin:0,html2canvas:{scale:2,useCORS:!0,allowTaint:!1,backgroundColor:"#ffffff"},jsPDF:{unit:"mm",format:"a4",orientation:"landscape"},pagebreak:{mode:["css","legacy"]},image:{type:"jpeg",quality:.98}}).from(t).save("template-callsheet.pdf");return}const s=`<!doctype html><html dir="${t.getAttribute("dir")||"rtl"}"><head><meta charset="utf-8"><title>Call Sheet</title><style>@page{size:A4 landscape;margin:0}html,body{margin:0;padding:0;background:#fff}#templates-a4-root{transform:none!important}</style></head><body>${t.innerHTML}</body></html>`,n=document.createElement("iframe");Object.assign(n.style,{position:"fixed",right:"0",bottom:"0",width:"1px",height:"1px",border:"0"}),document.body.appendChild(n);const i=n.contentWindow?.document;i&&(i.open(),i.write(s),i.close(),n.onload=()=>{try{n.contentWindow?.focus(),n.contentWindow?.print()}catch{}setTimeout(()=>n.remove(),1200)})}finally{try{c.remove()}catch{}}}export{C as printCallsheetFromHost};
