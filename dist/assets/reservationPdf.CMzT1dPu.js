import{n as N,j as ut,t as r,d as nn,b as wa,h as qa,p as re,B as Sa,y as dt,C as Dn}from"./auth.4wm6TDRq.js";import{n as ka,v as wt,t as Ct,a as Aa,b as an,d as Ln,H as Fn,g as Mn,r as _a,c as xa,e as $a,h as Ta}from"./reservationsService.CCk64LpW.js";import{s as Ca,i as pt,j as kn,I as Rn,O as On}from"./state.CHxuDg1L.js";import{h as Ea}from"./view.BYc7X24Z.js";import{q as Na}from"./quotePdf.7eoNc5wN.js";import{s as Bn,a as Kn,e as Hn,p as ja}from"./canvasColorUtils.CviLtv6S.js";function Qn(e){const t=new Date;if(t.setHours(0,0,0,0),e==="today")return{startDate:tt(t),endDate:tt(t)};if(e==="week"){const n=new Date(t),a=n.getDay(),s=a===0?6:a-1;n.setDate(n.getDate()-s);const u=new Date(n);return u.setDate(n.getDate()+6),{startDate:tt(n),endDate:tt(u)}}if(e==="month"){const n=new Date(t.getFullYear(),t.getMonth(),1),a=new Date(t.getFullYear(),t.getMonth()+1,0);return{startDate:tt(n),endDate:tt(a)}}return e==="upcoming"?{startDate:tt(t),endDate:""}:{startDate:"",endDate:""}}function Zs(){const e=document.getElementById("search-reservation"),t=document.getElementById("filter-start-date"),n=document.getElementById("filter-end-date"),a=document.getElementById("reservation-date-range"),s=document.getElementById("reservation-status-filter");let u=N(t?.value||"").trim(),o=N(n?.value||"").trim(),c=a?.value||"";if(new Set(["","today","week","month"]).has(c)||(c="",a&&(a.value=""),Et(t),Et(n),u="",o=""),!u&&!o&&c){const h=Qn(c);u=h.startDate,o=h.endDate}return{searchTerm:ka(e?.value||""),startDate:u,endDate:o,status:s?.value||"",quickRange:c}}function eo(e){const t=()=>{typeof e=="function"&&e()},n=document.getElementById("search-reservation");n&&!n.dataset.listenerAttached&&(n.addEventListener("input",()=>{n.value=N(n.value),t()}),n.dataset.listenerAttached="true");const a=document.getElementById("filter-start-date");a&&!a.dataset.listenerAttached&&(a.addEventListener("change",()=>{const d=document.getElementById("reservation-date-range");d&&(d.value=""),t()}),a.dataset.listenerAttached="true");const s=document.getElementById("filter-end-date");s&&!s.dataset.listenerAttached&&(s.addEventListener("change",()=>{const d=document.getElementById("reservation-date-range");d&&(d.value=""),t()}),s.dataset.listenerAttached="true");const u=document.getElementById("reservation-date-range");u&&!u.dataset.listenerAttached&&(u.addEventListener("change",()=>{Ia(u.value),t()}),u.dataset.listenerAttached="true");const o=document.getElementById("reservation-status-filter");o&&!o.dataset.listenerAttached&&(o.addEventListener("change",t),o.dataset.listenerAttached="true");const c=document.getElementById("clear-filters");c&&!c.dataset.listenerAttached&&(c.addEventListener("click",()=>{n&&(n.value=""),Et(a),Et(s),u&&(u.value=""),o&&(o.value=""),t()}),c.dataset.listenerAttached="true")}function Ia(e){const t=document.getElementById("filter-start-date"),n=document.getElementById("filter-end-date");if(!t||!n)return;const{startDate:a,endDate:s}=Qn(e);t._flatpickr?a?t._flatpickr.setDate(a,!1,"Y-m-d"):t._flatpickr.clear():t.value=a,n._flatpickr?s?n._flatpickr.setDate(s,!1,"Y-m-d"):n._flatpickr.clear():n.value=s}function tt(e){if(!e)return"";const t=e.getTimezoneOffset()*6e4;return new Date(e.getTime()-t).toISOString().split("T")[0]}function Et(e){e&&(e._flatpickr&&e._flatpickr.clear(),e.value="")}const Pa=""+new URL("Tajawal-400.ttf",import.meta.url).href,Da=""+new URL("Tajawal-500.ttf",import.meta.url).href,An=""+new URL("Tajawal-700.ttf",import.meta.url).href,La="reservations.quote.sequence",_n={reservation:"reservations.quote.togglePrefs.v1",project:"projects.quote.togglePrefs.v1",reservationChecklist:"reservations.checklist.togglePrefs.v1"},zn="https://help.artratio.sa/guide/quote-preview",be={logoUrl:"https://art-ratio.sirv.com/AR-Logo-v3.5-curved.png",companyName:"Ø´Ø±ÙƒØ© ÙÙˆØ¯ Ø¢Ø±Øª Ù„Ù„Ø¯Ø¹Ø§ÙŠØ© ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù† (Ø´Ø±ÙƒØ© Ø´Ø®Øµ ÙˆØ§Ø­Ø¯)",commercialRegistry:"4030485240",beneficiaryName:"Ø´Ø±ÙƒØ© ÙÙˆØ¯ Ø¢Ø±Øª Ù„Ù„Ø¯Ø¹Ø§ÙŠØ© ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù† (Ø´Ø±ÙƒØ© Ø´Ø®Øµ ÙˆØ§Ø­Ø¯)",bankName:"Ù…ØµØ±Ù Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠ",accountNumber:"Ù£Ù¥Ù¨Ù Ù Ù Ù Ù¡Ù Ù Ù Ù¦Ù Ù¨Ù¦Ù Ù¦Ù¥Ù§Ù Ù¦",iban:"SA1680000358608016065706",approvalNote:"Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø±Ø¶ ØªØ¹ØªØ¨Ø± Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…."},Fa=["ÙŠÙˆÙ… Ø§Ù„Ø¹Ù…Ù„ Ù‡Ùˆ 12 Ø³Ø§Ø¹Ø©ØŒ ÙˆÙŠØªÙ… Ø§Ø­ØªØ³Ø§Ø¨ Ù†ØµÙ ÙŠÙˆÙ… Ø¥Ø¶Ø§ÙÙŠ Ø¨Ø¹Ø¯ 20 Ø³Ø§Ø¹Ø©ØŒ Ø«Ù… ÙŠÙˆÙ… ÙƒØ§Ù…Ù„ Ø¨Ø¹Ø¯ Ø°Ù„Ùƒ.","ÙŠÙ…Ù†Ø¹ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙÙŠ Ø£Ù†Ø´Ø·Ø© ØºÙŠØ± Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©.","ÙŠØªØ­Ù…Ù„ Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø± Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© Ø£ÙŠ ØªÙ„Ù Ø£Ùˆ ÙÙ‚Ø¯Ø§Ù†.","ÙŠØ¬Ø¨ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙÙŠ Ø­Ø§Ù„ØªÙ‡Ø§ Ø§Ù„Ø£ØµÙ„ÙŠØ©.","ÙŠØªÙ… ÙØ±Ø¶ Ø±Ø³ÙˆÙ… Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ù„ØºØ§Ø¡ Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ù‚Ø¨Ù„ 24 Ø³Ø§Ø¹Ø©."],Ie=[...Fa],Ma=["ÙŠØªÙ… Ø¯ÙØ¹ 50% Ù…Ù† Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø±ØŒ ÙˆÙŠØªÙ… Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø§Ù„Ù€ 50% Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ.","ÙŠØ­ØµÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¹Ù„Ù‰ Ø­Ù‚ÙˆÙ‚ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© ÙÙŠ Ø£ÙŠ Ù…ÙƒØ§Ù† ÙŠØ±Ø§Ù‡ Ù…Ù†Ø§Ø³Ø¨Ø§Ù‹ØŒ Ø¨ÙŠÙ†Ù…Ø§ ØªØ­ØªÙØ¸ Ø§Ù„Ø´Ø±ÙƒØ© Ø¨Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø®Ø§Ù… ÙˆÙ„Ø§ ØªØ³ØªØ®Ø¯Ù…Ù‡Ø§ Ø¥Ù„Ø§ Ø¨Ø¹Ø¯ Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ø§ Ù„Ù… ÙŠÙØªÙÙ‚ Ø¹Ù„Ù‰ ØºÙŠØ± Ø°Ù„Ùƒ.","ÙŠØªÙ… Ø§Ù„Ø§ØªÙØ§Ù‚ Ø¹Ù„Ù‰ Ø¬Ø¯ÙˆÙ„ Ø²Ù…Ù†ÙŠ Ù„Ù„ØªÙ†ÙÙŠØ°ØŒ ÙˆØ£ÙŠ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ø®Ø§Ø±Ø¬ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ù…ØªÙÙ‚ Ø¹Ù„ÙŠÙ‡ ØªØ®Ø¶Ø¹ Ù„Ø±Ø³ÙˆÙ… Ø¥Ø¶Ø§ÙÙŠØ©.","Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù† ØªÙˆÙÙŠØ± Ø§Ù„ØªØµØ§Ø±ÙŠØ­ Ø§Ù„Ù„Ø§Ø²Ù…Ø© Ù„Ù„ØªØµÙˆÙŠØ± ÙÙŠ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©ØŒ ÙˆØ£ÙŠ ØªØ£Ø®ÙŠØ± Ù†Ø§ØªØ¬ Ø¹Ù† Ø°Ù„Ùƒ Ù‚Ø¯ ÙŠØ¤Ø«Ø± Ø¹Ù„Ù‰ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„ØªØ³Ù„ÙŠÙ….","ØªÙØ­ÙÙØ¸ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ù„Ù„Ù…Ø´Ø±ÙˆØ¹ Ù„Ù…Ø¯Ø© 12 Ø´Ù‡Ø±Ø§Ù‹ ÙÙŠ Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ø´Ø±ÙƒØ©ØŒ ÙˆÙŠÙ…ÙƒÙ† Ù„Ù„Ø¹Ù…ÙŠÙ„ Ø·Ù„Ø¨ Ù†Ø³Ø® Ø¥Ø¶Ø§ÙÙŠØ© Ø®Ù„Ø§Ù„ ØªÙ„Ùƒ Ø§Ù„ÙØªØ±Ø©.","ÙŠØªØ­Ù…Ù‘Ù„ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© ØªÙˆÙÙŠØ± Ø¨ÙŠØ¦Ø© Ø¹Ù…Ù„ Ø¢Ù…Ù†Ø© Ù„Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ ÙˆØ§Ù„Ù…Ø¹Ø¯Ø§Øª ÙÙŠ Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªØµÙˆÙŠØ±ØŒ ÙˆÙŠØ¶Ù…Ù† Ø§ØªØ®Ø§Ø° ÙƒØ§ÙØ© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·Ø§Øª Ø§Ù„Ù„Ø§Ø²Ù…Ø© Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø³Ù„Ø§Ù…ØªÙ‡Ù…."];function Wt(e){return e?e.split(/\r?\n/).map(t=>t.trim()).filter(t=>t.length>0):[...Ie]}function Ra(){const e=document.getElementById("reservation-terms");if(e&&e.value.trim().length>0){const a=Wt(e.value);if(a.length)return a}const t=document.getElementById("edit-res-terms");if(t&&t.value.trim().length>0){const a=Wt(t.value);if(a.length)return a}const n=Ie.join(`
`);return e&&e.value.trim().length===0&&(e.value=n),t&&t.value.trim().length===0&&(t.value=n),[...Ie]}const Oa=[{id:"customerInfo",labelKey:"reservations.quote.sections.customer",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„",defaultSelected:!0},{id:"reservationInfo",labelKey:"reservations.quote.sections.reservation",fallback:"ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²",defaultSelected:!0},{id:"projectInfo",labelKey:"reservations.quote.sections.project",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",defaultSelected:!0},{id:"financialSummary",labelKey:"reservations.quote.sections.financial",fallback:"Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ",defaultSelected:!0},{id:"items",labelKey:"reservations.quote.sections.items",fallback:"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",defaultSelected:!0},{id:"crew",labelKey:"reservations.quote.sections.crew",fallback:"Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„",defaultSelected:!0},{id:"notes",labelKey:"reservations.quote.sections.notes",fallback:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø­Ø¬Ø²",defaultSelected:!0},{id:"payment",labelKey:"reservations.quote.sections.payment",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹",defaultSelected:!1}],Ft=[{id:"rowNumber",labelKey:null,fallback:"#",render:(e,t)=>i(N(String(t+1)))},{id:"code",labelKey:"reservations.details.table.headers.code",fallback:"Ø§Ù„ÙƒÙˆØ¯",render:e=>{if(e?.isPackage){const t=e?.packageCodeResolved||e?.barcode||"";return i(t||"-")}return i(e?.barcode||"-")}},{id:"description",labelKey:"reservations.details.table.headers.description",fallback:"Ø§Ù„ÙˆØµÙ",render:e=>{const t=String(e?.desc||e?.description||"-");return`<div class="quote-cell quote-cell--desc">${i(t)}</div>`}},{id:"quantity",labelKey:"reservations.details.table.headers.quantity",fallback:"Ø§Ù„ÙƒÙ…ÙŠØ©",render:e=>i(N(String(e?.qty||1)))},{id:"unitPrice",labelKey:"reservations.quote.columns.unitPrice",fallback:"Ù„ÙƒÙ„ ÙŠÙˆÙ…",render:e=>i(N(Number(e?.unitPriceValue||0).toFixed(2)))},{id:"price",labelKey:"reservations.quote.columns.total",fallback:"Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹",render:e=>i(N(Number(e?.price||0).toFixed(2)))}],Mt=[{id:"rowNumber",labelKey:null,fallback:"#",render:(e,t)=>i(N(String(t+1)))},{id:"position",labelKey:"reservations.details.crew.position",fallback:"Ø§Ù„Ù…Ù†ØµØ¨",render:e=>{const t=typeof re=="function"?re():"ar",n=e?.positionLabelEn??e?.position_label_en??e?.position_name_en??e?.positionLabelAlt??e?.position_label_alt??e?.role,a=e?.positionLabel??e?.position_name??e?.role??r("reservations.crew.positionFallback","Ù…Ù†ØµØ¨ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…");return i(N(String(t==="en"&&n?n:a)))}},{id:"unitPrice",labelKey:"reservations.quote.columns.unitPrice",fallback:"Ù„ÙƒÙ„ ÙŠÙˆÙ…",render:e=>{const t=Number.isFinite(Number(e?.positionClientPrice))?Number(e.positionClientPrice):0;return i(`${N(t.toFixed(2))} ${r("reservations.create.summary.currency","SR")}`)}},{id:"price",labelKey:"reservations.quote.columns.total",fallback:"Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹",render:e=>{const t=Number.isFinite(Number(e?.positionClientPrice))?Number(e.positionClientPrice):0;return i(`${N(t.toFixed(2))} ${r("reservations.create.summary.currency","SR")}`)}}],Ge={customerInfo:[{id:"customerName",labelKey:"reservations.details.labels.customer",fallback:"Ø§Ù„Ø¹Ù…ÙŠÙ„"},{id:"customerCompany",labelKey:"reservations.details.labels.company",fallback:"Ø§Ù„Ø´Ø±ÙƒØ©"},{id:"customerPhone",labelKey:"reservations.details.labels.phone",fallback:"Ø§Ù„Ù‡Ø§ØªÙ"},{id:"customerEmail",labelKey:"reservations.details.labels.email",fallback:"Ø§Ù„Ø¨Ø±ÙŠØ¯"}],reservationInfo:[{id:"reservationId",labelKey:"reservations.details.labels.reservationId",fallback:"Ø±Ù‚Ù… Ø§Ù„Ø­Ø¬Ø²"},{id:"reservationStart",labelKey:"reservations.details.labels.start",fallback:"Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø­Ø¬Ø²"},{id:"reservationEnd",labelKey:"reservations.details.labels.end",fallback:"Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø­Ø¬Ø²"},{id:"reservationDuration",labelKey:"reservations.details.labels.duration",fallback:"Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…"}],projectInfo:[{id:"projectTitle",labelKey:"reservations.details.labels.project",fallback:"Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectCode",labelKey:"reservations.details.labels.code",fallback:"Ø§Ù„Ø±Ù…Ø²"}],financialSummary:[{id:"discountAmount",labelKey:"reservations.details.labels.discount",fallback:"Ø§Ù„Ø®ØµÙ…"},{id:"subtotalBeforeTax",labelKey:"reservations.details.labels.subtotalBeforeTax",fallback:"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"},{id:"taxAmount",labelKey:"reservations.details.labels.tax",fallback:"Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"},{id:"finalTotal",labelKey:"reservations.details.labels.total",fallback:"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ"}],payment:[{id:"beneficiary",labelKey:"reservations.quote.labels.beneficiary",fallback:"Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙÙŠØ¯"},{id:"bank",labelKey:"reservations.quote.labels.bank",fallback:"Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ"},{id:"account",labelKey:"reservations.quote.labels.account",fallback:"Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨"},{id:"iban",labelKey:"reservations.quote.labels.iban",fallback:"Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ¨Ø§Ù†"}],items:[...Ft.map(({id:e,labelKey:t,fallback:n})=>({id:e,labelKey:t,fallback:n})),{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…"},{id:"equipmentSubtotal",labelKey:"reservations.details.labels.equipmentTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"}],crew:[...Mt.map(({id:e,labelKey:t,fallback:n})=>({id:e,labelKey:t,fallback:n})),{id:"quantity",labelKey:"reservations.details.table.headers.quantity",fallback:"Ø§Ù„ÙƒÙ…ÙŠØ©"},{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…"},{id:"crewSubtotal",labelKey:"reservations.details.labels.crewTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±ÙŠÙ‚"}]},Un=[{id:"rowNumber",labelKey:null,fallback:"#",render:(e,t)=>i(N(String(t+1)))},{id:"label",labelKey:null,fallback:"Ø§Ù„Ø¨Ù†Ø¯",render:e=>i(e?.label||"-")},{id:"amount",labelKey:null,fallback:"Ø§Ù„Ø³Ø¹Ø±",render:e=>{const t=Number.isFinite(Number(e?.salePrice??e?.sale_price))?Number(e?.salePrice??e?.sale_price):Number(e?.amount??0)||0;return i(Z(t,r("reservations.create.summary.currency","SR")))}},{id:"note",labelKey:null,fallback:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª",render:e=>i(e?.note||"-")}],Ba=[{id:"customerInfo",labelKey:"projects.quote.sections.customer",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„",defaultSelected:!0},{id:"projectInfo",labelKey:"projects.quote.sections.project",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",defaultSelected:!0},{id:"projectExpenses",labelKey:"projects.quote.sections.expenses",fallback:"Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©",defaultSelected:!0},{id:"projectCrew",labelKey:"projects.quote.sections.crew",fallback:"Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„",defaultSelected:!0},{id:"financialSummary",labelKey:"projects.quote.sections.financial",fallback:"Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ",defaultSelected:!0},{id:"projectEquipment",labelKey:"projects.quote.sections.equipment",fallback:"Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",defaultSelected:!0},{id:"projectNotes",labelKey:"projects.quote.sections.notes",fallback:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",defaultSelected:!0},{id:"payment",labelKey:"reservations.quote.sections.payment",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹",defaultSelected:!1}],Ka={customerInfo:Ge.customerInfo,projectInfo:[{id:"projectTitle",labelKey:"projects.details.overview.heading",fallback:"Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectCode",labelKey:"projects.details.labels.code",fallback:"Ø±Ù‚Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectType",labelKey:"projects.details.type",fallback:"Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectStart",labelKey:"projects.details.start",fallback:"Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectEnd",labelKey:"projects.details.end",fallback:"Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectDuration",labelKey:"projects.details.duration",fallback:"Ù…Ø¯Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectStatus",labelKey:"projects.details.status",fallback:"Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"}],financialSummary:[{id:"reservationsTotal",labelKey:"projects.details.reservationsTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª"},{id:"discountAmount",labelKey:"projects.details.summary.discount",fallback:"Ø§Ù„Ø®ØµÙ…"},{id:"taxAmount",labelKey:"projects.details.summary.combinedTax",fallback:"Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"},{id:"overallTotal",labelKey:"projects.details.summary.overallTotal",fallback:"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ"}],payment:Ge.payment,projectExpenses:[...Un.map(({id:e,labelKey:t,fallback:n})=>({id:e,labelKey:t,fallback:n})),{id:"expensesSubtotal",labelKey:"projects.details.expensesTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©"}],projectCrew:[...Mt.map(({id:e,labelKey:t,fallback:n})=>({id:e,labelKey:t,fallback:n})),{id:"quantity",labelKey:"reservations.details.table.headers.quantity",fallback:"Ø§Ù„ÙƒÙ…ÙŠØ©"},{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…"},{id:"crewSubtotal",labelKey:"reservations.details.labels.crewTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±ÙŠÙ‚"}],projectEquipment:[...Ft.map(({id:e,labelKey:t,fallback:n})=>({id:e,labelKey:t,fallback:n})),{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…"},{id:"equipmentSubtotal",labelKey:"reservations.details.labels.equipmentTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"}],projectNotes:[]},Ut=new Map;function Rt(e="reservation"){if(Ut.has(e))return Ut.get(e);const t=e==="project"?Ba:e==="reservationChecklist"?[{id:"customerInfo",labelKey:"reservations.quote.sections.customer",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„",defaultSelected:!0},{id:"reservationInfo",labelKey:"reservations.quote.sections.reservation",fallback:"ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²",defaultSelected:!0},{id:"projectInfo",labelKey:"reservations.quote.sections.project",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",defaultSelected:!0},{id:"notes",labelKey:"reservations.quote.sections.notes",fallback:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø­Ø¬Ø²",defaultSelected:!0},{id:"items",labelKey:"reservations.quote.sections.items",fallback:"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",defaultSelected:!0},{id:"crew",labelKey:"reservations.quote.sections.crew",fallback:"Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„",defaultSelected:!0}]:Oa,n=e==="project"?Ka:e==="reservationChecklist"?{customerInfo:Ge.customerInfo,reservationInfo:Ge.reservationInfo,projectInfo:Ge.projectInfo,notes:[],items:Ge.items,crew:Ge.crew}:Ge,a=new Set(t.map(({id:o})=>o)),s=Object.fromEntries(Object.entries(n).map(([o,c=[]])=>[o,new Set(c.map(d=>d.id))])),u={sectionDefs:t,fieldDefs:n,sectionIdSet:a,fieldIdMap:s};return Ut.set(e,u),u}function Ot(e="reservation"){return Rt(e).sectionDefs}function Vn(e="reservation"){return Rt(e).fieldDefs}function Wn(e="reservation"){return Rt(e).sectionIdSet}function Gn(e="reservation"){return Rt(e).fieldIdMap}function Yn(e){switch(e){case"export":return r("reservations.quote.status.exporting","Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ù…Ù„Ù PDF...");case"render":default:return r("reservations.quote.status.rendering","Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©...")}}const Ha="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js",Qa="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js",za="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js",Xn=Na.trim(),Jn=`
@font-face { font-family: 'Tajawal'; font-style: normal; font-weight: 400; font-display: swap; src: url(${JSON.stringify(Pa)}) format('truetype'); }
@font-face { font-family: 'Tajawal'; font-style: normal; font-weight: 500; font-display: swap; src: url(${JSON.stringify(Da)}) format('truetype'); }
@font-face { font-family: 'Tajawal'; font-style: normal; font-weight: 600; font-display: swap; src: url(${JSON.stringify(An)}) format('truetype'); }
@font-face { font-family: 'Tajawal'; font-style: normal; font-weight: 700; font-display: swap; src: url(${JSON.stringify(An)}) format('truetype'); }
`,Zn=/^data:image\/svg\+xml/i,Ua=/\.svg($|[?#])/i,bt=512,Gt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/B8AAusB9YwpClgAAAAASUVORK5CYII=",ea=96,ta=25.4,Yt=210,At=297,_t=Math.round(Yt/ta*ea),xt=Math.round(At/ta*ea);function fe(e){const t=Number(e),n=Number.isFinite(t)?t:0;try{const a=Math.abs(n%1)>1e-9;return N(n.toLocaleString("en-US",{minimumFractionDigits:a?2:0,maximumFractionDigits:2}))}catch{return Number.isInteger(n)?N(String(n)):N(n.toFixed(2))}}let Nt=!1,jt=null;function sn(){Nt||(jt=async function(){try{if(!l||!A?.modal?.classList.contains("show")||(l.context||"reservation")!=="reservation")return;const n=l.reservation;if(!n)return;const a=[n.id,n.reservationId,n.reservation_id,n.reservationCode,n.reservation_code].map(g=>g==null?"":String(g)).filter(g=>g.length>0);if(!a.length)return;const s=Mn(),u=(Array.isArray(s)?s:[]).find(g=>[g?.id,g?.reservationId,g?.reservation_id,g?.reservationCode,g?.reservation_code].map(S=>S==null?"":String(S)).filter(S=>S.length>0).some(S=>a.includes(S)));if(!u)return;const o=Qt(u),{totalsDisplay:c,totals:d,rentalDays:h}=gn(u,o,l.project);l.reservation=u,l.crewAssignments=o,l.totals=d,l.totalsDisplay=c,l.rentalDays=h,Tt(),Ae()}catch(t){console.warn("[reservationPdf] live update failed",t)}},document.addEventListener("reservations:changed",jt),Nt=!0)}function na(){if(Nt){try{document.removeEventListener("reservations:changed",jt)}catch{}jt=null,Nt=!1}}const aa=2,sa=/safari/i,Va=/(iphone|ipad|ipod)/i,xn=/(iphone|ipad|ipod)/i,Wa=/(crios|fxios|edgios|opios)/i,It="[reservations/pdf]";let A=null,l=null,Oe=1,yt=null,ht=null,Ye=null,lt=null,gt=!1;const Xt="quoteBlockOffsets",$n=1800;let mt=!1,on=!1;function rn(e=l){return e?.context||"reservation"}function Ga(e="reservation"){try{const n=JSON.parse(localStorage.getItem(Xt)||"{}")?.[e];if(n&&typeof n=="object")return JSON.parse(JSON.stringify(n))}catch{}return{}}function oa(e,t={}){try{const n=JSON.parse(localStorage.getItem(Xt)||"{}");t&&Object.keys(t).length>0?n[e]=t:delete n[e],localStorage.setItem(Xt,JSON.stringify(n))}catch{}}function ln(e){if(!e)return;const t=rn(e);e.blockOffsets={...Ga(t)},on=!1,mt=!1,Bt()}function Ya(e,t={}){if(!e)return;e.querySelectorAll("[data-drag-key]").forEach(a=>{const s=a.dataset.dragKey,u=t?.[s],o=Number(u?.x)||0,c=Number(u?.y)||0;o||c?a.style.transform=`translate(${o}px, ${c}px)`:a.style.transform="",a.dataset.dragX=String(o),a.dataset.dragY=String(c)})}function cn(e){try{const t=e?.getElementById("quotation-pdf-root");if(!t)return;t.dataset.blockDragMode=mt?"on":"off"}catch{}}function Bt(){const e=A?.blockDragToggle;if(e){const n=mt?r("reservations.quote.drag.disable","ğŸ”’ Ø¥Ù†Ù‡Ø§Ø¡ ÙˆØ¶Ø¹ Ø§Ù„ØªØ­Ø±ÙŠÙƒ"):r("reservations.quote.drag.enable","ğŸ¯ ÙˆØ¶Ø¹ ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø¨Ù„ÙˆÙƒØ§Øª");e.textContent=n,e.classList.toggle("is-active",mt)}const t=A?.blockDragSave;t&&(t.disabled=!on)}function Xa(e){mt=!!e,Bt();try{cn(A?.previewFrame?.contentDocument)}catch{}}function un(e=!0){on=!!e,Bt()}function Ja(){if(!l)return;const e=rn(l),t=l.blockOffsets||{};oa(e,t),un(!1),ut(r("reservations.quote.drag.saved","âœ… ØªÙ… Ø­ÙØ¸ Ù…ÙˆØ§Ø¶Ø¹ Ø§Ù„Ø¨Ù„ÙˆÙƒØ§Øª."))}function Za(){if(!l)return;l.blockOffsets={};const e=rn(l);oa(e,{}),un(!1),Ae(),ut(r("reservations.quote.drag.reset","â†º ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© Ù…ÙˆØ§Ø¶Ø¹ Ø§Ù„Ø¨Ù„ÙˆÙƒØ§Øª Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ."))}function Tn(e){return Math.min(Math.max(e,-$n),$n)}function es(e){try{const t=e?.getElementById("quotation-pdf-root");if(!t)return;Array.from(t.querySelectorAll("[data-drag-key]")).forEach(a=>{if(a.dataset.blockDragHandleAttached==="true")return;a.style.position=a.style.position||"relative",a.style.touchAction="none";const s=e.createElement("button");s.type="button",s.className="quote-block-drag-handle",s.setAttribute("data-block-handle",a.dataset.dragKey||""),s.setAttribute("aria-label",r("reservations.quote.drag.handle","Ø§Ø³Ø­Ø¨ Ù„ØªØ­Ø±ÙŠÙƒ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…")),s.innerHTML='<span aria-hidden="true">â ¿</span>';const u=o=>{t.dataset.blockDragMode==="on"&&ts(o,a)};s.addEventListener("pointerdown",u),a.prepend(s),a.dataset.blockDragHandleAttached="true"}),cn(e)}catch{}}function ts(e,t){if(!t||!l)return;e.preventDefault(),e.stopPropagation();const n=t.ownerDocument||document,a=e.pointerId;t.setPointerCapture?.(a);const s=e.clientX,u=e.clientY,o=Number(t.dataset.dragX||0),c=Number(t.dataset.dragY||0);let d=o,h=c;const g=t.dataset.dragKey,x=v=>{v.preventDefault();const b=v.clientX-s,I=v.clientY-u;d=Tn(o+b),h=Tn(c+I),t.style.transform=`translate(${d}px, ${h}px)`,t.dataset.dragTempX=String(d),t.dataset.dragTempY=String(h)},S=()=>{n.removeEventListener("pointermove",x),n.removeEventListener("pointerup",S),t.releasePointerCapture?.(a);const v=Number(t.dataset.dragTempX??o),b=Number(t.dataset.dragTempY??c);t.dataset.dragX=String(v),t.dataset.dragY=String(b),t.dataset.dragTempX="",t.dataset.dragTempY="",l.blockOffsets||(l.blockOffsets={}),Math.abs(v)<=.5&&Math.abs(b)<=.5?delete l.blockOffsets[g]:l.blockOffsets[g]={x:v,y:b},un(!0)};n.addEventListener("pointermove",x),n.addEventListener("pointerup",S)}function nt(e="render",{message:t,actionLabel:n,onAction:a,showSpinner:s=e!=="error"}={}){if(!A?.statusIndicator||!A?.statusText)return;A.statusKind=e;const u=t||Yn(e);A.statusText.textContent=u,A.statusSpinner&&(A.statusSpinner.hidden=!s),A.statusAction&&(A.statusAction.hidden=!0,A.statusAction.onclick=null,n&&typeof a=="function"&&(A.statusAction.textContent=n,A.statusAction.hidden=!1,A.statusAction.onclick=o=>{o.preventDefault(),a()})),A.statusIndicator.hidden=!1,requestAnimationFrame(()=>{A.statusIndicator.classList.add("is-visible")})}function ct(e){try{return String(e||"").toLowerCase().normalize("NFKD").replace(/[\u064B-\u065F\u0670\u06D6-\u06ED]/g,"").replace(/\s+/g," ").trim()}catch{return String(e||"").trim().toLowerCase()}}function vt(e){!A?.statusIndicator||!A?.statusText||(A.statusKind=null,A.statusIndicator.classList.remove("is-visible"),setTimeout(()=>{A?.statusIndicator&&(A.statusIndicator.hidden=!0,A.statusAction&&(A.statusAction.hidden=!0,A.statusAction.onclick=null),A.statusSpinner&&(A.statusSpinner.hidden=!1))},220))}function Jt(){return!!window?.bootstrap?.Modal}function ns(e){if(e&&!e.classList.contains("show")){e.classList.add("show"),e.style.display="block",e.removeAttribute("aria-hidden"),e.setAttribute("aria-modal","true"),e.getAttribute("role")||e.setAttribute("role","dialog"),document.body.classList.add("modal-open"),Ye||(Ye=document.createElement("div"),Ye.className="modal-backdrop fade show",Ye.dataset.quotePdfFallbackBackdrop="true",document.body.appendChild(Ye)),lt||(lt=t=>{t.key==="Escape"&&Zt(e)},document.addEventListener("keydown",lt));try{e.focus({preventScroll:!0})}catch{}}}function Zt(e){if(!(!e||!e.classList.contains("show"))){try{const t=e.ownerDocument?.activeElement;if(t&&e.contains(t)){try{t.blur()}catch{}try{e.ownerDocument?.body?.focus({preventScroll:!0})}catch{}}}catch{}e.classList.remove("show"),e.style.display="none",e.setAttribute("aria-hidden","true"),e.removeAttribute("aria-modal"),document.body.classList.remove("modal-open"),Ye&&(Ye.remove(),Ye=null),lt&&(document.removeEventListener("keydown",lt),lt=null);try{na()}catch{}}}function as(e){if(e){if(Jt()){const t=window.bootstrap.Modal.getOrCreateInstance(e);try{const n=()=>{try{const a=document.activeElement;if(a&&e.contains(a)){try{a.blur()}catch{}try{document.body?.focus({preventScroll:!0})}catch{}}}catch{}try{na()}catch{}try{e.removeEventListener("hidden.bs.modal",n)}catch{}};e.addEventListener("hidden.bs.modal",n,{once:!0}),e.addEventListener("hide.bs.modal",()=>{try{const a=document.activeElement;if(a&&e.contains(a))try{a.blur()}catch{}}catch{}})}catch{}t.show();return}ns(e)}}function ss(){if(gt)return;gt=!0;const e=r("reservations.quote.toast.viewGuide","ğŸ“˜ Ø¹Ø±Ø¶ Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø­Ù„ Ø§Ù„Ø³Ø±ÙŠØ¹"),t=r("reservations.quote.toast.retry","Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©"),n=r("reservations.quote.toast.assetsFailed","âš ï¸ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø¨Ø¹Ø¶ Ø§Ù„ØµÙˆØ± Ø¶Ù…Ù† Ø¹Ø±Ø¶ Ø³Ø¹Ø±."),a=!!A?.modal?.classList.contains("show"),s=()=>{A?.modal?.classList.contains("show")&&(nt("render"),gt=!1,Ae())};Dn({message:n,duration:9e3,actionLabel:a?t:void 0,onAction:a?s:void 0,linkLabel:e,linkHref:zn}),a&&nt("error",{message:n,actionLabel:t,onAction:s,showSpinner:!1})}function St(e="reservation"){const t={},n=Vn(e);return Object.entries(n).forEach(([a,s=[]])=>{t[a]=new Set(s.filter(u=>u?.default!==!1).map(u=>u.id))}),t}function dn(e={}){const t={};return Object.entries(e).forEach(([n,a])=>{t[n]=new Set(Array.from(a||[]))}),t}function os(e={},t){if(t)return e[t]||(e[t]=new Set),e[t]}function pn(e={},t,n){const a=e?.[t];return a?a instanceof Set?a.has(n):Array.isArray(a)?a.includes(n):!!a?.[n]:!0}function Kt(e="reservation"){return Object.fromEntries(Ot(e).map(({id:t})=>[t,!1]))}function mn(e,t){return e.sectionExpansions||(e.sectionExpansions=Kt(e.context||"reservation")),t&&typeof e.sectionExpansions[t]!="boolean"&&(e.sectionExpansions[t]=!1),e.sectionExpansions}function rs(e,t){return mn(e,t)?.[t]!==!1}function fn(){return typeof window>"u"||typeof window.matchMedia!="function"?!1:window.matchMedia("(max-width: 768px)").matches}function is(){if(typeof navigator>"u")return!1;const e=navigator.userAgent||navigator.platform||"";return Va.test(e)}function ls(){if(typeof navigator>"u")return!1;const e=navigator.userAgent||"",t=sa.test(e),n=e.includes("Chrome")||e.includes("CriOS")||e.includes("Chromium"),a=e.includes("Edg");return t&&!n&&!a}function ra(){return is()&&ls()}function Ht(){if(typeof navigator>"u")return!1;const e=navigator.userAgent||"",t=navigator.platform||"",n=Number.isFinite(navigator.maxTouchPoints)?navigator.maxTouchPoints:0,a=xn.test(e)||xn.test(t),s=/Macintosh/i.test(e)&&n>1;return sa.test(e)&&!Wa.test(e)&&(a||s)}function Vt(e,...t){try{console.log(`${It} ${e}`,...t)}catch{}}function ze(e,...t){try{console.warn(`${It} ${e}`,...t)}catch{}}function cs(e,t,...n){try{t?console.error(`${It} ${e}`,t,...n):console.error(`${It} ${e}`,...n)}catch{}}function ue(e,{blockType:t="section",extraAttributes:n=""}={}){if(!e)return"";const a=n?` ${n.trim()}`:"";return e.replace(/^(<\w+)/,`$1 data-quote-block data-block-type="${t}"${a}`)}function us(e,t="Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¹Ø±Ø¶."){const n=i(r(e,t));return ue(`<section class="quote-section quote-placeholder">${n}</section>`,{blockType:"placeholder"})}function Pt(e,t){return Array.isArray(e)&&e.length?e:[us(t)]}const ds=/[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF]/;function ia(e=""){return ds.test(e)}function ps(){const e=window.CanvasRenderingContext2D?.prototype;if(!e||e.__artRatioDirectionPatched)return;const t=n=>{const a=e[n];typeof a=="function"&&(e[n]=function(u,...o){if(typeof u!="string"||!ia(u))return a.call(this,u,...o);let c,d=!1;try{"direction"in this&&(c=this.direction,c!=="rtl"&&(this.direction="rtl"),d=!0)}catch{}try{if(!d){const h=this.canvas;h&&h.style?.direction!=="rtl"&&(h.__artRatioOriginalDirection=h.style.direction,h.style.direction="rtl")}return a.call(this,u,...o)}finally{if(d&&c!==void 0&&c!=="rtl")try{this.direction=c}catch{}else if(!d){const h=this.canvas;h&&h.__artRatioOriginalDirection!==void 0&&(h.style.direction=h.__artRatioOriginalDirection,delete h.__artRatioOriginalDirection)}}})};t("fillText"),t("strokeText"),e.__artRatioDirectionPatched=!0}function Cn(e,t=bt){if(typeof e!="string"&&typeof e!="number")return t;const n=parseFloat(String(e).replace(/[^0-9.+-]/g,""));return Number.isFinite(n)&&n>0?n:t}function ms(e){if(!e)return{width:bt,height:bt};const t=e.getAttribute?.("width"),n=e.getAttribute?.("height");let a=t?Cn(t,0):0,s=n?Cn(n,0):0;if(a>0&&s>0)return{width:a,height:s};const u=e.getAttribute?.("viewBox");if(u){const o=u.trim().split(/[\s,]+/).map(c=>parseFloat(c||"0"));if(o.length>=4){const[,,c,d]=o;a=a||(Number.isFinite(c)&&c>0?c:0),s=s||(Number.isFinite(d)&&d>0?d:0)}}return{width:a||bt,height:s||bt}}function la(e=""){return typeof e!="string"?!1:Zn.test(e)||Ua.test(e)}function fs(e=""){const t=e.indexOf(",");if(t===-1)return"";const n=e.slice(0,t),a=e.slice(t+1);try{return/;base64/i.test(n)?typeof atob=="function"?atob(a):"":decodeURIComponent(a)}catch(s){return console.warn("[reservations/pdf] failed to decode SVG data URI",s),""}}function ys(e,{crossOrigin:t}={}){return new Promise((n,a)=>{const s=new Image;t&&(s.crossOrigin=t),s.onload=()=>n(s),s.onerror=u=>{const o=u?.message||`Unable to load image from ${e}`;a(new Error(o))},s.src=e})}async function ca(e,t={}){if(!e)return null;const n=document,a=new Blob([e],{type:"image/svg+xml;charset=utf-8"}),s=URL.createObjectURL(a);try{const u=await ys(s),o=n.createElement("canvas"),c=Math.max(t.width||u.naturalWidth||u.width||0,1),d=Math.max(t.height||u.naturalHeight||u.height||c,1);o.width=c,o.height=d;const h=o.getContext("2d");return h.clearRect(0,0,c,d),h.drawImage(u,0,0,c,d),o.toDataURL("image/png")}catch(u){return console.warn("[reservations/pdf] failed to rasterize SVG content",u),null}finally{URL.revokeObjectURL(s)}}async function hs(e){if(!e)return null;if(Zn.test(e))return fs(e);try{const t=await fetch(e,{mode:"cors",credentials:"omit",cache:"default"});return t.ok?await t.text():(console.warn("[reservations/pdf] failed to fetch SVG image",e,t.status),null)}catch(t){return console.warn("[reservations/pdf] error fetching SVG image",e,t),null}}async function bs(e){if(!e)return!1;const t=e.getAttribute?.("src")||"";if(!la(t))return!1;const n=await hs(t);if(!n)return e.dataset.svgRasterization="failed",e.setAttribute("src",Gt),!1;const a=await ca(n);return a?(e.dataset.svgOriginalSrc=t,e.setAttribute("src",a),e.setAttribute("data-rasterized","true"),!0):(e.dataset.svgRasterization="failed",e.setAttribute("src",Gt),!1)}async function gs(e){if(!e||e.tagName?.toLowerCase()!=="svg")return!1;const n=new XMLSerializer().serializeToString(e),a=ms(e),s=await ca(n,a),o=(e.ownerDocument||document).createElement("img");o.setAttribute("src",s||Gt),o.setAttribute("alt",e.getAttribute("aria-label")||e.getAttribute("title")||""),o.setAttribute("data-svg-replaced","true"),e.hasAttribute("class")&&o.setAttribute("class",e.getAttribute("class")),e.hasAttribute("style")&&o.setAttribute("style",e.getAttribute("style"));const c=e.getAttribute("width"),d=e.getAttribute("height");return c&&o.setAttribute("width",c),d&&o.setAttribute("height",d),e.parentNode?.replaceChild(o,e),!!s}async function ua(e){if(!e)return;const t=Array.from(e.querySelectorAll?.("img")||[]),n=Array.from(e.querySelectorAll?.("svg")||[]),a=[];t.forEach(s=>{la(s.getAttribute?.("src"))&&a.push(bs(s))}),n.forEach(s=>{a.push(gs(s))}),a.length&&await Promise.allSettled(a)}function vs(e,{pixelRatio:t=1}={}){if(!e)return null;const n=e.ownerDocument||document,s=(n.defaultView||window).getComputedStyle?.(e);if(!s)return null;const u=(j,G=0)=>{const ae=parseFloat(j);return Number.isFinite(ae)?ae:G},o=u(s.paddingTop),c=u(s.paddingBottom),d=u(s.paddingRight),h=u(s.paddingLeft),g=u(s.borderRadius),x=u(s.fontSize,14),S=(()=>{const j=s.lineHeight;if(!j||j==="normal")return x*1.6;const G=u(j,x*1.6);return G>0?G:x*1.6})(),v=Math.max(e.clientWidth||0,e.scrollWidth||0,u(s.width,0));if(v<=0)return null;const b=Math.max(1,v-h-d),I=e.textContent||"",w=I.split(/\r?\n/),$=n.createElement("canvas"),_=$.getContext("2d");if(!_)return null;const K=s.fontStyle||"normal",Y=s.fontVariant||"normal",ee=s.fontWeight||"400",f=s.fontFamily||"sans-serif",q=s.fontStretch||"normal",T=j=>j.join(" "),P=[],U=j=>_.measureText(j).width;_.font=`${K} ${Y} ${ee} ${q} ${x}px ${f}`,w.forEach(j=>{const G=j.trim();if(G.length===0){P.push("");return}const ae=G.split(/\s+/);let ce=[];ae.forEach((xe,Be)=>{const ge=xe.trim();if(!ge)return;const we=T(ce.concat(ge));if(U(we)<=b||ce.length===0){ce.push(ge);return}P.push(T(ce)),ce=[ge]}),ce.length&&P.push(T(ce))}),P.length||P.push("");const C=o+c+P.length*S,le=Math.ceil(Math.max(1,v)*t),F=Math.ceil(Math.max(1,C)*t);$.width=le,$.height=F,$.style.width=`${Math.max(1,v)}px`,$.style.height=`${Math.max(1,C)}px`,_.scale(t,t);const ne=s.backgroundColor&&s.backgroundColor!=="rgba(0, 0, 0, 0)"?s.backgroundColor:"#ffffff";if(g>0){_.save(),_.beginPath();const j=Math.max(1,v),G=Math.max(1,C),ae=Math.min(g,j/2,G/2);_.moveTo(ae,0),_.lineTo(j-ae,0),_.quadraticCurveTo(j,0,j,ae),_.lineTo(j,G-ae),_.quadraticCurveTo(j,G,j-ae,G),_.lineTo(ae,G),_.quadraticCurveTo(0,G,0,G-ae),_.lineTo(0,ae),_.quadraticCurveTo(0,0,ae,0),_.closePath(),_.clip()}if(_.fillStyle=ne,_.fillRect(0,0,Math.max(1,v),Math.max(1,C)),_.font=`${K} ${Y} ${ee} ${q} ${x}px ${f}`,_.fillStyle=s.color||"#000000",_.textBaseline="top",_.textAlign="right","direction"in _)try{_.direction="rtl"}catch{}const X=Math.max(0,v-d);let H=o;P.forEach(j=>{const G=j.length?j:" ";_.fillText(G,X,H,b),H+=S});const te=n.createElement("img");let ie;try{ie=$.toDataURL("image/png")}catch(j){return ze("note canvas toDataURL failed",j),null}return te.src=ie,te.alt=I,te.style.width=`${Math.max(1,v)}px`,te.style.height=`${Math.max(1,C)}px`,te.style.display="block",te.setAttribute("data-quote-note-image","true"),{image:te,canvas:$,totalHeight:C,width:v}}function ws(e,{pixelRatio:t=1}={}){if(!e||!Ht())return;Array.from(e.querySelectorAll?.(".quote-notes")||[]).forEach(a=>{if(!a||a.dataset.quoteNoteRasterized==="true"||!ia(a.textContent||""))return;let s;try{s=vs(a,{pixelRatio:t})}catch(u){ze("failed to rasterize note content",u),s=null}s&&(a.dataset.quoteNoteRasterized="true",a.innerHTML="",a.appendChild(s.image))})}function en(e,t="export",{toastMessage:n,suppressToast:a=!1}={}){cs(`${t} failed`,e);const s=!!(e&&e.__artRatioPdfNotified);if(!a&&!s){const u=r("reservations.quote.errors.exportFailed","âš ï¸ ØªØ¹Ø°Ø± Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù PDFØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰."),o=n||u,c=r("reservations.quote.toast.viewGuide","ğŸ“˜ Ø¹Ø±Ø¶ Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø­Ù„ Ø§Ù„Ø³Ø±ÙŠØ¹"),d=r("reservations.quote.toast.retry","Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©"),h=["exportQuoteAsPdf","renderQuotePreview","layoutQuoteDocument","pageCapture"].includes(t),g=()=>{t==="exportQuoteAsPdf"?(nt("export"),ga()):(nt("render"),gt=!1,Ae())};if(Dn({message:o,duration:9e3,actionLabel:h?d:void 0,onAction:h?g:void 0,linkLabel:c,linkHref:zn}),A?.modal?.classList.contains("show")&&nt("error",{message:o,actionLabel:h?d:void 0,onAction:h?g:void 0,showSpinner:!1}),e&&typeof e=="object")try{Object.defineProperty(e,"__artRatioPdfNotified",{value:!0,writable:!1,enumerable:!1,configurable:!0})}catch{}}}function tn({container:e,safariWindowRef:t,mobileWindowRef:n}={}){try{n&&!n.closed&&n.close()}catch(a){ze("failed to close mobile window",a)}try{t&&!t.closed&&t.close()}catch(a){ze("failed to close safari window",a)}e&&e.parentNode&&e.parentNode.removeChild(e)}function yn(e){return new Promise((t,n)=>{const a=document.querySelector(`script[src="${e}"]`);if(a){a.addEventListener("load",()=>t()),a.addEventListener("error",u=>n(u)),a.readyState==="complete"&&t();return}const s=document.createElement("script");s.src=e,s.async=!0,s.onload=()=>t(),s.onerror=u=>n(u),document.head.appendChild(s)})}function En(){const e=[window.jspdf?.jsPDF,typeof window.jspdf=="function"?window.jspdf:null,window.jsPDF?.jsPDF,typeof window.jsPDF=="function"?window.jsPDF:null].filter(t=>typeof t=="function");return e.length?e[0]:null}function Nn(){return typeof window.html2canvas=="function"?window.html2canvas:null}async function qs(){const e=Nn();return e||(ht||(ht=yn(Qa).catch(t=>{throw ht=null,t}).then(()=>{const t=Nn();if(!t)throw ht=null,new Error("ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© html2canvas Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.");return t})),ht)}async function Ss(){const e=En();return e||(yt||(yt=yn(za).catch(t=>{throw yt=null,t}).then(()=>{const t=En();if(!t)throw yt=null,new Error("ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© jsPDF Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.");return t})),yt)}async function ks(){if(window.html2pdf||await yn(Ha),window.html2pdf&&!window.html2pdf.__artRatioConfigured){const e=window.html2pdf.defaultOptions||window.html2pdf.defaultOpt||{},t={...e.html2canvas||{}};t.useCORS=!0,t.allowTaint=!1,t.logging=!0;const n={unit:"mm",format:"a4",orientation:"portrait",compress:!0,...e.jsPDF||{}},a={image:{type:"jpeg",quality:.95,...e.image||{}},margin:e.margin??[0,0,0,0],filename:e.filename||"document.pdf",html2canvas:t,jsPDF:n};window.html2pdf.defaultOptions=a,window.html2pdf.defaultOpt=a,window.html2pdf.__artRatioConfigured=!0}ja(),ps()}function i(e=""){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function da(e="reservation"){return _n[e]||_n.reservation}function As(){try{window.localStorage?.removeItem?.(La)}catch{}}function _s(e="reservation"){try{As();const t=da(e),n=window.localStorage?.getItem?.(t);if(!n)return null;const a=JSON.parse(n);return a&&typeof a=="object"?a:null}catch(t){return console.warn("âš ï¸ [reservations/pdf] failed to read toggle preferences",t),null}}function xs(e,t="reservation"){try{const n=da(t);if(!e){window.localStorage?.removeItem?.(n);return}window.localStorage?.setItem?.(n,JSON.stringify(e))}catch(n){console.warn("âš ï¸ [reservations/pdf] failed to persist toggle preferences",n)}}function $s(e){if(!e)return{ids:null,emptyExplicitly:!1};if(e instanceof Set)return{ids:Array.from(e),emptyExplicitly:e.size===0};if(Array.isArray(e))return{ids:e.slice(),emptyExplicitly:e.length===0};if(typeof e=="object"){const t=Object.entries(e).filter(([,n])=>!!n);return{ids:t.map(([n])=>n),emptyExplicitly:t.length===0}}return{ids:null,emptyExplicitly:!1}}function Ts(e,t="reservation"){if(!e)return null;const n=Wn(t),a=Gn(t),s=Array.from(e.sections instanceof Set?e.sections:new Set(e.sections||[])).filter(c=>n.has(c)),u={},o=e.fields||{};return Object.entries(a).forEach(([c,d])=>{const h=o[c];if(h==null)return;const{ids:g,emptyExplicitly:x}=$s(h);if(!g&&!x)return;const S=Array.isArray(g)?g.filter(v=>d.has(v)):[];(S.length>0||x)&&(u[c]=S)}),{version:1,sections:s,fields:u}}function pa(e){if(!e)return;const t=e.context||"reservation",n=Ts(e,t);n&&xs(n,t)}function hn(e){if(!e)return;const t=e.context||"reservation",n=_s(t);if(!n)return;const a=Wn(t),s=Array.isArray(n.sections)?n.sections.filter(u=>a.has(u)):[];if(s.length&&(e.sections=new Set(s)),n.fields&&typeof n.fields=="object"){const u=dn(e.fields||St(t)),o=Gn(t);Object.entries(n.fields).forEach(([c,d])=>{const h=o[c];if(!h)return;const g=Array.isArray(d)?d.filter(x=>h.has(x)):[];u[c]=new Set(g)}),e.fields=u}}function bn(e=new Date){try{return e.toLocaleDateString("en-GB",{year:"numeric",month:"2-digit",day:"2-digit"})}catch{return e.toISOString().slice(0,10)}}function Qt(e){const t=Ca()||[],{technicians:n=[]}=nn(),a=[].concat(Array.isArray(t)?t:[]).concat(Array.isArray(n)?n:[]),s=new Map;return a.forEach(o=>{if(!o||o.id==null)return;const c=String(o.id),d=s.get(c)||{};s.set(c,{...d,...o})}),(Array.isArray(e.crewAssignments)&&e.crewAssignments.length?e.crewAssignments:Array.isArray(e.techniciansDetails)&&e.techniciansDetails.length?e.techniciansDetails:(e.technicians||[]).map(o=>({technicianId:o}))).map((o,c)=>{const d=o?.technicianId!=null?s.get(String(o.technicianId)):null;let h=o.positionLabel??o.position_name??o.position_label??o.role??o.position??d?.role??r("reservations.crew.positionFallback","Ù…Ù†ØµØ¨ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…");(!h||h.trim()==="")&&(h=o.positionLabelAr??o.position_label_ar??o.positionLabelEn??o.position_label_en??o.position_name_ar??o.position_name_en??d?.role??r("reservations.crew.positionFallback","Ù…Ù†ØµØ¨ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…"));try{const S=typeof pt=="function"?pt()||[]:[];let v=null;if(o?.positionId!=null&&(v=S.find(b=>String(b?.id)===String(o.positionId))||null),!v){const b=o.positionKey??o.position_key??o.positionName??o.position_name??o.position??"";if(b&&(v=typeof kn=="function"&&kn(b)||null,!v&&S.length)){const I=String(b).trim().toLowerCase();v=S.find(w=>[w.name,w.labelAr,w.labelEn].filter(Boolean).map($=>String($).toLowerCase()).includes(I))||null}}if(v){const b=v.labelAr||v.labelEn||v.name||"";b&&b.trim()&&(h=b)}}catch{}const g=wt(Ct(o.positionCost??o.position_cost??o.cost??o.daily_wage??o.dailyWage??d?.dailyWage??d?.wage??0)),x=wt(Ct(o.positionClientPrice??o.position_client_price??o.client_price??o.clientPrice??o.daily_total??o.dailyTotal??o.total??d?.dailyTotal??d?.total??d?.total_wage??0));return{assignmentId:o.assignmentId??o.assignment_id??`crew-${c}`,positionId:o.positionId??o.position_id??null,positionLabel:h,positionLabelAlt:o.positionLabelAlt??o.position_label_alt??"",positionCost:g,positionClientPrice:x,technicianId:o.technicianId!=null?String(o.technicianId):d?.id!=null?String(d.id):null,technicianName:o.technicianName??o.technician_name??d?.name??null,technicianRole:o.technicianRole??d?.role??null}})}function gn(e,t,n){const{projectLinked:a}=Aa(e,n);an(e.start,e.end);const s=e.discount??e.discountValue??0,u=Number(N(String(s)))||0,o=e.discountType??e.discount_type??"percent",c=String(o).toLowerCase()==="amount"?"amount":"percent",d=a?!1:!!(e.applyTax??e.apply_tax??e.taxApplied),h=e.companySharePercent??e.company_share_percent??e.companyShare??e.company_share??null,g=h!=null?Ct(h):Number.NaN,S=(e.companyShareEnabled??e.company_share_enabled??e.companyShareApplied??e.company_share_applied)===!0&&Number.isFinite(g)&&g>0?g:null,v=Array.isArray(t)?t.map(Y=>Y?.technicianId).filter(Boolean):[],b=Ln({items:Array.isArray(e.items)?e.items:[],technicianIds:v,crewAssignments:Array.isArray(t)?t:[],discount:u,discountType:c,applyTax:d,start:e.start,end:e.end,companySharePercent:S,groupingSource:e}),I=Ct(e.cost??e.total??e.finalTotal),w=Number.isFinite(I),$=a?b.finalTotal:w?wt(I):b.finalTotal,_={equipmentTotal:b.equipmentTotal,equipmentCostTotal:b.equipmentCostTotal,crewTotal:b.crewTotal,crewCostTotal:b.crewCostTotal,discountAmount:b.discountAmount,subtotalAfterDiscount:b.subtotalAfterDiscount,taxableAmount:b.taxableAmount,taxAmount:b.taxAmount,finalTotal:$,companySharePercent:b.companySharePercent,companyShareAmount:b.companyShareAmount,netProfit:b.netProfit},K={equipmentTotal:fe(b.equipmentTotal),equipmentCostTotal:fe(b.equipmentCostTotal),crewTotal:fe(b.crewTotal),discountAmount:fe(b.discountAmount),subtotalAfterDiscount:fe(b.subtotalAfterDiscount),taxableAmount:fe(b.taxableAmount),taxAmount:fe(b.taxAmount),finalTotal:fe($),companySharePercent:N((Number.isFinite(b.companySharePercent)?b.companySharePercent:0).toFixed(2)),companyShareAmount:fe(b.companyShareAmount),netProfit:N(b.netProfit.toFixed(2))};return{totals:_,totalsDisplay:K,rentalDays:b.rentalDays}}function ft(e){if(e==null||e==="")return null;const t=Number.parseFloat(N(String(e)));return Number.isFinite(t)?t:null}function ma(e){if(!e)return new Date().toISOString();const t=new Date(e);return Number.isNaN(t.getTime())?new Date().toISOString():t.toISOString()}function Cs(e){if(!e||typeof e!="object")return null;const t=e.type??e.payment_type??e.paymentType??null;let n=typeof t=="string"?t.trim().toLowerCase():null;n!=="percent"&&(n="amount");const a=ft(e.amount??(n==="amount"?e.value:null)),s=ft(e.percentage??(n==="percent"?e.value:null)),u=n==="percent"?s??null:a??null,o=e.note??e.memo??null,c=ma(e.recordedAt??e.recorded_at??e.date??e.created_at??null);return n==="amount"&&a==null||n==="percent"&&s==null?null:{type:n,amount:a??null,percentage:s??null,value:u,note:o,recordedAt:c}}function Es(e={}){const n=(Array.isArray(e.paymentHistory)?e.paymentHistory:Array.isArray(e.payment_history)?e.payment_history:[]).map(Cs).filter(Boolean);if(n.length>0)return n;const a=ft(e.paidPercent??e.paid_percent),s=ft(e.paidAmount??e.paid_amount),u=e.updatedAt??e.updated_at??e.createdAt??e.created_at??null,o=ma(u);return a!=null&&a>0?[{type:"percent",amount:s!=null&&s>0?s:null,percentage:a,value:a,note:null,recordedAt:o}]:s!=null&&s>0?[{type:"amount",amount:s,percentage:null,value:s,note:null,recordedAt:o}]:[]}function Ns(e){if(!e)return r("projects.form.types.unknown","Ù†ÙˆØ¹ ØºÙŠØ± Ù…Ø­Ø¯Ø¯");const t={commercial:"projects.form.types.commercial",coverage:"projects.form.types.coverage",photography:"projects.form.types.photography",social:"projects.form.types.social"}[e]||"projects.form.types.unknown";return r(t,e)}function js(e){const t=new Date,n=e?.start?new Date(e.start):null,a=e?.end?new Date(e.end):null;return n&&!Number.isNaN(n.getTime())&&n>t?"upcoming":a&&!Number.isNaN(a.getTime())&&a<t?"completed":"ongoing"}function Is(e){if(Array.isArray(e?.expenses)&&e.expenses.some(a=>Number.isFinite(Number(a?.salePrice??a?.sale_price))))return e.expenses.reduce((a,s)=>a+(Number(s?.salePrice??s?.sale_price)||0),0);const t=Number(e?.servicesClientPrice??e?.services_client_price);return Number.isFinite(t)&&t>=0?t:typeof e?.expensesTotal=="number"?e.expensesTotal:Array.isArray(e?.expenses)?e.expenses.reduce((n,a)=>n+(Number(a?.amount)||0),0):0}function Ps(e){if(!e)return 0;const t=Array.isArray(e.items)?e.items:[],n=e.discount??0,a=Number(N(String(n)))||0,s=e.discountType||"percent",u=Array.isArray(e.crewAssignments)?e.crewAssignments:[],o=u.length?u:Array.isArray(e.technicians)?e.technicians:[],c=Ta(t,a,s,!1,o,{start:e.start,end:e.end,companySharePercent:0});if(Number.isFinite(c))return c;const d=Number(N(String(e.cost??0)));return Number.isFinite(d)?Math.round(d):0}function Ds(e,t){if(!e)return"â€”";const n=dt(e);return t?`${n} - ${dt(t)}`:n}function Z(e,t="SR",n=2){const a=Number(e);return`${fe(a)} ${t}`}function jn(e,t=2){if(!Number.isFinite(Number(e)))return"0%";const n=Number.isInteger(t)?t:2;return`${N(Number(e).toFixed(n))}%`}function Ls(e){if(!e?.start)return null;if(!e?.end)return 1;const t=an(e.start,e.end);return Number.isFinite(t)?t:1}function Fs(e){return Number.isFinite(e)?e<=1?"ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯":`${N(String(Math.round(e)))} Ø£ÙŠØ§Ù…`:"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}function In(e){const t=r("reservations.create.summary.currency","SR"),n=nn()||{},a=Array.isArray(n.customers)?n.customers:[],s=Array.isArray(n.projects)?n.projects:[],u=Array.isArray(n.technicians)?n.technicians:[];let o=[];try{const m=Mn?.()||[];o=Array.isArray(m)&&m.length?m:n.reservations||[]}catch{o=n.reservations||[]}const c=e?.id!=null?s.find(m=>String(m.id)===String(e.id))||e:e||null,d={projectStatusLabel:r("projects.status.ongoing","Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°"),paymentStatusLabel:r("projects.paymentStatus.unpaid","ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹")};if(!c)return{project:null,customer:null,clientInfo:{name:"-",company:"-",phone:"-",email:"-"},projectInfo:{title:"-",code:"-",typeLabel:"-",startDisplay:"-",endDisplay:"-",durationLabel:"-",statusLabel:d.projectStatusLabel},expenses:[],equipment:[],reservations:[],totals:{equipmentEstimate:0,expensesTotal:0,baseSubtotal:0,discountAmount:0,subtotalAfterDiscount:0,companyShareAmount:0,subtotal:0,applyTax:!1,taxAmount:0,totalWithTax:0},totalsDisplay:{projectSubtotal:Z(0,t),expensesTotal:Z(0,t),reservationsTotal:Z(0,t),discountAmount:Z(0,t),taxAmount:Z(0,t),overallTotal:Z(0,t),paidAmount:Z(0,t),remainingAmount:Z(0,t)},projectTotals:{combinedTaxAmount:0,overallTotal:0,reservationsTotal:0,paidAmount:0,paidPercent:0,remainingAmount:0,paymentStatus:"unpaid"},paymentSummary:{status:"unpaid",statusLabel:d.paymentStatusLabel,paidAmount:0,paidPercent:0,remainingAmount:0,paidAmountDisplay:Z(0,t),remainingAmountDisplay:Z(0,t),paidPercentDisplay:jn(0)},notes:"",currencyLabel:t,projectStatus:"ongoing",projectStatusLabel:d.projectStatusLabel,projectDurationDays:null,projectDurationLabel:"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",paymentHistory:[]};const h=c.clientId??c.customerId??c.client_id??c.customer_id??null,g=h!=null&&a.find(m=>String(m.id)===String(h))||null,x=g?.customerName??g?.name??c.clientName??c.customerName??r("projects.fallback.unknownClient","Ø¹Ù…ÙŠÙ„ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"),S=(c.clientCompany||g?.companyName||g?.company||"").trim(),v=g?.phone??g?.customerPhone??c.clientPhone??c.customerPhone??"",b=v?N(String(v).trim()):r("projects.details.client.noPhone","Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù‚Ù… Ù…ØªØ§Ø­"),I=g?.email??c.clientEmail??c.customerEmail??"",w=I?String(I).trim():r("projects.details.client.noEmail","Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨Ø±ÙŠØ¯ Ù…ØªØ§Ø­"),$=c.projectCode||`PRJ-${N(String(c.id??""))}`,_=N(String($)),K=(c.title||"").trim()||r("projects.fallback.untitled","Ù…Ø´Ø±ÙˆØ¹ Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†"),Y=Ns(c.type),ee=c.start?dt(c.start):"â€”",f=c.end?dt(c.end):"â€”",q=Ls(c),T=q!=null?Fs(q):"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",P=js(c),U={upcoming:"Ù‚Ø§Ø¯Ù…",ongoing:"Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°",completed:"Ù…ÙƒØªÙ…Ù„"},C=r(`projects.status.${P}`,U[P]||P),le=c.id!=null?String(c.id):null,F=le?o.filter(m=>{const W=m?.projectId??m?.project_id??null;return W!=null&&String(W)===le}):[];F.map(m=>{const W=m.reservationId||m.id||"",k=m.status||m.state||"pending",J=String(k).toLowerCase(),se=r(`reservations.status.${J}`,J),oe=Ps(m),Le=m.start?new Date(m.start).getTime():0;return{reservationId:N(String(W||"-")),status:J,statusLabel:se,total:oe,totalLabel:Z(oe,t),dateRange:Ds(m.start,m.end),startTimestamp:Number.isNaN(Le)?0:Le}}).sort((m,W)=>W.startTimestamp-m.startTimestamp).map(({startTimestamp:m,...W})=>W);let ne=0,X=0;try{F.forEach(m=>{const W=Ln({items:Array.isArray(m.items)?m.items:[],technicianIds:Array.isArray(m.technicians)?m.technicians:[],crewAssignments:Array.isArray(m.crewAssignments)?m.crewAssignments:[],discount:Number(m.discount??0)||0,discountType:m.discountType||"percent",applyTax:!1,start:m.start,end:m.end,groupingSource:m,companySharePercent:0});ne+=Number(W.equipmentTotal||0),X+=Number(W.crewTotal||0)})}catch{}const H=Is(c),te=Number(ne+X+H),ie=[];try{F.forEach(m=>{const{groups:W}=Fn(m);W.forEach(k=>{const J=Number(k?.count??k?.quantity??1)||1,se=Number(k?.unitPrice);let oe=Number.isFinite(se)?se:0;if(!oe||oe<=0){const he=Number(k?.totalPrice);Number.isFinite(he)&&J>0&&(oe=Number((he/J).toFixed(2)))}Number.isFinite(oe)||(oe=0);const Le=k?.type==="package"||Array.isArray(k?.items)&&k.items.some(he=>he?.type==="package"),Ce=Array.isArray(k?.barcodes)&&k.barcodes.length?k.barcodes[0]:Array.isArray(k?.items)&&k.items.length?k.items[0]?.barcode:null;let Se=k?.packageDisplayCode??k?.package_code??k?.code??k?.packageCode??(Array.isArray(k?.items)&&k.items.length?k.items[0]?.package_code??k.items[0]?.code??k.items[0]?.packageCode:null);const et=he=>{const Ee=(he==null?"":String(he)).trim();return!!(!Ee||/^pkg-/i.test(Ee)||/^\d+$/.test(Ee)&&Ee.length<=4)};if(!Se||et(Se)){const he=k?.packageId??k?.package_id??(Array.isArray(k?.items)&&k.items.length?k.items[0]?.packageId??k.items[0]?.package_id:null);if(he)try{const Ee=Rn(he);Ee&&Ee.package_code&&(Se=Ee.package_code)}catch{}}if(!Se||et(Se))try{const he=ct(k?.description||"");if(he){const Ee=On();let p=Ee.find(E=>ct(E?.name||E?.title||E?.label||"")===he);p||(p=Ee.find(E=>{const z=ct(E?.name||E?.title||E?.label||"");return z.includes(he)||he.includes(z)})),p&&p.package_code&&(Se=p.package_code)}}catch{}const rt=Le?Se??Ce??"":k?.barcode??Ce??"",it=rt!=null?String(rt):"",zt=Number.isFinite(Number(k?.totalPrice))?Number(k.totalPrice):Number((oe*J).toFixed(2));ie.push({...k,isPackage:Le,desc:k?.description,barcode:it,packageCodeResolved:Se||"",qty:J,price:oe,totalPrice:wt(zt),unitPriceValue:oe})})})}catch{}const j=new Map;F.forEach(m=>{const W=Array.isArray(m.items)?m.items:[],k=an(m.start,m.end),J=m.reservationId||m.id||"";W.forEach((se,oe)=>{if(!se)return;const Le=se.barcode||se.code||se.id||se.desc||se.description||`item-${oe}`,Ce=String(Le||`item-${oe}`),Se=j.get(Ce)||{description:se.desc||se.description||se.name||se.barcode||`#${N(String(oe+1))}`,totalQuantity:0,reservationsCount:0,reservationIds:new Set,totalCost:0},et=Number(se.qty)||1,rt=Number(se.price)||0;Se.totalQuantity+=et,Se.reservationIds.add(String(J));const it=rt*et*Math.max(1,k);Number.isFinite(it)&&(Se.totalCost+=it),j.set(Ce,Se)})});const G=Array.from(j.values()).map(m=>({description:m.description,totalQuantity:m.totalQuantity,reservationsCount:m.reservationIds.size,displayCost:Z(m.totalCost,t)})),ae=new Map((u||[]).filter(Boolean).map(m=>[String(m.id),m])),ce=new Map,xe=m=>{if(!m)return;let W=null;typeof m=="object"?W=m.id??m.technicianId??m.technician_id??m.userId??m.user_id??null:(typeof m=="string"||typeof m=="number")&&(W=m);const k=W!=null?String(W):null,J=k&&ae.has(k)?ae.get(k):typeof m=="object"?m:null,se=J?.name||J?.full_name||J?.fullName||J?.displayName||(typeof m=="string"?m:null),oe=J?.role||J?.title||null,Le=J?.phone||J?.mobile||J?.contact||null;if(!se&&!k)return;const Ce=k||se;ce.has(Ce)||ce.set(Ce,{id:k,name:se||"-",role:oe||null,phone:Le||null})};Array.isArray(c?.technicians)&&c.technicians.forEach(m=>xe(m)),F.forEach(m=>{(Array.isArray(m.crewAssignments)&&m.crewAssignments.length?m.crewAssignments:Array.isArray(m.technicians)?m.technicians.map(k=>({technicianId:k})):[]).forEach(k=>xe(k))});const Be=Array.from(ce.values()),ge=Array.isArray(c.expenses)?c.expenses.map(m=>{const W=Number(m?.salePrice??m?.sale_price??m?.amount)||0;return{label:m?.label||m?.name||"-",amount:W,displayAmount:Z(W,t),note:m?.note||m?.description||""}}):[],we=c?.applyTax===!0||c?.applyTax==="true",Ue=Number.parseFloat(c?.discount??c?.discountValue??0)||0;let $e=(c?.discountType==="amount"?"amount":"percent")==="amount"?Ue:te*(Ue/100);(!Number.isFinite($e)||$e<0)&&($e=0),$e>te&&($e=te);const Ke=Math.max(0,te-$e),Me=c?.companyShareEnabled===!0||c?.company_share_enabled===!0||c?.companyShareApplied===!0||c?.company_share_applied===!0,Je=Number.parseFloat(c?.companySharePercent??c?.company_share_percent??c?.companyShare??c?.company_share??0)||0,at=Me&&Je>0?Je:0,He=at>0?Number((Ke*(at/100)).toFixed(2)):0,Te=Number((Ke+He).toFixed(2)),_e=we?Number((Te*Ea).toFixed(2)):0,Pe=Number((Te+_e).toFixed(2)),Ve=Es(c),Ze=ft(c.paidAmount??c.paid_amount)||0,st=ft(c.paidPercent??c.paid_percent)||0,Qe=xa({totalAmount:Pe,paidAmount:Ze,paidPercent:st,history:Ve}),ot=typeof c.paymentStatus=="string"?c.paymentStatus.toLowerCase():"",y=$a({manualStatus:ot,paidAmount:Qe.paidAmount,paidPercent:Qe.paidPercent,totalAmount:Pe}),O={paid:"Ù…Ø¯ÙÙˆØ¹",partial:"Ù…Ø¯ÙÙˆØ¹ Ø¬Ø²Ø¦ÙŠØ§Ù‹",unpaid:"ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹"},B=r(`projects.paymentStatus.${y}`,O[y]||y),V=Number(Qe.paidAmount||0),Q=Number(Qe.paidPercent||0),M=Math.max(0,Number((Pe-V).toFixed(2))),R={projectSubtotal:Z(Te,t),expensesTotal:Z(H,t),reservationsTotal:Z(Te,t),discountAmount:Z($e,t),taxAmount:Z(_e,t),overallTotal:Z(Pe,t),paidAmount:Z(V,t),remainingAmount:Z(M,t)},de={status:y,statusLabel:B,paidAmount:V,paidPercent:Q,remainingAmount:M,paidAmountDisplay:Z(V,t),remainingAmountDisplay:Z(M,t),paidPercentDisplay:jn(Q)},qe=(c.description||"").trim();return{project:c,customer:g,clientInfo:{name:x,company:S||"â€”",phone:b,email:w},projectInfo:{title:K,code:_,typeLabel:Y,startDisplay:ee,endDisplay:f,durationLabel:T,statusLabel:C},expenses:ge,equipment:G,crew:Be,equipmentItems:ie,crewAssignments:F.flatMap(m=>Qt(m)),totals:{equipmentEstimate:ne,expensesTotal:H,baseSubtotal:te,discountAmount:$e,subtotalAfterDiscount:Ke,companyShareAmount:He,subtotal:Te,applyTax:we,taxAmount:_e,totalWithTax:Pe},totalsDisplay:R,projectTotals:{combinedTaxAmount:_e,overallTotal:Pe,reservationsTotal:Te,paidAmount:V,paidPercent:Q,remainingAmount:M,paymentStatus:y},paymentSummary:de,notes:qe,currencyLabel:t,projectStatus:P,projectStatusLabel:C,projectDurationDays:q,projectDurationLabel:T,paymentHistory:Ve}}function Ms({project:e,clientInfo:t={},projectInfo:n={},projectCrew:a=[],projectExpenses:s=[],projectEquipment:u=[],totalsDisplay:o={},projectTotals:c={},paymentSummary:d={},currencyLabel:h="SR",sections:g,fieldSelections:x={},quoteNumber:S,quoteDate:v,terms:b=Ie}){const I=dn(x),w=(y,O)=>pn(I,y,O),$=y=>g?.has?.(y),_=`<div class="quote-placeholder">${i(r("reservations.quote.placeholder.noFields","Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù„Ù„Ø¹Ø±Ø¶ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…."))}</div>`,K=(y,O)=>`<div class="info-plain__item">
      <span class="info-plain__label">${i(y)}</span>
      <span class="info-plain__separator">:</span>
      <span class="info-plain__value">${i(O)}</span>
    </div>`,Y=(y,O,{variant:B="inline"}={})=>B==="final"?`<div class="totals-item totals-item--final">
        <span class="totals-item__label">${i(y)}</span>
        <span class="totals-item__slash">/</span>
        <span class="totals-item__value">${i(O)}</span>
      </div>`:`<span class="totals-inline__item">
      <span class="totals-inline__label">${i(y)}</span>
      <span class="totals-inline__slash">/</span>
      <span class="totals-inline__value">${i(O)}</span>
    </span>`,ee=(y,O)=>`<div class="payment-row">
      <span class="payment-row__label">${i(y)}</span>
      <span class="payment-row__slash">/</span>
      <span class="payment-row__value">${i(O)}</span>
    </div>`,f=(y,O,B)=>{const V=`${y}-title`,Q=`${y}-content`;return`
      <div class="quote-section__head" data-drag-key="${i(V)}">
        ${O}
      </div>
      <div class="quote-section__body" data-drag-key="${i(Q)}">
        ${B}
      </div>
    `},q=[];w("customerInfo","customerName")&&q.push(K(r("projects.details.client","Ø§Ù„Ø¹Ù…ÙŠÙ„"),t.name||"-")),w("customerInfo","customerCompany")&&q.push(K(r("projects.details.company","Ø´Ø±ÙƒØ© Ø§Ù„Ø¹Ù…ÙŠÙ„"),t.company||"â€”")),w("customerInfo","customerPhone")&&q.push(K(r("projects.details.labels.clientPhone","Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„"),t.phone||"-")),w("customerInfo","customerEmail")&&q.push(K(r("projects.details.labels.clientEmail","Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"),t.email||"-"));const T=$("customerInfo")?`<section class="quote-section quote-section--plain quote-section--customer">
        ${f("projectCustomer",`<h3 class="quote-section__title">${i(r("projects.quote.sections.customer","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„"))}</h3>`,q.length?`<div class="info-plain">${q.join("")}</div>`:_)}
      </section>`:"",P=[];w("projectInfo","projectType")&&P.push(K(r("projects.details.type","Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.typeLabel||"-")),w("projectInfo","projectTitle")&&P.push(K(r("projects.details.projectTitle","Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.title||"-")),w("projectInfo","projectCode")&&P.push(K(r("projects.details.labels.code","Ø±Ù‚Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.code||"-")),w("projectInfo","projectStart")&&P.push(K(r("projects.details.start","Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.startDisplay||"-")),w("projectInfo","projectEnd")&&P.push(K(r("projects.details.end","Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.endDisplay||"-")),w("projectInfo","projectDuration")&&P.push(K(r("projects.details.duration","Ù…Ø¯Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.durationLabel||"-")),w("projectInfo","projectStatus")&&P.push(K(r("projects.details.status","Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.statusLabel||"-"));const U=$("projectInfo")?`<section class="quote-section quote-section--plain quote-section--project">
        ${f("projectDetails",`<h3 class="quote-section__title">${i(r("projects.quote.sections.project","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"))}</h3>`,P.length?`<div class="info-plain">${P.join("")}</div>`:_)}
      </section>`:"",C=Mt.filter(y=>w("projectCrew",y.id)),le=Array.isArray(l?.crewAssignments)?l.crewAssignments:[],F=y=>{const O=y&&y.positionId!=null?`id:${String(y.positionId)}`:(()=>{const Q=(y?.positionLabel||y?.position_name||y?.position||"").trim().toLowerCase();return Q?`label:${Q}`:""})(),B=Number.isFinite(Number(y?.positionClientPrice))?Number(y.positionClientPrice):0,V=B>0?`|p:${B.toFixed(2)}`:"";return`${O}${V}`};(()=>{const y=new Map;return le.forEach(O=>{const B=F(O);B&&y.set(B,(y.get(B)||0)+1)}),y})();const ne=(()=>{const y=[];if(C.forEach(M=>{M.id==="position"?(y.push({...M,render:R=>{const de=typeof re=="function"?re():"ar";let qe=R?.positionLabelEn??R?.position_label_en??R?.position_name_en??R?.positionLabelAlt??R?.position_label_alt??R?.role;if(!qe&&de==="en")try{const W=typeof pt=="function"?pt():[];let k=null;if(R?.positionId!=null&&(k=W.find(J=>String(J.id)===String(R.positionId))||null),!k){const J=R?.positionKey??R?.position_key??R?.positionName??R?.position_name??R?.position??"";if(J){const se=String(J).toLowerCase();k=W.find(oe=>String(oe.name).toLowerCase()===se)||null}}k&&(qe=k.labelEn??k.label_en??k.name_en??qe)}catch{}const We=R?.positionLabel??R?.position_name??R?.role??r("reservations.crew.positionFallback","Ù…Ù†ØµØ¨ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…");return i(N(String(de==="en"&&qe?qe:We)))}}),w("projectCrew","quantity")&&y.push({id:"quantity",labelKey:"reservations.details.table.headers.quantity",fallback:"Ø§Ù„ÙƒÙ…ÙŠØ©",render:R=>i(N(String(Math.max(1,Number(R?.__count||1)))))})):M.id==="price"?y.push({...M,render:R=>{const de=Number.isFinite(Number(R?.positionClientPrice))?Number(R.positionClientPrice):0,qe=Math.max(1,Number(R?.__count||1)),We=Math.max(1,Number(l?.rentalDays||1)),m=de*qe*We;return i(`${fe(m)} ${r("reservations.create.summary.currency","SR")}`)}}):M.id==="unitPrice"?y.push({...M,render:R=>{const de=Number.isFinite(Number(R?.positionClientPrice))?Number(R.positionClientPrice):0;return i(`${fe(de)} ${r("reservations.create.summary.currency","SR")}`)}}):y.push(M)}),w("projectCrew","days")){const M=Math.max(1,Number(l?.rentalDays||1)),R=y.findIndex(qe=>qe.id==="price"),de=Math.max(0,R);y.splice(de,0,{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…",render:()=>i(N(String(M)))})}const O=new Map(y.map(M=>[M.id,M])),B=new Set,V=[],Q=M=>{const R=O.get(M);R&&!B.has(M)&&(V.push(R),B.add(M))};return Q("rowNumber"),Q("position"),Q("unitPrice"),Q("quantity"),Q("days"),Q("price"),y.forEach(M=>{B.has(M.id)||(V.push(M),B.add(M.id))}),V})(),X=(()=>{const y=new Map;return le.forEach(O=>{const B=F(O);if(!B)return;const V=y.get(B);V?V.__count+=1:y.set(B,{...O,__count:1})}),Array.from(y.values())})(),H=(()=>{try{const y=Math.max(1,Number(l?.rentalDays||1)),O=(X||[]).reduce((B,V)=>{const Q=Number.isFinite(Number(V?.positionClientPrice))?Number(V.positionClientPrice):0,M=Math.max(1,Number(V?.__count||1));return B+Q*M*y},0);return fe(O)}catch{return"0.00"}})(),te=$("projectCrew")?ne.length?`<section class="quote-section quote-section--table">
            <h3>${i(r("projects.quote.sections.crew","Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„"))}</h3>
            <table class="quote-table">
              <thead>
                <tr>${ne.map(y=>`<th>${i(y.labelKey?r(y.labelKey,y.fallback):y.fallback)}</th>`).join("")}</tr>
              </thead>
              <tbody>${X.length?X.map((y,O)=>`<tr>${ne.map(B=>`<td><div class="quote-cell">${B.render(y,O)}</div></td>`).join("")}</tr>`).join(""):`<tr><td colspan="${Math.max(ne.length,1)}" class="empty">${i(r("projects.details.crew.empty","Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ø§Ù‚Ù… ÙÙ†ÙŠ Ù…Ø±ØªØ¨Ø·."))}</td></tr>`}
              </tbody>
            </table>
            ${w("projectCrew","crewSubtotal")?`
              <div class="quote-table-subtotal">
                <span class="quote-table-subtotal__pill">
                  <span class="quote-table-subtotal__label">${i(r("reservations.details.labels.crewTotal","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±ÙŠÙ‚"))}</span>
                  <span class="quote-table-subtotal__value">${i(`${H} ${h}`)}</span>
                </span>
              </div>
            `:""}
          </section>`:`<section class="quote-section quote-section--table">
            <h3>${i(r("projects.quote.sections.crew","Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„"))}</h3>
            ${_}
          </section>`:"",ie=[];w("financialSummary","discountAmount")&&ie.push(Y(r("reservations.details.labels.discount","Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ…"),o.discountAmount||Z(0,h)));const j=r("projects.details.summary.preTaxTotal","Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©");w("financialSummary","reservationsTotal")&&ie.push(Y(j,o.reservationsTotal||Z(0,h))),w("financialSummary","taxAmount")&&ie.push(Y(r("projects.details.summary.combinedTax","Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"),o.taxAmount||Z(0,h)));const G=[];w("financialSummary","overallTotal")&&G.push(Y(r("projects.details.summary.overallTotal","Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ"),o.overallTotal||Z(0,h),{variant:"final"}));const ae=$("financialSummary")?!ie.length&&!G.length?`<section class="quote-section quote-section--financial">${_}</section>`:`<section class="quote-section quote-section--financial">
          ${f("projectFinancial",`<h3>${i(r("projects.quote.sections.financial","Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ"))}</h3>`,`<div class="totals-block">
              ${ie.length?`<div class="totals-inline">${ie.join("")}</div>`:""}
              ${G.length?`<div class="totals-final">${G.join("")}</div>`:""}
            </div>`)}
        </section>`:"",ce=Un.filter(y=>w("projectExpenses",y.id)),xe=$("projectExpenses")?ce.length?`<section class="quote-section quote-section--table">
            <h3>${i(r("projects.quote.sections.expenses","Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©"))}</h3>
            <table class="quote-table">
              <thead>
                <tr>${ce.map(y=>`<th>${i(y.labelKey?r(y.labelKey,y.fallback):y.fallback)}</th>`).join("")}</tr>
              </thead>
              <tbody>${s.length?s.map((y,O)=>`<tr>${ce.map(B=>`<td><div class="quote-cell">${B.render(y,O)}</div></td>`).join("")}</tr>`).join(""):`<tr><td colspan="${Math.max(ce.length,1)}" class="empty">${i(r("projects.details.expenses.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ØªØ·Ù„Ø¨Ø§Øª Ù…Ø³Ø¬Ù„Ø©."))}</td></tr>`}
              </tbody>
            </table>
            ${w("projectExpenses","expensesSubtotal")?`
              <div class="quote-table-subtotal">
                <span class="quote-table-subtotal__pill">
                  <span class="quote-table-subtotal__label">${i(r("projects.details.expensesTotal","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©"))}</span>
                  <span class="quote-table-subtotal__value">${i(o.expensesTotal||Z(0,h))}</span>
                </span>
              </div>
            `:""}
          </section>`:`<section class="quote-section quote-section--table">
            <h3>${i(r("projects.quote.sections.expenses","Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©"))}</h3>
            ${_}
          </section>`:"",Be=Ft.filter(y=>w("projectEquipment",y.id)),ge=(()=>{let y=[];if(Be.forEach(Q=>{Q.id==="price"?y.push({...Q,render:M=>{const R=Number.isFinite(Number(M?.unitPriceValue))?Number(M.unitPriceValue):0,de=Number.isFinite(Number(M?.qty))?Math.max(1,Number(M.qty)):1,qe=Math.max(1,Number(l?.rentalDays||1)),We=R*de*qe;return i(`${fe(We)} ${r("reservations.create.summary.currency","SR")}`)}}):Q.id==="unitPrice"?y.push({...Q,render:M=>{const R=Number.isFinite(Number(M?.unitPriceValue))?Number(M.unitPriceValue):0;return i(`${fe(R)} ${r("reservations.create.summary.currency","SR")}`)}}):y.push(Q)}),w("projectEquipment","days")){const Q=Math.max(1,Number(l?.rentalDays||1)),M=y.findIndex(de=>de.id==="price"),R=Math.max(0,M);y.splice(R,0,{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…",render:()=>i(N(String(Q)))})}const O=new Map(y.map(Q=>[Q.id,Q])),B=y.filter(Q=>!["unitPrice","quantity","days","price"].includes(Q.id)),V=["unitPrice","quantity","days","price"].map(Q=>O.get(Q)).filter(Boolean);return y=[...B,...V],y})(),we=Array.isArray(l?.equipmentItems)?l.equipmentItems:[],Ue=(()=>{try{const y=Math.max(1,Number(l?.rentalDays||1)),O=(we||[]).reduce((B,V)=>{const Q=Number.isFinite(Number(V?.unitPriceValue))?Number(V.unitPriceValue):0,M=Number.isFinite(Number(V?.qty))?Math.max(1,Number(V.qty)):1;return B+Q*M*y},0);return fe(O)}catch{return"0.00"}})(),Xe=$("projectEquipment")?ge.length?`<section class="quote-section quote-section--table">
            <h3>${i(r("projects.quote.sections.equipment","Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</h3>
            <table class="quote-table">
              <thead>
                <tr>${ge.map(y=>`<th>${i(y.labelKey?r(y.labelKey,y.fallback):y.fallback)}</th>`).join("")}</tr>
              </thead>
              <tbody>${we.length?we.map((y,O)=>`<tr>${ge.map(B=>`<td><div class="quote-cell">${B.render(y,O)}</div></td>`).join("")}</tr>`).join(""):`<tr><td colspan="${Math.max(ge.length,1)}" class="empty">${i(r("projects.details.equipment.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø¯Ø§Øª Ù…Ø±ØªØ¨Ø·Ø© Ø­Ø§Ù„ÙŠØ§Ù‹."))}</td></tr>`}
              </tbody>
            </table>
            ${w("projectEquipment","equipmentSubtotal")?`
              <div class="quote-table-subtotal">
                <span class="quote-table-subtotal__pill">
                  <span class="quote-table-subtotal__label">${i(r("reservations.details.labels.equipmentTotal","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</span>
                  <span class="quote-table-subtotal__value">${i(`${Ue} ${h}`)}</span>
                </span>
              </div>
            `:""}
          </section>`:`<section class="quote-section quote-section--table">
            <h3>${i(r("projects.quote.sections.equipment","Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</h3>
            ${_}
          </section>`:"",$e=(e?.description||"").trim()||"",Ke=$("projectNotes")?`<section class="quote-section">
        <h3>${i(r("projects.quote.sections.notes","Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"))}</h3>
        <div class="quote-notes">${i($e||r("projects.fallback.noDescription","Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ Ù„Ù„Ù…Ø´Ø±ÙˆØ¹."))}</div>
      </section>`:"",Me=[];w("payment","beneficiary")&&Me.push(ee(r("reservations.quote.labels.beneficiary","Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙÙŠØ¯"),be.beneficiaryName)),w("payment","bank")&&Me.push(ee(r("reservations.quote.labels.bank","Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ"),be.bankName)),w("payment","account")&&Me.push(ee(r("reservations.quote.labels.account","Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨"),N(be.accountNumber))),w("payment","iban")&&Me.push(ee(r("reservations.quote.labels.iban","Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ¨Ø§Ù†"),N(be.iban)));const Je=`<section class="quote-section">
      <div class="payment-block">
        <h3>${i(r("reservations.quote.sections.payment","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹"))}</h3>
        <div class="payment-rows">${Me.length?Me.join(""):_}</div>
      </div>
      <p class="quote-approval-note">${i(be.approvalNote)}</p>
    </section>`,at=Array.isArray(b)&&b.length?b:Ie,He=`<footer class="quote-footer">
        <h4>${i(r("reservations.quote.labels.terms","Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø¹Ø§Ù…Ø©"))}</h4>
        <ul>${at.map(y=>`<li>${i(y)}</li>`).join("")}</ul>
      </footer>`,Te=[],_e=[];if(U&&_e.push({key:"project",html:U}),T&&_e.push({key:"customer",html:T}),_e.length>1){const y=_e.find(V=>V.key==="project"),O=_e.find(V=>V.key==="customer"),B=[];y?.html&&B.push(y.html),O?.html&&B.push(O.html),Te.push(ue(`<div class="quote-section-row quote-section-row--primary">${B.join("")}</div>`,{blockType:"group"}))}else _e.length===1&&Te.push(ue(_e[0].html));const Pe=[];te&&Pe.push(ue(te,{blockType:"table",extraAttributes:'data-table-id="project-crew"'})),xe&&Pe.push(ue(xe,{blockType:"table",extraAttributes:'data-table-id="project-expenses"'})),Xe&&Pe.push(ue(Xe,{blockType:"table",extraAttributes:'data-table-id="project-equipment"'}));const Ve=[];ae&&Ve.push(ue(ae,{blockType:"summary"})),Ke&&Ve.push(ue(Ke));let Ze=[];Ze=[...$("payment")?[ue(Je,{blockType:"payment"})]:[],ue(He,{blockType:"footer"})];const st=[...Pt(Te,"projects.quote.placeholder.primary"),...Pe,...Pt(Ve,"projects.quote.placeholder.summary"),...Ze],Qe=typeof re=="function"?re():"ar",ot=`
    <header class="quote-header" data-quote-header-template>
      <div class="quote-header__logo">
        <img class="quote-logo" src="${i(be.logoUrl)}" alt="${i(be.companyName)}" crossorigin="anonymous"/>
      </div>
      <div class="quote-header__title">
        <h1>${i(r("projects.quote.title","Ø¹Ø±Ø¶ Ø³Ø¹Ø±"))}</h1>
        <p class="quote-company-name">${i(r("quote.companyName",be.companyName))}</p>
        <p class="quote-company-cr">${i(r("reservations.quote.labels.cr","Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ"))}: ${i(be.commercialRegistry)}</p>
        <p class="quote-company-license">${i(r("reservations.quote.labels.mediaLicense","ØªØ±Ø®ÙŠØµ Ø¥Ø¹Ù„Ø§Ù…ÙŠ"))}: 159460</p>
      </div>
      <div class="quote-header__meta">
        <div class="quote-header__meta-item">
          <span>${i(r("reservations.details.labels.reservationId","Ø±Ù‚Ù… Ø§Ù„Ø¹Ø±Ø¶"))}</span>
          <strong>${i(S)}</strong>
        </div>
        <div class="quote-header__meta-item">
          <span>${i(r("projects.quote.labels.date","Ø§Ù„ØªØ§Ø±ÙŠØ®"))}</span>
          <strong>${i(v)}</strong>
        </div>
      </div>
    </header>
  `.trim();return`
    <div id="quotation-pdf-root" dir="rtl" data-lang="${i(Qe)}">
      <style>${Jn}${Xn}</style>
      <div class="quote-document" data-quote-document>
        <div class="quote-preview-pages" data-quote-pages></div>
        <div class="quote-content-source" data-quote-source>
          ${ot}
          ${st.join("")}
        </div>
      </div>
    </div>
  `}function fa(e){if(e?.context==="project")return Ms(e);const{reservation:t,customer:n,project:a,crewAssignments:s,totals:u,totalsDisplay:o,rentalDays:c,currencyLabel:d,sections:h,fieldSelections:g={},quoteNumber:x,quoteDate:S,terms:v=Ie}=e,b=N(String(t?.reservationId??t?.id??"")),I=typeof re=="function"?re():"ar",w=t.start?N(dt(t.start)):"-",$=t.end?N(dt(t.end)):"-",_=n?.customerName||n?.full_name||n?.name||"-",K=n?.phone||"-",Y=n?.email||"-",ee=n?.company||n?.company_name||"-",f=N(K),q=a?.title||a?.name||r("reservations.details.project.none","ØºÙŠØ± Ù…Ø±ØªØ¨Ø· Ø¨Ù…Ø´Ø±ÙˆØ¹"),T=a?.code||a?.projectCode||"",P=N(String(c)),U=t?.notes||"",C=Array.isArray(v)&&v.length?v:Ie,le=dn(g),F=(p,E)=>pn(le,p,E),ne=p=>h?.has?.(p),X=`<div class="quote-placeholder">${i(r("reservations.quote.placeholder.noFields","Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù„Ù„Ø¹Ø±Ø¶ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…."))}</div>`,H=(p,E)=>{const z=I==="en"?": ":" / ";return`<div class="info-plain__item">${i(p)}<span class="info-plain__slash">${z}</span><strong class="info-plain__value">${i(E)}</strong></div>`},te=(p,E,{variant:z="inline"}={})=>z==="final"?`<div class="totals-item totals-item--final">
        <span class="totals-item__label">${i(p)}</span>
        <span class="totals-item__slash">/</span>
        <span class="totals-item__value">${i(E)}</span>
      </div>`:`<span class="totals-inline__item">
      <span class="totals-inline__label">${i(p)}</span>
      <span class="totals-inline__slash">/</span>
      <span class="totals-inline__value">${i(E)}</span>
    </span>`,ie=(p,E)=>`<div class="payment-row">
      <span class="payment-row__label">${i(p)}</span>
      <span class="payment-row__slash">/</span>
      <span class="payment-row__value">${i(E)}</span>
    </div>`,j=(p,E,z)=>{const pe=`${p}-title`,ke=`${p}-content`;return`
      <div class="quote-section__head" data-drag-key="${i(pe)}">
        ${E}
      </div>
      <div class="quote-section__body" data-drag-key="${i(ke)}">
        ${z}
      </div>
    `},G=[];F("customerInfo","customerName")&&G.push(H(r("reservations.details.labels.customer","Ø§Ù„Ø¹Ù…ÙŠÙ„"),_)),F("customerInfo","customerCompany")&&G.push(H(r("reservations.details.labels.company","Ø§Ù„Ø´Ø±ÙƒØ©"),ee)),F("customerInfo","customerPhone")&&G.push(H(r("reservations.details.labels.phone","Ø§Ù„Ù‡Ø§ØªÙ"),f)),F("customerInfo","customerEmail")&&G.push(H(r("reservations.details.labels.email","Ø§Ù„Ø¨Ø±ÙŠØ¯"),Y));const ae=ne("customerInfo")&&G.length?`<section class="quote-section quote-section--plain quote-section--customer">
            ${j("customer",`<h3 class="quote-section__title">${i(r("reservations.quote.sections.customer","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„"))}</h3>`,`<div class="info-plain">${G.join("")}</div>`)}
          </section>`:"",ce=[];F("reservationInfo","reservationId")&&ce.push(H(r("reservations.details.labels.reservationId","Ø±Ù‚Ù… Ø§Ù„Ø­Ø¬Ø²"),b||"-")),F("reservationInfo","reservationStart")&&ce.push(H(r("reservations.details.labels.start","Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø­Ø¬Ø²"),w)),F("reservationInfo","reservationEnd")&&ce.push(H(r("reservations.details.labels.end","Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø­Ø¬Ø²"),$)),F("reservationInfo","reservationDuration")&&ce.push(H(r("reservations.details.labels.duration","Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…"),P));const xe=ne("reservationInfo")&&ce.length?`<section class="quote-section quote-section--plain quote-section--reservation">
            ${j("reservation",`<h3 class="quote-section__title">${i(r("reservations.quote.sections.reservation","ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²"))}</h3>`,`<div class="info-plain">${ce.join("")}</div>`)}
          </section>`:"",Be=[];F("projectInfo","projectTitle")&&Be.push(H(r("reservations.details.labels.project","Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),q)),F("projectInfo","projectCode")&&Be.push(H(r("reservations.details.labels.code","Ø§Ù„Ø±Ù…Ø²"),T||"-"));const ge=ne("projectInfo")&&Be.length?`<section class="quote-section quote-section--plain quote-section--project">
            ${j("project",`<h3 class="quote-section__title">${i(r("reservations.quote.sections.project","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"))}</h3>`,`<div class="info-plain">${Be.join("")}</div>`)}
          </section>`:"",we=[];F("financialSummary","discountAmount")&&we.push(te(r("reservations.details.labels.discount","Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ…"),`${o.discountAmount} ${d}`)),F("financialSummary","subtotalBeforeTax")&&we.push(te(r("reservations.details.labels.subtotalBeforeTax","Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"),`${o.taxableAmount} ${d}`)),F("financialSummary","taxAmount")&&we.push(te(r("reservations.details.labels.tax","Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"),`${o.taxAmount} ${d}`));const Ue=F("financialSummary","finalTotal"),Xe=[];Ue&&Xe.push(te(r("reservations.details.labels.total","Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ"),`${o.finalTotal} ${d}`,{variant:"final"}));const $e=Xe.length?`<div class="totals-final">${Xe.join("")}</div>`:"",Ke=ne("financialSummary")?!we.length&&!Ue?`<section class="quote-section quote-section--financial">${X}</section>`:`<section class="quote-section quote-section--financial">
          ${j("financial",`<h3 class="quote-section__title">${i(r("reservations.details.labels.summary","Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ"))}</h3>`,`<div class="totals-block">
              ${we.length?`<div class="totals-inline">${we.join("")}</div>`:""}
              ${$e}
            </div>`)}
        </section>`:"",{groups:Me}=Fn(t),Je=Me.map(p=>{const E=Number(p?.count??p?.quantity??1)||1,z=Number(p?.unitPrice);let pe=Number.isFinite(z)?z:0;if(!pe||pe<=0){const me=Number(p?.totalPrice);Number.isFinite(me)&&E>0&&(pe=Number((me/E).toFixed(2)))}Number.isFinite(pe)||(pe=0);const ke=p?.type==="package"||Array.isArray(p?.items)&&p.items.some(me=>me?.type==="package"),Fe=Array.isArray(p?.barcodes)&&p.barcodes.length?p.barcodes[0]:Array.isArray(p?.items)&&p.items.length?p.items[0]?.barcode:null;let D=p?.packageDisplayCode??p?.package_code??p?.code??p?.packageCode??(Array.isArray(p?.items)&&p.items.length?p.items[0]?.package_code??p.items[0]?.code??p.items[0]?.packageCode:null);const L=me=>{const ve=(me==null?"":String(me)).trim();return!!(!ve||/^pkg-/i.test(ve)||/^\d+$/.test(ve)&&ve.length<=4)};if(!D||L(D)){const me=p?.packageId??p?.package_id??(Array.isArray(p?.items)&&p.items.length?p.items[0]?.packageId??p.items[0]?.package_id:null);if(me)try{const ve=Rn(me);ve&&ve.package_code&&(D=ve.package_code)}catch{}}if(!D||L(D))try{const me=ct(p?.description||"");if(me){const ve=On();let je=ve.find(De=>ct(De?.name||De?.title||De?.label||"")===me);je||(je=ve.find(De=>{const kt=ct(De?.name||De?.title||De?.label||"");return kt.includes(me)||me.includes(kt)})),je&&je.package_code&&(D=je.package_code)}}catch{}const ye=ke?D??Fe??"":p?.barcode??Fe??"",Ne=ye!=null?String(ye):"";let Re=Number.isFinite(Number(p?.totalPrice))?Number(p.totalPrice):Number((pe*E).toFixed(2));return Re=wt(Re),{...p,isPackage:ke,desc:p?.description,barcode:Ne,packageCodeResolved:D||"",qty:E,price:Re,totalPrice:Re,unitPriceValue:pe}}),at=Ft.filter(p=>F("items",p.id)),He=(()=>{let p=[];at.forEach(D=>{D.id==="price"?p.push({...D,render:L=>{const ye=Number.isFinite(Number(L?.unitPriceValue))?Number(L.unitPriceValue):0,Ne=Number.isFinite(Number(L?.qty))?Math.max(1,Number(L.qty)):1,Re=Math.max(1,Number(l?.rentalDays||1)),me=ye*Ne*Re;return i(`${fe(me)} ${r("reservations.create.summary.currency","SR")}`)}}):D.id==="unitPrice"?p.push({...D,render:L=>{const ye=Number.isFinite(Number(L?.unitPriceValue))?Number(L.unitPriceValue):0;return i(`${fe(ye)} ${r("reservations.create.summary.currency","SR")}`)}}):p.push(D)});const E=Math.max(1,Number(l?.rentalDays||1));if(F("items","days")){const D=p.findIndex(ye=>ye.id==="price"),L=Math.max(0,D);p.splice(L,0,{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…",render:()=>i(N(String(E)))})}const z=new Map(p.map(D=>[D.id,D])),pe=p.filter(D=>!["unitPrice","quantity","days","price"].includes(D.id)),ke=["unitPrice","quantity"];z.has("days")&&ke.push("days"),ke.push("price");const Fe=ke.map(D=>z.get(D)).filter(Boolean);return p=[...pe,...Fe],p})(),Te=He.length>0,_e=Te?He.map(p=>`<th>${i(p.labelKey?r(p.labelKey,p.fallback):p.fallback)}</th>`).join(""):"",Ve=Je.length>0?Je.map((p,E)=>`<tr>${He.map(z=>`<td><div class="quote-cell">${z.render(p,E)}</div></td>`).join("")}</tr>`).join(""):`<tr><td colspan="${Math.max(He.length,1)}" class="empty">${i(r("reservations.details.noItems","ğŸ“¦ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø¯Ø§Øª Ø¶Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø² Ø­Ø§Ù„ÙŠØ§Ù‹."))}</td></tr>`,Ze=ne("items")?Te?`<section class="quote-section quote-section--table">
            <h3>${i(r("reservations.details.items.title","Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</h3>
            <table class="quote-table">
              <thead>
                <tr>${_e}</tr>
              </thead>
              <tbody>${Ve}</tbody>
            </table>
            ${F("items","equipmentSubtotal")?`
              <div class="quote-table-subtotal">
                <span class="quote-table-subtotal__pill">
                  <span class="quote-table-subtotal__label">${i(r("reservations.details.labels.equipmentTotal","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</span>
                  <span class="quote-table-subtotal__value">${i(`${o.equipmentTotal} ${d}`)}</span>
                </span>
              </div>
            `:""}
          </section>`:`<section class="quote-section quote-section--table">
            <h3>${i(r("reservations.details.items.title","Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</h3>
            ${X}
          </section>`:"",st=Mt.filter(p=>F("crew",p.id)),Qe=st.length>0,ot=Array.isArray(s)?s:[],y=p=>{const E=p&&p.positionId!=null?`id:${String(p.positionId)}`:(()=>{const ke=(p?.positionLabel||p?.position_name||p?.position||"").trim().toLowerCase();return ke?`label:${ke}`:""})(),z=Number.isFinite(Number(p?.positionClientPrice))?Number(p.positionClientPrice):0,pe=z>0?`|p:${z.toFixed(2)}`:"";return`${E}${pe}`};(()=>{const p=new Map;return ot.forEach(E=>{const z=y(E);z&&p.set(z,(p.get(z)||0)+1)}),p})();const O=(()=>{let p=[],E=null;if(st.forEach(D=>{D.id==="position"?(p.push({...D,render:L=>{const ye=typeof re=="function"?re():"ar";let Ne=L?.positionLabelEn??L?.position_label_en??L?.position_name_en??L?.positionLabelAlt??L?.position_label_alt??L?.role;if(!Ne&&ye==="en")try{const ve=typeof pt=="function"?pt():[];let je=null;if(L?.positionId!=null&&(je=ve.find(De=>String(De.id)===String(L.positionId))||null),!je){const De=L?.positionKey??L?.position_key??L?.positionName??L?.position_name??L?.position??"";if(De){const kt=String(De).toLowerCase();je=ve.find(va=>String(va.name).toLowerCase()===kt)||null}}je&&(Ne=je.labelEn??je.label_en??je.name_en??Ne)}catch{}const Re=L?.positionLabel??L?.position_name??L?.role??r("reservations.crew.positionFallback","Ù…Ù†ØµØ¨ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…");return i(N(String(ye==="en"&&Ne?Ne:Re)))}}),F("crew","quantity")&&(E={id:"quantity",labelKey:"reservations.details.table.headers.quantity",fallback:"Ø§Ù„ÙƒÙ…ÙŠØ©",render:L=>{const ye=Number(L?.__count||1);return i(N(String(Math.max(1,ye))))}})):D.id==="price"?p.push({...D,render:L=>{const ye=Number.isFinite(Number(L?.positionClientPrice))?Number(L.positionClientPrice):0,Ne=Math.max(1,Number(L?.__count||1)),Re=Math.max(1,Number(l?.rentalDays||1)),me=ye*Ne*Re;return i(`${fe(me)} ${r("reservations.create.summary.currency","SR")}`)}}):D.id==="unitPrice"?p.push({...D,render:L=>{const ye=Number.isFinite(Number(L?.positionClientPrice))?Number(L.positionClientPrice):0;return i(`${fe(ye)} ${r("reservations.create.summary.currency","SR")}`)}}):p.push(D)}),E&&p.push(E),F("crew","days")){const D=Math.max(1,Number(l?.rentalDays||1)),L=p.findIndex(Ne=>Ne.id==="price"),ye=Math.max(0,L);p.splice(ye,0,{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…",render:()=>i(N(String(D)))})}const z=new Map(p.map(D=>[D.id,D])),pe=new Set,ke=[],Fe=D=>{const L=z.get(D);L&&!pe.has(D)&&(ke.push(L),pe.add(D))};return Fe("rowNumber"),Fe("position"),Fe("unitPrice"),Fe("quantity"),Fe("days"),Fe("price"),p.forEach(D=>{pe.has(D.id)||(ke.push(D),pe.add(D.id))}),p=ke,p})(),B=Qe?O.map(p=>`<th>${i(p.labelKey?r(p.labelKey,p.fallback):p.fallback)}</th>`).join(""):"",V=(()=>{const p=new Map;return ot.forEach(E=>{const z=y(E);if(!z)return;const pe=p.get(z);pe?pe.__count+=1:p.set(z,{...E,__count:1})}),Array.from(p.values())})(),Q=V.length?V.map((p,E)=>`<tr>${O.map(z=>`<td><div class="quote-cell">${z.render(p,E)}</div></td>`).join("")}</tr>`).join(""):`<tr><td colspan="${Math.max(O.length,1)}" class="empty">${i(r("reservations.details.noCrew","ğŸ˜ Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙØ±ÙŠÙ‚ Ù…Ø±ØªØ¨Ø· Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø²."))}</td></tr>`,M=ne("crew")?Qe?`<section class="quote-section quote-section--table">
            <h3>${i(r("reservations.details.technicians.title","Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„"))}</h3>
            <table class="quote-table">
              <thead>
                <tr>${B}</tr>
              </thead>
              <tbody>${Q}</tbody>
            </table>
            ${F("crew","crewSubtotal")?`
              <div class="quote-table-subtotal">
                <span class="quote-table-subtotal__pill">
                  <span class="quote-table-subtotal__label">${i(r("reservations.details.labels.crewTotal","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±ÙŠÙ‚"))}</span>
                  <span class="quote-table-subtotal__value">${i(`${o.crewTotal} ${d}`)}</span>
                </span>
              </div>
            `:""}
          </section>`:`<section class="quote-section quote-section--table">
            <h3>${i(r("reservations.details.technicians.title","Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„"))}</h3>
            ${X}
          </section>`:"",R=ne("notes")?`<section class="quote-section">
        <h3>${i(r("reservations.details.labels.notes","Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø­Ø¬Ø²"))}</h3>
        <div class="quote-notes">${i(U||r("reservations.quote.emptyNotes","Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©."))}</div>
      </section>`:"",de=[];F("payment","beneficiary")&&de.push(ie(r("reservations.quote.labels.beneficiary","Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙÙŠØ¯"),be.beneficiaryName)),F("payment","bank")&&de.push(ie(r("reservations.quote.labels.bank","Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ"),be.bankName)),F("payment","account")&&de.push(ie(r("reservations.quote.labels.account","Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨"),N(be.accountNumber))),F("payment","iban")&&de.push(ie(r("reservations.quote.labels.iban","Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ¨Ø§Ù†"),N(be.iban)));const qe=`<section class="quote-section">
      <div class="payment-block">
        <h3>${i(r("reservations.quote.sections.payment","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹"))}</h3>
        <div class="payment-rows">${de.length?de.join(""):X}</div>
      </div>
      <p class="quote-approval-note">${i(be.approvalNote)}</p>
    </section>`,We=`<footer class="quote-footer">
        <h4>${i(r("reservations.quote.labels.terms","Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø¹Ø§Ù…Ø©"))}</h4>
        <ul>${C.map(p=>`<li>${i(p)}</li>`).join("")}</ul>
      </footer>`,m=[];if(ae&&xe){const E=(typeof re=="function"?re():"ar")==="en"?`${xe}${ae}`:`${ae}${xe}`;m.push(ue(`<div class="quote-section-row">${E}</div>`,{blockType:"group"}))}else xe&&m.push(ue(xe)),ae&&m.push(ue(ae));if(ge)try{const p=typeof re=="function"?re():"ar",E='<section class="quote-section quote-section--empty"></section>',z=p==="en"?`<div class="quote-section-row">${E}${ge}</div>`:`<div class="quote-section-row">${E}${ge}</div>`;m.push(ue(z,{blockType:"group"}))}catch{m.push(ue(ge))}const W=[];Ze&&W.push(ue(Ze,{blockType:"table",extraAttributes:'data-table-id="items"'})),M&&W.push(ue(M,{blockType:"table",extraAttributes:'data-table-id="crew"'}));const k=[];Ke&&k.push(ue(Ke,{blockType:"summary"})),R&&k.push(ue(R));let J=[];if((e?.context||"reservation")!=="reservationChecklist")J=[...ne("payment")?[ue(qe,{blockType:"payment"})]:[],ue(We,{blockType:"footer"})];else{const p=String(e?.checklistNotes||"").trim(),E=String(e?.checklistNotesTitle||"").trim()||r("reservations.checklist.controls.notes.sectionTitleDefault","Ù…Ù„Ø§Ø­Ø¸Ø§Øª");if(p.length>0){const z=`<section class="quote-section">
        <h3>${i(E)}</h3>
        <div class="quote-notes">${i(p)}</div>
      </section>`;J=[ue(z)]}}const se=[...e?.context==="reservationChecklist"?m:Pt(m,"reservations.quote.placeholder.page1"),...W,...e?.context==="reservationChecklist"?k:Pt(k,"reservations.quote.placeholder.page2"),...J],oe=e?.context==="reservationChecklist",Le=e?.checklistType==="crew"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ":e?.checklistType==="both"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙˆØ§Ù„Ø·Ø§Ù‚Ù… Ø§Ù„ÙÙ†ÙŠ":"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",Ce=typeof re=="function"?re():"ar",Se=e?.checklistType==="crew"?"Crew List":e?.checklistType==="both"?"Equipment & Crew List":"Equipment List",et=oe?Ce==="en"?Se:Le:r("reservations.quote.title","Ø¹Ø±Ø¶ Ø³Ø¹Ø±"),rt=oe?`<div class="quote-header__meta" ${Ce==="en"?'dir="ltr"':""}>
        <div class="quote-header__meta-item">
          <span>${i(r("reservations.quote.labels.date","Ø§Ù„ØªØ§Ø±ÙŠØ®"))}</span>
          <strong>${i(S)}</strong>
        </div>
      </div>`:`<div class="quote-header__meta">
        <div class="quote-header__meta-item">
          <span>Ø±Ù‚Ù… Ø§Ù„Ø¹Ø±Ø¶</span>
          <strong>${i(x)}</strong>
        </div>
        <div class="quote-header__meta-item">
          <span>Ø§Ù„ØªØ§Ø±ÙŠØ®</span>
          <strong>${i(S)}</strong>
        </div>
      </div>`,it=!oe||!e?.hideLogo,zt=!oe||!e?.hideCompany,he=`
    <header class="quote-header" data-quote-header-template style="${Number.isFinite(Number(e?.headerOffset))?`margin-top:${Number(e.headerOffset)}px;`:""}">
      <div class="quote-header__logo">
        ${it?`<img class="quote-logo" src="${i(be.logoUrl)}" alt="${i(be.companyName)}" crossorigin="anonymous"/>`:'<span class="quote-logo quote-logo--placeholder" aria-hidden="true"></span>'}
      </div>
      <div class="quote-header__title">
        <h1>${i(et)}</h1>
        ${zt?`
          <p class="quote-company-name">${i(r("quote.companyName",be.companyName))}</p>
          <p class="quote-company-cr">${i(r("reservations.quote.labels.cr","Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ"))}: ${i(be.commercialRegistry)}</p>
          <p class="quote-company-license">${i(r("reservations.quote.labels.mediaLicense","ØªØ±Ø®ÙŠØµ Ø¥Ø¹Ù„Ø§Ù…ÙŠ"))}: 159460</p>
        `:""}
      </div>
      ${rt}
    </header>
  `.trim();return`
    <div id="quotation-pdf-root" dir="${i(oe&&Ce==="en"?"ltr":"rtl")}" data-lang="${i(Ce)}">
      <style>${Jn}${Xn}</style>
      <div class="quote-document" data-quote-document>
        <div class="quote-preview-pages" data-quote-pages></div>
        <div class="quote-content-source" data-quote-source>
          ${he}
          ${se.join("")}
        </div>
      </div>
    </div>
  `}async function vn(){try{const e=nn();if((Array.isArray(e?.packages)?e.packages:[]).length>0)return;const n=await wa("/packages/?all=1"),a=Array.isArray(n?.data)?n.data:Array.isArray(n)?n:[];a.length&&(qa({packages:a}),document.dispatchEvent?.(new CustomEvent("packages:changed",{detail:{packages:a}})))}catch{}}function Rs(e){return e?e.complete?e.naturalHeight===0?Promise.reject(new Error(`image failed to load: ${e.src||"unknown"}`)):Promise.resolve():new Promise((t,n)=>{const a=()=>{u(),t()},s=()=>{u(),n(new Error(`image failed to load: ${e.src||"unknown"}`))},u=()=>{e.removeEventListener("load",a),e.removeEventListener("error",s)};e.addEventListener("load",a,{once:!0}),e.addEventListener("error",s,{once:!0})}):Promise.resolve()}async function qt(e){if(!e)return;const t=e.ownerDocument||document,n=t.defaultView||window,a=Array.from(e.querySelectorAll?.("img")||[]),s=t.fonts?.ready?t.fonts.ready:Promise.resolve(),u=a.map(c=>Rs(c)),o=[s,...u].map(c=>c.catch(d=>(ze("asset load failed",d),ss(),null)));await Promise.all(o),await new Promise(c=>n.requestAnimationFrame(()=>c()))}async function Dt(e,{context:t="preview"}={}){if(!e)return;const n=t==="preview",a=e.ownerDocument||document;e.setAttribute("data-quote-render-context",t);const s=e.querySelector("[data-quote-pages]"),u=e.querySelector("[data-quote-source]"),o=u?.querySelector("[data-quote-header-template]");if(!s||!u||!o)return;s.style.display="block",s.style.margin="0",s.style.padding="0",s.style.gap="0px",s.style.rowGap="0px",s.style.columnGap="0px",s.style.alignItems="stretch",s.style.justifyContent="flex-start",await ua(u),await qt(u),s.innerHTML="";const c=Array.from(u.querySelectorAll(":scope > [data-quote-block]"));let d=null,h=null;const g=f=>{f.style.margin="0 auto",f.style.breakInside="avoid",f.style.pageBreakInside="avoid",f.style.pageBreakAfter="auto",f.style.breakAfter="auto"},x=()=>{const f=a.createElement("div"),q=s.childElementCount===0;if(f.className="quote-page",f.dataset.pageIndex=String(s.childElementCount),q){f.classList.add("quote-page--primary");const P=o.cloneNode(!0);P.removeAttribute("data-quote-header-template"),f.appendChild(P)}else f.classList.add("quote-page--continuation");const T=a.createElement("main");T.className="quote-body",f.appendChild(T),s.appendChild(f),g(f),d=f,h=T},S=()=>{(!d||!h||!h.isConnected)&&x()},v=()=>{if(!d||!h||h.childElementCount>0)return;const f=d;d=null,h=null,f.parentNode&&f.parentNode.removeChild(f)},b=()=>{d=null,h=null},I=()=>d?d.scrollHeight-d.clientHeight>aa:!1,w=(f,{allowOverflow:q=!1}={})=>(S(),h.appendChild(f),I()&&!q?(h.removeChild(f),v(),!1):!0),$=f=>{const q=f.cloneNode(!0);q.removeAttribute?.("data-quote-block"),q.removeAttribute?.("data-block-type"),q.removeAttribute?.("data-table-id"),!w(q)&&(b(),!w(q)&&w(q,{allowOverflow:!0}))},_=f=>{const q=f.querySelector("table");if(!q){$(f);return}const T=f.querySelector("h3"),P=q.querySelector("thead"),U=Array.from(q.querySelectorAll("tbody tr"));if(!U.length){$(f);return}let C=null,le=0;const F=(X=!1)=>{const H=f.cloneNode(!1);H.removeAttribute("data-quote-block"),H.removeAttribute("data-block-type"),H.removeAttribute("data-table-id"),H.classList.add("quote-section--table-fragment"),X&&H.classList.add("quote-section--table-fragment--continued");const te=T?T.cloneNode(!0):null;te&&H.appendChild(te);const ie=q.cloneNode(!1);ie.classList.add("quote-table--fragment"),P&&ie.appendChild(P.cloneNode(!0));const j=a.createElement("tbody");return ie.appendChild(j),H.appendChild(ie),{section:H,body:j}},ne=(X=!1)=>C||(C=F(X),w(C.section)||(b(),w(C.section)||w(C.section,{allowOverflow:!0})),C);U.forEach(X=>{ne(le>0);const H=X.cloneNode(!0);if(C.body.appendChild(H),I()&&(C.body.removeChild(H),C.body.childElementCount||(h.removeChild(C.section),C=null,v()),b(),C=null,ne(le>0),C.body.appendChild(H),I())){C.section.classList.add("quote-section--table-fragment--overflow"),le+=1;return}le+=1}),C=null;try{const X=f.querySelector(":scope > .quote-table-subtotal");X&&$(X)}catch{}};if(!c.length)return;c.forEach(f=>{f.getAttribute("data-block-type")==="table"?_(f):$(f)});const K=Array.from(s.children),Y=[];if(K.forEach((f,q)=>{const T=f.querySelector(".quote-body");if(q!==0&&(!T||T.childElementCount===0)){f.remove();return}Y.push(f)}),!n){const f=a.defaultView||window,q=Math.min(3,Math.max(1,f.devicePixelRatio||1)),T=Ht()?Math.min(2,q):q;Y.forEach(P=>ws(P,{pixelRatio:T}))}Y.forEach((f,q)=>{const T=q===0;f.style.pageBreakAfter="auto",f.style.breakAfter="auto",f.style.pageBreakBefore=T?"auto":"always",f.style.breakBefore=T?"auto":"page",n?f.style.boxShadow="":f.style.boxShadow="none"});const ee=Y[Y.length-1]||null;d=ee,h=ee?.querySelector(".quote-body")||null,await qt(s);try{Ya(e,l?.blockOffsets)}catch{}n&&(s.style.display="flex",s.style.flexDirection="column",s.style.alignItems="center",s.style.justifyContent="flex-start",s.style.rowGap="18px",s.style.columnGap="0px",s.style.gap="18px")}function ya(e=0){return e<=0?new Promise(t=>requestAnimationFrame(()=>t())):new Promise(t=>setTimeout(t,e))}function ha(e){return e?Array.from(e.querySelectorAll(".quote-page")).some(n=>n.scrollHeight-n.clientHeight>aa):!1}function wn(e,t="#000000"){if(!e)return;e.querySelectorAll('[style*="color"], [class*="text"], h1, h2, h3, h4, h5, h6, p, span, th, td, li, strong, em, label, dt, dd, caption, div').forEach(a=>{a instanceof HTMLElement&&a.style.setProperty("color",t,"important")})}async function Os(e,{filename:t,safariWindowRef:n=null,mobileWindowRef:a=null}){if(!e)return;const s=Array.from(e.querySelectorAll(".quote-page"));if(!s.length)throw new Error("Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙØ­Ø§Øª Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§.");const[u,o]=await Promise.all([Ss(),qs()]),c=e.ownerDocument||document,d=c?.defaultView?.getComputedStyle?.(e)?.direction,g=[e.getAttribute?.("dir"),e.style?.direction,d,c?.documentElement?.getAttribute?.("dir")].some(f=>typeof f=="string"&&f.toLowerCase().startsWith("rtl")),x=typeof window<"u"&&window.devicePixelRatio||1,S=fn(),v=ra(),b=Ht();let I;b?I=1.5:v?I=Math.min(1.7,Math.max(1.2,x*1.1)):S?I=Math.min(1.8,Math.max(1.25,x*1.2)):I=Math.min(2,Math.max(1.6,x*1.4));const w=b||v?.9:S?.92:.95,$=new u({unit:"mm",format:"a4",orientation:"portrait",compress:!0}),_={scale:I,useCORS:!0,allowTaint:!1,backgroundColor:"#ffffff",letterRendering:!g,removeContainer:!1,logging:!0};let K=0;const Y=r("reservations.quote.errors.browserLimit","ØªØ¹Ø°Ø± Ø¥ØªÙ…Ø§Ù… Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ø³Ø¨Ø¨ Ù‚ÙŠÙˆØ¯ Ø§Ù„Ù…ØªØµÙØ­ØŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø£Ùˆ ØªÙ‚Ù„ÙŠÙ„ Ø­Ø¬Ù… Ø§Ù„Ù…Ø­ØªÙˆÙ‰.");try{for(let f=0;f<s.length;f+=1){const q=s[f];await ua(q),await qt(q);const T=q.ownerDocument||document,P=T.createElement("div");Object.assign(P.style,{position:"fixed",top:"0",left:"-12000px",pointerEvents:"none",zIndex:"-1",backgroundColor:"#ffffff"});const U=q.cloneNode(!0);U.style.width=`${_t}px`,U.style.maxWidth=`${_t}px`,U.style.minWidth=`${_t}px`,U.style.height=`${xt}px`,U.style.maxHeight=`${xt}px`,U.style.minHeight=`${xt}px`,U.style.position="relative",U.style.background="#ffffff",wn(U),P.appendChild(U),T.body.appendChild(P);let C;try{await qt(U),C=await o(U,{..._,scale:I,backgroundColor:"#ffffff",scrollX:0,scrollY:0})}catch(j){throw en(j,"pageCapture",{toastMessage:Y}),j}finally{P.parentNode?.removeChild(P)}if(!C)continue;const le=C.width||1,ne=(C.height||1)/le;let X=Yt,H=X*ne,te=0;if(H>At){const j=At/H;H=At,X=X*j,te=Math.max(0,(Yt-X)/2)}const ie=C.toDataURL("image/jpeg",w);K>0&&$.addPage(),$.addImage(ie,"JPEG",te,0,X,H,`page-${K+1}`,"FAST"),K+=1,await new Promise(j=>window.requestAnimationFrame(j))}}catch(f){throw tn({safariWindowRef:n,mobileWindowRef:a}),f}if(K===0)throw tn({safariWindowRef:n,mobileWindowRef:a}),new Error("PDF generation produced no pages.");if(v||b){const f=$.output("blob");if(b){const q=URL.createObjectURL(f);vt();try{window.location.assign(q)}catch(T){ze("mobile safari blob navigation failed",T)}finally{setTimeout(()=>URL.revokeObjectURL(q),6e4)}}else{const q=URL.createObjectURL(f),T=()=>v&&n&&!n.closed?n:a&&!a.closed?a:null,P=(C,le)=>{if(vt(),!C){window.location.assign(le);return}try{C.location.replace(le),C.focus?.()}catch(F){ze("direct blob navigation failed",F);try{C.document.open(),C.document.write(`<!DOCTYPE html><html lang="ar" dir="rtl"><head><meta charset="utf-8"><title>${i(r("reservations.quote.actions.export","ØªÙ†Ø²ÙŠÙ„ PDF"))}</title><style>html,body{margin:0;height:100%;background:#0f172a;color:#f8fafc;font-family:'Tajawal',sans-serif;} iframe{border:none;width:100%;height:100%;display:block;}</style></head><body><iframe src="${le}" title="PDF preview"></iframe></body></html>`),C.document.close()}catch(ne){ze("iframe blob delivery failed",ne),window.location.assign(le)}}},U=T();P(U,q),setTimeout(()=>URL.revokeObjectURL(q),6e4)}}else{vt();const f=$.output("bloburl"),q=document.createElement("a");q.href=f,q.download=t,q.rel="noopener",q.style.display="none",document.body.appendChild(q),q.click(),setTimeout(()=>{URL.revokeObjectURL(f),q.remove()},2e3)}}function Ae(){if(!l||!A)return;const{previewFrame:e}=A;if(!e)return;const t=l.context||"reservation",n=fa({context:t,reservation:l.reservation,customer:l.customer,project:l.project,crewAssignments:l.crewAssignments,totals:l.totals,totalsDisplay:l.totalsDisplay,rentalDays:l.rentalDays,currencyLabel:l.currencyLabel,sections:l.sections,fieldSelections:l.fields,quoteNumber:l.quoteNumber,quoteDate:l.quoteDateLabel,terms:l.terms,checklistType:l.checklistType,checklistNotes:l.checklistNotes,checklistNotesTitle:l.checklistNotesTitle,hideLogo:!!l.hideLogo,hideCompany:!!l.hideCompany,headerOffset:Number(l.headerOffset||0),projectCrew:l.projectCrew,projectExpenses:l.projectExpenses,projectEquipment:l.projectEquipment,projectInfo:l.projectInfo,clientInfo:l.clientInfo,paymentSummary:l.paymentSummary,projectTotals:l.projectTotals});nt("render"),e.srcdoc=`<!DOCTYPE html>${n}`,e.addEventListener("load",async()=>{try{const a=e.contentDocument,s=a?.defaultView||window,u=a?.documentElement||a;u&&(Bn(u),Kn(u,s),Hn(u,s));const o=a?.getElementById("quotation-pdf-root");try{o&&(await Dt(o,{context:"preview"}),await ya(120),ha(o)&&await Dt(o,{context:"preview"}),wn(o))}catch(v){console.error("[reservations/pdf] failed to layout preview document",v)}const c=Array.from(a?.querySelectorAll?.(".quote-page")||[]);try{if(l?.context==="reservationChecklist"&&l?.hideCompany){const b=a.querySelector(".quote-header");if(b&&!b.dataset.dragReady){b.style.cursor="grab";let I=!1,w=0,$=Number(l.headerOffset||0);const _=ee=>{I=!0,w=ee.clientY||ee.touches?.[0]?.clientY||0,$=Number(l.headerOffset||0),b.style.cursor="grabbing",a.addEventListener("mousemove",K),a.addEventListener("mouseup",Y,{once:!0}),a.addEventListener("touchmove",K,{passive:!1}),a.addEventListener("touchend",Y,{once:!0})},K=ee=>{if(!I)return;const q=(ee.clientY||ee.touches?.[0]?.clientY||0)-w,T=Math.max(0,Math.min(240,$+q));b.style.marginTop=`${T}px`,l.headerOffset=T,ee.preventDefault?.()},Y=()=>{I=!1,b.style.cursor="grab",a.removeEventListener("mousemove",K),a.removeEventListener("touchmove",K)};b.addEventListener("mousedown",_),b.addEventListener("touchstart",_,{passive:!0}),b.dataset.dragReady="true"}}}catch{}es(a),cn(a);const d=a?.querySelector(".quote-preview-pages"),h=_t;let g=18;if(d&&a?.defaultView){const v=a.defaultView.getComputedStyle(d),b=parseFloat(v.rowGap||v.gap||`${g}`);Number.isFinite(b)&&b>=0&&(g=b)}const x=xt,S=c.length?c.length*x+Math.max(0,(c.length-1)*g):x;if(e.dataset.baseWidth=String(h),e.dataset.baseHeight=String(S),e.style.width=`${h}px`,e.style.minWidth=`${h}px`,e.style.height=`${S}px`,e.style.minHeight=`${S}px`,A?.previewFrameWrapper&&!A?.userAdjustedZoom){const v=A.previewFrameWrapper.clientWidth-24;v>0&&v<h?Oe=Math.max(v/h,.3):Oe=1}ba(Oe)}finally{vt()}},{once:!0})}function Bs(e){if(!l)return;const t=e.currentTarget,n=t?.dataset?.sectionId;n&&(t.checked?l.sections.add(n):l.sections.delete(n),pa(l),$t(),Ae())}function Ks(e){if(!l)return;const t=e.currentTarget,n=t?.dataset?.sectionId,a=t?.dataset?.fieldId;if(!n||!a)return;const s=l.context||"reservation",u=l.fields||(l.fields=St(s)),o=os(u,n);t.checked?o.add(a):o.delete(a),pa(l),Ae()}function Hs(e){if(!l)return;const t=e.currentTarget,n=t?.dataset?.sectionId;n&&(mn(l,n),l.sectionExpansions[n]=t.open)}function $t(){if(!A?.toggles||!l)return;const{toggles:e}=A,t=l.fields||{},n=l.context||"reservation";mn(l);const a=Ot(n),s=Vn(n),u=a.map(({id:o,labelKey:c,fallback:d})=>{const h=r(c,d),g=l.sections.has(o),x=s[o]||[],S=rs(l,o),v=x.length?`<div class="quote-toggle-sublist">
          ${x.map(b=>{const I=pn(t,o,b.id),w=g?"":"disabled",$=b.labelKey?r(b.labelKey,b.fallback):b.fallback;return`
              <label class="quote-toggle quote-toggle--field">
                <input type="checkbox" data-field-toggle data-section-id="${o}" data-field-id="${b.id}" ${I?"checked":""} ${w}>
                <span>${i($)}</span>
              </label>
            `}).join("")}
        </div>`:"";return`
      <details class="quote-toggle-group" data-section-group data-section-id="${o}" ${S?"open":""}>
        <summary class="quote-toggle-summary">
          <label class="quote-toggle quote-toggle--section">
            <input type="checkbox" data-section-toggle data-section-id="${o}" ${g?"checked":""}>
            <span>${i(h)}</span>
          </label>
          ${x.length?'<span class="quote-toggle-caret" aria-hidden="true"></span>':""}
        </summary>
        ${v}
      </details>
    `}).join("");e.innerHTML=u,e.querySelectorAll("input[data-section-toggle]").forEach(o=>{o.addEventListener("change",Bs)}),e.querySelectorAll("input[data-field-toggle]").forEach(o=>{o.addEventListener("change",Ks)}),e.querySelectorAll("details[data-section-group]").forEach(o=>{o.addEventListener("toggle",Hs)})}function Qs(){if(A?.modal)return A;const e=document.createElement("div");e.id="reservationQuoteModal",e.className="modal fade quote-preview-modal",e.tabIndex=-1,e.setAttribute("aria-labelledby","reservationQuoteModalLabel"),e.setAttribute("aria-hidden","true"),e.style.display="none",e.innerHTML=`
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="reservationQuoteModalLabel">${i(r("reservations.quote.previewTitle","Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¹Ø±Ø¶ Ø³Ø¹Ø±"))}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="quote-preview-layout">
            <aside class="quote-preview-sidebar">
              <h6>${i(r("reservations.quote.toggleHeading","Ø­Ø¯Ø¯ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø¯ ØªØµØ¯ÙŠØ±Ù‡Ø§"))}</h6>
              <div class="quote-toggle-list" data-quote-toggles></div>
              <div class="quote-meta-info" data-quote-meta></div>
              <div class="quote-terms-editor" data-quote-terms-editor>
                <label class="quote-terms-editor__label" for="quote-terms-input">${i(r("reservations.quote.termsEditor.title","Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø¹Ø§Ù…Ø© (Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„)"))}</label>
                <textarea id="quote-terms-input" class="quote-terms-editor__textarea" rows="6" data-quote-terms-input placeholder="${i(r("reservations.quote.termsEditor.placeholder","Ø§ÙƒØªØ¨ ÙƒÙ„ Ø´Ø±Ø· ÙÙŠ Ø³Ø·Ø± Ù…Ø³ØªÙ‚Ù„"))}"></textarea>
                <button type="button" class="quote-terms-reset" data-quote-terms-reset>${i(r("reservations.quote.termsEditor.reset","Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©"))}</button>
              </div>
            </aside>
            <section class="quote-preview-panel">
              <div class="quote-preview" data-quote-preview></div>
            </section>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-light" data-bs-dismiss="modal">${i(r("reservations.quote.actions.close","Ø¥ØºÙ„Ø§Ù‚"))}</button>
          <button type="button" class="btn btn-primary" data-quote-download>
            ${i(r("reservations.quote.actions.export","ğŸ“„ ØªÙ†Ø²ÙŠÙ„ PDF"))}
          </button>
        </div>
      </div>
    </div>
  `,document.body.appendChild(e);const t=e.querySelector("[data-quote-toggles]"),n=e.querySelector("[data-quote-preview]"),a=e.querySelector("[data-quote-meta]"),s=e.querySelector("[data-quote-terms-input]"),u=e.querySelector("[data-quote-terms-reset]"),o=e.querySelector("[data-quote-download]"),c=e.querySelector(".modal-header"),d=c?.querySelector(".btn-close"),h=Array.from(e.querySelectorAll('[data-bs-dismiss="modal"]')),g=document.createElement("div");g.className="quote-preview-header-actions",c&&c.insertBefore(g,d||null);const x=document.createElement("iframe");x.className="quote-preview-frame",x.setAttribute("title",r("reservations.quote.previewTitle","Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¹Ø±Ø¶ Ø³Ø¹Ø±")),x.setAttribute("loading","lazy"),x.setAttribute("frameborder","0");const S=document.createElement("div");S.className="quote-preview-zoom-controls",S.innerHTML=`
    <button type="button" class="quote-preview-zoom-btn" data-zoom-out title="${i(r("reservations.quote.zoom.out","ØªØµØºÙŠØ±"))}">âˆ’</button>
    <span class="quote-preview-zoom-value" data-zoom-value>100%</span>
    <button type="button" class="quote-preview-zoom-btn" data-zoom-in title="${i(r("reservations.quote.zoom.in","ØªÙƒØ¨ÙŠØ±"))}">+</button>
    <button type="button" class="quote-preview-zoom-btn" data-zoom-reset title="${i(r("reservations.quote.zoom.reset","Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¶Ø¨Ø·"))}">1:1</button>
  `;const v=document.createElement("div");v.className="quote-preview-zoom-controls quote-preview-drag-controls",v.innerHTML=`
    <button type="button" class="quote-preview-zoom-btn" data-block-drag-toggle>${i(r("reservations.quote.drag.enable","ğŸ¯ ÙˆØ¶Ø¹ ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø¨Ù„ÙˆÙƒØ§Øª"))}</button>
    <button type="button" class="quote-preview-zoom-btn" data-block-drag-save disabled>${i(r("reservations.quote.drag.save","ğŸ’¾ ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ÙˆØ§Ø¶Ø¹"))}</button>
    <button type="button" class="quote-preview-zoom-btn" data-block-drag-reset>${i(r("reservations.quote.drag.resetBtn","â†º ØªØµÙÙŠØ± Ø§Ù„Ù…ÙˆØ§Ø¶Ø¹"))}</button>
  `;const b=document.createElement("div");b.className="quote-preview-frame-wrapper",b.appendChild(x),n.innerHTML="";const I=document.createElement("div");I.className="quote-preview-scroll",I.appendChild(b),n.appendChild(I);const w=document.createElement("div");w.className="quote-preview-status",w.setAttribute("role","status"),w.setAttribute("aria-live","polite"),w.hidden=!0,w.innerHTML=`
    <span class="quote-preview-spinner" data-quote-status-spinner aria-hidden="true"></span>
    <span data-quote-status-text>${i(Yn("render"))}</span>
    <button type="button" class="quote-preview-status-action" data-quote-status-action hidden></button>
  `,n.appendChild(w),g.appendChild(S),g.appendChild(v),o?.addEventListener("click",async()=>{if(l){o.disabled=!0;try{await ga()}finally{o.disabled=!1}}});const $=()=>{Jt()||Zt(e)};h.forEach(ee=>{ee?.addEventListener("click",$)}),d&&!h.includes(d)&&d.addEventListener("click",$),e.addEventListener("click",ee=>{Jt()||ee.target===e&&Zt(e)}),A={modal:e,toggles:t,preview:n,previewScroll:I,previewFrameWrapper:b,zoomControls:S,zoomValue:S.querySelector("[data-zoom-value]"),previewFrame:x,meta:a,downloadBtn:o,statusIndicator:w,statusText:w.querySelector("[data-quote-status-text]"),statusSpinner:w.querySelector("[data-quote-status-spinner]"),statusAction:w.querySelector("[data-quote-status-action]"),termsInput:s,termsReset:u,statusKind:null,userAdjustedZoom:!1,blockDragToggle:v.querySelector("[data-block-drag-toggle]"),blockDragSave:v.querySelector("[data-block-drag-save]"),blockDragReset:v.querySelector("[data-block-drag-reset]")};const _=S.querySelector("[data-zoom-out]"),K=S.querySelector("[data-zoom-in]"),Y=S.querySelector("[data-zoom-reset]");return _?.addEventListener("click",()=>Pn(-.1)),K?.addEventListener("click",()=>Pn(.1)),Y?.addEventListener("click",()=>Lt(1,{markManual:!0})),A.blockDragToggle?.addEventListener("click",()=>Xa(!mt)),A.blockDragSave?.addEventListener("click",Ja),A.blockDragReset?.addEventListener("click",Za),Bt(),s&&s.addEventListener("input",zs),u&&u.addEventListener("click",Us),Lt(Oe),A}function Lt(e,{silent:t=!1,markManual:n=!1}={}){Oe=Math.min(Math.max(e,.25),2.2),n&&A&&(A.userAdjustedZoom=!0),ba(Oe),!t&&A?.zoomValue&&(A.zoomValue.textContent=`${Math.round(Oe*100)}%`)}function Pn(e){Lt(Oe+e,{markManual:!0})}function ba(e){if(!A?.previewFrame||!A.previewFrameWrapper)return;const t=A.previewFrame,n=A.previewFrameWrapper,a=Number(t.dataset.baseWidth)||794,s=Number(t.dataset.baseHeight)||t.contentDocument?.body?.scrollHeight||1123;t.style.transform=`scale(${e})`,t.style.transformOrigin="top center",fn()?(n.style.width="100%",n.style.maxWidth="100%",n.style.minWidth="0"):(n.style.width=`${a}px`,n.style.maxWidth=`${a}px`,n.style.minWidth=`${a}px`),n.style.minHeight=`${s}px`,n.style.height=`${s}px`}function Tt(){if(!A?.meta||!l)return;const{meta:e}=A;(l.context||"reservation")==="reservationChecklist"?e.innerHTML=`
      <div class="quote-meta-card">
        <div><span>${i(r("reservations.quote.labels.dateGregorian","Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ"))}</span><strong>${i(l.quoteDateLabel)}</strong></div>
      </div>
    `:e.innerHTML=`
      <div class="quote-meta-card">
        <div><span>${i(r("reservations.quote.labels.number","Ø±Ù‚Ù… Ø¹Ø±Ø¶ Ø³Ø¹Ø±"))}</span><strong>${i(l.quoteNumber)}</strong></div>
        <div><span>${i(r("reservations.quote.labels.dateGregorian","Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ"))}</span><strong>${i(l.quoteDateLabel)}</strong></div>
      </div>
    `}function qn(){if(!A?.termsInput)return;const e=(l?.terms&&l.terms.length?l.terms:Ie).join(`
`);A.termsInput.value!==e&&(A.termsInput.value=e)}function zs(e){if(!l)return;const t=Wt(e?.target?.value??"");if(t.length){l.terms=t;const n=document.getElementById("reservation-terms");n&&(n.value=e.target.value);const a=document.getElementById("edit-res-terms");a&&(a.value=e.target.value)}else{l.terms=[...Ie],qn();const n=Ie.join(`
`),a=document.getElementById("reservation-terms");a&&(a.value=n);const s=document.getElementById("edit-res-terms");s&&(s.value=n)}Ae()}function Us(e){if(e?.preventDefault?.(),!l)return;l.terms=[...Ie];const t=document.getElementById("reservation-terms");t&&(t.value=Ie.join(`
`));const n=document.getElementById("edit-res-terms");n&&(n.value=Ie.join(`
`)),qn(),Ae()}async function ga(){if(!l)return;nt("export");const t=!fn()&&ra(),n=Ht(),a=null,s=!n&&t?window.open("","_blank"):null;(d=>{if(d)try{d.document.open(),d.document.write(`<!DOCTYPE html><html lang="ar" dir="rtl"><head><meta charset="utf-8"><title>${i(r("reservations.quote.status.exporting","Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ù…Ù„Ù PDF..."))}</title><style>body{font-family:'Tajawal',sans-serif;margin:0;height:100vh;display:flex;align-items:center;justify-content:center;background:#0f172a;color:#f8fafc;text-align:center;padding:24px;} .loader{width:42px;height:42px;border-radius:50%;border:4px solid rgba(248,250,252,0.35);border-top-color:#38bdf8;animation:spin 1s linear infinite;margin:0 auto 18px;}@keyframes spin{to{transform:rotate(360deg);}} h1{margin:0 0 6px;font-size:1.05rem;} p{margin:0;font-size:0.9rem;opacity:0.8;}</style></head><body><div><div class="loader" aria-hidden="true"></div><h1>${i(r("reservations.quote.status.exporting","Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ù…Ù„Ù PDF..."))}</h1><p>${i(r("reservations.quote.status.exportingHint","Ù‚Ø¯ ÙŠØ³ØªØºØ±Ù‚ Ø°Ù„Ùƒ Ø¨Ø¶Ø¹ Ø«ÙˆØ§Ù†ÙØŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±..."))}</p></div></body></html>`),d.document.close()}catch(h){ze("failed to prime download window",h)}})(s);let o=null;const c=r("reservations.quote.errors.browserLimit","ØªØ¹Ø°Ø± Ø¥ØªÙ…Ø§Ù… Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ø³Ø¨Ø¨ Ù‚ÙŠÙˆØ¯ Ø§Ù„Ù…ØªØµÙØ­ØŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø£Ùˆ ØªÙ‚Ù„ÙŠÙ„ Ø­Ø¬Ù… Ø§Ù„Ù…Ø­ØªÙˆÙ‰.");try{await ks(),Vt("html2pdf ensured");const d=l.context||"reservation",h=fa({context:d,reservation:l.reservation,customer:l.customer,project:l.project,crewAssignments:l.crewAssignments,totals:l.totals,totalsDisplay:l.totalsDisplay,rentalDays:l.rentalDays,currencyLabel:l.currencyLabel,sections:l.sections,fieldSelections:l.fields,quoteNumber:l.quoteNumber,quoteDate:l.quoteDateLabel,terms:l.terms,checklistType:l.checklistType,checklistNotes:l.checklistNotes,checklistNotesTitle:l.checklistNotesTitle,hideLogo:!!l.hideLogo,hideCompany:!!l.hideCompany,headerOffset:Number(l.headerOffset||0),projectCrew:l.projectCrew,projectExpenses:l.projectExpenses,projectEquipment:l.projectEquipment,projectInfo:l.projectInfo,clientInfo:l.clientInfo,paymentSummary:l.paymentSummary,projectTotals:l.projectTotals});o=document.createElement("div"),o.innerHTML=h,Object.assign(o.style,{position:"fixed",top:"0",left:"0",pointerEvents:"none",zIndex:"-1"}),document.body.appendChild(o),Bn(o),Kn(o),Hn(o),Vt("export container prepared");const g=o.firstElementChild;if(g){try{const S=typeof re=="function"?re():g.getAttribute("data-lang")||"ar",b=l?.context==="reservationChecklist"&&S==="en"?"ltr":"rtl";g.setAttribute("dir",b),g.style.direction=b,g.setAttribute("data-lang",S),g.style.textAlign=""}catch{}g.setAttribute("data-theme","light"),g.classList.remove("dark","dark-mode"),g.style.margin="0",g.style.padding="0",g.style.width="210mm",g.style.maxWidth="210mm",g.style.marginLeft="auto",g.style.marginRight="auto",g.scrollTop=0,g.scrollLeft=0;try{await Dt(g,{context:"export"}),await ya(120),ha(g)&&await Dt(g,{context:"export"}),await qt(g),wn(g),Vt("layout complete for export document")}catch(S){en(S,"layoutQuoteDocument",{suppressToast:!0})}}const x=d==="reservationChecklist"?(()=>{const S=l?.reservation?.reservationCode||l?.reservation?.reservationId||l?.reservation?.id||"res",v=l?.checklistType==="crew"?"crew":l?.checklistType==="both"?"equipment-crew":"equipment";return`checklist-${String(S)}-${v}.pdf`})():`quotation-${l.quoteNumber}.pdf`;await Os(g,{filename:x,safariWindowRef:s,mobileWindowRef:a})}catch(d){tn({container:o,safariWindowRef:s,mobileWindowRef:a}),o=null,en(d,"exportQuoteAsPdf",{toastMessage:c})}finally{o&&o.parentNode&&o.parentNode.removeChild(o),vt()}}function Sn(){const e=Qs();if(e?.modal){if(gt=!1,Oe=1,A&&(A.userAdjustedZoom=!1),Lt(Oe,{silent:!0}),l?.context==="reservationChecklist")try{const t=e.modal.querySelector("#reservationQuoteModalLabel"),n=e.modal.querySelector(".quote-preview-sidebar"),a=e.modal.querySelector("[data-quote-terms-editor]");a&&(a.style.display="none");let s=n.querySelector("[data-checklist-controls]");if(!s){s=document.createElement("div"),s.setAttribute("data-checklist-controls","");const u=i(r("reservations.checklist.controls.items","Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª")),o=i(r("reservations.checklist.controls.crew","Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ")),c=i(r("reservations.checklist.controls.both","Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙˆØ§Ù„Ø·Ø§Ù‚Ù… Ø§Ù„ÙÙ†ÙŠ")),d=i(r("reservations.checklist.controls.hideLogo","Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø´Ø¹Ø§Ø±")),h=i(r("reservations.checklist.controls.hideCompany","Ø¥Ø®ÙØ§Ø¡ Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©")),g=i(r("reservations.checklist.controls.notes.title","Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù„Ø³ØªØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)")),x=i(r("reservations.checklist.controls.notes.placeholder","Ø§ÙƒØªØ¨ Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø®Ø§ØµØ© Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ù„Ø³ØªØ©")),S=typeof re=="function"?re():"ar",v=i(S==="en"?r("language.toggle.labelAr","ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"):r("language.toggle.labelEn","ğŸ‡¬ğŸ‡§ English"));s.innerHTML=`
          <div class="quote-meta-card" style="margin-bottom:10px">
            <div style="display:flex;gap:10px;flex-wrap:wrap">
              <label style="display:flex;align-items:center;gap:6px">
                <input type="radio" name="checklist-type" value="items" checked>
                <span data-i18n data-i18n-key="reservations.checklist.controls.items">${u}</span>
              </label>
              <label style="display:flex;align-items:center;gap:6px">
                <input type="radio" name="checklist-type" value="crew">
                <span data-i18n data-i18n-key="reservations.checklist.controls.crew">${o}</span>
              </label>
              <label style="display:flex;align-items:center;gap:6px">
                <input type="radio" name="checklist-type" value="both">
                <span data-i18n data-i18n-key="reservations.checklist.controls.both">${c}</span>
              </label>
            </div>
          </div>
          <div class="quote-meta-card" style="margin-bottom:10px">
            <div style="display:flex;gap:8px;flex-wrap:wrap">
              <button type="button" class="btn btn-sm btn-light" data-checklist-lang>${v}</button>
              <label style="display:flex;align-items:center;gap:6px">
                <input type="checkbox" data-checklist-hide-logo>
                <span data-i18n data-i18n-key="reservations.checklist.controls.hideLogo">${d}</span>
              </label>
              <label style="display:flex;align-items:center;gap:6px">
                <input type="checkbox" data-checklist-hide-company>
                <span data-i18n data-i18n-key="reservations.checklist.controls.hideCompany">${h}</span>
              </label>
            </div>
          </div>
          <div class="quote-terms-editor" data-checklist-notes>
            <label class="quote-terms-editor__label" for="checklist-notes-title-input" data-i18n data-i18n-key="reservations.checklist.controls.notes.titleLabel">${i(r("reservations.checklist.controls.notes.titleLabel","Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª"))}</label>
            <input id="checklist-notes-title-input" class="quote-terms-editor__input" type="text" value="${i(r("reservations.checklist.controls.notes.sectionTitleDefault","Ù…Ù„Ø§Ø­Ø¸Ø§Øª"))}" data-i18n-value-key="reservations.checklist.controls.notes.sectionTitleDefault">
            <label class="quote-terms-editor__label" for="checklist-notes-input" data-i18n data-i18n-key="reservations.checklist.controls.notes.title">${g}</label>
            <textarea id="checklist-notes-input" class="quote-terms-editor__textarea" rows="4" data-i18n-placeholder-key="reservations.checklist.controls.notes.placeholder" placeholder="${x}"></textarea>
          </div>
        `,n.prepend(s),s.querySelectorAll('input[name="checklist-type"]').forEach(f=>{f.addEventListener("change",()=>{const q=s.querySelector('input[name="checklist-type"]:checked')?.value||"items";l.checklistType=q==="crew"||q==="both"?q:"items";const T=new Set(["customerInfo","reservationInfo","projectInfo","notes"]);if(l.checklistType==="crew"?T.add("crew"):l.checklistType==="both"?(T.add("items"),T.add("crew")):T.add("items"),l.sections=T,t){const P=re?.()||"ar",U=l.checklistType==="crew"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ":l.checklistType==="both"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙˆØ§Ù„Ø·Ø§Ù‚Ù… Ø§Ù„ÙÙ†ÙŠ":"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",C=l.checklistType==="crew"?"Crew List":l.checklistType==="both"?"Equipment & Crew List":"Equipment List";t.textContent=P==="en"?C:U}$t(),Tt(),Ae()})});const I=s.querySelector("#checklist-notes-input"),w=s.querySelector("#checklist-notes-title-input"),$=()=>{try{const f=re?.()||"ar",q=f==="en"?"ltr":"rtl",T=f==="en"?"left":"right";I&&(I.setAttribute("dir",q),I.style.textAlign=T),w&&(w.setAttribute("dir",q),w.style.textAlign=T)}catch{}};$();try{const f=()=>$();document.addEventListener("language:changed",f),s._onLangChanged=f}catch{}I.addEventListener("input",f=>{l.checklistNotes=String(f.target.value||""),Ae()}),w.addEventListener("input",f=>{l.checklistNotesTitle=String(f.target.value||""),Ae()});const _=s.querySelector("[data-checklist-lang]");if(_){const f=()=>{const q=re?.()||"ar";_.textContent=q==="ar"?"ğŸ‡¬ğŸ‡§ English":"ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"};f(),_.addEventListener("click",()=>{const T=(re?.()||"ar")==="ar"?"en":"ar";try{Sa?.(T)}catch{}if(f(),$(),t){const P=re?.()||"ar",U=l.checklistType,C=U==="crew"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ":U==="both"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙˆØ§Ù„Ø·Ø§Ù‚Ù… Ø§Ù„ÙÙ†ÙŠ":"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",le=U==="crew"?"Crew List":U==="both"?"Equipment & Crew List":"Equipment List";t.textContent=P==="en"?le:C}$t(),Tt(),Ae()})}const K=s.querySelector("[data-checklist-hide-logo]"),Y=s.querySelector("[data-checklist-hide-company]");(()=>{K&&(K.checked=!!l.hideLogo),Y&&(Y.checked=!!l.hideCompany)})(),K?.addEventListener("change",f=>{l.hideLogo=!!f.target.checked,Ae()}),Y?.addEventListener("change",f=>{l.hideCompany=!!f.target.checked,Ae()})}t&&(t.textContent=l.checklistType==="crew"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ":"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª");try{e.previewFrame?.setAttribute("title","Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù„Ø³ØªØ©")}catch{}}catch{}$t(),Tt(),qn(),Ae(),as(e.modal)}}async function to({reservation:e,customer:t,project:n}){if(!e){ut(r("reservations.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø²"));return}await vn();const a=Qt(e),{totalsDisplay:s,totals:u,rentalDays:o}=gn(e,a,n),c=r("reservations.create.summary.currency","SR"),h=(v=>{if(!v)return"1";const I=[v.reservationCode,v.reservation_code,v.reservationId,v.reservation_id,v.id].find(_=>_!=null&&String(_).trim()!==""),w=N(String(I??"1"));return w.replace(/\D+/g,"")||w||"1"})(e),g=Number.parseInt(h,10)||1,x=new Date,S=Ra();l={context:"reservation",reservation:e,customer:t,project:n,crewAssignments:a,totals:u,totalsDisplay:s,rentalDays:o,currencyLabel:c,projectCrew:[],projectExpenses:[],projectEquipment:[],sections:new Set(Ot("reservation").filter(v=>v.defaultSelected).map(v=>v.id)),sectionExpansions:Kt("reservation"),fields:St("reservation"),terms:S,quoteSequence:g,quoteNumber:h,quoteDate:x,quoteDateLabel:bn(x),sequenceCommitted:!1},hn(l),ln(l),Sn();try{sn()}catch{}}async function no({reservation:e,customer:t,project:n}){if(!e){ut(r("reservations.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø²"));return}await vn();const a=Qt(e),{totalsDisplay:s,totals:u,rentalDays:o}=gn(e,a,n),c=r("reservations.create.summary.currency","SR"),d=new Date;l={context:"reservationChecklist",reservation:e,customer:t,project:n,crewAssignments:a,totals:u,totalsDisplay:s,rentalDays:o,currencyLabel:c,checklistType:"items",checklistNotes:"",projectCrew:[],projectExpenses:[],projectEquipment:[],sections:new Set(["customerInfo","reservationInfo","projectInfo","notes","items"]),sectionExpansions:Kt("reservationChecklist"),fields:St("reservationChecklist"),terms:[],quoteDate:d,quoteDateLabel:bn(d),sequenceCommitted:!1},hn(l),ln(l),Sn();try{sn()}catch{}}async function ao({project:e}){if(!e){ut(r("projects.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"));return}await vn();let t=In(e);const{project:n}=t;if(!n){ut(r("projects.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"));return}try{(!Array.isArray(t.equipmentItems)||t.equipmentItems.length===0)&&n?.id!=null&&(await _a({project_id:n.id}),t=In(n))}catch(d){console.warn("[reservationPdf] refreshReservationsForProject failed, proceeding with snapshot/state",d)}const s=(d=>{if(!d)return"1";const g=[d.projectCode,d.project_code,d.code,d.id].find(v=>v!=null&&String(v).trim()!==""),x=N(String(g??"1"));return x.replace(/\D+/g,"")||x||"1"})(n),u=Number.parseInt(s,10)||1,o=new Date,c=[...Ma];l={context:"project",reservation:null,customer:t.customer,project:n,technicians:t.crew||[],clientInfo:t.clientInfo,projectInfo:t.projectInfo,projectCrew:t.crew,projectExpenses:t.expenses,projectEquipment:t.equipment,equipmentItems:t.equipmentItems||[],crewAssignments:t.crewAssignments||[],totals:t.totals,projectTotals:t.projectTotals,totalsDisplay:t.totalsDisplay,rentalDays:t.projectDurationDays,currencyLabel:t.currencyLabel,sections:new Set(Ot("project").filter(d=>d.defaultSelected).map(d=>d.id)),sectionExpansions:Kt("project"),fields:St("project"),terms:c,quoteSequence:u,quoteNumber:s,quoteDate:o,quoteDateLabel:bn(o),sequenceCommitted:!1,paymentSummary:t.paymentSummary,projectNotes:t.notes,paymentHistory:t.paymentHistory},hn(l),ln(l),Sn();try{sn()}catch{}}export{to as a,no as b,ao as e,Zs as g,Qn as r,eo as s};
