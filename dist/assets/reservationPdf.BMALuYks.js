import{n as E,j as at,t as i,d as Yt,b as Js,h as Zs,p as ce,B as eo,y as bt,C as ts}from"./auth.Bt1KphMA.js";import{n as to,v as Ct,t as Mt,a as no,b as gn,d as ns,H as ss,g as os,r as so,c as oo,e as ao,h as ro}from"./reservationsService.CU7qTLqY.js";import{s as io,i as gt,j as Bn,I as as,O as rs}from"./state.CY6GwEtX.js";import{h as lo}from"./view.UKoVu_6y.js";import{q as co}from"./quotePdf.AGxGu8-w.js";import{s as is,a as ls,e as cs,p as uo}from"./canvasColorUtils.CviLtv6S.js";function us(e){const t=new Date;if(t.setHours(0,0,0,0),e==="today")return{startDate:ct(t),endDate:ct(t)};if(e==="week"){const n=new Date(t),s=n.getDay(),o=s===0?6:s-1;n.setDate(n.getDate()-o);const c=new Date(n);return c.setDate(n.getDate()+6),{startDate:ct(n),endDate:ct(c)}}if(e==="month"){const n=new Date(t.getFullYear(),t.getMonth(),1),s=new Date(t.getFullYear(),t.getMonth()+1,0);return{startDate:ct(n),endDate:ct(s)}}return e==="upcoming"?{startDate:ct(t),endDate:""}:{startDate:"",endDate:""}}function za(){const e=document.getElementById("search-reservation"),t=document.getElementById("filter-start-date"),n=document.getElementById("filter-end-date"),s=document.getElementById("reservation-date-range"),o=document.getElementById("reservation-status-filter");let c=E(t?.value||"").trim(),r=E(n?.value||"").trim(),u=s?.value||"";if(new Set(["","today","week","month"]).has(u)||(u="",s&&(s.value=""),Rt(t),Rt(n),c="",r=""),!c&&!r&&u){const h=us(u);c=h.startDate,r=h.endDate}return{searchTerm:to(e?.value||""),startDate:c,endDate:r,status:o?.value||"",quickRange:u}}function Qa(e){const t=()=>{typeof e=="function"&&e()},n=document.getElementById("search-reservation");n&&!n.dataset.listenerAttached&&(n.addEventListener("input",()=>{n.value=E(n.value),t()}),n.dataset.listenerAttached="true");const s=document.getElementById("filter-start-date");s&&!s.dataset.listenerAttached&&(s.addEventListener("change",()=>{const d=document.getElementById("reservation-date-range");d&&(d.value=""),t()}),s.dataset.listenerAttached="true");const o=document.getElementById("filter-end-date");o&&!o.dataset.listenerAttached&&(o.addEventListener("change",()=>{const d=document.getElementById("reservation-date-range");d&&(d.value=""),t()}),o.dataset.listenerAttached="true");const c=document.getElementById("reservation-date-range");c&&!c.dataset.listenerAttached&&(c.addEventListener("change",()=>{po(c.value),t()}),c.dataset.listenerAttached="true");const r=document.getElementById("reservation-status-filter");r&&!r.dataset.listenerAttached&&(r.addEventListener("change",t),r.dataset.listenerAttached="true");const u=document.getElementById("clear-filters");u&&!u.dataset.listenerAttached&&(u.addEventListener("click",()=>{n&&(n.value=""),Rt(s),Rt(o),c&&(c.value=""),r&&(r.value=""),t()}),u.dataset.listenerAttached="true")}function po(e){const t=document.getElementById("filter-start-date"),n=document.getElementById("filter-end-date");if(!t||!n)return;const{startDate:s,endDate:o}=us(e);t._flatpickr?s?t._flatpickr.setDate(s,!1,"Y-m-d"):t._flatpickr.clear():t.value=s,n._flatpickr?o?n._flatpickr.setDate(o,!1,"Y-m-d"):n._flatpickr.clear():n.value=o}function ct(e){if(!e)return"";const t=e.getTimezoneOffset()*6e4;return new Date(e.getTime()-t).toISOString().split("T")[0]}function Rt(e){e&&(e._flatpickr&&e._flatpickr.clear(),e.value="")}const fo=""+new URL("Tajawal-400.ttf",import.meta.url).href,mo=""+new URL("Tajawal-500.ttf",import.meta.url).href,Kn=""+new URL("Tajawal-700.ttf",import.meta.url).href,yo="reservations.quote.sequence",Hn={reservation:"reservations.quote.togglePrefs.v1",project:"projects.quote.togglePrefs.v1",reservationChecklist:"reservations.checklist.togglePrefs.v1"},ds="https://help.artratio.sa/guide/quote-preview",ve={logoUrl:"https://art-ratio.sirv.com/AR-Logo-v3.5-curved.png",companyName:"Ø´Ø±ÙƒØ© ÙÙˆØ¯ Ø¢Ø±Øª Ù„Ù„Ø¯Ø¹Ø§ÙŠØ© ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù† (Ø´Ø±ÙƒØ© Ø´Ø®Øµ ÙˆØ§Ø­Ø¯)",commercialRegistry:"4030485240",beneficiaryName:"Ø´Ø±ÙƒØ© ÙÙˆØ¯ Ø¢Ø±Øª Ù„Ù„Ø¯Ø¹Ø§ÙŠØ© ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù† (Ø´Ø±ÙƒØ© Ø´Ø®Øµ ÙˆØ§Ø­Ø¯)",bankName:"Ù…ØµØ±Ù Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠ",accountNumber:"Ù£Ù¥Ù¨Ù Ù Ù Ù Ù¡Ù Ù Ù Ù¦Ù Ù¨Ù¦Ù Ù¦Ù¥Ù§Ù Ù¦",iban:"SA1680000358608016065706",approvalNote:"Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø±Ø¶ ØªØ¹ØªØ¨Ø± Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…."},ho=["ÙŠÙˆÙ… Ø§Ù„Ø¹Ù…Ù„ Ù‡Ùˆ 12 Ø³Ø§Ø¹Ø©ØŒ ÙˆÙŠØªÙ… Ø§Ø­ØªØ³Ø§Ø¨ Ù†ØµÙ ÙŠÙˆÙ… Ø¥Ø¶Ø§ÙÙŠ Ø¨Ø¹Ø¯ 20 Ø³Ø§Ø¹Ø©ØŒ Ø«Ù… ÙŠÙˆÙ… ÙƒØ§Ù…Ù„ Ø¨Ø¹Ø¯ Ø°Ù„Ùƒ.","ÙŠÙ…Ù†Ø¹ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙÙŠ Ø£Ù†Ø´Ø·Ø© ØºÙŠØ± Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©.","ÙŠØªØ­Ù…Ù„ Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø± Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© Ø£ÙŠ ØªÙ„Ù Ø£Ùˆ ÙÙ‚Ø¯Ø§Ù†.","ÙŠØ¬Ø¨ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙÙŠ Ø­Ø§Ù„ØªÙ‡Ø§ Ø§Ù„Ø£ØµÙ„ÙŠØ©.","ÙŠØªÙ… ÙØ±Ø¶ Ø±Ø³ÙˆÙ… Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ù„ØºØ§Ø¡ Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ù‚Ø¨Ù„ 24 Ø³Ø§Ø¹Ø©."],Ee=[...ho],bo=["ÙŠØªÙ… Ø¯ÙØ¹ 50% Ù…Ù† Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø±ØŒ ÙˆÙŠØªÙ… Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø§Ù„Ù€ 50% Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ.","ÙŠØ­ØµÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¹Ù„Ù‰ Ø­Ù‚ÙˆÙ‚ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© ÙÙŠ Ø£ÙŠ Ù…ÙƒØ§Ù† ÙŠØ±Ø§Ù‡ Ù…Ù†Ø§Ø³Ø¨Ø§Ù‹ØŒ Ø¨ÙŠÙ†Ù…Ø§ ØªØ­ØªÙØ¸ Ø§Ù„Ø´Ø±ÙƒØ© Ø¨Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø®Ø§Ù… ÙˆÙ„Ø§ ØªØ³ØªØ®Ø¯Ù…Ù‡Ø§ Ø¥Ù„Ø§ Ø¨Ø¹Ø¯ Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ø§ Ù„Ù… ÙŠÙØªÙÙ‚ Ø¹Ù„Ù‰ ØºÙŠØ± Ø°Ù„Ùƒ.","ÙŠØªÙ… Ø§Ù„Ø§ØªÙØ§Ù‚ Ø¹Ù„Ù‰ Ø¬Ø¯ÙˆÙ„ Ø²Ù…Ù†ÙŠ Ù„Ù„ØªÙ†ÙÙŠØ°ØŒ ÙˆØ£ÙŠ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ø®Ø§Ø±Ø¬ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ù…ØªÙÙ‚ Ø¹Ù„ÙŠÙ‡ ØªØ®Ø¶Ø¹ Ù„Ø±Ø³ÙˆÙ… Ø¥Ø¶Ø§ÙÙŠØ©.","Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù† ØªÙˆÙÙŠØ± Ø§Ù„ØªØµØ§Ø±ÙŠØ­ Ø§Ù„Ù„Ø§Ø²Ù…Ø© Ù„Ù„ØªØµÙˆÙŠØ± ÙÙŠ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©ØŒ ÙˆØ£ÙŠ ØªØ£Ø®ÙŠØ± Ù†Ø§ØªØ¬ Ø¹Ù† Ø°Ù„Ùƒ Ù‚Ø¯ ÙŠØ¤Ø«Ø± Ø¹Ù„Ù‰ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„ØªØ³Ù„ÙŠÙ….","ØªÙØ­ÙÙŽØ¸ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ù„Ù„Ù…Ø´Ø±ÙˆØ¹ Ù„Ù…Ø¯Ø© 12 Ø´Ù‡Ø±Ø§Ù‹ ÙÙŠ Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ø´Ø±ÙƒØ©ØŒ ÙˆÙŠÙ…ÙƒÙ† Ù„Ù„Ø¹Ù…ÙŠÙ„ Ø·Ù„Ø¨ Ù†Ø³Ø® Ø¥Ø¶Ø§ÙÙŠØ© Ø®Ù„Ø§Ù„ ØªÙ„Ùƒ Ø§Ù„ÙØªØ±Ø©.","ÙŠØªØ­Ù…Ù‘Ù„ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© ØªÙˆÙÙŠØ± Ø¨ÙŠØ¦Ø© Ø¹Ù…Ù„ Ø¢Ù…Ù†Ø© Ù„Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ ÙˆØ§Ù„Ù…Ø¹Ø¯Ø§Øª ÙÙŠ Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªØµÙˆÙŠØ±ØŒ ÙˆÙŠØ¶Ù…Ù† Ø§ØªØ®Ø§Ø° ÙƒØ§ÙØ© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·Ø§Øª Ø§Ù„Ù„Ø§Ø²Ù…Ø© Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø³Ù„Ø§Ù…ØªÙ‡Ù…."];function un(e){return e?e.split(/\r?\n/).map(t=>t.trim()).filter(t=>t.length>0):[...Ee]}function go(){const e=document.getElementById("reservation-terms");if(e&&e.value.trim().length>0){const s=un(e.value);if(s.length)return s}const t=document.getElementById("edit-res-terms");if(t&&t.value.trim().length>0){const s=un(t.value);if(s.length)return s}const n=Ee.join(`
`);return e&&e.value.trim().length===0&&(e.value=n),t&&t.value.trim().length===0&&(t.value=n),[...Ee]}const vo=[{id:"customerInfo",labelKey:"reservations.quote.sections.customer",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„",defaultSelected:!0},{id:"reservationInfo",labelKey:"reservations.quote.sections.reservation",fallback:"ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²",defaultSelected:!0},{id:"projectInfo",labelKey:"reservations.quote.sections.project",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",defaultSelected:!0},{id:"financialSummary",labelKey:"reservations.quote.sections.financial",fallback:"Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ",defaultSelected:!0},{id:"items",labelKey:"reservations.quote.sections.items",fallback:"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",defaultSelected:!0},{id:"crew",labelKey:"reservations.quote.sections.crew",fallback:"Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„",defaultSelected:!0},{id:"notes",labelKey:"reservations.quote.sections.notes",fallback:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø­Ø¬Ø²",defaultSelected:!0},{id:"payment",labelKey:"reservations.quote.sections.payment",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹",defaultSelected:!1}],Xt=[{id:"rowNumber",labelKey:null,fallback:"#",render:(e,t)=>l(E(String(t+1)))},{id:"code",labelKey:"reservations.details.table.headers.code",fallback:"Ø§Ù„ÙƒÙˆØ¯",render:e=>{if(e?.isPackage){const t=e?.packageCodeResolved||e?.barcode||"";return l(t||"-")}return l(e?.barcode||"-")}},{id:"description",labelKey:"reservations.details.table.headers.description",fallback:"Ø§Ù„ÙˆØµÙ",render:e=>{const t=String(e?.desc||e?.description||"-");return`<div class="quote-cell quote-cell--desc">${l(t)}</div>`}},{id:"quantity",labelKey:"reservations.details.table.headers.quantity",fallback:"Ø§Ù„ÙƒÙ…ÙŠØ©",render:e=>l(E(String(e?.qty||1)))},{id:"unitPrice",labelKey:"reservations.quote.columns.unitPrice",fallback:"Ù„ÙƒÙ„ ÙŠÙˆÙ…",render:e=>l(E(Number(e?.unitPriceValue||0).toFixed(2)))},{id:"price",labelKey:"reservations.quote.columns.total",fallback:"Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹",render:e=>l(E(Number(e?.price||0).toFixed(2)))}],Jt=[{id:"rowNumber",labelKey:null,fallback:"#",render:(e,t)=>l(E(String(t+1)))},{id:"position",labelKey:"reservations.details.crew.position",fallback:"Ø§Ù„Ù…Ù†ØµØ¨",render:e=>{const t=typeof ce=="function"?ce():"ar",n=e?.positionLabelEn??e?.position_label_en??e?.position_name_en??e?.positionLabelAlt??e?.position_label_alt??e?.role,s=e?.positionLabel??e?.position_name??e?.role??i("reservations.crew.positionFallback","Ù…Ù†ØµØ¨ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…");return l(E(String(t==="en"&&n?n:s)))}},{id:"unitPrice",labelKey:"reservations.quote.columns.unitPrice",fallback:"Ù„ÙƒÙ„ ÙŠÙˆÙ…",render:e=>{const t=Number.isFinite(Number(e?.positionClientPrice))?Number(e.positionClientPrice):0;return l(`${E(t.toFixed(2))} ${i("reservations.create.summary.currency","SR")}`)}},{id:"price",labelKey:"reservations.quote.columns.total",fallback:"Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹",render:e=>{const t=Number.isFinite(Number(e?.positionClientPrice))?Number(e.positionClientPrice):0;return l(`${E(t.toFixed(2))} ${i("reservations.create.summary.currency","SR")}`)}}],nt={customerInfo:[{id:"customerName",labelKey:"reservations.details.labels.customer",fallback:"Ø§Ù„Ø¹Ù…ÙŠÙ„"},{id:"customerCompany",labelKey:"reservations.details.labels.company",fallback:"Ø§Ù„Ø´Ø±ÙƒØ©"},{id:"customerPhone",labelKey:"reservations.details.labels.phone",fallback:"Ø§Ù„Ù‡Ø§ØªÙ"},{id:"customerEmail",labelKey:"reservations.details.labels.email",fallback:"Ø§Ù„Ø¨Ø±ÙŠØ¯"}],reservationInfo:[{id:"reservationId",labelKey:"reservations.details.labels.reservationId",fallback:"Ø±Ù‚Ù… Ø§Ù„Ø­Ø¬Ø²"},{id:"reservationStart",labelKey:"reservations.details.labels.start",fallback:"Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø­Ø¬Ø²"},{id:"reservationEnd",labelKey:"reservations.details.labels.end",fallback:"Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø­Ø¬Ø²"},{id:"reservationDuration",labelKey:"reservations.details.labels.duration",fallback:"Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…"}],projectInfo:[{id:"projectTitle",labelKey:"reservations.details.labels.project",fallback:"Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectCode",labelKey:"reservations.details.labels.code",fallback:"Ø§Ù„Ø±Ù…Ø²"}],financialSummary:[{id:"discountAmount",labelKey:"reservations.details.labels.discount",fallback:"Ø§Ù„Ø®ØµÙ…"},{id:"subtotalBeforeTax",labelKey:"reservations.details.labels.subtotalBeforeTax",fallback:"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"},{id:"taxAmount",labelKey:"reservations.details.labels.tax",fallback:"Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"},{id:"finalTotal",labelKey:"reservations.details.labels.total",fallback:"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ"}],payment:[{id:"beneficiary",labelKey:"reservations.quote.labels.beneficiary",fallback:"Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙÙŠØ¯"},{id:"bank",labelKey:"reservations.quote.labels.bank",fallback:"Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ"},{id:"account",labelKey:"reservations.quote.labels.account",fallback:"Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨"},{id:"iban",labelKey:"reservations.quote.labels.iban",fallback:"Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ¨Ø§Ù†"}],items:[...Xt.map(({id:e,labelKey:t,fallback:n})=>({id:e,labelKey:t,fallback:n})),{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…"},{id:"equipmentSubtotal",labelKey:"reservations.details.labels.equipmentTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"}],crew:[...Jt.map(({id:e,labelKey:t,fallback:n})=>({id:e,labelKey:t,fallback:n})),{id:"quantity",labelKey:"reservations.details.table.headers.quantity",fallback:"Ø§Ù„ÙƒÙ…ÙŠØ©"},{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…"},{id:"crewSubtotal",labelKey:"reservations.details.labels.crewTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±ÙŠÙ‚"}]},ps=[{id:"rowNumber",labelKey:null,fallback:"#",render:(e,t)=>l(E(String(t+1)))},{id:"label",labelKey:null,fallback:"Ø§Ù„Ø¨Ù†Ø¯",render:e=>l(e?.label||"-")},{id:"amount",labelKey:null,fallback:"Ø§Ù„Ø³Ø¹Ø±",render:e=>{const t=Number.isFinite(Number(e?.salePrice??e?.sale_price))?Number(e?.salePrice??e?.sale_price):Number(e?.amount??0)||0;return l(ne(t,i("reservations.create.summary.currency","SR")))}},{id:"note",labelKey:null,fallback:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª",render:e=>l(e?.note||"-")}],wo=[{id:"customerInfo",labelKey:"projects.quote.sections.customer",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„",defaultSelected:!0},{id:"projectInfo",labelKey:"projects.quote.sections.project",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",defaultSelected:!0},{id:"projectExpenses",labelKey:"projects.quote.sections.expenses",fallback:"Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©",defaultSelected:!0},{id:"projectCrew",labelKey:"projects.quote.sections.crew",fallback:"Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„",defaultSelected:!0},{id:"financialSummary",labelKey:"projects.quote.sections.financial",fallback:"Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ",defaultSelected:!0},{id:"projectEquipment",labelKey:"projects.quote.sections.equipment",fallback:"Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",defaultSelected:!0},{id:"projectNotes",labelKey:"projects.quote.sections.notes",fallback:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",defaultSelected:!0},{id:"payment",labelKey:"reservations.quote.sections.payment",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹",defaultSelected:!1}],qo={customerInfo:nt.customerInfo,projectInfo:[{id:"projectTitle",labelKey:"projects.details.overview.heading",fallback:"Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectCode",labelKey:"projects.details.labels.code",fallback:"Ø±Ù‚Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectType",labelKey:"projects.details.type",fallback:"Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectStart",labelKey:"projects.details.start",fallback:"Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectEnd",labelKey:"projects.details.end",fallback:"Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectDuration",labelKey:"projects.details.duration",fallback:"Ù…Ø¯Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectStatus",labelKey:"projects.details.status",fallback:"Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"}],financialSummary:[{id:"reservationsTotal",labelKey:"projects.details.reservationsTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª"},{id:"discountAmount",labelKey:"projects.details.summary.discount",fallback:"Ø§Ù„Ø®ØµÙ…"},{id:"taxAmount",labelKey:"projects.details.summary.combinedTax",fallback:"Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"},{id:"overallTotal",labelKey:"projects.details.summary.overallTotal",fallback:"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ"}],payment:nt.payment,projectExpenses:[...ps.map(({id:e,labelKey:t,fallback:n})=>({id:e,labelKey:t,fallback:n})),{id:"expensesSubtotal",labelKey:"projects.details.expensesTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©"}],projectCrew:[...Jt.map(({id:e,labelKey:t,fallback:n})=>({id:e,labelKey:t,fallback:n})),{id:"quantity",labelKey:"reservations.details.table.headers.quantity",fallback:"Ø§Ù„ÙƒÙ…ÙŠØ©"},{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…"},{id:"crewSubtotal",labelKey:"reservations.details.labels.crewTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±ÙŠÙ‚"}],projectEquipment:[...Xt.map(({id:e,labelKey:t,fallback:n})=>({id:e,labelKey:t,fallback:n})),{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…"},{id:"equipmentSubtotal",labelKey:"reservations.details.labels.equipmentTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"}],projectNotes:[]},ln=new Map;function Zt(e="reservation"){if(ln.has(e))return ln.get(e);const t=e==="project"?wo:e==="reservationChecklist"?[{id:"customerInfo",labelKey:"reservations.quote.sections.customer",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„",defaultSelected:!0},{id:"reservationInfo",labelKey:"reservations.quote.sections.reservation",fallback:"ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²",defaultSelected:!0},{id:"projectInfo",labelKey:"reservations.quote.sections.project",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",defaultSelected:!0},{id:"notes",labelKey:"reservations.quote.sections.notes",fallback:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø­Ø¬Ø²",defaultSelected:!0},{id:"items",labelKey:"reservations.quote.sections.items",fallback:"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",defaultSelected:!0},{id:"crew",labelKey:"reservations.quote.sections.crew",fallback:"Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„",defaultSelected:!0}]:vo,n=e==="project"?qo:e==="reservationChecklist"?{customerInfo:nt.customerInfo,reservationInfo:nt.reservationInfo,projectInfo:nt.projectInfo,notes:[],items:nt.items,crew:nt.crew}:nt,s=new Set(t.map(({id:r})=>r)),o=Object.fromEntries(Object.entries(n).map(([r,u=[]])=>[r,new Set(u.map(d=>d.id))])),c={sectionDefs:t,fieldDefs:n,sectionIdSet:s,fieldIdMap:o};return ln.set(e,c),c}function en(e="reservation"){return Zt(e).sectionDefs}function fs(e="reservation"){return Zt(e).fieldDefs}function ms(e="reservation"){return Zt(e).sectionIdSet}function ys(e="reservation"){return Zt(e).fieldIdMap}function hs(e){switch(e){case"export":return i("reservations.quote.status.exporting","Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ù…Ù„Ù PDF...");case"render":default:return i("reservations.quote.status.rendering","Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©...")}}const ko="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js",So="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js",Ao="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js",bs=co.trim(),gs=`
@font-face { font-family: 'Tajawal'; font-style: normal; font-weight: 400; font-display: swap; src: url(${JSON.stringify(fo)}) format('truetype'); }
@font-face { font-family: 'Tajawal'; font-style: normal; font-weight: 500; font-display: swap; src: url(${JSON.stringify(mo)}) format('truetype'); }
@font-face { font-family: 'Tajawal'; font-style: normal; font-weight: 600; font-display: swap; src: url(${JSON.stringify(Kn)}) format('truetype'); }
@font-face { font-family: 'Tajawal'; font-style: normal; font-weight: 700; font-display: swap; src: url(${JSON.stringify(Kn)}) format('truetype'); }
`,vs=/^data:image\/svg\+xml/i,_o=/\.svg($|[?#])/i,At=512,dn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/B8AAusB9YwpClgAAAAASUVORK5CYII=",ws=96,qs=25.4,pn=210,It=297,Dt=Math.round(pn/qs*ws),Pt=Math.round(It/qs*ws);function he(e){const t=Number(e),n=Number.isFinite(t)?t:0;try{const s=Math.abs(n%1)>1e-9;return E(n.toLocaleString("en-US",{minimumFractionDigits:s?2:0,maximumFractionDigits:2}))}catch{return Number.isInteger(n)?E(String(n)):E(n.toFixed(2))}}let Bt=!1,Kt=null;function vn(){Bt||(Kt=async function(){try{if(!a||!q?.modal?.classList.contains("show")||(a.context||"reservation")!=="reservation")return;const n=a.reservation;if(!n)return;const s=[n.id,n.reservationId,n.reservation_id,n.reservationCode,n.reservation_code].map(w=>w==null?"":String(w)).filter(w=>w.length>0);if(!s.length)return;const o=os(),c=(Array.isArray(o)?o:[]).find(w=>[w?.id,w?.reservationId,w?.reservation_id,w?.reservationCode,w?.reservation_code].map(j=>j==null?"":String(j)).filter(j=>j.length>0).some(j=>s.includes(j)));if(!c)return;const r=an(c),{totalsDisplay:u,totals:d,rentalDays:h}=Pn(c,r,a.project);a.reservation=c,a.crewAssignments=r,a.totals=d,a.totalsDisplay=u,a.rentalDays=h,a.context==="reservationChecklist"&&$s(),Ot(),we()}catch(t){console.warn("[reservationPdf] live update failed",t)}},document.addEventListener("reservations:changed",Kt),Bt=!0)}function ks(){if(Bt){try{document.removeEventListener("reservations:changed",Kt)}catch{}Kt=null,Bt=!1}}const Ss=2,As=/safari/i,xo=/(iphone|ipad|ipod)/i,zn=/(iphone|ipad|ipod)/i,$o=/(crios|fxios|edgios|opios)/i,Ht="[reservations/pdf]";let q=null,a=null,Be=1,kt=null,St=null,st=null,yt=null,_t=!1;const zt="quoteBlockOffsets",Qn=1800,Qt="quoteInfoAlignments",Co=["customer","reservation","project","projectCustomer","projectDetails"],wn={customer:"left",reservation:"left",project:"left",projectCustomer:"left",projectDetails:"left"},fn={project:{customer:"left",reservation:"left",project:"left",projectCustomer:"left",projectDetails:"left"},reservationChecklist:{customer:"left",reservation:"left",project:"left",projectCustomer:"left",projectDetails:"left"}};let vt=!1,qn=!1,Et=!1;const kn={project:{"project-title":{x:-182.78680419921875,y:-5.0181427001953125},"project-content":{x:-140.1977996826172,y:-4.7384796142578125}}},ut={blockOffsets:"data-block-offsets",infoAlignments:"data-info-alignments",context:"data-quote-source-context"};function _s(e){return E(String(e??"")).trim().toLowerCase()}function xs(e){return e==null?"":E(String(e)).trim().toLowerCase()}function Sn(){const e=Yt()||{},t=Array.isArray(e.equipment)?e.equipment:[],n=new Map,s=new Map;return t.forEach(o=>{if(!o||typeof o!="object")return;[o.id,o.equipment_id,o.equipmentId,o.item_id,o.itemId].forEach(r=>{r==null||r===""||n.set(String(r),o)});const c=xs(o.barcode);c&&s.set(c,o)}),{byId:n,byBarcode:s}}function Eo(e={},t){if(!t)return null;const n=[e.equipmentId,e.equipment_id,e.id,e.itemId,e.item_id];for(const o of n){if(o==null||o==="")continue;const c=String(o);if(t.byId.has(c))return t.byId.get(c)}const s=[e.barcode,e.normalizedBarcode,e.code];for(const o of s){const c=xs(o);if(c&&t.byBarcode.has(c))return t.byBarcode.get(c)}return null}function An(e,t,n=new Set){const s=new Set;if(!e||typeof e!="object")return s;const o=r=>{const u=typeof r=="string"?r.trim():"";u&&s.add(u)};if(o(e.lessor??e.owner??e.lessor_name??e.lessorName),Array.isArray(e.packageItems)&&e.packageItems.length>0&&!n.has(e)&&(n.add(e),e.packageItems.forEach(r=>{An(r,t,n).forEach(u=>s.add(u))}),n.delete(e)),!s.size){const r=Eo(e,t);r&&o(r.lessor??r.owner??r.lessor_name??r.lessorName)}return s}function jo(e,t,n){if(!(t instanceof Set)||t.size===0)return!0;const s=An(e,n);if(!s.size)return!1;for(const o of s){const c=_s(o);if(c&&t.has(c))return!0}return!1}function To(e,t){const n=Array.isArray(e?.items)?e.items:[],s=new Map;n.forEach(c=>{An(c,t).forEach(r=>{const u=_s(r);u&&(s.has(u)||s.set(u,{key:u,label:r,count:0}),s.get(u).count+=1)})});const o=new Intl.Collator("ar",{sensitivity:"base"});return Array.from(s.values()).sort((c,r)=>o.compare(c.label,r.label))}function $s(){if(!a||a.context!=="reservationChecklist")return;const e=Sn();a.checklistEquipmentLookup=e;const t=To(a.reservation,e),n=new Set(t.map(o=>o.key)),s=a.checklistLessorFilter instanceof Set?a.checklistLessorFilter:new Set;Array.from(s).forEach(o=>{n.has(o)||s.delete(o)}),a.checklistLessorOptions=t,a.checklistLessorFilter=s,Ut()}function Ut(){if(!q?.checklistLessorContainer)return;const e=q.checklistLessorContainer,t=q.checklistLessorOptionsHost;if(!a||a.context!=="reservationChecklist"){e.hidden=!0;return}const n=Array.isArray(a.checklistLessorOptions)?a.checklistLessorOptions:[],s=a.checklistLessorFilter instanceof Set?a.checklistLessorFilter:new Set;if(!t){e.hidden=!0;return}if(!n.length){e.hidden=!0,t.innerHTML=`<p class="text-muted" data-lessor-empty>${l(i("reservations.checklist.controls.lessors.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ø¤Ø¬Ø± Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„Ù…Ø¹Ø¯Ø§Øª."))}</p>`;const c=e.querySelector("[data-lessor-clear]");c&&(c.disabled=!0);return}e.hidden=!1,t.innerHTML=n.map(c=>{const r=`checklist-lessor-${c.key}`,u=c.count?` <small>(${l(E(String(c.count)))})</small>`:"";return`
      <label for="${r}" style="display:flex;align-items:center;gap:6px;">
        <input type="checkbox" id="${r}" value="${c.key}" ${s.has(c.key)?"checked":""}>
        <span>${l(c.label)}${u}</span>
      </label>
    `}).join(""),t.querySelectorAll('input[type="checkbox"]').forEach(c=>{c.addEventListener("change",()=>{a.checklistLessorFilter instanceof Set||(a.checklistLessorFilter=new Set),c.checked?a.checklistLessorFilter.add(c.value):a.checklistLessorFilter.delete(c.value),Ut(),we()})});const o=e.querySelector("[data-lessor-clear]");o&&(o.disabled=s.size===0,o.onclick=()=>{a.checklistLessorFilter instanceof Set&&(a.checklistLessorFilter.clear(),Ut(),we())})}function Cs(){if(!a?.reservation||a.context!=="reservationChecklist")return a?.reservation||null;const e=a.checklistLessorFilter;if(!(e instanceof Set)||e.size===0)return a.reservation;const t=a.checklistEquipmentLookup||Sn();a.checklistEquipmentLookup=t;const n=Array.isArray(a.reservation.items)?a.reservation.items:[],s=n.filter(o=>jo(o,e,t));return s.length===n.length?a.reservation:{...a.reservation,items:s}}function Un(e){try{return encodeURIComponent(JSON.stringify(e))}catch{return""}}function Vn(e,t){if(!e)return null;const n=e.getAttribute(t);if(!n)return null;try{return JSON.parse(decodeURIComponent(n))}catch{return null}}function No(e={}){const t=[],n=e.context||Ke(e);if(t.push(`${ut.context}="${l(String(n))}"`),e.blockOffsets&&Object.keys(e.blockOffsets).length){const s=Un(e.blockOffsets);s&&t.push(`${ut.blockOffsets}="${s}"`)}if(e.infoAlignments&&Object.keys(e.infoAlignments).length){const s=Un(e.infoAlignments);s&&t.push(`${ut.infoAlignments}="${s}"`)}return t.length?` ${t.join(" ")}`:""}let ot=null;function Es(e){return e&&typeof e=="object"?e:ot||a||null}function Ke(e=null){return Es(e)?.context||"reservation"}function Lo(e="reservation"){try{const n=JSON.parse(localStorage.getItem(zt)||"{}")?.[e];if(n&&typeof n=="object")return JSON.parse(JSON.stringify(n))}catch{}return{}}function js(e,t={}){try{const n=JSON.parse(localStorage.getItem(zt)||"{}");t&&Object.keys(t).length>0?n[e]=t:delete n[e],localStorage.setItem(zt,JSON.stringify(n))}catch{}}function _n(e){if(!e)return;const t=Ke(e),n=Lo(t);e.blockOffsets={...kn[t]||{},...n},qn=!1,vt=!1,tn()}function Io(e,t={}){if(!e)return;e.querySelectorAll("[data-drag-key]").forEach(s=>{const o=s.dataset.dragKey,c=t?.[o],r=Number(c?.x)||0,u=Number(c?.y)||0;r||u?s.style.transform=`translate(${r}px, ${u}px)`:s.style.transform="",s.dataset.dragX=String(r),s.dataset.dragY=String(u)})}function Do(e){if(!e||e.getAttribute(ut.context)!=="project")return;const n=c=>{c&&(c.style.textAlign="left",c.style.alignItems="flex-start",c.style.direction="ltr")},s=c=>{!c||!c.classList||(c.classList.remove("info-plain--align-right","info-plain--align-center"),c.classList.contains("info-plain--align-left")||c.classList.add("info-plain--align-left"))};e.querySelectorAll(".quote-section--project, .quote-section--customer").forEach(c=>{n(c);const r=c.querySelector(".quote-section__title");r&&(r.style.textAlign="left"),c.querySelectorAll(".info-plain").forEach(d=>{n(d),s(d),d.querySelectorAll(".info-plain__item").forEach(w=>{w.style.justifyContent="flex-start",w.style.direction="ltr"})})})}function xn(e){try{const t=e?.getElementById("quotation-pdf-root");if(!t)return;t.dataset.blockDragMode=vt?"on":"off"}catch{}}function tn(){const e=q?.blockDragToggle;if(e){const n=vt?i("reservations.quote.drag.disable","ðŸ”’ Ø¥Ù†Ù‡Ø§Ø¡ ÙˆØ¶Ø¹ Ø§Ù„ØªØ­Ø±ÙŠÙƒ"):i("reservations.quote.drag.enable","ðŸŽ¯ ÙˆØ¶Ø¹ ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø¨Ù„ÙˆÙƒØ§Øª");e.setAttribute("aria-label",n),e.setAttribute("title",n),e.classList.toggle("is-active",vt)}const t=q?.blockDragSave;t&&(t.disabled=!qn)}function Po(e){vt=!!e,tn();try{xn(q?.previewFrame?.contentDocument)}catch{}}function $n(e=!0){qn=!!e,tn()}function Fo(){if(!a)return;const e=Ke(a),t=a.blockOffsets||{};js(e,t),$n(!1),at(i("reservations.quote.drag.saved","âœ… ØªÙ… Ø­ÙØ¸ Ù…ÙˆØ§Ø¶Ø¹ Ø§Ù„Ø¨Ù„ÙˆÙƒØ§Øª."))}function Oo(){if(!a)return;const e=Ke(a);a.blockOffsets={...kn[e]||{}},js(e,a.blockOffsets),$n(!1),we(),at(i("reservations.quote.drag.reset","â†º ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© Ù…ÙˆØ§Ø¶Ø¹ Ø§Ù„Ø¨Ù„ÙˆÙƒØ§Øª Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ."))}function Gn(e){return Math.min(Math.max(e,-Qn),Qn)}function Mo(e="reservation"){try{const n=JSON.parse(localStorage.getItem(Qt)||"{}")?.[e];if(n&&typeof n=="object")return{...n}}catch{}return null}function Ro(e,t={}){try{const n=JSON.parse(localStorage.getItem(Qt)||"{}");n[e]=t,localStorage.setItem(Qt,JSON.stringify(n))}catch{}}function Cn(e){if(!e||Et)return;const t=Ke(e),n=Mo(t);e.infoAlignments={...wn,...fn[t]||{},...n||{}},Et=!0}function Ts(e,t){const n=Es(e),s=n?.infoAlignments;if(s&&Object.prototype.hasOwnProperty.call(s,t))return s[t];const o=Ke(n);return fn[o]?.[t]?fn[o][t]:wn[t]||"right"}function xt(e,t){return`info-plain info-plain--align-${Ts(e,t)}`}function Bo(e,t){if(!a)return;const n=Co.includes(e)?e:"customer",s=["left","center","right"].includes(t)?t:"right";a.infoAlignments||(a.infoAlignments={...wn}),a.infoAlignments[n]=s;const o=Ke(a);Ro(o,a.infoAlignments),we(),nn()}function nn(){if(!q?.alignTarget)return;const e=q.alignTarget.value||"customer",t=Ts(a,e);(q.alignButtons||[]).forEach(n=>{const s=n.dataset.alignValue;s&&n.classList.toggle("is-active",s===t)})}async function Ko(){try{if(!a)return;const e=Ke(a),t=JSON.parse(localStorage.getItem(zt)||"{}"),n=JSON.parse(localStorage.getItem(Qt)||"{}"),s={context:e,blockOffsets:a.blockOffsets||t[e]||{},infoAlignments:a.infoAlignments||n[e]||{}},o=JSON.stringify(s,null,2);let c=!1;if(navigator?.clipboard?.writeText)try{await navigator.clipboard.writeText(o),c=!0}catch{c=!1}c?at(i("reservations.quote.align.copied","âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©")):window.prompt(i("reservations.quote.align.copyPrompt","Ø§Ù†Ø³Ø® Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©"),o)}catch(e){console.error("[quote align export] failed",e),at(i("reservations.quote.align.copyFailed","âš ï¸ ØªØ¹Ø°Ø± Ù†Ø³Ø® Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªØŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹"),"error")}}function Ho(e){try{const t=e?.getElementById("quotation-pdf-root");if(!t)return;Array.from(t.querySelectorAll("[data-drag-key]")).forEach(s=>{if(s.dataset.blockDragHandleAttached==="true")return;s.style.position=s.style.position||"relative",s.style.touchAction="none";const o=e.createElement("button");o.type="button",o.className="quote-block-drag-handle",o.setAttribute("data-block-handle",s.dataset.dragKey||""),o.setAttribute("aria-label",i("reservations.quote.drag.handle","Ø§Ø³Ø­Ø¨ Ù„ØªØ­Ø±ÙŠÙƒ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…")),o.innerHTML='<span aria-hidden="true">â ¿</span>';const c=r=>{t.dataset.blockDragMode==="on"&&zo(r,s)};o.addEventListener("pointerdown",c),s.prepend(o),s.dataset.blockDragHandleAttached="true"}),xn(e)}catch{}}function zo(e,t){if(!t||!a)return;e.preventDefault(),e.stopPropagation();const n=t.ownerDocument||document,s=e.pointerId;t.setPointerCapture?.(s);const o=e.clientX,c=e.clientY,r=Number(t.dataset.dragX||0),u=Number(t.dataset.dragY||0);let d=r,h=u;const w=t.dataset.dragKey,v=b=>{b.preventDefault();const y=b.clientX-o,C=b.clientY-c;d=Gn(r+y),h=Gn(u+C),t.style.transform=`translate(${d}px, ${h}px)`,t.dataset.dragTempX=String(d),t.dataset.dragTempY=String(h)},j=()=>{n.removeEventListener("pointermove",v),n.removeEventListener("pointerup",j),t.releasePointerCapture?.(s);const b=Number(t.dataset.dragTempX??r),y=Number(t.dataset.dragTempY??u);t.dataset.dragX=String(b),t.dataset.dragY=String(y),t.dataset.dragTempX="",t.dataset.dragTempY="",a.blockOffsets||(a.blockOffsets={}),Math.abs(b)<=.5&&Math.abs(y)<=.5?delete a.blockOffsets[w]:a.blockOffsets[w]={x:b,y},$n(!0)};n.addEventListener("pointermove",v),n.addEventListener("pointerup",j)}function dt(e="render",{message:t,actionLabel:n,onAction:s,showSpinner:o=e!=="error"}={}){if(!q?.statusIndicator||!q?.statusText)return;q.statusKind=e;const c=t||hs(e);q.statusText.textContent=c,q.statusSpinner&&(q.statusSpinner.hidden=!o),q.statusAction&&(q.statusAction.hidden=!0,q.statusAction.onclick=null,n&&typeof s=="function"&&(q.statusAction.textContent=n,q.statusAction.hidden=!1,q.statusAction.onclick=r=>{r.preventDefault(),s()})),q.statusIndicator.hidden=!1,requestAnimationFrame(()=>{q.statusIndicator.classList.add("is-visible")})}function ht(e){try{return String(e||"").toLowerCase().normalize("NFKD").replace(/[\u064B-\u065F\u0670\u06D6-\u06ED]/g,"").replace(/\s+/g," ").trim()}catch{return String(e||"").trim().toLowerCase()}}function $t(e){!q?.statusIndicator||!q?.statusText||(q.statusKind=null,q.statusIndicator.classList.remove("is-visible"),setTimeout(()=>{q?.statusIndicator&&(q.statusIndicator.hidden=!0,q.statusAction&&(q.statusAction.hidden=!0,q.statusAction.onclick=null),q.statusSpinner&&(q.statusSpinner.hidden=!1))},220))}function mn(){return!!window?.bootstrap?.Modal}function Qo(e){if(e&&!e.classList.contains("show")){e.classList.add("show"),e.style.display="block",e.removeAttribute("aria-hidden"),e.setAttribute("aria-modal","true"),e.getAttribute("role")||e.setAttribute("role","dialog"),document.body.classList.add("modal-open"),st||(st=document.createElement("div"),st.className="modal-backdrop fade show",st.dataset.quotePdfFallbackBackdrop="true",document.body.appendChild(st)),yt||(yt=t=>{t.key==="Escape"&&yn(e)},document.addEventListener("keydown",yt));try{e.focus({preventScroll:!0})}catch{}}}function yn(e){if(!(!e||!e.classList.contains("show"))){try{const t=e.ownerDocument?.activeElement;if(t&&e.contains(t)){try{t.blur()}catch{}try{e.ownerDocument?.body?.focus({preventScroll:!0})}catch{}}}catch{}e.classList.remove("show"),e.style.display="none",e.setAttribute("aria-hidden","true"),e.removeAttribute("aria-modal"),document.body.classList.remove("modal-open"),st&&(st.remove(),st=null),yt&&(document.removeEventListener("keydown",yt),yt=null);try{ks()}catch{}}}function Uo(e){if(e){if(mn()){const t=window.bootstrap.Modal.getOrCreateInstance(e);try{const n=()=>{try{const s=document.activeElement;if(s&&e.contains(s)){try{s.blur()}catch{}try{document.body?.focus({preventScroll:!0})}catch{}}}catch{}try{ks()}catch{}try{e.removeEventListener("hidden.bs.modal",n)}catch{}};e.addEventListener("hidden.bs.modal",n,{once:!0}),e.addEventListener("hide.bs.modal",()=>{try{const s=document.activeElement;if(s&&e.contains(s))try{s.blur()}catch{}}catch{}})}catch{}t.show();return}Qo(e)}}function Vo(){if(_t)return;_t=!0;const e=i("reservations.quote.toast.viewGuide","ðŸ“˜ Ø¹Ø±Ø¶ Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø­Ù„ Ø§Ù„Ø³Ø±ÙŠØ¹"),t=i("reservations.quote.toast.retry","Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©"),n=i("reservations.quote.toast.assetsFailed","âš ï¸ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø¨Ø¹Ø¶ Ø§Ù„ØµÙˆØ± Ø¶Ù…Ù† Ø¹Ø±Ø¶ Ø³Ø¹Ø±."),s=!!q?.modal?.classList.contains("show"),o=()=>{q?.modal?.classList.contains("show")&&(dt("render"),_t=!1,we())};ts({message:n,duration:9e3,actionLabel:s?t:void 0,onAction:s?o:void 0,linkLabel:e,linkHref:ds}),s&&dt("error",{message:n,actionLabel:t,onAction:o,showSpinner:!1})}function Tt(e="reservation"){const t={},n=fs(e);return Object.entries(n).forEach(([s,o=[]])=>{t[s]=new Set(o.filter(c=>c?.default!==!1).map(c=>c.id))}),t}function En(e={}){const t={};return Object.entries(e).forEach(([n,s])=>{t[n]=new Set(Array.from(s||[]))}),t}function Go(e={},t){if(t)return e[t]||(e[t]=new Set),e[t]}function jn(e={},t,n){const s=e?.[t];return s?s instanceof Set?s.has(n):Array.isArray(s)?s.includes(n):!!s?.[n]:!0}function sn(e="reservation"){return Object.fromEntries(en(e).map(({id:t})=>[t,!1]))}function Tn(e,t){return e.sectionExpansions||(e.sectionExpansions=sn(e.context||"reservation")),t&&typeof e.sectionExpansions[t]!="boolean"&&(e.sectionExpansions[t]=!1),e.sectionExpansions}function Wo(e,t){return Tn(e,t)?.[t]!==!1}function Nn(){return typeof window>"u"||typeof window.matchMedia!="function"?!1:window.matchMedia("(max-width: 768px)").matches}function Yo(){if(typeof navigator>"u")return!1;const e=navigator.userAgent||navigator.platform||"";return xo.test(e)}function Xo(){if(typeof navigator>"u")return!1;const e=navigator.userAgent||"",t=As.test(e),n=e.includes("Chrome")||e.includes("CriOS")||e.includes("Chromium"),s=e.includes("Edg");return t&&!n&&!s}function Ns(){return Yo()&&Xo()}function on(){if(typeof navigator>"u")return!1;const e=navigator.userAgent||"",t=navigator.platform||"",n=Number.isFinite(navigator.maxTouchPoints)?navigator.maxTouchPoints:0,s=zn.test(e)||zn.test(t),o=/Macintosh/i.test(e)&&n>1;return As.test(e)&&!$o.test(e)&&(s||o)}function cn(e,...t){try{console.log(`${Ht} ${e}`,...t)}catch{}}function Xe(e,...t){try{console.warn(`${Ht} ${e}`,...t)}catch{}}function Jo(e,t,...n){try{t?console.error(`${Ht} ${e}`,t,...n):console.error(`${Ht} ${e}`,...n)}catch{}}function me(e,{blockType:t="section",extraAttributes:n=""}={}){if(!e)return"";const s=n?` ${n.trim()}`:"";return e.replace(/^(<\w+)/,`$1 data-quote-block data-block-type="${t}"${s}`)}function Zo(e,t="Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¹Ø±Ø¶."){const n=l(i(e,t));return me(`<section class="quote-section quote-placeholder">${n}</section>`,{blockType:"placeholder"})}function Vt(e,t){return Array.isArray(e)&&e.length?e:[Zo(t)]}const ea=/[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF]/;function Ls(e=""){return ea.test(e)}function ta(){const e=window.CanvasRenderingContext2D?.prototype;if(!e||e.__artRatioDirectionPatched)return;const t=n=>{const s=e[n];typeof s=="function"&&(e[n]=function(c,...r){if(typeof c!="string"||!Ls(c))return s.call(this,c,...r);let u,d=!1;try{"direction"in this&&(u=this.direction,u!=="rtl"&&(this.direction="rtl"),d=!0)}catch{}try{if(!d){const h=this.canvas;h&&h.style?.direction!=="rtl"&&(h.__artRatioOriginalDirection=h.style.direction,h.style.direction="rtl")}return s.call(this,c,...r)}finally{if(d&&u!==void 0&&u!=="rtl")try{this.direction=u}catch{}else if(!d){const h=this.canvas;h&&h.__artRatioOriginalDirection!==void 0&&(h.style.direction=h.__artRatioOriginalDirection,delete h.__artRatioOriginalDirection)}}})};t("fillText"),t("strokeText"),e.__artRatioDirectionPatched=!0}function Wn(e,t=At){if(typeof e!="string"&&typeof e!="number")return t;const n=parseFloat(String(e).replace(/[^0-9.+-]/g,""));return Number.isFinite(n)&&n>0?n:t}function na(e){if(!e)return{width:At,height:At};const t=e.getAttribute?.("width"),n=e.getAttribute?.("height");let s=t?Wn(t,0):0,o=n?Wn(n,0):0;if(s>0&&o>0)return{width:s,height:o};const c=e.getAttribute?.("viewBox");if(c){const r=c.trim().split(/[\s,]+/).map(u=>parseFloat(u||"0"));if(r.length>=4){const[,,u,d]=r;s=s||(Number.isFinite(u)&&u>0?u:0),o=o||(Number.isFinite(d)&&d>0?d:0)}}return{width:s||At,height:o||At}}function Is(e=""){return typeof e!="string"?!1:vs.test(e)||_o.test(e)}function sa(e=""){const t=e.indexOf(",");if(t===-1)return"";const n=e.slice(0,t),s=e.slice(t+1);try{return/;base64/i.test(n)?typeof atob=="function"?atob(s):"":decodeURIComponent(s)}catch(o){return console.warn("[reservations/pdf] failed to decode SVG data URI",o),""}}function oa(e,{crossOrigin:t}={}){return new Promise((n,s)=>{const o=new Image;t&&(o.crossOrigin=t),o.onload=()=>n(o),o.onerror=c=>{const r=c?.message||`Unable to load image from ${e}`;s(new Error(r))},o.src=e})}async function Ds(e,t={}){if(!e)return null;const n=document,s=new Blob([e],{type:"image/svg+xml;charset=utf-8"}),o=URL.createObjectURL(s);try{const c=await oa(o),r=n.createElement("canvas"),u=Math.max(t.width||c.naturalWidth||c.width||0,1),d=Math.max(t.height||c.naturalHeight||c.height||u,1);r.width=u,r.height=d;const h=r.getContext("2d");return h.clearRect(0,0,u,d),h.drawImage(c,0,0,u,d),r.toDataURL("image/png")}catch(c){return console.warn("[reservations/pdf] failed to rasterize SVG content",c),null}finally{URL.revokeObjectURL(o)}}async function aa(e){if(!e)return null;if(vs.test(e))return sa(e);try{const t=await fetch(e,{mode:"cors",credentials:"omit",cache:"default"});return t.ok?await t.text():(console.warn("[reservations/pdf] failed to fetch SVG image",e,t.status),null)}catch(t){return console.warn("[reservations/pdf] error fetching SVG image",e,t),null}}async function ra(e){if(!e)return!1;const t=e.getAttribute?.("src")||"";if(!Is(t))return!1;const n=await aa(t);if(!n)return e.dataset.svgRasterization="failed",e.setAttribute("src",dn),!1;const s=await Ds(n);return s?(e.dataset.svgOriginalSrc=t,e.setAttribute("src",s),e.setAttribute("data-rasterized","true"),!0):(e.dataset.svgRasterization="failed",e.setAttribute("src",dn),!1)}async function ia(e){if(!e||e.tagName?.toLowerCase()!=="svg")return!1;const n=new XMLSerializer().serializeToString(e),s=na(e),o=await Ds(n,s),r=(e.ownerDocument||document).createElement("img");r.setAttribute("src",o||dn),r.setAttribute("alt",e.getAttribute("aria-label")||e.getAttribute("title")||""),r.setAttribute("data-svg-replaced","true"),e.hasAttribute("class")&&r.setAttribute("class",e.getAttribute("class")),e.hasAttribute("style")&&r.setAttribute("style",e.getAttribute("style"));const u=e.getAttribute("width"),d=e.getAttribute("height");return u&&r.setAttribute("width",u),d&&r.setAttribute("height",d),e.parentNode?.replaceChild(r,e),!!o}async function Ps(e){if(!e)return;const t=Array.from(e.querySelectorAll?.("img")||[]),n=Array.from(e.querySelectorAll?.("svg")||[]),s=[];t.forEach(o=>{Is(o.getAttribute?.("src"))&&s.push(ra(o))}),n.forEach(o=>{s.push(ia(o))}),s.length&&await Promise.allSettled(s)}function la(e,{pixelRatio:t=1}={}){if(!e)return null;const n=e.ownerDocument||document,o=(n.defaultView||window).getComputedStyle?.(e);if(!o)return null;const c=(A,U=0)=>{const B=parseFloat(A);return Number.isFinite(B)?B:U},r=c(o.paddingTop),u=c(o.paddingBottom),d=c(o.paddingRight),h=c(o.paddingLeft),w=c(o.borderRadius),v=c(o.fontSize,14),j=(()=>{const A=o.lineHeight;if(!A||A==="normal")return v*1.6;const U=c(A,v*1.6);return U>0?U:v*1.6})(),b=Math.max(e.clientWidth||0,e.scrollWidth||0,c(o.width,0));if(b<=0)return null;const y=Math.max(1,b-h-d),C=e.textContent||"",X=C.split(/\r?\n/),k=n.createElement("canvas"),_=k.getContext("2d");if(!_)return null;const Q=o.fontStyle||"normal",Y=o.fontVariant||"normal",se=o.fontWeight||"400",D=o.fontFamily||"sans-serif",z=o.fontStretch||"normal",g=A=>A.join(" "),S=[],I=A=>_.measureText(A).width;_.font=`${Q} ${Y} ${se} ${z} ${v}px ${D}`,X.forEach(A=>{const U=A.trim();if(U.length===0){S.push("");return}const B=U.split(/\s+/);let ae=[];B.forEach((ue,He)=>{const be=ue.trim();if(!be)return;const _e=g(ae.concat(be));if(I(_e)<=y||ae.length===0){ae.push(be);return}S.push(g(ae)),ae=[be]}),ae.length&&S.push(g(ae))}),S.length||S.push("");const T=r+u+S.length*j,oe=Math.ceil(Math.max(1,b)*t),M=Math.ceil(Math.max(1,T)*t);k.width=oe,k.height=M,k.style.width=`${Math.max(1,b)}px`,k.style.height=`${Math.max(1,T)}px`,_.scale(t,t);const le=o.backgroundColor&&o.backgroundColor!=="rgba(0, 0, 0, 0)"?o.backgroundColor:"#ffffff";if(w>0){_.save(),_.beginPath();const A=Math.max(1,b),U=Math.max(1,T),B=Math.min(w,A/2,U/2);_.moveTo(B,0),_.lineTo(A-B,0),_.quadraticCurveTo(A,0,A,B),_.lineTo(A,U-B),_.quadraticCurveTo(A,U,A-B,U),_.lineTo(B,U),_.quadraticCurveTo(0,U,0,U-B),_.lineTo(0,B),_.quadraticCurveTo(0,0,B,0),_.closePath(),_.clip()}if(_.fillStyle=le,_.fillRect(0,0,Math.max(1,b),Math.max(1,T)),_.font=`${Q} ${Y} ${se} ${z} ${v}px ${D}`,_.fillStyle=o.color||"#000000",_.textBaseline="top",_.textAlign="right","direction"in _)try{_.direction="rtl"}catch{}const R=Math.max(0,b-d);let $=r;S.forEach(A=>{const U=A.length?A:" ";_.fillText(U,R,$,y),$+=j});const N=n.createElement("img");let L;try{L=k.toDataURL("image/png")}catch(A){return Xe("note canvas toDataURL failed",A),null}return N.src=L,N.alt=C,N.style.width=`${Math.max(1,b)}px`,N.style.height=`${Math.max(1,T)}px`,N.style.display="block",N.setAttribute("data-quote-note-image","true"),{image:N,canvas:k,totalHeight:T,width:b}}function ca(e,{pixelRatio:t=1}={}){if(!e||!on())return;Array.from(e.querySelectorAll?.(".quote-notes")||[]).forEach(s=>{if(!s||s.dataset.quoteNoteRasterized==="true"||!Ls(s.textContent||""))return;let o;try{o=la(s,{pixelRatio:t})}catch(c){Xe("failed to rasterize note content",c),o=null}o&&(s.dataset.quoteNoteRasterized="true",s.innerHTML="",s.appendChild(o.image))})}function hn(e,t="export",{toastMessage:n,suppressToast:s=!1}={}){Jo(`${t} failed`,e);const o=!!(e&&e.__artRatioPdfNotified);if(!s&&!o){const c=i("reservations.quote.errors.exportFailed","âš ï¸ ØªØ¹Ø°Ø± Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù PDFØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰."),r=n||c,u=i("reservations.quote.toast.viewGuide","ðŸ“˜ Ø¹Ø±Ø¶ Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø­Ù„ Ø§Ù„Ø³Ø±ÙŠØ¹"),d=i("reservations.quote.toast.retry","Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©"),h=["exportQuoteAsPdf","renderQuotePreview","layoutQuoteDocument","pageCapture"].includes(t),w=()=>{t==="exportQuoteAsPdf"?(dt("export"),zs()):(dt("render"),_t=!1,we())};if(ts({message:r,duration:9e3,actionLabel:h?d:void 0,onAction:h?w:void 0,linkLabel:u,linkHref:ds}),q?.modal?.classList.contains("show")&&dt("error",{message:r,actionLabel:h?d:void 0,onAction:h?w:void 0,showSpinner:!1}),e&&typeof e=="object")try{Object.defineProperty(e,"__artRatioPdfNotified",{value:!0,writable:!1,enumerable:!1,configurable:!0})}catch{}}}function bn({container:e,safariWindowRef:t,mobileWindowRef:n}={}){try{n&&!n.closed&&n.close()}catch(s){Xe("failed to close mobile window",s)}try{t&&!t.closed&&t.close()}catch(s){Xe("failed to close safari window",s)}e&&e.parentNode&&e.parentNode.removeChild(e)}function Ln(e){return new Promise((t,n)=>{const s=document.querySelector(`script[src="${e}"]`);if(s){s.addEventListener("load",()=>t()),s.addEventListener("error",c=>n(c)),s.readyState==="complete"&&t();return}const o=document.createElement("script");o.src=e,o.async=!0,o.onload=()=>t(),o.onerror=c=>n(c),document.head.appendChild(o)})}function Yn(){const e=[window.jspdf?.jsPDF,typeof window.jspdf=="function"?window.jspdf:null,window.jsPDF?.jsPDF,typeof window.jsPDF=="function"?window.jsPDF:null].filter(t=>typeof t=="function");return e.length?e[0]:null}function Xn(){return typeof window.html2canvas=="function"?window.html2canvas:null}async function ua(){const e=Xn();return e||(St||(St=Ln(So).catch(t=>{throw St=null,t}).then(()=>{const t=Xn();if(!t)throw St=null,new Error("ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© html2canvas Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.");return t})),St)}async function da(){const e=Yn();return e||(kt||(kt=Ln(Ao).catch(t=>{throw kt=null,t}).then(()=>{const t=Yn();if(!t)throw kt=null,new Error("ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© jsPDF Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.");return t})),kt)}async function pa(){if(window.html2pdf||await Ln(ko),window.html2pdf&&!window.html2pdf.__artRatioConfigured){const e=window.html2pdf.defaultOptions||window.html2pdf.defaultOpt||{},t={...e.html2canvas||{}};t.useCORS=!0,t.allowTaint=!1,t.logging=!0;const n={unit:"mm",format:"a4",orientation:"portrait",compress:!0,...e.jsPDF||{}},s={image:{type:"jpeg",quality:.95,...e.image||{}},margin:e.margin??[0,0,0,0],filename:e.filename||"document.pdf",html2canvas:t,jsPDF:n};window.html2pdf.defaultOptions=s,window.html2pdf.defaultOpt=s,window.html2pdf.__artRatioConfigured=!0}uo(),ta()}function l(e=""){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function Fs(e="reservation"){return Hn[e]||Hn.reservation}function fa(){try{window.localStorage?.removeItem?.(yo)}catch{}}function ma(e="reservation"){try{fa();const t=Fs(e),n=window.localStorage?.getItem?.(t);if(!n)return null;const s=JSON.parse(n);return s&&typeof s=="object"?s:null}catch(t){return console.warn("âš ï¸ [reservations/pdf] failed to read toggle preferences",t),null}}function ya(e,t="reservation"){try{const n=Fs(t);if(!e){window.localStorage?.removeItem?.(n);return}window.localStorage?.setItem?.(n,JSON.stringify(e))}catch(n){console.warn("âš ï¸ [reservations/pdf] failed to persist toggle preferences",n)}}function ha(e){if(!e)return{ids:null,emptyExplicitly:!1};if(e instanceof Set)return{ids:Array.from(e),emptyExplicitly:e.size===0};if(Array.isArray(e))return{ids:e.slice(),emptyExplicitly:e.length===0};if(typeof e=="object"){const t=Object.entries(e).filter(([,n])=>!!n);return{ids:t.map(([n])=>n),emptyExplicitly:t.length===0}}return{ids:null,emptyExplicitly:!1}}function ba(e,t="reservation"){if(!e)return null;const n=ms(t),s=ys(t),o=Array.from(e.sections instanceof Set?e.sections:new Set(e.sections||[])).filter(u=>n.has(u)),c={},r=e.fields||{};return Object.entries(s).forEach(([u,d])=>{const h=r[u];if(h==null)return;const{ids:w,emptyExplicitly:v}=ha(h);if(!w&&!v)return;const j=Array.isArray(w)?w.filter(b=>d.has(b)):[];(j.length>0||v)&&(c[u]=j)}),{version:1,sections:o,fields:c}}function Os(e){if(!e)return;const t=e.context||"reservation",n=ba(e,t);n&&ya(n,t)}function In(e){if(!e)return;const t=e.context||"reservation",n=ma(t);if(!n)return;const s=ms(t),o=Array.isArray(n.sections)?n.sections.filter(c=>s.has(c)):[];if(o.length&&(e.sections=new Set(o)),n.fields&&typeof n.fields=="object"){const c=En(e.fields||Tt(t)),r=ys(t);Object.entries(n.fields).forEach(([u,d])=>{const h=r[u];if(!h)return;const w=Array.isArray(d)?d.filter(v=>h.has(v)):[];c[u]=new Set(w)}),e.fields=c}}function Dn(e=new Date){try{return e.toLocaleDateString("en-GB",{year:"numeric",month:"2-digit",day:"2-digit"})}catch{return e.toISOString().slice(0,10)}}function an(e){const t=io()||[],{technicians:n=[]}=Yt(),s=[].concat(Array.isArray(t)?t:[]).concat(Array.isArray(n)?n:[]),o=new Map;return s.forEach(r=>{if(!r||r.id==null)return;const u=String(r.id),d=o.get(u)||{};o.set(u,{...d,...r})}),(Array.isArray(e.crewAssignments)&&e.crewAssignments.length?e.crewAssignments:Array.isArray(e.techniciansDetails)&&e.techniciansDetails.length?e.techniciansDetails:(e.technicians||[]).map(r=>({technicianId:r}))).map((r,u)=>{const d=r?.technicianId!=null?o.get(String(r.technicianId)):null;let h=r.positionLabel??r.position_name??r.position_label??r.role??r.position??d?.role??i("reservations.crew.positionFallback","Ù…Ù†ØµØ¨ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…");(!h||h.trim()==="")&&(h=r.positionLabelAr??r.position_label_ar??r.positionLabelEn??r.position_label_en??r.position_name_ar??r.position_name_en??d?.role??i("reservations.crew.positionFallback","Ù…Ù†ØµØ¨ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…"));try{const j=typeof gt=="function"?gt()||[]:[];let b=null;if(r?.positionId!=null&&(b=j.find(y=>String(y?.id)===String(r.positionId))||null),!b){const y=r.positionKey??r.position_key??r.positionName??r.position_name??r.position??"";if(y&&(b=typeof Bn=="function"&&Bn(y)||null,!b&&j.length)){const C=String(y).trim().toLowerCase();b=j.find(X=>[X.name,X.labelAr,X.labelEn].filter(Boolean).map(k=>String(k).toLowerCase()).includes(C))||null}}if(b){const y=b.labelAr||b.labelEn||b.name||"";y&&y.trim()&&(h=y)}}catch{}const w=Ct(Mt(r.positionCost??r.position_cost??r.cost??r.daily_wage??r.dailyWage??d?.dailyWage??d?.wage??0)),v=Ct(Mt(r.positionClientPrice??r.position_client_price??r.client_price??r.clientPrice??r.daily_total??r.dailyTotal??r.total??d?.dailyTotal??d?.total??d?.total_wage??0));return{assignmentId:r.assignmentId??r.assignment_id??`crew-${u}`,positionId:r.positionId??r.position_id??null,positionLabel:h,positionLabelAlt:r.positionLabelAlt??r.position_label_alt??"",positionCost:w,positionClientPrice:v,technicianId:r.technicianId!=null?String(r.technicianId):d?.id!=null?String(d.id):null,technicianName:r.technicianName??r.technician_name??d?.name??null,technicianRole:r.technicianRole??d?.role??null}})}function Pn(e,t,n){const{projectLinked:s}=no(e,n);gn(e.start,e.end);const o=e.discount??e.discountValue??0,c=Number(E(String(o)))||0,r=e.discountType??e.discount_type??"percent",u=String(r).toLowerCase()==="amount"?"amount":"percent",d=s?!1:!!(e.applyTax??e.apply_tax??e.taxApplied),h=e.companySharePercent??e.company_share_percent??e.companyShare??e.company_share??null,w=h!=null?Mt(h):Number.NaN,j=(e.companyShareEnabled??e.company_share_enabled??e.companyShareApplied??e.company_share_applied)===!0&&Number.isFinite(w)&&w>0?w:null,b=Array.isArray(t)?t.map(Y=>Y?.technicianId).filter(Boolean):[],y=ns({items:Array.isArray(e.items)?e.items:[],technicianIds:b,crewAssignments:Array.isArray(t)?t:[],discount:c,discountType:u,applyTax:d,start:e.start,end:e.end,companySharePercent:j,groupingSource:e}),C=Mt(e.cost??e.total??e.finalTotal),X=Number.isFinite(C),k=s?y.finalTotal:X?Ct(C):y.finalTotal,_={equipmentTotal:y.equipmentTotal,equipmentCostTotal:y.equipmentCostTotal,crewTotal:y.crewTotal,crewCostTotal:y.crewCostTotal,discountAmount:y.discountAmount,subtotalAfterDiscount:y.subtotalAfterDiscount,taxableAmount:y.taxableAmount,taxAmount:y.taxAmount,finalTotal:k,companySharePercent:y.companySharePercent,companyShareAmount:y.companyShareAmount,netProfit:y.netProfit},Q={equipmentTotal:he(y.equipmentTotal),equipmentCostTotal:he(y.equipmentCostTotal),crewTotal:he(y.crewTotal),discountAmount:he(y.discountAmount),subtotalAfterDiscount:he(y.subtotalAfterDiscount),taxableAmount:he(y.taxableAmount),taxAmount:he(y.taxAmount),finalTotal:he(k),companySharePercent:E((Number.isFinite(y.companySharePercent)?y.companySharePercent:0).toFixed(2)),companyShareAmount:he(y.companyShareAmount),netProfit:E(y.netProfit.toFixed(2))};return{totals:_,totalsDisplay:Q,rentalDays:y.rentalDays}}function wt(e){if(e==null||e==="")return null;const t=Number.parseFloat(E(String(e)));return Number.isFinite(t)?t:null}function Ms(e){if(!e)return new Date().toISOString();const t=new Date(e);return Number.isNaN(t.getTime())?new Date().toISOString():t.toISOString()}function ga(e){if(!e||typeof e!="object")return null;const t=e.type??e.payment_type??e.paymentType??null;let n=typeof t=="string"?t.trim().toLowerCase():null;n!=="percent"&&(n="amount");const s=wt(e.amount??(n==="amount"?e.value:null)),o=wt(e.percentage??(n==="percent"?e.value:null)),c=n==="percent"?o??null:s??null,r=e.note??e.memo??null,u=Ms(e.recordedAt??e.recorded_at??e.date??e.created_at??null);return n==="amount"&&s==null||n==="percent"&&o==null?null:{type:n,amount:s??null,percentage:o??null,value:c,note:r,recordedAt:u}}function va(e={}){const n=(Array.isArray(e.paymentHistory)?e.paymentHistory:Array.isArray(e.payment_history)?e.payment_history:[]).map(ga).filter(Boolean);if(n.length>0)return n;const s=wt(e.paidPercent??e.paid_percent),o=wt(e.paidAmount??e.paid_amount),c=e.updatedAt??e.updated_at??e.createdAt??e.created_at??null,r=Ms(c);return s!=null&&s>0?[{type:"percent",amount:o!=null&&o>0?o:null,percentage:s,value:s,note:null,recordedAt:r}]:o!=null&&o>0?[{type:"amount",amount:o,percentage:null,value:o,note:null,recordedAt:r}]:[]}function wa(e){if(!e)return i("projects.form.types.unknown","Ù†ÙˆØ¹ ØºÙŠØ± Ù…Ø­Ø¯Ø¯");const t={commercial:"projects.form.types.commercial",coverage:"projects.form.types.coverage",photography:"projects.form.types.photography",social:"projects.form.types.social"}[e]||"projects.form.types.unknown";return i(t,e)}function qa(e){const t=new Date,n=e?.start?new Date(e.start):null,s=e?.end?new Date(e.end):null;return n&&!Number.isNaN(n.getTime())&&n>t?"upcoming":s&&!Number.isNaN(s.getTime())&&s<t?"completed":"ongoing"}function ka(e){if(Array.isArray(e?.expenses)&&e.expenses.some(s=>Number.isFinite(Number(s?.salePrice??s?.sale_price))))return e.expenses.reduce((s,o)=>s+(Number(o?.salePrice??o?.sale_price)||0),0);const t=Number(e?.servicesClientPrice??e?.services_client_price);return Number.isFinite(t)&&t>=0?t:typeof e?.expensesTotal=="number"?e.expensesTotal:Array.isArray(e?.expenses)?e.expenses.reduce((n,s)=>n+(Number(s?.amount)||0),0):0}function Sa(e){if(!e)return 0;const t=Array.isArray(e.items)?e.items:[],n=e.discount??0,s=Number(E(String(n)))||0,o=e.discountType||"percent",c=Array.isArray(e.crewAssignments)?e.crewAssignments:[],r=c.length?c:Array.isArray(e.technicians)?e.technicians:[],u=ro(t,s,o,!1,r,{start:e.start,end:e.end,companySharePercent:0});if(Number.isFinite(u))return u;const d=Number(E(String(e.cost??0)));return Number.isFinite(d)?Math.round(d):0}function Aa(e,t){if(!e)return"â€”";const n=bt(e);return t?`${n} - ${bt(t)}`:n}function ne(e,t="SR",n=2){const s=Number(e);return`${he(s)} ${t}`}function Jn(e,t=2){if(!Number.isFinite(Number(e)))return"0%";const n=Number.isInteger(t)?t:2;return`${E(Number(e).toFixed(n))}%`}function _a(e){if(!e?.start)return null;if(!e?.end)return 1;const t=gn(e.start,e.end);return Number.isFinite(t)?t:1}function xa(e){return Number.isFinite(e)?e<=1?"ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯":`${E(String(Math.round(e)))} Ø£ÙŠØ§Ù…`:"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}function Zn(e){const t=i("reservations.create.summary.currency","SR"),n=Yt()||{},s=Array.isArray(n.customers)?n.customers:[],o=Array.isArray(n.projects)?n.projects:[],c=Array.isArray(n.technicians)?n.technicians:[];let r=[];try{const f=os?.()||[];r=Array.isArray(f)&&f.length?f:n.reservations||[]}catch{r=n.reservations||[]}const u=e?.id!=null?o.find(f=>String(f.id)===String(e.id))||e:e||null,d={projectStatusLabel:i("projects.status.ongoing","Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°"),paymentStatusLabel:i("projects.paymentStatus.unpaid","ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹")};if(!u)return{project:null,customer:null,clientInfo:{name:"-",company:"-",phone:"-",email:"-"},projectInfo:{title:"-",code:"-",typeLabel:"-",startDisplay:"-",endDisplay:"-",durationLabel:"-",statusLabel:d.projectStatusLabel},expenses:[],equipment:[],reservations:[],totals:{equipmentEstimate:0,expensesTotal:0,baseSubtotal:0,discountAmount:0,subtotalAfterDiscount:0,companyShareAmount:0,subtotal:0,applyTax:!1,taxAmount:0,totalWithTax:0},totalsDisplay:{projectSubtotal:ne(0,t),expensesTotal:ne(0,t),reservationsTotal:ne(0,t),discountAmount:ne(0,t),taxAmount:ne(0,t),overallTotal:ne(0,t),paidAmount:ne(0,t),remainingAmount:ne(0,t)},projectTotals:{combinedTaxAmount:0,overallTotal:0,reservationsTotal:0,paidAmount:0,paidPercent:0,remainingAmount:0,paymentStatus:"unpaid"},paymentSummary:{status:"unpaid",statusLabel:d.paymentStatusLabel,paidAmount:0,paidPercent:0,remainingAmount:0,paidAmountDisplay:ne(0,t),remainingAmountDisplay:ne(0,t),paidPercentDisplay:Jn(0)},notes:"",currencyLabel:t,projectStatus:"ongoing",projectStatusLabel:d.projectStatusLabel,projectDurationDays:null,projectDurationLabel:"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",paymentHistory:[]};const h=u.clientId??u.customerId??u.client_id??u.customer_id??null,w=h!=null&&s.find(f=>String(f.id)===String(h))||null,v=w?.customerName??w?.name??u.clientName??u.customerName??i("projects.fallback.unknownClient","Ø¹Ù…ÙŠÙ„ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"),j=(u.clientCompany||w?.companyName||w?.company||"").trim(),b=w?.phone??w?.customerPhone??u.clientPhone??u.customerPhone??"",y=b?E(String(b).trim()):i("projects.details.client.noPhone","Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù‚Ù… Ù…ØªØ§Ø­"),C=w?.email??u.clientEmail??u.customerEmail??"",X=C?String(C).trim():i("projects.details.client.noEmail","Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨Ø±ÙŠØ¯ Ù…ØªØ§Ø­"),k=u.projectCode||`PRJ-${E(String(u.id??""))}`,_=E(String(k)),Q=(u.title||"").trim()||i("projects.fallback.untitled","Ù…Ø´Ø±ÙˆØ¹ Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†"),Y=wa(u.type),se=u.start?bt(u.start):"â€”",D=u.end?bt(u.end):"â€”",z=_a(u),g=z!=null?xa(z):"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",S=qa(u),I={upcoming:"Ù‚Ø§Ø¯Ù…",ongoing:"Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°",completed:"Ù…ÙƒØªÙ…Ù„"},T=i(`projects.status.${S}`,I[S]||S),oe=u.id!=null?String(u.id):null,M=oe?r.filter(f=>{const V=f?.projectId??f?.project_id??null;return V!=null&&String(V)===oe}):[];M.map(f=>{const V=f.reservationId||f.id||"",x=f.status||f.state||"pending",ie=String(x).toLowerCase(),re=i(`reservations.status.${ie}`,ie),Z=Sa(f),ke=f.start?new Date(f.start).getTime():0;return{reservationId:E(String(V||"-")),status:ie,statusLabel:re,total:Z,totalLabel:ne(Z,t),dateRange:Aa(f.start,f.end),startTimestamp:Number.isNaN(ke)?0:ke}}).sort((f,V)=>V.startTimestamp-f.startTimestamp).map(({startTimestamp:f,...V})=>V);let le=0,R=0;try{M.forEach(f=>{const V=ns({items:Array.isArray(f.items)?f.items:[],technicianIds:Array.isArray(f.technicians)?f.technicians:[],crewAssignments:Array.isArray(f.crewAssignments)?f.crewAssignments:[],discount:Number(f.discount??0)||0,discountType:f.discountType||"percent",applyTax:!1,start:f.start,end:f.end,groupingSource:f,companySharePercent:0});le+=Number(V.equipmentTotal||0),R+=Number(V.crewTotal||0)})}catch{}const $=ka(u),N=Number(le+R+$),L=[];try{M.forEach(f=>{const{groups:V}=ss(f);V.forEach(x=>{const ie=Number(x?.count??x?.quantity??1)||1,re=Number(x?.unitPrice);let Z=Number.isFinite(re)?re:0;if(!Z||Z<=0){const fe=Number(x?.totalPrice);Number.isFinite(fe)&&ie>0&&(Z=Number((fe/ie).toFixed(2)))}Number.isFinite(Z)||(Z=0);const ke=x?.type==="package"||Array.isArray(x?.items)&&x.items.some(fe=>fe?.type==="package"),Te=Array.isArray(x?.barcodes)&&x.barcodes.length?x.barcodes[0]:Array.isArray(x?.items)&&x.items.length?x.items[0]?.barcode:null;let de=x?.packageDisplayCode??x?.package_code??x?.code??x?.packageCode??(Array.isArray(x?.items)&&x.items.length?x.items[0]?.package_code??x.items[0]?.code??x.items[0]?.packageCode:null);const Ve=fe=>{const xe=(fe==null?"":String(fe)).trim();return!!(!xe||/^pkg-/i.test(xe)||/^\d+$/.test(xe)&&xe.length<=4)};if(!de||Ve(de)){const fe=x?.packageId??x?.package_id??(Array.isArray(x?.items)&&x.items.length?x.items[0]?.packageId??x.items[0]?.package_id:null);if(fe)try{const xe=as(fe);xe&&xe.package_code&&(de=xe.package_code)}catch{}}if(!de||Ve(de))try{const fe=ht(x?.description||"");if(fe){const xe=rs();let Me=xe.find(We=>ht(We?.name||We?.title||We?.label||"")===fe);Me||(Me=xe.find(We=>{const Nt=ht(We?.name||We?.title||We?.label||"");return Nt.includes(fe)||fe.includes(Nt)})),Me&&Me.package_code&&(de=Me.package_code)}}catch{}const Ge=ke?de??Te??"":x?.barcode??Te??"",et=Ge!=null?String(Ge):"",rn=Number.isFinite(Number(x?.totalPrice))?Number(x.totalPrice):Number((Z*ie).toFixed(2));L.push({...x,isPackage:ke,desc:x?.description,barcode:et,packageCodeResolved:de||"",qty:ie,price:Z,totalPrice:Ct(rn),unitPriceValue:Z})})})}catch{}const A=new Map;M.forEach(f=>{const V=Array.isArray(f.items)?f.items:[],x=gn(f.start,f.end),ie=f.reservationId||f.id||"";V.forEach((re,Z)=>{if(!re)return;const ke=re.barcode||re.code||re.id||re.desc||re.description||`item-${Z}`,Te=String(ke||`item-${Z}`),de=A.get(Te)||{description:re.desc||re.description||re.name||re.barcode||`#${E(String(Z+1))}`,totalQuantity:0,reservationsCount:0,reservationIds:new Set,totalCost:0},Ve=Number(re.qty)||1,Ge=Number(re.price)||0;de.totalQuantity+=Ve,de.reservationIds.add(String(ie));const et=Ge*Ve*Math.max(1,x);Number.isFinite(et)&&(de.totalCost+=et),A.set(Te,de)})});const U=Array.from(A.values()).map(f=>({description:f.description,totalQuantity:f.totalQuantity,reservationsCount:f.reservationIds.size,displayCost:ne(f.totalCost,t)})),B=new Map((c||[]).filter(Boolean).map(f=>[String(f.id),f])),ae=new Map,ue=f=>{if(!f)return;let V=null;typeof f=="object"?V=f.id??f.technicianId??f.technician_id??f.userId??f.user_id??null:(typeof f=="string"||typeof f=="number")&&(V=f);const x=V!=null?String(V):null,ie=x&&B.has(x)?B.get(x):typeof f=="object"?f:null,re=ie?.name||ie?.full_name||ie?.fullName||ie?.displayName||(typeof f=="string"?f:null),Z=ie?.role||ie?.title||null,ke=ie?.phone||ie?.mobile||ie?.contact||null;if(!re&&!x)return;const Te=x||re;ae.has(Te)||ae.set(Te,{id:x,name:re||"-",role:Z||null,phone:ke||null})};Array.isArray(u?.technicians)&&u.technicians.forEach(f=>ue(f)),M.forEach(f=>{(Array.isArray(f.crewAssignments)&&f.crewAssignments.length?f.crewAssignments:Array.isArray(f.technicians)?f.technicians.map(x=>({technicianId:x})):[]).forEach(x=>ue(x))});const He=Array.from(ae.values()),be=Array.isArray(u.expenses)?u.expenses.map(f=>{const V=Number(f?.salePrice??f?.sale_price??f?.amount)||0;return{label:f?.label||f?.name||"-",amount:V,displayAmount:ne(V,t),note:f?.note||f?.description||""}}):[],_e=u?.applyTax===!0||u?.applyTax==="true",rt=Number.parseFloat(u?.discount??u?.discountValue??0)||0;let qe=(u?.discountType==="amount"?"amount":"percent")==="amount"?rt:N*(rt/100);(!Number.isFinite(qe)||qe<0)&&(qe=0),qe>N&&(qe=N);const it=Math.max(0,N-qe),ze=u?.companyShareEnabled===!0||u?.company_share_enabled===!0||u?.companyShareApplied===!0||u?.company_share_applied===!0,je=Number.parseFloat(u?.companySharePercent??u?.company_share_percent??u?.companyShare??u?.company_share??0)||0,Je=ze&&je>0?je:0,$e=Je>0?Number((it*(Je/100)).toFixed(2)):0,Fe=Number((it+$e).toFixed(2)),Qe=_e?Number((Fe*lo).toFixed(2)):0,Oe=Number((Fe+Qe).toFixed(2)),Ue=va(u),Le=wt(u.paidAmount??u.paid_amount)||0,Ie=wt(u.paidPercent??u.paid_percent)||0,De=oo({totalAmount:Oe,paidAmount:Le,paidPercent:Ie,history:Ue}),pt=typeof u.paymentStatus=="string"?u.paymentStatus.toLowerCase():"",Ze=ao({manualStatus:pt,paidAmount:De.paidAmount,paidPercent:De.paidPercent,totalAmount:Oe}),qt={paid:"Ù…Ø¯ÙÙˆØ¹",partial:"Ù…Ø¯ÙÙˆØ¹ Ø¬Ø²Ø¦ÙŠØ§Ù‹",unpaid:"ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹"},ft=i(`projects.paymentStatus.${Ze}`,qt[Ze]||Ze),m=Number(De.paidAmount||0),K=Number(De.paidPercent||0),O=Math.max(0,Number((Oe-m).toFixed(2))),te={projectSubtotal:ne(Fe,t),expensesTotal:ne($,t),reservationsTotal:ne(Fe,t),discountAmount:ne(qe,t),taxAmount:ne(Qe,t),overallTotal:ne(Oe,t),paidAmount:ne(m,t),remainingAmount:ne(O,t)},J={status:Ze,statusLabel:ft,paidAmount:m,paidPercent:K,remainingAmount:O,paidAmountDisplay:ne(m,t),remainingAmountDisplay:ne(O,t),paidPercentDisplay:Jn(K)},W=(u.description||"").trim();return{project:u,customer:w,clientInfo:{name:v,company:j||"â€”",phone:y,email:X},projectInfo:{title:Q,code:_,typeLabel:Y,startDisplay:se,endDisplay:D,durationLabel:g,statusLabel:T},expenses:be,equipment:U,crew:He,equipmentItems:L,crewAssignments:M.flatMap(f=>an(f)),totals:{equipmentEstimate:le,expensesTotal:$,baseSubtotal:N,discountAmount:qe,subtotalAfterDiscount:it,companyShareAmount:$e,subtotal:Fe,applyTax:_e,taxAmount:Qe,totalWithTax:Oe},totalsDisplay:te,projectTotals:{combinedTaxAmount:Qe,overallTotal:Oe,reservationsTotal:Fe,paidAmount:m,paidPercent:K,remainingAmount:O,paymentStatus:Ze},paymentSummary:J,notes:W,currencyLabel:t,projectStatus:S,projectStatusLabel:T,projectDurationDays:z,projectDurationLabel:g,paymentHistory:Ue}}function $a({project:e,clientInfo:t={},projectInfo:n={},projectCrew:s=[],projectExpenses:o=[],projectEquipment:c=[],totalsDisplay:r={},projectTotals:u={},paymentSummary:d={},currencyLabel:h="SR",sections:w,fieldSelections:v={},quoteNumber:j,quoteDate:b,terms:y=Ee,rootAttributes:C=""}){const X=En(v),k=(m,K)=>jn(X,m,K),_=m=>w?.has?.(m),Q=`<div class="quote-placeholder">${l(i("reservations.quote.placeholder.noFields","Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù„Ù„Ø¹Ø±Ø¶ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…."))}</div>`,Y=(m,K)=>`<div class="info-plain__item">
      <span class="info-plain__label">${l(m)}</span>
      <span class="info-plain__separator">:</span>
      <span class="info-plain__value">${l(K)}</span>
    </div>`,se=(m,K,{variant:O="inline"}={})=>O==="final"?`<div class="totals-item totals-item--final">
        <span class="totals-item__label">${l(m)}</span>
        <span class="totals-item__slash">/</span>
        <span class="totals-item__value">${l(K)}</span>
      </div>`:`<span class="totals-inline__item">
      <span class="totals-inline__label">${l(m)}</span>
      <span class="totals-inline__slash">/</span>
      <span class="totals-inline__value">${l(K)}</span>
    </span>`,D=(m,K)=>`<div class="payment-row">
      <span class="payment-row__label">${l(m)}</span>
      <span class="payment-row__slash">/</span>
      <span class="payment-row__value">${l(K)}</span>
    </div>`,z=(m,K,O)=>{const te=`${m}-title`,J=`${m}-content`;return`
      <div class="quote-section__head" data-drag-key="${l(te)}">
        ${K}
      </div>
      <div class="quote-section__body" data-drag-key="${l(J)}">
        ${O}
      </div>
    `},g=[];k("customerInfo","customerName")&&g.push(Y(i("projects.details.client","Ø§Ù„Ø¹Ù…ÙŠÙ„"),t.name||"-")),k("customerInfo","customerCompany")&&g.push(Y(i("projects.details.company","Ø´Ø±ÙƒØ© Ø§Ù„Ø¹Ù…ÙŠÙ„"),t.company||"â€”")),k("customerInfo","customerPhone")&&g.push(Y(i("projects.details.labels.clientPhone","Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„"),t.phone||"-")),k("customerInfo","customerEmail")&&g.push(Y(i("projects.details.labels.clientEmail","Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"),t.email||"-"));const S=xt(a,"projectCustomer"),I=_("customerInfo")?`<section class="quote-section quote-section--plain quote-section--customer">
        ${z("customer",`<h3 class="quote-section__title">${l(i("projects.quote.sections.customer","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„"))}</h3>`,g.length?`<div class="${S}">${g.join("")}</div>`:Q)}
      </section>`:"",T=[];k("projectInfo","projectType")&&T.push(Y(i("projects.details.type","Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.typeLabel||"-")),k("projectInfo","projectTitle")&&T.push(Y(i("projects.details.projectTitle","Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.title||"-")),k("projectInfo","projectCode")&&T.push(Y(i("projects.details.labels.code","Ø±Ù‚Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.code||"-")),k("projectInfo","projectStart")&&T.push(Y(i("projects.details.start","Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.startDisplay||"-")),k("projectInfo","projectEnd")&&T.push(Y(i("projects.details.end","Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.endDisplay||"-")),k("projectInfo","projectDuration")&&T.push(Y(i("projects.details.duration","Ù…Ø¯Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.durationLabel||"-")),k("projectInfo","projectStatus")&&T.push(Y(i("projects.details.status","Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.statusLabel||"-"));const oe=xt(a,"projectDetails"),M=_("projectInfo")?`<section class="quote-section quote-section--plain quote-section--project">
        ${z("project",`<h3 class="quote-section__title">${l(i("projects.quote.sections.project","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"))}</h3>`,T.length?`<div class="${oe}">${T.join("")}</div>`:Q)}
      </section>`:"",le=Jt.filter(m=>k("projectCrew",m.id)),R=Array.isArray(a?.crewAssignments)?a.crewAssignments:[],$=m=>{const K=m&&m.positionId!=null?`id:${String(m.positionId)}`:(()=>{const J=(m?.positionLabel||m?.position_name||m?.position||"").trim().toLowerCase();return J?`label:${J}`:""})(),O=Number.isFinite(Number(m?.positionClientPrice))?Number(m.positionClientPrice):0,te=O>0?`|p:${O.toFixed(2)}`:"";return`${K}${te}`};(()=>{const m=new Map;return R.forEach(K=>{const O=$(K);O&&m.set(O,(m.get(O)||0)+1)}),m})();const N=(()=>{const m=[];if(le.forEach(W=>{W.id==="position"?(m.push({...W,render:H=>{const f=typeof ce=="function"?ce():"ar";let V=H?.positionLabelEn??H?.position_label_en??H?.position_name_en??H?.positionLabelAlt??H?.position_label_alt??H?.role;if(!V&&f==="en")try{const re=typeof gt=="function"?gt():[];let Z=null;if(H?.positionId!=null&&(Z=re.find(ke=>String(ke.id)===String(H.positionId))||null),!Z){const ke=H?.positionKey??H?.position_key??H?.positionName??H?.position_name??H?.position??"";if(ke){const Te=String(ke).toLowerCase();Z=re.find(de=>String(de.name).toLowerCase()===Te)||null}}Z&&(V=Z.labelEn??Z.label_en??Z.name_en??V)}catch{}const x=H?.positionLabel??H?.position_name??H?.role??i("reservations.crew.positionFallback","Ù…Ù†ØµØ¨ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…");return l(E(String(f==="en"&&V?V:x)))}}),k("projectCrew","quantity")&&m.push({id:"quantity",labelKey:"reservations.details.table.headers.quantity",fallback:"Ø§Ù„ÙƒÙ…ÙŠØ©",render:H=>l(E(String(Math.max(1,Number(H?.__count||1)))))})):W.id==="price"?m.push({...W,render:H=>{const f=Number.isFinite(Number(H?.positionClientPrice))?Number(H.positionClientPrice):0,V=Math.max(1,Number(H?.__count||1)),x=Math.max(1,Number(a?.rentalDays||1)),ie=f*V*x;return l(`${he(ie)} ${i("reservations.create.summary.currency","SR")}`)}}):W.id==="unitPrice"?m.push({...W,render:H=>{const f=Number.isFinite(Number(H?.positionClientPrice))?Number(H.positionClientPrice):0;return l(`${he(f)} ${i("reservations.create.summary.currency","SR")}`)}}):m.push(W)}),k("projectCrew","days")){const W=Math.max(1,Number(a?.rentalDays||1)),H=m.findIndex(V=>V.id==="price"),f=Math.max(0,H);m.splice(f,0,{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…",render:()=>l(E(String(W)))})}const K=new Map(m.map(W=>[W.id,W])),O=new Set,te=[],J=W=>{const H=K.get(W);H&&!O.has(W)&&(te.push(H),O.add(W))};return J("rowNumber"),J("position"),J("unitPrice"),J("quantity"),J("days"),J("price"),m.forEach(W=>{O.has(W.id)||(te.push(W),O.add(W.id))}),te})(),L=(()=>{const m=new Map;return R.forEach(K=>{const O=$(K);if(!O)return;const te=m.get(O);te?te.__count+=1:m.set(O,{...K,__count:1})}),Array.from(m.values())})(),A=(()=>{try{const m=Math.max(1,Number(a?.rentalDays||1)),K=(L||[]).reduce((O,te)=>{const J=Number.isFinite(Number(te?.positionClientPrice))?Number(te.positionClientPrice):0,W=Math.max(1,Number(te?.__count||1));return O+J*W*m},0);return he(K)}catch{return"0.00"}})(),U=_("projectCrew")?N.length?`<section class="quote-section quote-section--table">
            <h3>${l(i("projects.quote.sections.crew","Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„"))}</h3>
            <table class="quote-table">
              <thead>
                <tr>${N.map(m=>`<th>${l(m.labelKey?i(m.labelKey,m.fallback):m.fallback)}</th>`).join("")}</tr>
              </thead>
              <tbody>${L.length?L.map((m,K)=>`<tr>${N.map(O=>`<td><div class="quote-cell">${O.render(m,K)}</div></td>`).join("")}</tr>`).join(""):`<tr><td colspan="${Math.max(N.length,1)}" class="empty">${l(i("projects.details.crew.empty","Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ø§Ù‚Ù… ÙÙ†ÙŠ Ù…Ø±ØªØ¨Ø·."))}</td></tr>`}
              </tbody>
            </table>
            ${k("projectCrew","crewSubtotal")?`
              <div class="quote-table-subtotal">
                <span class="quote-table-subtotal__pill">
                  <span class="quote-table-subtotal__label">${l(i("reservations.details.labels.crewTotal","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±ÙŠÙ‚"))}</span>
                  <span class="quote-table-subtotal__value">${l(`${A} ${h}`)}</span>
                </span>
              </div>
            `:""}
          </section>`:`<section class="quote-section quote-section--table">
            <h3>${l(i("projects.quote.sections.crew","Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„"))}</h3>
            ${Q}
          </section>`:"",B=[];k("financialSummary","discountAmount")&&B.push(se(i("reservations.details.labels.discount","Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ…"),r.discountAmount||ne(0,h)));const ae=i("projects.details.summary.preTaxTotal","Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©");k("financialSummary","reservationsTotal")&&B.push(se(ae,r.reservationsTotal||ne(0,h))),k("financialSummary","taxAmount")&&B.push(se(i("projects.details.summary.combinedTax","Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"),r.taxAmount||ne(0,h)));const ue=[];k("financialSummary","overallTotal")&&ue.push(se(i("projects.details.summary.overallTotal","Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ"),r.overallTotal||ne(0,h),{variant:"final"}));const He=_("financialSummary")?!B.length&&!ue.length?`<section class="quote-section quote-section--financial">${Q}</section>`:`<section class="quote-section quote-section--financial">
          ${z("projectFinancial",`<h3>${l(i("projects.quote.sections.financial","Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ"))}</h3>`,`<div class="totals-block">
              ${B.length?`<div class="totals-inline">${B.join("")}</div>`:""}
              ${ue.length?`<div class="totals-final">${ue.join("")}</div>`:""}
            </div>`)}
        </section>`:"",be=ps.filter(m=>k("projectExpenses",m.id)),_e=_("projectExpenses")?be.length?`<section class="quote-section quote-section--table">
            <h3>${l(i("projects.quote.sections.expenses","Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©"))}</h3>
            <table class="quote-table">
              <thead>
                <tr>${be.map(m=>`<th>${l(m.labelKey?i(m.labelKey,m.fallback):m.fallback)}</th>`).join("")}</tr>
              </thead>
              <tbody>${o.length?o.map((m,K)=>`<tr>${be.map(O=>`<td><div class="quote-cell">${O.render(m,K)}</div></td>`).join("")}</tr>`).join(""):`<tr><td colspan="${Math.max(be.length,1)}" class="empty">${l(i("projects.details.expenses.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ØªØ·Ù„Ø¨Ø§Øª Ù…Ø³Ø¬Ù„Ø©."))}</td></tr>`}
              </tbody>
            </table>
            ${k("projectExpenses","expensesSubtotal")?`
              <div class="quote-table-subtotal">
                <span class="quote-table-subtotal__pill">
                  <span class="quote-table-subtotal__label">${l(i("projects.details.expensesTotal","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©"))}</span>
                  <span class="quote-table-subtotal__value">${l(r.expensesTotal||ne(0,h))}</span>
                </span>
              </div>
            `:""}
          </section>`:`<section class="quote-section quote-section--table">
            <h3>${l(i("projects.quote.sections.expenses","Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©"))}</h3>
            ${Q}
          </section>`:"",rt=Xt.filter(m=>k("projectEquipment",m.id)),Ne=(()=>{let m=[];if(rt.forEach(J=>{J.id==="price"?m.push({...J,render:W=>{const H=Number.isFinite(Number(W?.unitPriceValue))?Number(W.unitPriceValue):0,f=Number.isFinite(Number(W?.qty))?Math.max(1,Number(W.qty)):1,V=Math.max(1,Number(a?.rentalDays||1)),x=H*f*V;return l(`${he(x)} ${i("reservations.create.summary.currency","SR")}`)}}):J.id==="unitPrice"?m.push({...J,render:W=>{const H=Number.isFinite(Number(W?.unitPriceValue))?Number(W.unitPriceValue):0;return l(`${he(H)} ${i("reservations.create.summary.currency","SR")}`)}}):m.push(J)}),k("projectEquipment","days")){const J=Math.max(1,Number(a?.rentalDays||1)),W=m.findIndex(f=>f.id==="price"),H=Math.max(0,W);m.splice(H,0,{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…",render:()=>l(E(String(J)))})}const K=new Map(m.map(J=>[J.id,J])),O=m.filter(J=>!["unitPrice","quantity","days","price"].includes(J.id)),te=["unitPrice","quantity","days","price"].map(J=>K.get(J)).filter(Boolean);return m=[...O,...te],m})(),qe=Array.isArray(a?.equipmentItems)?a.equipmentItems:[],it=(()=>{try{const m=Math.max(1,Number(a?.rentalDays||1)),K=(qe||[]).reduce((O,te)=>{const J=Number.isFinite(Number(te?.unitPriceValue))?Number(te.unitPriceValue):0,W=Number.isFinite(Number(te?.qty))?Math.max(1,Number(te.qty)):1;return O+J*W*m},0);return he(K)}catch{return"0.00"}})(),ze=_("projectEquipment")?Ne.length?`<section class="quote-section quote-section--table">
            <h3>${l(i("projects.quote.sections.equipment","Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</h3>
            <table class="quote-table">
              <thead>
                <tr>${Ne.map(m=>`<th>${l(m.labelKey?i(m.labelKey,m.fallback):m.fallback)}</th>`).join("")}</tr>
              </thead>
              <tbody>${qe.length?qe.map((m,K)=>`<tr>${Ne.map(O=>`<td><div class="quote-cell">${O.render(m,K)}</div></td>`).join("")}</tr>`).join(""):`<tr><td colspan="${Math.max(Ne.length,1)}" class="empty">${l(i("projects.details.equipment.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø¯Ø§Øª Ù…Ø±ØªØ¨Ø·Ø© Ø­Ø§Ù„ÙŠØ§Ù‹."))}</td></tr>`}
              </tbody>
            </table>
            ${k("projectEquipment","equipmentSubtotal")?`
              <div class="quote-table-subtotal">
                <span class="quote-table-subtotal__pill">
                  <span class="quote-table-subtotal__label">${l(i("reservations.details.labels.equipmentTotal","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</span>
                  <span class="quote-table-subtotal__value">${l(`${it} ${h}`)}</span>
                </span>
              </div>
            `:""}
          </section>`:`<section class="quote-section quote-section--table">
            <h3>${l(i("projects.quote.sections.equipment","Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</h3>
            ${Q}
          </section>`:"",je=(e?.description||"").trim()||"",Je=_("projectNotes")?`<section class="quote-section">
        <h3>${l(i("projects.quote.sections.notes","Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"))}</h3>
        <div class="quote-notes">${l(je||i("projects.fallback.noDescription","Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ Ù„Ù„Ù…Ø´Ø±ÙˆØ¹."))}</div>
      </section>`:"",$e=[];k("payment","beneficiary")&&$e.push(D(i("reservations.quote.labels.beneficiary","Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙÙŠØ¯"),ve.beneficiaryName)),k("payment","bank")&&$e.push(D(i("reservations.quote.labels.bank","Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ"),ve.bankName)),k("payment","account")&&$e.push(D(i("reservations.quote.labels.account","Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨"),E(ve.accountNumber))),k("payment","iban")&&$e.push(D(i("reservations.quote.labels.iban","Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ¨Ø§Ù†"),E(ve.iban)));const Fe=`<section class="quote-section">
      <div class="payment-block">
        <h3>${l(i("reservations.quote.sections.payment","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹"))}</h3>
        <div class="payment-rows">${$e.length?$e.join(""):Q}</div>
      </div>
      <p class="quote-approval-note">${l(ve.approvalNote)}</p>
    </section>`,Qe=Array.isArray(y)&&y.length?y:Ee,Oe=`<footer class="quote-footer">
        <h4>${l(i("reservations.quote.labels.terms","Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø¹Ø§Ù…Ø©"))}</h4>
        <ul>${Qe.map(m=>`<li>${l(m)}</li>`).join("")}</ul>
      </footer>`,Ue=[],Le=[];if(M&&Le.push({key:"project",html:M}),I&&Le.push({key:"customer",html:I}),Le.length>1){const m=Le.find(te=>te.key==="project"),K=Le.find(te=>te.key==="customer"),O=[];m?.html&&O.push(m.html),K?.html&&O.push(K.html),Ue.push(me(`<div class="quote-section-row quote-section-row--primary">${O.join("")}</div>`,{blockType:"group"}))}else Le.length===1&&Ue.push(me(Le[0].html));const Ie=[];U&&Ie.push(me(U,{blockType:"table",extraAttributes:'data-table-id="project-crew"'})),_e&&Ie.push(me(_e,{blockType:"table",extraAttributes:'data-table-id="project-expenses"'})),ze&&Ie.push(me(ze,{blockType:"table",extraAttributes:'data-table-id="project-equipment"'}));const De=[];He&&De.push(me(He,{blockType:"summary"})),Je&&De.push(me(Je));let pt=[];pt=[..._("payment")?[me(Fe,{blockType:"payment"})]:[],me(Oe,{blockType:"footer"})];const Ze=[...Vt(Ue,"projects.quote.placeholder.primary"),...Ie,...Vt(De,"projects.quote.placeholder.summary"),...pt],qt=typeof ce=="function"?ce():"ar",ft=`
    <header class="quote-header" data-quote-header-template>
      <div class="quote-header__logo">
        <img class="quote-logo" src="${l(ve.logoUrl)}" alt="${l(ve.companyName)}" crossorigin="anonymous"/>
      </div>
      <div class="quote-header__title">
        <h1>${l(i("projects.quote.title","Ø¹Ø±Ø¶ Ø³Ø¹Ø±"))}</h1>
        <p class="quote-company-name">${l(i("quote.companyName",ve.companyName))}</p>
        <p class="quote-company-cr">${l(i("reservations.quote.labels.cr","Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ"))}: ${l(ve.commercialRegistry)}</p>
        <p class="quote-company-license">${l(i("reservations.quote.labels.mediaLicense","ØªØ±Ø®ÙŠØµ Ø¥Ø¹Ù„Ø§Ù…ÙŠ"))}: 159460</p>
      </div>
      <div class="quote-header__meta">
        <div class="quote-header__meta-item">
          <span>${l(i("reservations.details.labels.reservationId","Ø±Ù‚Ù… Ø§Ù„Ø¹Ø±Ø¶"))}</span>
          <strong>${l(j)}</strong>
        </div>
        <div class="quote-header__meta-item">
          <span>${l(i("projects.quote.labels.date","Ø§Ù„ØªØ§Ø±ÙŠØ®"))}</span>
          <strong>${l(b)}</strong>
        </div>
      </div>
    </header>
  `.trim();return`
    <div id="quotation-pdf-root" dir="rtl" data-lang="${l(qt)}"${C}>
      <style>${gs}${bs}</style>
      <div class="quote-document" data-quote-document>
        <div class="quote-preview-pages" data-quote-pages></div>
        <div class="quote-content-source" data-quote-source>
          ${ft}
          ${Ze.join("")}
        </div>
      </div>
    </div>
  `}function Rs(e={}){const t={context:e?.context||Ke(),blockOffsets:e?.blockOffsets||a?.blockOffsets||null,infoAlignments:e?.infoAlignments||a?.infoAlignments||null},n=No(t),s=ot;ot=t;try{if(e?.context==="project")return $a({...e,rootAttributes:n});const{reservation:o,customer:c,project:r,crewAssignments:u,totals:d,totalsDisplay:h,rentalDays:w,currencyLabel:v,sections:j,fieldSelections:b={},quoteNumber:y,quoteDate:C,terms:X=Ee}=e,k=E(String(o?.reservationId??o?.id??"")),_=typeof ce=="function"?ce():"ar",Q=o.start?E(bt(o.start)):"-",Y=o.end?E(bt(o.end)):"-",se=c?.customerName||c?.full_name||c?.name||"-",D=c?.phone||"-",z=c?.email||"-",g=c?.company||c?.company_name||"-",S=E(D),I=r?.title||r?.name||i("reservations.details.project.none","ØºÙŠØ± Ù…Ø±ØªØ¨Ø· Ø¨Ù…Ø´Ø±ÙˆØ¹"),T=r?.code||r?.projectCode||"",oe=E(String(w)),M=o?.notes||"",le=Array.isArray(X)&&X.length?X:Ee,R=En(b),$=(p,G)=>jn(R,p,G),N=p=>j?.has?.(p),L=`<div class="quote-placeholder">${l(i("reservations.quote.placeholder.noFields","Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù„Ù„Ø¹Ø±Ø¶ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…."))}</div>`,A=(p,G)=>{const ee=_==="en"?": ":" / ";return`<div class="info-plain__item">${l(p)}<span class="info-plain__slash">${ee}</span><strong class="info-plain__value">${l(G)}</strong></div>`},U=(p,G,{variant:ee="inline"}={})=>ee==="final"?`<div class="totals-item totals-item--final">
        <span class="totals-item__label">${l(p)}</span>
        <span class="totals-item__slash">/</span>
        <span class="totals-item__value">${l(G)}</span>
      </div>`:`<span class="totals-inline__item">
      <span class="totals-inline__label">${l(p)}</span>
      <span class="totals-inline__slash">/</span>
      <span class="totals-inline__value">${l(G)}</span>
    </span>`,B=(p,G)=>`<div class="payment-row">
      <span class="payment-row__label">${l(p)}</span>
      <span class="payment-row__slash">/</span>
      <span class="payment-row__value">${l(G)}</span>
    </div>`,ae=(p,G,ee)=>{const ye=`${p}-title`,Se=`${p}-content`;return`
      <div class="quote-section__head" data-drag-key="${l(ye)}">
        ${G}
      </div>
      <div class="quote-section__body" data-drag-key="${l(Se)}">
        ${ee}
      </div>
    `},ue=[];$("customerInfo","customerName")&&ue.push(A(i("reservations.details.labels.customer","Ø§Ù„Ø¹Ù…ÙŠÙ„"),se)),$("customerInfo","customerCompany")&&ue.push(A(i("reservations.details.labels.company","Ø§Ù„Ø´Ø±ÙƒØ©"),g)),$("customerInfo","customerPhone")&&ue.push(A(i("reservations.details.labels.phone","Ø§Ù„Ù‡Ø§ØªÙ"),S)),$("customerInfo","customerEmail")&&ue.push(A(i("reservations.details.labels.email","Ø§Ù„Ø¨Ø±ÙŠØ¯"),z));const He=xt(a,"customer"),be=N("customerInfo")&&ue.length?`<section class="quote-section quote-section--plain quote-section--customer">
            ${ae("customer",`<h3 class="quote-section__title">${l(i("reservations.quote.sections.customer","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„"))}</h3>`,`<div class="${He}">${ue.join("")}</div>`)}
          </section>`:"",_e=[];$("reservationInfo","reservationId")&&_e.push(A(i("reservations.details.labels.reservationId","Ø±Ù‚Ù… Ø§Ù„Ø­Ø¬Ø²"),k||"-")),$("reservationInfo","reservationStart")&&_e.push(A(i("reservations.details.labels.start","Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø­Ø¬Ø²"),Q)),$("reservationInfo","reservationEnd")&&_e.push(A(i("reservations.details.labels.end","Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø­Ø¬Ø²"),Y)),$("reservationInfo","reservationDuration")&&_e.push(A(i("reservations.details.labels.duration","Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…"),oe));const rt=xt(a,"reservation"),Ne=N("reservationInfo")&&_e.length?`<section class="quote-section quote-section--plain quote-section--reservation">
            ${ae("reservation",`<h3 class="quote-section__title">${l(i("reservations.quote.sections.reservation","ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²"))}</h3>`,`<div class="${rt}">${_e.join("")}</div>`)}
          </section>`:"",qe=[];$("projectInfo","projectTitle")&&qe.push(A(i("reservations.details.labels.project","Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),I)),$("projectInfo","projectCode")&&qe.push(A(i("reservations.details.labels.code","Ø§Ù„Ø±Ù…Ø²"),T||"-"));const it=xt(a,"project"),ze=N("projectInfo")&&qe.length?`<section class="quote-section quote-section--plain quote-section--project">
            ${ae("project",`<h3 class="quote-section__title">${l(i("reservations.quote.sections.project","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"))}</h3>`,`<div class="${it}">${qe.join("")}</div>`)}
          </section>`:"",je=[];$("financialSummary","discountAmount")&&je.push(U(i("reservations.details.labels.discount","Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ…"),`${h.discountAmount} ${v}`)),$("financialSummary","subtotalBeforeTax")&&je.push(U(i("reservations.details.labels.subtotalBeforeTax","Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"),`${h.taxableAmount} ${v}`)),$("financialSummary","taxAmount")&&je.push(U(i("reservations.details.labels.tax","Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"),`${h.taxAmount} ${v}`));const Je=$("financialSummary","finalTotal"),$e=[];Je&&$e.push(U(i("reservations.details.labels.total","Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ"),`${h.finalTotal} ${v}`,{variant:"final"}));const Fe=$e.length?`<div class="totals-final">${$e.join("")}</div>`:"",Qe=N("financialSummary")?!je.length&&!Je?`<section class="quote-section quote-section--financial">${L}</section>`:`<section class="quote-section quote-section--financial">
          ${ae("financial",`<h3 class="quote-section__title">${l(i("reservations.details.labels.summary","Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ"))}</h3>`,`<div class="totals-block">
              ${je.length?`<div class="totals-inline">${je.join("")}</div>`:""}
              ${Fe}
            </div>`)}
        </section>`:"",{groups:Oe}=ss(o),Ue=Oe.map(p=>{const G=Number(p?.count??p?.quantity??1)||1,ee=Number(p?.unitPrice);let ye=Number.isFinite(ee)?ee:0;if(!ye||ye<=0){const pe=Number(p?.totalPrice);Number.isFinite(pe)&&G>0&&(ye=Number((pe/G).toFixed(2)))}Number.isFinite(ye)||(ye=0);const Se=p?.type==="package"||Array.isArray(p?.items)&&p.items.some(pe=>pe?.type==="package"),Pe=Array.isArray(p?.barcodes)&&p.barcodes.length?p.barcodes[0]:Array.isArray(p?.items)&&p.items.length?p.items[0]?.barcode:null;let P=p?.packageDisplayCode??p?.package_code??p?.code??p?.packageCode??(Array.isArray(p?.items)&&p.items.length?p.items[0]?.package_code??p.items[0]?.code??p.items[0]?.packageCode:null);const F=pe=>{const Ae=(pe==null?"":String(pe)).trim();return!!(!Ae||/^pkg-/i.test(Ae)||/^\d+$/.test(Ae)&&Ae.length<=4)};if(!P||F(P)){const pe=p?.packageId??p?.package_id??(Array.isArray(p?.items)&&p.items.length?p.items[0]?.packageId??p.items[0]?.package_id:null);if(pe)try{const Ae=as(pe);Ae&&Ae.package_code&&(P=Ae.package_code)}catch{}}if(!P||F(P))try{const pe=ht(p?.description||"");if(pe){const Ae=rs();let tt=Ae.find(Ye=>ht(Ye?.name||Ye?.title||Ye?.label||"")===pe);tt||(tt=Ae.find(Ye=>{const mt=ht(Ye?.name||Ye?.title||Ye?.label||"");return mt.includes(pe)||pe.includes(mt)})),tt&&tt.package_code&&(P=tt.package_code)}}catch{}const ge=Se?P??Pe??"":p?.barcode??Pe??"",Ce=ge!=null?String(ge):"";let Re=Number.isFinite(Number(p?.totalPrice))?Number(p.totalPrice):Number((ye*G).toFixed(2));return Re=Ct(Re),{...p,isPackage:Se,desc:p?.description,barcode:Ce,packageCodeResolved:P||"",qty:G,price:Re,totalPrice:Re,unitPriceValue:ye}}),Le=Xt.filter(p=>$("items",p.id)),Ie=(()=>{let p=[];Le.forEach(P=>{P.id==="price"?p.push({...P,render:F=>{const ge=Number.isFinite(Number(F?.unitPriceValue))?Number(F.unitPriceValue):0,Ce=Number.isFinite(Number(F?.qty))?Math.max(1,Number(F.qty)):1,Re=Math.max(1,Number(a?.rentalDays||1)),pe=ge*Ce*Re;return l(`${he(pe)} ${i("reservations.create.summary.currency","SR")}`)}}):P.id==="unitPrice"?p.push({...P,render:F=>{const ge=Number.isFinite(Number(F?.unitPriceValue))?Number(F.unitPriceValue):0;return l(`${he(ge)} ${i("reservations.create.summary.currency","SR")}`)}}):p.push(P)});const G=Math.max(1,Number(a?.rentalDays||1));if($("items","days")){const P=p.findIndex(ge=>ge.id==="price"),F=Math.max(0,P);p.splice(F,0,{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…",render:()=>l(E(String(G)))})}const ee=new Map(p.map(P=>[P.id,P])),ye=p.filter(P=>!["unitPrice","quantity","days","price"].includes(P.id)),Se=["unitPrice","quantity"];ee.has("days")&&Se.push("days"),Se.push("price");const Pe=Se.map(P=>ee.get(P)).filter(Boolean);return p=[...ye,...Pe],p})(),De=Ie.length>0,pt=De?Ie.map(p=>`<th>${l(p.labelKey?i(p.labelKey,p.fallback):p.fallback)}</th>`).join(""):"",qt=Ue.length>0?Ue.map((p,G)=>`<tr>${Ie.map(ee=>`<td><div class="quote-cell">${ee.render(p,G)}</div></td>`).join("")}</tr>`).join(""):`<tr><td colspan="${Math.max(Ie.length,1)}" class="empty">${l(i("reservations.details.noItems","ðŸ“¦ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø¯Ø§Øª Ø¶Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø² Ø­Ø§Ù„ÙŠØ§Ù‹."))}</td></tr>`,ft=N("items")?De?`<section class="quote-section quote-section--table">
            <h3>${l(i("reservations.details.items.title","Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</h3>
            <table class="quote-table">
              <thead>
                <tr>${pt}</tr>
              </thead>
              <tbody>${qt}</tbody>
            </table>
            ${$("items","equipmentSubtotal")?`
              <div class="quote-table-subtotal">
                <span class="quote-table-subtotal__pill">
                  <span class="quote-table-subtotal__label">${l(i("reservations.details.labels.equipmentTotal","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</span>
                  <span class="quote-table-subtotal__value">${l(`${h.equipmentTotal} ${v}`)}</span>
                </span>
              </div>
            `:""}
          </section>`:`<section class="quote-section quote-section--table">
            <h3>${l(i("reservations.details.items.title","Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</h3>
            ${L}
          </section>`:"",m=Jt.filter(p=>$("crew",p.id)),K=!0,O=m.length>0,te=Array.isArray(u)?u:[],J=p=>{const G=p&&p.positionId!=null?`id:${String(p.positionId)}`:(()=>{const Se=(p?.positionLabel||p?.position_name||p?.position||"").trim().toLowerCase();return Se?`label:${Se}`:""})(),ee=Number.isFinite(Number(p?.positionClientPrice))?Number(p.positionClientPrice):0,ye=ee>0?`|p:${ee.toFixed(2)}`:"";return`${G}${ye}`},W=(()=>{const p=new Map;return te.forEach(G=>{const ee=J(G);ee&&p.set(ee,(p.get(ee)||0)+1)}),p})(),H=(()=>{let p=[],G=null;if(m.forEach(P=>{P.id==="position"?(p.push({...P,render:F=>{const ge=typeof ce=="function"?ce():"ar";let Ce=F?.positionLabelEn??F?.position_label_en??F?.position_name_en??F?.positionLabelAlt??F?.position_label_alt??F?.role;if(!Ce&&ge==="en")try{const mt=typeof gt=="function"?gt():[];let lt=null;if(F?.positionId!=null&&(lt=mt.find(Lt=>String(Lt.id)===String(F.positionId))||null),!lt){const Lt=F?.positionKey??F?.position_key??F?.positionName??F?.position_name??F?.position??"";if(Lt){const Ys=String(Lt).toLowerCase();lt=mt.find(Xs=>String(Xs.name).toLowerCase()===Ys)||null}}lt&&(Ce=lt.labelEn??lt.label_en??lt.name_en??Ce)}catch{}const Re=F?.positionLabel??F?.position_name??F?.role??i("reservations.crew.positionFallback","Ù…Ù†ØµØ¨ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…"),pe=ge==="en"&&Ce?Ce:Re;if(K)return l(E(String(pe)));const Ae=J(F),tt=Ae&&W.get(Ae)||0,Ye=tt>1?` Ã— ${E(String(tt))}`:"";return l(E(String(pe))+Ye)}}),$("crew","quantity")&&(G={id:"quantity",labelKey:"reservations.details.table.headers.quantity",fallback:"Ø§Ù„ÙƒÙ…ÙŠØ©",render:F=>{const ge=Number(F?.__count||1);return l(E(String(Math.max(1,ge))))}})):P.id==="price"?K&&p.push({...P,render:F=>{const ge=Number.isFinite(Number(F?.positionClientPrice))?Number(F.positionClientPrice):0,Ce=Math.max(1,Number(F?.__count||1)),Re=Math.max(1,Number(a?.rentalDays||1)),pe=ge*Ce*Re;return l(`${he(pe)} ${i("reservations.create.summary.currency","SR")}`)}}):P.id==="unitPrice"?p.push({...P,render:F=>{const ge=Number.isFinite(Number(F?.positionClientPrice))?Number(F.positionClientPrice):0;return l(`${he(ge)} ${i("reservations.create.summary.currency","SR")}`)}}):p.push(P)}),G&&p.push(G),$("crew","days")){const P=Math.max(1,Number(a?.rentalDays||1)),F=p.findIndex(Ce=>Ce.id==="price"),ge=Math.max(0,F);p.splice(ge,0,{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…",render:()=>l(E(String(P)))})}const ee=new Map(p.map(P=>[P.id,P])),ye=new Set,Se=[],Pe=P=>{const F=ee.get(P);F&&!ye.has(P)&&(Se.push(F),ye.add(P))};return Pe("rowNumber"),Pe("position"),Pe("unitPrice"),Pe("quantity"),Pe("days"),Pe("price"),p.forEach(P=>{ye.has(P.id)||(Se.push(P),ye.add(P.id))}),p=Se,p})(),f=O?H.map(p=>`<th>${l(p.labelKey?i(p.labelKey,p.fallback):p.fallback)}</th>`).join(""):"",V=K?(()=>{const p=new Map;return te.forEach(G=>{const ee=J(G);if(!ee)return;const ye=p.get(ee);ye?ye.__count+=1:p.set(ee,{...G,__count:1})}),Array.from(p.values())})():te,x=V.length?V.map((p,G)=>`<tr>${H.map(ee=>`<td><div class="quote-cell">${ee.render(p,G)}</div></td>`).join("")}</tr>`).join(""):`<tr><td colspan="${Math.max(H.length,1)}" class="empty">${l(i("reservations.details.noCrew","ðŸ˜Ž Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙØ±ÙŠÙ‚ Ù…Ø±ØªØ¨Ø· Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø²."))}</td></tr>`,ie=N("crew")?O?`<section class="quote-section quote-section--table">
            <h3>${l(i("reservations.details.technicians.title","Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„"))}</h3>
            <table class="quote-table">
              <thead>
                <tr>${f}</tr>
              </thead>
              <tbody>${x}</tbody>
            </table>
            ${$("crew","crewSubtotal")?`
              <div class="quote-table-subtotal">
                <span class="quote-table-subtotal__pill">
                  <span class="quote-table-subtotal__label">${l(i("reservations.details.labels.crewTotal","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±ÙŠÙ‚"))}</span>
                  <span class="quote-table-subtotal__value">${l(`${h.crewTotal} ${v}`)}</span>
                </span>
              </div>
            `:""}
          </section>`:`<section class="quote-section quote-section--table">
            <h3>${l(i("reservations.details.technicians.title","Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„"))}</h3>
            ${L}
          </section>`:"",re=N("notes")?`<section class="quote-section">
        <h3>${l(i("reservations.details.labels.notes","Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø­Ø¬Ø²"))}</h3>
        <div class="quote-notes">${l(M||i("reservations.quote.emptyNotes","Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©."))}</div>
      </section>`:"",Z=[];$("payment","beneficiary")&&Z.push(B(i("reservations.quote.labels.beneficiary","Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙÙŠØ¯"),ve.beneficiaryName)),$("payment","bank")&&Z.push(B(i("reservations.quote.labels.bank","Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ"),ve.bankName)),$("payment","account")&&Z.push(B(i("reservations.quote.labels.account","Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨"),E(ve.accountNumber))),$("payment","iban")&&Z.push(B(i("reservations.quote.labels.iban","Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ¨Ø§Ù†"),E(ve.iban)));const ke=`<section class="quote-section">
      <div class="payment-block">
        <h3>${l(i("reservations.quote.sections.payment","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹"))}</h3>
        <div class="payment-rows">${Z.length?Z.join(""):L}</div>
      </div>
      <p class="quote-approval-note">${l(ve.approvalNote)}</p>
    </section>`,Te=`<footer class="quote-footer">
        <h4>${l(i("reservations.quote.labels.terms","Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø¹Ø§Ù…Ø©"))}</h4>
        <ul>${le.map(p=>`<li>${l(p)}</li>`).join("")}</ul>
      </footer>`,de=[];if(be&&Ne){const G=(typeof ce=="function"?ce():"ar")==="en"?`${Ne}${be}`:`${be}${Ne}`;de.push(me(`<div class="quote-section-row">${G}</div>`,{blockType:"group"}))}else Ne&&de.push(me(Ne)),be&&de.push(me(be));if(ze)try{const p=typeof ce=="function"?ce():"ar",G='<section class="quote-section quote-section--empty"></section>',ee=p==="en"?`<div class="quote-section-row">${G}${ze}</div>`:`<div class="quote-section-row">${G}${ze}</div>`;de.push(me(ee,{blockType:"group"}))}catch{de.push(me(ze))}const Ve=[];ft&&Ve.push(me(ft,{blockType:"table",extraAttributes:'data-table-id="items"'})),ie&&Ve.push(me(ie,{blockType:"table",extraAttributes:'data-table-id="crew"'}));const Ge=[];Qe&&Ge.push(me(Qe,{blockType:"summary"})),re&&Ge.push(me(re));let et=[];if((e?.context||"reservation")!=="reservationChecklist")et=[...N("payment")?[me(ke,{blockType:"payment"})]:[],me(Te,{blockType:"footer"})];else{const p=String(e?.checklistNotes||"").trim(),G=String(e?.checklistNotesTitle||"").trim()||i("reservations.checklist.controls.notes.sectionTitleDefault","Ù…Ù„Ø§Ø­Ø¸Ø§Øª");if(p.length>0){const ee=`<section class="quote-section">
        <h3>${l(G)}</h3>
        <div class="quote-notes">${l(p)}</div>
      </section>`;et=[me(ee)]}}const rn=[...e?.context==="reservationChecklist"?de:Vt(de,"reservations.quote.placeholder.page1"),...Ve,...e?.context==="reservationChecklist"?Ge:Vt(Ge,"reservations.quote.placeholder.page2"),...et],fe=e?.context==="reservationChecklist",xe=e?.checklistType==="crew"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ":e?.checklistType==="both"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙˆØ§Ù„Ø·Ø§Ù‚Ù… Ø§Ù„ÙÙ†ÙŠ":"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",Me=typeof ce=="function"?ce():"ar",We=e?.checklistType==="crew"?"Crew List":e?.checklistType==="both"?"Equipment & Crew List":"Equipment List",Nt=fe?Me==="en"?We:xe:i("reservations.quote.title","Ø¹Ø±Ø¶ Ø³Ø¹Ø±"),Us=fe?`<div class="quote-header__meta" ${Me==="en"?'dir="ltr"':""}>
        <div class="quote-header__meta-item">
          <span>${l(i("reservations.quote.labels.date","Ø§Ù„ØªØ§Ø±ÙŠØ®"))}</span>
          <strong>${l(C)}</strong>
        </div>
      </div>`:`<div class="quote-header__meta">
        <div class="quote-header__meta-item">
          <span>Ø±Ù‚Ù… Ø§Ù„Ø¹Ø±Ø¶</span>
          <strong>${l(y)}</strong>
        </div>
        <div class="quote-header__meta-item">
          <span>Ø§Ù„ØªØ§Ø±ÙŠØ®</span>
          <strong>${l(C)}</strong>
        </div>
      </div>`,Vs=!fe||!e?.hideLogo,Gs=!fe||!e?.hideCompany,Ws=`
    <header class="quote-header" data-quote-header-template style="${Number.isFinite(Number(e?.headerOffset))?`margin-top:${Number(e.headerOffset)}px;`:""}">
      <div class="quote-header__logo">
        ${Vs?`<img class="quote-logo" src="${l(ve.logoUrl)}" alt="${l(ve.companyName)}" crossorigin="anonymous"/>`:'<span class="quote-logo quote-logo--placeholder" aria-hidden="true"></span>'}
      </div>
      <div class="quote-header__title">
        <h1>${l(Nt)}</h1>
        ${Gs?`
          <p class="quote-company-name">${l(i("quote.companyName",ve.companyName))}</p>
          <p class="quote-company-cr">${l(i("reservations.quote.labels.cr","Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ"))}: ${l(ve.commercialRegistry)}</p>
          <p class="quote-company-license">${l(i("reservations.quote.labels.mediaLicense","ØªØ±Ø®ÙŠØµ Ø¥Ø¹Ù„Ø§Ù…ÙŠ"))}: 159460</p>
        `:""}
      </div>
      ${Us}
    </header>
  `.trim();return`
      <div id="quotation-pdf-root" dir="${l(fe&&Me==="en"?"ltr":"rtl")}" data-lang="${l(Me)}"${n}>
        <style>${gs}${bs}</style>
        <div class="quote-document" data-quote-document>
          <div class="quote-preview-pages" data-quote-pages></div>
          <div class="quote-content-source" data-quote-source>
            ${Ws}
            ${rn.join("")}
          </div>
        </div>
      </div>
    `}finally{ot=s}}async function Fn(){try{const e=Yt();if((Array.isArray(e?.packages)?e.packages:[]).length>0)return;const n=await Js("/packages/?all=1"),s=Array.isArray(n?.data)?n.data:Array.isArray(n)?n:[];s.length&&(Zs({packages:s}),document.dispatchEvent?.(new CustomEvent("packages:changed",{detail:{packages:s}})))}catch{}}function Ca(e){return e?e.complete?e.naturalHeight===0?Promise.reject(new Error(`image failed to load: ${e.src||"unknown"}`)):Promise.resolve():new Promise((t,n)=>{const s=()=>{c(),t()},o=()=>{c(),n(new Error(`image failed to load: ${e.src||"unknown"}`))},c=()=>{e.removeEventListener("load",s),e.removeEventListener("error",o)};e.addEventListener("load",s,{once:!0}),e.addEventListener("error",o,{once:!0})}):Promise.resolve()}async function jt(e){if(!e)return;const t=e.ownerDocument||document,n=t.defaultView||window,s=Array.from(e.querySelectorAll?.("img")||[]),o=t.fonts?.ready?t.fonts.ready:Promise.resolve(),c=s.map(u=>Ca(u)),r=[o,...c].map(u=>u.catch(d=>(Xe("asset load failed",d),Vo(),null)));await Promise.all(r),await new Promise(u=>n.requestAnimationFrame(()=>u()))}async function Gt(e,{context:t="preview"}={}){if(!e)return;const n=t==="preview",s=e.ownerDocument||document;e.setAttribute("data-quote-render-context",t);const o=e.querySelector("[data-quote-pages]"),c=e.querySelector("[data-quote-source]"),r=c?.querySelector("[data-quote-header-template]");if(!o||!c||!r)return;o.style.display="block",o.style.margin="0",o.style.padding="0",o.style.gap="0px",o.style.rowGap="0px",o.style.columnGap="0px",o.style.alignItems="stretch",o.style.justifyContent="flex-start",await Ps(c),await jt(c),o.innerHTML="";const u=Array.from(c.querySelectorAll(":scope > [data-quote-block]")),d=e.getAttribute(ut.context)||null,h=Vn(e,ut.blockOffsets),w=Vn(e,ut.infoAlignments),v=ot,j=d||h||w;j&&(ot={context:d||null,blockOffsets:h||null,infoAlignments:w||null});let b=null,y=null;const C=g=>{g.style.margin="0 auto",g.style.breakInside="avoid",g.style.pageBreakInside="avoid",g.style.pageBreakAfter="auto",g.style.breakAfter="auto"},X=()=>{const g=s.createElement("div"),S=o.childElementCount===0;if(g.className="quote-page",g.dataset.pageIndex=String(o.childElementCount),S){g.classList.add("quote-page--primary");const T=r.cloneNode(!0);T.removeAttribute("data-quote-header-template"),g.appendChild(T)}else g.classList.add("quote-page--continuation");const I=s.createElement("main");I.className="quote-body",g.appendChild(I),o.appendChild(g),C(g),b=g,y=I},k=()=>{(!b||!y||!y.isConnected)&&X()},_=()=>{if(!b||!y||y.childElementCount>0)return;const g=b;b=null,y=null,g.parentNode&&g.parentNode.removeChild(g)},Q=()=>{b=null,y=null},Y=()=>b?b.scrollHeight-b.clientHeight>Ss:!1,se=(g,{allowOverflow:S=!1}={})=>(k(),y.appendChild(g),Y()&&!S?(y.removeChild(g),_(),!1):!0),D=g=>{const S=g.cloneNode(!0);S.removeAttribute?.("data-quote-block"),S.removeAttribute?.("data-block-type"),S.removeAttribute?.("data-table-id"),!se(S)&&(Q(),!se(S)&&se(S,{allowOverflow:!0}))},z=g=>{const S=g.querySelector("table");if(!S){D(g);return}const I=g.querySelector("h3"),T=S.querySelector("thead"),oe=Array.from(S.querySelectorAll("tbody tr"));if(!oe.length){D(g);return}let M=null,le=0;const R=(N=!1)=>{const L=g.cloneNode(!1);L.removeAttribute("data-quote-block"),L.removeAttribute("data-block-type"),L.removeAttribute("data-table-id"),L.classList.add("quote-section--table-fragment"),N&&L.classList.add("quote-section--table-fragment--continued");const A=I?I.cloneNode(!0):null;A&&L.appendChild(A);const U=S.cloneNode(!1);U.classList.add("quote-table--fragment"),T&&U.appendChild(T.cloneNode(!0));const B=s.createElement("tbody");return U.appendChild(B),L.appendChild(U),{section:L,body:B}},$=(N=!1)=>M||(M=R(N),se(M.section)||(Q(),se(M.section)||se(M.section,{allowOverflow:!0})),M);oe.forEach(N=>{$(le>0);const L=N.cloneNode(!0);if(M.body.appendChild(L),Y()&&(M.body.removeChild(L),M.body.childElementCount||(y.removeChild(M.section),M=null,_()),Q(),M=null,$(le>0),M.body.appendChild(L),Y())){M.section.classList.add("quote-section--table-fragment--overflow"),le+=1;return}le+=1}),M=null;try{const N=g.querySelector(":scope > .quote-table-subtotal");N&&D(N)}catch{}};try{if(!u.length)return;u.forEach(R=>{R.getAttribute("data-block-type")==="table"?z(R):D(R)});const g=Array.from(o.children),S=[];if(g.forEach((R,$)=>{const N=R.querySelector(".quote-body");if($!==0&&(!N||N.childElementCount===0)){R.remove();return}S.push(R)}),!n){const R=s.defaultView||window,$=Math.min(3,Math.max(1,R.devicePixelRatio||1)),N=on()?Math.min(2,$):$;S.forEach(L=>ca(L,{pixelRatio:N}))}S.forEach((R,$)=>{const N=$===0;R.style.pageBreakAfter="auto",R.style.breakAfter="auto",R.style.pageBreakBefore=N?"auto":"always",R.style.breakBefore=N?"auto":"page",n?R.style.boxShadow="":R.style.boxShadow="none"});const I=S[S.length-1]||null;if(b=I,y=I?.querySelector(".quote-body")||null,await jt(o),!n)try{Do(e)}catch{}const T=R=>R&&typeof R=="object"&&Object.keys(R).length>0,M=kn[Ke(a||(d?{context:d}:null))]||{},le=T(h)?h:T(a?.blockOffsets)?a.blockOffsets:M;try{Io(e,le)}catch{}}finally{j&&(ot=v)}n&&(o.style.display="flex",o.style.flexDirection="column",o.style.alignItems="center",o.style.justifyContent="flex-start",o.style.rowGap="18px",o.style.columnGap="0px",o.style.gap="18px")}function Bs(e=0){return e<=0?new Promise(t=>requestAnimationFrame(()=>t())):new Promise(t=>setTimeout(t,e))}function Ks(e){return e?Array.from(e.querySelectorAll(".quote-page")).some(n=>n.scrollHeight-n.clientHeight>Ss):!1}function On(e,t="#000000"){if(!e)return;e.querySelectorAll('[style*="color"], [class*="text"], h1, h2, h3, h4, h5, h6, p, span, th, td, li, strong, em, label, dt, dd, caption, div').forEach(s=>{s instanceof HTMLElement&&s.style.setProperty("color",t,"important")})}async function Ea(e,{filename:t,safariWindowRef:n=null,mobileWindowRef:s=null}){if(!e)return;const o=Array.from(e.querySelectorAll(".quote-page"));if(!o.length)throw new Error("Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙØ­Ø§Øª Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§.");const[c,r]=await Promise.all([da(),ua()]),u=e.ownerDocument||document,d=u?.defaultView?.getComputedStyle?.(e)?.direction,w=[e.getAttribute?.("dir"),e.style?.direction,d,u?.documentElement?.getAttribute?.("dir")].some(D=>typeof D=="string"&&D.toLowerCase().startsWith("rtl")),v=typeof window<"u"&&window.devicePixelRatio||1,j=Nn(),b=Ns(),y=on();let C;y?C=1.5:b?C=Math.min(1.7,Math.max(1.2,v*1.1)):j?C=Math.min(1.8,Math.max(1.25,v*1.2)):C=Math.min(2,Math.max(1.6,v*1.4));const X=y||b?.9:j?.92:.95,k=new c({unit:"mm",format:"a4",orientation:"portrait",compress:!0}),_={scale:C,useCORS:!0,allowTaint:!1,backgroundColor:"#ffffff",letterRendering:!w,removeContainer:!1,logging:!0};let Q=0;const Y=i("reservations.quote.errors.browserLimit","ØªØ¹Ø°Ø± Ø¥ØªÙ…Ø§Ù… Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ø³Ø¨Ø¨ Ù‚ÙŠÙˆØ¯ Ø§Ù„Ù…ØªØµÙØ­ØŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø£Ùˆ ØªÙ‚Ù„ÙŠÙ„ Ø­Ø¬Ù… Ø§Ù„Ù…Ø­ØªÙˆÙ‰.");try{for(let D=0;D<o.length;D+=1){const z=o[D];await Ps(z),await jt(z);const g=z.ownerDocument||document,S=g.createElement("div");Object.assign(S.style,{position:"fixed",top:"0",left:"-12000px",pointerEvents:"none",zIndex:"-1",backgroundColor:"#ffffff"});const I=z.cloneNode(!0);I.style.width=`${Dt}px`,I.style.maxWidth=`${Dt}px`,I.style.minWidth=`${Dt}px`,I.style.height=`${Pt}px`,I.style.maxHeight=`${Pt}px`,I.style.minHeight=`${Pt}px`,I.style.position="relative",I.style.background="#ffffff",On(I),S.appendChild(I),g.body.appendChild(S);let T;try{await jt(I),T=await r(I,{..._,scale:C,backgroundColor:"#ffffff",scrollX:0,scrollY:0})}catch(A){throw hn(A,"pageCapture",{toastMessage:Y}),A}finally{S.parentNode?.removeChild(S)}if(!T)continue;const oe=T.width||1,le=(T.height||1)/oe;let R=pn,$=R*le,N=0;if($>It){const A=It/$;$=It,R=R*A,N=Math.max(0,(pn-R)/2)}const L=T.toDataURL("image/jpeg",X);Q>0&&k.addPage(),k.addImage(L,"JPEG",N,0,R,$,`page-${Q+1}`,"FAST"),Q+=1,await new Promise(A=>window.requestAnimationFrame(A))}}catch(D){throw bn({safariWindowRef:n,mobileWindowRef:s}),D}if(Q===0)throw bn({safariWindowRef:n,mobileWindowRef:s}),new Error("PDF generation produced no pages.");if(b||y){const D=k.output("blob");if(y){const z=URL.createObjectURL(D);$t();try{window.location.assign(z)}catch(g){Xe("mobile safari blob navigation failed",g)}finally{setTimeout(()=>URL.revokeObjectURL(z),6e4)}}else{const z=URL.createObjectURL(D),g=()=>b&&n&&!n.closed?n:s&&!s.closed?s:null,S=(T,oe)=>{if($t(),!T){window.location.assign(oe);return}try{T.location.replace(oe),T.focus?.()}catch(M){Xe("direct blob navigation failed",M);try{T.document.open(),T.document.write(`<!DOCTYPE html><html lang="ar" dir="rtl"><head><meta charset="utf-8"><title>${l(i("reservations.quote.actions.export","ØªÙ†Ø²ÙŠÙ„ PDF"))}</title><style>html,body{margin:0;height:100%;background:#0f172a;color:#f8fafc;font-family:'Tajawal',sans-serif;} iframe{border:none;width:100%;height:100%;display:block;}</style></head><body><iframe src="${oe}" title="PDF preview"></iframe></body></html>`),T.document.close()}catch(le){Xe("iframe blob delivery failed",le),window.location.assign(oe)}}},I=g();S(I,z),setTimeout(()=>URL.revokeObjectURL(z),6e4)}}else{$t();const D=k.output("bloburl"),z=document.createElement("a");z.href=D,z.download=t,z.rel="noopener",z.style.display="none",document.body.appendChild(z),z.click(),setTimeout(()=>{URL.revokeObjectURL(D),z.remove()},2e3)}}function we(){if(!a||!q)return;const{previewFrame:e}=q;if(!e)return;Qs();const t=a.context||"reservation",n=t==="reservationChecklist"?Cs():a.reservation,s=Rs({context:t,reservation:n||a.reservation,customer:a.customer,project:a.project,crewAssignments:a.crewAssignments,totals:a.totals,totalsDisplay:a.totalsDisplay,rentalDays:a.rentalDays,currencyLabel:a.currencyLabel,sections:a.sections,fieldSelections:a.fields,quoteNumber:a.quoteNumber,quoteDate:a.quoteDateLabel,terms:a.terms,checklistType:a.checklistType,checklistNotes:a.checklistNotes,checklistNotesTitle:a.checklistNotesTitle,hideLogo:!!a.hideLogo,hideCompany:!!a.hideCompany,headerOffset:Number(a.headerOffset||0),projectCrew:a.projectCrew,projectExpenses:a.projectExpenses,projectEquipment:a.projectEquipment,projectInfo:a.projectInfo,clientInfo:a.clientInfo,paymentSummary:a.paymentSummary,projectTotals:a.projectTotals,blockOffsets:a.blockOffsets,infoAlignments:a.infoAlignments});dt("render"),e.srcdoc=`<!DOCTYPE html>${s}`,e.addEventListener("load",async()=>{try{const o=e.contentDocument,c=o?.defaultView||window,r=o?.documentElement||o;r&&(is(r),ls(r,c),cs(r,c));const u=o?.getElementById("quotation-pdf-root");try{u&&(await Gt(u,{context:"preview"}),await Bs(120),Ks(u)&&await Gt(u,{context:"preview"}),On(u))}catch(y){console.error("[reservations/pdf] failed to layout preview document",y)}const d=Array.from(o?.querySelectorAll?.(".quote-page")||[]);try{if(a?.context==="reservationChecklist"&&a?.hideCompany){const C=o.querySelector(".quote-header");if(C&&!C.dataset.dragReady){C.style.cursor="grab";let X=!1,k=0,_=Number(a.headerOffset||0);const Q=D=>{X=!0,k=D.clientY||D.touches?.[0]?.clientY||0,_=Number(a.headerOffset||0),C.style.cursor="grabbing",o.addEventListener("mousemove",Y),o.addEventListener("mouseup",se,{once:!0}),o.addEventListener("touchmove",Y,{passive:!1}),o.addEventListener("touchend",se,{once:!0})},Y=D=>{if(!X)return;const g=(D.clientY||D.touches?.[0]?.clientY||0)-k,S=Math.max(0,Math.min(240,_+g));C.style.marginTop=`${S}px`,a.headerOffset=S,D.preventDefault?.()},se=()=>{X=!1,C.style.cursor="grab",o.removeEventListener("mousemove",Y),o.removeEventListener("touchmove",Y)};C.addEventListener("mousedown",Q),C.addEventListener("touchstart",Q,{passive:!0}),C.dataset.dragReady="true"}}}catch{}Ho(o),xn(o),nn();const h=o?.querySelector(".quote-preview-pages"),w=Dt;let v=18;if(h&&o?.defaultView){const y=o.defaultView.getComputedStyle(h),C=parseFloat(y.rowGap||y.gap||`${v}`);Number.isFinite(C)&&C>=0&&(v=C)}const j=Pt,b=d.length?d.length*j+Math.max(0,(d.length-1)*v):j;if(e.dataset.baseWidth=String(w),e.dataset.baseHeight=String(b),e.style.width=`${w}px`,e.style.minWidth=`${w}px`,e.style.height=`${b}px`,e.style.minHeight=`${b}px`,q?.previewFrameWrapper&&!q?.userAdjustedZoom){const y=q.previewFrameWrapper.clientWidth-24;y>0&&y<w?Be=Math.max(y/w,.3):Be=1}Hs(Be)}finally{$t()}},{once:!0})}function ja(e){if(!a)return;const t=e.currentTarget,n=t?.dataset?.sectionId;n&&(t.checked?a.sections.add(n):a.sections.delete(n),Os(a),Ft(),we())}function Ta(e){if(!a)return;const t=e.currentTarget,n=t?.dataset?.sectionId,s=t?.dataset?.fieldId;if(!n||!s)return;const o=a.context||"reservation",c=a.fields||(a.fields=Tt(o)),r=Go(c,n);t.checked?r.add(s):r.delete(s),Os(a),we()}function Na(e){if(!a)return;const t=e.currentTarget,n=t?.dataset?.sectionId;n&&(Tn(a,n),a.sectionExpansions[n]=t.open)}function Ft(){if(!q?.toggles||!a)return;const{toggles:e}=q,t=a.fields||{},n=a.context||"reservation";Tn(a);const s=en(n),o=fs(n),c=s.map(({id:r,labelKey:u,fallback:d})=>{const h=i(u,d),w=a.sections.has(r),v=o[r]||[],j=Wo(a,r),b=v.length?`<div class="quote-toggle-sublist">
          ${v.map(y=>{const C=jn(t,r,y.id),X=w?"":"disabled",k=y.labelKey?i(y.labelKey,y.fallback):y.fallback;return`
              <label class="quote-toggle quote-toggle--field">
                <input type="checkbox" data-field-toggle data-section-id="${r}" data-field-id="${y.id}" ${C?"checked":""} ${X}>
                <span>${l(k)}</span>
              </label>
            `}).join("")}
        </div>`:"";return`
      <details class="quote-toggle-group" data-section-group data-section-id="${r}" ${j?"open":""}>
        <summary class="quote-toggle-summary">
          <label class="quote-toggle quote-toggle--section">
            <input type="checkbox" data-section-toggle data-section-id="${r}" ${w?"checked":""}>
            <span>${l(h)}</span>
          </label>
          ${v.length?'<span class="quote-toggle-caret" aria-hidden="true"></span>':""}
        </summary>
        ${b}
      </details>
    `}).join("");e.innerHTML=c,e.querySelectorAll("input[data-section-toggle]").forEach(r=>{r.addEventListener("change",ja)}),e.querySelectorAll("input[data-field-toggle]").forEach(r=>{r.addEventListener("change",Ta)}),e.querySelectorAll("details[data-section-group]").forEach(r=>{r.addEventListener("toggle",Na)})}function La(){if(q?.modal)return q;const e=document.createElement("div");e.id="reservationQuoteModal",e.className="modal fade quote-preview-modal",e.tabIndex=-1,e.setAttribute("aria-labelledby","reservationQuoteModalLabel"),e.setAttribute("aria-hidden","true"),e.style.display="none",e.innerHTML=`
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="reservationQuoteModalLabel">${l(i("reservations.quote.previewTitle","Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¹Ø±Ø¶ Ø³Ø¹Ø±"))}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="quote-preview-layout">
            <aside class="quote-preview-sidebar">
              <h6>${l(i("reservations.quote.toggleHeading","Ø­Ø¯Ø¯ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø¯ ØªØµØ¯ÙŠØ±Ù‡Ø§"))}</h6>
              <div class="quote-toggle-list" data-quote-toggles></div>
              <div class="quote-meta-info" data-quote-meta></div>
              <div class="quote-terms-editor" data-quote-terms-editor>
                <label class="quote-terms-editor__label" for="quote-terms-input">${l(i("reservations.quote.termsEditor.title","Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø¹Ø§Ù…Ø© (Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„)"))}</label>
                <textarea id="quote-terms-input" class="quote-terms-editor__textarea" rows="6" data-quote-terms-input placeholder="${l(i("reservations.quote.termsEditor.placeholder","Ø§ÙƒØªØ¨ ÙƒÙ„ Ø´Ø±Ø· ÙÙŠ Ø³Ø·Ø± Ù…Ø³ØªÙ‚Ù„"))}"></textarea>
                <button type="button" class="quote-terms-reset" data-quote-terms-reset>${l(i("reservations.quote.termsEditor.reset","Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©"))}</button>
              </div>
            </aside>
            <section class="quote-preview-panel">
              <div class="quote-preview" data-quote-preview></div>
            </section>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-light" data-bs-dismiss="modal">${l(i("reservations.quote.actions.close","Ø¥ØºÙ„Ø§Ù‚"))}</button>
          <button type="button" class="btn btn-primary" data-quote-download>
            ${l(i("reservations.quote.actions.export","ðŸ“„ ØªÙ†Ø²ÙŠÙ„ PDF"))}
          </button>
        </div>
      </div>
    </div>
  `,document.body.appendChild(e);const t=e.querySelector("[data-quote-toggles]"),n=e.querySelector("[data-quote-preview]"),s=e.querySelector("[data-quote-meta]"),o=e.querySelector("[data-quote-terms-input]"),c=e.querySelector("[data-quote-terms-reset]"),r=e.querySelector("[data-quote-download]"),u=e.querySelector(".modal-header"),d=u?.querySelector(".btn-close"),h=Array.from(e.querySelectorAll('[data-bs-dismiss="modal"]')),w=document.createElement("div");w.className="quote-preview-header-actions",u&&u.insertBefore(w,d||null);const v=[],j=(L=null)=>{v.forEach(A=>{A!==L&&(A.menu.hidden=!0,A.toggle.setAttribute("aria-expanded","false"),A.wrapper.classList.remove("is-open"))})},b=(L,A,U)=>{v.push({wrapper:L,toggle:A,menu:U})},y=L=>{if(!v.length)return;const A=L.target;v.some(B=>B.wrapper.contains(A))||j()};document.addEventListener("click",y),document.addEventListener("keydown",L=>{L.key==="Escape"&&j()});const C=({label:L,icon:A,content:U})=>{const B=document.createElement("div");B.className="quote-controls-dropdown";const ae=document.createElement("button");ae.type="button",ae.className="quote-controls-dropdown__toggle",ae.setAttribute("aria-haspopup","true"),ae.setAttribute("aria-expanded","false"),ae.innerHTML=`
      ${A?`<span class="quote-controls-dropdown__icon" aria-hidden="true">${l(A)}</span>`:""}
      <span class="quote-controls-dropdown__label">${l(L)}</span>
      <span class="quote-controls-dropdown__caret" aria-hidden="true">â–¾</span>
    `;const ue=document.createElement("div");return ue.className="quote-controls-dropdown__menu",ue.hidden=!0,ue.appendChild(U),B.appendChild(ae),B.appendChild(ue),ae.addEventListener("click",He=>{He.stopPropagation();const be=B.classList.contains("is-open");j(),be||(B.classList.add("is-open"),ue.hidden=!1,ae.setAttribute("aria-expanded","true"))}),b(B,ae,ue),B},X=document.createElement("iframe");X.className="quote-preview-frame",X.setAttribute("title",i("reservations.quote.previewTitle","Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¹Ø±Ø¶ Ø³Ø¹Ø±")),X.setAttribute("loading","lazy"),X.setAttribute("frameborder","0");const k=document.createElement("div");k.className="quote-preview-zoom-controls",k.innerHTML=`
    <button type="button" class="quote-preview-zoom-btn" data-zoom-out title="${l(i("reservations.quote.zoom.out","ØªØµØºÙŠØ±"))}">âˆ’</button>
    <span class="quote-preview-zoom-value" data-zoom-value>100%</span>
    <button type="button" class="quote-preview-zoom-btn" data-zoom-in title="${l(i("reservations.quote.zoom.in","ØªÙƒØ¨ÙŠØ±"))}">+</button>
    <button type="button" class="quote-preview-zoom-btn" data-zoom-reset title="${l(i("reservations.quote.zoom.reset","Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¶Ø¨Ø·"))}">1:1</button>
  `;const _=document.createElement("div");_.className="quote-preview-zoom-controls quote-preview-drag-controls",_.innerHTML=`
    <button type="button" class="quote-preview-zoom-btn" data-block-drag-toggle title="${l(i("reservations.quote.drag.enable","ÙˆØ¶Ø¹ ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø¨Ù„ÙˆÙƒØ§Øª"))}" aria-label="${l(i("reservations.quote.drag.enable","ÙˆØ¶Ø¹ ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø¨Ù„ÙˆÙƒØ§Øª"))}">
      <span aria-hidden="true">â†•ï¸</span>
    </button>
    <button type="button" class="quote-preview-zoom-btn" data-block-drag-save disabled title="${l(i("reservations.quote.drag.save","ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ÙˆØ§Ø¶Ø¹"))}" aria-label="${l(i("reservations.quote.drag.save","ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ÙˆØ§Ø¶Ø¹"))}">
      <span aria-hidden="true">ðŸ’¾</span>
    </button>
    <button type="button" class="quote-preview-zoom-btn" data-block-drag-reset title="${l(i("reservations.quote.drag.resetBtn","ØªØµÙÙŠØ± Ø§Ù„Ù…ÙˆØ§Ø¶Ø¹"))}" aria-label="${l(i("reservations.quote.drag.resetBtn","ØªØµÙÙŠØ± Ø§Ù„Ù…ÙˆØ§Ø¶Ø¹"))}">
      <span aria-hidden="true">âŸ²</span>
    </button>
  `;const Q=document.createElement("div");Q.className="quote-preview-zoom-controls quote-preview-align-controls";const Y=l(i("reservations.quote.align.customer","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„")),se=l(i("reservations.quote.align.reservation","ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²")),D=l(i("reservations.quote.align.project","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"));Q.innerHTML=`
    <select class="quote-preview-align-select" data-align-target>
      <option value="customer">${Y}</option>
      <option value="reservation">${se}</option>
      <option value="project">${D}</option>
    </select>
    <div class="quote-preview-align-buttons">
      <button type="button" class="quote-preview-zoom-btn" data-align-value="left" title="${l(i("reservations.quote.align.left","Ù…Ø­Ø§Ø°Ø§Ø© ÙŠØ³Ø§Ø±"))}">â¬…ï¸</button>
      <button type="button" class="quote-preview-zoom-btn" data-align-value="center" title="${l(i("reservations.quote.align.center","Ù…Ø­Ø§Ø°Ø§Ø© ÙˆØ³Ø·"))}">â†”ï¸</button>
      <button type="button" class="quote-preview-zoom-btn" data-align-value="right" title="${l(i("reservations.quote.align.right","Ù…Ø­Ø§Ø°Ø§Ø© ÙŠÙ…ÙŠÙ†"))}">âž¡ï¸</button>
    </div>
    <button type="button" class="quote-preview-zoom-btn" data-layout-export title="${l(i("reservations.quote.align.export","Ù†Ø³Ø® Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©"))}">ðŸ“‹</button>
  `;const z=document.createElement("div");z.className="quote-preview-frame-wrapper",z.appendChild(X),n.innerHTML="";const g=document.createElement("div");g.className="quote-preview-scroll",g.appendChild(z),n.appendChild(g);const S=document.createElement("div");S.className="quote-preview-status",S.setAttribute("role","status"),S.setAttribute("aria-live","polite"),S.hidden=!0,S.innerHTML=`
    <span class="quote-preview-spinner" data-quote-status-spinner aria-hidden="true"></span>
    <span data-quote-status-text>${l(hs("render"))}</span>
    <button type="button" class="quote-preview-status-action" data-quote-status-action hidden></button>
  `,n.appendChild(S);const I=i("reservations.quote.dropdown.drag","Ø§Ù„ØªØ­Ø±ÙŠÙƒ"),T=i("reservations.quote.dropdown.align","Ø§Ù„Ù…Ø­Ø§Ø°Ø§Ø©"),oe=C({label:I,icon:"ðŸŽšï¸",content:_}),M=C({label:T,icon:"ðŸ“",content:Q});w.appendChild(k),w.appendChild(oe),w.appendChild(M),r?.addEventListener("click",async()=>{if(a){r.disabled=!0;try{await zs()}finally{r.disabled=!1}}});const le=()=>{mn()||yn(e)};h.forEach(L=>{L?.addEventListener("click",le)}),d&&!h.includes(d)&&d.addEventListener("click",le),e.addEventListener("click",L=>{mn()||L.target===e&&yn(e)}),q={modal:e,toggles:t,preview:n,previewScroll:g,previewFrameWrapper:z,zoomControls:k,zoomValue:k.querySelector("[data-zoom-value]"),previewFrame:X,meta:s,downloadBtn:r,statusIndicator:S,statusText:S.querySelector("[data-quote-status-text]"),statusSpinner:S.querySelector("[data-quote-status-spinner]"),statusAction:S.querySelector("[data-quote-status-action]"),termsInput:o,termsReset:c,statusKind:null,userAdjustedZoom:!1,blockDragToggle:_.querySelector("[data-block-drag-toggle]"),blockDragSave:_.querySelector("[data-block-drag-save]"),blockDragReset:_.querySelector("[data-block-drag-reset]"),alignTarget:Q.querySelector("[data-align-target]"),alignButtons:Array.from(Q.querySelectorAll("[data-align-value]")),layoutExportBtn:Q.querySelector("[data-layout-export]")};const R=k.querySelector("[data-zoom-out]"),$=k.querySelector("[data-zoom-in]"),N=k.querySelector("[data-zoom-reset]");return R?.addEventListener("click",()=>es(-.1)),$?.addEventListener("click",()=>es(.1)),N?.addEventListener("click",()=>Wt(1,{markManual:!0})),q.blockDragToggle?.addEventListener("click",()=>Po(!vt)),q.blockDragSave?.addEventListener("click",Fo),q.blockDragReset?.addEventListener("click",Oo),q.alignTarget?.addEventListener("change",()=>nn()),(q.alignButtons||[]).forEach(L=>{L.addEventListener("click",()=>{const A=q.alignTarget?.value||"customer",U=L.dataset.alignValue||"right";Bo(A,U)})}),q.layoutExportBtn?.addEventListener("click",Ko),tn(),Qs(),o&&o.addEventListener("input",Ia),c&&c.addEventListener("click",Da),Wt(Be),q}function Wt(e,{silent:t=!1,markManual:n=!1}={}){Be=Math.min(Math.max(e,.25),2.2),n&&q&&(q.userAdjustedZoom=!0),Hs(Be),!t&&q?.zoomValue&&(q.zoomValue.textContent=`${Math.round(Be*100)}%`)}function es(e){Wt(Be+e,{markManual:!0})}function Hs(e){if(!q?.previewFrame||!q.previewFrameWrapper)return;const t=q.previewFrame,n=q.previewFrameWrapper,s=Number(t.dataset.baseWidth)||794,o=Number(t.dataset.baseHeight)||t.contentDocument?.body?.scrollHeight||1123;t.style.transform=`scale(${e})`,t.style.transformOrigin="top center",Nn()?(n.style.width="100%",n.style.maxWidth="100%",n.style.minWidth="0"):(n.style.width=`${s}px`,n.style.maxWidth=`${s}px`,n.style.minWidth=`${s}px`),n.style.minHeight=`${o}px`,n.style.height=`${o}px`}function Ot(){if(!q?.meta||!a)return;const{meta:e}=q;(a.context||"reservation")==="reservationChecklist"?e.innerHTML=`
      <div class="quote-meta-card">
        <div><span>${l(i("reservations.quote.labels.dateGregorian","Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ"))}</span><strong>${l(a.quoteDateLabel)}</strong></div>
      </div>
    `:e.innerHTML=`
      <div class="quote-meta-card">
        <div><span>${l(i("reservations.quote.labels.number","Ø±Ù‚Ù… Ø¹Ø±Ø¶ Ø³Ø¹Ø±"))}</span><strong>${l(a.quoteNumber)}</strong></div>
        <div><span>${l(i("reservations.quote.labels.dateGregorian","Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ"))}</span><strong>${l(a.quoteDateLabel)}</strong></div>
      </div>
    `}function Mn(){if(!q?.termsInput)return;const e=(a?.terms&&a.terms.length?a.terms:Ee).join(`
`);q.termsInput.value!==e&&(q.termsInput.value=e)}function Ia(e){if(!a)return;const t=un(e?.target?.value??"");if(t.length){a.terms=t;const n=document.getElementById("reservation-terms");n&&(n.value=e.target.value);const s=document.getElementById("edit-res-terms");s&&(s.value=e.target.value)}else{a.terms=[...Ee],Mn();const n=Ee.join(`
`),s=document.getElementById("reservation-terms");s&&(s.value=n);const o=document.getElementById("edit-res-terms");o&&(o.value=n)}we()}function Da(e){if(e?.preventDefault?.(),!a)return;a.terms=[...Ee];const t=document.getElementById("reservation-terms");t&&(t.value=Ee.join(`
`));const n=document.getElementById("edit-res-terms");n&&(n.value=Ee.join(`
`)),Mn(),we()}async function zs(){if(!a)return;dt("export");const t=!Nn()&&Ns(),n=on(),s=null,o=!n&&t?window.open("","_blank"):null;(d=>{if(d)try{d.document.open(),d.document.write(`<!DOCTYPE html><html lang="ar" dir="rtl"><head><meta charset="utf-8"><title>${l(i("reservations.quote.status.exporting","Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ù…Ù„Ù PDF..."))}</title><style>body{font-family:'Tajawal',sans-serif;margin:0;height:100vh;display:flex;align-items:center;justify-content:center;background:#0f172a;color:#f8fafc;text-align:center;padding:24px;} .loader{width:42px;height:42px;border-radius:50%;border:4px solid rgba(248,250,252,0.35);border-top-color:#38bdf8;animation:spin 1s linear infinite;margin:0 auto 18px;}@keyframes spin{to{transform:rotate(360deg);}} h1{margin:0 0 6px;font-size:1.05rem;} p{margin:0;font-size:0.9rem;opacity:0.8;}</style></head><body><div><div class="loader" aria-hidden="true"></div><h1>${l(i("reservations.quote.status.exporting","Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ù…Ù„Ù PDF..."))}</h1><p>${l(i("reservations.quote.status.exportingHint","Ù‚Ø¯ ÙŠØ³ØªØºØ±Ù‚ Ø°Ù„Ùƒ Ø¨Ø¶Ø¹ Ø«ÙˆØ§Ù†ÙØŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±..."))}</p></div></body></html>`),d.document.close()}catch(h){Xe("failed to prime download window",h)}})(o);let r=null;const u=i("reservations.quote.errors.browserLimit","ØªØ¹Ø°Ø± Ø¥ØªÙ…Ø§Ù… Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ø³Ø¨Ø¨ Ù‚ÙŠÙˆØ¯ Ø§Ù„Ù…ØªØµÙØ­ØŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø£Ùˆ ØªÙ‚Ù„ÙŠÙ„ Ø­Ø¬Ù… Ø§Ù„Ù…Ø­ØªÙˆÙ‰.");try{await pa(),cn("html2pdf ensured");const d=a.context||"reservation",h=d==="reservationChecklist"?Cs():a.reservation,w=Rs({context:d,reservation:h||a.reservation,customer:a.customer,project:a.project,crewAssignments:a.crewAssignments,totals:a.totals,totalsDisplay:a.totalsDisplay,rentalDays:a.rentalDays,currencyLabel:a.currencyLabel,sections:a.sections,fieldSelections:a.fields,quoteNumber:a.quoteNumber,quoteDate:a.quoteDateLabel,terms:a.terms,checklistType:a.checklistType,checklistNotes:a.checklistNotes,checklistNotesTitle:a.checklistNotesTitle,hideLogo:!!a.hideLogo,hideCompany:!!a.hideCompany,headerOffset:Number(a.headerOffset||0),projectCrew:a.projectCrew,projectExpenses:a.projectExpenses,projectEquipment:a.projectEquipment,projectInfo:a.projectInfo,clientInfo:a.clientInfo,paymentSummary:a.paymentSummary,projectTotals:a.projectTotals,blockOffsets:a.blockOffsets,infoAlignments:a.infoAlignments});r=document.createElement("div"),r.innerHTML=w,Object.assign(r.style,{position:"fixed",top:"0",left:"0",pointerEvents:"none",zIndex:"-1"}),document.body.appendChild(r),is(r),ls(r),cs(r),cn("export container prepared");const v=r.firstElementChild;if(v){try{const b=typeof ce=="function"?ce():v.getAttribute("data-lang")||"ar",C=a?.context==="reservationChecklist"&&b==="en"?"ltr":"rtl";v.setAttribute("dir",C),v.style.direction=C,v.setAttribute("data-lang",b),v.style.textAlign=""}catch{}v.setAttribute("data-theme","light"),v.classList.remove("dark","dark-mode"),v.style.margin="0",v.style.padding="0",v.style.width="210mm",v.style.maxWidth="210mm",v.style.marginLeft="auto",v.style.marginRight="auto",v.scrollTop=0,v.scrollLeft=0;try{await Gt(v,{context:"export"}),await Bs(120),Ks(v)&&await Gt(v,{context:"export"}),await jt(v),On(v),cn("layout complete for export document")}catch(b){hn(b,"layoutQuoteDocument",{suppressToast:!0})}}const j=d==="reservationChecklist"?(()=>{const b=a?.reservation?.reservationCode||a?.reservation?.reservationId||a?.reservation?.id||"res",y=a?.checklistType==="crew"?"crew":a?.checklistType==="both"?"equipment-crew":"equipment";return`checklist-${String(b)}-${y}.pdf`})():`quotation-${a.quoteNumber}.pdf`;await Ea(v,{filename:j,safariWindowRef:o,mobileWindowRef:s})}catch(d){bn({container:r,safariWindowRef:o,mobileWindowRef:s}),r=null,hn(d,"exportQuoteAsPdf",{toastMessage:u})}finally{r&&r.parentNode&&r.parentNode.removeChild(r),$t()}}function Rn(){const e=La();if(e?.modal){if(_t=!1,Be=1,q&&(q.userAdjustedZoom=!1),Wt(Be,{silent:!0}),a?.context==="reservationChecklist")try{const t=e.modal.querySelector("#reservationQuoteModalLabel"),n=e.modal.querySelector(".quote-preview-sidebar"),s=e.modal.querySelector("[data-quote-terms-editor]");s&&(s.style.display="none");let o=n.querySelector("[data-checklist-controls]");if(!o){o=document.createElement("div"),o.setAttribute("data-checklist-controls","");const c=l(i("reservations.checklist.controls.items","Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª")),r=l(i("reservations.checklist.controls.crew","Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ")),u=l(i("reservations.checklist.controls.both","Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙˆØ§Ù„Ø·Ø§Ù‚Ù… Ø§Ù„ÙÙ†ÙŠ")),d=l(i("reservations.checklist.controls.hideLogo","Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø´Ø¹Ø§Ø±")),h=l(i("reservations.checklist.controls.hideCompany","Ø¥Ø®ÙØ§Ø¡ Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©")),w=l(i("reservations.checklist.controls.notes.title","Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù„Ø³ØªØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)")),v=l(i("reservations.checklist.controls.notes.placeholder","Ø§ÙƒØªØ¨ Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø®Ø§ØµØ© Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ù„Ø³ØªØ©")),j=typeof ce=="function"?ce():"ar",b=l(j==="en"?i("language.toggle.labelAr","ðŸ‡¸ðŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"):i("language.toggle.labelEn","ðŸ‡¬ðŸ‡§ English")),y=l(i("reservations.checklist.controls.lessors.title","ðŸ¢ ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¤Ø¬Ø±")),C=l(i("reservations.checklist.controls.lessors.clear","Ø¥Ø¸Ù‡Ø§Ø± ÙƒÙ„ Ø§Ù„Ù…Ø¤Ø¬Ø±ÙŠÙ†"));o.innerHTML=`
          <div class="quote-meta-card" style="margin-bottom:10px">
            <div style="display:flex;gap:10px;flex-wrap:wrap">
              <label style="display:flex;align-items:center;gap:6px">
                <input type="radio" name="checklist-type" value="items" checked>
                <span data-i18n data-i18n-key="reservations.checklist.controls.items">${c}</span>
              </label>
              <label style="display:flex;align-items:center;gap:6px">
                <input type="radio" name="checklist-type" value="crew">
                <span data-i18n data-i18n-key="reservations.checklist.controls.crew">${r}</span>
              </label>
              <label style="display:flex;align-items:center;gap:6px">
                <input type="radio" name="checklist-type" value="both">
                <span data-i18n data-i18n-key="reservations.checklist.controls.both">${u}</span>
              </label>
            </div>
          </div>
          <div class="quote-meta-card" style="margin-bottom:10px">
            <div style="display:flex;gap:8px;flex-wrap:wrap">
              <button type="button" class="btn btn-sm btn-light" data-checklist-lang>${b}</button>
              <label style="display:flex;align-items:center;gap:6px">
                <input type="checkbox" data-checklist-hide-logo>
                <span data-i18n data-i18n-key="reservations.checklist.controls.hideLogo">${d}</span>
              </label>
              <label style="display:flex;align-items:center;gap:6px">
                <input type="checkbox" data-checklist-hide-company>
                <span data-i18n data-i18n-key="reservations.checklist.controls.hideCompany">${h}</span>
              </label>
            </div>
          </div>
          <div class="quote-terms-editor" data-checklist-notes>
            <label class="quote-terms-editor__label" for="checklist-notes-title-input" data-i18n data-i18n-key="reservations.checklist.controls.notes.titleLabel">${l(i("reservations.checklist.controls.notes.titleLabel","Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª"))}</label>
            <input id="checklist-notes-title-input" class="quote-terms-editor__input" type="text" value="${l(i("reservations.checklist.controls.notes.sectionTitleDefault","Ù…Ù„Ø§Ø­Ø¸Ø§Øª"))}" data-i18n-value-key="reservations.checklist.controls.notes.sectionTitleDefault">
            <label class="quote-terms-editor__label" for="checklist-notes-input" data-i18n data-i18n-key="reservations.checklist.controls.notes.title">${w}</label>
            <textarea id="checklist-notes-input" class="quote-terms-editor__textarea" rows="4" data-i18n-placeholder-key="reservations.checklist.controls.notes.placeholder" placeholder="${v}"></textarea>
          </div>
          <div class="quote-meta-card" data-checklist-lessors hidden>
            <div style="display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:6px;">
              <span data-i18n data-i18n-key="reservations.checklist.controls.lessors.title">${y}</span>
              <button type="button" class="btn btn-sm btn-outline-secondary" data-lessor-clear>${C}</button>
            </div>
            <div data-lessor-options style="display:flex;flex-direction:column;gap:6px;"></div>
          </div>
        `,n.prepend(o),o.querySelectorAll('input[name="checklist-type"]').forEach(g=>{g.addEventListener("change",()=>{const S=o.querySelector('input[name="checklist-type"]:checked')?.value||"items";a.checklistType=S==="crew"||S==="both"?S:"items";const I=new Set(["customerInfo","reservationInfo","projectInfo","notes"]);if(a.checklistType==="crew"?I.add("crew"):a.checklistType==="both"?(I.add("items"),I.add("crew")):I.add("items"),a.sections=I,t){const T=ce?.()||"ar",oe=a.checklistType==="crew"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ":a.checklistType==="both"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙˆØ§Ù„Ø·Ø§Ù‚Ù… Ø§Ù„ÙÙ†ÙŠ":"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",M=a.checklistType==="crew"?"Crew List":a.checklistType==="both"?"Equipment & Crew List":"Equipment List";t.textContent=T==="en"?M:oe}Ft(),Ot(),we()})});const k=o.querySelector("#checklist-notes-input"),_=o.querySelector("#checklist-notes-title-input"),Q=()=>{try{const g=ce?.()||"ar",S=g==="en"?"ltr":"rtl",I=g==="en"?"left":"right";k&&(k.setAttribute("dir",S),k.style.textAlign=I),_&&(_.setAttribute("dir",S),_.style.textAlign=I)}catch{}};Q();try{const g=()=>Q();document.addEventListener("language:changed",g),o._onLangChanged=g}catch{}k.addEventListener("input",g=>{a.checklistNotes=String(g.target.value||""),we()}),_.addEventListener("input",g=>{a.checklistNotesTitle=String(g.target.value||""),we()});const Y=o.querySelector("[data-checklist-lang]");if(Y){const g=()=>{const S=ce?.()||"ar";Y.textContent=S==="ar"?"ðŸ‡¬ðŸ‡§ English":"ðŸ‡¸ðŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"};g(),Y.addEventListener("click",()=>{const I=(ce?.()||"ar")==="ar"?"en":"ar";try{eo?.(I)}catch{}if(g(),Q(),t){const T=ce?.()||"ar",oe=a.checklistType,M=oe==="crew"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ":oe==="both"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙˆØ§Ù„Ø·Ø§Ù‚Ù… Ø§Ù„ÙÙ†ÙŠ":"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",le=oe==="crew"?"Crew List":oe==="both"?"Equipment & Crew List":"Equipment List";t.textContent=T==="en"?le:M}Ft(),Ot(),we()})}const se=o.querySelector("[data-checklist-hide-logo]"),D=o.querySelector("[data-checklist-hide-company]");(()=>{se&&(se.checked=!!a.hideLogo),D&&(D.checked=!!a.hideCompany)})(),se?.addEventListener("change",g=>{a.hideLogo=!!g.target.checked,we()}),D?.addEventListener("change",g=>{a.hideCompany=!!g.target.checked,we()})}e.checklistControls=o,e.checklistLessorContainer=o.querySelector("[data-checklist-lessors]"),e.checklistLessorOptionsHost=o.querySelector("[data-lessor-options]"),Ut(),t&&(t.textContent=a.checklistType==="crew"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ":"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª");try{e.previewFrame?.setAttribute("title","Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù„Ø³ØªØ©")}catch{}}catch{}Ft(),Ot(),Mn(),we(),Uo(e.modal)}}async function Ua({reservation:e,customer:t,project:n}){if(!e){at(i("reservations.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø²"));return}await Fn();const s=an(e),{totalsDisplay:o,totals:c,rentalDays:r}=Pn(e,s,n),u=i("reservations.create.summary.currency","SR"),h=(b=>{if(!b)return"1";const C=[b.reservationCode,b.reservation_code,b.reservationId,b.reservation_id,b.id].find(_=>_!=null&&String(_).trim()!==""),X=E(String(C??"1"));return X.replace(/\D+/g,"")||X||"1"})(e),w=Number.parseInt(h,10)||1,v=new Date,j=go();a={context:"reservation",reservation:e,customer:t,project:n,crewAssignments:s,totals:c,totalsDisplay:o,rentalDays:r,currencyLabel:u,projectCrew:[],projectExpenses:[],projectEquipment:[],sections:new Set(en("reservation").filter(b=>b.defaultSelected).map(b=>b.id)),sectionExpansions:sn("reservation"),fields:Tt("reservation"),terms:j,quoteSequence:w,quoteNumber:h,quoteDate:v,quoteDateLabel:Dn(v),sequenceCommitted:!1},Et=!1,In(a),_n(a),Cn(a),Rn();try{vn()}catch{}}async function Va({reservation:e,customer:t,project:n}){if(!e){at(i("reservations.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø²"));return}await Fn();const s=an(e),{totalsDisplay:o,totals:c,rentalDays:r}=Pn(e,s,n),u=i("reservations.create.summary.currency","SR"),d=new Date;a={context:"reservationChecklist",reservation:e,customer:t,project:n,crewAssignments:s,totals:c,totalsDisplay:o,rentalDays:r,currencyLabel:u,checklistType:"items",checklistNotes:"",projectCrew:[],projectExpenses:[],projectEquipment:[],sections:new Set(["customerInfo","reservationInfo","projectInfo","notes","items"]),sectionExpansions:sn("reservationChecklist"),fields:Tt("reservationChecklist"),terms:[],quoteDate:d,quoteDateLabel:Dn(d),sequenceCommitted:!1},a.checklistLessorFilter=new Set,a.checklistLessorOptions=[],a.checklistEquipmentLookup=Sn(),Et=!1,$s(),In(a),_n(a),Cn(a),Rn();try{vn()}catch{}}async function Ga({project:e}){if(!e){at(i("projects.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"));return}await Fn();let t=Zn(e);const{project:n}=t;if(!n){at(i("projects.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"));return}try{(!Array.isArray(t.equipmentItems)||t.equipmentItems.length===0)&&n?.id!=null&&(await so({project_id:n.id}),t=Zn(n))}catch(d){console.warn("[reservationPdf] refreshReservationsForProject failed, proceeding with snapshot/state",d)}const o=(d=>{if(!d)return"1";const w=[d.projectCode,d.project_code,d.code,d.id].find(b=>b!=null&&String(b).trim()!==""),v=E(String(w??"1"));return v.replace(/\D+/g,"")||v||"1"})(n),c=Number.parseInt(o,10)||1,r=new Date,u=[...bo];a={context:"project",reservation:null,customer:t.customer,project:n,technicians:t.crew||[],clientInfo:t.clientInfo,projectInfo:t.projectInfo,projectCrew:t.crew,projectExpenses:t.expenses,projectEquipment:t.equipment,equipmentItems:t.equipmentItems||[],crewAssignments:t.crewAssignments||[],totals:t.totals,projectTotals:t.projectTotals,totalsDisplay:t.totalsDisplay,rentalDays:t.projectDurationDays,currencyLabel:t.currencyLabel,sections:new Set(en("project").filter(d=>d.defaultSelected).map(d=>d.id)),sectionExpansions:sn("project"),fields:Tt("project"),terms:u,quoteSequence:c,quoteNumber:o,quoteDate:r,quoteDateLabel:Dn(r),sequenceCommitted:!1,paymentSummary:t.paymentSummary,projectNotes:t.notes,paymentHistory:t.paymentHistory},Et=!1,In(a),_n(a),Cn(a),Rn();try{vn()}catch{}}function Pa(e="reservation"){return e==="project"?[{value:"projectCustomer",label:i("projects.quote.sections.customer","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„")},{value:"projectDetails",label:i("projects.quote.sections.project","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹")}]:[{value:"customer",label:i("reservations.quote.sections.customer","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„")},{value:"reservation",label:i("reservations.quote.sections.reservation","ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²")},{value:"project",label:i("reservations.quote.sections.project","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹")}]}function Qs(){if(!q?.alignTarget)return;const e=a?.context||"reservation",t=Pa(e),n=q.alignTarget,s=n.value;n.innerHTML=t.map(o=>`<option value="${l(o.value)}">${l(o.label)}</option>`).join(""),t.some(o=>o.value===s)?n.value=s:n.value=t[0]?.value||"",nn()}export{Ua as a,Va as b,Ga as e,za as g,us as r,Qa as s};
