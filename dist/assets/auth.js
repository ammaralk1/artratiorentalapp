(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}})();const Te={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_BASE_URL:"http://127.0.0.1:8000/api"},Ae="/backend/api";class b extends Error{constructor(t,{status:n,payload:r}={}){super(t),this.name="ApiError",this.status=n??null,this.payload=r??null}}function Ee(){const e=typeof import.meta<"u"&&Te&&"http://127.0.0.1:8000/api",t=typeof window<"u"?window.APP_API_BASE:null;return String(e||t||Ae).replace(/\/$/,"")}async function P(e,{method:t="GET",headers:n={},body:r,signal:o,credentials:a="include"}={}){const s=e.startsWith("/")?e:`/${e}`,l=`${Ee()}${s}`,u={Accept:"application/json",...n},i={method:t,headers:u,signal:o,credentials:a};r!==void 0&&(r instanceof FormData?(delete u["Content-Type"],i.body=r):typeof r=="string"?(u["Content-Type"]=u["Content-Type"]||"application/json",i.body=r):(u["Content-Type"]=u["Content-Type"]||"application/json",i.body=JSON.stringify(r)));const c=await fetch(l,i),v=c.headers.get("content-type")||"";let m=null;if(v.includes("application/json"))try{m=await c.json()}catch{throw new b("Failed to parse server response as JSON",{status:c.status})}else{const f=await c.text();m=f?{raw:f}:null}if(!c.ok){const f=m?.error||`Request failed with status ${c.status}`;throw new b(f,{status:c.status,payload:m})}if(m&&typeof m=="object"&&m.ok===!1){const f=m.error||"API returned an error response";throw new b(f,{status:c.status,payload:m})}return m}const g=Object.freeze({language:"ar",theme:"light",dashboardTab:null,dashboardSubTab:null,projectsTab:null,projectsSubTab:null});let h=null,N=null;const B=new Set,re="__ART_RATIO_SKIP_PREF_FETCH__",oe="__ART_RATIO_PREFERENCES__";function ae(){try{return typeof window>"u"?!1:!!window[re]}catch{return!1}}function Se(){try{typeof window<"u"&&delete window[re]}catch{}}function _(e={}){const t=e.language==="en"?"en":"ar",n=e.theme==="dark"?"dark":"light",r=typeof e.dashboardTab=="string"?O(e.dashboardTab):null,o=typeof e.dashboardSubTab=="string"?O(e.dashboardSubTab):null,a=typeof e.projectsTab=="string"?O(e.projectsTab):null,s=typeof e.projectsSubTab=="string"?O(e.projectsSubTab):null;return{language:t,theme:n,dashboardTab:r,dashboardSubTab:o,projectsTab:a,projectsSubTab:s}}function O(e){const t=String(e||"").trim();return t&&/^[a-z0-9\-]+$/i.test(t)?t:null}function we(){try{if(typeof window>"u"||!window.localStorage)return null;const e=window.localStorage.getItem(oe);if(!e)return null;const t=JSON.parse(e);return _(t)}catch(e){return console.warn("⚠️ [preferencesService] Failed to read cached preferences",e),null}}function _e(e){try{if(typeof window>"u"||!window.localStorage)return;window.localStorage.setItem(oe,JSON.stringify(e))}catch(t){console.warn("⚠️ [preferencesService] Failed to persist preferences",t)}}const Y=we();Y&&(h=Y);function Le(){const e=d();B.forEach(t=>{try{t(e)}catch(n){console.error("⚠️ [preferencesService] listener failed",n)}})}function T(e){const n={...h?{...h}:{...g},...e};h=_(n),_e(h),Le()}function d(){return h?{...h}:null}function se(e){if(typeof e!="function")return()=>{};if(B.add(e),h)try{e(d())}catch(t){console.error("⚠️ [preferencesService] listener failed",t)}return()=>{B.delete(e)}}function ie({refresh:e=!1}={}){if(ae()){const t=d()||{...g};return Promise.resolve(t)}return!e&&h?Promise.resolve(d()):(N||(N=P("/preferences/").then(t=>{const n=t?.data??g;return T(n),d()}).catch(t=>t instanceof b&&t.status===401?(h=null,g):(console.warn("⚠️ [preferencesService] Failed to load preferences",t),T(g),g)).finally(()=>{N=null})),N)}function ve(e=null){if(!e){const t=d();return _(t||g)}return _(e)}async function G(e={}){if(ae())return T(e),d()||{...g};e.language!==void 0&&e.language,e.theme!==void 0&&e.theme,e.dashboardTab!==void 0&&e.dashboardTab,e.dashboardSubTab!==void 0&&e.dashboardSubTab,e.projectsTab!==void 0&&e.projectsTab,e.projectsSubTab!==void 0&&e.projectsSubTab;const t=ve(),n={...t,...e},r=_(n),o={},a={};["language","theme","dashboardTab","dashboardSubTab","projectsTab","projectsSubTab"].forEach(i=>{if(e[i]===void 0)return;const c=r[i],v=t[i];c!==v&&(o[i]=c,(i==="language"||i==="theme")&&(a[i]=c))});const l=Object.keys(o).length>0,u=Object.keys(a).length>0;if(!u&&!l)return d();if(!u&&l)return T(r),d();try{const i=await P("/preferences/",{method:"PATCH",body:a});return T(i?.data??g),l&&T({...d(),...o}),d()}catch(i){if(i instanceof b&&i.status===422)return console.warn("⚠️ [preferencesService] Server rejected preference update (no changes)."),T(r),d();throw i}}const A="ar",Ce="ar",je="language-loading",J="language-ready",ce=["Placeholder","Title","AriaLabel","AriaDescription","Value"],j={ar:Object.create(null),en:Object.create(null)};let E=A,I=!1,x=null;function D(e){return e==="en"?"en":"ar"}function ue(){if(!x){const e=d();if(e?.language){const t=D(e.language);C(t,{persist:!1,dispatch:!1})}x=ie().then(t=>{const n=D(t?.language??A);return C(n,{persist:!1}),I=!0,n}).catch(t=>(console.warn("⚠️ تعذر تحميل تفضيل اللغة من الخادم",t),C(A,{persist:!1}),I=!0,A))}return x}function De(e){if(e.dataset.i18nCached==="true")return;e.dataset.i18nHtml==="true"?e.dataset.arHtml===void 0&&(e.dataset.arHtml=e.innerHTML):e.dataset.ar===void 0&&(e.dataset.ar=e.textContent),ce.forEach(n=>{const r=n.charAt(0).toLowerCase()+n.slice(1),o=e.getAttribute(r);o!=null&&e.dataset[`ar${n}`]===void 0&&(e.dataset[`ar${n}`]=o)}),e.dataset.i18nCached="true"}function W(e,t){if(!t)return;const n=j[e]??(j[e]=Object.create(null));Object.entries(t).forEach(([r,o])=>{typeof r=="string"&&(n[r]=o)})}function Q(e,t){if(!t)return;const n=j[e];return n?n[t]:void 0}function ke(e,t){De(e);const n=e.dataset.i18nHtml==="true",r=e.dataset.i18nKey,o=Q(t,r);o!==void 0?n?e.innerHTML=o:e.textContent=o:t==="en"?n?e.dataset.enHtml!==void 0&&(e.innerHTML=e.dataset.enHtml):e.dataset.en!==void 0&&(e.textContent=e.dataset.en):n?e.innerHTML=e.dataset.arHtml??e.innerHTML:e.textContent=e.dataset.ar??e.textContent,ce.forEach(a=>{const s=a.charAt(0).toLowerCase()+a.slice(1),l=e.dataset[`i18n${a}Key`],u=Q(t,l);if(u!==void 0){e.setAttribute(s,u);return}const i=t==="en"?`en${a}`:`ar${a}`,c=e.dataset[i];c!==void 0&&e.setAttribute(s,c)})}function le(e){document.querySelectorAll("[data-i18n]").forEach(n=>ke(n,e))}function Pe(e){const t=document.documentElement,n=document.body,r=e===Ce?"rtl":"ltr";t.setAttribute("lang",e),t.setAttribute("dir",r),n&&(n.setAttribute("dir",r),n.dataset.lang=e)}function Re(){const e=document.documentElement;e&&(e.classList.contains(J)||(e.classList.remove(je),e.classList.add(J)))}function de(e){document.querySelectorAll(".language-toggle-btn").forEach(t=>{const n=t.dataset.labelAr||"🇸🇦 العربية",r=t.dataset.labelEn||"🇬🇧 English";t.textContent=e==="en"?n:r,t.setAttribute("aria-pressed",e==="en"?"true":"false")})}function C(e,{persist:t=!1,dispatch:n=!0}={}){const r=D(e);E===r&&I&&!t||(E=r,I=!0,Pe(r),le(r),de(r),Re(),n&&document.dispatchEvent(new CustomEvent("language:changed",{detail:{language:r}})),t&&G({language:r}).catch(o=>{console.warn("⚠️ تعذر حفظ تفضيل اللغة في الخادم",o)}))}function Ne(){Me(E==="ar"?"en":"ar")}function me(){document.querySelectorAll(".language-toggle-btn").forEach(t=>{t.dataset.listenerAttached||(t.addEventListener("click",()=>{Ne()}),t.dataset.listenerAttached="true")}),de(E)}function Oe(e={}){W("ar",e.ar),W("en",e.en);const t=z();le(t),document.dispatchEvent(new CustomEvent("language:translationsReady",{detail:{language:t}}))}function y(e,t=""){if(!e)return t;const n=E||A,r=j[n];if(r&&r[e]!==void 0)return r[e];const a=j[n==="en"?"ar":"en"];return a&&a[e]!==void 0?a[e]:t}function Me(e){const t=D(e);C(t,{persist:!0})}function ot(){ue().catch(()=>A).finally(()=>{me()})}function z(){return E}function X(){ue().catch(()=>A),me()}se(e=>{e&&e.language&&D(e.language)!==E&&C(e.language,{persist:!1})});document.readyState==="loading"?document.addEventListener("DOMContentLoaded",X,{once:!0}):X();Oe({ar:{"actions.logout":"🚪 تسجيل الخروج","actions.toggleTheme":"🌙 الوضع الليلي","theme.toggle.toLight":"☀️ الوضع العادي","theme.toggle.toDark":"🌙 الوضع الليلي","theme.toggle.titleLight":"التبديل إلى الوضع العادي","theme.toggle.titleDark":"التبديل إلى الوضع الليلي","theme.toggle.ariaLight":"الوضع العادي مفعل","theme.toggle.ariaDark":"الوضع الليلي مفعل","common.boolean.yes":"نعم","common.boolean.no":"لا","language.toggle.labelAr":"🇸🇦 العربية","language.toggle.labelEn":"🇬🇧 English","login.pageTitle":"تسجيل الدخول","login.header.title":"🔐 تسجيل الدخول","login.header.subtitle":"أدخل بيانات الحساب للوصول إلى لوحة التحكم.","login.form.username":"اسم المستخدم","login.form.username.placeholder":"أدخل اسم المستخدم","login.form.password":"كلمة المرور","login.form.password.placeholder":"أدخل كلمة المرور","login.form.submit":"دخول","login.footer.note":"محمي لأعضاء فريق Art Ratio. تواصل معنا إذا واجهت مشكلة في تسجيل الدخول.","actions.clearFilters":"🔄 إعادة التصفية","actions.view":"👁️ عرض","actions.delete":"🗑️ حذف","actions.remove":"إزالة","auth.permissions.denied":"⚠️ ليس لديك صلاحية لتنفيذ هذا الإجراء","home.nav.brand":"لوحة التحكم","home.hero.title":"مرحباً بك","home.hero.subtitle":"اختر المسار المناسب لإدارة أعمالك.","home.hero.greetingUser":"مرحباً {name}","home.bookings.title":"إدارة الحجوزات","home.bookings.description":"الوصول إلى لوحة التحكم الكاملة لإدارة الحجوزات، المعدات، الصيانة، والطاقم.","home.bookings.button":"انتقال إلى لوحة التحكم","home.projects.title":"إدارة المشاريع","home.projects.description":"إنشاء ومتابعة المشاريع، توزيع الطاقم والمعدات، وتتبع المصروفات المرتبطة بكل مشروع.","home.projects.button":"فتح لوحة المشاريع","home.users.title":"إدارة المستخدمين","home.users.description":"إنشاء المستخدمين، تعديل الصلاحيات، والاطلاع على سجلات الجلسات والنشاط.","home.users.button":"إدارة المستخدمين","actions.refresh":"🔄 تحديث البيانات","home.summary.title":"📊 ملخص سريع","home.summary.subtitle":"أرقام مختصرة تساعدك على اتخاذ القرار بسرعة.","home.summary.loading":"⏳ جارٍ جلب بيانات النظام...","home.summary.error":"تعذر تحميل بيانات النظام، حاول لاحقاً","home.summary.empty":"لا تتوفر بيانات بعد. ابدأ بإضافة سجلات.","home.summary.customers":"إجمالي العملاء","home.summary.reservationsToday":"حجوزات اليوم","home.summary.reservationsUpcoming":"حجوزات قادمة","home.summary.projectsActive":"مشاريع نشطة","home.summary.equipmentMaintenance":"معدات قيد الصيانة","home.summary.maintenanceHigh":"بلاغات صيانة عاجلة","home.summary.techniciansBusy":"أعضاء طاقم مشغولون"},en:{"actions.logout":"🚪 Log Out","actions.toggleTheme":"🌙 Dark Mode","theme.toggle.toLight":"☀️ Light Mode","theme.toggle.toDark":"🌙 Dark Mode","theme.toggle.titleLight":"Switch to Light Mode","theme.toggle.titleDark":"Switch to Dark Mode","theme.toggle.ariaLight":"Light mode enabled","theme.toggle.ariaDark":"Dark mode enabled","common.boolean.yes":"Yes","common.boolean.no":"No","language.toggle.labelAr":"🇸🇦 Arabic","language.toggle.labelEn":"🇬🇧 English","login.pageTitle":"Log In","login.header.title":"🔐 Log In","login.header.subtitle":"Enter your account credentials to access the dashboard.","login.form.username":"Username","login.form.username.placeholder":"Enter username","login.form.password":"Password","login.form.password.placeholder":"Enter password","login.form.submit":"Sign In","login.footer.note":"Restricted to Art Ratio team members. Contact us if you run into any login issues.","actions.clearFilters":"🔄 Reset filters","actions.view":"👁️ View","actions.delete":"🗑️ Delete","actions.remove":"Remove","auth.permissions.denied":"⚠️ You do not have permission to perform this action","home.nav.brand":"Control Panel","home.hero.title":"Welcome","home.hero.subtitle":"Choose the best path to manage your operations.","home.hero.greetingUser":"Welcome {name}","home.bookings.title":"Bookings Management","home.bookings.description":"Access the full dashboard for bookings, equipment, maintenance, and crew.","home.bookings.button":"Open Dashboard","home.projects.title":"Projects Management","home.projects.description":"Create and follow up on projects, assign crew and equipment, and track expenses.","home.projects.button":"Open Projects Hub","home.users.title":"User Management","home.users.description":"Create accounts, adjust roles, and review session and activity logs.","home.users.button":"Manage Users","actions.refresh":"🔄 Refresh data","home.summary.title":"📊 Quick Snapshot","home.summary.subtitle":"Key metrics that keep you informed at a glance.","home.summary.loading":"⏳ Fetching system metrics...","home.summary.error":"Unable to load system metrics. Please try again later.","home.summary.empty":"No data yet. Start by adding your first records.","home.summary.customers":"Total Customers","home.summary.reservationsToday":"Reservations Today","home.summary.reservationsUpcoming":"Upcoming Reservations","home.summary.projectsActive":"Active Projects","home.summary.equipmentMaintenance":"Equipment in Maintenance","home.summary.maintenanceHigh":"Urgent Maintenance Tickets","home.summary.techniciansBusy":"Crew Members Busy"}});const w="dark-mode",M=new WeakSet,Z="theme-loading",fe="art-ratio:session-theme";let ee=!1;function he(){return Array.from(document.querySelectorAll("[data-theme-toggle], .theme-toggle-btn"))}function ge(e){return e==="dark"?"dark":"light"}function Ie(e){try{window.sessionStorage?.setItem(fe,ge(e))}catch{}}function Ue(){try{const e=window.sessionStorage?.getItem(fe);return e==="dark"?"dark":e==="light"?"light":null}catch{return null}}function xe(){document.documentElement.classList.remove(Z);const e=document.body;e&&e.classList.remove(Z)}function U(e,{persist:t=!0}={}){const n=ge(e),r=document.documentElement,o=document.body;n==="dark"?(r.classList.add(w,"dark"),o&&o.classList.add(w,"dark")):(r.classList.remove(w,"dark"),o&&o.classList.remove(w,"dark"));const a=n==="dark"?"dark":"light";r.setAttribute("data-theme",a),o&&o.setAttribute("data-theme",a),Ie(n),$(n);try{document.dispatchEvent(new CustomEvent("theme:changed",{detail:{theme:n}}))}catch(s){console.warn("⚠️ [theme.js] Failed to dispatch theme change event",s)}t&&G({theme:n}).catch(s=>{console.warn("⚠️ تعذر حفظ تفضيل السمة في الخادم",s)})}function R(){const e=document.body;return e&&e.classList.contains(w)||document.documentElement.classList.contains(w)?"dark":"light"}function F(){const e=R()==="dark"?"light":"dark";U(e,{persist:!0})}function Fe(e,t){if(!e)return;const n=t==="dark",r=y("theme.toggle.toLight","☀️ الوضع العادي"),o=y("theme.toggle.toDark","🌙 الوضع الليلي"),a=y("theme.toggle.ariaLight","الوضع العادي مفعل"),s=y("theme.toggle.ariaDark","الوضع الليلي مفعل"),l=y("theme.toggle.titleLight","التبديل إلى الوضع العادي"),u=y("theme.toggle.titleDark","التبديل إلى الوضع الليلي");if(e.matches("[data-theme-toggle]")){const i=e.matches("input")?e:e.querySelector('input[type="checkbox"]'),c=n?r:o,v=n?a:s,m=n?l:u;i&&(i.checked=n,i.setAttribute("aria-label",c),i.setAttribute("aria-checked",String(n))),e.setAttribute("title",m),e.setAttribute("aria-label",v),e.setAttribute("data-theme-state",n?"dark":"light");const f=e.querySelector("[data-theme-label]");f&&(f.textContent=c)}else e.textContent=n?r:o,e.setAttribute("aria-pressed",String(n)),e.setAttribute("title",n?l:u),e.setAttribute("aria-label",n?a:s)}function $(e){he().forEach(t=>Fe(t,e)),xe()}function qe(){const e=he();$(R()),e.forEach(t=>{if(!(!t||M.has(t))){if(t.matches("[data-theme-toggle]")){const n=t.matches("input")?t:t.querySelector('input[type="checkbox"]'),r=()=>{F()};n&&!M.has(n)?(n.addEventListener("change",r),M.add(n)):n||t.addEventListener("click",o=>{o.preventDefault(),F()})}else t.getAttribute("type")||t.setAttribute("type","button"),t.addEventListener("click",n=>{n.preventDefault(),F()});M.add(t)}})}function at({skipRemote:e=!1}={}){const t=d(),o=(t?.theme==="dark"?"dark":t?.theme==="light"?"light":null)||Ue()||He();U(o,{persist:!1}),Be({skipRemote:e})}function He(){try{if(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches)return"dark"}catch{}return"light"}function Be({skipRemote:e=!1}={}){ee||(ee=!0,!e&&ie().then(t=>{const n=t?.theme==="dark"?"dark":t?.theme==="light"?"light":null;n&&U(n,{persist:!1})}).catch(t=>{console.warn("⚠️ تعذر تحميل تفضيل السمة من الخادم",t)}))}document.addEventListener("language:changed",()=>{$(R()),qe()});se(e=>{const t=e?.theme==="dark"?"dark":e?.theme==="light"?"light":null;t&&t!==R()&&U(t,{persist:!1})});function K(){const e=typeof window<"u"?window:globalThis;return e.__APP_DATA_STORE__||(e.__APP_DATA_STORE__={customers:[],reservations:[],equipment:[],technicians:[],maintenance:[],projects:[]}),e.__APP_DATA_STORE__}function S(e,t,n){n!=null&&(e[t]=Array.isArray(n)?[...n]:n)}function ze(){const e=K();return{customers:[...e.customers],reservations:[...e.reservations],equipment:[...e.equipment],technicians:[...e.technicians],maintenance:[...e.maintenance],projects:[...e.projects]}}function st({customers:e,reservations:t,equipment:n,technicians:r,maintenance:o,projects:a}){const s=K();S(s,"customers",e),S(s,"reservations",t),S(s,"equipment",n),S(s,"technicians",r),S(s,"maintenance",o),S(s,"projects",a)}let q=!1;function it(e=null){if(q)return;const t=e||(typeof window<"u"?window.__LEGACY_DATA__:null);if(!t||typeof t!="object"){q=!0;return}const n=K();if(["customers","reservations","equipment","technicians","maintenance","projects"].forEach(o=>{const a=t[o];Array.isArray(a)&&a.length>0&&(n[o]=[...a])}),q=!0,!e&&typeof window<"u")try{delete window.__LEGACY_DATA__}catch{}}function V(e,t=3e3){let n=document.getElementById("toast-container");n||(n=document.createElement("div"),n.id="toast-container",n.style.position="fixed",n.style.top="20px",n.style.left="50%",n.style.transform="translateX(-50%)",n.style.zIndex="9999",document.body.appendChild(n));const r=document.createElement("div");r.className="toast-message",r.textContent=e,r.style.background="#333",r.style.color="#fff",r.style.padding="10px 20px",r.style.marginTop="10px",r.style.borderRadius="6px",r.style.boxShadow="0 2px 6px rgba(0,0,0,0.3)",r.style.opacity="0",r.style.transition="opacity 0.3s ease",n.appendChild(r),setTimeout(()=>r.style.opacity="1",10),setTimeout(()=>{r.style.opacity="0",setTimeout(()=>r.remove(),300)},t)}const te="RSV",ne="PRJ",Ge=4,L=(()=>{try{const e=typeof globalThis<"u"?globalThis:window;return e.__APP_SEQUENCE_STATE__=e.__APP_SEQUENCE_STATE__||{reservation:0,project:0},e.__APP_SEQUENCE_STATE__}catch{return{reservation:0,project:0}}})();function $e(){return Number.isFinite(L.reservation)?L.reservation:0}function Ke(e){L.reservation=Math.max(0,Number.parseInt(e,10)||0)}function Ve(){return Number.isFinite(L.project)?L.project:0}function Ye(e){L.project=Math.max(0,Number.parseInt(e,10)||0)}function pe(){try{const e=ze();return{reservations:Array.isArray(e?.reservations)?e.reservations:[],projects:Array.isArray(e?.projects)?e.projects:[]}}catch(e){return console.warn("⚠️ [utils] Failed to load data snapshot for code generation",e),{reservations:[],projects:[]}}}function Je(e,t){if(e==null)return 0;if(typeof e=="number")return Number.isFinite(e)?Math.max(0,Math.trunc(e)):0;const n=String(e).trim();if(!n)return 0;const r=`${t.toUpperCase()}-`,o=n.toUpperCase();let a=n;o.startsWith(r)&&(a=n.slice(r.length));const s=a.match(/(\d+)$/);if(s){const u=Number.parseInt(s[1],10);return Number.isFinite(u)?Math.max(0,u):0}const l=Number.parseInt(n,10);return Number.isFinite(l)?Math.max(0,l):0}function We(e){return Array.isArray(e)?e:[e]}function be(e,t,n){return!Array.isArray(e)||e.length===0?0:e.reduce((r,o)=>{const a=n(o),l=We(a).reduce((u,i)=>{const c=Je(i,t);return c>u?c:u},0);return l>r?l:r},0)}function ye(e,t){const n=Math.max(0,Number.parseInt(t,10)||0);return`${e}-${String(n).padStart(Ge,"0")}`}function ct(){const{reservations:e}=pe(),t=be(e,te,r=>[r?.reservationCode,r?.reservation_code,r?.reservationId,r?.reservation_id,r?.id]),n=Math.max(t,$e())+1;return Ke(n),ye(te,n)}function ut(){const{projects:e}=pe(),t=be(e,ne,r=>[r?.projectCode,r?.project_code,r?.code,r?.id]),n=Math.max(t,Ve())+1;return Ye(n),ye(ne,n)}function lt(e,t={}){if(!e)return"-";const n=new Date(e);if(Number.isNaN(n.getTime()))return"-";const r=document?.documentElement?.getAttribute("lang")||(typeof z=="function"?z():null)||"ar",a=String(r).toLowerCase().startsWith("ar")?"ar-SA-u-ca-gregory":"en-US",l=new Intl.DateTimeFormat(a,{dateStyle:"short",timeStyle:"short",hour12:!0,calendar:"gregory",...t}).formatToParts(n),u=n.getHours()>=12?"PM":"AM",i=l.map(c=>c.type==="dayPeriod"?u:c.value).join("").replace(/\u200f/g,"");return Qe(i)}function Qe(e){if(e==null)return"";e=String(e);const t=["٠","١","٢","٣","٤","٥","٦","٧","٨","٩"],n=["0","1","2","3","4","5","6","7","8","9"];return e.split("").map(r=>{const o=t.indexOf(r);return o>-1?n[o]:r}).join("")}const Xe="❌ بيانات الدخول غير صحيحة";let p=null;const Ze={USER_UPDATED:"auth:user-updated"};function et(e){if(typeof document>"u")return;const t=document.documentElement;t&&(e?t.dataset.userRole=e:delete t.dataset.userRole)}function tt(){typeof document>"u"||document.dispatchEvent(new CustomEvent(Ze.USER_UPDATED,{detail:p?{...p}:null}))}function k(e){if(e&&typeof e=="object"){const t=typeof e.role=="string"?e.role.trim().toLowerCase():null;p={id:Number.isFinite(e.id)?Number(e.id):null,username:String(e.username||""),loginAt:e.loginAt??null,role:t}}else p=null;et(p?.role||""),tt()}function H(e=Xe){V(e);const t=document.getElementById("login-error");t&&(t.innerText=e)}async function dt(e,t){const n=(e||"").trim(),r=t||"";if(!n||!r){H();return}try{const o=await P("/auth/",{method:"POST",body:{username:n,password:r}});k(o?.data??null);try{await G({theme:R()})}catch(a){console.warn("⚠️ تعذر حفظ تفضيل السمة بعد تسجيل الدخول",a)}Se(),window.location.href="home.html"}catch(o){console.error("❌ فشل تسجيل الدخول",o),k(null),o instanceof b&&o.message?H(o.message):H()}}async function mt(){try{await P("/auth/",{method:"DELETE"})}catch(e){console.warn("⚠️ فشل تسجيل الخروج من الخادم",e)}finally{k(null),V("🚪 تم تسجيل الخروج"),window.location.href="login.html"}}async function nt({refresh:e=!1}={}){if(!e&&p)return p;try{const t=await P("/auth/");return k(t?.data??null),p}catch(t){throw t instanceof b&&t.status===401&&k(null),t}}function ft({redirect:e=!0}={}){return nt({refresh:!0}).then(t=>(!t&&e&&(window.location.href="login.html"),t)).catch(t=>t instanceof b&&t.status===401?(e&&(window.location.href="login.html"),null):(console.error("❌ خطأ أثناء التحقق من الجلسة",t),e&&(window.location.href="login.html"),null))}function rt(){return p?.role||null}function ht(){return rt()==="admin"}function gt(){V(y("auth.permissions.denied","⚠️ ليس لديك صلاحية لتنفيذ هذا الإجراء"),"error")}export{b as A,at as a,P as b,ft as c,z as d,ze as e,Ze as f,nt as g,V as h,qe as i,ht as j,lt as k,mt as l,it as m,Qe as n,gt as o,d as p,ie as q,se as r,st as s,y as t,G as u,ot as v,dt as w,Oe as x,ut as y,ct as z};
