import{w as p,x as y,j as n,t as o}from"./auth.HRDYAhvq.js";import{s as w,r as h}from"./equipment.2oeEXQzI.js";import{s as g}from"./state.Ciy5LqAy.js";import{g as f,j as F,x as l,a as R,K as A,r as S}from"./reservationsService.6kMlQZ28.js";function v(){const r=()=>{w(),h(),g()};if(typeof window<"u"){if(typeof window.requestIdleCallback=="function"){window.requestIdleCallback(r,{timeout:200});return}if(typeof window.requestAnimationFrame=="function"){window.requestAnimationFrame(r);return}}r()}let u=!1,d=null;function j(r){if(!r||typeof r!="object")return"";const a=Object.entries(r).filter(([s,e])=>e!=null).map(([s,e])=>[s,String(e)]);return a.length===0?"":JSON.stringify(a.sort(([s],[e])=>s.localeCompare(e)))}async function k(r={}){const{suppressError:a=!0,params:s=null,force:e=!1}=r??{},i=j(s);if(!e&&u&&f().length>0&&i===d)return f();try{const t=await S(s||{});return u=!0,d=i,t}catch(t){if(console.error("❌ [reservationsActions] Failed to load reservations from API",t),!a)throw t;return f()}}async function C(r,{onAfterChange:a}={}){if(!p())return y(),!1;const e=f()[r];if(!e)return n(o("reservations.toast.notFound","⚠️ تعذر العثور على بيانات الحجز")),!1;const i=e.id||e.reservationId;if(!i)return n(o("reservations.toast.notFound","⚠️ تعذر العثور على بيانات الحجز")),!1;try{return await F(i),v(),a?.({type:"deleted",reservation:e}),n(o("reservations.toast.deleted","🗑️ تم حذف الحجز")),!0}catch(t){console.error("❌ [reservationsActions] deleteReservation failed",t);const c=l(t)?t.message:o("reservations.toast.deleteFailed","تعذر حذف الحجز، حاول مرة أخرى");return n(c,"error"),!1}}async function E(r,{onAfterChange:a}={}){const e=f()[r];if(!e)return n(o("reservations.toast.notFound","⚠️ تعذر العثور على بيانات الحجز")),!1;const i=e.id||e.reservationId;if(!i)return n(o("reservations.toast.notFound","⚠️ تعذر العثور على بيانات الحجز")),!1;const{projectLinked:t}=R(e);if(t)return n(o("reservations.toast.confirmBlockedByProject","⚠️ حالة هذا الحجز تتحكم بها حالة المشروع المرتبط ولا يمكن تأكيده من هنا"),"info"),!1;try{const c=await A(i);return v(),a?.({type:"confirmed",reservation:c}),n(o("reservations.toast.confirmed","✅ تم تأكيد الحجز")),!0}catch(c){console.error("❌ [reservationsActions] confirmReservation failed",c);const m=l(c)?c.message:o("reservations.toast.confirmFailed","تعذر تأكيد الحجز، حاول مرة أخرى");return n(m,"error"),!1}}export{E as c,C as d,k as e};
