const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./reservationsUI.DhTbOZvF.js","./auth.DosFGXpu.js","./auth.Db9-ZDk1.css","./details.D3YTmwbp.js","./state.B8nukEs0.js","./reservationsService.CGMlYuIv.js","./uiBridge.CZ52ZDcj.js","./reservationsFilters.I9-AbYg0.js","./view.DsU2yTUC.js","./reservationPdf.DJYiRgD1.js","./quotePdf.WC1ebubv.js","./canvasColorUtils.CviLtv6S.js","./reservationsActions.JNbCxOo6.js","./projectsService.CcNn8Yfo.js"])))=>i.map(i=>d[i]);
import{r as de,t as d,n as D,d as kt,b as mt,a as ue,c as me,i as he,j as W,l as pe}from"./auth.DosFGXpu.js";import"./dashboard.CKRim6jK.js";import{g as Rt,b as fe,e as ge}from"./projectFocusTemplates.BspTJB-F.js";import{o as ye}from"./projectDetails.iH38KzV6.js";import{_ as Yt,s as be,b as ve}from"./uiBridge.CZ52ZDcj.js";import{s as Lt,r as Qt,g as Jt}from"./state.B8nukEs0.js";import{r as Xt}from"./reservationsFilters.I9-AbYg0.js";import{e as Zt}from"./reservationsActions.JNbCxOo6.js";import{ensureProjectsLoaded as De,getProjectsState as Ee,refreshProjectsFromApi as Ae}from"./projectsService.CcNn8Yfo.js";import{a as Bt,g as ht,r as we,b as Ie}from"./reservationsService.CGMlYuIv.js";import{d as Mt,s as ft}from"./view.DsU2yTUC.js";import{i as Fe}from"./dashboardShell.DF2kUed9.js";import{initDashboardMetrics as Se}from"./dashboardMetrics.pOGXsfxP.js";import"./reservationPdf.DJYiRgD1.js";import"./quotePdf.WC1ebubv.js";import"./canvasColorUtils.CviLtv6S.js";de({ar:{"technicianDetails.pageTitle":"Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…","technicianDetails.title":"ğŸ˜ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…","technicianDetails.actions.back":"â¬…ï¸ Ø§Ù„Ø¹ÙˆØ¯Ø©","technicianDetails.actions.edit":"âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…","technicianDetails.hero.subtitle":"Ø±Ø§Ø¬Ø¹ Ù†Ø´Ø§Ø· Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù… ÙˆÙ…Ù‡Ø§Ù…Ù‡ Ø§Ù„Ø­Ø§Ù„ÙŠØ©.","technicianDetails.hero.helper":"Ø§Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø­Ø¬ÙˆØ²Ø§Øª ÙˆÙ…Ø´Ø§Ø±ÙŠØ¹ Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù….","technicianTabs.reservations":"ğŸ“… Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„ÙÙ†ÙŠ","technicianTabs.projects":"ğŸ“ Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„ÙÙ†ÙŠ","technicianFinancial.stats.total":"ğŸ’¼ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø§Øª","technicianFinancial.stats.paid":"ğŸ’° Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©","technicianFinancial.stats.outstanding":"ğŸ§¾ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ","technicianFinancial.stats.totalDesc":"Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù€ {count} Ù…Ù‡Ø§Ù…","technicianFinancial.stats.paidDesc":"ØªÙ… ØªØ³Ø¬ÙŠÙ„ {count} Ø¯ÙØ¹Ø§Øª","technicianFinancial.stats.outstandingDesc":"Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ {amount}","technicianFinancial.actions.viewDetails":"ğŸ“Š Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„","technicianFinancial.modal.title":"ğŸ“Š Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ Ù„Ù„ÙÙ†ÙŠ","technicianFinancial.modal.subtitle":"Ù†Ø¸Ø±Ø© ØªÙØµÙŠÙ„ÙŠØ© Ø¹Ù„Ù‰ Ù…Ø³ØªØ­Ù‚Ø§Øª Ø§Ù„Ø¹Ø¶Ùˆ ÙˆØ§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ÙˆØ§Ù„Ø­Ø§Ù„ÙŠØ©.","technicianFinancial.list.title":"ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª ÙˆØ§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹","technicianFinancial.assignments.empty":"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø¬ÙˆØ²Ø§Øª Ø£Ùˆ Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…Ø±ØªØ¨Ø·Ø© Ù„Ø¹Ø±Ø¶Ù‡Ø§.","technicianFinancial.list.reservation":"Ø§Ù„Ø­Ø¬Ø² / Ø§Ù„Ù…Ø´Ø±ÙˆØ¹","technicianFinancial.list.period":"Ø§Ù„ÙØªØ±Ø©","technicianFinancial.list.due":"Ø§Ù„Ù…Ø³ØªØ­Ù‚","technicianFinancial.list.status":"Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹","technicianFinancial.list.outstanding":"Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ","technicianFinancial.list.settled":"Ù„Ø§ ÙŠÙˆØ¬Ø¯","technicianFinancial.list.reservationFallback":"Ø­Ø¬Ø² Ø±Ù‚Ù… {id}","technicianFinancial.list.projectReference":"Ù…Ø´Ø±ÙˆØ¹ #{id}","technicianFinancial.status.paid":"Ù…Ø¯ÙÙˆØ¹","technicianFinancial.status.partial":"Ù…Ø¯ÙÙˆØ¹ Ø¬Ø²Ø¦ÙŠØ§Ù‹","technicianFinancial.status.unpaid":"ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹","technicianFinancial.payouts.title":"ğŸ’¸ Ø³Ø¬Ù„ Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©","technicianFinancial.payouts.helper":"Ø³Ø¬Ù‘Ù„ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„ØªÙŠ ØªÙ… Ø¯ÙØ¹Ù‡Ø§ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø¶Ùˆ Ù…Ù† Ø§Ù„Ø´Ø±ÙƒØ© Ù„Ø¶Ù…Ø§Ù† ØªØªØ¨Ø¹ Ø§Ù„Ø³Ø¯Ø§Ø¯.","technicianFinancial.payouts.empty":"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯ÙØ¹Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ø¨Ø¹Ø¯.","technicianFinancial.payouts.form.amount":"ğŸ’° Ø§Ù„Ù…Ø¨Ù„Øº","technicianFinancial.payouts.form.date":"ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯ÙØ¹","technicianFinancial.payouts.form.note":"ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)","technicianFinancial.payouts.form.notePlaceholder":"Ù…Ø«Ø§Ù„: Ø¯ÙØ¹Ø© Ø³Ø±ÙŠØ¹Ø© Ø£Ùˆ Ù…Ø±Ø¬Ø¹ Ø§Ù„ØªØ­ÙˆÙŠÙ„","technicianFinancial.payouts.form.submit":"ğŸ’¸ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯ÙØ¹Ø©","technicianFinancial.payouts.confirmDelete":"âŒ Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¯ÙØ¹Ø©ØŸ","technicianFinancial.payouts.confirmTitle":"ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ø¯ÙØ¹Ø©","technicianFinancial.payouts.confirmMessage":"Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¯ÙØ¹Ø©ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.","technicianFinancial.payouts.confirmCancel":"Ø¥Ù„ØºØ§Ø¡","technicianFinancial.payouts.confirmAccept":"ğŸ—‘ï¸ Ø­Ø°Ù","technicianFinancial.payouts.toast.added":"âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯ÙØ¹Ø©.","technicianFinancial.payouts.toast.removed":"ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¯ÙØ¹Ø©.","technicianFinancial.payouts.toast.invalidAmount":"âš ï¸ Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© ØµØ­ÙŠØ­Ø© Ù„Ù„Ù…Ø¨Ù„Øº.","technicianFinancial.payouts.toast.failed":"âš ï¸ ØªØ¹Ø°Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯ÙØ¹Ø©ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.","technicianFinancial.payouts.toast.invalidTechnician":"âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ­Ø¯ÙŠØ¯ Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù… Ø­Ø§Ù„ÙŠØ§Ù‹.","technicianDetails.filters.search":"ğŸ” Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø£Ùˆ Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„Ø­Ø¬Ø² (Ù…Ø«Ù„ #123) Ø£Ùˆ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹...","technicianDetails.fields.role":"ğŸ‘” Ø§Ù„ÙˆØ¸ÙŠÙØ©:","technicianDetails.fields.department":"ğŸ§© Ø§Ù„Ù‚Ø³Ù…:","technicianDetails.fields.phone":"ğŸ“ Ø§Ù„Ø¬ÙˆØ§Ù„:","technicianDetails.fields.email":"ğŸ“§ Ø§Ù„Ø¨Ø±ÙŠØ¯:","technicianDetails.fields.wage":"ğŸ’° Ø§Ù„Ø£Ø¬Ø± Ø§Ù„ÙŠÙˆÙ…ÙŠ:","technicianDetails.fields.total":"ğŸ’¼ Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©:","technicianDetails.fields.baseStatus":"âš™ï¸ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©:","technicianDetails.fields.notes":"ğŸ“ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:","technicianDetails.fallback.email":"â€”","technicianDetails.fallback.name":"â€”","technicianDetails.fallback.role":"ØºÙŠØ± Ù…Ø­Ø¯Ø¯","technicianDetails.fallback.department":"â€”","technicianDetails.fallback.notes":"â€”","technicianDetails.errors.missingId":"âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø¹Ø±Ù Ø¹Ø¶Ùˆ Ø·Ø§Ù‚Ù… ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø·.","technicianDetails.errors.notFound":"âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø¶Ùˆ.","technicianDetails.errors.loadFailed":"âŒ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ø§Ø­Ù‚Ù‹Ø§.","technicianDetails.errors.reservationsLoadFailed":"âŒ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø­Ø¬ÙˆØ²Ø§Øª Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø¶Ùˆ Ø­Ø§Ù„ÙŠØ§Ù‹.","technicianDetails.status.loading":"â³ Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…...","technicianDetails.edit.modalTitle":"âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…","technicians.picker.actions.apply":"ØªÙ…","technicianProjects.title":"ğŸ“ Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„ÙÙ†ÙŠ","technicianReservations.title":"ğŸ“… Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„ÙÙ†ÙŠ","technicianProjects.empty":"Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø¶Ùˆ."},en:{"technicianDetails.pageTitle":"Crew Member Details","technicianDetails.title":"ğŸ˜ Crew Member Profile","technicianDetails.actions.back":"â¬…ï¸ Back","technicianDetails.actions.edit":"âœï¸ Edit Crew Member","technicianDetails.hero.subtitle":"Review the crew memberâ€™s activity and current assignments.","technicianDetails.hero.helper":"Use this page to keep track of their reservations and linked projects.","technicianTabs.reservations":"ğŸ“… Technician Reservations","technicianTabs.projects":"ğŸ“ Technician Projects","technicianFinancial.stats.total":"ğŸ’¼ Total Due","technicianFinancial.stats.paid":"ğŸ’° Paid Amount","technicianFinancial.stats.outstanding":"ğŸ§¾ Outstanding","technicianFinancial.stats.totalDesc":"Across {count} assignments","technicianFinancial.stats.paidDesc":"{count} payouts recorded","technicianFinancial.stats.outstandingDesc":"Outstanding {amount}","technicianFinancial.actions.viewDetails":"ğŸ“Š View details","technicianFinancial.modal.title":"ğŸ“Š Technician Financial Summary","technicianFinancial.modal.subtitle":"Detailed look at outstanding dues, completed payments, and linked work.","technicianFinancial.list.title":"Linked reservations & projects","technicianFinancial.assignments.empty":"No linked reservations or projects to display yet.","technicianFinancial.list.reservation":"Reservation / Project","technicianFinancial.list.period":"Period","technicianFinancial.list.due":"Due amount","technicianFinancial.list.status":"Payment status","technicianFinancial.list.outstanding":"Outstanding","technicianFinancial.list.settled":"None","technicianFinancial.list.reservationFallback":"Reservation #{id}","technicianFinancial.list.projectReference":"Project #{id}","technicianFinancial.status.paid":"Paid","technicianFinancial.status.partial":"Partially paid","technicianFinancial.status.unpaid":"Unpaid","technicianFinancial.payouts.title":"ğŸ’¸ Internal payout log","technicianFinancial.payouts.helper":"Record company payouts issued to this crew member to track settlements.","technicianFinancial.payouts.empty":"No payouts recorded yet.","technicianFinancial.payouts.form.amount":"ğŸ’° Amount","technicianFinancial.payouts.form.date":"ğŸ“… Payment date","technicianFinancial.payouts.form.note":"ğŸ“ Notes (optional)","technicianFinancial.payouts.form.submit":"ğŸ’¸ Record payout","technicianFinancial.payouts.confirmDelete":"âŒ Delete this payout?","technicianFinancial.payouts.confirmTitle":"ğŸ—‘ï¸ Delete payout","technicianFinancial.payouts.confirmMessage":"Are you sure you want to delete this payout? This action cannot be undone.","technicianFinancial.payouts.confirmCancel":"Cancel","technicianFinancial.payouts.confirmAccept":"ğŸ—‘ï¸ Delete","technicianFinancial.payouts.toast.added":"âœ… Payout logged successfully.","technicianFinancial.payouts.toast.removed":"ğŸ—‘ï¸ Payout removed.","technicianFinancial.payouts.toast.invalidAmount":"âš ï¸ Enter a valid payout amount.","technicianFinancial.payouts.toast.failed":"âš ï¸ Unable to record the payout. Please try again.","technicianFinancial.payouts.toast.invalidTechnician":"âš ï¸ Unable to determine the crew member right now.","technicianDetails.filters.search":"ğŸ” Search by client or enter the reservation ID (e.g. #123) or project ID...","technicianDetails.fields.role":"ğŸ‘” Role:","technicianDetails.fields.department":"ğŸ§© Department:","technicianDetails.fields.phone":"ğŸ“ Phone:","technicianDetails.fields.email":"ğŸ“§ Email:","technicianDetails.fields.wage":"ğŸ’° Daily Rate:","technicianDetails.fields.total":"ğŸ’¼ Total Charge:","technicianDetails.fields.baseStatus":"âš™ï¸ Base Status:","technicianDetails.fields.notes":"ğŸ“ Notes:","technicianDetails.fallback.email":"â€”","technicianDetails.fallback.name":"â€”","technicianDetails.fallback.role":"Not specified","technicianDetails.fallback.department":"â€”","technicianDetails.fallback.notes":"â€”","technicianDetails.errors.missingId":"âš ï¸ Missing crew member identifier in the URL.","technicianDetails.errors.notFound":"âš ï¸ Crew member not found.","technicianDetails.errors.loadFailed":"âŒ Unable to load crew member details. Please try again later.","technicianDetails.errors.reservationsLoadFailed":"âŒ Unable to load this crew member's reservations right now.","technicianDetails.status.loading":"â³ Loading crew member details...","technicianDetails.edit.modalTitle":"âœï¸ Edit Crew Member","technicians.picker.actions.apply":"Done","technicianProjects.title":"ğŸ“ Technician Projects","technicianReservations.title":"ğŸ“… Technician Reservations","technicianProjects.empty":"No projects are linked to this crew member."}});let gt={},b={initialized:!1,currentId:null,modal:{el:null,body:null},projectsMap:new Map},Nt=!1;function wt(t=""){return D(String(t)).replace(/[Ù¬ØŒ]/g,"").trim().toLowerCase()}function te(t,e,n){if(!e||!n)return;const{startDate:a,endDate:i}=Xt(t);e._flatpickr?a?e._flatpickr.setDate(a,!1,"Y-m-d"):e._flatpickr.clear():e.value=a||"",n._flatpickr?i?n._flatpickr.setDate(i,!1,"Y-m-d"):n._flatpickr.clear():n.value=i||""}function x(t){if(!Array.isArray(t))return[];const e=new Set;return t.map(n=>{if(n==null)return null;if(typeof n=="object"){const a=n.id??n.technicianId??n.technician_id??n.technician?.id??null;return a!=null?String(a):null}return typeof n=="string"||typeof n=="number"?String(n):null}).filter(n=>!n||e.has(n)?!1:(e.add(n),!0))}async function ee(t){const e=document.getElementById("technician-reservations");if(!e)return;if(!Nt){try{await Promise.all([Zt({suppressError:!1,force:!0}),De({force:!0}).catch(()=>{})])}catch(h){console.error("âŒ [technician-details] Failed to hydrate reservations list",h),e.innerHTML=`<p class="text-danger" data-i18n data-i18n-key="technicianDetails.errors.reservationsLoadFailed">${d("technicianDetails.errors.reservationsLoadFailed","âŒ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø­Ø¬ÙˆØ²Ø§Øª Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø¶Ùˆ Ø­Ø§Ù„ÙŠØ§Ù‹.")}</p>`;return}Nt=!0}const n=document.getElementById("technician-search-reservation"),a=document.getElementById("technician-filter-start-date"),i=document.getElementById("technician-filter-end-date"),c=document.getElementById("technician-reservation-date-range"),l=document.getElementById("technician-reservation-status-filter"),r=document.getElementById("technician-clear-filters");window.flatpickr&&(a&&window.flatpickr(a,{dateFormat:"Y-m-d"}),i&&window.flatpickr(i,{dateFormat:"Y-m-d"}));const u=()=>{let h=D(a?.value||"").trim(),v=D(i?.value||"").trim(),I=c?.value||"";if(new Set(["","today","week","month"]).has(I)||(I="",c&&(c.value=""),a&&(a._flatpickr&&a._flatpickr.clear(),a.value=""),i&&(i._flatpickr&&i._flatpickr.clear(),i.value=""),h="",v=""),!h&&!v&&I){const{startDate:q,endDate:o}=Xt(I);h=q,v=o}return{searchTerm:wt(n?.value||""),startDate:h,endDate:v,status:l?.value||"",quickRange:I,technicianId:t}},m=()=>{gt=u(),Ct("technician-reservations",gt)};n&&!n.dataset.listenerAttached&&(n.addEventListener("input",()=>{n.value=D(n.value),m()}),n.dataset.listenerAttached="true"),a&&!a.dataset.listenerAttached&&(a.addEventListener("change",()=>{c&&(c.value=""),m()}),a.dataset.listenerAttached="true"),i&&!i.dataset.listenerAttached&&(i.addEventListener("change",()=>{c&&(c.value=""),m()}),i.dataset.listenerAttached="true"),c&&!c.dataset.listenerAttached&&(c.addEventListener("change",()=>{te(c.value,a,i),m()}),c.dataset.listenerAttached="true"),l&&!l.dataset.listenerAttached&&(l.addEventListener("change",m),l.dataset.listenerAttached="true"),r&&!r.dataset.listenerAttached&&(r.addEventListener("click",()=>{n&&(n.value=""),a&&(a._flatpickr&&a._flatpickr.clear(),a.value=""),i&&(i._flatpickr&&i._flatpickr.clear(),i.value=""),c&&(c.value=""),l&&(l.value=""),m()}),r.dataset.listenerAttached="true"),window.refreshTechnicianReservationsViews=()=>{Ct("technician-reservations",gt)},document.__techReservationsProjectListenerAttached||(document.addEventListener("projects:changed",()=>{try{typeof window.refreshTechnicianReservationsViews=="function"&&window.refreshTechnicianReservationsViews()}catch{}}),document.__techReservationsProjectListenerAttached=!0),m()}function ne(t){b.currentId=t;const{container:e}=X();e&&(b.initialized||(Te(),ke(),Pe(),document.addEventListener("projects:changed",()=>{b.currentId&&_()}),document.addEventListener("language:changed",()=>{b.currentId&&_()}),document.addEventListener("customers:changed",()=>{b.currentId&&_()}),document.addEventListener("technicians:updated",()=>{b.currentId&&_()}),b.initialized=!0),_())}function X(){return{container:document.getElementById("technician-projects"),searchInput:document.getElementById("technician-project-search"),startInput:document.getElementById("technician-project-start-date"),endInput:document.getElementById("technician-project-end-date"),rangeSelect:document.getElementById("technician-project-date-range"),statusSelect:document.getElementById("technician-project-status-filter"),clearBtn:document.getElementById("technician-projects-clear-filters")}}function Te(){const{searchInput:t,statusSelect:e,clearBtn:n,startInput:a,endInput:i,rangeSelect:c}=X();t&&!t.dataset.listenerAttached&&(t.addEventListener("input",()=>{t.value=D(t.value),_()}),t.dataset.listenerAttached="true"),a&&!a.dataset.listenerAttached&&(window.flatpickr&&window.flatpickr(a,{dateFormat:"Y-m-d"}),a.addEventListener("change",()=>{c&&(c.value=""),_()}),a.dataset.listenerAttached="true"),i&&!i.dataset.listenerAttached&&(window.flatpickr&&window.flatpickr(i,{dateFormat:"Y-m-d"}),i.addEventListener("change",()=>{c&&(c.value=""),_()}),i.dataset.listenerAttached="true"),c&&!c.dataset.listenerAttached&&(c.addEventListener("change",()=>{te(c.value,a,i),_()}),c.dataset.listenerAttached="true"),e&&!e.dataset.listenerAttached&&(e.addEventListener("change",()=>{_()}),e.dataset.listenerAttached="true"),n&&!n.dataset.listenerAttached&&(n.addEventListener("click",()=>{const{searchInput:l,statusSelect:r,startInput:u,endInput:m,rangeSelect:h}=X();l&&(l.value=""),r&&(r.value=""),u&&(u._flatpickr&&u._flatpickr.clear(),u.value=""),m&&(m._flatpickr&&m._flatpickr.clear(),m.value=""),h&&(h.value=""),_()}),n.dataset.listenerAttached="true")}function ke(){const{container:t}=X();!t||t.dataset.projectModalListenerAttached==="true"||(t.addEventListener("click",je),t.dataset.projectModalListenerAttached="true")}function Le(){const{container:t}=X();t&&t.querySelectorAll(".project-focus-card").forEach(e=>{e.dataset.technicianModalListenerAttached!=="true"&&(e.addEventListener("click",n=>{if(n.target.closest("[data-ignore-project-modal]"))return;const i=e.dataset.projectId?String(e.dataset.projectId):"";i&&ie(i)}),e.dataset.technicianModalListenerAttached="true")})}function je(t){const e=t.target.closest(".project-focus-card");if(!e||(console.debug("[technician] card click",e.dataset.projectId),!e)||t.target.closest("[data-ignore-project-modal]"))return;const a=e.dataset.projectId?String(e.dataset.projectId):"";a&&ie(a)}function Pe(){ae()}function ae(){if(b.modal?.el&&b.modal?.body)return!0;const t=document.getElementById("projectDetailsModal"),e=document.getElementById("project-details-body");if(!t||!e){const i=document.createElement("div");i.innerHTML=`
      <div class="modal fade" id="projectDetailsModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">${d("projects.details.modalTitle","ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹")}</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="project-details-body"></div>
          </div>
        </div>
      </div>`,document.body.appendChild(i.firstElementChild)}const n=document.getElementById("projectDetailsModal"),a=document.getElementById("project-details-body");return!n||!a?!1:(b.modal={el:n,body:a},!0)}function _(){const{container:t,searchInput:e,statusSelect:n,startInput:a,endInput:i}=X();if(!t||!b.currentId)return;const c=wt(e?.value||""),l=n?.value||"",r=a?.value||"",u=i?.value||"",m=r?new Date(`${r}T00:00:00`):null,h=u?new Date(`${u}T23:59:59`):null,{projects:v=[],customers:I=[],technicians:R=[],reservations:$=[]}=kt(),q=new Map(I.map(s=>[String(s.id),s])),o=new Map(R.map(s=>[String(s.id),s])),p=new Map(v.map(s=>[String(s.id),s])),B=_e($),L=String(b.currentId),T=new Map,O=(s,f=null)=>{if(!s)return;const g=s.id!=null?String(s.id):s.projectId!=null?String(s.projectId):null;if(g&&!T.has(g)){const E=f??x(s?.technicians);T.set(g,{...s,technicians:E})}};v.forEach(s=>{const f=x(s?.technicians);f.length&&f.includes(L)&&O({...s,technicians:f},f)}),$.forEach(s=>{if(!s?.projectId)return;const f=x(s.technicians);if(!f.includes(L))return;const g=String(s.projectId),E=T.get(g),F=p.get(g),{effectiveConfirmed:S}=Bt(s,F??E??null);if(E){const M=x(E.technicians),it=Array.from(new Set([...M,...f]));T.set(g,{...E,technicians:it,confirmed:E.confirmed||S});return}if(F){const M=x(F?.technicians),it=Array.from(new Set([...M,...f]));O({...F,technicians:it,confirmed:Bt(s,F).effectiveConfirmed},it);return}O({id:g,title:s.projectTitle||s.title||s.project_title||`#${g}`,description:s.notes||"",start:s.projectStart||s.start||null,end:s.projectEnd||s.end||null,technicians:f,clientId:s.projectClientId??s.customerId??null,confirmed:S,status:s.status??null,equipmentEstimate:s.totalAmount??s.total_amount??0,createdAt:s.start??s.created_at??null},f)});const pt=Array.from(T.values());b.projectsMap=T,typeof window=="object"&&(window.__ART_RATIO_APP_DEBUG={...window.__ART_RATIO_APP_DEBUG||{},technicianProjects:{projectsMap:T,keys:()=>Array.from(T.keys())}});const at=pt.filter(s=>{if(c){const f=q.get(String(s.clientId))?.customerName||"",g=[s.id,s.projectId,s.project_id,s.projectCode,s.project_code,s.reference,s.reference_code,s.code,Rt(s)];if(!wt([s.title,s.description,f,g.filter(F=>F!=null&&F!=="").map(String).join(" ")].filter(Boolean).join(" ")).includes(c))return!1}if(l&&Re(s)!==l)return!1;if(m||h){const f=s.start||s.createdAt||s.created_at||null,g=s.end||s.projectEnd||s.project_end||null,E=f?new Date(f):null,F=g?new Date(g):E;if(m&&E&&E<m||h&&F&&F>h)return!1}return!0}).sort((s,f)=>{const g=new Date(s.start||s.createdAt||0).getTime();return new Date(f.start||f.createdAt||0).getTime()-g});if(!at.length){const s=d("technicianProjects.empty",t.dataset.empty||"Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø¶Ùˆ.");t.innerHTML=`<div class="project-card-grid__item project-card-grid__item--full"><div class="alert alert-info text-center mb-0">${s}</div></div>`;return}t.innerHTML=at.map(s=>{const f=Rt(s),g=f?B.get(f)||[]:[],E=q.get(String(s.clientId))||null;return fe(s,{customer:E,techniciansMap:o,reservations:g})}).join(""),Le()}function _e(t=[]){const e=new Map;return t.forEach(n=>{const a=n?.projectId??n?.project_id??n?.projectID;if(a==null)return;const i=String(a);e.has(i)||e.set(i,[]),e.get(i).push(n)}),e}function ie(t){const e=String(t||"").trim();if(console.debug("[technician] open details",e),!e||!ae()||!b.modal?.body)return;const{projects:a=[],reservations:i=[],customers:c=[]}=kt(),l=b.projectsMap?.get(e)||null;let r=l??xt(a,e);if(r||(r=xt(a,e)),!r)return;const u=String(b.currentId||"");let m=x(r.technicians);!m.length&&l&&(m=x(l.technicians),r={...l,...r}),typeof window=="object"&&(window.__ART_RATIO_APP_DEBUG={...window.__ART_RATIO_APP_DEBUG||{},technicianProjects:{...window.__ART_RATIO_APP_DEBUG?.technicianProjects||{},lastOpen:{id:e,activeTechnicianId:u,normalizedTechnicians:m}}}),r={...r,technicians:m},c.find(h=>String(h.id)===String(r.clientId)),i.filter(h=>{const v=ge(h);return v&&v===e}),Mt.detailsModalEl=b.modal.el,Mt.detailsBody=b.modal.body,ft.projects=Ee(),ft.reservations=ht(),ft.customers=c||[],ye(e);try{if(!(window.bootstrap&&window.bootstrap.Modal)&&b.modal?.el){const h=b.modal.el;h.classList.add("show"),h.style.display="block",h.removeAttribute("aria-hidden")}}catch{}}function xt(t=[],e){const n=String(e);return t.find(a=>[a?.id,a?.projectId,a?.project_id].some(c=>c!=null&&String(c)===n))||null}function Re(t){const e=new Date,n=t.start?new Date(t.start):null,a=t.end?new Date(t.end):null;return n&&!Number.isNaN(n.getTime())&&n>e?"upcoming":a&&!Number.isNaN(a.getTime())&&a<e?"completed":"ongoing"}async function Ct(t,e){try{const n=await Yt(()=>import("./reservationsUI.DhTbOZvF.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]),import.meta.url);try{n.renderReservations?.(t,e)}catch(a){console.error("âŒ [technician-details] renderReservations failed",a)}}catch(n){console.error("âŒ [technician-details] Failed to load reservations UI module",n)}}async function Be(t,{signal:e}={}){const n=new URLSearchParams;t&&n.set("technician_id",t);const a=n.toString(),i=await mt(`/technician-payouts/${a?`?${a}`:""}`,{signal:e});return Array.isArray(i?.data)?i.data:[]}async function Me({technicianId:t,amount:e,note:n,paidAt:a}){return(await mt("/technician-payouts/",{method:"POST",body:{technician_id:t,amount:e,note:n,paid_at:a}}))?.data??null}async function Ne(t){return(await mt(`/technician-payouts/?id=${encodeURIComponent(t)}`,{method:"DELETE"}))?.data??null}ue();me();Fe();const xe=new URLSearchParams(window.location.search),y=xe.get("id"),N=document.getElementById("technician-details"),$t=document.getElementById("technician-hero-name"),Ce=document.getElementById("technician-hero-status"),qt=document.getElementById("technician-hero-role"),yt=document.getElementById("technician-hero-position"),ct=document.getElementById("dashboard-greeting-technician-name"),Z=document.getElementById("dashboard-greeting-technician-role"),$e=document.getElementById("dashboard-greeting-technician-status"),zt=document.getElementById("dashboard-greeting-technician-role-badge"),qe=document.getElementById("sidebar-stat-projects"),ze=document.getElementById("sidebar-stat-reservations"),He=document.getElementById("sidebar-stat-equipment"),Ue=document.getElementById("sidebar-stat-technicians"),j={total:document.getElementById("technician-financial-total"),totalDesc:document.getElementById("technician-financial-total-desc"),paid:document.getElementById("technician-financial-paid"),paidDesc:document.getElementById("technician-financial-paid-desc"),outstanding:document.getElementById("technician-financial-outstanding"),outstandingDesc:document.getElementById("technician-financial-outstanding-desc")},w=document.getElementById("technician-financial-modal"),st=document.getElementById("technician-financial-open"),Ht=document.getElementById("technician-financial-modal-total"),Ut=document.getElementById("technician-financial-modal-paid"),Vt=document.getElementById("technician-financial-modal-outstanding"),bt=document.getElementById("technician-financial-modal-empty"),vt=document.getElementById("technician-financial-modal-table-wrapper"),Dt=document.getElementById("technician-financial-modal-rows"),Ve=Array.from(document.querySelectorAll("[data-financial-modal-close]")),K=document.getElementById("technician-payout-form"),A=document.getElementById("technician-payout-amount"),Y=document.getElementById("technician-payout-date"),Oe=document.getElementById("technician-payout-note"),V=document.getElementById("technician-payouts-list"),Et=document.getElementById("technician-payouts-empty"),Q=document.getElementById("technician-payout-confirm-modal"),z=document.getElementById("technician-payout-confirm-yes"),We=Array.from(document.querySelectorAll("[data-payout-confirm-close]")),It=Array.from(document.querySelectorAll("[data-technician-tab]")),Ke=new Map(Array.from(document.querySelectorAll("[data-technician-tab-panel]")).map(t=>[t.getAttribute("data-technician-tab-panel"),t]));let jt="reservations",k=null,U={totals:{total:0,paid:0,outstanding:0},metrics:{assignments:0,payoutsCount:0,outstandingAmount:0},breakdown:[],payouts:[]},At=[],ut=null;he();function Pt(){return document.documentElement.getAttribute("lang")||"ar"}function rt(t){const e=Number(t)||0,a=Pt()==="ar"?"ar-SA-u-nu-latn":"en-US";try{return new Intl.NumberFormat(a,{maximumFractionDigits:0}).format(e)}catch{return D(String(e))||"0"}}function Ge(t){if(!t||typeof t!="object")return null;const e=n=>{const a=Number.parseInt(String(n??"0"),10);return Number.isFinite(a)?a:0};return{projects:e(t?.projects?.total),reservations:e(t?.reservations?.total),equipment:e(t?.equipment?.total),technicians:e(t?.technicians?.total)}}function Ye(){const t=kt();return{projects:Array.isArray(t.projects)?t.projects.length:0,reservations:Array.isArray(t.reservations)?t.reservations.length:0,equipment:Array.isArray(t.equipment)?t.equipment.length:0,technicians:Array.isArray(t.technicians)?t.technicians.length:0}}function ot(t,e,n){let a=document.getElementById(t);if(a)return a;let i=document.getElementById("dashboard-sidebar");i||(i=document.createElement("aside"),i.id="dashboard-sidebar",i.className="sidebar-shell sidebar-drawer",(document.body||document.documentElement).prepend(i));let c=i.querySelector(".sidebar-panel--stats");c||(c=document.createElement("div"),c.className="sidebar-panel sidebar-panel--stats",c.innerHTML=`
      <h3 class="sidebar-heading">${d?.("dashboard.sidebar.statsHeading","Ù…Ù„Ø®Øµ Ø§Ù„ÙŠÙˆÙ…")}</h3>
      <div class="sidebar-stats" role="list"></div>
    `,i.prepend(c));let l=c.querySelector(".sidebar-stats");l||(l=document.createElement("div"),l.className="sidebar-stats",l.setAttribute("role","list"),c.appendChild(l));const r=document.createElement("div");r.className="sidebar-stats-row",r.setAttribute("role","listitem");const u=d?.(e,n)??n??"";return r.innerHTML=`<span>${u}</span><span id="${t}" class="badge-soft">0</span>`,l.appendChild(r),a=r.querySelector(`#${t}`),a}function C(t={}){const e=Ye(),n={projects:t.projects??e.projects,reservations:t.reservations??e.reservations,equipment:t.equipment??e.equipment,technicians:t.technicians??e.technicians},a={projects:qe||ot("sidebar-stat-projects","dashboard.metrics.projects.label","Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹"),reservations:ze||ot("sidebar-stat-reservations","dashboard.metrics.reservations.label","Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª"),equipment:He||ot("sidebar-stat-equipment","dashboard.metrics.equipment.label","Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"),technicians:Ue||ot("sidebar-stat-technicians","dashboard.metrics.technicians.label","Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„")};a.projects&&(a.projects.textContent=rt(n.projects)),a.reservations&&(a.reservations.textContent=rt(n.reservations)),a.equipment&&(a.equipment.textContent=rt(n.equipment)),a.technicians&&(a.technicians.textContent=rt(n.technicians));try{window.__TECHNICIAN_STATS__={...n}}catch{}}function Qe(){if(!y)return[];const t=ht(),e=String(y);return Array.isArray(t)?t.filter(n=>{if(!n)return!1;const a=String(n.status||"").toLowerCase();return a==="cancelled"||a==="canceled"||a==="Ù…Ù„ØºÙŠ"||a==="Ù…Ù„ØºÙ‰"||a==="Ù…Ù„ØºÙŠØ©"?!1:(Array.isArray(n.technicians)?n.technicians.map(c=>String(c)):[]).includes(e)}):[]}function Je(){const t=Qe(),e=ce(t,y?String(y):null);return C(e),e}function Xe(t){if(!t||typeof t!="object")return 0;const e=[t.quantity,t.qty,t.count];for(const n of e){if(n==null||n==="")continue;const a=Number(D(String(n)));if(Number.isFinite(a))return a>0?a:0}return 1}function ce(t,e){if(!Array.isArray(t)||!t.length)return{projects:0,reservations:0,equipment:0,technicians:e?1:0};const n=new Set,a=new Set;e&&a.add(String(e));let i=0;return t.forEach(c=>{if(!c)return;c.projectId!=null&&n.add(String(c.projectId)),x(c.technicians).forEach(r=>a.add(r)),Array.isArray(c.items)&&c.items.forEach(r=>{i+=Xe(r)})}),{projects:n.size,reservations:t.length,equipment:i,technicians:a.size||(e?1:0)}}async function Ze(){try{const t=await mt("/summary/"),e=Ge(t?.data??null);if(e){C(e);return}}catch{}try{await Promise.allSettled([Ae(),we(),Qt(),ve({showToastOnError:!1})])}catch{}C()}function P(t){const e=Number(t)||0,a=Pt()==="ar"?"ar-SA-u-ca-gregory-nu-latn":"en-US";try{const i=new Intl.NumberFormat(a,{minimumFractionDigits:0,maximumFractionDigits:0}).format(Math.round(e));return`${D(i)} SR`}catch{const c=Math.round(e);return`${D(String(c))} SR`}}function Ft(t){if(!t)return d("common.placeholder.empty","â€”");const e=t instanceof Date?t:new Date(t);if(Number.isNaN(e.getTime()))return d("common.placeholder.empty","â€”");const a=Pt()==="ar"?"ar-SA-u-ca-gregory-nu-latn":"en-US";try{return new Intl.DateTimeFormat(a,{dateStyle:"medium"}).format(e)}catch{const c=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0"),r=e.getFullYear();return`${c}/${l}/${r}`}}function J(t=""){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function Ot(t={}){const e=[t.positionCost,t.position_cost,t.cost,t.dailyWage,t.daily_rate,t.dailyRate,t.rate,t.wage];for(const n of e){if(n==null||n==="")continue;const a=Number(D(String(n)));if(Number.isFinite(a))return a}return 0}function tn(t){const e=typeof t=="string"?t.toLowerCase():"unpaid";let n="technicianFinancial.status.unpaid",a="technician-payment-badge technician-payment-badge--unpaid";return e==="paid"?(n="technicianFinancial.status.paid",a="technician-payment-badge technician-payment-badge--paid"):e==="partial"&&(n="technicianFinancial.status.partial",a="technician-payment-badge technician-payment-badge--partial"),`<span class="${a}" data-i18n data-i18n-key="${n}">${d(n,n)}</span>`}function Wt(t){const{totals:e,metrics:n}=t,a=Number(n.assignments??0),i=Number(n.payoutsCount??0),c=d("technicianFinancial.stats.totalDesc","Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù€ {count} Ù…Ù‡Ø§Ù…").replace("{count}",D(String(a))),l=d("technicianFinancial.stats.paidDesc","{count} Ø¯ÙØ¹Ø§Øª Ù…Ø³Ø¬Ù„Ø©").replace("{count}",D(String(i))),r=d("technicianFinancial.stats.outstandingDesc","Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ {amount}"),u=e.outstanding>0?r.replace("{amount}",P(e.outstanding)):d("common.placeholder.empty","â€”");j.total&&(j.total.textContent=P(e.total)),j.totalDesc&&(j.totalDesc.textContent=a>0?c:d("common.placeholder.empty","â€”")),j.paid&&(j.paid.textContent=P(e.paid)),j.paidDesc&&(j.paidDesc.textContent=i>0?l:d("common.placeholder.empty","â€”")),j.outstanding&&(j.outstanding.textContent=P(e.outstanding)),j.outstandingDesc&&(j.outstandingDesc.textContent=u)}function St(t){const{totals:e,breakdown:n,payouts:a}=t;if(Ht&&(Ht.textContent=P(e.total)),Ut&&(Ut.textContent=P(e.paid)),Vt&&(Vt.textContent=P(e.outstanding)),!(!Dt||!vt||!bt)){if(!n.length)Dt.innerHTML="",vt.classList.add("hidden"),bt.classList.remove("hidden");else{bt.classList.add("hidden"),vt.classList.remove("hidden");const i=n.map(c=>{const l=c.period||"â€”",r=c.outstandingAmount>0?P(c.outstandingAmount):`<span class="text-success">${d("technicianFinancial.list.settled","Ù„Ø§ ÙŠÙˆØ¬Ø¯")}</span>`;return`
        <tr>
          <td>
            <div class="font-semibold text-base-content">${J(c.label)}</div>
            <div class="text-xs text-base-content/60">${J(c.reference)}</div>
          </td>
          <td class="whitespace-nowrap">${J(l)}</td>
          <td>${P(c.dueAmount)}</td>
          <td>${tn(c.paidStatus)}</td>
          <td>${r}</td>
        </tr>
      `}).join("");Dt.innerHTML=i}en(a)}}function en(t=[]){if(!V||!Et)return;if(!Array.isArray(t)||t.length===0){V.innerHTML="",Et.classList.remove("hidden");return}const e=t.map(n=>{const a=P(n.amount||0),i=Ft(n.paidAt||n.createdAt),c=n.note?`<p class="technician-payout-note text-sm text-base-content/70">${J(n.note)}</p>`:"",l=d("actions.delete","ğŸ—‘ï¸ Ø­Ø°Ù");return`
      <li class="technician-payout-item">
        <div class="technician-payout-item-body">
          <div class="technician-payout-item-head">
            <span class="technician-payout-amount">${a}</span>
            <span class="technician-payout-date">${J(i)}</span>
          </div>
          ${c}
        </div>
        <button type="button" class="btn btn-outline btn-sm technician-payout-remove" data-payout-remove="${J(n.id)}" data-i18n data-i18n-key="actions.delete">${l}</button>
      </li>
    `}).join("");V.innerHTML=e,Et.classList.add("hidden")}function se(t){const e=t instanceof Date?t:new Date(t);return Number.isNaN(e.getTime())?"":e.toISOString().slice(0,10)}function nn(t){if(!t)return new Date;const e=new Date(`${t}T00:00:00`);return Number.isNaN(e.getTime())?new Date:e}function an(t){const e=D(String(t??""));if(!e)return"";const i=e.replace(/[Ù¬ØŒ]/g,"").replace(/[Ù«,]/g,".").replace(/[^0-9.]/g,"").split("."),c=i[0]||"",l=i.length>1?i.slice(1).join(""):"",r=c.replace(/^0+(\d)/,"$1"),u=r.length?r:l?"0":"",m=l?l.replace(/\D/g,"").slice(0,2):"";return m?`${u}.${m}`:u}function cn(t){if(t.preventDefault(),!y){W(d("technicianFinancial.payouts.toast.invalidTechnician","âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ­Ø¯ÙŠØ¯ Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù… Ø­Ø§Ù„ÙŠØ§Ù‹."));return}const e=A?.value??"",n=Number.parseFloat(D(String(e)));if(!Number.isFinite(n)||n<=0){W(d("technicianFinancial.payouts.toast.invalidAmount","âš ï¸ Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© ØµØ­ÙŠØ­Ø© Ù„Ù„Ù…Ø¨Ù„Øº.")),A?.focus();return}const a=Oe?.value?.trim()||"",i=nn(Y?.value||null),c=K?.querySelector('button[type="submit"]');c&&(c.disabled=!0),Me({technicianId:y,amount:Number(n.toFixed(2)),note:a,paidAt:i.toISOString()}).then(l=>{W(d("technicianFinancial.payouts.toast.added","âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯ÙØ¹Ø©.")),K?.reset(),Y&&(Y.value=se(l?.paidAt||new Date)),k&&nt(k)}).catch(l=>{console.error("âŒ [technician-page] Failed to create technician payout",l);const r=l?.message||d("technicianFinancial.payouts.toast.failed","âš ï¸ ØªØ¹Ø°Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯ÙØ¹Ø©ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");W(r)}).finally(()=>{c&&(c.disabled=!1)})}function sn(t){t&&on(t)}function rn(){w&&(w.classList.remove("hidden"),w.classList.add("show"),w.classList.add("modal-open"),document.documentElement.classList.add("modal-open"),document.body.classList.add("overflow-hidden"),Y&&!Y.value&&(Y.value=se(new Date)))}function _t(){w&&(w.classList.remove("show"),w.classList.remove("modal-open"),w.classList.add("hidden"),document.documentElement.classList.remove("modal-open"),document.body.classList.remove("overflow-hidden"))}function on(t){Q&&(ut=t||null,Q.classList.remove("hidden"),Q.classList.add("show","modal-open"),document.documentElement.classList.add("modal-open"),document.body.classList.add("overflow-hidden"))}function Tt(){Q&&(Q.classList.remove("show","modal-open"),Q.classList.add("hidden"),document.documentElement.classList.remove("modal-open"),document.body.classList.remove("overflow-hidden"),ut=null,z&&(z.disabled=!1))}function re(){return Array.from(document.querySelectorAll("[data-technician-edit]"))}function ln(t){if(t.preventDefault(),!k)return;try{document.dispatchEvent(new CustomEvent("technician:prefill",{detail:{...k}}))}catch(a){console.error("âš ï¸ [technician-page] Failed to prefill technician edit modal",a)}const e=document.getElementById("editTechnicianModal");if(!e||!window.bootstrap?.Modal)return;window.bootstrap.Modal.getOrCreateInstance(e).show()}function oe(){re().forEach(t=>{!t||t.dataset.listenerAttached||(t.addEventListener("click",ln),t.dataset.listenerAttached="true")})}async function nt(t){if(U={totals:{total:0,paid:0,outstanding:0},metrics:{assignments:0,payoutsCount:0,outstandingAmount:0},breakdown:[],payouts:[]},Wt(U),St(U),C(),!y||!t)return;try{await Zt({suppressError:!0})}catch(o){console.error("âš ï¸ [technician-page] Failed to load reservations for financial summary",o)}const n=ht(),a=String(y);try{const o=await Be(a);At=Array.isArray(o)?o:[]}catch(o){console.error("âš ï¸ [technician-page] Failed to load technician payouts from API",o),At=[]}const i=n.filter(o=>{if(!o)return!1;const p=String(o.status||"").toLowerCase();return p==="cancelled"||p==="canceled"||p==="Ù…Ù„ØºÙŠ"||p==="Ù…Ù„ØºÙ‰"||p==="Ù…Ù„ØºÙŠØ©"?!1:(Array.isArray(o.technicians)?o.technicians.map(L=>String(L)):[]).includes(a)}),c=ce(i,a);C(c);const l=i.map((o,p)=>{const B=Array.isArray(o.techniciansDetails)?o.techniciansDetails.find(S=>{const M=S?.id??S?.technician_id??S?.technicianId??S?.ID;return M!=null&&String(M)===a}):null,L=Ot(B)||Ot(t),T=Math.max(1,Ie(o.start,o.end)),O=Math.max(0,Math.round(L*T)),pt=d("technicianFinancial.list.reservationFallback","Ø­Ø¬Ø² Ø±Ù‚Ù… {id}").replace("{id}",D(String(o.reservationId||o.id||"?"))),at=o.title&&o.title.trim().length?o.title.trim():pt,s=[];if(o.reservationId||o.id){const S=o.reservationId||o.id;s.push(`#${D(String(S))}`)}if(o.projectId&&s.push(d("technicianFinancial.list.projectReference","Ù…Ø´Ø±ÙˆØ¹ #{id}").replace("{id}",D(String(o.projectId)))),o.status){const S=`reservations.status.${o.status}`;s.push(d(S,o.status))}const f=Ft(o.start),g=Ft(o.end),E=f===g?f:`${f} â€“ ${g}`,F=(()=>{const S=o.start||o.startDatetime||o.createdAt||o.created_at,M=S?new Date(S).getTime():NaN;return Number.isNaN(M)?p:M})();return{label:at,reference:s.join(" â€¢ ")||"â€”",period:E,dueAmount:O,paidAmount:0,outstandingAmount:O,paidStatus:"unpaid",sortKey:F,originalIndex:p}}),r=At.map(o=>({...o,amount:Number(o.amount)||0}));let u=r.reduce((o,p)=>o+p.amount,0);const h=[...l].sort((o,p)=>o.sortKey===p.sortKey?o.originalIndex-p.originalIndex:o.sortKey-p.sortKey).map(o=>{const p={...o},B=Number(o.dueAmount)||0,L=Math.min(B,Math.max(0,Number(u.toFixed(2))));L>0&&(u=Number((u-L).toFixed(2))),p.paidAmount=Number(L.toFixed(2));const T=Math.max(0,Number((B-L).toFixed(2)));return p.outstandingAmount=T,T<=.009?(p.paidStatus="paid",p.outstandingAmount=0):L>0?p.paidStatus="partial":p.paidStatus="unpaid",p}).sort((o,p)=>o.originalIndex-p.originalIndex).map(({sortKey:o,originalIndex:p,...B})=>B),v=h.reduce((o,p)=>o+p.dueAmount,0),I=r.reduce((o,p)=>o+(Number(p.amount)||0),0),R=Math.max(0,Number((v-I).toFixed(2))),$={total:Math.max(0,Number(v.toFixed(2))),paid:Math.max(0,Number(I.toFixed(2))),outstanding:R},q={assignments:h.length,payoutsCount:r.length,outstandingAmount:R};U={totals:$,metrics:q,breakdown:h,payouts:r},Wt(U),St(U)}function H(t,e,n,{hideWhenEmpty:a=!1}={}){if(!t)return;const i=n==null?"":String(n).trim(),c=i.length>0;t.textContent=c?`${e} ${i}`:`${e} ${d("common.placeholder.empty","â€”")}`,a?t.classList.toggle("hidden",!c):c||t.classList.remove("hidden")}function Kt(t){const e=[Ce,$e].filter(Boolean);if(!e.length)return;const n=typeof t=="string"?t.toLowerCase():"";if(!n){e.forEach(r=>{r.className="technician-badge hidden",r.textContent=d("common.placeholder.empty","â€”")});return}const a=n==="busy",i=["technician-badge"];i.push(a?"technician-badge--status-busy":"technician-badge--status-available");const c=a?"technicians.status.busy":"technicians.status.available",l=a?"â›” Ù…Ø´ØºÙˆÙ„":"âœ… Ù…ØªØ§Ø­";if(e.forEach(r=>{r.className=i.join(" "),r.classList.remove("hidden"),r.setAttribute("data-i18n",""),r.setAttribute("data-i18n-key",c),r.textContent=d(c,l)}),yt)if(a){const r=dn(y),u=r&&String(r).trim().length?r:"";H(yt,"ğŸ·ï¸",u,{hideWhenEmpty:!0})}else H(yt,"ğŸ·ï¸","",{hideWhenEmpty:!0})}function dn(t){try{const e=ht();if(!Array.isArray(e)||e.length===0)return"";const n=t!=null?String(t):null;if(!n)return"";const a=new Date,i=e.find(u=>{if(!u||!u.start&&!u.startDatetime&&!u.start_datetime)return!1;const m=x(u.technicians);if(!Array.isArray(m)||!m.includes(n))return!1;const h=u.start??u.startDatetime??u.start_datetime,v=u.end??u.endDatetime??u.end_datetime;if(!h||!v)return!1;const I=new Date(h),R=new Date(v);return Number.isNaN(I.getTime())||Number.isNaN(R.getTime())?!1:I<=a&&a<R});if(!i)return"";const l=(Array.isArray(i.crewAssignments)&&i.crewAssignments.length?i.crewAssignments:Array.isArray(i.techniciansDetails)?i.techniciansDetails:[]).find(u=>{const m=u?.id??u?.technicianId??u?.technician_id;return m!=null&&String(m)===n});return l&&(l.positionLabel??l.position_name??l.position_label??l.positionKey??l.position)||""}catch{return""}}function G(t){if(!t){H($t,"ğŸ˜",d("common.placeholder.empty","â€”")),H(qt,"ğŸ¯","",{hideWhenEmpty:!0}),ct&&(ct.textContent=d("common.placeholder.empty","â€”")),Z&&(Z.textContent=d("common.placeholder.empty","â€”")),H(zt,"ğŸ¯","",{hideWhenEmpty:!0}),Kt(null);return}if(H($t,"ğŸ˜",t.name||d("common.placeholder.empty","â€”")),H(qt,"ğŸ¯",t.role||"",{hideWhenEmpty:!0}),ct&&(ct.textContent=t.name||d("common.placeholder.empty","â€”")),Z){const e=t.role?t.role:"";if(e)Z.textContent=`ğŸ¯ ${e}`;else{const n=d("technicianDetails.fallback.role","ØºÙŠØ± Ù…Ø­Ø¯Ø¯");Z.textContent=`ğŸ¯ ${n}`}}H(zt,"ğŸ¯",t.role||"",{hideWhenEmpty:!0}),Kt(t.status||t.baseStatus||"available")}function et(t){re().forEach(e=>{e.disabled=!!t})}function dt(t){t&&(jt=t,It.forEach(e=>{if(!e)return;const n=e.getAttribute("data-technician-tab")===t;e.classList.toggle("tab-active",n),e.classList.toggle("active",n),e.setAttribute("aria-selected",String(n))}),Ke.forEach((e,n)=>{e&&e.classList.toggle("hidden",n!==t)}),t==="projects"&&y&&ne(y),t==="reservations"&&y&&ee(y))}function un(){It.length&&(It.forEach(t=>{!t||t.dataset.listenerAttached||(t.addEventListener("click",()=>{const e=t.getAttribute("data-technician-tab");e&&dt(e)}),t.dataset.listenerAttached="true")}),document.querySelectorAll("[data-technician-tab-trigger]").forEach(t=>{!t||t.dataset.listenerAttached||(t.addEventListener("click",e=>{e.preventDefault();const n=t.getAttribute("data-technician-tab-trigger");n&&dt(n)}),t.dataset.listenerAttached="true")}),dt(jt))}G(null);et(!0);un();oe();st&&!st.dataset.listenerAttached&&(st.addEventListener("click",()=>{St(U),rn()}),st.dataset.listenerAttached="true");Ve.forEach(t=>{!t||t.dataset.listenerAttached||(t.addEventListener("click",()=>{_t()}),t.dataset.listenerAttached="true")});K&&!K.dataset.listenerAttached&&(K.addEventListener("submit",cn),K.dataset.listenerAttached="true");V&&!V.dataset.listenerAttached&&(V.addEventListener("click",t=>{const e=t.target.closest("[data-payout-remove]");if(!e)return;const n=e.getAttribute("data-payout-remove");sn(n)}),V.dataset.listenerAttached="true");if(A&&!A.dataset.normalizerAttached){const t=()=>{const e=an(A.value);if(e!==A.value){const n=e.length;A.value=e,A.setSelectionRange&&A.setSelectionRange(n,n)}};A.addEventListener("input",t),A.addEventListener("blur",()=>{if(t(),A.value){const e=Number.parseFloat(A.value);Number.isFinite(e)&&(A.value=e.toFixed(2))}}),A.dataset.normalizerAttached="true"}We.forEach(t=>{!t||t.dataset.listenerAttached||(t.addEventListener("click",Tt),t.dataset.listenerAttached="true")});z&&!z.dataset.listenerAttached&&(z.addEventListener("click",()=>{if(!ut){Tt();return}z.disabled=!0,Ne(ut).then(()=>{W(d("technicianFinancial.payouts.toast.removed","ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¯ÙØ¹Ø©.")),Tt(),k&&nt(k)}).catch(t=>{console.error("âŒ [technician-page] Failed to remove technician payout",t);const e=t?.message||d("technicianFinancial.payouts.toast.failed","âš ï¸ ØªØ¹Ø°Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯ÙØ¹Ø©ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");W(e),z.disabled=!1})}),z.dataset.listenerAttached="true");w&&!w.dataset.listenerAttached&&(w.addEventListener("click",t=>{t.target===w&&_t()}),w.dataset.listenerAttached="true");document.addEventListener("keydown",t=>{t.key==="Escape"&&w&&w.classList.contains("modal-open")&&_t()});const mn=(()=>{let t=null,e=!1;return()=>(t||(t=Yt(()=>import("./reservationsUI.DhTbOZvF.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]),import.meta.url).then(n=>{if(!e&&typeof n.registerReservationGlobals=="function")try{n.registerReservationGlobals(),e=!0}catch(a){console.warn("âš ï¸ [technicianPage] Failed to register reservation globals",a)}return n})),t)})();function tt(t,...e){mn().then(n=>{const a=n?.[t];typeof a=="function"?a(...e):console.warn(`âš ï¸ [technicianPage] Reservation handler "${t}" is unavailable`)}).catch(n=>{console.error(`âŒ [technicianPage] Failed to execute reservation handler "${t}"`,n)})}be({showReservationDetails(t){tt("showReservationDetails",t)},openReservationEditor(t,e={}){tt("openReservationEditor",t,e?.reservation??null)},confirmReservation(t,e){tt("confirmReservation",t,e)},deleteReservation(t){tt("deleteReservation",t)},reopenReservation(t){tt("reopenReservation",t)}});const lt=document.getElementById("logout-btn");lt&&!lt.dataset.listenerAttached&&(lt.addEventListener("click",()=>pe()),lt.dataset.listenerAttached="true");function hn(t){const e=Number(t??0);return Number.isFinite(e)?e.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:2}):"0"}function pn(t){const e=Number(t??0);if(!Number.isFinite(e)||e<=0)return"";const n=d("technicians.badge.perDay","/Ø§Ù„ÙŠÙˆÙ…");return`${P(e)} ${n}`}function Gt(t){const e=Number(t??0);return!Number.isFinite(e)||e<=0?"":P(e)}function le(t){if(!N)return;if(G(t),!t){N.innerHTML=`<p class="text-base-content/60" data-i18n data-i18n-key="technicianDetails.errors.notFound">${d("technicianDetails.errors.notFound","âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨.")}</p>`,et(!0);return}const e=t.phone?D(t.phone):`<span data-i18n data-i18n-key="reservations.details.technicians.phoneUnknown">${d("reservations.details.technicians.phoneUnknown","ØºÙŠØ± Ù…ØªÙˆÙØ±")}</span>`,n=t.email?t.email:`<span data-i18n data-i18n-key="technicianDetails.fallback.email">${d("technicianDetails.fallback.email","â€”")}</span>`,a=t.role?t.role:`<span data-i18n data-i18n-key="technicianDetails.fallback.role">${d("technicianDetails.fallback.role","ØºÙŠØ± Ù…Ø­Ø¯Ø¯")}</span>`,i=t.department?t.department:`<span data-i18n data-i18n-key="technicianDetails.fallback.department">${d("technicianDetails.fallback.department","â€”")}</span>`,c=t.notes?t.notes:`<span data-i18n data-i18n-key="technicianDetails.fallback.notes">${d("technicianDetails.fallback.notes","â€”")}</span>`,r=`<span data-i18n data-i18n-key="reservations.create.summary.currency">${d("reservations.create.summary.currency","SR")}</span>`,u=pn(t.dailyWage)||`${hn(t.dailyWage)} ${r}`,m=Gt(t.dailyTotal),h=u,v=m||Gt(t.dailyWage)||u;console.debug("[technician] amounts",{id:t.id,dailyWage:t.dailyWage,dailyTotal:t.dailyTotal,wageValue:h,totalValue:v});const R=[{key:"technicianDetails.fields.role",value:a},{key:"technicianDetails.fields.department",value:i},{key:"technicianDetails.fields.phone",value:e},{key:"technicianDetails.fields.email",value:n},{key:"technicianDetails.fields.notes",value:c}].map(({key:$,value:q})=>`
    <article class="rounded-2xl border border-base-200 bg-base-100/90 p-4 shadow-sm">
      <span class="text-sm font-medium text-base-content/70" data-i18n data-i18n-key="${$}">${d($)}</span>
      <p class="mt-2 text-lg font-semibold text-base-content">${q}</p>
    </article>
  `).join("");N.innerHTML=R,oe(),et(!1),dt(jt)}async function fn(){if(!N)return;if(!y){G(null),C(),et(!0),k=null,N.innerHTML=`<p class="text-danger" data-i18n data-i18n-key="technicianDetails.errors.missingId">${d("technicianDetails.errors.missingId","âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø¹Ø±Ù Ø¹Ø¶Ùˆ Ø·Ø§Ù‚Ù… ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø·.")}</p>`;return}N.innerHTML=`<p class="text-muted" data-i18n data-i18n-key="technicianDetails.status.loading">${d("technicianDetails.status.loading","â³ Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…...")}</p>`,et(!0),G(null);let t=null,e=null;try{await Qt(),Lt()}catch(n){e=n,console.error("âŒ [technician-details] Failed to refresh technician from API",n)}if(t=Jt(y),!t){e?N.innerHTML=`<p class="text-danger" data-i18n data-i18n-key="technicianDetails.errors.loadFailed">${d("technicianDetails.errors.loadFailed","âŒ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ø§Ø­Ù‚Ù‹Ø§.")}</p>`:N.innerHTML=`<p class="text-danger" data-i18n data-i18n-key="technicianDetails.errors.notFound">${d("technicianDetails.errors.notFound","âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨.")}</p>`,G(null),C(),k=null;return}if(!t){N.innerHTML=`<p class="text-danger" data-i18n data-i18n-key="technicianDetails.errors.notFound">${d("technicianDetails.errors.notFound","âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨.")}</p>`,G(null),C(),k=null;return}k=t,await nt(t),le(t),ee(y),ne(y)}Lt();fn();["projects:changed","reservations:changed","equipment:changed","technicians:changed"].forEach(t=>{document.addEventListener(t,()=>{y?Je():C()},{passive:!0})});Se();Ze();const gn=async()=>{if(!y)return;Lt();const t=Jt(y);t&&(k=t,await nt(t),le(t))};window.addEventListener("technicians:updated",gn);const yn=()=>{!y||!k||nt(k)};document.addEventListener("reservations:changed",yn,{passive:!0});
