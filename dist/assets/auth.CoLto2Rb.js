(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}})();const Pe={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_BASE_URL:"http://127.0.0.1:8000/api"},Re="/backend/api";class v extends Error{constructor(t,{status:n,payload:r}={}){super(t),this.name="ApiError",this.status=n??null,this.payload=r??null}}function De(){const e=typeof import.meta<"u"&&Pe&&"http://127.0.0.1:8000/api",t=typeof window<"u"?window.APP_API_BASE:null;return String(e||t||Re).replace(/\/$/,"")}async function U(e,{method:t="GET",headers:n={},body:r,signal:o,credentials:a="include"}={}){let s=e;try{if(typeof URL<"u"&&e instanceof URL)s=e.href;else if(typeof Request<"u"&&e instanceof Request)s=e.url;else if(e&&typeof e=="object"){const y=e.path||e.url||e.endpoint||null;s=String(y||e)}}catch{}typeof s!="string"&&(s=String(s||""));const c=/^https?:\/\//i.test(s),d=c||s.charAt(0)==="/"?s:`/${s}`,l=c?d:`${De()}${d}`,u={Accept:"application/json",...n},f={method:t,headers:u,signal:o,credentials:a};r!==void 0&&(r instanceof FormData?(delete u["Content-Type"],f.body=r):typeof r=="string"?(u["Content-Type"]=u["Content-Type"]||"application/json",f.body=r):(u["Content-Type"]=u["Content-Type"]||"application/json",f.body=JSON.stringify(r)));const g=await fetch(l,f),S=g.headers.get("content-type")||"";let i=null,p="";try{p=await g.text()}catch{p=""}if(S.includes("application/json"))try{i=p?JSON.parse(p):null}catch{i=p?{raw:p}:null}else if(p){const y=p.trim();if(y.startsWith("{")||y.startsWith("["))try{i=JSON.parse(y)}catch{i={raw:p}}else i={raw:p}}else i=null;if(!g.ok){const y=i?.error||`Request failed with status ${g.status}`;throw new v(y,{status:g.status,payload:i})}if(i&&typeof i=="object"&&i.ok===!1){const y=i.error||"API returned an error response";throw new v(y,{status:g.status,payload:i})}return i}const w=Object.freeze({language:"ar",theme:"light",dashboardTab:null,dashboardSubTab:null,projectsTab:null,projectsSubTab:null});let b=null,q=null;const $=new Set,ie="__ART_RATIO_SKIP_PREF_FETCH__",ce="__ART_RATIO_PREFERENCES__";function le(){try{return typeof window>"u"?!1:!!window[ie]}catch{return!1}}function xe(){try{typeof window<"u"&&delete window[ie]}catch{}}function R(e={}){const t=e.language==="en"?"en":"ar",n=e.theme==="dark"?"dark":"light",r=typeof e.dashboardTab=="string"?M(e.dashboardTab):null,o=typeof e.dashboardSubTab=="string"?M(e.dashboardSubTab):null,a=typeof e.projectsTab=="string"?M(e.projectsTab):null,s=typeof e.projectsSubTab=="string"?M(e.projectsSubTab):null;return{language:t,theme:n,dashboardTab:r,dashboardSubTab:o,projectsTab:a,projectsSubTab:s}}function M(e){const t=String(e||"").trim();return t&&/^[a-z0-9\-]+$/i.test(t)?t:null}function Ie(){try{if(typeof window>"u"||!window.localStorage)return null;const e=window.localStorage.getItem(ce);if(!e)return null;const t=JSON.parse(e);return R(t)}catch(e){return console.warn("⚠️ [preferencesService] Failed to read cached preferences",e),null}}function je(e){try{if(typeof window>"u"||!window.localStorage)return;window.localStorage.setItem(ce,JSON.stringify(e))}catch(t){console.warn("⚠️ [preferencesService] Failed to persist preferences",t)}}const Q=Ie();Q&&(b=Q);function Ne(){const e=m();$.forEach(t=>{try{t(e)}catch(n){console.error("⚠️ [preferencesService] listener failed",n)}})}function L(e){const n={...b?{...b}:{...w},...e};b=R(n),je(b),Ne()}function m(){return b?{...b}:null}function ue(e){if(typeof e!="function")return()=>{};if($.add(e),b)try{e(m())}catch(t){console.error("⚠️ [preferencesService] listener failed",t)}return()=>{$.delete(e)}}function de({refresh:e=!1}={}){if(le()){const t=m()||{...w};return Promise.resolve(t)}return!e&&b?Promise.resolve(m()):(q||(q=U("/preferences/").then(t=>{const n=t?.data??w;return L(n),m()}).catch(t=>t instanceof v&&t.status===401?(b=null,w):(console.warn("⚠️ [preferencesService] Failed to load preferences",t),L(w),w)).finally(()=>{q=null})),q)}function Ue(e=null){if(!e){const t=m();return R(t||w)}return R(e)}async function K(e={}){if(le())return L(e),m()||{...w};e.language!==void 0&&e.language,e.theme!==void 0&&e.theme,e.dashboardTab!==void 0&&e.dashboardTab,e.dashboardSubTab!==void 0&&e.dashboardSubTab,e.projectsTab!==void 0&&e.projectsTab,e.projectsSubTab!==void 0&&e.projectsSubTab;const t=Ue(),n={...t,...e},r=R(n),o={},a={};["language","theme","dashboardTab","dashboardSubTab","projectsTab","projectsSubTab"].forEach(l=>{if(e[l]===void 0)return;const u=r[l],f=t[l];u!==f&&(o[l]=u,(l==="language"||l==="theme")&&(a[l]=u))});const c=Object.keys(o).length>0,d=Object.keys(a).length>0;if(!d&&!c)return m();if(!d&&c)return L(r),m();try{const l=await U("/preferences/",{method:"PATCH",body:a});return L(l?.data??w),c&&L({...m(),...o}),m()}catch(l){if(l instanceof v&&l.status===422)return console.warn("⚠️ [preferencesService] Server rejected preference update (no changes)."),L(r),m();throw l}}const Oe="__ART_RATIO_SKIP_PREF_FETCH__";function qe(){try{return typeof window<"u"&&!!window[Oe]}catch{return!1}}const T="ar",Me="ar",Fe="language-loading",X="language-ready",fe=["Placeholder","Title","AriaLabel","AriaDescription","Value"],N={ar:Object.create(null),en:Object.create(null)};let C=T,j=!1,F=null;function D(e){return e==="en"?"en":"ar"}function me(){if(!F){const e=m();if(e?.language){const t=D(e.language);k(t,{persist:!1,dispatch:!1})}if(qe()){const t=e?.language?D(e.language):T;k(t,{persist:!1}),j=!0,F=Promise.resolve(t)}else F=de().then(t=>{const n=D(t?.language??T);return k(n,{persist:!1}),j=!0,n}).catch(t=>(console.warn("⚠️ تعذر تحميل تفضيل اللغة من الخادم",t),k(T,{persist:!1}),j=!0,T))}return F}function He(e){if(e.dataset.i18nCached==="true")return;e.dataset.i18nHtml==="true"?e.dataset.arHtml===void 0&&(e.dataset.arHtml=e.innerHTML):e.dataset.ar===void 0&&(e.dataset.ar=e.textContent),fe.forEach(n=>{const r=n.charAt(0).toLowerCase()+n.slice(1),o=e.getAttribute(r);o!=null&&e.dataset[`ar${n}`]===void 0&&(e.dataset[`ar${n}`]=o)}),e.dataset.i18nCached="true"}function Z(e,t){if(!t)return;const n=N[e]??(N[e]=Object.create(null));Object.entries(t).forEach(([r,o])=>{typeof r=="string"&&(n[r]=o)})}function ee(e,t){if(!t)return;const n=N[e];return n?n[t]:void 0}function Be(e,t){He(e);const n=e.dataset.i18nHtml==="true",r=e.dataset.i18nKey,o=ee(t,r);o!==void 0?n?e.innerHTML=o:e.textContent=o:t==="en"?n?e.dataset.enHtml!==void 0&&(e.innerHTML=e.dataset.enHtml):e.dataset.en!==void 0&&(e.textContent=e.dataset.en):n?e.innerHTML=e.dataset.arHtml??e.innerHTML:e.textContent=e.dataset.ar??e.textContent,fe.forEach(a=>{const s=a.charAt(0).toLowerCase()+a.slice(1),c=e.dataset[`i18n${a}Key`],d=ee(t,c);if(d!==void 0){e.setAttribute(s,d);return}const l=t==="en"?`en${a}`:`ar${a}`,u=e.dataset[l];u!==void 0&&e.setAttribute(s,u)})}function ge(e){document.querySelectorAll("[data-i18n]").forEach(n=>Be(n,e))}function ze(e){const t=document.documentElement,n=document.body,r=e===Me?"rtl":"ltr";t.setAttribute("lang",e),t.setAttribute("dir",r),n&&(n.setAttribute("dir",r),n.dataset.lang=e)}function Ge(){const e=document.documentElement;e&&(e.classList.contains(X)||(e.classList.remove(Fe),e.classList.add(X)))}function he(e){document.querySelectorAll(".language-toggle-btn").forEach(t=>{const n=t.dataset.labelAr||"🇸🇦 العربية",r=t.dataset.labelEn||"🇬🇧 English";t.textContent=e==="en"?n:r,t.setAttribute("aria-pressed",e==="en"?"true":"false")})}function k(e,{persist:t=!1,dispatch:n=!0}={}){const r=D(e);C===r&&j&&!t||(C=r,j=!0,ze(r),ge(r),he(r),Ge(),n&&document.dispatchEvent(new CustomEvent("language:changed",{detail:{language:r}})),t&&K({language:r}).catch(o=>{console.warn("⚠️ تعذر حفظ تفضيل اللغة في الخادم",o)}))}function $e(){Ve(C==="ar"?"en":"ar")}function pe(){document.querySelectorAll(".language-toggle-btn").forEach(t=>{t.dataset.listenerAttached||(t.addEventListener("click",()=>{$e()}),t.dataset.listenerAttached="true")}),he(C)}function ye(e={}){Z("ar",e.ar),Z("en",e.en);const t=V();ge(t),document.dispatchEvent(new CustomEvent("language:translationsReady",{detail:{language:t}}))}function A(e,t=""){if(!e)return t;const n=C||T,r=N[n];if(r&&r[e]!==void 0)return r[e];const a=N[n==="en"?"ar":"en"];return a&&a[e]!==void 0?a[e]:t}function Ve(e){const t=D(e);k(t,{persist:!0})}function bt(){me().catch(()=>T).finally(()=>{pe()})}function V(){return C}function te(){me().catch(()=>T),pe()}ue(e=>{e&&e.language&&D(e.language)!==C&&k(e.language,{persist:!1})});document.readyState==="loading"?document.addEventListener("DOMContentLoaded",te,{once:!0}):te();ye({ar:{"actions.logout":"🚪 تسجيل الخروج","actions.toggleTheme":"🌙 الوضع الليلي","theme.toggle.toLight":"☀️ الوضع العادي","theme.toggle.toDark":"🌙 الوضع الليلي","theme.toggle.titleLight":"التبديل إلى الوضع العادي","theme.toggle.titleDark":"التبديل إلى الوضع الليلي","theme.toggle.ariaLight":"الوضع العادي مفعل","theme.toggle.ariaDark":"الوضع الليلي مفعل","common.boolean.yes":"نعم","common.boolean.no":"لا","language.toggle.labelAr":"🇸🇦 العربية","language.toggle.labelEn":"🇬🇧 English","login.pageTitle":"تسجيل الدخول","login.header.title":"🔐 تسجيل الدخول","login.header.subtitle":"أدخل بيانات الحساب للوصول إلى لوحة التحكم.","login.form.username":"اسم المستخدم","login.form.username.placeholder":"أدخل اسم المستخدم","login.form.password":"كلمة المرور","login.form.password.placeholder":"أدخل كلمة المرور","login.form.password.toggleShow":"إظهار كلمة المرور","login.form.password.toggleHide":"إخفاء كلمة المرور","login.form.submit":"دخول","login.errors.invalidCredentials":"❌ بيانات الدخول غير صحيحة","login.errors.network":"🌐 تعذر الاتصال بالخادم. حاول مرة أخرى.","login.errors.generic":"⚠️ حدث خطأ غير متوقع. حاول مرة أخرى.","login.footer.note":"محمي لأعضاء فريق Art Ratio. تواصل معنا إذا واجهت مشكلة في تسجيل الدخول.","actions.clearFilters":"🔄 إعادة التصفية","actions.view":"👁️ عرض","actions.delete":"🗑️ حذف","actions.remove":"إزالة","auth.permissions.denied":"⚠️ ليس لديك صلاحية لتنفيذ هذا الإجراء","home.nav.brand":"لوحة التحكم","home.hero.title":"مرحباً بك","home.hero.subtitle":"اختر المسار المناسب لإدارة أعمالك.","home.hero.greetingUser":"مرحباً {name}","home.bookings.title":"إدارة الحجوزات","home.bookings.description":"الوصول إلى لوحة التحكم الكاملة لإدارة الحجوزات، المعدات، الصيانة، والطاقم.","home.bookings.button":"انتقال إلى لوحة التحكم","home.projects.title":"إدارة المشاريع","home.projects.description":"إنشاء ومتابعة المشاريع، توزيع الطاقم والمعدات، وتتبع المصروفات المرتبطة بكل مشروع.","home.projects.button":"فتح لوحة المشاريع","home.users.title":"إدارة المستخدمين","home.users.description":"إنشاء المستخدمين، تعديل الصلاحيات، والاطلاع على سجلات الجلسات والنشاط.","home.users.button":"إدارة المستخدمين","actions.refresh":"🔄 تحديث البيانات","home.summary.title":"📊 ملخص سريع","home.summary.subtitle":"أرقام مختصرة تساعدك على اتخاذ القرار بسرعة.","home.summary.loading":"⏳ جارٍ جلب بيانات النظام...","home.summary.error":"تعذر تحميل بيانات النظام، حاول لاحقاً","home.summary.empty":"لا تتوفر بيانات بعد. ابدأ بإضافة سجلات.","home.summary.customers":"إجمالي العملاء","home.summary.reservationsToday":"حجوزات اليوم","home.summary.reservationsUpcoming":"حجوزات قادمة","home.summary.projectsActive":"مشاريع نشطة","home.summary.equipmentMaintenance":"معدات قيد الصيانة","home.summary.maintenanceHigh":"بلاغات صيانة عاجلة","home.summary.techniciansBusy":"أعضاء طاقم مشغولون"},en:{"actions.logout":"🚪 Log Out","actions.toggleTheme":"🌙 Dark Mode","theme.toggle.toLight":"☀️ Light Mode","theme.toggle.toDark":"🌙 Dark Mode","theme.toggle.titleLight":"Switch to Light Mode","theme.toggle.titleDark":"Switch to Dark Mode","theme.toggle.ariaLight":"Light mode enabled","theme.toggle.ariaDark":"Dark mode enabled","common.boolean.yes":"Yes","common.boolean.no":"No","language.toggle.labelAr":"🇸🇦 Arabic","language.toggle.labelEn":"🇬🇧 English","login.pageTitle":"Log In","login.header.title":"🔐 Log In","login.header.subtitle":"Enter your account credentials to access the dashboard.","login.form.username":"Username","login.form.username.placeholder":"Enter username","login.form.password":"Password","login.form.password.placeholder":"Enter password","login.form.password.toggleShow":"Show password","login.form.password.toggleHide":"Hide password","login.form.submit":"Sign In","login.errors.invalidCredentials":"❌ Incorrect username or password","login.errors.network":"🌐 Unable to reach the server. Please try again.","login.errors.generic":"⚠️ Something went wrong. Please try again.","login.footer.note":"Restricted to Art Ratio team members. Contact us if you run into any login issues.","actions.clearFilters":"🔄 Reset filters","actions.view":"👁️ View","actions.delete":"🗑️ Delete","actions.remove":"Remove","auth.permissions.denied":"⚠️ You do not have permission to perform this action","home.nav.brand":"Control Panel","home.hero.title":"Welcome","home.hero.subtitle":"Choose the best path to manage your operations.","home.hero.greetingUser":"Welcome {name}","home.bookings.title":"Bookings Management","home.bookings.description":"Access the full dashboard for bookings, equipment, maintenance, and crew.","home.bookings.button":"Open Dashboard","home.projects.title":"Projects Management","home.projects.description":"Create and follow up on projects, assign crew and equipment, and track expenses.","home.projects.button":"Open Projects Hub","home.users.title":"User Management","home.users.description":"Create accounts, adjust roles, and review session and activity logs.","home.users.button":"Manage Users","actions.refresh":"🔄 Refresh data","home.summary.title":"📊 Quick Snapshot","home.summary.subtitle":"Key metrics that keep you informed at a glance.","home.summary.loading":"⏳ Fetching system metrics...","home.summary.error":"Unable to load system metrics. Please try again later.","home.summary.empty":"No data yet. Start by adding your first records.","home.summary.customers":"Total Customers","home.summary.reservationsToday":"Reservations Today","home.summary.reservationsUpcoming":"Upcoming Reservations","home.summary.projectsActive":"Active Projects","home.summary.equipmentMaintenance":"Equipment in Maintenance","home.summary.maintenanceHigh":"Urgent Maintenance Tickets","home.summary.techniciansBusy":"Crew Members Busy"}});ye({ar:{"equipment.packages.selection.addToPackage":"➕ أضف إلى الحزمة","reservations.create.equipment.selector.addToReservation":"➕ أضف إلى الحجز"},en:{"equipment.packages.selection.addToPackage":"➕ Add to package","reservations.create.equipment.selector.addToReservation":"➕ Add to reservation"}});const P="dark-mode",H=new WeakSet,ne="theme-loading",be="art-ratio:session-theme";let re=!1;function we(){return Array.from(document.querySelectorAll("[data-theme-toggle], .theme-toggle-btn"))}function Ee(e){return e==="dark"?"dark":"light"}function Ke(e){try{window.sessionStorage?.setItem(be,Ee(e))}catch{}}function We(){try{const e=window.sessionStorage?.getItem(be);return e==="dark"?"dark":e==="light"?"light":null}catch{return null}}function Ye(){document.documentElement.classList.remove(ne);const e=document.body;e&&e.classList.remove(ne)}function B(e,{persist:t=!0}={}){const n=Ee(e),r=document.documentElement,o=document.body;n==="dark"?(r.classList.add(P,"dark"),o&&o.classList.add(P,"dark")):(r.classList.remove(P,"dark"),o&&o.classList.remove(P,"dark"));const a=n==="dark"?"dark":"light";r.setAttribute("data-theme",a),o&&o.setAttribute("data-theme",a),Ke(n),W(n);try{document.dispatchEvent(new CustomEvent("theme:changed",{detail:{theme:n}}))}catch(s){console.warn("⚠️ [theme.js] Failed to dispatch theme change event",s)}t&&K({theme:n}).catch(s=>{console.warn("⚠️ تعذر حفظ تفضيل السمة في الخادم",s)})}function O(){const e=document.body;return e&&e.classList.contains(P)||document.documentElement.classList.contains(P)?"dark":"light"}function z(){const e=O()==="dark"?"light":"dark";B(e,{persist:!0})}function Je(e,t){if(!e)return;const n=t==="dark",r=A("theme.toggle.toLight","☀️ الوضع العادي"),o=A("theme.toggle.toDark","🌙 الوضع الليلي"),a=A("theme.toggle.ariaLight","الوضع العادي مفعل"),s=A("theme.toggle.ariaDark","الوضع الليلي مفعل"),c=A("theme.toggle.titleLight","التبديل إلى الوضع العادي"),d=A("theme.toggle.titleDark","التبديل إلى الوضع الليلي");if(e.matches("[data-theme-toggle]")){const l=e.matches("input")?e:e.querySelector('input[type="checkbox"]'),u=n?r:o,f=n?a:s,g=n?c:d;l&&(l.checked=n,l.setAttribute("aria-label",u),l.setAttribute("aria-checked",String(n))),e.setAttribute("title",g),e.setAttribute("aria-label",f),e.setAttribute("data-theme-state",n?"dark":"light");const S=e.querySelector("[data-theme-label]");S&&(S.textContent=u)}else e.textContent=n?r:o,e.setAttribute("aria-pressed",String(n)),e.setAttribute("title",n?c:d),e.setAttribute("aria-label",n?a:s)}function W(e){we().forEach(t=>Je(t,e)),Ye()}function Qe(){const e=we();W(O()),e.forEach(t=>{if(!(!t||H.has(t))){if(t.matches("[data-theme-toggle]")){const n=t.matches("input")?t:t.querySelector('input[type="checkbox"]'),r=()=>{z()};n&&!H.has(n)?(n.addEventListener("change",r),H.add(n)):n||t.addEventListener("click",o=>{o.preventDefault(),z()})}else t.getAttribute("type")||t.setAttribute("type","button"),t.addEventListener("click",n=>{n.preventDefault(),z()});H.add(t)}})}function wt({skipRemote:e=!1}={}){const t=m(),o=(t?.theme==="dark"?"dark":t?.theme==="light"?"light":null)||We()||Xe();B(o,{persist:!1}),Ze({skipRemote:e})}function Xe(){try{if(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches)return"dark"}catch{}return"light"}function Ze({skipRemote:e=!1}={}){re||(re=!0,!e&&de().then(t=>{const n=t?.theme==="dark"?"dark":t?.theme==="light"?"light":null;n&&B(n,{persist:!1})}).catch(t=>{console.warn("⚠️ تعذر تحميل تفضيل السمة من الخادم",t)}))}document.addEventListener("language:changed",()=>{W(O()),Qe()});ue(e=>{const t=e?.theme==="dark"?"dark":e?.theme==="light"?"light":null;t&&t!==O()&&B(t,{persist:!1})});function Y(){const e=typeof window<"u"?window:globalThis;return e.__APP_DATA_STORE__||(e.__APP_DATA_STORE__={customers:[],reservations:[],equipment:[],technicians:[],maintenance:[],projects:[],technicianPayouts:[],packages:[]}),e.__APP_DATA_STORE__}function E(e,t,n){n!=null&&(e[t]=Array.isArray(n)?[...n]:n)}function et(){const e=Y();return{customers:[...e.customers],reservations:[...e.reservations],equipment:[...e.equipment],technicians:[...e.technicians],maintenance:[...e.maintenance],projects:[...e.projects],technicianPayouts:[...e.technicianPayouts],packages:[...e.packages]}}function Et(e={}){const t=Y();E(t,"customers",e.customers),E(t,"reservations",e.reservations),E(t,"equipment",e.equipment),E(t,"technicians",e.technicians),E(t,"maintenance",e.maintenance),E(t,"projects",e.projects),E(t,"technicianPayouts",e.technicianPayouts),E(t,"packages",e.packages)}let G=!1;function At(e=null){if(G)return;const t=e||(typeof window<"u"?window.__LEGACY_DATA__:null);if(!t||typeof t!="object"){G=!0;return}const n=Y();if(["customers","reservations","equipment","technicians","maintenance","projects","technicianPayouts","packages"].forEach(o=>{const a=t[o];Array.isArray(a)&&a.length>0&&(n[o]=[...a])}),G=!0,!e&&typeof window<"u")try{delete window.__LEGACY_DATA__}catch{}}function Ae(){let e=document.getElementById("toast-container");return e||(e=document.createElement("div"),e.id="toast-container",e.style.position="fixed",e.style.top="20px",e.style.left="50%",e.style.transform="translateX(-50%)",e.style.zIndex="110000",e.style.display="flex",e.style.flexDirection="column",e.style.alignItems="center",e.style.width="min(92vw, 380px)",e.style.pointerEvents="none",document.body.appendChild(e)),e}function Te(e){e.style.background="#333",e.style.color="#fff",e.style.padding="10px 18px",e.style.marginTop="10px",e.style.borderRadius="10px",e.style.boxShadow="0 8px 24px rgba(15, 23, 42, 0.32)",e.style.opacity="0",e.style.transition="opacity 0.3s ease",e.style.fontSize="0.875rem",e.style.lineHeight="1.4",e.style.pointerEvents="auto",e.style.backdropFilter="blur(4px)"}function Se(e){requestAnimationFrame(()=>{e.style.opacity="1"})}function Le(e,t){let n;const r=()=>{n&&(clearTimeout(n),n=null),e.style.opacity="0",setTimeout(()=>e.remove(),320)};return n=setTimeout(r,t),{hide:r,timeoutId:n}}function J(e,t=3e3,n){const r=Ae(),o=document.createElement("div");o.className="toast-message",o.textContent=e;const a=new Set(["success","error","info","warning"]);let s="info",c=3e3;typeof t=="number"&&Number.isFinite(t)?c=Math.max(0,t):typeof t=="string"&&a.has(t)&&(s=t),Te(o);const d={success:{bg:"#14532d",border:"rgba(34,197,94,0.35)",glow:"rgba(34,197,94,0.35)"},error:{bg:"#7f1d1d",border:"rgba(239,68,68,0.35)",glow:"rgba(239,68,68,0.35)"},info:{bg:"#1e3a8a",border:"rgba(59,130,246,0.35)",glow:"rgba(59,130,246,0.35)"},warning:{bg:"#7c2d12",border:"rgba(245,158,11,0.35)",glow:"rgba(245,158,11,0.35)"}},{bg:l,border:u,glow:f}=d[s]||d.info;o.style.background=l,o.style.border=`1px solid ${u}`,o.style.boxShadow=`0 8px 24px rgba(15, 23, 42, 0.32), 0 0 0 4px ${f}`,r.appendChild(o),Se(o);const{hide:g}=Le(o,c);o.addEventListener("click",g)}function Tt({message:e,duration:t=6e3,actionLabel:n,onAction:r,linkLabel:o,linkHref:a}={}){const s=Ae(),c=document.createElement("div");c.className="toast-message",Te(c);const d=document.createElement("div");d.style.display="flex",d.style.flexDirection="column",d.style.gap="8px";const l=document.createElement("span");l.textContent=e,d.appendChild(l);const u=document.createElement("div");u.style.display="flex",u.style.flexWrap="wrap",u.style.gap="8px";let f=!1,g=()=>{};if(o&&a){const i=document.createElement("a");i.href=a,i.textContent=o,i.target="_blank",i.rel="noopener noreferrer",i.style.color="#bfdbfe",i.style.textDecoration="underline",i.style.fontWeight="500",i.style.pointerEvents="auto",u.appendChild(i),f=!0}if(n&&typeof r=="function"){const i=document.createElement("button");i.type="button",i.textContent=n,i.style.border="1px solid rgba(255,255,255,0.4)",i.style.background="rgba(15, 23, 42, 0.2)",i.style.color="#fff",i.style.borderRadius="999px",i.style.padding="6px 14px",i.style.fontSize="0.78rem",i.style.cursor="pointer",i.addEventListener("click",p=>{p.preventDefault();try{r()}catch(y){console.error("⚠️ [toast] action callback failed",y)}finally{g()}}),u.appendChild(i),f=!0}f&&d.appendChild(u),c.appendChild(d),s.appendChild(c),Se(c);const{hide:S}=Le(c,t);g=S,c.addEventListener("click",S)}const oe="RSV",ae="PRJ",tt=4,x=(()=>{try{const e=typeof globalThis<"u"?globalThis:window;return e.__APP_SEQUENCE_STATE__=e.__APP_SEQUENCE_STATE__||{reservation:0,project:0},e.__APP_SEQUENCE_STATE__}catch{return{reservation:0,project:0}}})();function nt(){return Number.isFinite(x.reservation)?x.reservation:0}function rt(e){x.reservation=Math.max(0,Number.parseInt(e,10)||0)}function ot(){return Number.isFinite(x.project)?x.project:0}function at(e){x.project=Math.max(0,Number.parseInt(e,10)||0)}function _e(){try{const e=et();return{reservations:Array.isArray(e?.reservations)?e.reservations:[],projects:Array.isArray(e?.projects)?e.projects:[]}}catch(e){return console.warn("⚠️ [utils] Failed to load data snapshot for code generation",e),{reservations:[],projects:[]}}}function st(e,t){if(e==null)return 0;if(typeof e=="number")return Number.isFinite(e)?Math.max(0,Math.trunc(e)):0;const n=String(e).trim();if(!n)return 0;const r=`${t.toUpperCase()}-`,o=n.toUpperCase();let a=n;o.startsWith(r)&&(a=n.slice(r.length));const s=a.match(/(\d+)$/);if(s){const d=Number.parseInt(s[1],10);return Number.isFinite(d)?Math.max(0,d):0}const c=Number.parseInt(n,10);return Number.isFinite(c)?Math.max(0,c):0}function it(e){return Array.isArray(e)?e:[e]}function ve(e,t,n){return!Array.isArray(e)||e.length===0?0:e.reduce((r,o)=>{const a=n(o),c=it(a).reduce((d,l)=>{const u=st(l,t);return u>d?u:d},0);return c>r?c:r},0)}function Ce(e,t){const n=Math.max(0,Number.parseInt(t,10)||0);return`${e}-${String(n).padStart(tt,"0")}`}function St(){const{reservations:e}=_e(),t=ve(e,oe,r=>[r?.reservationCode,r?.reservation_code,r?.reservationId,r?.reservation_id,r?.id]),n=Math.max(t,nt())+1;return rt(n),Ce(oe,n)}function Lt(){const{projects:e}=_e(),t=ve(e,ae,r=>[r?.projectCode,r?.project_code,r?.code,r?.id]),n=Math.max(t,ot())+1;return at(n),Ce(ae,n)}function _t(e,t={}){if(!e)return"-";const n=new Date(e);if(Number.isNaN(n.getTime()))return"-";const r=document?.documentElement?.getAttribute("lang")||(typeof V=="function"?V():null)||"ar",a=String(r).toLowerCase().startsWith("ar")?"ar-SA-u-ca-gregory-nu-latn":"en-US",c=new Intl.DateTimeFormat(a,{dateStyle:"short",timeStyle:"short",hour12:!0,calendar:"gregory",...t}).formatToParts(n),d=n.getHours()>=12?"PM":"AM",l=c.map(u=>u.type==="dayPeriod"?d:u.value).join("").replace(/\u200f/g,"");return ct(l)}function ct(e){if(e==null)return"";e=String(e);const t=["٠","١","٢","٣","٤","٥","٦","٧","٨","٩"],n=["۰","۱","۲","۳","۴","۵","۶","۷","۸","۹"],r=["0","1","2","3","4","5","6","7","8","9"];return Array.from(e).map(o=>{const a=t.indexOf(o);if(a>-1)return r[a];const s=n.indexOf(o);return s>-1?r[s]:o}).join("")}const se={INVALID:{key:"login.errors.invalidCredentials",fallback:"❌ بيانات الدخول غير صحيحة"},NETWORK:{key:"login.errors.network",fallback:"🌐 تعذر الاتصال بالخادم. حاول مرة أخرى."},GENERIC:{key:"login.errors.generic",fallback:"⚠️ حدث خطأ غير متوقع. حاول مرة أخرى."}};let h=null;const lt={USER_UPDATED:"auth:user-updated"};function ut(){try{const e=window?.location?.hostname||"";return e==="localhost"||e==="127.0.0.1"||e===""||e==="::1"}catch{return!1}}function ke(){try{if(!ut())return!1;const e=new URL(window.location.href),t=(e.searchParams.get("bypassAuth")||e.searchParams.get("dev")||e.searchParams.get("debug")||"").toLowerCase();return window.__BYPASS_AUTH__===!0||t==="1"||t==="true"}catch{return!1}}function dt(e){if(typeof document>"u")return;const t=document.documentElement;t&&(e?t.dataset.userRole=e:delete t.dataset.userRole)}function ft(){typeof document>"u"||document.dispatchEvent(new CustomEvent(lt.USER_UPDATED,{detail:h?{...h}:null}))}function _(e){if(e&&typeof e=="object"){const t=typeof e.role=="string"?e.role.trim().toLowerCase():null;h={id:Number.isFinite(e.id)?Number(e.id):null,username:String(e.username||""),loginAt:e.loginAt??null,role:t}}else h=null;dt(h?.role||""),ft()}function mt(e="INVALID",t){if(t&&typeof t=="string")return t;const n=se[e]||se.INVALID;return A(n.key,n.fallback)}function gt(){const e=document.getElementById("login-error");e&&(e.textContent="",e.classList.add("hidden"))}function I(e="INVALID",t){const n=mt(e,t);J(n);const r=document.getElementById("login-error");r&&(r.textContent=n,r.classList.remove("hidden"))}async function ht({username:e,password:t,form:n}){if(!(!e||!t))try{if(typeof window>"u"||typeof navigator>"u"||!window.isSecureContext||!navigator.credentials||typeof navigator.credentials.store!="function")return;const r=(()=>{try{const a=document.querySelector('link[rel~="icon"]');return a?a.href:void 0}catch{return}})();let o=null;if(n&&n instanceof HTMLFormElement&&typeof window.PasswordCredential<"u")try{o=new window.PasswordCredential(n)}catch(a){console.warn("⚠️ تعذر إنشاء بيانات الاعتماد من النموذج",a)}if(!o&&typeof window.PasswordCredential<"u")try{o=new window.PasswordCredential({id:e,name:e,password:t,iconURL:r})}catch(a){console.warn("⚠️ تعذر إنشاء PasswordCredential مباشر",a)}!o&&typeof navigator.credentials.create=="function"&&(o=await navigator.credentials.create({password:{id:e,name:e,password:t,iconURL:r}})),o&&await navigator.credentials.store(o)}catch(r){console.warn("⚠️ تعذر حفظ بيانات الاعتماد في المتصفح",r)}}async function vt(e,t,{form:n}={}){const r=(e||"").trim(),o=t||"";if(gt(),!r||!o)return I("INVALID"),!1;try{const a=await U("/auth/",{method:"POST",body:{username:r,password:o}});_(a?.data??null);try{await K({theme:O()})}catch(s){console.warn("⚠️ تعذر حفظ تفضيل السمة بعد تسجيل الدخول",s)}return xe(),await ht({username:r,password:o,form:n}),window.location.href="home.html",!0}catch(a){if(console.error("❌ فشل تسجيل الدخول",a),_(null),a instanceof v)if(a.status===401||a.status===403)I("INVALID");else if(a.status>=500)I("GENERIC");else{const c=typeof a.message=="string"&&!/^request failed with status/i.test(a.message)?a.message:null;I("GENERIC",c)}else I("NETWORK");return!1}}async function Ct(){try{await U("/auth/",{method:"DELETE"})}catch(e){console.warn("⚠️ فشل تسجيل الخروج من الخادم",e)}finally{_(null),J("🚪 تم تسجيل الخروج"),window.location.href="login.html"}}async function pt({refresh:e=!1}={}){if(ke())return h||_({id:0,username:"dev-local",loginAt:new Date().toISOString(),role:"admin"}),h;if(!e&&h)return h;try{const t=await U("/auth/");return _(t?.data??null),h}catch(t){throw t instanceof v&&t.status===401&&_(null),t}}function kt({redirect:e=!0}={}){return ke()?(h||_({id:0,username:"dev-local",loginAt:new Date().toISOString(),role:"admin"}),Promise.resolve(h)):pt({refresh:!0}).then(t=>(!t&&e&&(window.location.href="login.html"),t)).catch(t=>t instanceof v&&t.status===401?(e&&(window.location.href="login.html"),null):(console.error("❌ خطأ أثناء التحقق من الجلسة",t),e&&(window.location.href="login.html"),null))}function yt(){return h?.role||null}function Pt(){return yt()==="admin"}function Rt(){J(A("auth.permissions.denied","⚠️ ليس لديك صلاحية لتنفيذ هذا الإجراء"),"error")}export{v as A,Tt as B,wt as a,U as b,kt as c,et as d,m as e,de as f,pt as g,Et as h,Qe as i,J as j,bt as k,Ct as l,At as m,ct as n,vt as o,V as p,lt as q,ye as r,ue as s,A as t,K as u,_t as v,Pt as w,Rt as x,Lt as y,St as z};
