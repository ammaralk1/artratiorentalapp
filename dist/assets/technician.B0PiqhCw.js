const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./reservationsUI.DxorBZGF.js","./controller.CWGE0quC.js","./auth.B0AFgB_X.js","./auth.B70gbxg1.css","./details.wfkS1dpa.js","./state.CRAa6pwq.js","./reservationsService.CHLeFMQv.js","./equipment.BLWVTuqD.js","./constants.pU9aDTAF.js","./quotePdf.C2lQPEPC.js","./canvasColorUtils.CviLtv6S.js","./reservationsActions.CmaChqQU.js","./projectsService.DeNiqXp7.js","./uiBridge.BLZZT8b9.js"])))=>i.map(i=>d[i]);
import{r as Ue,t as m,n as E,d as qt,j,b as Vt,a as He,c as ze,i as Oe,l as We}from"./auth.B0AFgB_X.js";import"./dashboard.CrZ5BksB.js";import{e as Tt,g as Ke,c as Ye}from"./form.CdjeJZlR.js";import{_ as Ee,g as Ge,w as Qe,s as Je}from"./uiBridge.BLZZT8b9.js";import{s as Ut,r as Xe,g as Ie}from"./state.CRAa6pwq.js";import{r as Se}from"./constants.pU9aDTAF.js";import{e as we}from"./reservationsActions.CmaChqQU.js";import{a as ae,g as Ht,D as ft,c as Ze,d as tn,b as en}from"./reservationsService.CHLeFMQv.js";import{g as At,b as nn,h as an,a as cn,c as sn,d as ie,s as rn,e as on}from"./projectFocusTemplates.DWwnjCqq.js";import{buildProjectPayload as ln,updateProjectApi as dn}from"./projectsService.DeNiqXp7.js";import{i as un}from"./dashboardShell.DF2kUed9.js";import"./equipment.BLWVTuqD.js";Ue({ar:{"technicianDetails.pageTitle":"Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…","technicianDetails.title":"ğŸ˜ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…","technicianDetails.actions.back":"â¬…ï¸ Ø§Ù„Ø¹ÙˆØ¯Ø©","technicianDetails.actions.edit":"âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…","technicianDetails.hero.subtitle":"Ø±Ø§Ø¬Ø¹ Ù†Ø´Ø§Ø· Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù… ÙˆÙ…Ù‡Ø§Ù…Ù‡ Ø§Ù„Ø­Ø§Ù„ÙŠØ©.","technicianDetails.hero.helper":"Ø§Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø­Ø¬ÙˆØ²Ø§Øª ÙˆÙ…Ø´Ø§Ø±ÙŠØ¹ Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù….","technicianTabs.reservations":"ğŸ“… Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„ÙÙ†ÙŠ","technicianTabs.projects":"ğŸ“ Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„ÙÙ†ÙŠ","technicianFinancial.stats.total":"ğŸ’¼ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø§Øª","technicianFinancial.stats.paid":"ğŸ’° Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©","technicianFinancial.stats.outstanding":"ğŸ§¾ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ","technicianFinancial.stats.totalDesc":"Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù€ {count} Ù…Ù‡Ø§Ù…","technicianFinancial.stats.paidDesc":"ØªÙ… ØªØ³Ø¬ÙŠÙ„ {count} Ø¯ÙØ¹Ø§Øª","technicianFinancial.stats.outstandingDesc":"Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ {amount}","technicianFinancial.actions.viewDetails":"ğŸ“Š Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„","technicianFinancial.modal.title":"ğŸ“Š Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ Ù„Ù„ÙÙ†ÙŠ","technicianFinancial.modal.subtitle":"Ù†Ø¸Ø±Ø© ØªÙØµÙŠÙ„ÙŠØ© Ø¹Ù„Ù‰ Ù…Ø³ØªØ­Ù‚Ø§Øª Ø§Ù„Ø¹Ø¶Ùˆ ÙˆØ§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ÙˆØ§Ù„Ø­Ø§Ù„ÙŠØ©.","technicianFinancial.list.title":"ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª ÙˆØ§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹","technicianFinancial.assignments.empty":"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø¬ÙˆØ²Ø§Øª Ø£Ùˆ Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…Ø±ØªØ¨Ø·Ø© Ù„Ø¹Ø±Ø¶Ù‡Ø§.","technicianFinancial.list.reservation":"Ø§Ù„Ø­Ø¬Ø² / Ø§Ù„Ù…Ø´Ø±ÙˆØ¹","technicianFinancial.list.period":"Ø§Ù„ÙØªØ±Ø©","technicianFinancial.list.due":"Ø§Ù„Ù…Ø³ØªØ­Ù‚","technicianFinancial.list.status":"Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹","technicianFinancial.list.outstanding":"Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ","technicianFinancial.list.settled":"Ù„Ø§ ÙŠÙˆØ¬Ø¯","technicianFinancial.list.reservationFallback":"Ø­Ø¬Ø² Ø±Ù‚Ù… {id}","technicianFinancial.list.projectReference":"Ù…Ø´Ø±ÙˆØ¹ #{id}","technicianFinancial.status.paid":"Ù…Ø¯ÙÙˆØ¹","technicianFinancial.status.partial":"Ù…Ø¯ÙÙˆØ¹ Ø¬Ø²Ø¦ÙŠØ§Ù‹","technicianFinancial.status.unpaid":"ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹","technicianFinancial.payouts.title":"ğŸ’¸ Ø³Ø¬Ù„ Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©","technicianFinancial.payouts.helper":"Ø³Ø¬Ù‘Ù„ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„ØªÙŠ ØªÙ… Ø¯ÙØ¹Ù‡Ø§ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø¶Ùˆ Ù…Ù† Ø§Ù„Ø´Ø±ÙƒØ© Ù„Ø¶Ù…Ø§Ù† ØªØªØ¨Ø¹ Ø§Ù„Ø³Ø¯Ø§Ø¯.","technicianFinancial.payouts.empty":"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯ÙØ¹Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ø¨Ø¹Ø¯.","technicianFinancial.payouts.form.amount":"ğŸ’° Ø§Ù„Ù…Ø¨Ù„Øº","technicianFinancial.payouts.form.date":"ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯ÙØ¹","technicianFinancial.payouts.form.note":"ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)","technicianFinancial.payouts.form.submit":"ğŸ’¸ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯ÙØ¹Ø©","technicianFinancial.payouts.confirmDelete":"âŒ Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¯ÙØ¹Ø©ØŸ","technicianFinancial.payouts.confirmTitle":"ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ø¯ÙØ¹Ø©","technicianFinancial.payouts.confirmMessage":"Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¯ÙØ¹Ø©ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.","technicianFinancial.payouts.confirmCancel":"Ø¥Ù„ØºØ§Ø¡","technicianFinancial.payouts.confirmAccept":"ğŸ—‘ï¸ Ø­Ø°Ù","technicianFinancial.payouts.toast.added":"âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯ÙØ¹Ø©.","technicianFinancial.payouts.toast.removed":"ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¯ÙØ¹Ø©.","technicianFinancial.payouts.toast.invalidAmount":"âš ï¸ Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© ØµØ­ÙŠØ­Ø© Ù„Ù„Ù…Ø¨Ù„Øº.","technicianFinancial.payouts.toast.failed":"âš ï¸ ØªØ¹Ø°Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯ÙØ¹Ø©ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.","technicianFinancial.payouts.toast.invalidTechnician":"âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ­Ø¯ÙŠØ¯ Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù… Ø­Ø§Ù„ÙŠØ§Ù‹.","technicianDetails.filters.search":"ğŸ” Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø£Ùˆ Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„Ø­Ø¬Ø² (Ù…Ø«Ù„ #123) Ø£Ùˆ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹...","technicianDetails.fields.role":"ğŸ‘” Ø§Ù„ÙˆØ¸ÙŠÙØ©:","technicianDetails.fields.department":"ğŸ§© Ø§Ù„Ù‚Ø³Ù…:","technicianDetails.fields.phone":"ğŸ“ Ø§Ù„Ø¬ÙˆØ§Ù„:","technicianDetails.fields.email":"ğŸ“§ Ø§Ù„Ø¨Ø±ÙŠØ¯:","technicianDetails.fields.wage":"ğŸ’° Ø§Ù„Ø£Ø¬Ø± Ø§Ù„ÙŠÙˆÙ…ÙŠ:","technicianDetails.fields.total":"ğŸ’¼ Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©:","technicianDetails.fields.baseStatus":"âš™ï¸ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©:","technicianDetails.fields.notes":"ğŸ“ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:","technicianDetails.fallback.email":"â€”","technicianDetails.fallback.name":"â€”","technicianDetails.fallback.role":"ØºÙŠØ± Ù…Ø­Ø¯Ø¯","technicianDetails.fallback.department":"â€”","technicianDetails.fallback.notes":"â€”","technicianDetails.errors.missingId":"âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø¹Ø±Ù Ø¹Ø¶Ùˆ Ø·Ø§Ù‚Ù… ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø·.","technicianDetails.errors.notFound":"âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø¶Ùˆ.","technicianDetails.errors.loadFailed":"âŒ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ø§Ø­Ù‚Ù‹Ø§.","technicianDetails.errors.reservationsLoadFailed":"âŒ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø­Ø¬ÙˆØ²Ø§Øª Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø¶Ùˆ Ø­Ø§Ù„ÙŠØ§Ù‹.","technicianDetails.status.loading":"â³ Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…...","technicianDetails.edit.modalTitle":"âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…","technicians.picker.actions.apply":"ØªÙ…","technicianProjects.title":"ğŸ“ Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„ÙÙ†ÙŠ","technicianReservations.title":"ğŸ“… Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„ÙÙ†ÙŠ","technicianProjects.empty":"Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø¶Ùˆ."},en:{"technicianDetails.pageTitle":"Crew Member Details","technicianDetails.title":"ğŸ˜ Crew Member Profile","technicianDetails.actions.back":"â¬…ï¸ Back","technicianDetails.actions.edit":"âœï¸ Edit Crew Member","technicianDetails.hero.subtitle":"Review the crew memberâ€™s activity and current assignments.","technicianDetails.hero.helper":"Use this page to keep track of their reservations and linked projects.","technicianTabs.reservations":"ğŸ“… Technician Reservations","technicianTabs.projects":"ğŸ“ Technician Projects","technicianFinancial.stats.total":"ğŸ’¼ Total Due","technicianFinancial.stats.paid":"ğŸ’° Paid Amount","technicianFinancial.stats.outstanding":"ğŸ§¾ Outstanding","technicianFinancial.stats.totalDesc":"Across {count} assignments","technicianFinancial.stats.paidDesc":"{count} payouts recorded","technicianFinancial.stats.outstandingDesc":"Outstanding {amount}","technicianFinancial.actions.viewDetails":"ğŸ“Š View details","technicianFinancial.modal.title":"ğŸ“Š Technician Financial Summary","technicianFinancial.modal.subtitle":"Detailed look at outstanding dues, completed payments, and linked work.","technicianFinancial.list.title":"Linked reservations & projects","technicianFinancial.assignments.empty":"No linked reservations or projects to display yet.","technicianFinancial.list.reservation":"Reservation / Project","technicianFinancial.list.period":"Period","technicianFinancial.list.due":"Due amount","technicianFinancial.list.status":"Payment status","technicianFinancial.list.outstanding":"Outstanding","technicianFinancial.list.settled":"None","technicianFinancial.list.reservationFallback":"Reservation #{id}","technicianFinancial.list.projectReference":"Project #{id}","technicianFinancial.status.paid":"Paid","technicianFinancial.status.partial":"Partially paid","technicianFinancial.status.unpaid":"Unpaid","technicianFinancial.payouts.title":"ğŸ’¸ Internal payout log","technicianFinancial.payouts.helper":"Record company payouts issued to this crew member to track settlements.","technicianFinancial.payouts.empty":"No payouts recorded yet.","technicianFinancial.payouts.form.amount":"ğŸ’° Amount","technicianFinancial.payouts.form.date":"ğŸ“… Payment date","technicianFinancial.payouts.form.note":"ğŸ“ Notes (optional)","technicianFinancial.payouts.form.submit":"ğŸ’¸ Record payout","technicianFinancial.payouts.confirmDelete":"âŒ Delete this payout?","technicianFinancial.payouts.confirmTitle":"ğŸ—‘ï¸ Delete payout","technicianFinancial.payouts.confirmMessage":"Are you sure you want to delete this payout? This action cannot be undone.","technicianFinancial.payouts.confirmCancel":"Cancel","technicianFinancial.payouts.confirmAccept":"ğŸ—‘ï¸ Delete","technicianFinancial.payouts.toast.added":"âœ… Payout logged successfully.","technicianFinancial.payouts.toast.removed":"ğŸ—‘ï¸ Payout removed.","technicianFinancial.payouts.toast.invalidAmount":"âš ï¸ Enter a valid payout amount.","technicianFinancial.payouts.toast.failed":"âš ï¸ Unable to record the payout. Please try again.","technicianFinancial.payouts.toast.invalidTechnician":"âš ï¸ Unable to determine the crew member right now.","technicianDetails.filters.search":"ğŸ” Search by client or enter the reservation ID (e.g. #123) or project ID...","technicianDetails.fields.role":"ğŸ‘” Role:","technicianDetails.fields.department":"ğŸ§© Department:","technicianDetails.fields.phone":"ğŸ“ Phone:","technicianDetails.fields.email":"ğŸ“§ Email:","technicianDetails.fields.wage":"ğŸ’° Daily Rate:","technicianDetails.fields.total":"ğŸ’¼ Total Charge:","technicianDetails.fields.baseStatus":"âš™ï¸ Base Status:","technicianDetails.fields.notes":"ğŸ“ Notes:","technicianDetails.fallback.email":"â€”","technicianDetails.fallback.name":"â€”","technicianDetails.fallback.role":"Not specified","technicianDetails.fallback.department":"â€”","technicianDetails.fallback.notes":"â€”","technicianDetails.errors.missingId":"âš ï¸ Missing crew member identifier in the URL.","technicianDetails.errors.notFound":"âš ï¸ Crew member not found.","technicianDetails.errors.loadFailed":"âŒ Unable to load crew member details. Please try again later.","technicianDetails.errors.reservationsLoadFailed":"âŒ Unable to load this crew member's reservations right now.","technicianDetails.status.loading":"â³ Loading crew member details...","technicianDetails.edit.modalTitle":"âœï¸ Edit Crew Member","technicians.picker.actions.apply":"Done","technicianProjects.title":"ğŸ“ Technician Projects","technicianReservations.title":"ğŸ“… Technician Reservations","technicianProjects.empty":"No projects are linked to this crew member."}});let kt={},w={initialized:!1,currentId:null,modal:{el:null,body:null},projectsMap:new Map},ce=!1;function Rt(t=""){return E(String(t)).replace(/[Ù¬ØŒ]/g,"").trim().toLowerCase()}function Fe(t,e,n){if(!e||!n)return;const{startDate:a,endDate:c}=Se(t);e._flatpickr?a?e._flatpickr.setDate(a,!1,"Y-m-d"):e._flatpickr.clear():e.value=a||"",n._flatpickr?c?n._flatpickr.setDate(c,!1,"Y-m-d"):n._flatpickr.clear():n.value=c||""}function O(t){if(!Array.isArray(t))return[];const e=new Set;return t.map(n=>{if(n==null)return null;if(typeof n=="object"){const a=n.id??n.technicianId??n.technician_id??n.technician?.id??null;return a!=null?String(a):null}return typeof n=="string"||typeof n=="number"?String(n):null}).filter(n=>!n||e.has(n)?!1:(e.add(n),!0))}async function Te(t){const e=document.getElementById("technician-reservations");if(!e)return;if(!ce){try{await we({suppressError:!1,force:!0})}catch(p){console.error("âŒ [technician-details] Failed to hydrate reservations list",p),e.innerHTML=`<p class="text-danger" data-i18n data-i18n-key="technicianDetails.errors.reservationsLoadFailed">${m("technicianDetails.errors.reservationsLoadFailed","âŒ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø­Ø¬ÙˆØ²Ø§Øª Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø¶Ùˆ Ø­Ø§Ù„ÙŠØ§Ù‹.")}</p>`;return}ce=!0}const n=document.getElementById("technician-search-reservation"),a=document.getElementById("technician-filter-start-date"),c=document.getElementById("technician-filter-end-date"),i=document.getElementById("technician-reservation-date-range"),o=document.getElementById("technician-reservation-status-filter"),r=document.getElementById("technician-clear-filters");window.flatpickr&&(a&&window.flatpickr(a,{dateFormat:"Y-m-d"}),c&&window.flatpickr(c,{dateFormat:"Y-m-d"}));const d=()=>{let p=E(a?.value||"").trim(),A=E(c?.value||"").trim(),b=i?.value||"";if(new Set(["","today","week","month"]).has(b)||(b="",i&&(i.value=""),a&&(a._flatpickr&&a._flatpickr.clear(),a.value=""),c&&(c._flatpickr&&c._flatpickr.clear(),c.value=""),p="",A=""),!p&&!A&&b){const{startDate:M,endDate:l}=Se(b);p=M,A=l}return{searchTerm:Rt(n?.value||""),startDate:p,endDate:A,status:o?.value||"",quickRange:b,technicianId:t}},h=()=>{kt=d(),re("technician-reservations",kt)};n&&!n.dataset.listenerAttached&&(n.addEventListener("input",()=>{n.value=E(n.value),h()}),n.dataset.listenerAttached="true"),a&&!a.dataset.listenerAttached&&(a.addEventListener("change",()=>{i&&(i.value=""),h()}),a.dataset.listenerAttached="true"),c&&!c.dataset.listenerAttached&&(c.addEventListener("change",()=>{i&&(i.value=""),h()}),c.dataset.listenerAttached="true"),i&&!i.dataset.listenerAttached&&(i.addEventListener("change",()=>{Fe(i.value,a,c),h()}),i.dataset.listenerAttached="true"),o&&!o.dataset.listenerAttached&&(o.addEventListener("change",h),o.dataset.listenerAttached="true"),r&&!r.dataset.listenerAttached&&(r.addEventListener("click",()=>{n&&(n.value=""),a&&(a._flatpickr&&a._flatpickr.clear(),a.value=""),c&&(c._flatpickr&&c._flatpickr.clear(),c.value=""),i&&(i.value=""),o&&(o.value=""),h()}),r.dataset.listenerAttached="true"),window.refreshTechnicianReservationsViews=()=>{re("technician-reservations",kt)},h()}function ke(t){w.currentId=t;const{container:e}=at();e&&(w.initialized||(mn(),hn(),gn(),document.addEventListener("projects:changed",()=>{w.currentId&&_()}),document.addEventListener("language:changed",()=>{w.currentId&&_()}),document.addEventListener("customers:changed",()=>{w.currentId&&_()}),document.addEventListener("technicians:updated",()=>{w.currentId&&_()}),w.initialized=!0),_())}function at(){return{container:document.getElementById("technician-projects"),searchInput:document.getElementById("technician-project-search"),startInput:document.getElementById("technician-project-start-date"),endInput:document.getElementById("technician-project-end-date"),rangeSelect:document.getElementById("technician-project-date-range"),statusSelect:document.getElementById("technician-project-status-filter"),clearBtn:document.getElementById("technician-projects-clear-filters")}}function mn(){const{searchInput:t,statusSelect:e,clearBtn:n,startInput:a,endInput:c,rangeSelect:i}=at();t&&!t.dataset.listenerAttached&&(t.addEventListener("input",()=>{t.value=E(t.value),_()}),t.dataset.listenerAttached="true"),a&&!a.dataset.listenerAttached&&(window.flatpickr&&window.flatpickr(a,{dateFormat:"Y-m-d"}),a.addEventListener("change",()=>{i&&(i.value=""),_()}),a.dataset.listenerAttached="true"),c&&!c.dataset.listenerAttached&&(window.flatpickr&&window.flatpickr(c,{dateFormat:"Y-m-d"}),c.addEventListener("change",()=>{i&&(i.value=""),_()}),c.dataset.listenerAttached="true"),i&&!i.dataset.listenerAttached&&(i.addEventListener("change",()=>{Fe(i.value,a,c),_()}),i.dataset.listenerAttached="true"),e&&!e.dataset.listenerAttached&&(e.addEventListener("change",()=>{_()}),e.dataset.listenerAttached="true"),n&&!n.dataset.listenerAttached&&(n.addEventListener("click",()=>{const{searchInput:o,statusSelect:r,startInput:d,endInput:h,rangeSelect:p}=at();o&&(o.value=""),r&&(r.value=""),d&&(d._flatpickr&&d._flatpickr.clear(),d.value=""),h&&(h._flatpickr&&h._flatpickr.clear(),h.value=""),p&&(p.value=""),_()}),n.dataset.listenerAttached="true")}function hn(){const{container:t}=at();!t||t.dataset.projectModalListenerAttached==="true"||(t.addEventListener("click",fn),t.dataset.projectModalListenerAttached="true")}function pn(){const{container:t}=at();t&&t.querySelectorAll(".project-focus-card").forEach(e=>{e.dataset.technicianModalListenerAttached!=="true"&&(e.addEventListener("click",n=>{if(n.target.closest("[data-ignore-project-modal]"))return;const c=e.dataset.projectId?String(e.dataset.projectId):"";c&&Et(c)}),e.dataset.technicianModalListenerAttached="true")})}function fn(t){const e=t.target.closest(".project-focus-card");if(!e||(console.debug("[technician] card click",e.dataset.projectId),!e)||t.target.closest("[data-ignore-project-modal]"))return;const a=e.dataset.projectId?String(e.dataset.projectId):"";a&&Et(a)}function gn(){zt()}function zt(){if(w.modal?.el&&w.modal?.body)return!0;const t=document.getElementById("projectDetailsModal"),e=document.getElementById("project-details-body");return!t||!e?!1:(w.modal={el:t,body:e},!0)}function _(){const{container:t,searchInput:e,statusSelect:n,startInput:a,endInput:c}=at();if(!t||!w.currentId)return;const i=Rt(e?.value||""),o=n?.value||"",r=a?.value||"",d=c?.value||"",h=r?new Date(`${r}T00:00:00`):null,p=d?new Date(`${d}T23:59:59`):null,{projects:A=[],customers:b=[],technicians:k=[],reservations:q=[]}=qt(),M=new Map(b.map(s=>[String(s.id),s])),l=new Map(k.map(s=>[String(s.id),s])),u=new Map(A.map(s=>[String(s.id),s])),I=yn(q),v=String(w.currentId),L=new Map,B=(s,f=null)=>{if(!s)return;const D=s.id!=null?String(s.id):s.projectId!=null?String(s.projectId):null;if(D&&!L.has(D)){const g=f??O(s?.technicians);L.set(D,{...s,technicians:g})}};A.forEach(s=>{const f=O(s?.technicians);f.length&&f.includes(v)&&B({...s,technicians:f},f)}),q.forEach(s=>{if(!s?.projectId)return;const f=O(s.technicians);if(!f.includes(v))return;const D=String(s.projectId),g=L.get(D),y=u.get(D),{effectiveConfirmed:S}=ae(s,y??g??null);if(g){const F=O(g.technicians),Y=Array.from(new Set([...F,...f]));L.set(D,{...g,technicians:Y,confirmed:g.confirmed||S});return}if(y){const F=O(y?.technicians),Y=Array.from(new Set([...F,...f]));B({...y,technicians:Y,confirmed:ae(s,y).effectiveConfirmed},Y);return}B({id:D,title:s.projectTitle||s.title||s.project_title||`#${D}`,description:s.notes||"",start:s.projectStart||s.start||null,end:s.projectEnd||s.end||null,technicians:f,clientId:s.projectClientId??s.customerId??null,confirmed:S,status:s.status??null,equipmentEstimate:s.totalAmount??s.total_amount??0,createdAt:s.start??s.created_at??null},f)});const it=Array.from(L.values());w.projectsMap=L,typeof window=="object"&&(window.__ART_RATIO_APP_DEBUG={...window.__ART_RATIO_APP_DEBUG||{},technicianProjects:{projectsMap:L,keys:()=>Array.from(L.keys())}});const V=it.filter(s=>{if(i){const f=M.get(String(s.clientId))?.customerName||"",D=[s.id,s.projectId,s.project_id,s.projectCode,s.project_code,s.reference,s.reference_code,s.code,At(s)];if(!Rt([s.title,s.description,f,D.filter(y=>y!=null&&y!=="").map(String).join(" ")].filter(Boolean).join(" ")).includes(i))return!1}if(o&&En(s)!==o)return!1;if(h||p){const f=s.start||s.createdAt||s.created_at||null,D=s.end||s.projectEnd||s.project_end||null,g=f?new Date(f):null,y=D?new Date(D):g;if(h&&g&&g<h||p&&y&&y>p)return!1}return!0}).sort((s,f)=>{const D=new Date(s.start||s.createdAt||0).getTime();return new Date(f.start||f.createdAt||0).getTime()-D});if(!V.length){const s=m("technicianProjects.empty",t.dataset.empty||"Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø¶Ùˆ.");t.innerHTML=`<div class="project-card-grid__item project-card-grid__item--full"><div class="alert alert-info text-center mb-0">${s}</div></div>`;return}t.innerHTML=V.map(s=>{const f=At(s),D=f?I.get(f)||[]:[],g=M.get(String(s.clientId))||null;return nn(s,{customer:g,techniciansMap:l,reservations:D})}).join(""),pn()}function yn(t=[]){const e=new Map;return t.forEach(n=>{const a=n?.projectId??n?.project_id??n?.projectID;if(a==null)return;const c=String(a);e.has(c)||e.set(c,[]),e.get(c).push(n)}),e}function Et(t){const e=String(t||"").trim();if(console.debug("[technician] open details",e),!e||!zt())return;const n=w.modal;if(!n?.body)return;const{projects:a=[],reservations:c=[],customers:i=[]}=qt(),o=w.projectsMap?.get(e)||null;let r=o??se(a,e);if(r||(r=se(a,e)),!r)return;const d=String(w.currentId||"");let h=O(r.technicians);if(!h.length&&o&&(h=O(o.technicians),r={...o,...r}),typeof window=="object"&&(window.__ART_RATIO_APP_DEBUG={...window.__ART_RATIO_APP_DEBUG||{},technicianProjects:{...window.__ART_RATIO_APP_DEBUG?.technicianProjects||{},lastOpen:{id:e,activeTechnicianId:d,normalizedTechnicians:h}}}),d&&!h.includes(d)){console.debug("[technician] open details skipped (technician not in project)",{normalizedId:e,activeTechnicianId:d,normalizedTechnicians:h});return}r={...r,technicians:h};const p=i.find(b=>String(b.id)===String(r.clientId))||null,A=c.filter(b=>{const k=an(b);return k&&k===e});n.body.dataset.mode="view",n.body.innerHTML=cn(r,{customer:p,reservations:A}),bn(r),vn(n.body),window.bootstrap?.Modal?window.bootstrap.Modal.getOrCreateInstance(n.el).show():(n.el.classList.add("show"),n.el.style.display="block")}function bn(t){if(!t||!w.modal?.body)return;const e=w.modal.body.querySelector('[data-action="edit-project"]');e&&e.addEventListener("click",n=>{n.preventDefault(),Dn(t)})}function vn(t){if(!t)return;const e=t.querySelectorAll('[data-action="view-reservation"]');if(!e.length)return;async function n(a){if(!Number.isInteger(a)||a<0)return!1;const c=Ge("showReservationDetails");if(typeof c=="function")return c(a),!0;try{const i=await Qe("showReservationDetails");if(typeof i=="function")return i(a),!0}catch(i){console.warn("âš ï¸ [technicianDetails] Unable to resolve reservation UI handler",i)}return!1}e.forEach(a=>{a.dataset.listenerAttached!=="true"&&(a.addEventListener("click",async c=>{c.preventDefault(),c.stopPropagation();const i=Ht();let o=Number.parseInt(a.dataset.index||"",10);if(!Number.isInteger(o)||o<0){const d=a.dataset.reservationId;d&&(o=i.findIndex(p=>[p?.id,p?.reservationId,p?.reservation_id].some(b=>b!=null&&String(b)===d)))}await n(o)||j(m("projects.details.reservations.viewUnavailable","ØªØ¹Ø°Ø± ÙØªØ­ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø² Ø§Ù„Ø¢Ù†"))}),a.dataset.listenerAttached="true")})}function Dn(t){if(!t||!zt())return;const e=w.modal;if(!e?.body)return;const{customers:n=[]}=qt(),a=n.find(r=>String(r.id)===String(t.clientId))||null,c=a?.customerName||t.clientName||t.customerName||"",i=t.clientCompany||a?.companyName||a?.company||"",o=Array.isArray(t?.expenses)?t.expenses.map((r,d)=>({id:r?.id||`expense-${t.id}-${d}-${Date.now()}`,label:r?.label||"",amount:Number(r?.amount)||0})):[];e.body.dataset.mode="edit",e.body.innerHTML=sn(t,{clientName:c,clientCompany:i}),An(t,{clientName:c,clientCompany:i,expenses:o})}function An(t,{clientName:e="",clientCompany:n="",expenses:a=[]}={}){const c=w.modal?.body;if(!t||!c)return;const i=c.querySelector("#project-details-edit-form");if(!i)return;const o={clientCompany:n,expenses:Array.isArray(a)?[...a]:[]},r=i.querySelector('[data-action="cancel-edit"]');r&&r.addEventListener("click",g=>{g.preventDefault(),Et(t.id)});const d=i.querySelector("#project-edit-expense-label"),h=i.querySelector("#project-edit-expense-amount"),p=i.querySelector("#project-edit-expense-note"),A=i.querySelector('[data-action="add-expense"]'),b=i.querySelector("#project-edit-expense-list"),k=i.querySelector('[name="project-start-date"]'),q=i.querySelector('[name="project-start-time"]'),M=i.querySelector('[name="project-end-date"]'),l=i.querySelector('[name="project-end-time"]'),u=i.querySelector("#project-edit-payment-status"),I=i.querySelector("#project-edit-tax"),v=i.querySelector("#project-edit-company-share"),L=i.querySelector("#project-edit-discount-type"),B=i.querySelector("#project-edit-discount"),it=i.querySelector("#project-edit-payment-progress-type"),V=i.querySelector("#project-edit-payment-progress-value");let s=!1;const f=g=>{!I||!v||s||(s=!0,g==="share"?v.checked?(I.checked||(I.checked=!0),Tt(v,ft)):I.checked&&(I.checked=!1):g==="tax"&&(I.checked?Tt(v,ft):v.checked&&(v.checked=!1)),s=!1)},D=()=>{b&&(b.innerHTML=on(o.expenses))};D(),A&&!A.dataset.listenerAttached&&(A.addEventListener("click",g=>{g.preventDefault();const y=d?.value.trim()||"",S=E(h?.value||"0"),F=Number(S);if(!y){j(m("projects.toast.missingExpenseLabel","âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙˆØµÙ Ø§Ù„Ù…ØµØ±ÙˆÙ")),d?.focus();return}if(!Number.isFinite(F)||F<=0){j(m("projects.toast.invalidExpenseAmount","âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­")),h?.focus();return}o.expenses.push({id:`expense-${t.id}-${Date.now()}`,label:y,amount:F,note:(p?.value||"").trim()}),d&&(d.value=""),h&&(h.value=""),p&&(p.value=""),D()}),A.dataset.listenerAttached="true"),b&&!b.dataset.listenerAttached&&(b.addEventListener("click",g=>{const y=g.target.closest('[data-action="remove-expense"]');if(!y)return;const{id:S}=y.dataset;o.expenses=o.expenses.filter(F=>String(F.id)!==String(S)),D()}),b.dataset.listenerAttached="true"),B&&!B.dataset.listenerAttached&&(B.addEventListener("input",g=>{const y=g.target;y instanceof HTMLInputElement&&(y.value=E(y.value||""))}),B.dataset.listenerAttached="true"),V&&!V.dataset.listenerAttached&&(V.addEventListener("input",g=>{const y=g.target;y instanceof HTMLInputElement&&(y.value=E(y.value||""))}),V.dataset.listenerAttached="true"),u&&!u.dataset.listenerAttached&&(u.addEventListener("change",()=>{u.dataset.userSelected="true"}),u.dataset.listenerAttached="true"),v&&!v.dataset.listenerAttached&&(v.addEventListener("change",()=>f("share")),v.dataset.listenerAttached="true"),I&&!I.dataset.listenerAttached&&(I.addEventListener("change",()=>f("tax")),I.dataset.listenerAttached="true"),v?.checked&&Tt(v,ft),f(v?.checked?"share":"tax"),i.addEventListener("submit",async g=>{if(g.preventDefault(),i.dataset.submitting==="true")return;const y=i.querySelector('[name="project-title"]'),S=i.querySelector('[name="project-type"]'),F=i.querySelector('[name="project-description"]'),Y=y?.value.trim()||"",Yt=S?.value||"",Gt=k?.value.trim()||"",Ne=q?.value.trim()||"",Be=F?.value.trim()||"",Qt=u?.value?.toLowerCase()||"unpaid",Jt=["paid","partial"].includes(Qt)?Qt:"unpaid",ct=I?.checked===!0;if(!Y||!Yt||!Gt){j(m("projects.toast.missingRequiredFields","âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©")),y?.focus();return}const Xt=M?.value.trim()||"",Re=l?.value.trim()||"",Zt=ie(Gt,Ne),St=Xt?ie(Xt,Re):"";if(St){const U=new Date(Zt),H=new Date(St);if(!Number.isNaN(U.getTime())&&!Number.isNaN(H.getTime())&&U>H){j(m("projects.toast.invalidDateRange","âš ï¸ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨Ø¹Ø¯ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©")),M?.focus();return}}const pt=At(t);if(!pt){j(m("projects.toast.editMissing","âš ï¸ ØªØ¹Ø°Ù‘Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ ØªØ¹Ø¯ÙŠÙ„Ù‡"));return}const te=Number(t?.equipmentEstimate??t?.equipment_estimate??0)||0,_e=o.expenses.reduce((U,H)=>U+(Number(H.amount)||0),0),ee=L?.value==="amount"?"amount":"percent",Ce=E(B?.value||"0");let st=Number.parseFloat(Ce);(!Number.isFinite(st)||st<0)&&(st=0);const rt=v?.checked===!0;let ot=rt?Ke(v):null;(!Number.isFinite(ot)||ot<=0)&&(ot=rt&&ct?ft:null);const lt=Ye({equipmentEstimate:te,expensesTotal:_e,discountValue:st,discountType:ee,applyTax:ct,companyShareEnabled:rt,companySharePercent:ot}),Me=it?.value==="amount"?"amount":"percent",ne=E(V?.value||""),$e=ne?Number.parseFloat(ne):null,J=Ze({totalAmount:lt.totalWithTax,progressType:Me,progressValue:$e,history:[]}),wt=u?.dataset?.userSelected==="true",qe=tn({manualStatus:wt?Jt:null,paidAmount:J.paidAmount,paidPercent:J.paidPercent,totalAmount:lt.totalWithTax}),Ft=wt?Jt:qe;!wt&&u&&(u.value=Ft),u?.dataset&&delete u.dataset.userSelected;const Ve=ln({projectCode:t.projectCode,title:Y,type:Yt,clientId:t.clientId,clientCompany:o.clientCompany,description:Be,start:Zt,end:St||null,applyTax:ct,paymentStatus:Ft,equipmentEstimate:te,expenses:o.expenses,discount:st,discountType:ee,companyShareEnabled:rt&&ct,companySharePercent:rt&&ct?ot:null,companyShareAmount:lt.companyShareAmount,taxAmount:lt.taxAmount,totalWithTax:lt.totalWithTax,confirmed:t.confirmed,technicians:Array.isArray(t?.technicians)?t.technicians:[],equipment:Array.isArray(t?.equipment)?t.equipment:[],paidAmount:J.paidAmount,paidPercentage:J.paidPercent,paymentProgressType:J.paymentProgressType,paymentProgressValue:J.paymentProgressValue}),$=i.querySelector('button[type="submit"]');$&&($.disabled=!0,$.dataset.originalText=$.textContent||"",$.textContent=m("projects.details.edit.saving","Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...")),i.dataset.submitting="true";try{const U=await dn(pt,Ve);await rn(pt,Ft),document.dispatchEvent(new CustomEvent("projects:changed")),j(m("projects.toast.updated","âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¨Ù†Ø¬Ø§Ø­")),_();const H=At(U)||pt;H&&Et(H)}catch(U){console.error("âŒ [technicianDetails] Failed to update project from modal",U);const H=typeof U?.message=="string"?U.message:m("projects.toast.updateFailed","ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰");j(H,"error")}finally{delete i.dataset.submitting,$&&($.disabled=!1,$.dataset.originalText&&($.textContent=$.dataset.originalText,delete $.dataset.originalText))}})}function se(t=[],e){const n=String(e);return t.find(a=>[a?.id,a?.projectId,a?.project_id].some(i=>i!=null&&String(i)===n))||null}function En(t){const e=new Date,n=t.start?new Date(t.start):null,a=t.end?new Date(t.end):null;return n&&!Number.isNaN(n.getTime())&&n>e?"upcoming":a&&!Number.isNaN(a.getTime())&&a<e?"completed":"ongoing"}async function re(t,e){try{const n=await Ee(()=>import("./reservationsUI.DxorBZGF.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]),import.meta.url);try{n.renderReservations?.(t,e)}catch(a){console.error("âŒ [technician-details] renderReservations failed",a)}}catch(n){console.error("âŒ [technician-details] Failed to load reservations UI module",n)}}async function In(t,{signal:e}={}){const n=new URLSearchParams;t&&n.set("technician_id",t);const a=n.toString(),c=await Vt(`/technician-payouts/${a?`?${a}`:""}`,{signal:e});return Array.isArray(c?.data)?c.data:[]}async function Sn({technicianId:t,amount:e,note:n,paidAt:a}){return(await Vt("/technician-payouts/",{method:"POST",body:{technician_id:t,amount:e,note:n,paid_at:a}}))?.data??null}async function wn(t){return(await Vt(`/technician-payouts/?id=${encodeURIComponent(t)}`,{method:"DELETE"}))?.data??null}He();ze();un();const Fn=new URLSearchParams(window.location.search),T=Fn.get("id"),z=document.getElementById("technician-details"),oe=document.getElementById("technician-hero-name"),Tn=document.getElementById("technician-hero-status"),le=document.getElementById("technician-hero-role"),Lt=document.getElementById("technician-hero-position"),gt=document.getElementById("dashboard-greeting-technician-name"),dt=document.getElementById("dashboard-greeting-technician-role"),kn=document.getElementById("dashboard-greeting-technician-status"),de=document.getElementById("dashboard-greeting-technician-role-badge"),ue=document.getElementById("sidebar-stat-projects"),me=document.getElementById("sidebar-stat-reservations"),he=document.getElementById("sidebar-stat-equipment"),pe=document.getElementById("sidebar-stat-technicians"),R={total:document.getElementById("technician-financial-total"),totalDesc:document.getElementById("technician-financial-total-desc"),paid:document.getElementById("technician-financial-paid"),paidDesc:document.getElementById("technician-financial-paid-desc"),outstanding:document.getElementById("technician-financial-outstanding"),outstandingDesc:document.getElementById("technician-financial-outstanding-desc")},P=document.getElementById("technician-financial-modal"),yt=document.getElementById("technician-financial-open"),fe=document.getElementById("technician-financial-modal-total"),ge=document.getElementById("technician-financial-modal-paid"),ye=document.getElementById("technician-financial-modal-outstanding"),xt=document.getElementById("technician-financial-modal-empty"),Pt=document.getElementById("technician-financial-modal-table-wrapper"),jt=document.getElementById("technician-financial-modal-rows"),Ln=Array.from(document.querySelectorAll("[data-financial-modal-close]")),X=document.getElementById("technician-payout-form"),x=document.getElementById("technician-payout-amount"),tt=document.getElementById("technician-payout-date"),xn=document.getElementById("technician-payout-note"),Q=document.getElementById("technician-payouts-list"),Nt=document.getElementById("technician-payouts-empty"),et=document.getElementById("technician-payout-confirm-modal"),W=document.getElementById("technician-payout-confirm-yes"),Pn=Array.from(document.querySelectorAll("[data-payout-confirm-close]")),_t=Array.from(document.querySelectorAll("[data-technician-tab]")),jn=new Map(Array.from(document.querySelectorAll("[data-technician-tab-panel]")).map(t=>[t.getAttribute("data-technician-tab-panel"),t]));let Ot="reservations",N=null,G={totals:{total:0,paid:0,outstanding:0},metrics:{assignments:0,payoutsCount:0,outstandingAmount:0},breakdown:[],payouts:[]},Bt=[],It=null;Oe();function Wt(){return document.documentElement.getAttribute("lang")||"ar"}function bt(t){const e=Number(t)||0,a=Wt()==="ar"?"ar-SA-u-nu-latn":"en-US";try{return new Intl.NumberFormat(a,{maximumFractionDigits:0}).format(e)}catch{return E(String(e))||"0"}}function ut({projects:t=0,reservations:e=0,equipment:n=0,technicians:a=0}={}){ue&&(ue.textContent=bt(t)),me&&(me.textContent=bt(e)),he&&(he.textContent=bt(n)),pe&&(pe.textContent=bt(a))}function Nn(t){if(!t||typeof t!="object")return 0;const e=[t.quantity,t.qty,t.count];for(const n of e){if(n==null||n==="")continue;const a=Number(E(String(n)));if(Number.isFinite(a))return a>0?a:0}return 1}function Bn(t,e){if(!Array.isArray(t)||!t.length)return{projects:0,reservations:0,equipment:0,technicians:e?1:0};const n=new Set,a=new Set;e&&a.add(String(e));let c=0;return t.forEach(i=>{if(!i)return;i.projectId!=null&&n.add(String(i.projectId)),O(i.technicians).forEach(r=>a.add(r)),Array.isArray(i.items)&&i.items.forEach(r=>{c+=Nn(r)})}),{projects:n.size,reservations:t.length,equipment:c,technicians:a.size||(e?1:0)}}function C(t){const e=Number(t)||0,a=Wt()==="ar"?"ar-SA-u-ca-gregory-nu-latn":"en-US";try{const c=new Intl.NumberFormat(a,{minimumFractionDigits:0,maximumFractionDigits:0}).format(Math.round(e));return`${E(c)} SR`}catch{const i=Math.round(e);return`${E(String(i))} SR`}}function Ct(t){if(!t)return"â€”";const e=t instanceof Date?t:new Date(t);if(Number.isNaN(e.getTime()))return"â€”";const a=Wt()==="ar"?"ar-SA-u-ca-gregory-nu-latn":"en-US";try{return new Intl.DateTimeFormat(a,{dateStyle:"medium"}).format(e)}catch{const i=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0"),r=e.getFullYear();return`${i}/${o}/${r}`}}function nt(t=""){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function be(t={}){const e=[t.dailyWage,t.daily_rate,t.dailyRate,t.rate,t.wage];for(const n of e){if(n==null||n==="")continue;const a=Number(E(String(n)));if(Number.isFinite(a))return a}return 0}function Rn(t){const e=typeof t=="string"?t.toLowerCase():"unpaid";let n="technicianFinancial.status.unpaid",a="technician-payment-badge technician-payment-badge--unpaid";return e==="paid"?(n="technicianFinancial.status.paid",a="technician-payment-badge technician-payment-badge--paid"):e==="partial"&&(n="technicianFinancial.status.partial",a="technician-payment-badge technician-payment-badge--partial"),`<span class="${a}" data-i18n data-i18n-key="${n}">${m(n,n)}</span>`}function ve(t){const{totals:e,metrics:n}=t,a=Number(n.assignments??0),c=Number(n.payoutsCount??0),i=m("technicianFinancial.stats.totalDesc","Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù€ {count} Ù…Ù‡Ø§Ù…").replace("{count}",E(String(a))),o=m("technicianFinancial.stats.paidDesc","{count} Ø¯ÙØ¹Ø§Øª Ù…Ø³Ø¬Ù„Ø©").replace("{count}",E(String(c))),r=m("technicianFinancial.stats.outstandingDesc","Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ {amount}"),d=e.outstanding>0?r.replace("{amount}",C(e.outstanding)):"â€”";R.total&&(R.total.textContent=C(e.total)),R.totalDesc&&(R.totalDesc.textContent=a>0?i:"â€”"),R.paid&&(R.paid.textContent=C(e.paid)),R.paidDesc&&(R.paidDesc.textContent=c>0?o:"â€”"),R.outstanding&&(R.outstanding.textContent=C(e.outstanding)),R.outstandingDesc&&(R.outstandingDesc.textContent=d)}function Mt(t){const{totals:e,breakdown:n,payouts:a}=t;if(fe&&(fe.textContent=C(e.total)),ge&&(ge.textContent=C(e.paid)),ye&&(ye.textContent=C(e.outstanding)),!(!jt||!Pt||!xt)){if(!n.length)jt.innerHTML="",Pt.classList.add("hidden"),xt.classList.remove("hidden");else{xt.classList.add("hidden"),Pt.classList.remove("hidden");const c=n.map(i=>{const o=i.period||"â€”",r=i.outstandingAmount>0?C(i.outstandingAmount):`<span class="text-success">${m("technicianFinancial.list.settled","Ù„Ø§ ÙŠÙˆØ¬Ø¯")}</span>`;return`
        <tr>
          <td>
            <div class="font-semibold text-base-content">${nt(i.label)}</div>
            <div class="text-xs text-base-content/60">${nt(i.reference)}</div>
          </td>
          <td class="whitespace-nowrap">${nt(o)}</td>
          <td>${C(i.dueAmount)}</td>
          <td>${Rn(i.paidStatus)}</td>
          <td>${r}</td>
        </tr>
      `}).join("");jt.innerHTML=c}_n(a)}}function _n(t=[]){if(!Q||!Nt)return;if(!Array.isArray(t)||t.length===0){Q.innerHTML="",Nt.classList.remove("hidden");return}const e=t.map(n=>{const a=C(n.amount||0),c=Ct(n.paidAt||n.createdAt),i=n.note?`<p class="technician-payout-note text-sm text-base-content/70">${nt(n.note)}</p>`:"",o=m("actions.delete","ğŸ—‘ï¸ Ø­Ø°Ù");return`
      <li class="technician-payout-item">
        <div class="technician-payout-item-body">
          <div class="technician-payout-item-head">
            <span class="technician-payout-amount">${a}</span>
            <span class="technician-payout-date">${nt(c)}</span>
          </div>
          ${i}
        </div>
        <button type="button" class="btn btn-outline btn-sm technician-payout-remove" data-payout-remove="${nt(n.id)}" data-i18n data-i18n-key="actions.delete">${o}</button>
      </li>
    `}).join("");Q.innerHTML=e,Nt.classList.add("hidden")}function Le(t){const e=t instanceof Date?t:new Date(t);return Number.isNaN(e.getTime())?"":e.toISOString().slice(0,10)}function Cn(t){if(!t)return new Date;const e=new Date(`${t}T00:00:00`);return Number.isNaN(e.getTime())?new Date:e}function Mn(t){const e=E(String(t??""));if(!e)return"";const c=e.replace(/[Ù¬ØŒ]/g,"").replace(/[Ù«,]/g,".").replace(/[^0-9.]/g,"").split("."),i=c[0]||"",o=c.length>1?c.slice(1).join(""):"",r=i.replace(/^0+(\d)/,"$1"),d=r.length?r:o?"0":"",h=o?o.replace(/\D/g,"").slice(0,2):"";return h?`${d}.${h}`:d}function $n(t){if(t.preventDefault(),!T){j(m("technicianFinancial.payouts.toast.invalidTechnician","âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ­Ø¯ÙŠØ¯ Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù… Ø­Ø§Ù„ÙŠØ§Ù‹."));return}const e=x?.value??"",n=Number.parseFloat(E(String(e)));if(!Number.isFinite(n)||n<=0){j(m("technicianFinancial.payouts.toast.invalidAmount","âš ï¸ Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© ØµØ­ÙŠØ­Ø© Ù„Ù„Ù…Ø¨Ù„Øº.")),x?.focus();return}const a=xn?.value?.trim()||"",c=Cn(tt?.value||null),i=X?.querySelector('button[type="submit"]');i&&(i.disabled=!0),Sn({technicianId:T,amount:Number(n.toFixed(2)),note:a,paidAt:c.toISOString()}).then(o=>{j(m("technicianFinancial.payouts.toast.added","âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯ÙØ¹Ø©.")),X?.reset(),tt&&(tt.value=Le(o?.paidAt||new Date)),N&&ht(N)}).catch(o=>{console.error("âŒ [technician-page] Failed to create technician payout",o);const r=o?.message||m("technicianFinancial.payouts.toast.failed","âš ï¸ ØªØ¹Ø°Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯ÙØ¹Ø©ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");j(r)}).finally(()=>{i&&(i.disabled=!1)})}function qn(t){t&&Un(t)}function Vn(){P&&(P.classList.remove("hidden"),P.classList.add("show"),P.classList.add("modal-open"),document.documentElement.classList.add("modal-open"),document.body.classList.add("overflow-hidden"),tt&&!tt.value&&(tt.value=Le(new Date)))}function Kt(){P&&(P.classList.remove("show"),P.classList.remove("modal-open"),P.classList.add("hidden"),document.documentElement.classList.remove("modal-open"),document.body.classList.remove("overflow-hidden"))}function Un(t){et&&(It=t||null,et.classList.remove("hidden"),et.classList.add("show","modal-open"),document.documentElement.classList.add("modal-open"),document.body.classList.add("overflow-hidden"))}function $t(){et&&(et.classList.remove("show","modal-open"),et.classList.add("hidden"),document.documentElement.classList.remove("modal-open"),document.body.classList.remove("overflow-hidden"),It=null,W&&(W.disabled=!1))}function xe(){return Array.from(document.querySelectorAll("[data-technician-edit]"))}function Hn(t){if(t.preventDefault(),!N)return;try{document.dispatchEvent(new CustomEvent("technician:prefill",{detail:{...N}}))}catch(a){console.error("âš ï¸ [technician-page] Failed to prefill technician edit modal",a)}const e=document.getElementById("editTechnicianModal");if(!e||!window.bootstrap?.Modal)return;window.bootstrap.Modal.getOrCreateInstance(e).show()}function Pe(){xe().forEach(t=>{!t||t.dataset.listenerAttached||(t.addEventListener("click",Hn),t.dataset.listenerAttached="true")})}async function ht(t){if(G={totals:{total:0,paid:0,outstanding:0},metrics:{assignments:0,payoutsCount:0,outstandingAmount:0},breakdown:[],payouts:[]},ve(G),Mt(G),ut(),!T||!t)return;try{await we({suppressError:!0})}catch(l){console.error("âš ï¸ [technician-page] Failed to load reservations for financial summary",l)}const n=Ht(),a=String(T);try{const l=await In(a);Bt=Array.isArray(l)?l:[]}catch(l){console.error("âš ï¸ [technician-page] Failed to load technician payouts from API",l),Bt=[]}const c=n.filter(l=>{if(!l)return!1;const u=String(l.status||"").toLowerCase();return u==="cancelled"||u==="canceled"||u==="Ù…Ù„ØºÙŠ"||u==="Ù…Ù„ØºÙ‰"||u==="Ù…Ù„ØºÙŠØ©"?!1:(Array.isArray(l.technicians)?l.technicians.map(v=>String(v)):[]).includes(a)}),i=Bn(c,a);ut(i);const o=c.map((l,u)=>{const I=Array.isArray(l.techniciansDetails)?l.techniciansDetails.find(S=>{const F=S?.id??S?.technician_id??S?.technicianId??S?.ID;return F!=null&&String(F)===a}):null,v=be(I)||be(t),L=Math.max(1,en(l.start,l.end)),B=Math.max(0,Math.round(v*L)),it=m("technicianFinancial.list.reservationFallback","Ø­Ø¬Ø² Ø±Ù‚Ù… {id}").replace("{id}",E(String(l.reservationId||l.id||"?"))),V=l.title&&l.title.trim().length?l.title.trim():it,s=[];if(l.reservationId||l.id){const S=l.reservationId||l.id;s.push(`#${E(String(S))}`)}if(l.projectId&&s.push(m("technicianFinancial.list.projectReference","Ù…Ø´Ø±ÙˆØ¹ #{id}").replace("{id}",E(String(l.projectId)))),l.status){const S=`reservations.status.${l.status}`;s.push(m(S,l.status))}const f=Ct(l.start),D=Ct(l.end),g=f===D?f:`${f} â€“ ${D}`,y=(()=>{const S=l.start||l.startDatetime||l.createdAt||l.created_at,F=S?new Date(S).getTime():NaN;return Number.isNaN(F)?u:F})();return{label:V,reference:s.join(" â€¢ ")||"â€”",period:g,dueAmount:B,paidAmount:0,outstandingAmount:B,paidStatus:"unpaid",sortKey:y,originalIndex:u}}),r=Bt.map(l=>({...l,amount:Number(l.amount)||0}));let d=r.reduce((l,u)=>l+u.amount,0);const p=[...o].sort((l,u)=>l.sortKey===u.sortKey?l.originalIndex-u.originalIndex:l.sortKey-u.sortKey).map(l=>{const u={...l},I=Number(l.dueAmount)||0,v=Math.min(I,Math.max(0,Number(d.toFixed(2))));v>0&&(d=Number((d-v).toFixed(2))),u.paidAmount=Number(v.toFixed(2));const L=Math.max(0,Number((I-v).toFixed(2)));return u.outstandingAmount=L,L<=.009?(u.paidStatus="paid",u.outstandingAmount=0):v>0?u.paidStatus="partial":u.paidStatus="unpaid",u}).sort((l,u)=>l.originalIndex-u.originalIndex).map(({sortKey:l,originalIndex:u,...I})=>I),A=p.reduce((l,u)=>l+u.dueAmount,0),b=r.reduce((l,u)=>l+(Number(u.amount)||0),0),k=Math.max(0,Number((A-b).toFixed(2))),q={total:Math.max(0,Number(A.toFixed(2))),paid:Math.max(0,Number(b.toFixed(2))),outstanding:k},M={assignments:p.length,payoutsCount:r.length,outstandingAmount:k};G={totals:q,metrics:M,breakdown:p,payouts:r},ve(G),Mt(G)}function K(t,e,n,{hideWhenEmpty:a=!1}={}){if(!t)return;const c=n==null?"":String(n).trim(),i=c.length>0;t.textContent=i?`${e} ${c}`:`${e} â€”`,a?t.classList.toggle("hidden",!i):i||t.classList.remove("hidden")}function De(t){const e=[Tn,kn].filter(Boolean);if(!e.length)return;const n=typeof t=="string"?t.toLowerCase():"";if(!n){e.forEach(r=>{r.className="technician-badge hidden",r.textContent="â€”"});return}const a=n==="busy",c=["technician-badge"];c.push(a?"technician-badge--status-busy":"technician-badge--status-available");const i=a?"technicians.status.busy":"technicians.status.available",o=a?"â›” Ù…Ø´ØºÙˆÙ„":"âœ… Ù…ØªØ§Ø­";if(e.forEach(r=>{r.className=c.join(" "),r.classList.remove("hidden"),r.setAttribute("data-i18n",""),r.setAttribute("data-i18n-key",i),r.textContent=m(i,o)}),Lt)if(a){const r=zn(T),d=r&&String(r).trim().length?r:"";K(Lt,"ğŸ·ï¸",d,{hideWhenEmpty:!0})}else K(Lt,"ğŸ·ï¸","",{hideWhenEmpty:!0})}function zn(t){try{const e=Ht();if(!Array.isArray(e)||e.length===0)return"";const n=t!=null?String(t):null;if(!n)return"";const a=new Date,c=e.find(d=>{if(!d||!d.start&&!d.startDatetime&&!d.start_datetime)return!1;const h=O(d.technicians);if(!Array.isArray(h)||!h.includes(n))return!1;const p=d.start??d.startDatetime??d.start_datetime,A=d.end??d.endDatetime??d.end_datetime;if(!p||!A)return!1;const b=new Date(p),k=new Date(A);return Number.isNaN(b.getTime())||Number.isNaN(k.getTime())?!1:b<=a&&a<k});if(!c)return"";const o=(Array.isArray(c.crewAssignments)&&c.crewAssignments.length?c.crewAssignments:Array.isArray(c.techniciansDetails)?c.techniciansDetails:[]).find(d=>{const h=d?.id??d?.technicianId??d?.technician_id;return h!=null&&String(h)===n});return o&&(o.positionLabel??o.position_name??o.position_label??o.positionKey??o.position)||""}catch{return""}}function Z(t){if(!t){K(oe,"ğŸ˜","â€”"),K(le,"ğŸ¯","",{hideWhenEmpty:!0}),gt&&(gt.textContent="â€”"),dt&&(dt.textContent="â€”"),K(de,"ğŸ¯","",{hideWhenEmpty:!0}),De(null);return}if(K(oe,"ğŸ˜",t.name||"â€”"),K(le,"ğŸ¯",t.role||"",{hideWhenEmpty:!0}),gt&&(gt.textContent=t.name||"â€”"),dt){const e=t.role?t.role:"";if(e)dt.textContent=`ğŸ¯ ${e}`;else{const n=m("technicianDetails.fallback.role","ØºÙŠØ± Ù…Ø­Ø¯Ø¯");dt.textContent=`ğŸ¯ ${n}`}}K(de,"ğŸ¯",t.role||"",{hideWhenEmpty:!0}),De(t.status||t.baseStatus||"available")}function mt(t){xe().forEach(e=>{e.disabled=!!t})}function Dt(t){t&&(Ot=t,_t.forEach(e=>{if(!e)return;const n=e.getAttribute("data-technician-tab")===t;e.classList.toggle("tab-active",n),e.classList.toggle("active",n),e.setAttribute("aria-selected",String(n))}),jn.forEach((e,n)=>{e&&e.classList.toggle("hidden",n!==t)}),t==="projects"&&T&&ke(T),t==="reservations"&&T&&Te(T))}function On(){_t.length&&(_t.forEach(t=>{!t||t.dataset.listenerAttached||(t.addEventListener("click",()=>{const e=t.getAttribute("data-technician-tab");e&&Dt(e)}),t.dataset.listenerAttached="true")}),document.querySelectorAll("[data-technician-tab-trigger]").forEach(t=>{!t||t.dataset.listenerAttached||(t.addEventListener("click",e=>{e.preventDefault();const n=t.getAttribute("data-technician-tab-trigger");n&&Dt(n)}),t.dataset.listenerAttached="true")}),Dt(Ot))}Z(null);mt(!0);On();Pe();yt&&!yt.dataset.listenerAttached&&(yt.addEventListener("click",()=>{Mt(G),Vn()}),yt.dataset.listenerAttached="true");Ln.forEach(t=>{!t||t.dataset.listenerAttached||(t.addEventListener("click",()=>{Kt()}),t.dataset.listenerAttached="true")});X&&!X.dataset.listenerAttached&&(X.addEventListener("submit",$n),X.dataset.listenerAttached="true");Q&&!Q.dataset.listenerAttached&&(Q.addEventListener("click",t=>{const e=t.target.closest("[data-payout-remove]");if(!e)return;const n=e.getAttribute("data-payout-remove");qn(n)}),Q.dataset.listenerAttached="true");if(x&&!x.dataset.normalizerAttached){const t=()=>{const e=Mn(x.value);if(e!==x.value){const n=e.length;x.value=e,x.setSelectionRange&&x.setSelectionRange(n,n)}};x.addEventListener("input",t),x.addEventListener("blur",()=>{if(t(),x.value){const e=Number.parseFloat(x.value);Number.isFinite(e)&&(x.value=e.toFixed(2))}}),x.dataset.normalizerAttached="true"}Pn.forEach(t=>{!t||t.dataset.listenerAttached||(t.addEventListener("click",$t),t.dataset.listenerAttached="true")});W&&!W.dataset.listenerAttached&&(W.addEventListener("click",()=>{if(!It){$t();return}W.disabled=!0,wn(It).then(()=>{j(m("technicianFinancial.payouts.toast.removed","ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¯ÙØ¹Ø©.")),$t(),N&&ht(N)}).catch(t=>{console.error("âŒ [technician-page] Failed to remove technician payout",t);const e=t?.message||m("technicianFinancial.payouts.toast.failed","âš ï¸ ØªØ¹Ø°Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯ÙØ¹Ø©ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");j(e),W.disabled=!1})}),W.dataset.listenerAttached="true");P&&!P.dataset.listenerAttached&&(P.addEventListener("click",t=>{t.target===P&&Kt()}),P.dataset.listenerAttached="true");document.addEventListener("keydown",t=>{t.key==="Escape"&&P&&P.classList.contains("modal-open")&&Kt()});Je({showReservationDetails(t){Ee(()=>import("./reservationsUI.DxorBZGF.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]),import.meta.url).then(e=>{try{e.showReservationDetails?.(t)}catch(n){console.error("âŒ showReservationDetails failed",n)}}).catch(e=>console.error("âŒ Failed to load reservations UI module",e))}});const vt=document.getElementById("logout-btn");vt&&!vt.dataset.listenerAttached&&(vt.addEventListener("click",()=>We()),vt.dataset.listenerAttached="true");function Wn(t){const e=Number(t??0);return Number.isFinite(e)?e.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:2}):"0"}function Kn(t){const e=Number(t??0);if(!Number.isFinite(e)||e<=0)return"";const n=m("technicians.badge.perDay","/Ø§Ù„ÙŠÙˆÙ…");return`${C(e)} ${n}`}function Ae(t){const e=Number(t??0);return!Number.isFinite(e)||e<=0?"":C(e)}function je(t){if(!z)return;if(Z(t),!t){z.innerHTML=`<p class="text-base-content/60" data-i18n data-i18n-key="technicianDetails.errors.notFound">${m("technicianDetails.errors.notFound","âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨.")}</p>`,mt(!0);return}const e=t.phone?E(t.phone):`<span data-i18n data-i18n-key="reservations.details.technicians.phoneUnknown">${m("reservations.details.technicians.phoneUnknown","ØºÙŠØ± Ù…ØªÙˆÙØ±")}</span>`,n=t.email?t.email:`<span data-i18n data-i18n-key="technicianDetails.fallback.email">${m("technicianDetails.fallback.email","â€”")}</span>`,a=t.role?t.role:`<span data-i18n data-i18n-key="technicianDetails.fallback.role">${m("technicianDetails.fallback.role","ØºÙŠØ± Ù…Ø­Ø¯Ø¯")}</span>`,c=t.department?t.department:`<span data-i18n data-i18n-key="technicianDetails.fallback.department">${m("technicianDetails.fallback.department","â€”")}</span>`,i=t.notes?t.notes:`<span data-i18n data-i18n-key="technicianDetails.fallback.notes">${m("technicianDetails.fallback.notes","â€”")}</span>`,r=`<span data-i18n data-i18n-key="reservations.create.summary.currency">${m("reservations.create.summary.currency","SR")}</span>`,d=Kn(t.dailyWage)||`${Wn(t.dailyWage)} ${r}`,h=Ae(t.dailyTotal),p=d,A=h||Ae(t.dailyWage)||d;console.debug("[technician] amounts",{id:t.id,dailyWage:t.dailyWage,dailyTotal:t.dailyTotal,wageValue:p,totalValue:A});const k=[{key:"technicianDetails.fields.role",value:a},{key:"technicianDetails.fields.department",value:c},{key:"technicianDetails.fields.phone",value:e},{key:"technicianDetails.fields.email",value:n},{key:"technicianDetails.fields.notes",value:i}].map(({key:q,value:M})=>`
    <article class="rounded-2xl border border-base-200 bg-base-100/90 p-4 shadow-sm">
      <span class="text-sm font-medium text-base-content/70" data-i18n data-i18n-key="${q}">${m(q)}</span>
      <p class="mt-2 text-lg font-semibold text-base-content">${M}</p>
    </article>
  `).join("");z.innerHTML=k,Pe(),mt(!1),Dt(Ot)}async function Yn(){if(!z)return;if(!T){Z(null),ut(),mt(!0),N=null,z.innerHTML=`<p class="text-danger" data-i18n data-i18n-key="technicianDetails.errors.missingId">${m("technicianDetails.errors.missingId","âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø¹Ø±Ù Ø¹Ø¶Ùˆ Ø·Ø§Ù‚Ù… ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø·.")}</p>`;return}z.innerHTML=`<p class="text-muted" data-i18n data-i18n-key="technicianDetails.status.loading">${m("technicianDetails.status.loading","â³ Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…...")}</p>`,mt(!0),Z(null);let t=null,e=null;try{await Xe(),Ut()}catch(n){e=n,console.error("âŒ [technician-details] Failed to refresh technician from API",n)}if(t=Ie(T),!t){e?z.innerHTML=`<p class="text-danger" data-i18n data-i18n-key="technicianDetails.errors.loadFailed">${m("technicianDetails.errors.loadFailed","âŒ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ø§Ø­Ù‚Ù‹Ø§.")}</p>`:z.innerHTML=`<p class="text-danger" data-i18n data-i18n-key="technicianDetails.errors.notFound">${m("technicianDetails.errors.notFound","âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨.")}</p>`,Z(null),ut(),N=null;return}if(!t){z.innerHTML=`<p class="text-danger" data-i18n data-i18n-key="technicianDetails.errors.notFound">${m("technicianDetails.errors.notFound","âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨.")}</p>`,Z(null),ut(),N=null;return}N=t,await ht(t),je(t),Te(T),ke(T)}Ut();Yn();const Gn=async()=>{if(!T)return;Ut();const t=Ie(T);t&&(N=t,await ht(t),je(t))};window.addEventListener("technicians:updated",Gn);const Qn=()=>{!T||!N||ht(N)};document.addEventListener("reservations:changed",Qn,{passive:!0});
