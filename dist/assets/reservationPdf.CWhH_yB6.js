import{n as T,j as ot,t as r,d as hn,b as za,h as Qa,p as ie,B as Ua,y as yt,C as Xn}from"./auth.7ZMR7M-R.js";import{n as Va,v as Tt,t as Ot,a as Ga,b as bn,d as Jn,H as Zn,g as ea,r as Wa,c as Ya,e as Xa,h as Ja}from"./reservationsService.CyzBzlTC.js";import{s as Za,i as ht,j as Mn,I as ta,O as na}from"./state.BSEdhkjE.js";import{h as eo}from"./view.v-uKlZgJ.js";import{q as to}from"./quotePdf.Cj8ZSM_M.js";import{s as aa,a as oa,e as sa,p as no}from"./canvasColorUtils.CviLtv6S.js";function ra(e){const t=new Date;if(t.setHours(0,0,0,0),e==="today")return{startDate:lt(t),endDate:lt(t)};if(e==="week"){const n=new Date(t),a=n.getDay(),o=a===0?6:a-1;n.setDate(n.getDate()-o);const u=new Date(n);return u.setDate(n.getDate()+6),{startDate:lt(n),endDate:lt(u)}}if(e==="month"){const n=new Date(t.getFullYear(),t.getMonth(),1),a=new Date(t.getFullYear(),t.getMonth()+1,0);return{startDate:lt(n),endDate:lt(a)}}return e==="upcoming"?{startDate:lt(t),endDate:""}:{startDate:"",endDate:""}}function Is(){const e=document.getElementById("search-reservation"),t=document.getElementById("filter-start-date"),n=document.getElementById("filter-end-date"),a=document.getElementById("reservation-date-range"),o=document.getElementById("reservation-status-filter");let u=T(t?.value||"").trim(),s=T(n?.value||"").trim(),c=a?.value||"";if(new Set(["","today","week","month"]).has(c)||(c="",a&&(a.value=""),Rt(t),Rt(n),u="",s=""),!u&&!s&&c){const b=ra(c);u=b.startDate,s=b.endDate}return{searchTerm:Va(e?.value||""),startDate:u,endDate:s,status:o?.value||"",quickRange:c}}function Ds(e){const t=()=>{typeof e=="function"&&e()},n=document.getElementById("search-reservation");n&&!n.dataset.listenerAttached&&(n.addEventListener("input",()=>{n.value=T(n.value),t()}),n.dataset.listenerAttached="true");const a=document.getElementById("filter-start-date");a&&!a.dataset.listenerAttached&&(a.addEventListener("change",()=>{const p=document.getElementById("reservation-date-range");p&&(p.value=""),t()}),a.dataset.listenerAttached="true");const o=document.getElementById("filter-end-date");o&&!o.dataset.listenerAttached&&(o.addEventListener("change",()=>{const p=document.getElementById("reservation-date-range");p&&(p.value=""),t()}),o.dataset.listenerAttached="true");const u=document.getElementById("reservation-date-range");u&&!u.dataset.listenerAttached&&(u.addEventListener("change",()=>{ao(u.value),t()}),u.dataset.listenerAttached="true");const s=document.getElementById("reservation-status-filter");s&&!s.dataset.listenerAttached&&(s.addEventListener("change",t),s.dataset.listenerAttached="true");const c=document.getElementById("clear-filters");c&&!c.dataset.listenerAttached&&(c.addEventListener("click",()=>{n&&(n.value=""),Rt(a),Rt(o),u&&(u.value=""),s&&(s.value=""),t()}),c.dataset.listenerAttached="true")}function ao(e){const t=document.getElementById("filter-start-date"),n=document.getElementById("filter-end-date");if(!t||!n)return;const{startDate:a,endDate:o}=ra(e);t._flatpickr?a?t._flatpickr.setDate(a,!1,"Y-m-d"):t._flatpickr.clear():t.value=a,n._flatpickr?o?n._flatpickr.setDate(o,!1,"Y-m-d"):n._flatpickr.clear():n.value=o}function lt(e){if(!e)return"";const t=e.getTimezoneOffset()*6e4;return new Date(e.getTime()-t).toISOString().split("T")[0]}function Rt(e){e&&(e._flatpickr&&e._flatpickr.clear(),e.value="")}const oo=""+new URL("Tajawal-400.ttf",import.meta.url).href,so=""+new URL("Tajawal-500.ttf",import.meta.url).href,On=""+new URL("Tajawal-700.ttf",import.meta.url).href,ro="reservations.quote.sequence",Rn={reservation:"reservations.quote.togglePrefs.v1",project:"projects.quote.togglePrefs.v1",reservationChecklist:"reservations.checklist.togglePrefs.v1"},ia="https://help.artratio.sa/guide/quote-preview",ve={logoUrl:"https://art-ratio.sirv.com/AR-Logo-v3.5-curved.png",companyName:"Ø´Ø±ÙƒØ© ÙÙˆØ¯ Ø¢Ø±Øª Ù„Ù„Ø¯Ø¹Ø§ÙŠØ© ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù† (Ø´Ø±ÙƒØ© Ø´Ø®Øµ ÙˆØ§Ø­Ø¯)",commercialRegistry:"4030485240",beneficiaryName:"Ø´Ø±ÙƒØ© ÙÙˆØ¯ Ø¢Ø±Øª Ù„Ù„Ø¯Ø¹Ø§ÙŠØ© ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù† (Ø´Ø±ÙƒØ© Ø´Ø®Øµ ÙˆØ§Ø­Ø¯)",bankName:"Ù…ØµØ±Ù Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠ",accountNumber:"Ù£Ù¥Ù¨Ù Ù Ù Ù Ù¡Ù Ù Ù Ù¦Ù Ù¨Ù¦Ù Ù¦Ù¥Ù§Ù Ù¦",iban:"SA1680000358608016065706",approvalNote:"Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø±Ø¶ ØªØ¹ØªØ¨Ø± Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…."},io=["ÙŠÙˆÙ… Ø§Ù„Ø¹Ù…Ù„ Ù‡Ùˆ 12 Ø³Ø§Ø¹Ø©ØŒ ÙˆÙŠØªÙ… Ø§Ø­ØªØ³Ø§Ø¨ Ù†ØµÙ ÙŠÙˆÙ… Ø¥Ø¶Ø§ÙÙŠ Ø¨Ø¹Ø¯ 20 Ø³Ø§Ø¹Ø©ØŒ Ø«Ù… ÙŠÙˆÙ… ÙƒØ§Ù…Ù„ Ø¨Ø¹Ø¯ Ø°Ù„Ùƒ.","ÙŠÙ…Ù†Ø¹ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙÙŠ Ø£Ù†Ø´Ø·Ø© ØºÙŠØ± Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©.","ÙŠØªØ­Ù…Ù„ Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø± Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© Ø£ÙŠ ØªÙ„Ù Ø£Ùˆ ÙÙ‚Ø¯Ø§Ù†.","ÙŠØ¬Ø¨ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙÙŠ Ø­Ø§Ù„ØªÙ‡Ø§ Ø§Ù„Ø£ØµÙ„ÙŠØ©.","ÙŠØªÙ… ÙØ±Ø¶ Ø±Ø³ÙˆÙ… Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ù„ØºØ§Ø¡ Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ù‚Ø¨Ù„ 24 Ø³Ø§Ø¹Ø©."],je=[...io],lo=["ÙŠØªÙ… Ø¯ÙØ¹ 50% Ù…Ù† Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø±ØŒ ÙˆÙŠØªÙ… Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø§Ù„Ù€ 50% Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ.","ÙŠØ­ØµÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¹Ù„Ù‰ Ø­Ù‚ÙˆÙ‚ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© ÙÙŠ Ø£ÙŠ Ù…ÙƒØ§Ù† ÙŠØ±Ø§Ù‡ Ù…Ù†Ø§Ø³Ø¨Ø§Ù‹ØŒ Ø¨ÙŠÙ†Ù…Ø§ ØªØ­ØªÙØ¸ Ø§Ù„Ø´Ø±ÙƒØ© Ø¨Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø®Ø§Ù… ÙˆÙ„Ø§ ØªØ³ØªØ®Ø¯Ù…Ù‡Ø§ Ø¥Ù„Ø§ Ø¨Ø¹Ø¯ Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ø§ Ù„Ù… ÙŠÙØªÙÙ‚ Ø¹Ù„Ù‰ ØºÙŠØ± Ø°Ù„Ùƒ.","ÙŠØªÙ… Ø§Ù„Ø§ØªÙØ§Ù‚ Ø¹Ù„Ù‰ Ø¬Ø¯ÙˆÙ„ Ø²Ù…Ù†ÙŠ Ù„Ù„ØªÙ†ÙÙŠØ°ØŒ ÙˆØ£ÙŠ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ø®Ø§Ø±Ø¬ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ù…ØªÙÙ‚ Ø¹Ù„ÙŠÙ‡ ØªØ®Ø¶Ø¹ Ù„Ø±Ø³ÙˆÙ… Ø¥Ø¶Ø§ÙÙŠØ©.","Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù† ØªÙˆÙÙŠØ± Ø§Ù„ØªØµØ§Ø±ÙŠØ­ Ø§Ù„Ù„Ø§Ø²Ù…Ø© Ù„Ù„ØªØµÙˆÙŠØ± ÙÙŠ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©ØŒ ÙˆØ£ÙŠ ØªØ£Ø®ÙŠØ± Ù†Ø§ØªØ¬ Ø¹Ù† Ø°Ù„Ùƒ Ù‚Ø¯ ÙŠØ¤Ø«Ø± Ø¹Ù„Ù‰ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„ØªØ³Ù„ÙŠÙ….","ØªÙØ­ÙÙŽØ¸ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ù„Ù„Ù…Ø´Ø±ÙˆØ¹ Ù„Ù…Ø¯Ø© 12 Ø´Ù‡Ø±Ø§Ù‹ ÙÙŠ Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ø´Ø±ÙƒØ©ØŒ ÙˆÙŠÙ…ÙƒÙ† Ù„Ù„Ø¹Ù…ÙŠÙ„ Ø·Ù„Ø¨ Ù†Ø³Ø® Ø¥Ø¶Ø§ÙÙŠØ© Ø®Ù„Ø§Ù„ ØªÙ„Ùƒ Ø§Ù„ÙØªØ±Ø©.","ÙŠØªØ­Ù…Ù‘Ù„ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© ØªÙˆÙÙŠØ± Ø¨ÙŠØ¦Ø© Ø¹Ù…Ù„ Ø¢Ù…Ù†Ø© Ù„Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ ÙˆØ§Ù„Ù…Ø¹Ø¯Ø§Øª ÙÙŠ Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªØµÙˆÙŠØ±ØŒ ÙˆÙŠØ¶Ù…Ù† Ø§ØªØ®Ø§Ø° ÙƒØ§ÙØ© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·Ø§Øª Ø§Ù„Ù„Ø§Ø²Ù…Ø© Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø³Ù„Ø§Ù…ØªÙ‡Ù…."];function ln(e){return e?e.split(/\r?\n/).map(t=>t.trim()).filter(t=>t.length>0):[...je]}function co(){const e=document.getElementById("reservation-terms");if(e&&e.value.trim().length>0){const a=ln(e.value);if(a.length)return a}const t=document.getElementById("edit-res-terms");if(t&&t.value.trim().length>0){const a=ln(t.value);if(a.length)return a}const n=je.join(`
`);return e&&e.value.trim().length===0&&(e.value=n),t&&t.value.trim().length===0&&(t.value=n),[...je]}const uo=[{id:"customerInfo",labelKey:"reservations.quote.sections.customer",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„",defaultSelected:!0},{id:"reservationInfo",labelKey:"reservations.quote.sections.reservation",fallback:"ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²",defaultSelected:!0},{id:"projectInfo",labelKey:"reservations.quote.sections.project",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",defaultSelected:!0},{id:"financialSummary",labelKey:"reservations.quote.sections.financial",fallback:"Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ",defaultSelected:!0},{id:"items",labelKey:"reservations.quote.sections.items",fallback:"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",defaultSelected:!0},{id:"crew",labelKey:"reservations.quote.sections.crew",fallback:"Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„",defaultSelected:!0},{id:"notes",labelKey:"reservations.quote.sections.notes",fallback:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø­Ø¬Ø²",defaultSelected:!0},{id:"payment",labelKey:"reservations.quote.sections.payment",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹",defaultSelected:!1}],Wt=[{id:"rowNumber",labelKey:null,fallback:"#",render:(e,t)=>l(T(String(t+1)))},{id:"code",labelKey:"reservations.details.table.headers.code",fallback:"Ø§Ù„ÙƒÙˆØ¯",render:e=>{if(e?.isPackage){const t=e?.packageCodeResolved||e?.barcode||"";return l(t||"-")}return l(e?.barcode||"-")}},{id:"description",labelKey:"reservations.details.table.headers.description",fallback:"Ø§Ù„ÙˆØµÙ",render:e=>{const t=String(e?.desc||e?.description||"-");return`<div class="quote-cell quote-cell--desc">${l(t)}</div>`}},{id:"quantity",labelKey:"reservations.details.table.headers.quantity",fallback:"Ø§Ù„ÙƒÙ…ÙŠØ©",render:e=>l(T(String(e?.qty||1)))},{id:"unitPrice",labelKey:"reservations.quote.columns.unitPrice",fallback:"Ù„ÙƒÙ„ ÙŠÙˆÙ…",render:e=>l(T(Number(e?.unitPriceValue||0).toFixed(2)))},{id:"price",labelKey:"reservations.quote.columns.total",fallback:"Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹",render:e=>l(T(Number(e?.price||0).toFixed(2)))}],Yt=[{id:"rowNumber",labelKey:null,fallback:"#",render:(e,t)=>l(T(String(t+1)))},{id:"position",labelKey:"reservations.details.crew.position",fallback:"Ø§Ù„Ù…Ù†ØµØ¨",render:e=>{const t=typeof ie=="function"?ie():"ar",n=e?.positionLabelEn??e?.position_label_en??e?.position_name_en??e?.positionLabelAlt??e?.position_label_alt??e?.role,a=e?.positionLabel??e?.position_name??e?.role??r("reservations.crew.positionFallback","Ù…Ù†ØµØ¨ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…");return l(T(String(t==="en"&&n?n:a)))}},{id:"unitPrice",labelKey:"reservations.quote.columns.unitPrice",fallback:"Ù„ÙƒÙ„ ÙŠÙˆÙ…",render:e=>{const t=Number.isFinite(Number(e?.positionClientPrice))?Number(e.positionClientPrice):0;return l(`${T(t.toFixed(2))} ${r("reservations.create.summary.currency","SR")}`)}},{id:"price",labelKey:"reservations.quote.columns.total",fallback:"Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹",render:e=>{const t=Number.isFinite(Number(e?.positionClientPrice))?Number(e.positionClientPrice):0;return l(`${T(t.toFixed(2))} ${r("reservations.create.summary.currency","SR")}`)}}],nt={customerInfo:[{id:"customerName",labelKey:"reservations.details.labels.customer",fallback:"Ø§Ù„Ø¹Ù…ÙŠÙ„"},{id:"customerCompany",labelKey:"reservations.details.labels.company",fallback:"Ø§Ù„Ø´Ø±ÙƒØ©"},{id:"customerPhone",labelKey:"reservations.details.labels.phone",fallback:"Ø§Ù„Ù‡Ø§ØªÙ"},{id:"customerEmail",labelKey:"reservations.details.labels.email",fallback:"Ø§Ù„Ø¨Ø±ÙŠØ¯"}],reservationInfo:[{id:"reservationId",labelKey:"reservations.details.labels.reservationId",fallback:"Ø±Ù‚Ù… Ø§Ù„Ø­Ø¬Ø²"},{id:"reservationStart",labelKey:"reservations.details.labels.start",fallback:"Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø­Ø¬Ø²"},{id:"reservationEnd",labelKey:"reservations.details.labels.end",fallback:"Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø­Ø¬Ø²"},{id:"reservationDuration",labelKey:"reservations.details.labels.duration",fallback:"Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…"}],projectInfo:[{id:"projectTitle",labelKey:"reservations.details.labels.project",fallback:"Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectCode",labelKey:"reservations.details.labels.code",fallback:"Ø§Ù„Ø±Ù…Ø²"}],financialSummary:[{id:"discountAmount",labelKey:"reservations.details.labels.discount",fallback:"Ø§Ù„Ø®ØµÙ…"},{id:"subtotalBeforeTax",labelKey:"reservations.details.labels.subtotalBeforeTax",fallback:"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"},{id:"taxAmount",labelKey:"reservations.details.labels.tax",fallback:"Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"},{id:"finalTotal",labelKey:"reservations.details.labels.total",fallback:"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ"}],payment:[{id:"beneficiary",labelKey:"reservations.quote.labels.beneficiary",fallback:"Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙÙŠØ¯"},{id:"bank",labelKey:"reservations.quote.labels.bank",fallback:"Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ"},{id:"account",labelKey:"reservations.quote.labels.account",fallback:"Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨"},{id:"iban",labelKey:"reservations.quote.labels.iban",fallback:"Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ¨Ø§Ù†"}],items:[...Wt.map(({id:e,labelKey:t,fallback:n})=>({id:e,labelKey:t,fallback:n})),{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…"},{id:"equipmentSubtotal",labelKey:"reservations.details.labels.equipmentTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"}],crew:[...Yt.map(({id:e,labelKey:t,fallback:n})=>({id:e,labelKey:t,fallback:n})),{id:"quantity",labelKey:"reservations.details.table.headers.quantity",fallback:"Ø§Ù„ÙƒÙ…ÙŠØ©"},{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…"},{id:"crewSubtotal",labelKey:"reservations.details.labels.crewTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±ÙŠÙ‚"}]},la=[{id:"rowNumber",labelKey:null,fallback:"#",render:(e,t)=>l(T(String(t+1)))},{id:"label",labelKey:null,fallback:"Ø§Ù„Ø¨Ù†Ø¯",render:e=>l(e?.label||"-")},{id:"amount",labelKey:null,fallback:"Ø§Ù„Ø³Ø¹Ø±",render:e=>{const t=Number.isFinite(Number(e?.salePrice??e?.sale_price))?Number(e?.salePrice??e?.sale_price):Number(e?.amount??0)||0;return l(ne(t,r("reservations.create.summary.currency","SR")))}},{id:"note",labelKey:null,fallback:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª",render:e=>l(e?.note||"-")}],po=[{id:"customerInfo",labelKey:"projects.quote.sections.customer",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„",defaultSelected:!0},{id:"projectInfo",labelKey:"projects.quote.sections.project",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",defaultSelected:!0},{id:"projectExpenses",labelKey:"projects.quote.sections.expenses",fallback:"Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©",defaultSelected:!0},{id:"projectCrew",labelKey:"projects.quote.sections.crew",fallback:"Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„",defaultSelected:!0},{id:"financialSummary",labelKey:"projects.quote.sections.financial",fallback:"Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ",defaultSelected:!0},{id:"projectEquipment",labelKey:"projects.quote.sections.equipment",fallback:"Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",defaultSelected:!0},{id:"projectNotes",labelKey:"projects.quote.sections.notes",fallback:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",defaultSelected:!0},{id:"payment",labelKey:"reservations.quote.sections.payment",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹",defaultSelected:!1}],mo={customerInfo:nt.customerInfo,projectInfo:[{id:"projectTitle",labelKey:"projects.details.overview.heading",fallback:"Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectCode",labelKey:"projects.details.labels.code",fallback:"Ø±Ù‚Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectType",labelKey:"projects.details.type",fallback:"Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectStart",labelKey:"projects.details.start",fallback:"Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectEnd",labelKey:"projects.details.end",fallback:"Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectDuration",labelKey:"projects.details.duration",fallback:"Ù…Ø¯Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectStatus",labelKey:"projects.details.status",fallback:"Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"}],financialSummary:[{id:"reservationsTotal",labelKey:"projects.details.reservationsTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª"},{id:"discountAmount",labelKey:"projects.details.summary.discount",fallback:"Ø§Ù„Ø®ØµÙ…"},{id:"taxAmount",labelKey:"projects.details.summary.combinedTax",fallback:"Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"},{id:"overallTotal",labelKey:"projects.details.summary.overallTotal",fallback:"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ"}],payment:nt.payment,projectExpenses:[...la.map(({id:e,labelKey:t,fallback:n})=>({id:e,labelKey:t,fallback:n})),{id:"expensesSubtotal",labelKey:"projects.details.expensesTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©"}],projectCrew:[...Yt.map(({id:e,labelKey:t,fallback:n})=>({id:e,labelKey:t,fallback:n})),{id:"quantity",labelKey:"reservations.details.table.headers.quantity",fallback:"Ø§Ù„ÙƒÙ…ÙŠØ©"},{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…"},{id:"crewSubtotal",labelKey:"reservations.details.labels.crewTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±ÙŠÙ‚"}],projectEquipment:[...Wt.map(({id:e,labelKey:t,fallback:n})=>({id:e,labelKey:t,fallback:n})),{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…"},{id:"equipmentSubtotal",labelKey:"reservations.details.labels.equipmentTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"}],projectNotes:[]},sn=new Map;function Xt(e="reservation"){if(sn.has(e))return sn.get(e);const t=e==="project"?po:e==="reservationChecklist"?[{id:"customerInfo",labelKey:"reservations.quote.sections.customer",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„",defaultSelected:!0},{id:"reservationInfo",labelKey:"reservations.quote.sections.reservation",fallback:"ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²",defaultSelected:!0},{id:"projectInfo",labelKey:"reservations.quote.sections.project",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",defaultSelected:!0},{id:"notes",labelKey:"reservations.quote.sections.notes",fallback:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø­Ø¬Ø²",defaultSelected:!0},{id:"items",labelKey:"reservations.quote.sections.items",fallback:"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",defaultSelected:!0},{id:"crew",labelKey:"reservations.quote.sections.crew",fallback:"Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„",defaultSelected:!0}]:uo,n=e==="project"?mo:e==="reservationChecklist"?{customerInfo:nt.customerInfo,reservationInfo:nt.reservationInfo,projectInfo:nt.projectInfo,notes:[],items:nt.items,crew:nt.crew}:nt,a=new Set(t.map(({id:s})=>s)),o=Object.fromEntries(Object.entries(n).map(([s,c=[]])=>[s,new Set(c.map(p=>p.id))])),u={sectionDefs:t,fieldDefs:n,sectionIdSet:a,fieldIdMap:o};return sn.set(e,u),u}function Jt(e="reservation"){return Xt(e).sectionDefs}function ca(e="reservation"){return Xt(e).fieldDefs}function ua(e="reservation"){return Xt(e).sectionIdSet}function da(e="reservation"){return Xt(e).fieldIdMap}function pa(e){switch(e){case"export":return r("reservations.quote.status.exporting","Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ù…Ù„Ù PDF...");case"render":default:return r("reservations.quote.status.rendering","Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©...")}}const fo="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js",yo="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js",ho="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js",ma=to.trim(),fa=`
@font-face { font-family: 'Tajawal'; font-style: normal; font-weight: 400; font-display: swap; src: url(${JSON.stringify(oo)}) format('truetype'); }
@font-face { font-family: 'Tajawal'; font-style: normal; font-weight: 500; font-display: swap; src: url(${JSON.stringify(so)}) format('truetype'); }
@font-face { font-family: 'Tajawal'; font-style: normal; font-weight: 600; font-display: swap; src: url(${JSON.stringify(On)}) format('truetype'); }
@font-face { font-family: 'Tajawal'; font-style: normal; font-weight: 700; font-display: swap; src: url(${JSON.stringify(On)}) format('truetype'); }
`,ya=/^data:image\/svg\+xml/i,bo=/\.svg($|[?#])/i,St=512,cn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/B8AAusB9YwpClgAAAAASUVORK5CYII=",ha=96,ba=25.4,un=210,Dt=297,Pt=Math.round(un/ba*ha),Lt=Math.round(Dt/ba*ha);function he(e){const t=Number(e),n=Number.isFinite(t)?t:0;try{const a=Math.abs(n%1)>1e-9;return T(n.toLocaleString("en-US",{minimumFractionDigits:a?2:0,maximumFractionDigits:2}))}catch{return Number.isInteger(n)?T(String(n)):T(n.toFixed(2))}}let Bt=!1,Kt=null;function gn(){Bt||(Kt=async function(){try{if(!i||!w?.modal?.classList.contains("show")||(i.context||"reservation")!=="reservation")return;const n=i.reservation;if(!n)return;const a=[n.id,n.reservationId,n.reservation_id,n.reservationCode,n.reservation_code].map(f=>f==null?"":String(f)).filter(f=>f.length>0);if(!a.length)return;const o=ea(),u=(Array.isArray(o)?o:[]).find(f=>[f?.id,f?.reservationId,f?.reservation_id,f?.reservationCode,f?.reservation_code].map(k=>k==null?"":String(k)).filter(k=>k.length>0).some(k=>a.includes(k)));if(!u)return;const s=an(u),{totalsDisplay:c,totals:p,rentalDays:b}=In(u,s,i.project);i.reservation=u,i.crewAssignments=s,i.totals=p,i.totalsDisplay=c,i.rentalDays=b,Mt(),Se()}catch(t){console.warn("[reservationPdf] live update failed",t)}},document.addEventListener("reservations:changed",Kt),Bt=!0)}function ga(){if(Bt){try{document.removeEventListener("reservations:changed",Kt)}catch{}Kt=null,Bt=!1}}const va=2,wa=/safari/i,go=/(iphone|ipad|ipod)/i,Bn=/(iphone|ipad|ipod)/i,vo=/(crios|fxios|edgios|opios)/i,Ht="[reservations/pdf]";let w=null,i=null,Ke=1,wt=null,qt=null,at=null,mt=null,At=!1;const zt="quoteBlockOffsets",Kn=1800,Qt="quoteInfoAlignments",wo=["customer","reservation","project","projectCustomer","projectDetails"],vn={customer:"left",reservation:"left",project:"left",projectCustomer:"right",projectDetails:"right"},dn={project:{customer:"right",reservation:"left",project:"left",projectCustomer:"left",projectDetails:"left"},reservationChecklist:{customer:"left",reservation:"left",project:"left",projectCustomer:"right",projectDetails:"right"}};let bt=!1,wn=!1,jt=!1;const qn={project:{"project-title":{x:-182.78680419921875,y:-5.0181427001953125},"project-content":{x:-140.1977996826172,y:-4.7384796142578125}}},kt={blockOffsets:"data-block-offsets",infoAlignments:"data-info-alignments",context:"data-quote-source-context"};function Hn(e){try{return encodeURIComponent(JSON.stringify(e))}catch{return""}}function qo(e,t){if(!e)return null;const n=e.getAttribute(t);if(!n)return null;try{return JSON.parse(decodeURIComponent(n))}catch{return null}}function So(e={}){const t=[],n=e.context||He(e);if(t.push(`${kt.context}="${l(String(n))}"`),e.blockOffsets&&Object.keys(e.blockOffsets).length){const a=Hn(e.blockOffsets);a&&t.push(`${kt.blockOffsets}="${a}"`)}if(e.infoAlignments&&Object.keys(e.infoAlignments).length){const a=Hn(e.infoAlignments);a&&t.push(`${kt.infoAlignments}="${a}"`)}return t.length?` ${t.join(" ")}`:""}let _t=null;function qa(e){return e&&typeof e=="object"?e:_t||i||null}function He(e=null){return qa(e)?.context||"reservation"}function Ao(e="reservation"){try{const n=JSON.parse(localStorage.getItem(zt)||"{}")?.[e];if(n&&typeof n=="object")return JSON.parse(JSON.stringify(n))}catch{}return{}}function Sa(e,t={}){try{const n=JSON.parse(localStorage.getItem(zt)||"{}");t&&Object.keys(t).length>0?n[e]=t:delete n[e],localStorage.setItem(zt,JSON.stringify(n))}catch{}}function Sn(e){if(!e)return;const t=He(e),n=Ao(t);e.blockOffsets={...qn[t]||{},...n},wn=!1,bt=!1,Zt()}function ko(e,t={}){if(!e)return;e.querySelectorAll("[data-drag-key]").forEach(a=>{const o=a.dataset.dragKey,u=t?.[o],s=Number(u?.x)||0,c=Number(u?.y)||0;s||c?a.style.transform=`translate(${s}px, ${c}px)`:a.style.transform="",a.dataset.dragX=String(s),a.dataset.dragY=String(c)})}function An(e){try{const t=e?.getElementById("quotation-pdf-root");if(!t)return;t.dataset.blockDragMode=bt?"on":"off"}catch{}}function Zt(){const e=w?.blockDragToggle;if(e){const n=bt?r("reservations.quote.drag.disable","ðŸ”’ Ø¥Ù†Ù‡Ø§Ø¡ ÙˆØ¶Ø¹ Ø§Ù„ØªØ­Ø±ÙŠÙƒ"):r("reservations.quote.drag.enable","ðŸŽ¯ ÙˆØ¶Ø¹ ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø¨Ù„ÙˆÙƒØ§Øª");e.setAttribute("aria-label",n),e.setAttribute("title",n),e.classList.toggle("is-active",bt)}const t=w?.blockDragSave;t&&(t.disabled=!wn)}function _o(e){bt=!!e,Zt();try{An(w?.previewFrame?.contentDocument)}catch{}}function kn(e=!0){wn=!!e,Zt()}function xo(){if(!i)return;const e=He(i),t=i.blockOffsets||{};Sa(e,t),kn(!1),ot(r("reservations.quote.drag.saved","âœ… ØªÙ… Ø­ÙØ¸ Ù…ÙˆØ§Ø¶Ø¹ Ø§Ù„Ø¨Ù„ÙˆÙƒØ§Øª."))}function $o(){if(!i)return;const e=He(i);i.blockOffsets={...qn[e]||{}},Sa(e,i.blockOffsets),kn(!1),Se(),ot(r("reservations.quote.drag.reset","â†º ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© Ù…ÙˆØ§Ø¶Ø¹ Ø§Ù„Ø¨Ù„ÙˆÙƒØ§Øª Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ."))}function zn(e){return Math.min(Math.max(e,-Kn),Kn)}function To(e="reservation"){try{const n=JSON.parse(localStorage.getItem(Qt)||"{}")?.[e];if(n&&typeof n=="object")return{...n}}catch{}return null}function jo(e,t={}){try{const n=JSON.parse(localStorage.getItem(Qt)||"{}");n[e]=t,localStorage.setItem(Qt,JSON.stringify(n))}catch{}}function _n(e){if(!e||jt)return;const t=He(e),n=To(t);e.infoAlignments={...vn,...dn[t]||{},...n||{}},jt=!0}function Aa(e,t){const n=qa(e),a=n?.infoAlignments;if(a&&Object.prototype.hasOwnProperty.call(a,t))return a[t];const o=He(n);return dn[o]?.[t]?dn[o][t]:vn[t]||"right"}function xt(e,t){return`info-plain info-plain--align-${Aa(e,t)}`}function Co(e,t){if(!i)return;const n=wo.includes(e)?e:"customer",a=["left","center","right"].includes(t)?t:"right";i.infoAlignments||(i.infoAlignments={...vn}),i.infoAlignments[n]=a;const o=He(i);jo(o,i.infoAlignments),Se(),en()}function en(){if(!w?.alignTarget)return;const e=w.alignTarget.value||"customer",t=Aa(i,e);(w.alignButtons||[]).forEach(n=>{const a=n.dataset.alignValue;a&&n.classList.toggle("is-active",a===t)})}async function Eo(){try{if(!i)return;const e=He(i),t=JSON.parse(localStorage.getItem(zt)||"{}"),n=JSON.parse(localStorage.getItem(Qt)||"{}"),a={context:e,blockOffsets:i.blockOffsets||t[e]||{},infoAlignments:i.infoAlignments||n[e]||{}},o=JSON.stringify(a,null,2);let u=!1;if(navigator?.clipboard?.writeText)try{await navigator.clipboard.writeText(o),u=!0}catch{u=!1}u?ot(r("reservations.quote.align.copied","âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©")):window.prompt(r("reservations.quote.align.copyPrompt","Ø§Ù†Ø³Ø® Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©"),o)}catch(e){console.error("[quote align export] failed",e),ot(r("reservations.quote.align.copyFailed","âš ï¸ ØªØ¹Ø°Ø± Ù†Ø³Ø® Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªØŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹"),"error")}}function No(e){try{const t=e?.getElementById("quotation-pdf-root");if(!t)return;Array.from(t.querySelectorAll("[data-drag-key]")).forEach(a=>{if(a.dataset.blockDragHandleAttached==="true")return;a.style.position=a.style.position||"relative",a.style.touchAction="none";const o=e.createElement("button");o.type="button",o.className="quote-block-drag-handle",o.setAttribute("data-block-handle",a.dataset.dragKey||""),o.setAttribute("aria-label",r("reservations.quote.drag.handle","Ø§Ø³Ø­Ø¨ Ù„ØªØ­Ø±ÙŠÙƒ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…")),o.innerHTML='<span aria-hidden="true">â ¿</span>';const u=s=>{t.dataset.blockDragMode==="on"&&Io(s,a)};o.addEventListener("pointerdown",u),a.prepend(o),a.dataset.blockDragHandleAttached="true"}),An(e)}catch{}}function Io(e,t){if(!t||!i)return;e.preventDefault(),e.stopPropagation();const n=t.ownerDocument||document,a=e.pointerId;t.setPointerCapture?.(a);const o=e.clientX,u=e.clientY,s=Number(t.dataset.dragX||0),c=Number(t.dataset.dragY||0);let p=s,b=c;const f=t.dataset.dragKey,q=g=>{g.preventDefault();const h=g.clientX-o,P=g.clientY-u;p=zn(s+h),b=zn(c+P),t.style.transform=`translate(${p}px, ${b}px)`,t.dataset.dragTempX=String(p),t.dataset.dragTempY=String(b)},k=()=>{n.removeEventListener("pointermove",q),n.removeEventListener("pointerup",k),t.releasePointerCapture?.(a);const g=Number(t.dataset.dragTempX??s),h=Number(t.dataset.dragTempY??c);t.dataset.dragX=String(g),t.dataset.dragY=String(h),t.dataset.dragTempX="",t.dataset.dragTempY="",i.blockOffsets||(i.blockOffsets={}),Math.abs(g)<=.5&&Math.abs(h)<=.5?delete i.blockOffsets[f]:i.blockOffsets[f]={x:g,y:h},kn(!0)};n.addEventListener("pointermove",q),n.addEventListener("pointerup",k)}function ct(e="render",{message:t,actionLabel:n,onAction:a,showSpinner:o=e!=="error"}={}){if(!w?.statusIndicator||!w?.statusText)return;w.statusKind=e;const u=t||pa(e);w.statusText.textContent=u,w.statusSpinner&&(w.statusSpinner.hidden=!o),w.statusAction&&(w.statusAction.hidden=!0,w.statusAction.onclick=null,n&&typeof a=="function"&&(w.statusAction.textContent=n,w.statusAction.hidden=!1,w.statusAction.onclick=s=>{s.preventDefault(),a()})),w.statusIndicator.hidden=!1,requestAnimationFrame(()=>{w.statusIndicator.classList.add("is-visible")})}function ft(e){try{return String(e||"").toLowerCase().normalize("NFKD").replace(/[\u064B-\u065F\u0670\u06D6-\u06ED]/g,"").replace(/\s+/g," ").trim()}catch{return String(e||"").trim().toLowerCase()}}function $t(e){!w?.statusIndicator||!w?.statusText||(w.statusKind=null,w.statusIndicator.classList.remove("is-visible"),setTimeout(()=>{w?.statusIndicator&&(w.statusIndicator.hidden=!0,w.statusAction&&(w.statusAction.hidden=!0,w.statusAction.onclick=null),w.statusSpinner&&(w.statusSpinner.hidden=!1))},220))}function pn(){return!!window?.bootstrap?.Modal}function Do(e){if(e&&!e.classList.contains("show")){e.classList.add("show"),e.style.display="block",e.removeAttribute("aria-hidden"),e.setAttribute("aria-modal","true"),e.getAttribute("role")||e.setAttribute("role","dialog"),document.body.classList.add("modal-open"),at||(at=document.createElement("div"),at.className="modal-backdrop fade show",at.dataset.quotePdfFallbackBackdrop="true",document.body.appendChild(at)),mt||(mt=t=>{t.key==="Escape"&&mn(e)},document.addEventListener("keydown",mt));try{e.focus({preventScroll:!0})}catch{}}}function mn(e){if(!(!e||!e.classList.contains("show"))){try{const t=e.ownerDocument?.activeElement;if(t&&e.contains(t)){try{t.blur()}catch{}try{e.ownerDocument?.body?.focus({preventScroll:!0})}catch{}}}catch{}e.classList.remove("show"),e.style.display="none",e.setAttribute("aria-hidden","true"),e.removeAttribute("aria-modal"),document.body.classList.remove("modal-open"),at&&(at.remove(),at=null),mt&&(document.removeEventListener("keydown",mt),mt=null);try{ga()}catch{}}}function Po(e){if(e){if(pn()){const t=window.bootstrap.Modal.getOrCreateInstance(e);try{const n=()=>{try{const a=document.activeElement;if(a&&e.contains(a)){try{a.blur()}catch{}try{document.body?.focus({preventScroll:!0})}catch{}}}catch{}try{ga()}catch{}try{e.removeEventListener("hidden.bs.modal",n)}catch{}};e.addEventListener("hidden.bs.modal",n,{once:!0}),e.addEventListener("hide.bs.modal",()=>{try{const a=document.activeElement;if(a&&e.contains(a))try{a.blur()}catch{}}catch{}})}catch{}t.show();return}Do(e)}}function Lo(){if(At)return;At=!0;const e=r("reservations.quote.toast.viewGuide","ðŸ“˜ Ø¹Ø±Ø¶ Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø­Ù„ Ø§Ù„Ø³Ø±ÙŠØ¹"),t=r("reservations.quote.toast.retry","Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©"),n=r("reservations.quote.toast.assetsFailed","âš ï¸ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø¨Ø¹Ø¶ Ø§Ù„ØµÙˆØ± Ø¶Ù…Ù† Ø¹Ø±Ø¶ Ø³Ø¹Ø±."),a=!!w?.modal?.classList.contains("show"),o=()=>{w?.modal?.classList.contains("show")&&(ct("render"),At=!1,Se())};Xn({message:n,duration:9e3,actionLabel:a?t:void 0,onAction:a?o:void 0,linkLabel:e,linkHref:ia}),a&&ct("error",{message:n,actionLabel:t,onAction:o,showSpinner:!1})}function Et(e="reservation"){const t={},n=ca(e);return Object.entries(n).forEach(([a,o=[]])=>{t[a]=new Set(o.filter(u=>u?.default!==!1).map(u=>u.id))}),t}function xn(e={}){const t={};return Object.entries(e).forEach(([n,a])=>{t[n]=new Set(Array.from(a||[]))}),t}function Fo(e={},t){if(t)return e[t]||(e[t]=new Set),e[t]}function $n(e={},t,n){const a=e?.[t];return a?a instanceof Set?a.has(n):Array.isArray(a)?a.includes(n):!!a?.[n]:!0}function tn(e="reservation"){return Object.fromEntries(Jt(e).map(({id:t})=>[t,!1]))}function Tn(e,t){return e.sectionExpansions||(e.sectionExpansions=tn(e.context||"reservation")),t&&typeof e.sectionExpansions[t]!="boolean"&&(e.sectionExpansions[t]=!1),e.sectionExpansions}function Mo(e,t){return Tn(e,t)?.[t]!==!1}function jn(){return typeof window>"u"||typeof window.matchMedia!="function"?!1:window.matchMedia("(max-width: 768px)").matches}function Oo(){if(typeof navigator>"u")return!1;const e=navigator.userAgent||navigator.platform||"";return go.test(e)}function Ro(){if(typeof navigator>"u")return!1;const e=navigator.userAgent||"",t=wa.test(e),n=e.includes("Chrome")||e.includes("CriOS")||e.includes("Chromium"),a=e.includes("Edg");return t&&!n&&!a}function ka(){return Oo()&&Ro()}function nn(){if(typeof navigator>"u")return!1;const e=navigator.userAgent||"",t=navigator.platform||"",n=Number.isFinite(navigator.maxTouchPoints)?navigator.maxTouchPoints:0,a=Bn.test(e)||Bn.test(t),o=/Macintosh/i.test(e)&&n>1;return wa.test(e)&&!vo.test(e)&&(a||o)}function rn(e,...t){try{console.log(`${Ht} ${e}`,...t)}catch{}}function Xe(e,...t){try{console.warn(`${Ht} ${e}`,...t)}catch{}}function Bo(e,t,...n){try{t?console.error(`${Ht} ${e}`,t,...n):console.error(`${Ht} ${e}`,...n)}catch{}}function pe(e,{blockType:t="section",extraAttributes:n=""}={}){if(!e)return"";const a=n?` ${n.trim()}`:"";return e.replace(/^(<\w+)/,`$1 data-quote-block data-block-type="${t}"${a}`)}function Ko(e,t="Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¹Ø±Ø¶."){const n=l(r(e,t));return pe(`<section class="quote-section quote-placeholder">${n}</section>`,{blockType:"placeholder"})}function Ut(e,t){return Array.isArray(e)&&e.length?e:[Ko(t)]}const Ho=/[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF]/;function _a(e=""){return Ho.test(e)}function zo(){const e=window.CanvasRenderingContext2D?.prototype;if(!e||e.__artRatioDirectionPatched)return;const t=n=>{const a=e[n];typeof a=="function"&&(e[n]=function(u,...s){if(typeof u!="string"||!_a(u))return a.call(this,u,...s);let c,p=!1;try{"direction"in this&&(c=this.direction,c!=="rtl"&&(this.direction="rtl"),p=!0)}catch{}try{if(!p){const b=this.canvas;b&&b.style?.direction!=="rtl"&&(b.__artRatioOriginalDirection=b.style.direction,b.style.direction="rtl")}return a.call(this,u,...s)}finally{if(p&&c!==void 0&&c!=="rtl")try{this.direction=c}catch{}else if(!p){const b=this.canvas;b&&b.__artRatioOriginalDirection!==void 0&&(b.style.direction=b.__artRatioOriginalDirection,delete b.__artRatioOriginalDirection)}}})};t("fillText"),t("strokeText"),e.__artRatioDirectionPatched=!0}function Qn(e,t=St){if(typeof e!="string"&&typeof e!="number")return t;const n=parseFloat(String(e).replace(/[^0-9.+-]/g,""));return Number.isFinite(n)&&n>0?n:t}function Qo(e){if(!e)return{width:St,height:St};const t=e.getAttribute?.("width"),n=e.getAttribute?.("height");let a=t?Qn(t,0):0,o=n?Qn(n,0):0;if(a>0&&o>0)return{width:a,height:o};const u=e.getAttribute?.("viewBox");if(u){const s=u.trim().split(/[\s,]+/).map(c=>parseFloat(c||"0"));if(s.length>=4){const[,,c,p]=s;a=a||(Number.isFinite(c)&&c>0?c:0),o=o||(Number.isFinite(p)&&p>0?p:0)}}return{width:a||St,height:o||St}}function xa(e=""){return typeof e!="string"?!1:ya.test(e)||bo.test(e)}function Uo(e=""){const t=e.indexOf(",");if(t===-1)return"";const n=e.slice(0,t),a=e.slice(t+1);try{return/;base64/i.test(n)?typeof atob=="function"?atob(a):"":decodeURIComponent(a)}catch(o){return console.warn("[reservations/pdf] failed to decode SVG data URI",o),""}}function Vo(e,{crossOrigin:t}={}){return new Promise((n,a)=>{const o=new Image;t&&(o.crossOrigin=t),o.onload=()=>n(o),o.onerror=u=>{const s=u?.message||`Unable to load image from ${e}`;a(new Error(s))},o.src=e})}async function $a(e,t={}){if(!e)return null;const n=document,a=new Blob([e],{type:"image/svg+xml;charset=utf-8"}),o=URL.createObjectURL(a);try{const u=await Vo(o),s=n.createElement("canvas"),c=Math.max(t.width||u.naturalWidth||u.width||0,1),p=Math.max(t.height||u.naturalHeight||u.height||c,1);s.width=c,s.height=p;const b=s.getContext("2d");return b.clearRect(0,0,c,p),b.drawImage(u,0,0,c,p),s.toDataURL("image/png")}catch(u){return console.warn("[reservations/pdf] failed to rasterize SVG content",u),null}finally{URL.revokeObjectURL(o)}}async function Go(e){if(!e)return null;if(ya.test(e))return Uo(e);try{const t=await fetch(e,{mode:"cors",credentials:"omit",cache:"default"});return t.ok?await t.text():(console.warn("[reservations/pdf] failed to fetch SVG image",e,t.status),null)}catch(t){return console.warn("[reservations/pdf] error fetching SVG image",e,t),null}}async function Wo(e){if(!e)return!1;const t=e.getAttribute?.("src")||"";if(!xa(t))return!1;const n=await Go(t);if(!n)return e.dataset.svgRasterization="failed",e.setAttribute("src",cn),!1;const a=await $a(n);return a?(e.dataset.svgOriginalSrc=t,e.setAttribute("src",a),e.setAttribute("data-rasterized","true"),!0):(e.dataset.svgRasterization="failed",e.setAttribute("src",cn),!1)}async function Yo(e){if(!e||e.tagName?.toLowerCase()!=="svg")return!1;const n=new XMLSerializer().serializeToString(e),a=Qo(e),o=await $a(n,a),s=(e.ownerDocument||document).createElement("img");s.setAttribute("src",o||cn),s.setAttribute("alt",e.getAttribute("aria-label")||e.getAttribute("title")||""),s.setAttribute("data-svg-replaced","true"),e.hasAttribute("class")&&s.setAttribute("class",e.getAttribute("class")),e.hasAttribute("style")&&s.setAttribute("style",e.getAttribute("style"));const c=e.getAttribute("width"),p=e.getAttribute("height");return c&&s.setAttribute("width",c),p&&s.setAttribute("height",p),e.parentNode?.replaceChild(s,e),!!o}async function Ta(e){if(!e)return;const t=Array.from(e.querySelectorAll?.("img")||[]),n=Array.from(e.querySelectorAll?.("svg")||[]),a=[];t.forEach(o=>{xa(o.getAttribute?.("src"))&&a.push(Wo(o))}),n.forEach(o=>{a.push(Yo(o))}),a.length&&await Promise.allSettled(a)}function Xo(e,{pixelRatio:t=1}={}){if(!e)return null;const n=e.ownerDocument||document,o=(n.defaultView||window).getComputedStyle?.(e);if(!o)return null;const u=($,te=0)=>{const H=parseFloat($);return Number.isFinite(H)?H:te},s=u(o.paddingTop),c=u(o.paddingBottom),p=u(o.paddingRight),b=u(o.paddingLeft),f=u(o.borderRadius),q=u(o.fontSize,14),k=(()=>{const $=o.lineHeight;if(!$||$==="normal")return q*1.6;const te=u($,q*1.6);return te>0?te:q*1.6})(),g=Math.max(e.clientWidth||0,e.scrollWidth||0,u(o.width,0));if(g<=0)return null;const h=Math.max(1,g-b-p),P=e.textContent||"",G=P.split(/\r?\n/),S=n.createElement("canvas"),A=S.getContext("2d");if(!A)return null;const K=o.fontStyle||"normal",L=o.fontVariant||"normal",re=o.fontWeight||"400",x=o.fontFamily||"sans-serif",j=o.fontStretch||"normal",O=$=>$.join(" "),V=[],Y=$=>A.measureText($).width;A.font=`${K} ${L} ${re} ${j} ${q}px ${x}`,G.forEach($=>{const te=$.trim();if(te.length===0){V.push("");return}const H=te.split(/\s+/);let Z=[];H.forEach((be,Ce)=>{const ye=be.trim();if(!ye)return;const _e=O(Z.concat(ye));if(Y(_e)<=h||Z.length===0){Z.push(ye);return}V.push(O(Z)),Z=[ye]}),Z.length&&V.push(O(Z))}),V.length||V.push("");const F=s+c+V.length*k,v=Math.ceil(Math.max(1,g)*t),R=Math.ceil(Math.max(1,F)*t);S.width=v,S.height=R,S.style.width=`${Math.max(1,g)}px`,S.style.height=`${Math.max(1,F)}px`,A.scale(t,t);const ae=o.backgroundColor&&o.backgroundColor!=="rgba(0, 0, 0, 0)"?o.backgroundColor:"#ffffff";if(f>0){A.save(),A.beginPath();const $=Math.max(1,g),te=Math.max(1,F),H=Math.min(f,$/2,te/2);A.moveTo(H,0),A.lineTo($-H,0),A.quadraticCurveTo($,0,$,H),A.lineTo($,te-H),A.quadraticCurveTo($,te,$-H,te),A.lineTo(H,te),A.quadraticCurveTo(0,te,0,te-H),A.lineTo(0,H),A.quadraticCurveTo(0,0,H,0),A.closePath(),A.clip()}if(A.fillStyle=ae,A.fillRect(0,0,Math.max(1,g),Math.max(1,F)),A.font=`${K} ${L} ${re} ${j} ${q}px ${x}`,A.fillStyle=o.color||"#000000",A.textBaseline="top",A.textAlign="right","direction"in A)try{A.direction="rtl"}catch{}const le=Math.max(0,g-p);let I=s;V.forEach($=>{const te=$.length?$:" ";A.fillText(te,le,I,h),I+=k});const C=n.createElement("img");let me;try{me=S.toDataURL("image/png")}catch($){return Xe("note canvas toDataURL failed",$),null}return C.src=me,C.alt=P,C.style.width=`${Math.max(1,g)}px`,C.style.height=`${Math.max(1,F)}px`,C.style.display="block",C.setAttribute("data-quote-note-image","true"),{image:C,canvas:S,totalHeight:F,width:g}}function Jo(e,{pixelRatio:t=1}={}){if(!e||!nn())return;Array.from(e.querySelectorAll?.(".quote-notes")||[]).forEach(a=>{if(!a||a.dataset.quoteNoteRasterized==="true"||!_a(a.textContent||""))return;let o;try{o=Xo(a,{pixelRatio:t})}catch(u){Xe("failed to rasterize note content",u),o=null}o&&(a.dataset.quoteNoteRasterized="true",a.innerHTML="",a.appendChild(o.image))})}function fn(e,t="export",{toastMessage:n,suppressToast:a=!1}={}){Bo(`${t} failed`,e);const o=!!(e&&e.__artRatioPdfNotified);if(!a&&!o){const u=r("reservations.quote.errors.exportFailed","âš ï¸ ØªØ¹Ø°Ø± Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù PDFØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰."),s=n||u,c=r("reservations.quote.toast.viewGuide","ðŸ“˜ Ø¹Ø±Ø¶ Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø­Ù„ Ø§Ù„Ø³Ø±ÙŠØ¹"),p=r("reservations.quote.toast.retry","Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©"),b=["exportQuoteAsPdf","renderQuotePreview","layoutQuoteDocument","pageCapture"].includes(t),f=()=>{t==="exportQuoteAsPdf"?(ct("export"),La()):(ct("render"),At=!1,Se())};if(Xn({message:s,duration:9e3,actionLabel:b?p:void 0,onAction:b?f:void 0,linkLabel:c,linkHref:ia}),w?.modal?.classList.contains("show")&&ct("error",{message:s,actionLabel:b?p:void 0,onAction:b?f:void 0,showSpinner:!1}),e&&typeof e=="object")try{Object.defineProperty(e,"__artRatioPdfNotified",{value:!0,writable:!1,enumerable:!1,configurable:!0})}catch{}}}function yn({container:e,safariWindowRef:t,mobileWindowRef:n}={}){try{n&&!n.closed&&n.close()}catch(a){Xe("failed to close mobile window",a)}try{t&&!t.closed&&t.close()}catch(a){Xe("failed to close safari window",a)}e&&e.parentNode&&e.parentNode.removeChild(e)}function Cn(e){return new Promise((t,n)=>{const a=document.querySelector(`script[src="${e}"]`);if(a){a.addEventListener("load",()=>t()),a.addEventListener("error",u=>n(u)),a.readyState==="complete"&&t();return}const o=document.createElement("script");o.src=e,o.async=!0,o.onload=()=>t(),o.onerror=u=>n(u),document.head.appendChild(o)})}function Un(){const e=[window.jspdf?.jsPDF,typeof window.jspdf=="function"?window.jspdf:null,window.jsPDF?.jsPDF,typeof window.jsPDF=="function"?window.jsPDF:null].filter(t=>typeof t=="function");return e.length?e[0]:null}function Vn(){return typeof window.html2canvas=="function"?window.html2canvas:null}async function Zo(){const e=Vn();return e||(qt||(qt=Cn(yo).catch(t=>{throw qt=null,t}).then(()=>{const t=Vn();if(!t)throw qt=null,new Error("ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© html2canvas Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.");return t})),qt)}async function es(){const e=Un();return e||(wt||(wt=Cn(ho).catch(t=>{throw wt=null,t}).then(()=>{const t=Un();if(!t)throw wt=null,new Error("ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© jsPDF Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.");return t})),wt)}async function ts(){if(window.html2pdf||await Cn(fo),window.html2pdf&&!window.html2pdf.__artRatioConfigured){const e=window.html2pdf.defaultOptions||window.html2pdf.defaultOpt||{},t={...e.html2canvas||{}};t.useCORS=!0,t.allowTaint=!1,t.logging=!0;const n={unit:"mm",format:"a4",orientation:"portrait",compress:!0,...e.jsPDF||{}},a={image:{type:"jpeg",quality:.95,...e.image||{}},margin:e.margin??[0,0,0,0],filename:e.filename||"document.pdf",html2canvas:t,jsPDF:n};window.html2pdf.defaultOptions=a,window.html2pdf.defaultOpt=a,window.html2pdf.__artRatioConfigured=!0}no(),zo()}function l(e=""){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function ja(e="reservation"){return Rn[e]||Rn.reservation}function ns(){try{window.localStorage?.removeItem?.(ro)}catch{}}function as(e="reservation"){try{ns();const t=ja(e),n=window.localStorage?.getItem?.(t);if(!n)return null;const a=JSON.parse(n);return a&&typeof a=="object"?a:null}catch(t){return console.warn("âš ï¸ [reservations/pdf] failed to read toggle preferences",t),null}}function os(e,t="reservation"){try{const n=ja(t);if(!e){window.localStorage?.removeItem?.(n);return}window.localStorage?.setItem?.(n,JSON.stringify(e))}catch(n){console.warn("âš ï¸ [reservations/pdf] failed to persist toggle preferences",n)}}function ss(e){if(!e)return{ids:null,emptyExplicitly:!1};if(e instanceof Set)return{ids:Array.from(e),emptyExplicitly:e.size===0};if(Array.isArray(e))return{ids:e.slice(),emptyExplicitly:e.length===0};if(typeof e=="object"){const t=Object.entries(e).filter(([,n])=>!!n);return{ids:t.map(([n])=>n),emptyExplicitly:t.length===0}}return{ids:null,emptyExplicitly:!1}}function rs(e,t="reservation"){if(!e)return null;const n=ua(t),a=da(t),o=Array.from(e.sections instanceof Set?e.sections:new Set(e.sections||[])).filter(c=>n.has(c)),u={},s=e.fields||{};return Object.entries(a).forEach(([c,p])=>{const b=s[c];if(b==null)return;const{ids:f,emptyExplicitly:q}=ss(b);if(!f&&!q)return;const k=Array.isArray(f)?f.filter(g=>p.has(g)):[];(k.length>0||q)&&(u[c]=k)}),{version:1,sections:o,fields:u}}function Ca(e){if(!e)return;const t=e.context||"reservation",n=rs(e,t);n&&os(n,t)}function En(e){if(!e)return;const t=e.context||"reservation",n=as(t);if(!n)return;const a=ua(t),o=Array.isArray(n.sections)?n.sections.filter(u=>a.has(u)):[];if(o.length&&(e.sections=new Set(o)),n.fields&&typeof n.fields=="object"){const u=xn(e.fields||Et(t)),s=da(t);Object.entries(n.fields).forEach(([c,p])=>{const b=s[c];if(!b)return;const f=Array.isArray(p)?p.filter(q=>b.has(q)):[];u[c]=new Set(f)}),e.fields=u}}function Nn(e=new Date){try{return e.toLocaleDateString("en-GB",{year:"numeric",month:"2-digit",day:"2-digit"})}catch{return e.toISOString().slice(0,10)}}function an(e){const t=Za()||[],{technicians:n=[]}=hn(),a=[].concat(Array.isArray(t)?t:[]).concat(Array.isArray(n)?n:[]),o=new Map;return a.forEach(s=>{if(!s||s.id==null)return;const c=String(s.id),p=o.get(c)||{};o.set(c,{...p,...s})}),(Array.isArray(e.crewAssignments)&&e.crewAssignments.length?e.crewAssignments:Array.isArray(e.techniciansDetails)&&e.techniciansDetails.length?e.techniciansDetails:(e.technicians||[]).map(s=>({technicianId:s}))).map((s,c)=>{const p=s?.technicianId!=null?o.get(String(s.technicianId)):null;let b=s.positionLabel??s.position_name??s.position_label??s.role??s.position??p?.role??r("reservations.crew.positionFallback","Ù…Ù†ØµØ¨ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…");(!b||b.trim()==="")&&(b=s.positionLabelAr??s.position_label_ar??s.positionLabelEn??s.position_label_en??s.position_name_ar??s.position_name_en??p?.role??r("reservations.crew.positionFallback","Ù…Ù†ØµØ¨ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…"));try{const k=typeof ht=="function"?ht()||[]:[];let g=null;if(s?.positionId!=null&&(g=k.find(h=>String(h?.id)===String(s.positionId))||null),!g){const h=s.positionKey??s.position_key??s.positionName??s.position_name??s.position??"";if(h&&(g=typeof Mn=="function"&&Mn(h)||null,!g&&k.length)){const P=String(h).trim().toLowerCase();g=k.find(G=>[G.name,G.labelAr,G.labelEn].filter(Boolean).map(S=>String(S).toLowerCase()).includes(P))||null}}if(g){const h=g.labelAr||g.labelEn||g.name||"";h&&h.trim()&&(b=h)}}catch{}const f=Tt(Ot(s.positionCost??s.position_cost??s.cost??s.daily_wage??s.dailyWage??p?.dailyWage??p?.wage??0)),q=Tt(Ot(s.positionClientPrice??s.position_client_price??s.client_price??s.clientPrice??s.daily_total??s.dailyTotal??s.total??p?.dailyTotal??p?.total??p?.total_wage??0));return{assignmentId:s.assignmentId??s.assignment_id??`crew-${c}`,positionId:s.positionId??s.position_id??null,positionLabel:b,positionLabelAlt:s.positionLabelAlt??s.position_label_alt??"",positionCost:f,positionClientPrice:q,technicianId:s.technicianId!=null?String(s.technicianId):p?.id!=null?String(p.id):null,technicianName:s.technicianName??s.technician_name??p?.name??null,technicianRole:s.technicianRole??p?.role??null}})}function In(e,t,n){const{projectLinked:a}=Ga(e,n);bn(e.start,e.end);const o=e.discount??e.discountValue??0,u=Number(T(String(o)))||0,s=e.discountType??e.discount_type??"percent",c=String(s).toLowerCase()==="amount"?"amount":"percent",p=a?!1:!!(e.applyTax??e.apply_tax??e.taxApplied),b=e.companySharePercent??e.company_share_percent??e.companyShare??e.company_share??null,f=b!=null?Ot(b):Number.NaN,k=(e.companyShareEnabled??e.company_share_enabled??e.companyShareApplied??e.company_share_applied)===!0&&Number.isFinite(f)&&f>0?f:null,g=Array.isArray(t)?t.map(L=>L?.technicianId).filter(Boolean):[],h=Jn({items:Array.isArray(e.items)?e.items:[],technicianIds:g,crewAssignments:Array.isArray(t)?t:[],discount:u,discountType:c,applyTax:p,start:e.start,end:e.end,companySharePercent:k,groupingSource:e}),P=Ot(e.cost??e.total??e.finalTotal),G=Number.isFinite(P),S=a?h.finalTotal:G?Tt(P):h.finalTotal,A={equipmentTotal:h.equipmentTotal,equipmentCostTotal:h.equipmentCostTotal,crewTotal:h.crewTotal,crewCostTotal:h.crewCostTotal,discountAmount:h.discountAmount,subtotalAfterDiscount:h.subtotalAfterDiscount,taxableAmount:h.taxableAmount,taxAmount:h.taxAmount,finalTotal:S,companySharePercent:h.companySharePercent,companyShareAmount:h.companyShareAmount,netProfit:h.netProfit},K={equipmentTotal:he(h.equipmentTotal),equipmentCostTotal:he(h.equipmentCostTotal),crewTotal:he(h.crewTotal),discountAmount:he(h.discountAmount),subtotalAfterDiscount:he(h.subtotalAfterDiscount),taxableAmount:he(h.taxableAmount),taxAmount:he(h.taxAmount),finalTotal:he(S),companySharePercent:T((Number.isFinite(h.companySharePercent)?h.companySharePercent:0).toFixed(2)),companyShareAmount:he(h.companyShareAmount),netProfit:T(h.netProfit.toFixed(2))};return{totals:A,totalsDisplay:K,rentalDays:h.rentalDays}}function gt(e){if(e==null||e==="")return null;const t=Number.parseFloat(T(String(e)));return Number.isFinite(t)?t:null}function Ea(e){if(!e)return new Date().toISOString();const t=new Date(e);return Number.isNaN(t.getTime())?new Date().toISOString():t.toISOString()}function is(e){if(!e||typeof e!="object")return null;const t=e.type??e.payment_type??e.paymentType??null;let n=typeof t=="string"?t.trim().toLowerCase():null;n!=="percent"&&(n="amount");const a=gt(e.amount??(n==="amount"?e.value:null)),o=gt(e.percentage??(n==="percent"?e.value:null)),u=n==="percent"?o??null:a??null,s=e.note??e.memo??null,c=Ea(e.recordedAt??e.recorded_at??e.date??e.created_at??null);return n==="amount"&&a==null||n==="percent"&&o==null?null:{type:n,amount:a??null,percentage:o??null,value:u,note:s,recordedAt:c}}function ls(e={}){const n=(Array.isArray(e.paymentHistory)?e.paymentHistory:Array.isArray(e.payment_history)?e.payment_history:[]).map(is).filter(Boolean);if(n.length>0)return n;const a=gt(e.paidPercent??e.paid_percent),o=gt(e.paidAmount??e.paid_amount),u=e.updatedAt??e.updated_at??e.createdAt??e.created_at??null,s=Ea(u);return a!=null&&a>0?[{type:"percent",amount:o!=null&&o>0?o:null,percentage:a,value:a,note:null,recordedAt:s}]:o!=null&&o>0?[{type:"amount",amount:o,percentage:null,value:o,note:null,recordedAt:s}]:[]}function cs(e){if(!e)return r("projects.form.types.unknown","Ù†ÙˆØ¹ ØºÙŠØ± Ù…Ø­Ø¯Ø¯");const t={commercial:"projects.form.types.commercial",coverage:"projects.form.types.coverage",photography:"projects.form.types.photography",social:"projects.form.types.social"}[e]||"projects.form.types.unknown";return r(t,e)}function us(e){const t=new Date,n=e?.start?new Date(e.start):null,a=e?.end?new Date(e.end):null;return n&&!Number.isNaN(n.getTime())&&n>t?"upcoming":a&&!Number.isNaN(a.getTime())&&a<t?"completed":"ongoing"}function ds(e){if(Array.isArray(e?.expenses)&&e.expenses.some(a=>Number.isFinite(Number(a?.salePrice??a?.sale_price))))return e.expenses.reduce((a,o)=>a+(Number(o?.salePrice??o?.sale_price)||0),0);const t=Number(e?.servicesClientPrice??e?.services_client_price);return Number.isFinite(t)&&t>=0?t:typeof e?.expensesTotal=="number"?e.expensesTotal:Array.isArray(e?.expenses)?e.expenses.reduce((n,a)=>n+(Number(a?.amount)||0),0):0}function ps(e){if(!e)return 0;const t=Array.isArray(e.items)?e.items:[],n=e.discount??0,a=Number(T(String(n)))||0,o=e.discountType||"percent",u=Array.isArray(e.crewAssignments)?e.crewAssignments:[],s=u.length?u:Array.isArray(e.technicians)?e.technicians:[],c=Ja(t,a,o,!1,s,{start:e.start,end:e.end,companySharePercent:0});if(Number.isFinite(c))return c;const p=Number(T(String(e.cost??0)));return Number.isFinite(p)?Math.round(p):0}function ms(e,t){if(!e)return"â€”";const n=yt(e);return t?`${n} - ${yt(t)}`:n}function ne(e,t="SR",n=2){const a=Number(e);return`${he(a)} ${t}`}function Gn(e,t=2){if(!Number.isFinite(Number(e)))return"0%";const n=Number.isInteger(t)?t:2;return`${T(Number(e).toFixed(n))}%`}function fs(e){if(!e?.start)return null;if(!e?.end)return 1;const t=bn(e.start,e.end);return Number.isFinite(t)?t:1}function ys(e){return Number.isFinite(e)?e<=1?"ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯":`${T(String(Math.round(e)))} Ø£ÙŠØ§Ù…`:"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}function Wn(e){const t=r("reservations.create.summary.currency","SR"),n=hn()||{},a=Array.isArray(n.customers)?n.customers:[],o=Array.isArray(n.projects)?n.projects:[],u=Array.isArray(n.technicians)?n.technicians:[];let s=[];try{const m=ea?.()||[];s=Array.isArray(m)&&m.length?m:n.reservations||[]}catch{s=n.reservations||[]}const c=e?.id!=null?o.find(m=>String(m.id)===String(e.id))||e:e||null,p={projectStatusLabel:r("projects.status.ongoing","Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°"),paymentStatusLabel:r("projects.paymentStatus.unpaid","ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹")};if(!c)return{project:null,customer:null,clientInfo:{name:"-",company:"-",phone:"-",email:"-"},projectInfo:{title:"-",code:"-",typeLabel:"-",startDisplay:"-",endDisplay:"-",durationLabel:"-",statusLabel:p.projectStatusLabel},expenses:[],equipment:[],reservations:[],totals:{equipmentEstimate:0,expensesTotal:0,baseSubtotal:0,discountAmount:0,subtotalAfterDiscount:0,companyShareAmount:0,subtotal:0,applyTax:!1,taxAmount:0,totalWithTax:0},totalsDisplay:{projectSubtotal:ne(0,t),expensesTotal:ne(0,t),reservationsTotal:ne(0,t),discountAmount:ne(0,t),taxAmount:ne(0,t),overallTotal:ne(0,t),paidAmount:ne(0,t),remainingAmount:ne(0,t)},projectTotals:{combinedTaxAmount:0,overallTotal:0,reservationsTotal:0,paidAmount:0,paidPercent:0,remainingAmount:0,paymentStatus:"unpaid"},paymentSummary:{status:"unpaid",statusLabel:p.paymentStatusLabel,paidAmount:0,paidPercent:0,remainingAmount:0,paidAmountDisplay:ne(0,t),remainingAmountDisplay:ne(0,t),paidPercentDisplay:Gn(0)},notes:"",currencyLabel:t,projectStatus:"ongoing",projectStatusLabel:p.projectStatusLabel,projectDurationDays:null,projectDurationLabel:"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",paymentHistory:[]};const b=c.clientId??c.customerId??c.client_id??c.customer_id??null,f=b!=null&&a.find(m=>String(m.id)===String(b))||null,q=f?.customerName??f?.name??c.clientName??c.customerName??r("projects.fallback.unknownClient","Ø¹Ù…ÙŠÙ„ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"),k=(c.clientCompany||f?.companyName||f?.company||"").trim(),g=f?.phone??f?.customerPhone??c.clientPhone??c.customerPhone??"",h=g?T(String(g).trim()):r("projects.details.client.noPhone","Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù‚Ù… Ù…ØªØ§Ø­"),P=f?.email??c.clientEmail??c.customerEmail??"",G=P?String(P).trim():r("projects.details.client.noEmail","Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨Ø±ÙŠØ¯ Ù…ØªØ§Ø­"),S=c.projectCode||`PRJ-${T(String(c.id??""))}`,A=T(String(S)),K=(c.title||"").trim()||r("projects.fallback.untitled","Ù…Ø´Ø±ÙˆØ¹ Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†"),L=cs(c.type),re=c.start?yt(c.start):"â€”",x=c.end?yt(c.end):"â€”",j=fs(c),O=j!=null?ys(j):"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",V=us(c),Y={upcoming:"Ù‚Ø§Ø¯Ù…",ongoing:"Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°",completed:"Ù…ÙƒØªÙ…Ù„"},F=r(`projects.status.${V}`,Y[V]||V),v=c.id!=null?String(c.id):null,R=v?s.filter(m=>{const z=m?.projectId??m?.project_id??null;return z!=null&&String(z)===v}):[];R.map(m=>{const z=m.reservationId||m.id||"",_=m.status||m.state||"pending",se=String(_).toLowerCase(),oe=r(`reservations.status.${se}`,se),X=ps(m),qe=m.start?new Date(m.start).getTime():0;return{reservationId:T(String(z||"-")),status:se,statusLabel:oe,total:X,totalLabel:ne(X,t),dateRange:ms(m.start,m.end),startTimestamp:Number.isNaN(qe)?0:qe}}).sort((m,z)=>z.startTimestamp-m.startTimestamp).map(({startTimestamp:m,...z})=>z);let ae=0,le=0;try{R.forEach(m=>{const z=Jn({items:Array.isArray(m.items)?m.items:[],technicianIds:Array.isArray(m.technicians)?m.technicians:[],crewAssignments:Array.isArray(m.crewAssignments)?m.crewAssignments:[],discount:Number(m.discount??0)||0,discountType:m.discountType||"percent",applyTax:!1,start:m.start,end:m.end,groupingSource:m,companySharePercent:0});ae+=Number(z.equipmentTotal||0),le+=Number(z.crewTotal||0)})}catch{}const I=ds(c),C=Number(ae+le+I),me=[];try{R.forEach(m=>{const{groups:z}=Zn(m);z.forEach(_=>{const se=Number(_?.count??_?.quantity??1)||1,oe=Number(_?.unitPrice);let X=Number.isFinite(oe)?oe:0;if(!X||X<=0){const de=Number(_?.totalPrice);Number.isFinite(de)&&se>0&&(X=Number((de/se).toFixed(2)))}Number.isFinite(X)||(X=0);const qe=_?.type==="package"||Array.isArray(_?.items)&&_.items.some(de=>de?.type==="package"),Ne=Array.isArray(_?.barcodes)&&_.barcodes.length?_.barcodes[0]:Array.isArray(_?.items)&&_.items.length?_.items[0]?.barcode:null;let ce=_?.packageDisplayCode??_?.package_code??_?.code??_?.packageCode??(Array.isArray(_?.items)&&_.items.length?_.items[0]?.package_code??_.items[0]?.code??_.items[0]?.packageCode:null);const Ve=de=>{const xe=(de==null?"":String(de)).trim();return!!(!xe||/^pkg-/i.test(xe)||/^\d+$/.test(xe)&&xe.length<=4)};if(!ce||Ve(ce)){const de=_?.packageId??_?.package_id??(Array.isArray(_?.items)&&_.items.length?_.items[0]?.packageId??_.items[0]?.package_id:null);if(de)try{const xe=ta(de);xe&&xe.package_code&&(ce=xe.package_code)}catch{}}if(!ce||Ve(ce))try{const de=ft(_?.description||"");if(de){const xe=na();let Re=xe.find(We=>ft(We?.name||We?.title||We?.label||"")===de);Re||(Re=xe.find(We=>{const Nt=ft(We?.name||We?.title||We?.label||"");return Nt.includes(de)||de.includes(Nt)})),Re&&Re.package_code&&(ce=Re.package_code)}}catch{}const Ge=qe?ce??Ne??"":_?.barcode??Ne??"",et=Ge!=null?String(Ge):"",on=Number.isFinite(Number(_?.totalPrice))?Number(_.totalPrice):Number((X*se).toFixed(2));me.push({..._,isPackage:qe,desc:_?.description,barcode:et,packageCodeResolved:ce||"",qty:se,price:X,totalPrice:Tt(on),unitPriceValue:X})})})}catch{}const $=new Map;R.forEach(m=>{const z=Array.isArray(m.items)?m.items:[],_=bn(m.start,m.end),se=m.reservationId||m.id||"";z.forEach((oe,X)=>{if(!oe)return;const qe=oe.barcode||oe.code||oe.id||oe.desc||oe.description||`item-${X}`,Ne=String(qe||`item-${X}`),ce=$.get(Ne)||{description:oe.desc||oe.description||oe.name||oe.barcode||`#${T(String(X+1))}`,totalQuantity:0,reservationsCount:0,reservationIds:new Set,totalCost:0},Ve=Number(oe.qty)||1,Ge=Number(oe.price)||0;ce.totalQuantity+=Ve,ce.reservationIds.add(String(se));const et=Ge*Ve*Math.max(1,_);Number.isFinite(et)&&(ce.totalCost+=et),$.set(Ne,ce)})});const te=Array.from($.values()).map(m=>({description:m.description,totalQuantity:m.totalQuantity,reservationsCount:m.reservationIds.size,displayCost:ne(m.totalCost,t)})),H=new Map((u||[]).filter(Boolean).map(m=>[String(m.id),m])),Z=new Map,be=m=>{if(!m)return;let z=null;typeof m=="object"?z=m.id??m.technicianId??m.technician_id??m.userId??m.user_id??null:(typeof m=="string"||typeof m=="number")&&(z=m);const _=z!=null?String(z):null,se=_&&H.has(_)?H.get(_):typeof m=="object"?m:null,oe=se?.name||se?.full_name||se?.fullName||se?.displayName||(typeof m=="string"?m:null),X=se?.role||se?.title||null,qe=se?.phone||se?.mobile||se?.contact||null;if(!oe&&!_)return;const Ne=_||oe;Z.has(Ne)||Z.set(Ne,{id:_,name:oe||"-",role:X||null,phone:qe||null})};Array.isArray(c?.technicians)&&c.technicians.forEach(m=>be(m)),R.forEach(m=>{(Array.isArray(m.crewAssignments)&&m.crewAssignments.length?m.crewAssignments:Array.isArray(m.technicians)?m.technicians.map(_=>({technicianId:_})):[]).forEach(_=>be(_))});const Ce=Array.from(Z.values()),ye=Array.isArray(c.expenses)?c.expenses.map(m=>{const z=Number(m?.salePrice??m?.sale_price??m?.amount)||0;return{label:m?.label||m?.name||"-",amount:z,displayAmount:ne(z,t),note:m?.note||m?.description||""}}):[],_e=c?.applyTax===!0||c?.applyTax==="true",st=Number.parseFloat(c?.discount??c?.discountValue??0)||0;let we=(c?.discountType==="amount"?"amount":"percent")==="amount"?st:C*(st/100);(!Number.isFinite(we)||we<0)&&(we=0),we>C&&(we=C);const rt=Math.max(0,C-we),ze=c?.companyShareEnabled===!0||c?.company_share_enabled===!0||c?.companyShareApplied===!0||c?.company_share_applied===!0,Ee=Number.parseFloat(c?.companySharePercent??c?.company_share_percent??c?.companyShare??c?.company_share??0)||0,Je=ze&&Ee>0?Ee:0,$e=Je>0?Number((rt*(Je/100)).toFixed(2)):0,Me=Number((rt+$e).toFixed(2)),Qe=_e?Number((Me*eo).toFixed(2)):0,Oe=Number((Me+Qe).toFixed(2)),Ue=ls(c),De=gt(c.paidAmount??c.paid_amount)||0,Pe=gt(c.paidPercent??c.paid_percent)||0,Le=Ya({totalAmount:Oe,paidAmount:De,paidPercent:Pe,history:Ue}),ut=typeof c.paymentStatus=="string"?c.paymentStatus.toLowerCase():"",Ze=Xa({manualStatus:ut,paidAmount:Le.paidAmount,paidPercent:Le.paidPercent,totalAmount:Oe}),vt={paid:"Ù…Ø¯ÙÙˆØ¹",partial:"Ù…Ø¯ÙÙˆØ¹ Ø¬Ø²Ø¦ÙŠØ§Ù‹",unpaid:"ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹"},dt=r(`projects.paymentStatus.${Ze}`,vt[Ze]||Ze),y=Number(Le.paidAmount||0),M=Number(Le.paidPercent||0),D=Math.max(0,Number((Oe-y).toFixed(2))),ee={projectSubtotal:ne(Me,t),expensesTotal:ne(I,t),reservationsTotal:ne(Me,t),discountAmount:ne(we,t),taxAmount:ne(Qe,t),overallTotal:ne(Oe,t),paidAmount:ne(y,t),remainingAmount:ne(D,t)},W={status:Ze,statusLabel:dt,paidAmount:y,paidPercent:M,remainingAmount:D,paidAmountDisplay:ne(y,t),remainingAmountDisplay:ne(D,t),paidPercentDisplay:Gn(M)},U=(c.description||"").trim();return{project:c,customer:f,clientInfo:{name:q,company:k||"â€”",phone:h,email:G},projectInfo:{title:K,code:A,typeLabel:L,startDisplay:re,endDisplay:x,durationLabel:O,statusLabel:F},expenses:ye,equipment:te,crew:Ce,equipmentItems:me,crewAssignments:R.flatMap(m=>an(m)),totals:{equipmentEstimate:ae,expensesTotal:I,baseSubtotal:C,discountAmount:we,subtotalAfterDiscount:rt,companyShareAmount:$e,subtotal:Me,applyTax:_e,taxAmount:Qe,totalWithTax:Oe},totalsDisplay:ee,projectTotals:{combinedTaxAmount:Qe,overallTotal:Oe,reservationsTotal:Me,paidAmount:y,paidPercent:M,remainingAmount:D,paymentStatus:Ze},paymentSummary:W,notes:U,currencyLabel:t,projectStatus:V,projectStatusLabel:F,projectDurationDays:j,projectDurationLabel:O,paymentHistory:Ue}}function hs({project:e,clientInfo:t={},projectInfo:n={},projectCrew:a=[],projectExpenses:o=[],projectEquipment:u=[],totalsDisplay:s={},projectTotals:c={},paymentSummary:p={},currencyLabel:b="SR",sections:f,fieldSelections:q={},quoteNumber:k,quoteDate:g,terms:h=je,rootAttributes:P=""}){const G=xn(q),S=(y,M)=>$n(G,y,M),A=y=>f?.has?.(y),K=`<div class="quote-placeholder">${l(r("reservations.quote.placeholder.noFields","Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù„Ù„Ø¹Ø±Ø¶ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…."))}</div>`,L=(y,M)=>`<div class="info-plain__item">
      <span class="info-plain__label">${l(y)}</span>
      <span class="info-plain__separator">:</span>
      <span class="info-plain__value">${l(M)}</span>
    </div>`,re=(y,M,{variant:D="inline"}={})=>D==="final"?`<div class="totals-item totals-item--final">
        <span class="totals-item__label">${l(y)}</span>
        <span class="totals-item__slash">/</span>
        <span class="totals-item__value">${l(M)}</span>
      </div>`:`<span class="totals-inline__item">
      <span class="totals-inline__label">${l(y)}</span>
      <span class="totals-inline__slash">/</span>
      <span class="totals-inline__value">${l(M)}</span>
    </span>`,x=(y,M)=>`<div class="payment-row">
      <span class="payment-row__label">${l(y)}</span>
      <span class="payment-row__slash">/</span>
      <span class="payment-row__value">${l(M)}</span>
    </div>`,j=(y,M,D)=>{const ee=`${y}-title`,W=`${y}-content`;return`
      <div class="quote-section__head" data-drag-key="${l(ee)}">
        ${M}
      </div>
      <div class="quote-section__body" data-drag-key="${l(W)}">
        ${D}
      </div>
    `},O=[];S("customerInfo","customerName")&&O.push(L(r("projects.details.client","Ø§Ù„Ø¹Ù…ÙŠÙ„"),t.name||"-")),S("customerInfo","customerCompany")&&O.push(L(r("projects.details.company","Ø´Ø±ÙƒØ© Ø§Ù„Ø¹Ù…ÙŠÙ„"),t.company||"â€”")),S("customerInfo","customerPhone")&&O.push(L(r("projects.details.labels.clientPhone","Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„"),t.phone||"-")),S("customerInfo","customerEmail")&&O.push(L(r("projects.details.labels.clientEmail","Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"),t.email||"-"));const V=xt(i,"projectCustomer"),Y=A("customerInfo")?`<section class="quote-section quote-section--plain quote-section--customer">
        ${j("customer",`<h3 class="quote-section__title">${l(r("projects.quote.sections.customer","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„"))}</h3>`,O.length?`<div class="${V}">${O.join("")}</div>`:K)}
      </section>`:"",F=[];S("projectInfo","projectType")&&F.push(L(r("projects.details.type","Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.typeLabel||"-")),S("projectInfo","projectTitle")&&F.push(L(r("projects.details.projectTitle","Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.title||"-")),S("projectInfo","projectCode")&&F.push(L(r("projects.details.labels.code","Ø±Ù‚Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.code||"-")),S("projectInfo","projectStart")&&F.push(L(r("projects.details.start","Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.startDisplay||"-")),S("projectInfo","projectEnd")&&F.push(L(r("projects.details.end","Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.endDisplay||"-")),S("projectInfo","projectDuration")&&F.push(L(r("projects.details.duration","Ù…Ø¯Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.durationLabel||"-")),S("projectInfo","projectStatus")&&F.push(L(r("projects.details.status","Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.statusLabel||"-"));const v=xt(i,"projectDetails"),R=A("projectInfo")?`<section class="quote-section quote-section--plain quote-section--project">
        ${j("project",`<h3 class="quote-section__title">${l(r("projects.quote.sections.project","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"))}</h3>`,F.length?`<div class="${v}">${F.join("")}</div>`:K)}
      </section>`:"",ae=Yt.filter(y=>S("projectCrew",y.id)),le=Array.isArray(i?.crewAssignments)?i.crewAssignments:[],I=y=>{const M=y&&y.positionId!=null?`id:${String(y.positionId)}`:(()=>{const W=(y?.positionLabel||y?.position_name||y?.position||"").trim().toLowerCase();return W?`label:${W}`:""})(),D=Number.isFinite(Number(y?.positionClientPrice))?Number(y.positionClientPrice):0,ee=D>0?`|p:${D.toFixed(2)}`:"";return`${M}${ee}`};(()=>{const y=new Map;return le.forEach(M=>{const D=I(M);D&&y.set(D,(y.get(D)||0)+1)}),y})();const C=(()=>{const y=[];if(ae.forEach(U=>{U.id==="position"?(y.push({...U,render:B=>{const m=typeof ie=="function"?ie():"ar";let z=B?.positionLabelEn??B?.position_label_en??B?.position_name_en??B?.positionLabelAlt??B?.position_label_alt??B?.role;if(!z&&m==="en")try{const oe=typeof ht=="function"?ht():[];let X=null;if(B?.positionId!=null&&(X=oe.find(qe=>String(qe.id)===String(B.positionId))||null),!X){const qe=B?.positionKey??B?.position_key??B?.positionName??B?.position_name??B?.position??"";if(qe){const Ne=String(qe).toLowerCase();X=oe.find(ce=>String(ce.name).toLowerCase()===Ne)||null}}X&&(z=X.labelEn??X.label_en??X.name_en??z)}catch{}const _=B?.positionLabel??B?.position_name??B?.role??r("reservations.crew.positionFallback","Ù…Ù†ØµØ¨ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…");return l(T(String(m==="en"&&z?z:_)))}}),S("projectCrew","quantity")&&y.push({id:"quantity",labelKey:"reservations.details.table.headers.quantity",fallback:"Ø§Ù„ÙƒÙ…ÙŠØ©",render:B=>l(T(String(Math.max(1,Number(B?.__count||1)))))})):U.id==="price"?y.push({...U,render:B=>{const m=Number.isFinite(Number(B?.positionClientPrice))?Number(B.positionClientPrice):0,z=Math.max(1,Number(B?.__count||1)),_=Math.max(1,Number(i?.rentalDays||1)),se=m*z*_;return l(`${he(se)} ${r("reservations.create.summary.currency","SR")}`)}}):U.id==="unitPrice"?y.push({...U,render:B=>{const m=Number.isFinite(Number(B?.positionClientPrice))?Number(B.positionClientPrice):0;return l(`${he(m)} ${r("reservations.create.summary.currency","SR")}`)}}):y.push(U)}),S("projectCrew","days")){const U=Math.max(1,Number(i?.rentalDays||1)),B=y.findIndex(z=>z.id==="price"),m=Math.max(0,B);y.splice(m,0,{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…",render:()=>l(T(String(U)))})}const M=new Map(y.map(U=>[U.id,U])),D=new Set,ee=[],W=U=>{const B=M.get(U);B&&!D.has(U)&&(ee.push(B),D.add(U))};return W("rowNumber"),W("position"),W("unitPrice"),W("quantity"),W("days"),W("price"),y.forEach(U=>{D.has(U.id)||(ee.push(U),D.add(U.id))}),ee})(),me=(()=>{const y=new Map;return le.forEach(M=>{const D=I(M);if(!D)return;const ee=y.get(D);ee?ee.__count+=1:y.set(D,{...M,__count:1})}),Array.from(y.values())})(),$=(()=>{try{const y=Math.max(1,Number(i?.rentalDays||1)),M=(me||[]).reduce((D,ee)=>{const W=Number.isFinite(Number(ee?.positionClientPrice))?Number(ee.positionClientPrice):0,U=Math.max(1,Number(ee?.__count||1));return D+W*U*y},0);return he(M)}catch{return"0.00"}})(),te=A("projectCrew")?C.length?`<section class="quote-section quote-section--table">
            <h3>${l(r("projects.quote.sections.crew","Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„"))}</h3>
            <table class="quote-table">
              <thead>
                <tr>${C.map(y=>`<th>${l(y.labelKey?r(y.labelKey,y.fallback):y.fallback)}</th>`).join("")}</tr>
              </thead>
              <tbody>${me.length?me.map((y,M)=>`<tr>${C.map(D=>`<td><div class="quote-cell">${D.render(y,M)}</div></td>`).join("")}</tr>`).join(""):`<tr><td colspan="${Math.max(C.length,1)}" class="empty">${l(r("projects.details.crew.empty","Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ø§Ù‚Ù… ÙÙ†ÙŠ Ù…Ø±ØªØ¨Ø·."))}</td></tr>`}
              </tbody>
            </table>
            ${S("projectCrew","crewSubtotal")?`
              <div class="quote-table-subtotal">
                <span class="quote-table-subtotal__pill">
                  <span class="quote-table-subtotal__label">${l(r("reservations.details.labels.crewTotal","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±ÙŠÙ‚"))}</span>
                  <span class="quote-table-subtotal__value">${l(`${$} ${b}`)}</span>
                </span>
              </div>
            `:""}
          </section>`:`<section class="quote-section quote-section--table">
            <h3>${l(r("projects.quote.sections.crew","Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„"))}</h3>
            ${K}
          </section>`:"",H=[];S("financialSummary","discountAmount")&&H.push(re(r("reservations.details.labels.discount","Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ…"),s.discountAmount||ne(0,b)));const Z=r("projects.details.summary.preTaxTotal","Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©");S("financialSummary","reservationsTotal")&&H.push(re(Z,s.reservationsTotal||ne(0,b))),S("financialSummary","taxAmount")&&H.push(re(r("projects.details.summary.combinedTax","Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"),s.taxAmount||ne(0,b)));const be=[];S("financialSummary","overallTotal")&&be.push(re(r("projects.details.summary.overallTotal","Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ"),s.overallTotal||ne(0,b),{variant:"final"}));const Ce=A("financialSummary")?!H.length&&!be.length?`<section class="quote-section quote-section--financial">${K}</section>`:`<section class="quote-section quote-section--financial">
          ${j("projectFinancial",`<h3>${l(r("projects.quote.sections.financial","Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ"))}</h3>`,`<div class="totals-block">
              ${H.length?`<div class="totals-inline">${H.join("")}</div>`:""}
              ${be.length?`<div class="totals-final">${be.join("")}</div>`:""}
            </div>`)}
        </section>`:"",ye=la.filter(y=>S("projectExpenses",y.id)),_e=A("projectExpenses")?ye.length?`<section class="quote-section quote-section--table">
            <h3>${l(r("projects.quote.sections.expenses","Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©"))}</h3>
            <table class="quote-table">
              <thead>
                <tr>${ye.map(y=>`<th>${l(y.labelKey?r(y.labelKey,y.fallback):y.fallback)}</th>`).join("")}</tr>
              </thead>
              <tbody>${o.length?o.map((y,M)=>`<tr>${ye.map(D=>`<td><div class="quote-cell">${D.render(y,M)}</div></td>`).join("")}</tr>`).join(""):`<tr><td colspan="${Math.max(ye.length,1)}" class="empty">${l(r("projects.details.expenses.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ØªØ·Ù„Ø¨Ø§Øª Ù…Ø³Ø¬Ù„Ø©."))}</td></tr>`}
              </tbody>
            </table>
            ${S("projectExpenses","expensesSubtotal")?`
              <div class="quote-table-subtotal">
                <span class="quote-table-subtotal__pill">
                  <span class="quote-table-subtotal__label">${l(r("projects.details.expensesTotal","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©"))}</span>
                  <span class="quote-table-subtotal__value">${l(s.expensesTotal||ne(0,b))}</span>
                </span>
              </div>
            `:""}
          </section>`:`<section class="quote-section quote-section--table">
            <h3>${l(r("projects.quote.sections.expenses","Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©"))}</h3>
            ${K}
          </section>`:"",st=Wt.filter(y=>S("projectEquipment",y.id)),Ie=(()=>{let y=[];if(st.forEach(W=>{W.id==="price"?y.push({...W,render:U=>{const B=Number.isFinite(Number(U?.unitPriceValue))?Number(U.unitPriceValue):0,m=Number.isFinite(Number(U?.qty))?Math.max(1,Number(U.qty)):1,z=Math.max(1,Number(i?.rentalDays||1)),_=B*m*z;return l(`${he(_)} ${r("reservations.create.summary.currency","SR")}`)}}):W.id==="unitPrice"?y.push({...W,render:U=>{const B=Number.isFinite(Number(U?.unitPriceValue))?Number(U.unitPriceValue):0;return l(`${he(B)} ${r("reservations.create.summary.currency","SR")}`)}}):y.push(W)}),S("projectEquipment","days")){const W=Math.max(1,Number(i?.rentalDays||1)),U=y.findIndex(m=>m.id==="price"),B=Math.max(0,U);y.splice(B,0,{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…",render:()=>l(T(String(W)))})}const M=new Map(y.map(W=>[W.id,W])),D=y.filter(W=>!["unitPrice","quantity","days","price"].includes(W.id)),ee=["unitPrice","quantity","days","price"].map(W=>M.get(W)).filter(Boolean);return y=[...D,...ee],y})(),we=Array.isArray(i?.equipmentItems)?i.equipmentItems:[],rt=(()=>{try{const y=Math.max(1,Number(i?.rentalDays||1)),M=(we||[]).reduce((D,ee)=>{const W=Number.isFinite(Number(ee?.unitPriceValue))?Number(ee.unitPriceValue):0,U=Number.isFinite(Number(ee?.qty))?Math.max(1,Number(ee.qty)):1;return D+W*U*y},0);return he(M)}catch{return"0.00"}})(),ze=A("projectEquipment")?Ie.length?`<section class="quote-section quote-section--table">
            <h3>${l(r("projects.quote.sections.equipment","Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</h3>
            <table class="quote-table">
              <thead>
                <tr>${Ie.map(y=>`<th>${l(y.labelKey?r(y.labelKey,y.fallback):y.fallback)}</th>`).join("")}</tr>
              </thead>
              <tbody>${we.length?we.map((y,M)=>`<tr>${Ie.map(D=>`<td><div class="quote-cell">${D.render(y,M)}</div></td>`).join("")}</tr>`).join(""):`<tr><td colspan="${Math.max(Ie.length,1)}" class="empty">${l(r("projects.details.equipment.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø¯Ø§Øª Ù…Ø±ØªØ¨Ø·Ø© Ø­Ø§Ù„ÙŠØ§Ù‹."))}</td></tr>`}
              </tbody>
            </table>
            ${S("projectEquipment","equipmentSubtotal")?`
              <div class="quote-table-subtotal">
                <span class="quote-table-subtotal__pill">
                  <span class="quote-table-subtotal__label">${l(r("reservations.details.labels.equipmentTotal","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</span>
                  <span class="quote-table-subtotal__value">${l(`${rt} ${b}`)}</span>
                </span>
              </div>
            `:""}
          </section>`:`<section class="quote-section quote-section--table">
            <h3>${l(r("projects.quote.sections.equipment","Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</h3>
            ${K}
          </section>`:"",Ee=(e?.description||"").trim()||"",Je=A("projectNotes")?`<section class="quote-section">
        <h3>${l(r("projects.quote.sections.notes","Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"))}</h3>
        <div class="quote-notes">${l(Ee||r("projects.fallback.noDescription","Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ Ù„Ù„Ù…Ø´Ø±ÙˆØ¹."))}</div>
      </section>`:"",$e=[];S("payment","beneficiary")&&$e.push(x(r("reservations.quote.labels.beneficiary","Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙÙŠØ¯"),ve.beneficiaryName)),S("payment","bank")&&$e.push(x(r("reservations.quote.labels.bank","Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ"),ve.bankName)),S("payment","account")&&$e.push(x(r("reservations.quote.labels.account","Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨"),T(ve.accountNumber))),S("payment","iban")&&$e.push(x(r("reservations.quote.labels.iban","Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ¨Ø§Ù†"),T(ve.iban)));const Me=`<section class="quote-section">
      <div class="payment-block">
        <h3>${l(r("reservations.quote.sections.payment","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹"))}</h3>
        <div class="payment-rows">${$e.length?$e.join(""):K}</div>
      </div>
      <p class="quote-approval-note">${l(ve.approvalNote)}</p>
    </section>`,Qe=Array.isArray(h)&&h.length?h:je,Oe=`<footer class="quote-footer">
        <h4>${l(r("reservations.quote.labels.terms","Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø¹Ø§Ù…Ø©"))}</h4>
        <ul>${Qe.map(y=>`<li>${l(y)}</li>`).join("")}</ul>
      </footer>`,Ue=[],De=[];if(R&&De.push({key:"project",html:R}),Y&&De.push({key:"customer",html:Y}),De.length>1){const y=De.find(ee=>ee.key==="project"),M=De.find(ee=>ee.key==="customer"),D=[];y?.html&&D.push(y.html),M?.html&&D.push(M.html),Ue.push(pe(`<div class="quote-section-row quote-section-row--primary">${D.join("")}</div>`,{blockType:"group"}))}else De.length===1&&Ue.push(pe(De[0].html));const Pe=[];te&&Pe.push(pe(te,{blockType:"table",extraAttributes:'data-table-id="project-crew"'})),_e&&Pe.push(pe(_e,{blockType:"table",extraAttributes:'data-table-id="project-expenses"'})),ze&&Pe.push(pe(ze,{blockType:"table",extraAttributes:'data-table-id="project-equipment"'}));const Le=[];Ce&&Le.push(pe(Ce,{blockType:"summary"})),Je&&Le.push(pe(Je));let ut=[];ut=[...A("payment")?[pe(Me,{blockType:"payment"})]:[],pe(Oe,{blockType:"footer"})];const Ze=[...Ut(Ue,"projects.quote.placeholder.primary"),...Pe,...Ut(Le,"projects.quote.placeholder.summary"),...ut],vt=typeof ie=="function"?ie():"ar",dt=`
    <header class="quote-header" data-quote-header-template>
      <div class="quote-header__logo">
        <img class="quote-logo" src="${l(ve.logoUrl)}" alt="${l(ve.companyName)}" crossorigin="anonymous"/>
      </div>
      <div class="quote-header__title">
        <h1>${l(r("projects.quote.title","Ø¹Ø±Ø¶ Ø³Ø¹Ø±"))}</h1>
        <p class="quote-company-name">${l(r("quote.companyName",ve.companyName))}</p>
        <p class="quote-company-cr">${l(r("reservations.quote.labels.cr","Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ"))}: ${l(ve.commercialRegistry)}</p>
        <p class="quote-company-license">${l(r("reservations.quote.labels.mediaLicense","ØªØ±Ø®ÙŠØµ Ø¥Ø¹Ù„Ø§Ù…ÙŠ"))}: 159460</p>
      </div>
      <div class="quote-header__meta">
        <div class="quote-header__meta-item">
          <span>${l(r("reservations.details.labels.reservationId","Ø±Ù‚Ù… Ø§Ù„Ø¹Ø±Ø¶"))}</span>
          <strong>${l(k)}</strong>
        </div>
        <div class="quote-header__meta-item">
          <span>${l(r("projects.quote.labels.date","Ø§Ù„ØªØ§Ø±ÙŠØ®"))}</span>
          <strong>${l(g)}</strong>
        </div>
      </div>
    </header>
  `.trim();return`
    <div id="quotation-pdf-root" dir="rtl" data-lang="${l(vt)}"${P}>
      <style>${fa}${ma}</style>
      <div class="quote-document" data-quote-document>
        <div class="quote-preview-pages" data-quote-pages></div>
        <div class="quote-content-source" data-quote-source>
          ${dt}
          ${Ze.join("")}
        </div>
      </div>
    </div>
  `}function Na(e={}){const t={context:e?.context||He(),blockOffsets:e?.blockOffsets||i?.blockOffsets||null,infoAlignments:e?.infoAlignments||i?.infoAlignments||null},n=So(t),a=_t;_t=t;try{if(e?.context==="project")return hs({...e,rootAttributes:n});const{reservation:o,customer:u,project:s,crewAssignments:c,totals:p,totalsDisplay:b,rentalDays:f,currencyLabel:q,sections:k,fieldSelections:g={},quoteNumber:h,quoteDate:P,terms:G=je}=e,S=T(String(o?.reservationId??o?.id??"")),A=typeof ie=="function"?ie():"ar",K=o.start?T(yt(o.start)):"-",L=o.end?T(yt(o.end)):"-",re=u?.customerName||u?.full_name||u?.name||"-",x=u?.phone||"-",j=u?.email||"-",O=u?.company||u?.company_name||"-",V=T(x),Y=s?.title||s?.name||r("reservations.details.project.none","ØºÙŠØ± Ù…Ø±ØªØ¨Ø· Ø¨Ù…Ø´Ø±ÙˆØ¹"),F=s?.code||s?.projectCode||"",v=T(String(f)),R=o?.notes||"",ae=Array.isArray(G)&&G.length?G:je,le=xn(g),I=(d,Q)=>$n(le,d,Q),C=d=>k?.has?.(d),me=`<div class="quote-placeholder">${l(r("reservations.quote.placeholder.noFields","Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù„Ù„Ø¹Ø±Ø¶ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…."))}</div>`,$=(d,Q)=>{const J=A==="en"?": ":" / ";return`<div class="info-plain__item">${l(d)}<span class="info-plain__slash">${J}</span><strong class="info-plain__value">${l(Q)}</strong></div>`},te=(d,Q,{variant:J="inline"}={})=>J==="final"?`<div class="totals-item totals-item--final">
        <span class="totals-item__label">${l(d)}</span>
        <span class="totals-item__slash">/</span>
        <span class="totals-item__value">${l(Q)}</span>
      </div>`:`<span class="totals-inline__item">
      <span class="totals-inline__label">${l(d)}</span>
      <span class="totals-inline__slash">/</span>
      <span class="totals-inline__value">${l(Q)}</span>
    </span>`,H=(d,Q)=>`<div class="payment-row">
      <span class="payment-row__label">${l(d)}</span>
      <span class="payment-row__slash">/</span>
      <span class="payment-row__value">${l(Q)}</span>
    </div>`,Z=(d,Q,J)=>{const fe=`${d}-title`,Ae=`${d}-content`;return`
      <div class="quote-section__head" data-drag-key="${l(fe)}">
        ${Q}
      </div>
      <div class="quote-section__body" data-drag-key="${l(Ae)}">
        ${J}
      </div>
    `},be=[];I("customerInfo","customerName")&&be.push($(r("reservations.details.labels.customer","Ø§Ù„Ø¹Ù…ÙŠÙ„"),re)),I("customerInfo","customerCompany")&&be.push($(r("reservations.details.labels.company","Ø§Ù„Ø´Ø±ÙƒØ©"),O)),I("customerInfo","customerPhone")&&be.push($(r("reservations.details.labels.phone","Ø§Ù„Ù‡Ø§ØªÙ"),V)),I("customerInfo","customerEmail")&&be.push($(r("reservations.details.labels.email","Ø§Ù„Ø¨Ø±ÙŠØ¯"),j));const Ce=xt(i,"customer"),ye=C("customerInfo")&&be.length?`<section class="quote-section quote-section--plain quote-section--customer">
            ${Z("customer",`<h3 class="quote-section__title">${l(r("reservations.quote.sections.customer","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„"))}</h3>`,`<div class="${Ce}">${be.join("")}</div>`)}
          </section>`:"",_e=[];I("reservationInfo","reservationId")&&_e.push($(r("reservations.details.labels.reservationId","Ø±Ù‚Ù… Ø§Ù„Ø­Ø¬Ø²"),S||"-")),I("reservationInfo","reservationStart")&&_e.push($(r("reservations.details.labels.start","Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø­Ø¬Ø²"),K)),I("reservationInfo","reservationEnd")&&_e.push($(r("reservations.details.labels.end","Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø­Ø¬Ø²"),L)),I("reservationInfo","reservationDuration")&&_e.push($(r("reservations.details.labels.duration","Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…"),v));const st=xt(i,"reservation"),Ie=C("reservationInfo")&&_e.length?`<section class="quote-section quote-section--plain quote-section--reservation">
            ${Z("reservation",`<h3 class="quote-section__title">${l(r("reservations.quote.sections.reservation","ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²"))}</h3>`,`<div class="${st}">${_e.join("")}</div>`)}
          </section>`:"",we=[];I("projectInfo","projectTitle")&&we.push($(r("reservations.details.labels.project","Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),Y)),I("projectInfo","projectCode")&&we.push($(r("reservations.details.labels.code","Ø§Ù„Ø±Ù…Ø²"),F||"-"));const rt=xt(i,"project"),ze=C("projectInfo")&&we.length?`<section class="quote-section quote-section--plain quote-section--project">
            ${Z("project",`<h3 class="quote-section__title">${l(r("reservations.quote.sections.project","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"))}</h3>`,`<div class="${rt}">${we.join("")}</div>`)}
          </section>`:"",Ee=[];I("financialSummary","discountAmount")&&Ee.push(te(r("reservations.details.labels.discount","Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ…"),`${b.discountAmount} ${q}`)),I("financialSummary","subtotalBeforeTax")&&Ee.push(te(r("reservations.details.labels.subtotalBeforeTax","Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"),`${b.taxableAmount} ${q}`)),I("financialSummary","taxAmount")&&Ee.push(te(r("reservations.details.labels.tax","Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"),`${b.taxAmount} ${q}`));const Je=I("financialSummary","finalTotal"),$e=[];Je&&$e.push(te(r("reservations.details.labels.total","Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ"),`${b.finalTotal} ${q}`,{variant:"final"}));const Me=$e.length?`<div class="totals-final">${$e.join("")}</div>`:"",Qe=C("financialSummary")?!Ee.length&&!Je?`<section class="quote-section quote-section--financial">${me}</section>`:`<section class="quote-section quote-section--financial">
          ${Z("financial",`<h3 class="quote-section__title">${l(r("reservations.details.labels.summary","Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ"))}</h3>`,`<div class="totals-block">
              ${Ee.length?`<div class="totals-inline">${Ee.join("")}</div>`:""}
              ${Me}
            </div>`)}
        </section>`:"",{groups:Oe}=Zn(o),Ue=Oe.map(d=>{const Q=Number(d?.count??d?.quantity??1)||1,J=Number(d?.unitPrice);let fe=Number.isFinite(J)?J:0;if(!fe||fe<=0){const ue=Number(d?.totalPrice);Number.isFinite(ue)&&Q>0&&(fe=Number((ue/Q).toFixed(2)))}Number.isFinite(fe)||(fe=0);const Ae=d?.type==="package"||Array.isArray(d?.items)&&d.items.some(ue=>ue?.type==="package"),Fe=Array.isArray(d?.barcodes)&&d.barcodes.length?d.barcodes[0]:Array.isArray(d?.items)&&d.items.length?d.items[0]?.barcode:null;let E=d?.packageDisplayCode??d?.package_code??d?.code??d?.packageCode??(Array.isArray(d?.items)&&d.items.length?d.items[0]?.package_code??d.items[0]?.code??d.items[0]?.packageCode:null);const N=ue=>{const ke=(ue==null?"":String(ue)).trim();return!!(!ke||/^pkg-/i.test(ke)||/^\d+$/.test(ke)&&ke.length<=4)};if(!E||N(E)){const ue=d?.packageId??d?.package_id??(Array.isArray(d?.items)&&d.items.length?d.items[0]?.packageId??d.items[0]?.package_id:null);if(ue)try{const ke=ta(ue);ke&&ke.package_code&&(E=ke.package_code)}catch{}}if(!E||N(E))try{const ue=ft(d?.description||"");if(ue){const ke=na();let tt=ke.find(Ye=>ft(Ye?.name||Ye?.title||Ye?.label||"")===ue);tt||(tt=ke.find(Ye=>{const pt=ft(Ye?.name||Ye?.title||Ye?.label||"");return pt.includes(ue)||ue.includes(pt)})),tt&&tt.package_code&&(E=tt.package_code)}}catch{}const ge=Ae?E??Fe??"":d?.barcode??Fe??"",Te=ge!=null?String(ge):"";let Be=Number.isFinite(Number(d?.totalPrice))?Number(d.totalPrice):Number((fe*Q).toFixed(2));return Be=Tt(Be),{...d,isPackage:Ae,desc:d?.description,barcode:Te,packageCodeResolved:E||"",qty:Q,price:Be,totalPrice:Be,unitPriceValue:fe}}),De=Wt.filter(d=>I("items",d.id)),Pe=(()=>{let d=[];De.forEach(E=>{E.id==="price"?d.push({...E,render:N=>{const ge=Number.isFinite(Number(N?.unitPriceValue))?Number(N.unitPriceValue):0,Te=Number.isFinite(Number(N?.qty))?Math.max(1,Number(N.qty)):1,Be=Math.max(1,Number(i?.rentalDays||1)),ue=ge*Te*Be;return l(`${he(ue)} ${r("reservations.create.summary.currency","SR")}`)}}):E.id==="unitPrice"?d.push({...E,render:N=>{const ge=Number.isFinite(Number(N?.unitPriceValue))?Number(N.unitPriceValue):0;return l(`${he(ge)} ${r("reservations.create.summary.currency","SR")}`)}}):d.push(E)});const Q=Math.max(1,Number(i?.rentalDays||1));if(I("items","days")){const E=d.findIndex(ge=>ge.id==="price"),N=Math.max(0,E);d.splice(N,0,{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…",render:()=>l(T(String(Q)))})}const J=new Map(d.map(E=>[E.id,E])),fe=d.filter(E=>!["unitPrice","quantity","days","price"].includes(E.id)),Ae=["unitPrice","quantity"];J.has("days")&&Ae.push("days"),Ae.push("price");const Fe=Ae.map(E=>J.get(E)).filter(Boolean);return d=[...fe,...Fe],d})(),Le=Pe.length>0,ut=Le?Pe.map(d=>`<th>${l(d.labelKey?r(d.labelKey,d.fallback):d.fallback)}</th>`).join(""):"",vt=Ue.length>0?Ue.map((d,Q)=>`<tr>${Pe.map(J=>`<td><div class="quote-cell">${J.render(d,Q)}</div></td>`).join("")}</tr>`).join(""):`<tr><td colspan="${Math.max(Pe.length,1)}" class="empty">${l(r("reservations.details.noItems","ðŸ“¦ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø¯Ø§Øª Ø¶Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø² Ø­Ø§Ù„ÙŠØ§Ù‹."))}</td></tr>`,dt=C("items")?Le?`<section class="quote-section quote-section--table">
            <h3>${l(r("reservations.details.items.title","Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</h3>
            <table class="quote-table">
              <thead>
                <tr>${ut}</tr>
              </thead>
              <tbody>${vt}</tbody>
            </table>
            ${I("items","equipmentSubtotal")?`
              <div class="quote-table-subtotal">
                <span class="quote-table-subtotal__pill">
                  <span class="quote-table-subtotal__label">${l(r("reservations.details.labels.equipmentTotal","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</span>
                  <span class="quote-table-subtotal__value">${l(`${b.equipmentTotal} ${q}`)}</span>
                </span>
              </div>
            `:""}
          </section>`:`<section class="quote-section quote-section--table">
            <h3>${l(r("reservations.details.items.title","Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</h3>
            ${me}
          </section>`:"",y=Yt.filter(d=>I("crew",d.id)),M=!0,D=y.length>0,ee=Array.isArray(c)?c:[],W=d=>{const Q=d&&d.positionId!=null?`id:${String(d.positionId)}`:(()=>{const Ae=(d?.positionLabel||d?.position_name||d?.position||"").trim().toLowerCase();return Ae?`label:${Ae}`:""})(),J=Number.isFinite(Number(d?.positionClientPrice))?Number(d.positionClientPrice):0,fe=J>0?`|p:${J.toFixed(2)}`:"";return`${Q}${fe}`},U=(()=>{const d=new Map;return ee.forEach(Q=>{const J=W(Q);J&&d.set(J,(d.get(J)||0)+1)}),d})(),B=(()=>{let d=[],Q=null;if(y.forEach(E=>{E.id==="position"?(d.push({...E,render:N=>{const ge=typeof ie=="function"?ie():"ar";let Te=N?.positionLabelEn??N?.position_label_en??N?.position_name_en??N?.positionLabelAlt??N?.position_label_alt??N?.role;if(!Te&&ge==="en")try{const pt=typeof ht=="function"?ht():[];let it=null;if(N?.positionId!=null&&(it=pt.find(It=>String(It.id)===String(N.positionId))||null),!it){const It=N?.positionKey??N?.position_key??N?.positionName??N?.position_name??N?.position??"";if(It){const Ka=String(It).toLowerCase();it=pt.find(Ha=>String(Ha.name).toLowerCase()===Ka)||null}}it&&(Te=it.labelEn??it.label_en??it.name_en??Te)}catch{}const Be=N?.positionLabel??N?.position_name??N?.role??r("reservations.crew.positionFallback","Ù…Ù†ØµØ¨ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…"),ue=ge==="en"&&Te?Te:Be;if(M)return l(T(String(ue)));const ke=W(N),tt=ke&&U.get(ke)||0,Ye=tt>1?` Ã— ${T(String(tt))}`:"";return l(T(String(ue))+Ye)}}),I("crew","quantity")&&(Q={id:"quantity",labelKey:"reservations.details.table.headers.quantity",fallback:"Ø§Ù„ÙƒÙ…ÙŠØ©",render:N=>{const ge=Number(N?.__count||1);return l(T(String(Math.max(1,ge))))}})):E.id==="price"?M&&d.push({...E,render:N=>{const ge=Number.isFinite(Number(N?.positionClientPrice))?Number(N.positionClientPrice):0,Te=Math.max(1,Number(N?.__count||1)),Be=Math.max(1,Number(i?.rentalDays||1)),ue=ge*Te*Be;return l(`${he(ue)} ${r("reservations.create.summary.currency","SR")}`)}}):E.id==="unitPrice"?d.push({...E,render:N=>{const ge=Number.isFinite(Number(N?.positionClientPrice))?Number(N.positionClientPrice):0;return l(`${he(ge)} ${r("reservations.create.summary.currency","SR")}`)}}):d.push(E)}),Q&&d.push(Q),I("crew","days")){const E=Math.max(1,Number(i?.rentalDays||1)),N=d.findIndex(Te=>Te.id==="price"),ge=Math.max(0,N);d.splice(ge,0,{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…",render:()=>l(T(String(E)))})}const J=new Map(d.map(E=>[E.id,E])),fe=new Set,Ae=[],Fe=E=>{const N=J.get(E);N&&!fe.has(E)&&(Ae.push(N),fe.add(E))};return Fe("rowNumber"),Fe("position"),Fe("unitPrice"),Fe("quantity"),Fe("days"),Fe("price"),d.forEach(E=>{fe.has(E.id)||(Ae.push(E),fe.add(E.id))}),d=Ae,d})(),m=D?B.map(d=>`<th>${l(d.labelKey?r(d.labelKey,d.fallback):d.fallback)}</th>`).join(""):"",z=M?(()=>{const d=new Map;return ee.forEach(Q=>{const J=W(Q);if(!J)return;const fe=d.get(J);fe?fe.__count+=1:d.set(J,{...Q,__count:1})}),Array.from(d.values())})():ee,_=z.length?z.map((d,Q)=>`<tr>${B.map(J=>`<td><div class="quote-cell">${J.render(d,Q)}</div></td>`).join("")}</tr>`).join(""):`<tr><td colspan="${Math.max(B.length,1)}" class="empty">${l(r("reservations.details.noCrew","ðŸ˜Ž Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙØ±ÙŠÙ‚ Ù…Ø±ØªØ¨Ø· Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø²."))}</td></tr>`,se=C("crew")?D?`<section class="quote-section quote-section--table">
            <h3>${l(r("reservations.details.technicians.title","Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„"))}</h3>
            <table class="quote-table">
              <thead>
                <tr>${m}</tr>
              </thead>
              <tbody>${_}</tbody>
            </table>
            ${I("crew","crewSubtotal")?`
              <div class="quote-table-subtotal">
                <span class="quote-table-subtotal__pill">
                  <span class="quote-table-subtotal__label">${l(r("reservations.details.labels.crewTotal","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±ÙŠÙ‚"))}</span>
                  <span class="quote-table-subtotal__value">${l(`${b.crewTotal} ${q}`)}</span>
                </span>
              </div>
            `:""}
          </section>`:`<section class="quote-section quote-section--table">
            <h3>${l(r("reservations.details.technicians.title","Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„"))}</h3>
            ${me}
          </section>`:"",oe=C("notes")?`<section class="quote-section">
        <h3>${l(r("reservations.details.labels.notes","Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø­Ø¬Ø²"))}</h3>
        <div class="quote-notes">${l(R||r("reservations.quote.emptyNotes","Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©."))}</div>
      </section>`:"",X=[];I("payment","beneficiary")&&X.push(H(r("reservations.quote.labels.beneficiary","Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙÙŠØ¯"),ve.beneficiaryName)),I("payment","bank")&&X.push(H(r("reservations.quote.labels.bank","Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ"),ve.bankName)),I("payment","account")&&X.push(H(r("reservations.quote.labels.account","Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨"),T(ve.accountNumber))),I("payment","iban")&&X.push(H(r("reservations.quote.labels.iban","Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ¨Ø§Ù†"),T(ve.iban)));const qe=`<section class="quote-section">
      <div class="payment-block">
        <h3>${l(r("reservations.quote.sections.payment","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹"))}</h3>
        <div class="payment-rows">${X.length?X.join(""):me}</div>
      </div>
      <p class="quote-approval-note">${l(ve.approvalNote)}</p>
    </section>`,Ne=`<footer class="quote-footer">
        <h4>${l(r("reservations.quote.labels.terms","Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø¹Ø§Ù…Ø©"))}</h4>
        <ul>${ae.map(d=>`<li>${l(d)}</li>`).join("")}</ul>
      </footer>`,ce=[];if(ye&&Ie){const Q=(typeof ie=="function"?ie():"ar")==="en"?`${Ie}${ye}`:`${ye}${Ie}`;ce.push(pe(`<div class="quote-section-row">${Q}</div>`,{blockType:"group"}))}else Ie&&ce.push(pe(Ie)),ye&&ce.push(pe(ye));if(ze)try{const d=typeof ie=="function"?ie():"ar",Q='<section class="quote-section quote-section--empty"></section>',J=d==="en"?`<div class="quote-section-row">${Q}${ze}</div>`:`<div class="quote-section-row">${Q}${ze}</div>`;ce.push(pe(J,{blockType:"group"}))}catch{ce.push(pe(ze))}const Ve=[];dt&&Ve.push(pe(dt,{blockType:"table",extraAttributes:'data-table-id="items"'})),se&&Ve.push(pe(se,{blockType:"table",extraAttributes:'data-table-id="crew"'}));const Ge=[];Qe&&Ge.push(pe(Qe,{blockType:"summary"})),oe&&Ge.push(pe(oe));let et=[];if((e?.context||"reservation")!=="reservationChecklist")et=[...C("payment")?[pe(qe,{blockType:"payment"})]:[],pe(Ne,{blockType:"footer"})];else{const d=String(e?.checklistNotes||"").trim(),Q=String(e?.checklistNotesTitle||"").trim()||r("reservations.checklist.controls.notes.sectionTitleDefault","Ù…Ù„Ø§Ø­Ø¸Ø§Øª");if(d.length>0){const J=`<section class="quote-section">
        <h3>${l(Q)}</h3>
        <div class="quote-notes">${l(d)}</div>
      </section>`;et=[pe(J)]}}const on=[...e?.context==="reservationChecklist"?ce:Ut(ce,"reservations.quote.placeholder.page1"),...Ve,...e?.context==="reservationChecklist"?Ge:Ut(Ge,"reservations.quote.placeholder.page2"),...et],de=e?.context==="reservationChecklist",xe=e?.checklistType==="crew"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ":e?.checklistType==="both"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙˆØ§Ù„Ø·Ø§Ù‚Ù… Ø§Ù„ÙÙ†ÙŠ":"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",Re=typeof ie=="function"?ie():"ar",We=e?.checklistType==="crew"?"Crew List":e?.checklistType==="both"?"Equipment & Crew List":"Equipment List",Nt=de?Re==="en"?We:xe:r("reservations.quote.title","Ø¹Ø±Ø¶ Ø³Ø¹Ø±"),Ma=de?`<div class="quote-header__meta" ${Re==="en"?'dir="ltr"':""}>
        <div class="quote-header__meta-item">
          <span>${l(r("reservations.quote.labels.date","Ø§Ù„ØªØ§Ø±ÙŠØ®"))}</span>
          <strong>${l(P)}</strong>
        </div>
      </div>`:`<div class="quote-header__meta">
        <div class="quote-header__meta-item">
          <span>Ø±Ù‚Ù… Ø§Ù„Ø¹Ø±Ø¶</span>
          <strong>${l(h)}</strong>
        </div>
        <div class="quote-header__meta-item">
          <span>Ø§Ù„ØªØ§Ø±ÙŠØ®</span>
          <strong>${l(P)}</strong>
        </div>
      </div>`,Oa=!de||!e?.hideLogo,Ra=!de||!e?.hideCompany,Ba=`
    <header class="quote-header" data-quote-header-template style="${Number.isFinite(Number(e?.headerOffset))?`margin-top:${Number(e.headerOffset)}px;`:""}">
      <div class="quote-header__logo">
        ${Oa?`<img class="quote-logo" src="${l(ve.logoUrl)}" alt="${l(ve.companyName)}" crossorigin="anonymous"/>`:'<span class="quote-logo quote-logo--placeholder" aria-hidden="true"></span>'}
      </div>
      <div class="quote-header__title">
        <h1>${l(Nt)}</h1>
        ${Ra?`
          <p class="quote-company-name">${l(r("quote.companyName",ve.companyName))}</p>
          <p class="quote-company-cr">${l(r("reservations.quote.labels.cr","Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ"))}: ${l(ve.commercialRegistry)}</p>
          <p class="quote-company-license">${l(r("reservations.quote.labels.mediaLicense","ØªØ±Ø®ÙŠØµ Ø¥Ø¹Ù„Ø§Ù…ÙŠ"))}: 159460</p>
        `:""}
      </div>
      ${Ma}
    </header>
  `.trim();return`
      <div id="quotation-pdf-root" dir="${l(de&&Re==="en"?"ltr":"rtl")}" data-lang="${l(Re)}"${n}>
        <style>${fa}${ma}</style>
        <div class="quote-document" data-quote-document>
          <div class="quote-preview-pages" data-quote-pages></div>
          <div class="quote-content-source" data-quote-source>
            ${Ba}
            ${on.join("")}
          </div>
        </div>
      </div>
    `}finally{_t=a}}async function Dn(){try{const e=hn();if((Array.isArray(e?.packages)?e.packages:[]).length>0)return;const n=await za("/packages/?all=1"),a=Array.isArray(n?.data)?n.data:Array.isArray(n)?n:[];a.length&&(Qa({packages:a}),document.dispatchEvent?.(new CustomEvent("packages:changed",{detail:{packages:a}})))}catch{}}function bs(e){return e?e.complete?e.naturalHeight===0?Promise.reject(new Error(`image failed to load: ${e.src||"unknown"}`)):Promise.resolve():new Promise((t,n)=>{const a=()=>{u(),t()},o=()=>{u(),n(new Error(`image failed to load: ${e.src||"unknown"}`))},u=()=>{e.removeEventListener("load",a),e.removeEventListener("error",o)};e.addEventListener("load",a,{once:!0}),e.addEventListener("error",o,{once:!0})}):Promise.resolve()}async function Ct(e){if(!e)return;const t=e.ownerDocument||document,n=t.defaultView||window,a=Array.from(e.querySelectorAll?.("img")||[]),o=t.fonts?.ready?t.fonts.ready:Promise.resolve(),u=a.map(c=>bs(c)),s=[o,...u].map(c=>c.catch(p=>(Xe("asset load failed",p),Lo(),null)));await Promise.all(s),await new Promise(c=>n.requestAnimationFrame(()=>c()))}async function Vt(e,{context:t="preview"}={}){if(!e)return;const n=t==="preview",a=e.ownerDocument||document;e.setAttribute("data-quote-render-context",t);const o=e.querySelector("[data-quote-pages]"),u=e.querySelector("[data-quote-source]"),s=u?.querySelector("[data-quote-header-template]");if(!o||!u||!s)return;o.style.display="block",o.style.margin="0",o.style.padding="0",o.style.gap="0px",o.style.rowGap="0px",o.style.columnGap="0px",o.style.alignItems="stretch",o.style.justifyContent="flex-start",await Ta(u),await Ct(u),o.innerHTML="";const c=Array.from(u.querySelectorAll(":scope > [data-quote-block]")),p=e.getAttribute(kt.context)||null,b=qo(e,kt.blockOffsets);let f=null,q=null;const k=v=>{v.style.margin="0 auto",v.style.breakInside="avoid",v.style.pageBreakInside="avoid",v.style.pageBreakAfter="auto",v.style.breakAfter="auto"},g=()=>{const v=a.createElement("div"),R=o.childElementCount===0;if(v.className="quote-page",v.dataset.pageIndex=String(o.childElementCount),R){v.classList.add("quote-page--primary");const le=s.cloneNode(!0);le.removeAttribute("data-quote-header-template"),v.appendChild(le)}else v.classList.add("quote-page--continuation");const ae=a.createElement("main");ae.className="quote-body",v.appendChild(ae),o.appendChild(v),k(v),f=v,q=ae},h=()=>{(!f||!q||!q.isConnected)&&g()},P=()=>{if(!f||!q||q.childElementCount>0)return;const v=f;f=null,q=null,v.parentNode&&v.parentNode.removeChild(v)},G=()=>{f=null,q=null},S=()=>f?f.scrollHeight-f.clientHeight>va:!1,A=(v,{allowOverflow:R=!1}={})=>(h(),q.appendChild(v),S()&&!R?(q.removeChild(v),P(),!1):!0),K=v=>{const R=v.cloneNode(!0);R.removeAttribute?.("data-quote-block"),R.removeAttribute?.("data-block-type"),R.removeAttribute?.("data-table-id"),!A(R)&&(G(),!A(R)&&A(R,{allowOverflow:!0}))},L=v=>{const R=v.querySelector("table");if(!R){K(v);return}const ae=v.querySelector("h3"),le=R.querySelector("thead"),I=Array.from(R.querySelectorAll("tbody tr"));if(!I.length){K(v);return}let C=null,me=0;const $=(H=!1)=>{const Z=v.cloneNode(!1);Z.removeAttribute("data-quote-block"),Z.removeAttribute("data-block-type"),Z.removeAttribute("data-table-id"),Z.classList.add("quote-section--table-fragment"),H&&Z.classList.add("quote-section--table-fragment--continued");const be=ae?ae.cloneNode(!0):null;be&&Z.appendChild(be);const Ce=R.cloneNode(!1);Ce.classList.add("quote-table--fragment"),le&&Ce.appendChild(le.cloneNode(!0));const ye=a.createElement("tbody");return Ce.appendChild(ye),Z.appendChild(Ce),{section:Z,body:ye}},te=(H=!1)=>C||(C=$(H),A(C.section)||(G(),A(C.section)||A(C.section,{allowOverflow:!0})),C);I.forEach(H=>{te(me>0);const Z=H.cloneNode(!0);if(C.body.appendChild(Z),S()&&(C.body.removeChild(Z),C.body.childElementCount||(q.removeChild(C.section),C=null,P()),G(),C=null,te(me>0),C.body.appendChild(Z),S())){C.section.classList.add("quote-section--table-fragment--overflow"),me+=1;return}me+=1}),C=null;try{const H=v.querySelector(":scope > .quote-table-subtotal");H&&K(H)}catch{}};if(!c.length)return;c.forEach(v=>{v.getAttribute("data-block-type")==="table"?L(v):K(v)});const re=Array.from(o.children),x=[];if(re.forEach((v,R)=>{const ae=v.querySelector(".quote-body");if(R!==0&&(!ae||ae.childElementCount===0)){v.remove();return}x.push(v)}),!n){const v=a.defaultView||window,R=Math.min(3,Math.max(1,v.devicePixelRatio||1)),ae=nn()?Math.min(2,R):R;x.forEach(le=>Jo(le,{pixelRatio:ae}))}x.forEach((v,R)=>{const ae=R===0;v.style.pageBreakAfter="auto",v.style.breakAfter="auto",v.style.pageBreakBefore=ae?"auto":"always",v.style.breakBefore=ae?"auto":"page",n?v.style.boxShadow="":v.style.boxShadow="none"});const j=x[x.length-1]||null;f=j,q=j?.querySelector(".quote-body")||null,await Ct(o);const O=v=>v&&typeof v=="object"&&Object.keys(v).length>0,Y=qn[He(i||(p?{context:p}:null))]||{},F=O(b)?b:O(i?.blockOffsets)?i.blockOffsets:Y;try{ko(e,F)}catch{}n&&(o.style.display="flex",o.style.flexDirection="column",o.style.alignItems="center",o.style.justifyContent="flex-start",o.style.rowGap="18px",o.style.columnGap="0px",o.style.gap="18px")}function Ia(e=0){return e<=0?new Promise(t=>requestAnimationFrame(()=>t())):new Promise(t=>setTimeout(t,e))}function Da(e){return e?Array.from(e.querySelectorAll(".quote-page")).some(n=>n.scrollHeight-n.clientHeight>va):!1}function Pn(e,t="#000000"){if(!e)return;e.querySelectorAll('[style*="color"], [class*="text"], h1, h2, h3, h4, h5, h6, p, span, th, td, li, strong, em, label, dt, dd, caption, div').forEach(a=>{a instanceof HTMLElement&&a.style.setProperty("color",t,"important")})}async function gs(e,{filename:t,safariWindowRef:n=null,mobileWindowRef:a=null}){if(!e)return;const o=Array.from(e.querySelectorAll(".quote-page"));if(!o.length)throw new Error("Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙØ­Ø§Øª Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§.");const[u,s]=await Promise.all([es(),Zo()]),c=e.ownerDocument||document,p=c?.defaultView?.getComputedStyle?.(e)?.direction,f=[e.getAttribute?.("dir"),e.style?.direction,p,c?.documentElement?.getAttribute?.("dir")].some(x=>typeof x=="string"&&x.toLowerCase().startsWith("rtl")),q=typeof window<"u"&&window.devicePixelRatio||1,k=jn(),g=ka(),h=nn();let P;h?P=1.5:g?P=Math.min(1.7,Math.max(1.2,q*1.1)):k?P=Math.min(1.8,Math.max(1.25,q*1.2)):P=Math.min(2,Math.max(1.6,q*1.4));const G=h||g?.9:k?.92:.95,S=new u({unit:"mm",format:"a4",orientation:"portrait",compress:!0}),A={scale:P,useCORS:!0,allowTaint:!1,backgroundColor:"#ffffff",letterRendering:!f,removeContainer:!1,logging:!0};let K=0;const L=r("reservations.quote.errors.browserLimit","ØªØ¹Ø°Ø± Ø¥ØªÙ…Ø§Ù… Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ø³Ø¨Ø¨ Ù‚ÙŠÙˆØ¯ Ø§Ù„Ù…ØªØµÙØ­ØŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø£Ùˆ ØªÙ‚Ù„ÙŠÙ„ Ø­Ø¬Ù… Ø§Ù„Ù…Ø­ØªÙˆÙ‰.");try{for(let x=0;x<o.length;x+=1){const j=o[x];await Ta(j),await Ct(j);const O=j.ownerDocument||document,V=O.createElement("div");Object.assign(V.style,{position:"fixed",top:"0",left:"-12000px",pointerEvents:"none",zIndex:"-1",backgroundColor:"#ffffff"});const Y=j.cloneNode(!0);Y.style.width=`${Pt}px`,Y.style.maxWidth=`${Pt}px`,Y.style.minWidth=`${Pt}px`,Y.style.height=`${Lt}px`,Y.style.maxHeight=`${Lt}px`,Y.style.minHeight=`${Lt}px`,Y.style.position="relative",Y.style.background="#ffffff",Pn(Y),V.appendChild(Y),O.body.appendChild(V);let F;try{await Ct(Y),F=await s(Y,{...A,scale:P,backgroundColor:"#ffffff",scrollX:0,scrollY:0})}catch($){throw fn($,"pageCapture",{toastMessage:L}),$}finally{V.parentNode?.removeChild(V)}if(!F)continue;const v=F.width||1,ae=(F.height||1)/v;let le=un,I=le*ae,C=0;if(I>Dt){const $=Dt/I;I=Dt,le=le*$,C=Math.max(0,(un-le)/2)}const me=F.toDataURL("image/jpeg",G);K>0&&S.addPage(),S.addImage(me,"JPEG",C,0,le,I,`page-${K+1}`,"FAST"),K+=1,await new Promise($=>window.requestAnimationFrame($))}}catch(x){throw yn({safariWindowRef:n,mobileWindowRef:a}),x}if(K===0)throw yn({safariWindowRef:n,mobileWindowRef:a}),new Error("PDF generation produced no pages.");if(g||h){const x=S.output("blob");if(h){const j=URL.createObjectURL(x);$t();try{window.location.assign(j)}catch(O){Xe("mobile safari blob navigation failed",O)}finally{setTimeout(()=>URL.revokeObjectURL(j),6e4)}}else{const j=URL.createObjectURL(x),O=()=>g&&n&&!n.closed?n:a&&!a.closed?a:null,V=(F,v)=>{if($t(),!F){window.location.assign(v);return}try{F.location.replace(v),F.focus?.()}catch(R){Xe("direct blob navigation failed",R);try{F.document.open(),F.document.write(`<!DOCTYPE html><html lang="ar" dir="rtl"><head><meta charset="utf-8"><title>${l(r("reservations.quote.actions.export","ØªÙ†Ø²ÙŠÙ„ PDF"))}</title><style>html,body{margin:0;height:100%;background:#0f172a;color:#f8fafc;font-family:'Tajawal',sans-serif;} iframe{border:none;width:100%;height:100%;display:block;}</style></head><body><iframe src="${v}" title="PDF preview"></iframe></body></html>`),F.document.close()}catch(ae){Xe("iframe blob delivery failed",ae),window.location.assign(v)}}},Y=O();V(Y,j),setTimeout(()=>URL.revokeObjectURL(j),6e4)}}else{$t();const x=S.output("bloburl"),j=document.createElement("a");j.href=x,j.download=t,j.rel="noopener",j.style.display="none",document.body.appendChild(j),j.click(),setTimeout(()=>{URL.revokeObjectURL(x),j.remove()},2e3)}}function Se(){if(!i||!w)return;const{previewFrame:e}=w;if(!e)return;Fa();const t=i.context||"reservation",n=Na({context:t,reservation:i.reservation,customer:i.customer,project:i.project,crewAssignments:i.crewAssignments,totals:i.totals,totalsDisplay:i.totalsDisplay,rentalDays:i.rentalDays,currencyLabel:i.currencyLabel,sections:i.sections,fieldSelections:i.fields,quoteNumber:i.quoteNumber,quoteDate:i.quoteDateLabel,terms:i.terms,checklistType:i.checklistType,checklistNotes:i.checklistNotes,checklistNotesTitle:i.checklistNotesTitle,hideLogo:!!i.hideLogo,hideCompany:!!i.hideCompany,headerOffset:Number(i.headerOffset||0),projectCrew:i.projectCrew,projectExpenses:i.projectExpenses,projectEquipment:i.projectEquipment,projectInfo:i.projectInfo,clientInfo:i.clientInfo,paymentSummary:i.paymentSummary,projectTotals:i.projectTotals,blockOffsets:i.blockOffsets,infoAlignments:i.infoAlignments});ct("render"),e.srcdoc=`<!DOCTYPE html>${n}`,e.addEventListener("load",async()=>{try{const a=e.contentDocument,o=a?.defaultView||window,u=a?.documentElement||a;u&&(aa(u),oa(u,o),sa(u,o));const s=a?.getElementById("quotation-pdf-root");try{s&&(await Vt(s,{context:"preview"}),await Ia(120),Da(s)&&await Vt(s,{context:"preview"}),Pn(s))}catch(g){console.error("[reservations/pdf] failed to layout preview document",g)}const c=Array.from(a?.querySelectorAll?.(".quote-page")||[]);try{if(i?.context==="reservationChecklist"&&i?.hideCompany){const h=a.querySelector(".quote-header");if(h&&!h.dataset.dragReady){h.style.cursor="grab";let P=!1,G=0,S=Number(i.headerOffset||0);const A=re=>{P=!0,G=re.clientY||re.touches?.[0]?.clientY||0,S=Number(i.headerOffset||0),h.style.cursor="grabbing",a.addEventListener("mousemove",K),a.addEventListener("mouseup",L,{once:!0}),a.addEventListener("touchmove",K,{passive:!1}),a.addEventListener("touchend",L,{once:!0})},K=re=>{if(!P)return;const j=(re.clientY||re.touches?.[0]?.clientY||0)-G,O=Math.max(0,Math.min(240,S+j));h.style.marginTop=`${O}px`,i.headerOffset=O,re.preventDefault?.()},L=()=>{P=!1,h.style.cursor="grab",a.removeEventListener("mousemove",K),a.removeEventListener("touchmove",K)};h.addEventListener("mousedown",A),h.addEventListener("touchstart",A,{passive:!0}),h.dataset.dragReady="true"}}}catch{}No(a),An(a),en();const p=a?.querySelector(".quote-preview-pages"),b=Pt;let f=18;if(p&&a?.defaultView){const g=a.defaultView.getComputedStyle(p),h=parseFloat(g.rowGap||g.gap||`${f}`);Number.isFinite(h)&&h>=0&&(f=h)}const q=Lt,k=c.length?c.length*q+Math.max(0,(c.length-1)*f):q;if(e.dataset.baseWidth=String(b),e.dataset.baseHeight=String(k),e.style.width=`${b}px`,e.style.minWidth=`${b}px`,e.style.height=`${k}px`,e.style.minHeight=`${k}px`,w?.previewFrameWrapper&&!w?.userAdjustedZoom){const g=w.previewFrameWrapper.clientWidth-24;g>0&&g<b?Ke=Math.max(g/b,.3):Ke=1}Pa(Ke)}finally{$t()}},{once:!0})}function vs(e){if(!i)return;const t=e.currentTarget,n=t?.dataset?.sectionId;n&&(t.checked?i.sections.add(n):i.sections.delete(n),Ca(i),Ft(),Se())}function ws(e){if(!i)return;const t=e.currentTarget,n=t?.dataset?.sectionId,a=t?.dataset?.fieldId;if(!n||!a)return;const o=i.context||"reservation",u=i.fields||(i.fields=Et(o)),s=Fo(u,n);t.checked?s.add(a):s.delete(a),Ca(i),Se()}function qs(e){if(!i)return;const t=e.currentTarget,n=t?.dataset?.sectionId;n&&(Tn(i,n),i.sectionExpansions[n]=t.open)}function Ft(){if(!w?.toggles||!i)return;const{toggles:e}=w,t=i.fields||{},n=i.context||"reservation";Tn(i);const a=Jt(n),o=ca(n),u=a.map(({id:s,labelKey:c,fallback:p})=>{const b=r(c,p),f=i.sections.has(s),q=o[s]||[],k=Mo(i,s),g=q.length?`<div class="quote-toggle-sublist">
          ${q.map(h=>{const P=$n(t,s,h.id),G=f?"":"disabled",S=h.labelKey?r(h.labelKey,h.fallback):h.fallback;return`
              <label class="quote-toggle quote-toggle--field">
                <input type="checkbox" data-field-toggle data-section-id="${s}" data-field-id="${h.id}" ${P?"checked":""} ${G}>
                <span>${l(S)}</span>
              </label>
            `}).join("")}
        </div>`:"";return`
      <details class="quote-toggle-group" data-section-group data-section-id="${s}" ${k?"open":""}>
        <summary class="quote-toggle-summary">
          <label class="quote-toggle quote-toggle--section">
            <input type="checkbox" data-section-toggle data-section-id="${s}" ${f?"checked":""}>
            <span>${l(b)}</span>
          </label>
          ${q.length?'<span class="quote-toggle-caret" aria-hidden="true"></span>':""}
        </summary>
        ${g}
      </details>
    `}).join("");e.innerHTML=u,e.querySelectorAll("input[data-section-toggle]").forEach(s=>{s.addEventListener("change",vs)}),e.querySelectorAll("input[data-field-toggle]").forEach(s=>{s.addEventListener("change",ws)}),e.querySelectorAll("details[data-section-group]").forEach(s=>{s.addEventListener("toggle",qs)})}function Ss(){if(w?.modal)return w;const e=document.createElement("div");e.id="reservationQuoteModal",e.className="modal fade quote-preview-modal",e.tabIndex=-1,e.setAttribute("aria-labelledby","reservationQuoteModalLabel"),e.setAttribute("aria-hidden","true"),e.style.display="none",e.innerHTML=`
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="reservationQuoteModalLabel">${l(r("reservations.quote.previewTitle","Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¹Ø±Ø¶ Ø³Ø¹Ø±"))}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="quote-preview-layout">
            <aside class="quote-preview-sidebar">
              <h6>${l(r("reservations.quote.toggleHeading","Ø­Ø¯Ø¯ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø¯ ØªØµØ¯ÙŠØ±Ù‡Ø§"))}</h6>
              <div class="quote-toggle-list" data-quote-toggles></div>
              <div class="quote-meta-info" data-quote-meta></div>
              <div class="quote-terms-editor" data-quote-terms-editor>
                <label class="quote-terms-editor__label" for="quote-terms-input">${l(r("reservations.quote.termsEditor.title","Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø¹Ø§Ù…Ø© (Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„)"))}</label>
                <textarea id="quote-terms-input" class="quote-terms-editor__textarea" rows="6" data-quote-terms-input placeholder="${l(r("reservations.quote.termsEditor.placeholder","Ø§ÙƒØªØ¨ ÙƒÙ„ Ø´Ø±Ø· ÙÙŠ Ø³Ø·Ø± Ù…Ø³ØªÙ‚Ù„"))}"></textarea>
                <button type="button" class="quote-terms-reset" data-quote-terms-reset>${l(r("reservations.quote.termsEditor.reset","Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©"))}</button>
              </div>
            </aside>
            <section class="quote-preview-panel">
              <div class="quote-preview" data-quote-preview></div>
            </section>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-light" data-bs-dismiss="modal">${l(r("reservations.quote.actions.close","Ø¥ØºÙ„Ø§Ù‚"))}</button>
          <button type="button" class="btn btn-primary" data-quote-download>
            ${l(r("reservations.quote.actions.export","ðŸ“„ ØªÙ†Ø²ÙŠÙ„ PDF"))}
          </button>
        </div>
      </div>
    </div>
  `,document.body.appendChild(e);const t=e.querySelector("[data-quote-toggles]"),n=e.querySelector("[data-quote-preview]"),a=e.querySelector("[data-quote-meta]"),o=e.querySelector("[data-quote-terms-input]"),u=e.querySelector("[data-quote-terms-reset]"),s=e.querySelector("[data-quote-download]"),c=e.querySelector(".modal-header"),p=c?.querySelector(".btn-close"),b=Array.from(e.querySelectorAll('[data-bs-dismiss="modal"]')),f=document.createElement("div");f.className="quote-preview-header-actions",c&&c.insertBefore(f,p||null);const q=document.createElement("iframe");q.className="quote-preview-frame",q.setAttribute("title",r("reservations.quote.previewTitle","Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¹Ø±Ø¶ Ø³Ø¹Ø±")),q.setAttribute("loading","lazy"),q.setAttribute("frameborder","0");const k=document.createElement("div");k.className="quote-preview-zoom-controls",k.innerHTML=`
    <button type="button" class="quote-preview-zoom-btn" data-zoom-out title="${l(r("reservations.quote.zoom.out","ØªØµØºÙŠØ±"))}">âˆ’</button>
    <span class="quote-preview-zoom-value" data-zoom-value>100%</span>
    <button type="button" class="quote-preview-zoom-btn" data-zoom-in title="${l(r("reservations.quote.zoom.in","ØªÙƒØ¨ÙŠØ±"))}">+</button>
    <button type="button" class="quote-preview-zoom-btn" data-zoom-reset title="${l(r("reservations.quote.zoom.reset","Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¶Ø¨Ø·"))}">1:1</button>
  `;const g=document.createElement("div");g.className="quote-preview-zoom-controls quote-preview-drag-controls",g.innerHTML=`
    <button type="button" class="quote-preview-zoom-btn" data-block-drag-toggle title="${l(r("reservations.quote.drag.enable","ÙˆØ¶Ø¹ ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø¨Ù„ÙˆÙƒØ§Øª"))}" aria-label="${l(r("reservations.quote.drag.enable","ÙˆØ¶Ø¹ ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø¨Ù„ÙˆÙƒØ§Øª"))}">
      <span aria-hidden="true">â†•ï¸</span>
    </button>
    <button type="button" class="quote-preview-zoom-btn" data-block-drag-save disabled title="${l(r("reservations.quote.drag.save","ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ÙˆØ§Ø¶Ø¹"))}" aria-label="${l(r("reservations.quote.drag.save","ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ÙˆØ§Ø¶Ø¹"))}">
      <span aria-hidden="true">ðŸ’¾</span>
    </button>
    <button type="button" class="quote-preview-zoom-btn" data-block-drag-reset title="${l(r("reservations.quote.drag.resetBtn","ØªØµÙÙŠØ± Ø§Ù„Ù…ÙˆØ§Ø¶Ø¹"))}" aria-label="${l(r("reservations.quote.drag.resetBtn","ØªØµÙÙŠØ± Ø§Ù„Ù…ÙˆØ§Ø¶Ø¹"))}">
      <span aria-hidden="true">âŸ²</span>
    </button>
  `;const h=document.createElement("div");h.className="quote-preview-zoom-controls quote-preview-align-controls";const P=l(r("reservations.quote.align.customer","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„")),G=l(r("reservations.quote.align.reservation","ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²")),S=l(r("reservations.quote.align.project","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"));h.innerHTML=`
    <select class="quote-preview-align-select" data-align-target>
      <option value="customer">${P}</option>
      <option value="reservation">${G}</option>
      <option value="project">${S}</option>
    </select>
    <div class="quote-preview-align-buttons">
      <button type="button" class="quote-preview-zoom-btn" data-align-value="left" title="${l(r("reservations.quote.align.left","Ù…Ø­Ø§Ø°Ø§Ø© ÙŠØ³Ø§Ø±"))}">â¬…ï¸</button>
      <button type="button" class="quote-preview-zoom-btn" data-align-value="center" title="${l(r("reservations.quote.align.center","Ù…Ø­Ø§Ø°Ø§Ø© ÙˆØ³Ø·"))}">â†”ï¸</button>
      <button type="button" class="quote-preview-zoom-btn" data-align-value="right" title="${l(r("reservations.quote.align.right","Ù…Ø­Ø§Ø°Ø§Ø© ÙŠÙ…ÙŠÙ†"))}">âž¡ï¸</button>
    </div>
    <button type="button" class="quote-preview-zoom-btn" data-layout-export title="${l(r("reservations.quote.align.export","Ù†Ø³Ø® Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©"))}">ðŸ“‹</button>
  `;const A=document.createElement("div");A.className="quote-preview-frame-wrapper",A.appendChild(q),n.innerHTML="";const K=document.createElement("div");K.className="quote-preview-scroll",K.appendChild(A),n.appendChild(K);const L=document.createElement("div");L.className="quote-preview-status",L.setAttribute("role","status"),L.setAttribute("aria-live","polite"),L.hidden=!0,L.innerHTML=`
    <span class="quote-preview-spinner" data-quote-status-spinner aria-hidden="true"></span>
    <span data-quote-status-text>${l(pa("render"))}</span>
    <button type="button" class="quote-preview-status-action" data-quote-status-action hidden></button>
  `,n.appendChild(L),f.appendChild(k),f.appendChild(g),f.appendChild(h),s?.addEventListener("click",async()=>{if(i){s.disabled=!0;try{await La()}finally{s.disabled=!1}}});const re=()=>{pn()||mn(e)};b.forEach(V=>{V?.addEventListener("click",re)}),p&&!b.includes(p)&&p.addEventListener("click",re),e.addEventListener("click",V=>{pn()||V.target===e&&mn(e)}),w={modal:e,toggles:t,preview:n,previewScroll:K,previewFrameWrapper:A,zoomControls:k,zoomValue:k.querySelector("[data-zoom-value]"),previewFrame:q,meta:a,downloadBtn:s,statusIndicator:L,statusText:L.querySelector("[data-quote-status-text]"),statusSpinner:L.querySelector("[data-quote-status-spinner]"),statusAction:L.querySelector("[data-quote-status-action]"),termsInput:o,termsReset:u,statusKind:null,userAdjustedZoom:!1,blockDragToggle:g.querySelector("[data-block-drag-toggle]"),blockDragSave:g.querySelector("[data-block-drag-save]"),blockDragReset:g.querySelector("[data-block-drag-reset]"),alignTarget:h.querySelector("[data-align-target]"),alignButtons:Array.from(h.querySelectorAll("[data-align-value]")),layoutExportBtn:h.querySelector("[data-layout-export]")};const x=k.querySelector("[data-zoom-out]"),j=k.querySelector("[data-zoom-in]"),O=k.querySelector("[data-zoom-reset]");return x?.addEventListener("click",()=>Yn(-.1)),j?.addEventListener("click",()=>Yn(.1)),O?.addEventListener("click",()=>Gt(1,{markManual:!0})),w.blockDragToggle?.addEventListener("click",()=>_o(!bt)),w.blockDragSave?.addEventListener("click",xo),w.blockDragReset?.addEventListener("click",$o),w.alignTarget?.addEventListener("change",()=>en()),(w.alignButtons||[]).forEach(V=>{V.addEventListener("click",()=>{const Y=w.alignTarget?.value||"customer",F=V.dataset.alignValue||"right";Co(Y,F)})}),w.layoutExportBtn?.addEventListener("click",Eo),Zt(),Fa(),o&&o.addEventListener("input",As),u&&u.addEventListener("click",ks),Gt(Ke),w}function Gt(e,{silent:t=!1,markManual:n=!1}={}){Ke=Math.min(Math.max(e,.25),2.2),n&&w&&(w.userAdjustedZoom=!0),Pa(Ke),!t&&w?.zoomValue&&(w.zoomValue.textContent=`${Math.round(Ke*100)}%`)}function Yn(e){Gt(Ke+e,{markManual:!0})}function Pa(e){if(!w?.previewFrame||!w.previewFrameWrapper)return;const t=w.previewFrame,n=w.previewFrameWrapper,a=Number(t.dataset.baseWidth)||794,o=Number(t.dataset.baseHeight)||t.contentDocument?.body?.scrollHeight||1123;t.style.transform=`scale(${e})`,t.style.transformOrigin="top center",jn()?(n.style.width="100%",n.style.maxWidth="100%",n.style.minWidth="0"):(n.style.width=`${a}px`,n.style.maxWidth=`${a}px`,n.style.minWidth=`${a}px`),n.style.minHeight=`${o}px`,n.style.height=`${o}px`}function Mt(){if(!w?.meta||!i)return;const{meta:e}=w;(i.context||"reservation")==="reservationChecklist"?e.innerHTML=`
      <div class="quote-meta-card">
        <div><span>${l(r("reservations.quote.labels.dateGregorian","Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ"))}</span><strong>${l(i.quoteDateLabel)}</strong></div>
      </div>
    `:e.innerHTML=`
      <div class="quote-meta-card">
        <div><span>${l(r("reservations.quote.labels.number","Ø±Ù‚Ù… Ø¹Ø±Ø¶ Ø³Ø¹Ø±"))}</span><strong>${l(i.quoteNumber)}</strong></div>
        <div><span>${l(r("reservations.quote.labels.dateGregorian","Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ"))}</span><strong>${l(i.quoteDateLabel)}</strong></div>
      </div>
    `}function Ln(){if(!w?.termsInput)return;const e=(i?.terms&&i.terms.length?i.terms:je).join(`
`);w.termsInput.value!==e&&(w.termsInput.value=e)}function As(e){if(!i)return;const t=ln(e?.target?.value??"");if(t.length){i.terms=t;const n=document.getElementById("reservation-terms");n&&(n.value=e.target.value);const a=document.getElementById("edit-res-terms");a&&(a.value=e.target.value)}else{i.terms=[...je],Ln();const n=je.join(`
`),a=document.getElementById("reservation-terms");a&&(a.value=n);const o=document.getElementById("edit-res-terms");o&&(o.value=n)}Se()}function ks(e){if(e?.preventDefault?.(),!i)return;i.terms=[...je];const t=document.getElementById("reservation-terms");t&&(t.value=je.join(`
`));const n=document.getElementById("edit-res-terms");n&&(n.value=je.join(`
`)),Ln(),Se()}async function La(){if(!i)return;ct("export");const t=!jn()&&ka(),n=nn(),a=null,o=!n&&t?window.open("","_blank"):null;(p=>{if(p)try{p.document.open(),p.document.write(`<!DOCTYPE html><html lang="ar" dir="rtl"><head><meta charset="utf-8"><title>${l(r("reservations.quote.status.exporting","Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ù…Ù„Ù PDF..."))}</title><style>body{font-family:'Tajawal',sans-serif;margin:0;height:100vh;display:flex;align-items:center;justify-content:center;background:#0f172a;color:#f8fafc;text-align:center;padding:24px;} .loader{width:42px;height:42px;border-radius:50%;border:4px solid rgba(248,250,252,0.35);border-top-color:#38bdf8;animation:spin 1s linear infinite;margin:0 auto 18px;}@keyframes spin{to{transform:rotate(360deg);}} h1{margin:0 0 6px;font-size:1.05rem;} p{margin:0;font-size:0.9rem;opacity:0.8;}</style></head><body><div><div class="loader" aria-hidden="true"></div><h1>${l(r("reservations.quote.status.exporting","Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ù…Ù„Ù PDF..."))}</h1><p>${l(r("reservations.quote.status.exportingHint","Ù‚Ø¯ ÙŠØ³ØªØºØ±Ù‚ Ø°Ù„Ùƒ Ø¨Ø¶Ø¹ Ø«ÙˆØ§Ù†ÙØŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±..."))}</p></div></body></html>`),p.document.close()}catch(b){Xe("failed to prime download window",b)}})(o);let s=null;const c=r("reservations.quote.errors.browserLimit","ØªØ¹Ø°Ø± Ø¥ØªÙ…Ø§Ù… Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ø³Ø¨Ø¨ Ù‚ÙŠÙˆØ¯ Ø§Ù„Ù…ØªØµÙØ­ØŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø£Ùˆ ØªÙ‚Ù„ÙŠÙ„ Ø­Ø¬Ù… Ø§Ù„Ù…Ø­ØªÙˆÙ‰.");try{await ts(),rn("html2pdf ensured");const p=i.context||"reservation",b=Na({context:p,reservation:i.reservation,customer:i.customer,project:i.project,crewAssignments:i.crewAssignments,totals:i.totals,totalsDisplay:i.totalsDisplay,rentalDays:i.rentalDays,currencyLabel:i.currencyLabel,sections:i.sections,fieldSelections:i.fields,quoteNumber:i.quoteNumber,quoteDate:i.quoteDateLabel,terms:i.terms,checklistType:i.checklistType,checklistNotes:i.checklistNotes,checklistNotesTitle:i.checklistNotesTitle,hideLogo:!!i.hideLogo,hideCompany:!!i.hideCompany,headerOffset:Number(i.headerOffset||0),projectCrew:i.projectCrew,projectExpenses:i.projectExpenses,projectEquipment:i.projectEquipment,projectInfo:i.projectInfo,clientInfo:i.clientInfo,paymentSummary:i.paymentSummary,projectTotals:i.projectTotals,blockOffsets:i.blockOffsets,infoAlignments:i.infoAlignments});s=document.createElement("div"),s.innerHTML=b,Object.assign(s.style,{position:"fixed",top:"0",left:"0",pointerEvents:"none",zIndex:"-1"}),document.body.appendChild(s),aa(s),oa(s),sa(s),rn("export container prepared");const f=s.firstElementChild;if(f){try{const k=typeof ie=="function"?ie():f.getAttribute("data-lang")||"ar",h=i?.context==="reservationChecklist"&&k==="en"?"ltr":"rtl";f.setAttribute("dir",h),f.style.direction=h,f.setAttribute("data-lang",k),f.style.textAlign=""}catch{}f.setAttribute("data-theme","light"),f.classList.remove("dark","dark-mode"),f.style.margin="0",f.style.padding="0",f.style.width="210mm",f.style.maxWidth="210mm",f.style.marginLeft="auto",f.style.marginRight="auto",f.scrollTop=0,f.scrollLeft=0;try{await Vt(f,{context:"export"}),await Ia(120),Da(f)&&await Vt(f,{context:"export"}),await Ct(f),Pn(f),rn("layout complete for export document")}catch(k){fn(k,"layoutQuoteDocument",{suppressToast:!0})}}const q=p==="reservationChecklist"?(()=>{const k=i?.reservation?.reservationCode||i?.reservation?.reservationId||i?.reservation?.id||"res",g=i?.checklistType==="crew"?"crew":i?.checklistType==="both"?"equipment-crew":"equipment";return`checklist-${String(k)}-${g}.pdf`})():`quotation-${i.quoteNumber}.pdf`;await gs(f,{filename:q,safariWindowRef:o,mobileWindowRef:a})}catch(p){yn({container:s,safariWindowRef:o,mobileWindowRef:a}),s=null,fn(p,"exportQuoteAsPdf",{toastMessage:c})}finally{s&&s.parentNode&&s.parentNode.removeChild(s),$t()}}function Fn(){const e=Ss();if(e?.modal){if(At=!1,Ke=1,w&&(w.userAdjustedZoom=!1),Gt(Ke,{silent:!0}),i?.context==="reservationChecklist")try{const t=e.modal.querySelector("#reservationQuoteModalLabel"),n=e.modal.querySelector(".quote-preview-sidebar"),a=e.modal.querySelector("[data-quote-terms-editor]");a&&(a.style.display="none");let o=n.querySelector("[data-checklist-controls]");if(!o){o=document.createElement("div"),o.setAttribute("data-checklist-controls","");const u=l(r("reservations.checklist.controls.items","Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª")),s=l(r("reservations.checklist.controls.crew","Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ")),c=l(r("reservations.checklist.controls.both","Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙˆØ§Ù„Ø·Ø§Ù‚Ù… Ø§Ù„ÙÙ†ÙŠ")),p=l(r("reservations.checklist.controls.hideLogo","Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø´Ø¹Ø§Ø±")),b=l(r("reservations.checklist.controls.hideCompany","Ø¥Ø®ÙØ§Ø¡ Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©")),f=l(r("reservations.checklist.controls.notes.title","Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù„Ø³ØªØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)")),q=l(r("reservations.checklist.controls.notes.placeholder","Ø§ÙƒØªØ¨ Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø®Ø§ØµØ© Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ù„Ø³ØªØ©")),k=typeof ie=="function"?ie():"ar",g=l(k==="en"?r("language.toggle.labelAr","ðŸ‡¸ðŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"):r("language.toggle.labelEn","ðŸ‡¬ðŸ‡§ English"));o.innerHTML=`
          <div class="quote-meta-card" style="margin-bottom:10px">
            <div style="display:flex;gap:10px;flex-wrap:wrap">
              <label style="display:flex;align-items:center;gap:6px">
                <input type="radio" name="checklist-type" value="items" checked>
                <span data-i18n data-i18n-key="reservations.checklist.controls.items">${u}</span>
              </label>
              <label style="display:flex;align-items:center;gap:6px">
                <input type="radio" name="checklist-type" value="crew">
                <span data-i18n data-i18n-key="reservations.checklist.controls.crew">${s}</span>
              </label>
              <label style="display:flex;align-items:center;gap:6px">
                <input type="radio" name="checklist-type" value="both">
                <span data-i18n data-i18n-key="reservations.checklist.controls.both">${c}</span>
              </label>
            </div>
          </div>
          <div class="quote-meta-card" style="margin-bottom:10px">
            <div style="display:flex;gap:8px;flex-wrap:wrap">
              <button type="button" class="btn btn-sm btn-light" data-checklist-lang>${g}</button>
              <label style="display:flex;align-items:center;gap:6px">
                <input type="checkbox" data-checklist-hide-logo>
                <span data-i18n data-i18n-key="reservations.checklist.controls.hideLogo">${p}</span>
              </label>
              <label style="display:flex;align-items:center;gap:6px">
                <input type="checkbox" data-checklist-hide-company>
                <span data-i18n data-i18n-key="reservations.checklist.controls.hideCompany">${b}</span>
              </label>
            </div>
          </div>
          <div class="quote-terms-editor" data-checklist-notes>
            <label class="quote-terms-editor__label" for="checklist-notes-title-input" data-i18n data-i18n-key="reservations.checklist.controls.notes.titleLabel">${l(r("reservations.checklist.controls.notes.titleLabel","Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª"))}</label>
            <input id="checklist-notes-title-input" class="quote-terms-editor__input" type="text" value="${l(r("reservations.checklist.controls.notes.sectionTitleDefault","Ù…Ù„Ø§Ø­Ø¸Ø§Øª"))}" data-i18n-value-key="reservations.checklist.controls.notes.sectionTitleDefault">
            <label class="quote-terms-editor__label" for="checklist-notes-input" data-i18n data-i18n-key="reservations.checklist.controls.notes.title">${f}</label>
            <textarea id="checklist-notes-input" class="quote-terms-editor__textarea" rows="4" data-i18n-placeholder-key="reservations.checklist.controls.notes.placeholder" placeholder="${q}"></textarea>
          </div>
        `,n.prepend(o),o.querySelectorAll('input[name="checklist-type"]').forEach(x=>{x.addEventListener("change",()=>{const j=o.querySelector('input[name="checklist-type"]:checked')?.value||"items";i.checklistType=j==="crew"||j==="both"?j:"items";const O=new Set(["customerInfo","reservationInfo","projectInfo","notes"]);if(i.checklistType==="crew"?O.add("crew"):i.checklistType==="both"?(O.add("items"),O.add("crew")):O.add("items"),i.sections=O,t){const V=ie?.()||"ar",Y=i.checklistType==="crew"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ":i.checklistType==="both"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙˆØ§Ù„Ø·Ø§Ù‚Ù… Ø§Ù„ÙÙ†ÙŠ":"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",F=i.checklistType==="crew"?"Crew List":i.checklistType==="both"?"Equipment & Crew List":"Equipment List";t.textContent=V==="en"?F:Y}Ft(),Mt(),Se()})});const P=o.querySelector("#checklist-notes-input"),G=o.querySelector("#checklist-notes-title-input"),S=()=>{try{const x=ie?.()||"ar",j=x==="en"?"ltr":"rtl",O=x==="en"?"left":"right";P&&(P.setAttribute("dir",j),P.style.textAlign=O),G&&(G.setAttribute("dir",j),G.style.textAlign=O)}catch{}};S();try{const x=()=>S();document.addEventListener("language:changed",x),o._onLangChanged=x}catch{}P.addEventListener("input",x=>{i.checklistNotes=String(x.target.value||""),Se()}),G.addEventListener("input",x=>{i.checklistNotesTitle=String(x.target.value||""),Se()});const A=o.querySelector("[data-checklist-lang]");if(A){const x=()=>{const j=ie?.()||"ar";A.textContent=j==="ar"?"ðŸ‡¬ðŸ‡§ English":"ðŸ‡¸ðŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"};x(),A.addEventListener("click",()=>{const O=(ie?.()||"ar")==="ar"?"en":"ar";try{Ua?.(O)}catch{}if(x(),S(),t){const V=ie?.()||"ar",Y=i.checklistType,F=Y==="crew"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ":Y==="both"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙˆØ§Ù„Ø·Ø§Ù‚Ù… Ø§Ù„ÙÙ†ÙŠ":"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",v=Y==="crew"?"Crew List":Y==="both"?"Equipment & Crew List":"Equipment List";t.textContent=V==="en"?v:F}Ft(),Mt(),Se()})}const K=o.querySelector("[data-checklist-hide-logo]"),L=o.querySelector("[data-checklist-hide-company]");(()=>{K&&(K.checked=!!i.hideLogo),L&&(L.checked=!!i.hideCompany)})(),K?.addEventListener("change",x=>{i.hideLogo=!!x.target.checked,Se()}),L?.addEventListener("change",x=>{i.hideCompany=!!x.target.checked,Se()})}t&&(t.textContent=i.checklistType==="crew"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ":"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª");try{e.previewFrame?.setAttribute("title","Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù„Ø³ØªØ©")}catch{}}catch{}Ft(),Mt(),Ln(),Se(),Po(e.modal)}}async function Ps({reservation:e,customer:t,project:n}){if(!e){ot(r("reservations.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø²"));return}await Dn();const a=an(e),{totalsDisplay:o,totals:u,rentalDays:s}=In(e,a,n),c=r("reservations.create.summary.currency","SR"),b=(g=>{if(!g)return"1";const P=[g.reservationCode,g.reservation_code,g.reservationId,g.reservation_id,g.id].find(A=>A!=null&&String(A).trim()!==""),G=T(String(P??"1"));return G.replace(/\D+/g,"")||G||"1"})(e),f=Number.parseInt(b,10)||1,q=new Date,k=co();i={context:"reservation",reservation:e,customer:t,project:n,crewAssignments:a,totals:u,totalsDisplay:o,rentalDays:s,currencyLabel:c,projectCrew:[],projectExpenses:[],projectEquipment:[],sections:new Set(Jt("reservation").filter(g=>g.defaultSelected).map(g=>g.id)),sectionExpansions:tn("reservation"),fields:Et("reservation"),terms:k,quoteSequence:f,quoteNumber:b,quoteDate:q,quoteDateLabel:Nn(q),sequenceCommitted:!1},jt=!1,En(i),Sn(i),_n(i),Fn();try{gn()}catch{}}async function Ls({reservation:e,customer:t,project:n}){if(!e){ot(r("reservations.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø²"));return}await Dn();const a=an(e),{totalsDisplay:o,totals:u,rentalDays:s}=In(e,a,n),c=r("reservations.create.summary.currency","SR"),p=new Date;i={context:"reservationChecklist",reservation:e,customer:t,project:n,crewAssignments:a,totals:u,totalsDisplay:o,rentalDays:s,currencyLabel:c,checklistType:"items",checklistNotes:"",projectCrew:[],projectExpenses:[],projectEquipment:[],sections:new Set(["customerInfo","reservationInfo","projectInfo","notes","items"]),sectionExpansions:tn("reservationChecklist"),fields:Et("reservationChecklist"),terms:[],quoteDate:p,quoteDateLabel:Nn(p),sequenceCommitted:!1},jt=!1,En(i),Sn(i),_n(i),Fn();try{gn()}catch{}}async function Fs({project:e}){if(!e){ot(r("projects.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"));return}await Dn();let t=Wn(e);const{project:n}=t;if(!n){ot(r("projects.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"));return}try{(!Array.isArray(t.equipmentItems)||t.equipmentItems.length===0)&&n?.id!=null&&(await Wa({project_id:n.id}),t=Wn(n))}catch(p){console.warn("[reservationPdf] refreshReservationsForProject failed, proceeding with snapshot/state",p)}const o=(p=>{if(!p)return"1";const f=[p.projectCode,p.project_code,p.code,p.id].find(g=>g!=null&&String(g).trim()!==""),q=T(String(f??"1"));return q.replace(/\D+/g,"")||q||"1"})(n),u=Number.parseInt(o,10)||1,s=new Date,c=[...lo];i={context:"project",reservation:null,customer:t.customer,project:n,technicians:t.crew||[],clientInfo:t.clientInfo,projectInfo:t.projectInfo,projectCrew:t.crew,projectExpenses:t.expenses,projectEquipment:t.equipment,equipmentItems:t.equipmentItems||[],crewAssignments:t.crewAssignments||[],totals:t.totals,projectTotals:t.projectTotals,totalsDisplay:t.totalsDisplay,rentalDays:t.projectDurationDays,currencyLabel:t.currencyLabel,sections:new Set(Jt("project").filter(p=>p.defaultSelected).map(p=>p.id)),sectionExpansions:tn("project"),fields:Et("project"),terms:c,quoteSequence:u,quoteNumber:o,quoteDate:s,quoteDateLabel:Nn(s),sequenceCommitted:!1,paymentSummary:t.paymentSummary,projectNotes:t.notes,paymentHistory:t.paymentHistory},jt=!1,En(i),Sn(i),_n(i),Fn();try{gn()}catch{}}function _s(e="reservation"){return e==="project"?[{value:"projectCustomer",label:r("projects.quote.sections.customer","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„")},{value:"projectDetails",label:r("projects.quote.sections.project","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹")}]:[{value:"customer",label:r("reservations.quote.sections.customer","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„")},{value:"reservation",label:r("reservations.quote.sections.reservation","ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²")},{value:"project",label:r("reservations.quote.sections.project","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹")}]}function Fa(){if(!w?.alignTarget)return;const e=i?.context||"reservation",t=_s(e),n=w.alignTarget,a=n.value;n.innerHTML=t.map(o=>`<option value="${l(o.value)}">${l(o.label)}</option>`).join(""),t.some(o=>o.value===a)?n.value=a:n.value=t[0]?.value||"",en()}export{Ps as a,Ls as b,Fs as e,Is as g,ra as r,Ds as s};
