const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./reports.DWlTpW15.js","./auth.MErpxXfv.js","./auth.C3tDudva.css","./reservationsService.1HlxTCjI.js","./maintenanceService.CI67kBBJ.js","./controller.OzgU2N27.js","./calendar.DrYH2Ori.js","./maintenance.Dq4evXJx.js","./dashboardMetrics.DBOIOB-M.js"])))=>i.map(i=>d[i]);
import{G as De,H as ve,I as ye,J as he,c as N,e as Me,y as $e,x as Ie,K as Se,L as Te,N as je,Q as re,R as qe,S as Ee,a as ke,X as le,Y as Ue,Z as Ve,_ as Oe,$ as ze,g as He,w as We,h as Ye,T as Ge,U as Ke,V as Qe,W as Je}from"./controller.OzgU2N27.js";import{l as M,o as x,x as H,w as Xe,v as Ze,a as W,d as et,t as p,n as T,s as k,e as tt,h as nt,i as at,j as it}from"./auth.MErpxXfv.js";/* empty css              */import{i as rt}from"./dashboardShell.QPLIGyWt.js";import{r as ot}from"./customers.BB5dMOSf.js";import{ah as st,ag as ct,ai as ut,A as Ae,M as lt}from"./reservationsService.1HlxTCjI.js";const dt="modulepreload",ft=function(e,t){return new URL(e,t).href},de={},$=function(t,a,o){let c=Promise.resolve();if(a&&a.length>0){let m=function(l){return Promise.all(l.map(u=>Promise.resolve(u).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};const s=document.getElementsByTagName("link"),i=document.querySelector("meta[property=csp-nonce]"),d=i?.nonce||i?.getAttribute("nonce");c=m(a.map(l=>{if(l=ft(l,o),l in de)return;de[l]=!0;const u=l.endsWith(".css"),f=u?'[rel="stylesheet"]':"";if(o)for(let v=s.length-1;v>=0;v--){const S=s[v];if(S.href===l&&(!u||S.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${f}`))return;const b=document.createElement("link");if(b.rel=u?"stylesheet":dt,u||(b.as="script"),b.crossOrigin="",b.href=l,d&&b.setAttribute("nonce",d),document.head.appendChild(b),u)return new Promise((v,S)=>{b.addEventListener("load",v),b.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${l}`)))})}))}function n(s){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=s,window.dispatchEvent(i),!i.defaultPrevented)throw s}return c.then(s=>{for(const i of s||[])i.status==="rejected"&&n(i.reason);return t().catch(n)})};let Z=!1;function bt(){document.querySelectorAll('input[type="time"]').forEach(t=>{t.setAttribute("step","300")})}function mt(){return typeof window<"u"&&typeof window.flatpickr=="function"?window.flatpickr.bind(window):typeof globalThis<"u"&&typeof globalThis.flatpickr=="function"?globalThis.flatpickr.bind(globalThis):(console.warn("âš ï¸ Flatpickr ØºÙŠØ± Ù…ØªØ§Ø­ - Ø³ÙŠØªÙ… ØªØ®Ø·ÙŠ ØªÙ‡ÙŠØ¦Ø© Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ§Ø±ÙŠØ®"),null)}function pt(){const e=mt(),t={dateFormat:"Y-m-d",altInput:!0,altFormat:"Y-m-d",allowInput:!0,disableMobile:!0,altInputClass:"flatpickr-alt-input form-control"},a=[["#res-start",{}],["#res-end",{}],["#filter-start-date",{}],["#filter-end-date",{}],["#edit-res-start",{}],["#edit-res-end",{}]],o={enableTime:!0,noCalendar:!0,dateFormat:"H:i",altInput:!0,altFormat:"h:i K",time_24hr:!1,defaultHour:9,defaultMinute:0,disableMobile:!0,minuteIncrement:5,altInputClass:"flatpickr-alt-input form-control"},c=["#res-start-time","#res-end-time","#edit-res-start-time","#edit-res-end-time"];e&&(a.forEach(([s,i])=>{document.querySelector(s)&&e(s,{...t,...i})}),c.forEach(s=>{document.querySelector(s)&&e(s,{...o})}));const n=document.querySelector("#res-start-time");n&&n.dispatchEvent(new Event("change",{bubbles:!0}))}function oe(){if(!Z){bt(),De(()=>N()),ve(qe()),st({onDraftChange:Ee,onEditChange:re}),ye(),he(),Z=!0;try{const e=()=>N();document.addEventListener("reservations:updated",e),window.addEventListener("reservations:updated",e)}catch{}}}function gt(){const e=document.body;e&&e.dataset.reservationsTechListener!=="true"&&(document.addEventListener("technicians:updated",()=>{const{technicians:t=[]}=M();ct(t),je(),re()}),e.dataset.reservationsTechListener="true")}async function vt(){await Me();try{await $e({force:!0})}catch(e){console.warn("âš ï¸ [reservations/events] Failed to pre-load projects for reservation form",e)}N(),Ie(),Se({onAfterSubmit:Te}),Z||oe(),pt(),gt()}const yt=Object.freeze(Object.defineProperty({__proto__:null,confirmReservation:Ke,deleteReservation:Ge,getReservationsEditContext:qe,handleReservationsMutation:Te,initCreateReservationForm:Se,initializeReservationUI:vt,loadReservationForm:ye,openReservationEditor:Qe,registerReservationGlobals:Ie,renderDraftReservationSummary:Ee,renderReservations:N,setFlatpickrValue:Je,setupEditReservationModalEvents:ve,setupEquipmentDescriptionInputs:he,setupReservationEvents:oe,showReservationDetails:Ye,updateEditReservationSummary:re},Symbol.toStringTag,{value:"Module"})),ht={},ee="__ART_RATIO_LAST_DASHBOARD_TAB__",A="__ART_RATIO_LAST_DASHBOARD_SUB_TAB__",Y="create-tab",we=/^[a-z0-9\-]+$/i,It=typeof import.meta<"u"&&ht&&!1;function g(...e){It&&console.log(...e)}function te(e){if(!(!e||typeof e.scrollIntoView!="function"))try{const t=e.closest("[data-tab-scroll-track]");if(!t)return;const a={behavior:"smooth",block:"nearest",inline:"center"};e.scrollIntoView(a);const o=t.closest("[data-tab-scroll]");o&&window.requestAnimationFrame(()=>{o.dispatchEvent(new CustomEvent("tabScroll:update",{bubbles:!0}))})}catch(t){console.warn("âš ï¸ [tabs.js] Failed to keep tab visible",t)}}function R(e){try{if(typeof window>"u"||!window.localStorage)return null;const t=window.localStorage.getItem(e);return!t||!we.test(t)?null:t}catch(t){return console.warn("âš ï¸ [tabs.js] Failed to read stored tab",t),null}}function ne(e,t){try{if(typeof window>"u"||!window.localStorage)return;if(!t||!we.test(t)){window.localStorage.removeItem(e);return}window.localStorage.setItem(e,t)}catch(a){console.warn("âš ï¸ [tabs.js] Failed to persist tab",a)}}function _e(e){try{if(typeof window>"u"||!window.localStorage)return;window.localStorage.removeItem(e)}catch(t){console.warn("âš ï¸ [tabs.js] Failed to clear stored tab",t)}}let B=null,q=null,L=!1,I=null,fe=null,P=null,ae=null,F=null,U=null,K=null,Q=null,J=null,be=!1;function St(){return U||(U=$(()=>import("./reports.DWlTpW15.js"),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url).then(e=>{try{typeof e.initReports=="function"&&e.initReports()}catch(t){console.error("âŒ [tabs.js] Failed to initialise reports module",t)}return e}).catch(e=>{throw console.error("âŒ [tabs.js] Failed to load reports module",e),U=null,e})),U}function Be(){return K||(K=$(()=>Promise.resolve().then(()=>yt),void 0,import.meta.url)),K}function Tt(){return Q||(Q=$(()=>import("./calendar.DrYH2Ori.js"),__vite__mapDeps([6,3,1,2,5]),import.meta.url)),Q}function qt(){return J||(J=$(()=>import("./maintenance.Dq4evXJx.js"),__vite__mapDeps([7,1,2,5,3,4]),import.meta.url)),J}function Et(){g("ğŸš€ [tabs.js] setupTabs()");const e=Array.from(document.querySelectorAll("[data-tab]")),t=document.querySelectorAll(".tab-content-wrapper > .tab");g("ğŸ“Œ tabButtons:",e),g("ğŸ“Œ tabContents:",t);const a=(n,{skipStore:s=!1,skipRender:i=!1}={})=>{if(!n)return;const d=e.filter(l=>l?.getAttribute("data-tab")===n),m=document.getElementById(n);if(!(!d.length||!m)&&(e.forEach(l=>{const u=l?.getAttribute("data-tab")===n;l.classList.toggle("active",u),u?(l.setAttribute("aria-selected","true"),l.setAttribute("tabindex","0"),te(l)):(l.setAttribute("aria-selected","false"),l.setAttribute("tabindex","-1"))}),t.forEach(l=>{const u=l.id===n;l.style.display=u?"block":"none",l.classList.toggle("active",u)}),B=n,ne(ee,n),typeof document<"u"&&document.dispatchEvent(new CustomEvent("dashboard:tabChanged",{detail:{tabId:n}})),s||x({dashboardTab:n}).catch(l=>{console.warn("âš ï¸ [tabs.js] Failed to store dashboard tab preference",l)}),n!=="reservations-tab"&&(q=null,I=null,_e(A),s||x({dashboardSubTab:null}).catch(l=>{console.warn("âš ï¸ [tabs.js] Failed to clear sub-tab preference",l)})),!i&&n==="customers-tab"&&(g("ğŸ‘¤ Rendering customers"),ot()),!i&&n==="equipment-tab"&&(g("ğŸ“¦ Rendering equipment"),ke()),!i&&n==="maintenance-tab"&&(g("ğŸ› ï¸ Rendering maintenance"),qt().then(l=>{try{l.renderMaintenance?.()}catch(u){console.error("âŒ [tabs.js] Failed to render maintenance",u)}}).catch(l=>console.error("âŒ [tabs.js] Unable to load maintenance module",l))),!i&&n==="technicians-tab"&&(g("ğŸ› ï¸ Rendering technicians"),ut()),n==="reservations-tab")){if(g("ğŸ“… Rendering reservations"),!i){try{oe()}catch{}try{N()}catch{}Be().then(async l=>{try{!be&&typeof l.initializeReservationUI=="function"&&(await l.initializeReservationUI(),be=!0)}catch(u){console.error("âŒ [tabs.js] Failed to initialise reservations UI",u)}}).catch(l=>console.error("âŒ [tabs.js] Unable to load reservations UI module",l))}if(!I){const l=R(A);I=q||l||Y}kt(),I&&(V(I),I=null)}};ae=a,e.forEach(n=>{n&&(n.getAttribute("type")||n.setAttribute("type","button"),n.setAttribute("role","tab"),n.hasAttribute("tabindex")||n.setAttribute("tabindex",n.classList.contains("active")?"0":"-1"),n.addEventListener("click",()=>{const s=n.getAttribute("data-tab");if(g("ğŸ–±ï¸ Tab clicked:",s),a(s),s==="reservations-tab"){const i=q||R(A)||Y;typeof P=="function"?P(i):I=i}else x({dashboardSubTab:null}).catch(i=>{console.warn("âš ï¸ [tabs.js] Failed to clear sub-tab preference",i)})}))});const o=n=>{const s=document.querySelector("[data-tab].active"),i=R(ee),d=e[0]?.getAttribute("data-tab")||null,l=[n?.dashboardTab,i,B,s?.getAttribute("data-tab"),d].filter(Boolean).find(b=>document.getElementById(b))||d;l&&(!L||l!==B)&&(g("â­ Initial tab:",l),a(l,{skipStore:!0}));const f=[n?.dashboardSubTab,R(A)].filter(Boolean).find(b=>document.getElementById(b));f&&(B==="reservations-tab"&&typeof P=="function"?(!L||f!==q)&&P(f,{skipStore:!0}):I=f),L||(document.body?.classList.remove("tabs-loading"),document.body?.classList.remove("no-js"),L=!0)},c=typeof H=="function"?H():null;o(c||null),Xe().then(n=>o(n||null)).catch(n=>{console.warn("âš ï¸ [tabs.js] Failed to load tab preferences",n),o(null)}),fe||(fe=Ze(n=>{if(!(!L||!n))if(n.dashboardTab&&n.dashboardTab!==B&&a(n.dashboardTab,{skipStore:!0}),B==="reservations-tab"){if(n.dashboardSubTab&&n.dashboardSubTab!==q)V(n.dashboardSubTab);else if(!n.dashboardSubTab&&q){const s=R(A);s?s!==q&&V(s):V(null)}}else n.dashboardSubTab&&(I=n.dashboardSubTab)}))}function kt(){g("ğŸš€ [tabs.js] setupSubTabs()");const e=document.querySelectorAll("#reservations-tab .sub-tab-button"),t=document.querySelectorAll("#reservations-tab .sub-tab");if(g("ğŸ“Œ subTabButtons:",e),g("ğŸ“Œ subTabContents:",t),!e.length){console.warn("âš ï¸ [tabs.js] No reservation sub-tab buttons found");return}const a=Array.from(e).map(n=>n?.getAttribute("data-sub-tab")).filter(n=>typeof n=="string"&&n.trim().length>0),o=()=>a.length?a.includes(Y)?Y:a[0]:null,c=(n,{skipStore:s=!1}={})=>{if(!a.length)return;let i=n;(!i||!a.includes(i))&&(console.warn("âš ï¸ [tabs.js] Invalid sub-tab target, falling back to first available",{requested:i,available:a}),i=o());const d=document.querySelector(`#reservations-tab .sub-tab-button[data-sub-tab="${i}"]`),m=document.getElementById(i);if(!d||!m){console.warn("âš ï¸ [tabs.js] Unable to locate sub-tab button/content after fallback",{target:i});return}if(q===i&&d.classList.contains("active")&&m.classList.contains("active")&&m.getAttribute("aria-hidden")==="false"){m.removeAttribute("hidden"),m.style.display="block",m.setAttribute("aria-hidden","false"),q=i,te(d),s||(ne(A,i),x({dashboardSubTab:i}).catch(u=>{console.warn("âš ï¸ [tabs.js] Failed to store sub-tab preference",u)}));return}e.forEach(u=>{u.classList.remove("active"),u.classList.contains("tab")&&u.classList.remove("tab-active"),u.setAttribute("aria-selected","false"),u.setAttribute("tabindex","-1")}),d.classList.add("active"),d.classList.contains("tab")&&d.classList.add("tab-active"),d.setAttribute("aria-selected","true"),d.setAttribute("tabindex","0"),te(d),t.forEach(u=>{const f=u.id===i;u.classList.toggle("active",f),u.setAttribute("aria-hidden",f?"false":"true"),f?(u.removeAttribute("hidden"),u.style.display="block"):(u.setAttribute("hidden",""),u.style.display="none")}),q=i,ne(A,i),s||x({dashboardSubTab:i}).catch(u=>{console.warn("âš ï¸ [tabs.js] Failed to store sub-tab preference",u)}),typeof document<"u"&&document.dispatchEvent(new CustomEvent("reservations:subTabChanged",{detail:{subTabId:i}})),i==="my-reservations-tab"?(g("ğŸ“‹ Rendering reservations list"),setTimeout(()=>{Be().then(u=>{try{u.renderReservations?.()}catch(f){console.error("âŒ [tabs.js] Failed to render reservations list",f)}}).catch(u=>console.error("âŒ [tabs.js] Unable to load reservations UI module",u))},50)):i==="calendar-tab"?(g("ğŸ“… Rendering calendar view"),setTimeout(()=>{Tt().then(u=>{try{u.renderCalendar?.()}catch(f){console.error("âŒ [tabs.js] Failed to render calendar",f)}}).catch(u=>console.error("âŒ [tabs.js] Unable to load calendar module",u))},100)):i==="reports-tab"&&(g("ğŸ“Š Rendering reports view"),St().then(u=>{const{renderReports:f}=u;setTimeout(()=>{try{f?.()}catch(b){console.error("âŒ [tabs.js] Failed to render reports tab",b)}},50)}).catch(u=>{console.error("âŒ [tabs.js] Unable to load reports tab",u)}))};if(P=(n,s={})=>{n?c(n,s):(e.forEach(i=>{i.classList.remove("active"),i.classList.contains("tab")&&i.classList.remove("tab-active"),i.setAttribute("aria-selected","false"),i.setAttribute("tabindex","-1")}),t.forEach(i=>{i.classList.remove("active"),i.setAttribute("aria-hidden","true"),i.setAttribute("hidden",""),i.style.display="none"}),q=null,_e(A))},e.forEach(n=>{n.dataset.subTabListenerAttached||(n.addEventListener("click",()=>{const s=n.getAttribute("data-sub-tab");g("ğŸ–±ï¸ Sub-tab clicked:",s),c(s)}),n.dataset.subTabListenerAttached="true")}),I)c(I,{skipStore:!0}),I=null;else{const n=document.querySelector("#reservations-tab .sub-tab-button.active"),s=o(),i=n?.getAttribute("data-sub-tab")||s;i&&(g("â­ Initial sub-tab:",i),c(i,{skipStore:!0}))}}function V(e){typeof P=="function"?P(e,{skipStore:!0}):e&&(I=e)}function At(){try{if(typeof H=="function")return H()||{}}catch(e){console.warn("âš ï¸ [tabs.js] Failed to read cached preferences",e)}return{}}function wt({attemptsLeft:e=0}={}){if(!L||typeof ae!="function")return!1;const t=At(),a=Array.from(document.querySelectorAll("[data-tab]"));if(!a.length)return!1;const o=a[0]?.dataset.tab||null,n=[B,document.querySelector("[data-tab].active")?.getAttribute("data-tab")||null,t.dashboardTab,R(ee),o].filter(Boolean).find(i=>document.getElementById(i));if(!n)return!1;const s=()=>{const i=document.querySelector(`[data-tab].active[data-tab="${n}"]`),d=document.getElementById(n);return!!(i&&d?.classList.contains("active")&&d?.style.display!=="none")};if(n==="reservations-tab"){const i=Array.from(document.querySelectorAll("#reservations-tab .sub-tab-button"));if(!i.length)return!1;const d=i[0]?.getAttribute("data-sub-tab")||null,l=[q,document.querySelector("#reservations-tab .sub-tab-button.active")?.getAttribute("data-sub-tab")||null,document.querySelector("#reservations-tab .sub-tab.active")?.id||null,t.dashboardSubTab,R(A),d].filter(Boolean).find(v=>document.getElementById(v)),u=document.querySelector("#reservations-tab .sub-tab-button.active"),f=document.querySelector("#reservations-tab .sub-tab.active"),b=f?.id||u?.getAttribute("data-sub-tab")||null;if(l&&b===l&&s())return f&&(f.removeAttribute("hidden"),f.style.display="block",f.setAttribute("aria-hidden","false")),!0;if(l)I=l;else if(e>0)return!1}else if(s())return!0;return ae(n,{skipStore:!0,skipRender:!0}),!0}function se(){if(!L)return;let e=0;const t=5;F&&(clearTimeout(F),F=null);const a=()=>{if(wt({attemptsLeft:t-e})){F=null;return}if(e>=t){F=null;return}e+=1,F=setTimeout(a,50*(e+1))};a()}document.addEventListener("language:translationsReady",se);document.addEventListener("language:changed",se);document.addEventListener("theme:changed",se);let h=[],E=[],D=null,_=!1,me=!1;const r={};function _t(){r.form=document.getElementById("equipment-package-form"),r.hiddenId=document.getElementById("equipment-package-id"),r.nameInput=document.getElementById("equipment-package-name"),r.codeInput=document.getElementById("equipment-package-code"),r.priceInput=document.getElementById("equipment-package-price"),r.descriptionInput=document.getElementById("equipment-package-description"),r.openSelector=document.getElementById("equipment-package-open-selector"),r.selectionWrapper=document.getElementById("equipment-package-selection-active"),r.selectionCounter=document.getElementById("equipment-package-selection-counter"),r.applySelection=document.getElementById("equipment-package-apply-selection"),r.cancelSelection=document.getElementById("equipment-package-cancel-selection"),r.itemsTableBody=document.querySelector("#equipment-package-items-table tbody"),r.itemsEmptyMessage=document.getElementById("equipment-package-items-empty"),r.resetButton=document.getElementById("equipment-package-reset"),r.submitButton=document.getElementById("equipment-package-submit"),r.tableBody=document.getElementById("equipment-packages-table-body"),r.emptyRow=document.getElementById("equipment-packages-empty-row"),r.countBadge=document.getElementById("equipment-packages-count"),r.applySelection&&(r.applySelection.style.display="none")}function Re(){const{equipment:e=[]}=M()||{};return Array.isArray(e)?e:[]}function ce(){const e=new Map;return Re().forEach(t=>{const a=t?.id??t?.equipment_id??t?.equipmentId??null;a!=null&&e.set(String(a),t)}),e}function Bt(){const e=new Map;return Re().forEach(t=>{const a=Ae(t?.barcode);a&&!e.has(a)&&e.set(a,t)}),e}function C(e,{persist:t=!1}={}){h=Array.isArray(e)?e.map(Le):[],Nt(),t&&(et({packages:h}),document.dispatchEvent(new CustomEvent("packages:changed",{detail:{packages:h}})))}function Le(e={}){const t=Rt(e.items??e.equipment_ids??e.equipmentIds??[]);return{id:e.id!=null?String(e.id):"",package_code:e.package_code??e.code??e.slug??"",slug:e.slug??null,name:e.name??e.title??e.label??"",description:e.description??"",price:Lt(e.price??e.total_price??e.package_price??0),is_active:Pt(e.is_active??e.active??!0),items:t,created_at:e.created_at??null,updated_at:e.updated_at??null}}function Rt(e){return Array.isArray(e)||(e=[]),e.map(t=>{if(t==null)return null;if(typeof t=="number"||typeof t=="string"){const a=String(t).trim();return a?{equipment_id:a,quantity:1,unit_price:null}:null}if(typeof t=="object"){const a=t.equipment_id??t.equipmentId??t.id??t.item_id??t.itemId??null;if(a==null)return null;const o=Number.isFinite(Number(t.quantity??t.qty))?Number(t.quantity??t.qty):1,c=Number.isFinite(Number(t.unit_price??t.price))?Number(t.unit_price??t.price):null;return{equipment_id:String(a),quantity:o>0?o:1,unit_price:c}}return null}).filter(Boolean)}function Lt(e){const t=Number.parseFloat(e);return Number.isFinite(t)?Math.round(t*100)/100:0}function Pt(e){if(e===!0||e===!1)return e;if(e==null)return!0;const t=String(e).trim().toLowerCase();return!(t==="0"||t==="false"||t==="no")}function Ft(e){const t=e?.quantity??e?.qty??1,a=Number.parseFloat(T(String(t)));return!Number.isFinite(a)||a<=0?1:a}function Ct(e,t){const a=[e?.unit_price,e?.price];for(const c of a){if(c==null)continue;const n=Number.parseFloat(T(String(c)));if(Number.isFinite(n))return n}const o=e?.equipment_id??e?.equipmentId??e?.id;if(o!=null&&t instanceof Map){const c=t.get(String(o));if(c&&typeof c=="object"){const n=[c.unit_price,c.unitPrice,c.price,c.daily_rate,c.dailyRate];for(const s of n){if(s==null)continue;const i=Number.parseFloat(T(String(s)));if(Number.isFinite(i))return i}}}return 0}function xt(e=null){const t=e instanceof Map?e:ce();return E.reduce((a,o)=>{const c=Ft(o),n=Ct(o,t),s=Number.isFinite(c)&&c>0?c:1,i=Number.isFinite(n)&&n>0?n:0;return a+s*i},0)}function pe(e){const t=r.priceInput;if(!t)return;const a=t.dataset.autoCalculated==="false",o=!!(t.value&&t.value.trim());if(a&&o)return;if(!Number.isFinite(e)||E.length===0){t.value="",t.dataset.autoCalculated="true";return}const c=e<0?0:e,n=Math.round(c*100)/100,s=Number.isInteger(n)?String(n):n.toFixed(2);t.value=s,t.dataset.autoCalculated="true"}function j(){if(!r.itemsTableBody||!r.itemsEmptyMessage)return;if(E.length===0){r.itemsTableBody.innerHTML="",r.itemsEmptyMessage.hidden=!1,pe(0);return}const e=ce(),t=E.map((o,c)=>{const n=e.get(String(o.equipment_id)),s=n?.desc||n?.name||p("equipment.packages.items.unknown","Ù…Ø¹Ø¯Ø© Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…"),i=n?.barcode?T(String(n.barcode)):"",d=T(String(o.quantity??1)),m=i?`${s} â€” ${i}`:s;return`
      <tr data-package-item-index="${c}">
        <td>${m}</td>
        <td>${d}</td>
        <td>
          <button type="button" class="btn btn-outline-danger btn-sm" data-action="remove-item" data-index="${c}">ğŸ—‘ï¸</button>
        </td>
      </tr>
    `});r.itemsTableBody.innerHTML=t.join(""),r.itemsEmptyMessage.hidden=!0;const a=xt(e);pe(a)}function Nt(){if(!r.tableBody||!r.emptyRow)return;if(!h.length){r.tableBody.innerHTML="",r.tableBody.appendChild(r.emptyRow),r.emptyRow.hidden=!1,r.countBadge&&(r.countBadge.textContent="0");return}const e=ce(),t=h.map(a=>{const o=lt({...a,items:a.items}),c=o.map(i=>{const d=e.get(String(i.equipmentId??i.equipment_id)),m=d?.desc||d?.name||i.desc||p("equipment.packages.items.unknown","Ù…Ø¹Ø¯Ø© Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…"),l=T(String(i.qty??i.quantity??1)),u=i.barcode||d?.barcode,f=u?` (${T(String(u))})`:"";return`<li>${m}${f} Ã— ${l}</li>`}),n=o.reduce((i,d)=>i+(Number(d.qty??d.quantity??1)||0),0),s=`${T(a.price.toFixed(2))} ${p("reservations.create.summary.currency","SR")}`;return`
      <tr data-package-id="${a.id}">
        <td>${a.name||"â€”"}</td>
        <td>${a.package_code||"â€”"}</td>
        <td>${s}</td>
        <td>
          <details>
            <summary>${T(String(n||0))}</summary>
            <ul class="equipment-package-items-summary">${c.join("")}</ul>
          </details>
        </td>
        <td>
          <div class="d-flex gap-2">
            <button type="button" class="btn btn-sm btn-outline-primary" data-action="edit-package" data-id="${a.id}">âœï¸</button>
            <button type="button" class="btn btn-sm btn-outline-danger" data-action="delete-package" data-id="${a.id}">ğŸ—‘ï¸</button>
          </div>
        </td>
      </tr>
    `});r.tableBody.innerHTML=t.join(""),r.emptyRow.hidden=!0,r.countBadge&&(r.countBadge.textContent=T(String(h.length)))}function Pe(){D=null,E=[],r.hiddenId&&(r.hiddenId.value=""),r.nameInput&&(r.nameInput.value=""),r.codeInput&&(r.codeInput.value=""),r.priceInput&&(r.priceInput.value="",r.priceInput.dataset.autoCalculated="true"),r.descriptionInput&&(r.descriptionInput.value=""),r.submitButton&&(r.submitButton.textContent=p("equipment.packages.form.actions.save","ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø­Ø²Ù…Ø©")),j(),w(!1)}function Dt(e){D=e.id||null,E=e.items.map(t=>({...t})),r.hiddenId&&(r.hiddenId.value=D||""),r.nameInput&&(r.nameInput.value=e.name||""),r.codeInput&&(r.codeInput.value=e.package_code||""),r.priceInput&&(r.priceInput.value=e.price!=null?String(e.price):"",r.priceInput.dataset.autoCalculated=e.price!=null?"false":"true"),r.descriptionInput&&(r.descriptionInput.value=e.description||""),r.submitButton&&(r.submitButton.textContent=p("equipment.packages.form.actions.update","ğŸ’¾ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø²Ù…Ø©")),j(),w(!1)}function w(e=_){_=e,r.selectionWrapper&&(_?r.selectionWrapper.hidden=!1:r.selectionWrapper.hidden=!0),r.openSelector&&(r.openSelector.disabled=_),r.cancelSelection&&(r.cancelSelection.disabled=!_),Fe()}function Fe(){if(r.selectionCounter){if(!_){r.selectionCounter.textContent=p("equipment.packages.selection.counter","Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø¹Ù†Ø§ØµØ± Ø¨Ø¹Ø¯.");return}r.selectionCounter.textContent=p("equipment.packages.selection.autoMode","Ø£ÙŠ Ù…Ø¹Ø¯Ø© ØªØ®ØªØ§Ø±Ù‡Ø§ Ø³ØªÙØ¶Ø§Ù Ù…Ø¨Ø§Ø´Ø±Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø²Ù…Ø©. Ø§Ø³ØªØ®Ø¯Ù… Ø²Ø± Ø¥Ù„ØºØ§Ø¡ Ù„Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† ÙˆØ¶Ø¹ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±.")}}function Mt(e){const t=e?.detail||{},a=!!t.active,o=t.selection||t.previous||{},c=o?.mode||o?.source||"";if(c!=="package-manager"&&c!=="equipment-packages"){!a&&_&&(w(!1),ie());return}if(a){w(!0);return}w(!1),ie()}function $t(e){const t=e?.detail;if(!t)return;const a=t.selection||{},o=a?.mode||a?.source||"";if(o!=="package-manager"&&o!=="equipment-packages")return;const c=Array.isArray(t.barcodes)?t.barcodes:[],n=Number.isInteger(t.quantity)&&t.quantity>0?t.quantity:1,s=c.length?c:t.barcode?[t.barcode]:[];if(!s.length)return;const i=Bt(),d=[],m=new Set;s.forEach(b=>{const v=Ae(b);v&&!m.has(v)&&(m.add(v),d.push(v))});const l=Math.min(d.length,n);let u=0;const f=[];for(let b=0;b<l;b+=1){const v=d[b],S=i.get(v);if(!S)continue;const G=S?.id??S?.equipment_id??S?.equipmentId??null;if(G==null)continue;const xe=S?.desc||S?.name||v,ue=E.find(Ne=>Ne.equipment_id===String(G));ue?ue.quantity+=1:E.push({equipment_id:String(G),quantity:1,unit_price:Number.isFinite(Number(S?.price))?Number(S.price):null}),u+=1,f.push(xe)}if(u>0){j(),Fe();const b=u===1?p("equipment.packages.selection.itemAddedSingle","âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© {name} Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø²Ù…Ø©"):p("equipment.packages.selection.itemAddedMulti","âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© {count} Ù…Ø¹Ø¯Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø²Ù…Ø©"),v=u===1?b.replace("{name}",f[0]||""):b.replace("{count}",T(String(u)));k(v)}else k(p("equipment.packages.selection.noMatch","âš ï¸ ØªØ¹Ø°Ø± Ø±Ø¨Ø· Ø§Ù„Ù…Ø¹Ø¯Ø§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© Ø¨Ø§Ù„Ø­Ø²Ù…ØŒ ØªØ­Ù‚Ù‚ Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"),4e3)}function jt(){w(!1),Ve("package-cancel"),ie()}function ie(){r.form&&(r.form.scrollIntoView({behavior:"smooth",block:"start"}),setTimeout(()=>{r.nameInput?.focus()},200))}function X(e){const t=r.priceInput;if(!t)return;const a=t.value;if(a==null)return;const o=a.replace(/[\u066B\u066C\u060CØŒ,]/gu,".");let n=T(o).replace(/[^0-9.]/gu,"");const s=n.indexOf(".");if(s!==-1){const i=n.slice(0,s+1),d=n.slice(s+1).replace(/\./g,"");n=`${i}${d}`}if(n!==a&&(t.value=n,typeof t.setSelectionRange=="function")){const i=n.length;try{t.setSelectionRange(i,i)}catch{}}e?.type==="input"&&(t.dataset.autoCalculated=n.trim()?"false":"true")}function Ut(){const e=r.nameInput?.value.trim(),t=r.codeInput?.value.trim(),a=r.descriptionInput?.value.trim()??"",o=r.priceInput?.value??"",c=Number.parseFloat(T(o));if(!e)return k(p("equipment.packages.validation.nameRequired","âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø­Ø²Ù…Ø©")),null;if(!t)return k(p("equipment.packages.validation.codeRequired","âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø­Ø²Ù…Ø©")),null;if(!E.length)return k(p("equipment.packages.validation.itemsRequired","âš ï¸ Ø£Ø¶Ù Ø¹Ù†ØµØ±Ù‹Ø§ ÙˆØ§Ø­Ø¯Ù‹Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ø­Ø²Ù…Ø©")),null;const n=E.map(s=>({equipment_id:s.equipment_id,quantity:Number.isFinite(Number(s.quantity))?Number(s.quantity):1,unit_price:s.unit_price!=null&&Number.isFinite(Number(s.unit_price))?Number(s.unit_price):null}));return{package_code:t,name:e,description:a,price:Number.isFinite(c)?c:0,is_active:!0,items:n}}async function Vt(e){if(e.preventDefault(),!r.form)return;const t=Ut();if(t)try{let a;D?(a=await W(`/packages/?id=${encodeURIComponent(D)}`,{method:"PATCH",body:t}),k(p("equipment.packages.toast.updated","âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø²Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­"))):(a=await W("/packages/",{method:"POST",body:t}),k(p("equipment.packages.toast.created","âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø²Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­")));const o=Le(a?.data??a),c=h.findIndex(n=>n.id===o.id);c>=0?h.splice(c,1,o):h=[o,...h],C(h,{persist:!0}),Pe()}catch(a){console.error("[equipmentPackagesManager] handlePackageSubmit error",a);const o=a?.message||p("equipment.packages.toast.saveFailed","âŒ ØªØ¹Ø°Ø± Ø­ÙØ¸ Ø§Ù„Ø­Ø²Ù…Ø©");k(o,4e3)}}function Ot(e){const t=e.target.closest('[data-action="remove-item"]');if(!t)return;const a=Number(t.dataset.index);Number.isNaN(a)||(E=E.filter((o,c)=>c!==a),j())}async function zt(e){const t=e.target.closest('[data-action="edit-package"]');if(t){const o=t.dataset.id;if(!o)return;const c=h.find(n=>n.id===o);if(!c)return;Dt(c);return}const a=e.target.closest('[data-action="delete-package"]');if(a){const o=a.dataset.id;if(!o||!window.confirm(p("equipment.packages.confirm.delete","Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø­Ø²Ù…Ø©ØŸ")))return;try{await W(`/packages/?id=${encodeURIComponent(o)}`,{method:"DELETE"}),h=h.filter(n=>n.id!==o),C(h,{persist:!0}),k(p("equipment.packages.toast.deleted","ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ø­Ø²Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­"))}catch(n){console.error("[equipmentPackagesManager] delete package error",n),k(p("equipment.packages.toast.deleteFailed","âŒ ØªØ¹Ø°Ø± Ø­Ø°Ù Ø§Ù„Ø­Ø²Ù…Ø©"),4e3)}}}async function Ht(){try{const e=await W("/packages/?all=1"),t=Array.isArray(e?.data)?e.data:Array.isArray(e)?e:[];C(t,{persist:!0})}catch(e){console.warn("[equipmentPackagesManager] Failed to fetch packages from API, falling back to cache",e);const{packages:t=[]}=M()||{};C(t,{persist:!1})}}function Wt(){const{packages:e=[]}=M()||{};Array.isArray(e)&&e.length?C(e,{persist:!1}):C([],{persist:!1}),j(),w(!1)}function Yt(){if(_){w(!0);return}w(!0),Ue({mode:"package-manager",source:"equipment-packages",activatedAt:Date.now()});const e=document.querySelector('[data-tab="equipment-tab"]');e&&e.click(),window.requestAnimationFrame(()=>{setTimeout(()=>{document.getElementById("search-equipment")?.focus();const t=document.getElementById("equipment-list");t&&t.scrollIntoView({behavior:"smooth",block:"start"})},200)})}function Gt(){r.form&&(r.form.addEventListener("submit",Vt),r.itemsTableBody?.addEventListener("click",Ot),r.resetButton?.addEventListener("click",()=>{Pe()}),r.tableBody?.addEventListener("click",zt),r.openSelector?.addEventListener("click",e=>{e.preventDefault(),Yt()}),r.cancelSelection?.addEventListener("click",e=>{e.preventDefault(),jt()}),r.priceInput&&!r.priceInput.dataset.normalizedAttached&&(r.priceInput.addEventListener("input",X),r.priceInput.addEventListener("blur",X),r.priceInput.dataset.normalizedAttached="true",X()),me||(document.addEventListener(le.change,Mt),document.addEventListener(le.requestAdd,$t),me=!0))}function Kt(){typeof document>"u"||(_t(),r.form&&(Wt(),Gt(),Ht()))}tt();let y=null,O=null,z=null;function Qt(){return z||(z=$(()=>import("./dashboardMetrics.DBOIOB-M.js"),__vite__mapDeps([8,1,2]),import.meta.url).then(e=>{try{typeof e.initDashboardMetrics=="function"&&e.initDashboardMetrics()}catch(t){console.error("âŒ Failed to initialise dashboard metrics",t)}return e}).catch(e=>{throw console.error("âŒ Failed to load dashboard metrics module",e),z=null,e})),z}function Jt(){const e=()=>{Qt()};typeof window<"u"&&typeof window.requestIdleCallback=="function"?window.requestIdleCallback(()=>{e()},{timeout:1500}):setTimeout(e,0)}async function ge(){if(!await nt())return;rt(),Et(),at(),ke(),Kt(),Oe(),Jt();const t=document.getElementById("excel-upload");t&&t.addEventListener("change",async o=>{const c=o.target.files&&o.target.files[0];c&&(await ze(c),o.target.value="")});const a=document.getElementById("excel-upload-trigger");a&&t&&a.addEventListener("click",o=>{o.preventDefault(),t.click()}),document.getElementById("logout-btn")?.addEventListener("click",it),Xt(),Zt()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{ge().catch(e=>{console.error("âŒ Failed to initialise app",e)})},{once:!0}):ge().catch(e=>{console.error("âŒ Failed to initialise app",e)});function Xt(){document.querySelectorAll('input[type="datetime-local"]').forEach(e=>{e.addEventListener("input",()=>{const t=e.value;if(!t.includes("T"))return;const[a,o]=t.split("T"),[c]=o.split(":"),n=`${c.padStart(2,"0")}:00`,s=`${a}T${n}`;e.value!==s&&(e.value=s,setTimeout(()=>e.blur(),150))})})}function Zt(){const e=new URLSearchParams(window.location.search),t=e.get("reservationEditId"),a=e.get("reservationEditIndex");if(!t&&!a)return;y={reservationId:t,reservationIndex:a!=null?Number(a):null},Ce(),e.delete("reservationEditId"),e.delete("reservationEditIndex");const o=e.toString(),c=`${window.location.pathname}${o?`?${o}`:""}${window.location.hash||""}`;window.history.replaceState({},document.title,c)}function en(e){const t=document.getElementById(e);return!!(t?.classList.contains("active")&&t?.style.display!=="none")}function tn(e){return new Promise(t=>{if(en(e)){t();return}const a=c=>{c?.detail?.tabId===e&&(document.removeEventListener("dashboard:tabChanged",a),t())};document.addEventListener("dashboard:tabChanged",a),document.querySelector(`[data-tab="${e}"]`)?.click()})}function nn(e){const t=document.querySelector(`#reservations-tab .sub-tab-button[data-sub-tab="${e}"]`),a=document.getElementById(e);return!!(t?.classList.contains("active")&&a?.classList.contains("active")&&a?.getAttribute("aria-hidden")==="false")}function an(e){return new Promise(t=>{if(nn(e)){t();return}const a=c=>{c?.detail?.subTabId===e&&(document.removeEventListener("reservations:subTabChanged",a),t())};document.addEventListener("reservations:subTabChanged",a),document.querySelector(`#reservations-tab .sub-tab-button[data-sub-tab="${e}"]`)?.click()})}async function rn(){const e=He("openReservationEditor");if(typeof e=="function")return e;const t=await We("openReservationEditor");if(typeof t=="function")return t;throw new Error("Reservation editor handler is unavailable")}async function Ce(){if(!y)return;if(O)return O;const e=(async()=>{const a=M().reservations||[];let o=null;if(y.reservationId){const i=a.findIndex(d=>String(d?.id)===y.reservationId||String(d?.reservationId)===y.reservationId);i!==-1&&(o=i)}if(o===null&&typeof y.reservationIndex=="number"&&!Number.isNaN(y.reservationIndex)&&y.reservationIndex>=0&&y.reservationIndex<a.length&&(o=y.reservationIndex),o===null)return;const c="my-reservations-tab",n="reservations-tab",s=y;y=null;try{await tn(n),await an(c);const i=await rn();typeof i=="function"?i(o):(console.warn("âš ï¸ Pending reservation edit skipped: editor is not available"),y=s)}catch(i){console.error("âŒ Failed to open pending reservation editor",i),y=s}})();O=e;try{await e}finally{O=null}}document.addEventListener("reservations:changed",()=>{y&&Ce()});
