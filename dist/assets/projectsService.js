import{d as _e,n as E,f as tt,t as d,b as j,h as g,j as J,o as ce,s as Ae,A as De}from"./auth.js";import{a as nt,g as W,O as at,i as we,P as rt,s as it}from"./reservationsService.js";const qe="select.form-select:not([data-no-enhance]):not([multiple])",T=new WeakMap;let ve=null,$e=!1,P=null;function Vt(e=document){e&&(e.querySelectorAll(qe).forEach(t=>ae(t)),!ve&&e===document&&(ve=new MutationObserver(t=>{for(const n of t)n.addedNodes?.forEach(a=>{a instanceof Element&&(a.matches?.(qe)&&ae(a),a.querySelectorAll?.(qe).forEach(r=>ae(r)))})}),ve.observe(document.body,{childList:!0,subtree:!0})),$e||($e=!0,document.addEventListener("pointerdown",ct,{capture:!0})))}function ne(e){if(!(e instanceof HTMLSelectElement))return;if(!e.dataset.enhancedSelect){ae(e);return}const t=e.closest(".enhanced-select");t&&(Ie(t),re(t),Ee(t))}function ae(e){if(!(e instanceof HTMLSelectElement))return;if(e.dataset.enhancedSelect){ne(e);return}if(e.multiple||e.size>1)return;const t=document.createElement("div");t.className="enhanced-select";const n=e.parentNode;n&&n.insertBefore(t,e),t.appendChild(e),e.dataset.enhancedSelect="true",e.classList.add("enhanced-select__native"),e.setAttribute("tabindex","-1"),e.setAttribute("aria-hidden","true");const a=document.createElement("button");a.type="button",a.className="enhanced-select__trigger",a.setAttribute("aria-haspopup","listbox"),a.setAttribute("aria-expanded","false");const r=document.createElement("ul");r.className="enhanced-select__menu",r.setAttribute("role","listbox"),r.setAttribute("tabindex","-1"),t.append(a,r);const o={select:e,trigger:a,menu:r,observer:null,refreshRaf:null};T.set(t,o),a.addEventListener("click",()=>ot(t)),a.addEventListener("keydown",i=>ut(i,t)),r.addEventListener("click",i=>lt(i,t)),r.addEventListener("keydown",i=>dt(i,t)),e.addEventListener("change",()=>{re(t),ke(t)}),o.observer=new MutationObserver(i=>{let c=!1,s=!1;for(const u of i)u.type==="attributes"&&u.attributeName==="disabled"&&(s=!0),u.type==="childList"&&(c=!0);s&&Ee(t),c&&st(o,t)}),o.observer.observe(e,{attributes:!0,attributeFilter:["disabled"],childList:!0}),Ie(t),re(t),Ee(t)}function st(e,t){e&&(e.refreshRaf||(e.refreshRaf=requestAnimationFrame(()=>{e.refreshRaf=null,Ie(t),re(t)})))}function Ie(e){const t=T.get(e);if(!t)return;const{select:n,menu:a}=t;if(!n||!a)return;const r=Array.from(n.options||[]),o=document.createDocumentFragment();r.forEach(i=>{const c=document.createElement("li");c.className="enhanced-select__option",c.textContent=i.textContent??i.value??"",c.dataset.value=i.value??"",c.setAttribute("role","option"),c.setAttribute("tabindex","-1"),i.disabled&&(c.setAttribute("aria-disabled","true"),c.classList.add("is-disabled")),i.selected&&(c.setAttribute("aria-selected","true"),c.dataset.selected="true",c.setAttribute("tabindex","0")),o.appendChild(c)}),a.innerHTML="",a.appendChild(o),ke(e)}function re(e){const t=T.get(e);if(!t)return;const{select:n,trigger:a}=t;if(!n||!a)return;const r=n.selectedOptions?.[0]??n.options?.[n.selectedIndex],o=r?.textContent?.trim()||r?.value||"";a.textContent=o}function ke(e){const t=T.get(e);if(!t)return;const{select:n,menu:a}=t;if(!n||!a)return;const r=n.value;a.querySelectorAll(".enhanced-select__option").forEach(i=>{const c=i.dataset.value===r;i.toggleAttribute("aria-selected",c),i.dataset.selected=c?"true":"",i.setAttribute("tabindex",c?"0":"-1")})}function Ee(e){const t=T.get(e);if(!t)return;const{select:n,trigger:a}=t,r=!!n?.disabled;e.classList.toggle("enhanced-select--disabled",r),a.disabled=r}function ot(e){T.get(e)&&(e.getAttribute("data-open")==="true"?V(e):Oe(e))}function Oe(e){const t=T.get(e);if(!t)return;P&&P!==e&&V(P,{focusTrigger:!1}),e.setAttribute("data-open","true"),t.trigger.setAttribute("aria-expanded","true"),P=e;const n=t.menu.querySelector('.enhanced-select__option[aria-selected="true"]')??t.menu.querySelector(".enhanced-select__option:not([aria-disabled='true'])");n?n.focus():t.menu.focus()}function V(e,{focusTrigger:t=!0}={}){const n=T.get(e);n&&(e.setAttribute("data-open","false"),n.trigger.setAttribute("aria-expanded","false"),t&&n.trigger.focus({preventScroll:!0}),P===e&&(P=null))}function ct(e){if(!P)return;const t=e.target;t instanceof Node&&(P.contains(t)||V(P,{focusTrigger:!1}))}function ut(e,t){const n=e.key;n==="ArrowDown"||n==="ArrowUp"||n===" "||n==="Enter"?(e.preventDefault(),Oe(t)):n==="Escape"&&V(t)}function dt(e,t){const n=e.key,a=T.get(t);if(!a)return;const r=Array.from(a.menu.querySelectorAll(".enhanced-select__option:not([aria-disabled='true'])"));if(!r.length)return;const o=r.findIndex(i=>i===document.activeElement);if(n==="ArrowDown"||n==="ArrowUp"){e.preventDefault();const c=(o+(n==="ArrowDown"?1:-1)+r.length)%r.length;r[c].focus()}else if(n==="Home")e.preventDefault(),r[0].focus();else if(n==="End")e.preventDefault(),r[r.length-1].focus();else if(n==="Enter"||n===" "){e.preventDefault();const i=document.activeElement;i&&i.classList.contains("enhanced-select__option")&&Ue(i,t)}else n==="Escape"&&(e.preventDefault(),V(t))}function lt(e,t){const n=e.target?.closest?.(".enhanced-select__option");n&&Ue(n,t)}function Ue(e,t){const n=T.get(t);if(!n||e.getAttribute("aria-disabled")==="true")return;const{select:a}=n,r=e.dataset.value??"";a.value!==r&&(a.value=r,a.dispatchEvent(new Event("change",{bubbles:!0}))),V(t)}const mt=_e()||{};let M=(mt.equipment||[]).map(yt),Se=!1,G="",D=null,w=null,k=null,ue=!1;function pt(e){if(!e)return null;const t=window?.bootstrap?.Modal??(typeof bootstrap<"u"?bootstrap.Modal:null);return t?t.getOrCreateInstance(e):null}function ft(){document.dispatchEvent(new CustomEvent("equipment:changed"))}function yt(e={}){return Le({...e,subcategory:e.subcategory??e.sub??"",description:e.description??e.desc??e.name??"",quantity:e.quantity??e.qty??0,unit_price:e.unit_price??e.price??0,image_url:e.image_url??e.imageUrl??e.image??""})}function de(e={}){return Le(e)}function Le(e={}){const t=e.id??e.equipment_id??e.equipmentId??e.item_id??e.itemId??null,n=e.description??e.desc??e.name??"",a=e.category??"",r=e.subcategory??e.sub??"",o=Y(e.quantity??e.qty??0),i=le(e.unit_price??e.price??0),c=E(String(e.barcode??"").trim()),s=L(e.status??e.state??e.status_label??e.statusLabel??"available"),u=e.image_url??e.imageUrl??e.image??"",y=e.name??e.item_name??n;return{id:gt(t)?String(t):"",category:a,sub:r,desc:n,name:y,qty:o,price:i,barcode:c,status:s,image:u,imageUrl:u,created_at:e.created_at??null,updated_at:e.updated_at??null}}function gt(e){return e!=null&&e!==""}function Y(e){const t=Number.parseInt(e,10);return Number.isFinite(t)&&t>=0?t:0}function le(e){const t=Number.parseFloat(e);return Number.isFinite(t)?Math.round(t*100)/100:0}function bt(e){!e||e.dataset.englishDigitsAttached||(e.addEventListener("input",()=>{const{selectionStart:t,selectionEnd:n,value:a}=e,r=E(a);if(r!==a&&(e.value=r,t!=null&&n!=null)){const o=r.length-a.length,i=t+o,c=n+o;e.setSelectionRange(i,c)}}),e.dataset.englishDigitsAttached="true")}function je(e){if(!e)return"";const t=E(String(e.barcode??"")).trim();if(t)return t;if(Array.isArray(e.variants))for(const n of e.variants){const a=E(String(n?.barcode??"")).trim();if(a)return a}return""}function qt(e,t){const n=je(e),a=je(t);if(!n&&!a)return 0;if(!n)return 1;if(!a)return-1;const r=/^[0-9]+$/,o=r.test(n),i=r.test(a);if(o&&i){if(n.length!==a.length)return n.length-a.length;const u=n.localeCompare(a,"ar",{numeric:!0,sensitivity:"base"});if(u!==0)return u}else{if(o!==i)return o?-1:1;{const u=n.localeCompare(a,"ar",{numeric:!0,sensitivity:"base"});if(u!==0)return u}}const c=ie(e?.desc||e?.description||e?.name||""),s=ie(t?.desc||t?.description||t?.name||"");return c.localeCompare(s,"ar",{sensitivity:"base"})}function I(e=""){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function L(e){switch(String(e??"").trim().toLowerCase()){case"available":case"متاح":case"متوفر":return"available";case"reserved":case"محجوز":return"reserved";case"maintenance":case"صيانة":return"maintenance";case"retired":case"متوقف":case"خارج الخدمة":return"retired";default:return"available"}}function vt(e){return L(e)}function x(){return M}function O(e){M=Array.isArray(e)?e.map(Le):[],Ae({equipment:M}),ft()}function ie(e){return String(e??"").trim().toLowerCase()}function R(e){if(!e)return"";const t=e.desc||e.description||e.name||"";let n=ie(t);return n||(n=ie(e.category||"")),n||(n=E(String(e.barcode||"")).trim().toLowerCase()),n}function me(e){const t=R(e);return t?x().filter(n=>R(n)===t):[]}function pe(e){const t=document.getElementById("equipment-details-cover");if(!t)return;const n=fe(e);if(n){const a=I(e.desc||e.description||e.name||"");t.innerHTML=`<img src="${I(n)}" alt="${a}">`,t.classList.add("has-image")}else t.innerHTML='<span class="equipment-details-header__placeholder" aria-hidden="true">📦</span>',t.classList.remove("has-image")}function Ne(){return{category:document.getElementById("edit-equipment-category"),subcategory:document.getElementById("edit-equipment-subcategory"),description:document.getElementById("edit-equipment-description"),quantity:document.getElementById("edit-equipment-quantity"),price:document.getElementById("edit-equipment-price"),image:document.getElementById("edit-equipment-image"),barcode:document.getElementById("edit-equipment-barcode"),status:document.getElementById("edit-equipment-status")}}function se(){const e=Ne();return{category:e.category?.value??"",subcategory:e.subcategory?.value??"",description:e.description?.value??"",quantity:e.quantity?.value??"",price:e.price?.value??"",image:e.image?.value??"",barcode:e.barcode?.value??"",status:e.status?.value??""}}function xe(e={}){const t=Ne();t.category&&(t.category.value=e.category??""),t.subcategory&&(t.subcategory.value=e.subcategory??""),t.description&&(t.description.value=e.description??""),t.quantity&&(t.quantity.value=e.quantity!=null?E(String(e.quantity)):""),t.price&&(t.price.value=e.price!=null?E(String(e.price)):""),t.image&&(t.image.value=e.image??""),t.barcode&&(t.barcode.value=e.barcode??""),t.status&&(t.status.value=e.status??"")}function X(e){ue=e;const t=Ne(),n=document.getElementById("equipment-edit-cancel"),a=document.getElementById("save-equipment-changes"),r=document.getElementById("edit-equipment-form");if(r&&r.classList.toggle("equipment-details-form--editing",e),[t.category,t.subcategory,t.description,t.quantity,t.price,t.image].forEach(i=>{i&&(e?i.removeAttribute("disabled"):i.setAttribute("disabled","disabled"))}),n&&(n.hidden=!e,n.disabled=!e),a){a.disabled=!1;const i=e?"equipment.modal.actions.save":"equipment.modal.actions.edit",c=e?"💾 حفظ التعديلات":"✏️ تعديل";a.textContent=d(i,c),a.dataset.mode=e?"save":"view"}if(e){const i=t.description||t.category||t.subcategory;i&&setTimeout(()=>{i.focus(),typeof i.select=="function"&&i.select()},0)}}async function zt(e){if(!J()){ce();return}if(!e)return;try{await Et()}catch(n){console.error("❌ [equipment.js] Unable to load XLSX",n),alert(d("equipment.toast.xlsxMissing","⚠️ مكتبة Excel (XLSX) غير محملة."));return}const t=new FileReader;t.onload=async function(n){try{const a=new Uint8Array(n.target.result),r=XLSX.read(a,{type:"array"}),o=r.Sheets[r.SheetNames[0]],i=XLSX.utils.sheet_to_json(o,{defval:""});if(!Array.isArray(i)||i.length===0){g(d("equipment.toast.uploadEmpty","⚠️ لم يتم العثور على بيانات في الملف"));return}const c=[];let s=0;if(i.forEach(u=>{const y=u.القسم??u.category??"",m=u["القسم الثانوي"]??u.subcategory??"",p=u.الوصف??u.description??u.name??"",f=u.الكمية??u.quantity??0,v=u.السعر??u.price??0,l=u.الباركود??u.barcode??"",b=u.الحالة??u.status??"متاح",S=u.الصورة??u.image_url??u.image??"",A=E(String(l||"")).trim();if(!p||!A){s+=1;return}c.push(Be({category:y,subcategory:m,description:p,quantity:f,unit_price:v,barcode:A,status:b,image_url:S}))}),!c.length){g(d("equipment.toast.uploadEmpty","⚠️ لم يتم العثور على بيانات في الملف"));return}try{const u=await j("/equipment/?bulk=1",{method:"POST",body:c}),y=Array.isArray(u?.data)?u.data.map(de):[];if(y.length){const f=[...x(),...y];O(f)}await ye({showToastOnError:!1}),B();const m=u?.meta?.count??y.length,p=[];m&&p.push(`${m} ✔️`),s&&p.push(`${s} ⚠️`),g(d("equipment.toast.uploadSuccess","✅ تم رفع المعدات بنجاح")+(p.length?` (${p.join(" / ")})`:""))}catch(u){const y=z(u,"equipment.toast.uploadFailed","❌ حدث خطأ أثناء قراءة ملف الإكسل");g(y,"error")}}catch(a){console.error("❌ [equipment.js] Failed to process Excel file",a),g(d("equipment.toast.uploadFailed","❌ حدث خطأ أثناء قراءة ملف الإكسل"),"error")}},t.onerror=function(){console.error("❌ [equipment.js] FileReader error",t.error),g(d("equipment.toast.uploadFailed","❌ حدث خطأ أثناء قراءة ملف الإكسل"),"error")},t.readAsArrayBuffer(e)}const ht="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js";let K=null;function Et(){return typeof XLSX<"u"?Promise.resolve():typeof window>"u"||typeof document>"u"?Promise.reject(new Error("XLSX library is not available in this environment")):K||(K=new Promise((e,t)=>{const n=document.querySelector('script[data-xlsx-loader="true"]');if(n){n.addEventListener("load",r,{once:!0}),n.addEventListener("error",o,{once:!0});return}const a=document.createElement("script");a.src=ht,a.async=!0,a.defer=!0,a.dataset.xlsxLoader="true",a.addEventListener("load",r,{once:!0}),a.addEventListener("error",o,{once:!0}),document.head.appendChild(a);function r(){if(typeof XLSX>"u"){t(new Error("XLSX did not load correctly"));return}e()}function o(){t(new Error("Failed to load XLSX library"))}}).catch(e=>{throw console.warn("⚠️ [equipment.js] ensureXLSXLoaded failed",e),K=null,e}),K)}function Be({category:e="",subcategory:t="",description:n="",quantity:a=0,unit_price:r=0,barcode:o="",status:i="متاح",image_url:c=""}){const s=E(String(o||"")).trim(),u=vt(i);return{category:e?.trim()||null,subcategory:t?.trim()||null,name:n?.trim()||null,description:n?.trim()||null,quantity:Y(a),unit_price:le(r),barcode:s,status:u,image_url:c?.trim()||null}}async function St(){if(!J()){ce();return}if(confirm(d("equipment.toast.clearConfirm","⚠️ هل أنت متأكد من حذف كل المعدات؟")))try{const t=(await j("/equipment/?all=1",{method:"DELETE"}))?.meta?.deleted??0;await ye({showToastOnError:!1}),g(d("equipment.toast.clearSuccess","🗑️ تم مسح جميع المعدات")+(t?` (${t})`:""))}catch(e){const t=z(e,"equipment.toast.clearFailed","⚠️ تعذر حذف بعض المعدات");g(t,"error")}}function fe(e){return e.image||e.imageUrl||e.img||""}function _t(e){const t=L(e),n={available:{label:d("equipment.form.options.available","✅ متاح"),className:"equipment-status-badge equipment-status-badge--available"},reserved:{label:d("equipment.form.options.booked","📌 محجوز"),className:"equipment-status-badge equipment-status-badge--reserved"},maintenance:{label:d("equipment.form.options.maintenance","🛠️ صيانة"),className:"equipment-status-badge equipment-status-badge--maintenance"},retired:{label:d("equipment.form.options.retired","📦 خارج الخدمة"),className:"equipment-status-badge equipment-status-badge--retired"}},{label:a,className:r}=n[t]||{label:e||"-",className:"equipment-status-badge equipment-status-badge--default"};return`<span class="${r}">${a}</span>`}function oe(){const e=document.getElementById("equipment-variants-section"),t=document.getElementById("equipment-variants-table-body"),n=document.getElementById("equipment-variants-count");if(e&&(e.hidden=!0),t){const a=d("equipment.modal.variants.empty","لا توجد قطع مرتبطة أخرى.");t.innerHTML=`<tr><td colspan="4" class="text-center text-muted">${I(a)}</td></tr>`}n&&(n.textContent="0")}function He(e){const t=document.getElementById("equipment-variants-section"),n=document.getElementById("equipment-variants-table-body"),a=document.getElementById("equipment-variants-count");if(!t||!n||!e)return;const o=D?.groupKey||R(e);if(!o){oe();return}const i=x().filter(m=>R(m)===o).sort((m,p)=>{const f=String(m.barcode||"").trim(),v=String(p.barcode||"").trim();return!f&&!v?0:f?v?f.localeCompare(v,"ar",{numeric:!0,sensitivity:"base"}):-1:1});if(!i.length){oe();return}t.hidden=!1,a&&(a.textContent=String(i.length));const c=d("equipment.modal.variants.current","الحالي"),s=d("equipment.form.labels.quantity","الكمية"),u=x(),y=i.map(m=>{const p=m.id&&e.id?String(m.id)===String(e.id):String(m.barcode||"")===String(e.barcode||""),f=p?"equipment-variants-table__row--current":"",v=I(String(m.barcode||"-")),l=p?`<span class="equipment-variants-current-badge">${I(c)}</span>`:"",b=E(String(Number.isFinite(Number(m.qty))?Number(m.qty):0)),S=u.indexOf(m),A=I(d("equipment.item.actions.delete","🗑️ حذف")),C=S>=0?`<div class="table-action-buttons equipment-variant-actions">
            <button type="button" class="btn btn-sm btn-error equipment-variant-action equipment-variant-action--danger" data-variant-action="delete" data-variant-index="${S}">${A}</button>
          </div>`:"";return`
        <tr class="${f}">
          <td>
            ${v}
            ${l}
          </td>
          <td>${_t(m.status)}</td>
          <td>
            <span class="equipment-variants-qty" title="${I(s)}">${b}</span>
          </td>
          <td class="table-actions-cell">${C}</td>
        </tr>
      `}).join("");n.innerHTML=y}function At({item:e,index:t}){const n=fe(e),a=d("equipment.item.actions.delete","🗑️ حذف"),r=d("equipment.item.imageAlt","صورة"),o=d("equipment.item.currency","SR"),i=J(),c={description:d("equipment.card.labels.description","الوصف"),status:d("equipment.card.labels.status","الحالة"),alias:d("equipment.card.labels.alias","الاسم"),quantity:d("equipment.card.labels.quantity","الكمية"),price:d("equipment.card.labels.price","السعر"),category:d("equipment.card.labels.category","القسم"),subcategory:d("equipment.card.labels.subcategory","القسم الثانوي"),barcode:d("equipment.card.labels.barcode","الباركود"),available:d("equipment.card.labels.available","متاح")},s=Number.isFinite(Number(e.qty))?Number(e.qty):0,u=Number.isFinite(Number(e.price))?Number(e.price):0,y=s.toLocaleString("en-US"),m=u.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:2}),p=Number.isFinite(Number(e.reservedQty))?Number(e.reservedQty):0,f=Number.isFinite(Number(e.maintenanceQty))?Number(e.maintenanceQty):0,v=Number.isFinite(Number(e.availableQty))?Number(e.availableQty):Math.max(s-p-f,0),l=v.toLocaleString("en-US"),b=d("equipment.card.labels.availableOfTotal","من أصل"),S=L(e.status);let A=`${I(c.available)}: ${I(l)} ${I(b)} ${I(y)}`,C="available";if(v===0){const U={reserved:{text:s===1?d("equipment.card.availability.reservedSingle","مؤجرة"):d("equipment.card.availability.reserved","مؤجرة بالكامل"),modifier:"reserved"},maintenance:{text:d("equipment.card.availability.maintenance","تحت الصيانة"),modifier:"maintenance"},retired:{text:d("equipment.card.availability.retired","غير متاحة"),modifier:"retired"},default:{text:d("equipment.card.availability.unavailable","غير متاحة حالياً"),modifier:"unavailable"}},H=U[S]||U.default;A=I(H.text),C=H.modifier}const $=`<span class="equipment-card__availability equipment-card__availability--${C}">${A}</span>`,N="",q=e.desc||e.name||"—",h=e.name&&e.name!==e.desc?e.name:"",ee=`
    <div class="equipment-card__info-row equipment-card__info-row--center">
      ${[{label:c.quantity,value:y},{label:c.price,value:`${m} ${o}`}].map(({label:U,value:H})=>`
            <span class="equipment-card__info-item equipment-card__info-item--stacked">
              <span class="equipment-card__detail-label">${U}</span>
              <span class="equipment-card__detail-value">${H}</span>
            </span>
          `).join("")}
    </div>`,Q=[e.category?{label:c.category,value:e.category}:null,e.sub?{label:c.subcategory,value:e.sub}:null].filter(Boolean),Ge=Q.length?`<div class="equipment-card__categories">${Q.map(({label:U,value:H})=>`
            <div class="equipment-card__category">
              <span class="equipment-card__detail-label">${U}</span>
              <span class="equipment-card__detail-value">${H}</span>
            </div>
          `).join("")}</div>`:"",Je=h?`<div class="equipment-card__alias">
        <span class="equipment-card__detail-label">${c.alias}</span>
        <span class="equipment-card__detail-value">${h}</span>
      </div>`:"",Ye=`
    <div class="equipment-card__details">
      ${`
    <div class="equipment-card__description">
      <span class="equipment-card__label">${c.description}</span>
      <h3 class="equipment-card__title">${q}</h3>
    </div>
  `}
      ${ee}
    </div>
  `,be=[];i&&be.push(`<button type="button" class="btn btn-sm equipment-card__action-btn equipment-card__action-btn--delete" data-equipment-action="delete" data-equipment-index="${t}">${a}</button>`);const Ze=be.length?`<div class="equipment-card__actions equipment-card__actions--center">${be.join(`
`)}</div>`:"",et=I(q);return`
    <article
      class="equipment-card"
      data-equipment-index="${t}"
      data-equipment-card="true"
      role="listitem"
      tabindex="0"
      aria-label="${et}"
    >
      <div class="equipment-card__header">
      <div class="equipment-card__status-block">
        ${N}
        ${$}
      </div>
        <div class="equipment-card__media-wrapper">
          <div class="equipment-card__media" aria-hidden="true">
            ${n?`<img src="${n}" alt="${r}" loading="lazy">`:'<div class="equipment-card__placeholder">📦</div>'}
          </div>
          ${Ye}
        </div>
      </div>
      <div class="equipment-card__body">
        ${Ge}
        ${Je}
      </div>
      ${Ze}
    </article>
  `}function It(e){const t=[...new Set(e.map(i=>i.category).filter(Boolean))],n=[...new Set(e.map(i=>i.sub).filter(Boolean))],a=document.getElementById("filter-category"),r=document.getElementById("filter-sub");if(a){const i=a.value;for(;a.options.length>1;)a.remove(1);t.forEach(c=>{const s=document.createElement("option");s.value=c,s.textContent=c,a.appendChild(s)}),t.includes(i)&&(a.value=i),ne(a)}if(r){const i=r.value;for(;r.options.length>1;)r.remove(1);n.forEach(c=>{const s=document.createElement("option");s.value=c,s.textContent=c,r.appendChild(s)}),n.includes(i)&&(r.value=i),ne(r)}const o=document.getElementById("filter-status");o&&ne(o)}function Xe(){const e=_e();let{equipment:t=[],reservations:n=[],maintenance:a=[]}=e;if(!Array.isArray(t)||t.length===0)return M=t||[],M;const r=new Date;let o=!1;const i=new Set((a||[]).filter(s=>s?.status==="open").map(s=>E(String(s?.equipmentBarcode??"")).trim().toLowerCase())),c=t.map(s=>{if(!s)return s;const u=L(s.status),y=E(String(s.barcode??"")).trim().toLowerCase(),m=y&&i.has(y);let p=m?"maintenance":"available";if(!m&&y)for(const f of n||[]){if(!Lt(f,r))continue;if(f.items?.some(l=>E(String(l?.barcode??"")).trim().toLowerCase()===y)){p="reserved";break}}return p!==u?(o=!0,{...s,status:p}):{...s,status:p}});return o?O(c):(M=c,Ae({equipment:M})),M}function Lt(e,t){if(!e?.start||!e?.end)return!1;const n=new Date(e.start),a=new Date(e.end);return Number.isNaN(n.getTime())||Number.isNaN(a.getTime())?!1:n<=t&&t<a}function he(e,{tone:t="",icon:n="📦"}={}){const a=["equipment-empty-state"];return t&&a.push(`equipment-empty-state--${t}`),`
    <div class="${a.join(" ")}">
      <div class="equipment-empty-state__icon" aria-hidden="true">${n}</div>
      <p class="equipment-empty-state__text">${e}</p>
    </div>
  `}function B(){const e=document.getElementById("equipment-list");if(!e)return;const t=Xe(),n=Array.isArray(t)?t:x(),a=new Map;n.forEach(l=>{if(!l)return;const b=R(l);b&&(a.has(b)||a.set(b,[]),a.get(b).push(l))});const r=Array.from(a.values()).map(l=>{const b=l[0],S=l.reduce((h,_)=>h+(Number.isFinite(Number(_.qty))?Number(_.qty):0),0),A=["maintenance","reserved","available","retired"],C=l.map(h=>L(h.status)).sort((h,_)=>A.indexOf(h)-A.indexOf(_))[0]||"available",$=l.reduce((h,_)=>{const ee=Y(_?.qty??0)||0,Q=L(_?.status);return Q==="reserved"?h.reserved+=ee:Q==="maintenance"&&(h.maintenance+=ee),h},{reserved:0,maintenance:0}),N=Math.max(S-$.reserved-$.maintenance,0);return{item:{...b,qty:S,status:C,variants:l,groupKey:R(b),reservedQty:$.reserved,maintenanceQty:$.maintenance,availableQty:N},index:n.indexOf(b)}});r.sort((l,b)=>qt(l.item,b.item));const o=document.getElementById("search-equipment")?.value||"",i=E(o).toLowerCase().trim(),c=document.getElementById("filter-category")?.value||"",s=document.getElementById("filter-sub")?.value||"",u=document.getElementById("filter-status")?.value||"",y=u?L(u):"";if(Se&&!n.length){e.innerHTML=he(d("equipment.list.loading","⏳ جاري تحميل المعدات..."),{icon:"⏳"});return}if(G&&!n.length){e.innerHTML=he(G,{tone:"error",icon:"⚠️"});return}const m=r.filter(({item:l})=>{const b=E(String(l.barcode??"")).toLowerCase().trim(),S=Array.isArray(l.variants)?l.variants.map(q=>E(String(q.barcode??"")).toLowerCase().trim()).filter(Boolean):[],A=!i||l.name&&l.name.toLowerCase().includes(i)||l.desc&&l.desc.toLowerCase().includes(i)||b&&b.includes(i)||S.some(q=>q.includes(i))||l.category&&l.category.toLowerCase().includes(i)||l.sub&&l.sub.toLowerCase().includes(i),C=!c||l.category===c,$=!s||l.sub===s,N=!y||L(l.status)===y;return A&&C&&$&&N}),p=i?d("equipment.list.emptyFiltered","⚠️ لا توجد معدات مطابقة."):d("equipment.list.empty","لا توجد معدات مسجلة بعد."),f=m;e.innerHTML=f.length?f.map(At).join(""):he(p);const v=document.getElementById("equipment-list-count");if(v){const l=d("equipment.list.countSuffix","عنصر"),b=E(String(f.length)),S=f.length?`${b} ${l}`:`0 ${l}`;v.textContent=S}It(n)}async function ye({showToastOnError:e=!0}={}){Se=!0,G="",B();try{const t=await j("/equipment/?all=1"),n=Array.isArray(t?.data)?t.data.map(de):[];O(n)}catch(t){G=z(t,"equipment.toast.fetchFailed","تعذر تحميل قائمة المعدات"),e&&g(G,"error")}finally{Se=!1,B()}}function z(e,t,n){if(e instanceof De){const a=e.payload?.errors;if(a&&typeof a=="object"){const r=Object.values(a)[0];if(Array.isArray(r))return r[0];if(typeof r=="string")return r}if(e.message)return e.message}return d(t,n)}async function Nt(e){e.preventDefault();const t=e.target,n=t.querySelector("#new-equipment-desc")?.value?.trim()||"",a=t.querySelector("#new-equipment-barcode")?.value||"",r=E(a).trim(),o=le(t.querySelector("#new-equipment-price")?.value||"0"),i=Y(t.querySelector("#new-equipment-qty")?.value||"1"),c=t.querySelector("#new-equipment-image")?.value?.trim()||"",s=t.querySelector("#new-equipment-category")?.value?.trim()||"",u=t.querySelector("#new-equipment-sub")?.value?.trim()||"",y=t.querySelector("#new-equipment-status")?.value||"متاح";if(!n||!r){g(d("equipment.toast.missingFields","⚠️ يرجى إدخال الوصف والباركود"));return}const m=Be({category:s,subcategory:u,description:n,quantity:i,unit_price:o,barcode:r,status:y,image_url:c});try{const p=await j("/equipment/",{method:"POST",body:m}),f=de(p?.data),v=[...x(),f];O(v),B(),t.reset();const l=t.querySelector("#new-equipment-status");l&&(l.value="متاح"),g(d("equipment.toast.addSuccess","✅ تم إضافة المعدة"))}catch(p){const f=z(p,"equipment.toast.addFailed","تعذر إضافة المعدة");g(f,"error")}}async function Ve(e){if(!J()){ce();return}const t=x(),n=t[e];if(n&&confirm(d("equipment.toast.deleteConfirm","❌ هل أنت متأكد من حذف هذه المعدة؟")))try{n.id&&await j(`/equipment/?id=${encodeURIComponent(n.id)}`,{method:"DELETE"});const a=[...t];a.splice(e,1),O(a),B(),g(d("equipment.toast.deleteSuccess","🗑️ تم حذف المعدة"))}catch(a){const r=z(a,"equipment.toast.deleteFailed","تعذر حذف المعدة، يرجى المحاولة مجدداً");g(r,"error")}}async function xt(e,t){const n=x(),a=n[e];if(!a)throw new Error("Equipment item not found");if(!a.id){const o=[...n];o[e]={...o[e],...t},O(o),B();return}const r=Be({category:t.category,subcategory:t.sub,description:t.desc,quantity:t.qty,unit_price:t.price,barcode:t.barcode,status:t.status,image_url:t.image});try{const o=await j(`/equipment/?id=${encodeURIComponent(a.id)}`,{method:"PATCH",body:r}),i=de(o?.data),c=[...n];c[e]=i,O(c),B(),g(d("equipment.toast.updateSuccess","✅ تم تحديث بيانات المعدة بنجاح"))}catch(o){const i=z(o,"equipment.toast.updateFailed","تعذر تحديث بيانات المعدة");throw g(i,"error"),o}}function te(){B()}function ze(e){const n=x()[e];if(!n)return;w=e;const a=me(n),r=a[0]||n,o=a.reduce((s,u)=>s+(Number.isFinite(Number(u.qty))?Number(u.qty):0),0),i=["maintenance","reserved","available","retired"],c=a.map(s=>L(s.status)).sort((s,u)=>i.indexOf(s)-i.indexOf(u))[0]||L(r.status);document.getElementById("edit-equipment-index").value=e,xe({category:r.category||"",subcategory:r.sub||"",description:r.desc||r.description||"",quantity:String(o||r.qty||0),price:r.price!=null?String(r.price):"0",image:fe(r)||"",barcode:r.barcode||"",status:r.status||c}),X(!1),k=se(),pe(r),He(r),D={groupKey:R(r),barcode:String(r.barcode||""),id:r.id||null},pt(document.getElementById("editEquipmentModal"))?.show()}function Bt(e){const t=e.target.closest('[data-equipment-action="delete"]');if(t){e.preventDefault(),e.stopPropagation();const a=Number(t.dataset.equipmentIndex);Number.isNaN(a)||Ve(a).catch(r=>{console.error("❌ [equipment.js] deleteEquipment",r)});return}const n=e.target.closest('[data-equipment-card="true"]');if(n){const a=Number(n.dataset.equipmentIndex);Number.isNaN(a)||ze(a)}}function Ct(e){if(e.defaultPrevented||e.target.closest("[data-equipment-action]"))return;const t=e.target.closest('[data-equipment-card="true"]');if(t&&(e.key==="Enter"||e.key===" ")){e.preventDefault();const n=Number(t.dataset.equipmentIndex);Number.isNaN(n)||ze(n)}}function Ft(e){const t=e.target.closest('[data-variant-action="delete"]');if(t){const n=Number(t.dataset.variantIndex);Number.isNaN(n)||Ve(n).catch(a=>{console.error("❌ [equipment.js] deleteEquipment",a)});return}}function Qe(){if(!D||!document.getElementById("editEquipmentModal")?.classList.contains("show"))return;const n=x(),a=D.id?n.find(s=>String(s.id)===String(D.id)):null,r=D.groupKey,o=r?n.find(s=>R(s)===r):null,i=a||o;if(!i){oe();return}const c=n.findIndex(s=>s===i);if(c>=0){const s=document.getElementById("edit-equipment-index");s&&(s.value=String(c)),w=c}if(He(i),!ue){const s=me(i),u=s[0]||i,y=s.reduce((f,v)=>f+(Number.isFinite(Number(v.qty))?Number(v.qty):0),0),m=["maintenance","reserved","available","retired"],p=s.map(f=>L(f.status)).sort((f,v)=>m.indexOf(f)-m.indexOf(v))[0]||L(u.status);xe({category:u.category||"",subcategory:u.sub||"",description:u.desc||u.description||"",quantity:String(y||u.qty||0),price:u.price!=null?String(u.price):"0",image:fe(u)||"",barcode:u.barcode||"",status:u.status||p}),k=se()}pe(primary)}function $t(){document.getElementById("search-equipment")?.addEventListener("input",te),document.getElementById("filter-category")?.addEventListener("change",te),document.getElementById("filter-sub")?.addEventListener("change",te),document.getElementById("filter-status")?.addEventListener("change",te),document.getElementById("add-equipment-form")?.addEventListener("submit",Nt);const e=document.getElementById("equipment-clear-btn");e&&!e.dataset.listenerAttached&&(e.addEventListener("click",a=>{a.preventDefault(),St().catch(r=>{console.error("❌ [equipment.js] clearEquipment",r)})}),e.dataset.listenerAttached="true");const t=document.getElementById("equipment-list");t&&!t.dataset.listenerAttached&&(t.addEventListener("click",Bt),t.addEventListener("keydown",Ct),t.dataset.listenerAttached="true");const n=document.getElementById("equipment-variants-table-body");n&&!n.dataset.listenerAttached&&(n.addEventListener("click",Ft),n.dataset.listenerAttached="true"),["edit-equipment-quantity","edit-equipment-price","edit-equipment-barcode"].forEach(a=>{const r=document.getElementById(a);bt(r)})}document.getElementById("save-equipment-changes")?.addEventListener("click",async()=>{if(!ue){k=se(),X(!0);return}const e=document.getElementById("edit-equipment-index").value,t=Number.parseInt(e,10);if(Number.isNaN(t)){g(d("equipment.toast.updateFailed","تعذر تحديث بيانات المعدة"),"error");return}const n={category:document.getElementById("edit-equipment-category").value,sub:document.getElementById("edit-equipment-subcategory").value,desc:document.getElementById("edit-equipment-description").value,qty:Y(document.getElementById("edit-equipment-quantity").value)||1,price:le(document.getElementById("edit-equipment-price").value)||0,barcode:E(document.getElementById("edit-equipment-barcode").value).trim(),status:document.getElementById("edit-equipment-status").value,image:document.getElementById("edit-equipment-image").value};try{await xt(t,n),k=se(),X(!1),Qe()}catch(a){console.error("❌ [equipment.js] editEquipment",a)}});document.addEventListener("DOMContentLoaded",()=>{$t(),B(),ye();const e=document.getElementById("equipment-edit-cancel");e&&!e.dataset.listenerAttached&&(e.addEventListener("click",()=>{if(k&&xe(k),w!=null){const a=x()[w];if(a){const o=me(a)[0]||a;pe(o)}}X(!1)}),e.dataset.listenerAttached="true");const t=document.getElementById("save-equipment-changes");t&&!t.dataset.listenerAttached&&(t.dataset.listenerAttached="true",t.dataset.mode||(t.dataset.mode="view"))});document.addEventListener("language:changed",()=>{if(B(),X(ue),w!=null){const t=x()[w];if(t){const a=me(t)[0]||t;pe(a)}}});document.addEventListener("equipment:refreshRequested",()=>{ye({showToastOnError:!1})});document.addEventListener(tt.USER_UPDATED,()=>{B()});document.addEventListener("equipment:changed",()=>{Qe()});document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("editEquipmentModal");e&&!e.dataset.variantsListenerAttached&&(e.addEventListener("hidden.bs.modal",()=>{D=null,oe(),w=null,k=null,X(!1)}),e.dataset.variantsListenerAttached="true")});function Ke(e=""){return E(String(e)).trim().toLowerCase()}const jt=2;function Tt(e){const t=Number(e);return Number.isFinite(t)?t.toFixed(jt):"0.00"}function Te(e={}){const t=Number(e?.qty);return Number.isFinite(t)&&t>0?t:1}function Pt(e={}){const t=e?.desc||e?.description||e?.name||"",n=Ke(t),a=Tt(e?.price??e?.unitPrice??e?.unit_price??0);return`${n}::${a}`}function Qt(e=[]){const t=new Map;return e.forEach((n,a)=>{const r=Pt(n);if(!r)return;if(!t.has(r)){const i=n?.desc||n?.description||n?.name||"",c=Ke(i),s=Pe(n),u=n?.image||n?.imageUrl||n?.img||"";t.set(r,{key:r,description:i,normalizedDescription:c,unitPrice:s,image:u,items:[],itemIndices:[],barcodes:[]})}const o=t.get(r);o.items.push(n),o.itemIndices.push(a),n?.barcode&&o.barcodes.push(String(n.barcode))}),Array.from(t.values()).map(n=>({...n,quantity:n.items.reduce((a,r)=>a+Te(r),0)})).map(n=>{const a=n.quantity||0,r=n.items.reduce((i,c)=>{const s=Pe(c),u=Te(c);return i+s*u},0),o=a>0?r/a:n.unitPrice;return{...n,quantity:a,count:a,totalPrice:r,unitPrice:o}})}function Kt(e={}){const t=[e?.id,e?.equipment_id,e?.equipmentId,e?.item_id,e?.itemId];for(const n of t)if(!(n==null||n===""))return String(n);return null}function Pe(e={}){const t=e?.price??e?.unit_price??e?.unitPrice??0,n=Number(t);return Number.isFinite(n)?n:0}function Wt(e){if(!e?.end)return!1;const t=new Date(e.end);return Number.isNaN(t.getTime())?!1:t<new Date}function Mt(e=""){switch(String(e??"").trim().toLowerCase()){case"confirmed":case"مؤكد":return"confirmed";case"in_progress":case"in-progress":case"قيد التنفيذ":case"جاري":return"in_progress";case"completed":case"مكتمل":return"completed";case"cancelled":case"ملغي":return"cancelled";case"pending":case"draft":case"قيد الانتظار":case"بانتظار التأكيد":case"معلق":default:return"pending"}}function Rt(e={},t=null){const n=e?.confirmed===!0||e?.confirmed==="true",a=e?.projectId??e?.project_id??null,r=a!=null&&a!==""&&a!=="null",o=r?Mt(t?.status??t?.status_label??t?.statusLabel??""):null,i=r&&(t?.confirmed===!0||["confirmed","in_progress","completed"].includes(o));return{reservationConfirmed:n,projectLinked:r,projectStatus:o,projectConfirmed:i,effectiveConfirmed:r?i:n}}function We(){const e=()=>{Xe(),B(),it()};if(typeof window<"u"){if(typeof window.requestIdleCallback=="function"){window.requestIdleCallback(e,{timeout:200});return}if(typeof window.requestAnimationFrame=="function"){window.requestAnimationFrame(e);return}}e()}let Me=!1,Re=null;function Dt(e){if(!e||typeof e!="object")return"";const t=Object.entries(e).filter(([n,a])=>a!=null).map(([n,a])=>[n,String(a)]);return t.length===0?"":JSON.stringify(t.sort(([n],[a])=>n.localeCompare(a)))}async function Gt(e={}){const{suppressError:t=!0,params:n=null,force:a=!1}=e??{},r=Dt(n);if(!a&&Me&&W().length>0&&r===Re)return W();try{const o=await nt(n||{});return Me=!0,Re=r,o}catch(o){if(console.error("❌ [reservationsActions] Failed to load reservations from API",o),!t)throw o;return W()}}async function Jt(e,{onAfterChange:t}={}){if(!J())return ce(),!1;const a=W()[e];if(!a)return g(d("reservations.toast.notFound","⚠️ تعذر العثور على بيانات الحجز")),!1;const r=a.id||a.reservationId;if(!r)return g(d("reservations.toast.notFound","⚠️ تعذر العثور على بيانات الحجز")),!1;try{return await at(r),We(),t?.({type:"deleted",reservation:a}),g(d("reservations.toast.deleted","🗑️ تم حذف الحجز")),!0}catch(o){console.error("❌ [reservationsActions] deleteReservation failed",o);const i=we(o)?o.message:d("reservations.toast.deleteFailed","تعذر حذف الحجز، حاول مرة أخرى");return g(i,"error"),!1}}async function Yt(e,{onAfterChange:t}={}){const a=W()[e];if(!a)return g(d("reservations.toast.notFound","⚠️ تعذر العثور على بيانات الحجز")),!1;const r=a.id||a.reservationId;if(!r)return g(d("reservations.toast.notFound","⚠️ تعذر العثور على بيانات الحجز")),!1;const{projectLinked:o}=Rt(a);if(o)return g(d("reservations.toast.confirmBlockedByProject","⚠️ حالة هذا الحجز تتحكم بها حالة المشروع المرتبط ولا يمكن تأكيده من هنا"),"info"),!1;try{const i=await rt(r);return We(),t?.({type:"confirmed",reservation:i}),g(d("reservations.toast.confirmed","✅ تم تأكيد الحجز")),!0}catch(i){console.error("❌ [reservationsActions] confirmReservation failed",i);const c=we(i)?i.message:d("reservations.toast.confirmFailed","تعذر تأكيد الحجز، حاول مرة أخرى");return g(c,"error"),!1}}const wt=_e()||{};let F=(wt.projects||[]).map(Ot),Z=!1;function Zt(){return F}function ge(e){F=Array.isArray(e)?e.map(Fe):[],Ae({projects:F});try{const t=new CustomEvent("projects:changed");typeof window<"u"&&typeof window.dispatchEvent=="function"&&window.dispatchEvent(t),typeof document<"u"&&typeof document.dispatchEvent=="function"&&document.dispatchEvent(t)}catch(t){console.warn("⚠️ [projectsService] Failed to dispatch projects:changed event",t)}return F}async function kt(e={}){const t=new URLSearchParams;Object.entries(e).forEach(([c,s])=>{s==null||s===""||t.set(c,String(s))});const n=t.toString(),r=(await j(`/projects/${n?`?${n}`:""}`))?.data;let o=[];Array.isArray(r)?o=r:r&&typeof r=="object"&&(Array.isArray(r.items)?o=r.items:Array.isArray(r.results)?o=r.results:Array.isArray(r.data)?o=r.data:Array.isArray(r.records)&&(o=r.records));const i=o.map(Ce);return ge(i),Z=!0,F}async function en({force:e=!1,params:t=null}={}){if(!e&&Z&&F.length>0)return F;try{return await kt(t||{})}catch(n){return console.error("❌ [projectsService] Failed to load projects from API",n),F}}async function tn(e){const t=await j("/projects/",{method:"POST",body:e}),n=Ce(t?.data??{}),a=[...F,n];return ge(a),Z=!0,n}async function nn(e,t){const n=await j(`/projects/?id=${encodeURIComponent(e)}`,{method:"PATCH",body:t}),a=Ce(n?.data??{}),r=F.map(o=>String(o.id)===String(e)?a:o);return ge(r),Z=!0,a}async function an(e){await j(`/projects/?id=${encodeURIComponent(e)}`,{method:"DELETE"});const t=F.filter(n=>String(n.id)!==String(e));ge(t),Z=!0}function rn({projectCode:e,title:t,type:n,clientId:a,clientCompany:r,description:o,start:i,end:c,applyTax:s,paymentStatus:u,equipmentEstimate:y=0,expenses:m=[],taxAmount:p=0,totalWithTax:f=0,confirmed:v=!1,technicians:l=[],equipment:b=[]}={}){const S=Array.isArray(l)?l.map(q=>Number.parseInt(String(q),10)).filter(q=>Number.isInteger(q)&&q>0):[],A=Array.isArray(b)?b.map(q=>{const h=Number.parseInt(String(q.equipmentId??q.equipment_id??q.id??0),10),_=Number.parseInt(String(q.qty??q.quantity??0),10);return!Number.isInteger(h)||h<=0?null:{equipment_id:h,quantity:Number.isInteger(_)&&_>0?_:1}}).filter(Boolean):[],C=Array.isArray(m)?m.map(q=>{const h=Number.parseFloat(q?.amount??q?.value??0)||0,_=(q?.label??q?.name??"").trim();return _?{label:_,amount:Math.round(h*100)/100}:null}).filter(Boolean):[],$=C.reduce((q,h)=>q+(h?.amount??0),0),N={title:t,type:n,client_id:a?Number.parseInt(String(a),10):null,client_company:r??null,description:o??null,start_datetime:i??null,end_datetime:c||null,apply_tax:!!s,payment_status:u??"unpaid",equipment_estimate:Number.parseFloat(y)||0,expenses_total:Math.round($*100)/100,tax_amount:Math.round((Number.parseFloat(p)||0)*100)/100,total_with_tax:Math.round((Number.parseFloat(f)||0)*100)/100,confirmed:!!v,technicians:S,equipment:A,expenses:C};return e&&(N.project_code=String(e).trim()),N.end_datetime||delete N.end_datetime,N.client_company||(N.client_company=null),N}function Ce(e={}){return Fe(e)}function Ot(e={}){return Fe(e)}function Fe(e={}){const t=e.id??e.projectId??e.project_id??null,n=Array.isArray(e.technicians)?e.technicians:[],a=n.map(s=>{if(s==null)return null;if(typeof s=="object"){const u=s.id??s.technician_id??s.technicianId;return u!=null?String(u):null}return String(s)}).filter(Boolean),o=(Array.isArray(e.equipment)?e.equipment:[]).map(s=>{const u=s?.equipment_id??s?.equipmentId??s?.id??null,y=s?.quantity??s?.qty??0,m=s?.barcode??s?.code??"",p=s?.description??s?.name??"";return{equipmentId:u!=null?String(u):null,qty:Number.parseInt(String(y),10)||0,barcode:m,description:p}}),c=(Array.isArray(e.expenses)?e.expenses:[]).map((s,u)=>({id:s?.id??`expense-${t??"x"}-${u}`,label:s?.label??"",amount:Number.parseFloat(s?.amount??0)||0}));return{id:t!=null?String(t):"",projectId:t!=null?Number(t):null,projectCode:e.project_code??e.projectCode??null,title:e.title??"",type:e.type??e.projectType??"",clientId:e.client_id!=null?String(e.client_id):e.clientId??null,clientCompany:e.client_company??e.clientCompany??"",description:e.description??"",start:e.start_datetime??e.start??null,end:e.end_datetime??e.end??null,applyTax:!!(e.apply_tax??e.applyTax??!1),paymentStatus:e.payment_status??e.paymentStatus??"unpaid",equipmentEstimate:Number.parseFloat(e.equipment_estimate??e.equipmentEstimate??0)||0,expensesTotal:Number.parseFloat(e.expenses_total??e.expensesTotal??0)||0,taxAmount:Number.parseFloat(e.tax_amount??e.taxAmount??0)||0,totalWithTax:Number.parseFloat(e.total_with_tax??e.totalWithTax??0)||0,confirmed:!!(e.confirmed??!1),createdAt:e.created_at??e.createdAt??null,updatedAt:e.updated_at??e.updatedAt??null,technicians:a,techniciansDetails:n.map(s=>typeof s=="object"?s:{id:s}),equipment:o,expenses:c}}function sn(e){return e instanceof De}export{ye as a,B as b,Vt as c,rn as d,Gt as e,nn as f,en as g,Zt as h,Wt as i,an as j,kt as k,sn as l,Ce as m,Ke as n,tn as o,Qt as p,Kt as q,Rt as r,Xe as s,Pt as t,zt as u,Jt as v,Yt as w};
