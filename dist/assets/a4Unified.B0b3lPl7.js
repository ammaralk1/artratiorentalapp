import{r as P,t as i,e as L,d as M,b as k,p as z}from"./calculations.BppzIcTJ.js";import{e as H,l as I,a as X,b as G}from"./reports.BpPIqrZx.js";import"./reservationsService.Ci1ZAohu.js";import"./auth.D3LS69gm.js";import"./dashboard.Df9YY28K.js";import"./controller.CsVADLwI.js";/* empty css              */import"./dashboardShell.AOCSdMnW.js";import"./customers.C1SKeFzI.js";import"./maintenanceService.C2aETs40.js";const J=`@page { size: A4; margin: 0; }
@import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;600;700;800&display=swap');

/* جذر وثيقة A4 للمعاينة/التصدير */
#reports-a4-root {
  color-scheme: light;
  direction: rtl;
  text-align: right;
  font-family: 'Tajawal', 'Arial', 'Tahoma', sans-serif;
  color: #000 !important;
}

/* إزالة تأثيرات الثيم والظلال كلياً داخل الجذر */
#reports-a4-root, #reports-a4-root * {
  color: #000 !important; background: #fff !important; box-shadow: none !important; filter: none !important;
  letter-spacing: normal !important; word-spacing: normal !important; font-kerning: normal !important; font-variant-ligatures: normal !important;
  -webkit-font-smoothing: antialiased; text-rendering: optimizeLegibility;
}

/* حاوية الصفحات */
#reports-a4-root [data-a4-pages] {
  display: flex; flex-direction: column; gap: 0; padding: 0; margin: 0; align-items: center; justify-content: flex-start;
}

/* صفحة A4 ثابتة بالبكسل، بدون أي هوامش خارجية */
.a4-page {
  position: relative;
  width: 794px; /* 210mm @ 96dpi */
  height: 1123px; /* 297mm @ 96dpi */
  overflow: hidden; background: #fff; border-radius: 0; margin: 0; padding: 0;
}

/* طبقة داخلية تمتد على كامل الصفحة وتُطبّق الحشوات بالـ mm */
.a4-inner { position: absolute; inset: 0; padding: 12mm 14mm 12mm; }
.a4-page--primary .a4-inner { padding-top: 6mm; }

/* العناوين والـ KPI */
.rpt-header { display: flex; flex-direction: column; gap: 8px; margin: 0 0 6mm 0; }
.rpt-header-top { display: flex; align-items: center; justify-content: space-between; gap: 12px; }
.rpt-titleblock { display: flex; flex-direction: column; gap: 4px; text-align: right; }
.rpt-header h1 { margin: 0; font-weight: 800; font-size: 18px; text-align: right; }
.rpt-subtitle { margin: 0; font-size: 12px; opacity: .9; text-align: right; }
.rpt-logo { width: 56px; height: 56px; object-fit: contain; border-radius: 12px; border: 1px solid #e5e7eb; background: #fff; }

.rpt-kpis { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin: 8px 0 6mm; }
.rpt-kpi { border: 1px solid #e5e7eb; border-radius: 8px; padding: 8px 10px; }
.rpt-kpi .label { font-size: 11px; opacity: .85; }
.rpt-kpi .value { font-weight: 700; font-size: 14px; }

/* الجدول */
.rpt-table { width: 100%; border-collapse: collapse; font-size: 11px; border: 1px solid #9ca3af; table-layout: fixed; print-color-adjust: exact; -webkit-print-color-adjust: exact; }
.rpt-table tbody tr:last-child td { border-bottom: 1px solid #9ca3af; }
.rpt-table td, .rpt-table th { vertical-align: middle; border-color: #9ca3af; }
/* تأكيد إغلاق الحواف الخارجية يمين/يسار وأعلى/أسفل */
.rpt-table thead tr:first-child th { border-top: 1px solid #9ca3af; }
.rpt-table thead th:first-child, .rpt-table tbody td:first-child { border-right: 1px solid #9ca3af; }
.rpt-table thead th:last-child, .rpt-table tbody td:last-child { border-left: 1px solid #9ca3af; }
.rpt-table tbody tr + tr td { border-top: 1px solid #9ca3af; }
/* تفاصيل الجسم فقط أصغر وبسطر واحد */
.rpt-table tr { height: 26px; }
.rpt-table tbody td { font-size: 10px; line-height: 1; height: 26px; padding: 0 !important; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; border: 1px solid #9ca3af; position: relative; }

/* تفاصيل الإيرادات داخل المعاينة */
.rpt-revenue {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 8px 12px;
  margin: 6mm 0 6mm;
}
.rpt-revenue__item { display: flex; align-items: center; justify-content: space-between; border: 1px solid #9ca3af; border-radius: 8px; padding: 8px 10px; }
.rpt-revenue__label { font-size: 11px; opacity: .9; }
.rpt-revenue__value { font-weight: 700; font-size: 13px; }
.rpt-revenue__title { margin: 0 0 6px 0; font-size: 13px; font-weight: 800; }
.rpt-table th { background: #f3f4f6 !important; color: #000 !important; border: 1px solid #9ca3af; padding: 6px 8px; text-align: right; font-weight: 800; }
.rpt-table td { background: #ffffff !important; color: #000 !important; border: 1px solid #9ca3af; padding: 0 !important; text-align: right; height: 24px; }

/* عنوان جدول تفاصيل الحجوزات */
.rpt-table-title {
  margin: 6mm 0 3mm;
  font-size: 13px;
  font-weight: 800;
}

/* تحسين ظهور الحدود في وضع المعاينة (قد تضيع عند التصغير) */
#reports-a4-root[data-render-context="preview"] .rpt-table { border-width: 2px; outline: 2px solid #475569; outline-offset: 0; box-shadow: inset 0 0 0 2px #475569; }
#reports-a4-root[data-render-context="preview"] .rpt-table th,
#reports-a4-root[data-render-context="preview"] .rpt-table td { border-color: #475569; border-width: 1.5px; }

/* توسيط المحتوى عمودياً داخل الخلايا بشكل صريح */
.rpt-table th, .rpt-table td { vertical-align: middle !important; }
.rpt-cell { display: flex; align-items: center; justify-content: flex-start; height: 26px; min-height: 26px; width: 100%; padding: 0 8px; box-sizing: border-box; line-height: 1; direction: rtl; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

/* إخفاء العناصر حسب التفضيلات */
#reports-a4-root[data-hide-header] .rpt-header { display: none !important; }
#reports-a4-root[data-hide-kpis] .rpt-kpis { display: none !important; }
#reports-a4-root[data-hide-revenue] .rpt-revenue-section { display: none !important; }
#reports-a4-root[data-hide-outstanding] .rpt-outstanding-section { display: none !important; }

.rpt-outstanding-section { margin: 4mm 0 6mm; }
.rpt-outstanding__title { margin: 0 0 6px 0; font-size: 13px; font-weight: 800; }
.rpt-outstanding__table { width: 100%; border-collapse: collapse; font-size: 11px; border: 1px solid #9ca3af; }
.rpt-outstanding__table th { background: #f3f4f6; border: 1px solid #9ca3af; padding: 6px 8px; text-align: right; }
.rpt-outstanding__table td { border: 1px solid #9ca3af; padding: 4px 8px; text-align: right; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

/* قواعد الطباعة لتفادي الصفحات الفارغة في iOS/Safari */
@media print {
  /* لا تستخدم Flex للحاوية أثناء الطباعة لتجنب حسابات الارتفاع غير الدقيقة */
  #reports-a4-root [data-a4-pages] { display: block !important; }
  /* أجبر فاصل صفحة بعد كل صفحة ما عدا الأخيرة */
  .a4-page { page-break-after: always; break-after: page; }
  .a4-page:last-child { page-break-after: auto; break-after: auto; }
  /* لا تسمح بتقسيم محتويات صفحة واحدة بين صفحتين */
  .a4-page, .a4-inner { break-inside: avoid; -webkit-column-break-inside: avoid; }
}
`,A=96,O=25.4,D=210,$=297,j=Math.round(D/O*A),T=Math.round($/O*A);function B(){try{return{header:localStorage.getItem("reportsPdf.hide.header")==="1",kpis:localStorage.getItem("reportsPdf.hide.kpis")==="1",revenue:localStorage.getItem("reportsPdf.hide.revenue")==="1",outstanding:localStorage.getItem("reportsPdf.hide.outstanding")==="1"}}catch{return{header:!1,kpis:!1,revenue:!1}}}function K(e,t){!e||!t||(e.toggleAttribute("data-hide-header",!!t.header),e.toggleAttribute("data-hide-kpis",!!t.kpis),e.toggleAttribute("data-hide-revenue",!!t.revenue),e.toggleAttribute("data-hide-outstanding",!!t.outstanding))}function V(e="preview"){const t=document.createElement("div");t.id="reports-a4-root",t.setAttribute("dir",document.documentElement.getAttribute("dir")||"rtl"),t.setAttribute("data-render-context",e);const o=document.createElement("style");o.textContent=String(J).trim(),t.appendChild(o);const l=document.createElement("div");return l.setAttribute("data-a4-pages",""),t.appendChild(l),K(t,B()),t}function W(){const e=document.createElement("div");e.className="rpt-header";const t=document.createElement("div");t.className="rpt-header-top";const o=document.createElement("div");o.className="rpt-titleblock";const l=document.createElement("h1");l.textContent=i("reservations.reports.print.title","تقرير الحجوزات","Reservations report");const r=document.createElement("p");r.className="rpt-subtitle",r.textContent=`${L(new Date)} • ${i("reservations.reports.print.generated","تاريخ التوليد","Generated on")}`,o.appendChild(l),o.appendChild(r);const d=document.createElement("img");return d.className="rpt-logo",d.alt="Logo",d.decoding="async",d.loading="lazy",d.src=U(),t.appendChild(o),t.appendChild(d),e.appendChild(t),e}function S(e){return Number.isFinite(Number(e))?Math.round(Number(e)*100)/100:0}function q(){const e=P.lastSnapshot?.metrics||{},t=document.createElement("div");t.className="rpt-kpis";const o=(h,m)=>{const c=document.createElement("div");return c.className="rpt-kpi",c.innerHTML=`<div class="label">${h}</div><div class="value">${m??"—"}</div>`,c},l=M(e.total||0),r=k(S(e.revenue)),d=k(S(e.netProfit)),p=k(S(e.companyShareTotal)),w=k(S(e.taxTotal)),b=k(S(e.maintenanceExpense));return t.appendChild(o(i("reservations.reports.kpi.total.label","الحجوزات","Reservations"),l)),t.appendChild(o(i("reservations.reports.kpi.revenue.label","الإيرادات","Revenue"),r)),t.appendChild(o(i("reservations.reports.kpi.net.label","صافي الربح","Net profit"),d)),t.appendChild(o(i("reservations.reports.kpi.share.label","نسبة الشركة","Company share"),p)),t.appendChild(o(i("reservations.reports.kpi.tax.label","الضريبة","Tax"),w)),t.appendChild(o(i("reservations.reports.kpi.maintenance.label","مصاريف الصيانة","Maintenance"),b)),t}function Z(){const e=P.lastSnapshot?.metrics||{},t=document.createElement("section");t.className="rpt-revenue-section";const o=document.createElement("h4");o.className="rpt-revenue__title",o.textContent=i("reservations.reports.kpi.revenue.details.title","تفاصيل الإيرادات","Revenue details");const l=document.createElement("div");l.className="rpt-revenue";const r=(p,w)=>{const b=document.createElement("div");b.className="rpt-revenue__item";const h=document.createElement("span");h.className="rpt-revenue__label",h.textContent=p;const m=document.createElement("strong");m.className="rpt-revenue__value",m.textContent=w,b.appendChild(h),b.appendChild(m),l.appendChild(b)},d=p=>k(S(p||0));return r(i("reservations.reports.kpi.revenue.details.gross","الإيراد الكلي","Gross revenue"),d(e.revenue)),r(i("reservations.reports.kpi.revenue.details.share","نسبة الشركة","Company share"),d(e.companyShareTotal)),r(i("reservations.reports.kpi.revenue.details.tax","الضريبة","Tax"),d(e.taxTotal)),r(i("reservations.reports.kpi.revenue.details.crewGross","إجمالي الطاقم","Crew total"),d(e.crewTotal)),r(i("reservations.reports.kpi.revenue.details.crew","تكلفة الطاقم","Crew cost"),d(e.crewCostTotal)),Number.isFinite(Number(e.maintenanceExpense))&&r(i("reservations.reports.kpi.revenue.details.maintenance","مصاريف الصيانة","Maintenance"),d(e.maintenanceExpense)),r(i("reservations.reports.kpi.revenue.details.net","صافي الربح","Net profit"),d(e.netProfit)),t.appendChild(o),t.appendChild(l),t}function Y(){const e=(P.lastSnapshot?.outstanding||[]).slice(0,6),t=document.createElement("section");t.className="rpt-outstanding-section";const o=document.createElement("h4");if(o.className="rpt-outstanding__title",o.textContent=i("reservations.reports.topOutstanding.title","أعلى المستحقات","Top outstanding"),t.appendChild(o),!e.length){const p=document.createElement("p");return p.style.fontSize="11px",p.style.opacity=".8",p.textContent=i("reservations.reports.table.emptyPeriod","لا توجد بيانات في هذه الفترة.","No data for this period."),t.appendChild(p),t}const l=document.createElement("table");l.className="rpt-outstanding__table";const r=document.createElement("thead");document.createElement("tr"),["الحجز / العميل","حالة الدفع","المستحق"].forEach((p,w)=>{const b=document.createElement("th"),h=w===0?i("reservations.reports.topOutstanding.headers.reservation","الحجز / العميل","Reservation / Customer"):w===1?i("reservations.reports.topOutstanding.headers.status","حالة الدفع","Payment status"):i("reservations.reports.topOutstanding.headers.amount","المستحق","Outstanding");b.textContent=h,r.appendChild(b)});const d=document.createElement("tbody");return e.forEach(p=>{const w=document.createElement("tr"),b=document.createElement("td");b.textContent=`#${p.code} — ${p.customer||""}`,w.appendChild(b);const h=document.createElement("td");h.textContent=z(p.paidStatus),w.appendChild(h);const m=document.createElement("td");m.textContent=k(p.outstanding),w.appendChild(m),d.appendChild(w)}),l.appendChild(r),l.appendChild(d),t.appendChild(l),t}function Q(e){const t=document.createElement("table");t.className="rpt-table";const o=document.createElement("thead"),l=document.createElement("tr");e.forEach(d=>{const p=document.createElement("th");p.textContent=d,l.appendChild(p)}),o.appendChild(l);const r=document.createElement("tbody");return t.appendChild(o),t.appendChild(r),{table:t,tbody:r}}function ee(e,t){const r=[];for(let d=0;d<e.length;d+=28)r.push(e.slice(d,d+28));if(r.length){const d=r[0];if(d.length>18){const p=d.splice(18);r.length>1?r[1]=p.concat(r[1]):r.push(p)}}return r}function te(e=""){const t=String(e||"").toLowerCase();return/الحجز|reservation/.test(t)||/العميل|customer/.test(t)||/التاريخ|date/.test(t)||/الحالة|status/.test(t)||/الدفع|payment/.test(t)||/الإجمالي|total/.test(t)}function _(e=[]){try{const t=new Set;return e.forEach(o=>{const l=`reportsPdf.column.${o}`,r=localStorage.getItem(l);r==null?te(o)&&t.add(o):r==="1"&&t.add(o)}),t.size===0&&e.forEach(o=>t.add(o)),t}catch{return new Set(e)}}function F(e,t,o){if(!o)return e;const l=o.showPaid??!0,r=o.showPartial??!0,d=o.showUnpaid??!0,p=o.showConfirmed??!0,w=o.showPending??!0,b=o.showCompleted??!0,h=o.showCancelled??!0,m=t.find(n=>/الحالة|status/i.test(n))||null,c=t.find(n=>/الدفع|payment/i.test(n))||null;if(!m&&!c)return e;const g=n=>/جزئ|partial/i.test(String(n||"")),y=n=>/مدفوعة|مدفوع|paid/i.test(String(n||""))&&!g(n),f=n=>/غير مدفوعة|غير مدفوع|unpaid/i.test(String(n||"")),v=n=>{const a=String(n||"").toLowerCase();return/completed|منته/.test(a)?"completed":/confirmed|مؤكد/.test(a)?"confirmed":/pending|غير مؤكد|قيد التأكيد/.test(a)?"pending":/cancel|ملغ/.test(a)?"cancelled":"other"};return e.filter(n=>{let a=!0;if(c){const s=n[c];!l&&y(s)&&(a=!1),!r&&g(s)&&(a=!1),!d&&f(s)&&(a=!1)}if(m){const s=v(n[m]);!b&&s==="completed"&&(a=!1),!p&&s==="confirmed"&&(a=!1),!w&&s==="pending"&&(a=!1),!h&&s==="cancelled"&&(a=!1)}return a})}function N(e=[],{context:t="preview",columns:o,rowFilters:l}={}){const r=V(t),d=r.querySelector("[data-a4-pages]"),p=Array.isArray(e)&&e.length?e:P.lastSnapshot?.tableRows||[];let w=Object.keys(p[0]||{});const b=o&&o.length?new Set(o):_(w);w=w.filter(c=>b.has(c));const h=F(p,w,l),m=ee(h);return m.length||m.push([]),m.forEach((c,g)=>{const y=document.createElement("section");y.className=`a4-page ${g===0?"a4-page--primary":"a4-page--continuation"}`,y.style.width=`${j}px`,y.style.height=`${T}px`;const f=document.createElement("div");if(f.className="a4-inner",g===0){f.appendChild(W()),f.appendChild(q()),f.appendChild(Z()),f.appendChild(Y());const a=document.createElement("h4");a.className="rpt-table-title",a.textContent=i("reservations.reports.results.title","تفاصيل الحجوزات","Reservations details"),f.appendChild(a)}const{table:v,tbody:n}=Q(w);c.forEach(a=>{const s=document.createElement("tr");w.forEach(u=>{const x=document.createElement("td"),C=document.createElement("div");C.className="rpt-cell",C.textContent=a[u]!=null?String(a[u]):"",x.appendChild(C),s.appendChild(x)}),n.appendChild(s)}),f.appendChild(v),y.appendChild(f),d.appendChild(y)}),r}async function he(e=[],{action:t="save",strict:o=!1,popupWindow:l=null}={}){const r={showPaid:localStorage.getItem("reportsPdf.rows.paid")!=="0",showPartial:localStorage.getItem("reportsPdf.rows.partial")!=="0",showUnpaid:localStorage.getItem("reportsPdf.rows.unpaid")!=="0",showConfirmed:localStorage.getItem("reportsPdf.rows.confirmed")!=="0",showPending:localStorage.getItem("reportsPdf.rows.pending")!=="0",showCompleted:localStorage.getItem("reportsPdf.rows.completed")!=="0",showCancelled:localStorage.getItem("reportsPdf.rows.cancelled")!=="0"},d=N(e,{context:"export",rowFilters:r}),p=document.createElement("div");Object.assign(p.style,{position:"fixed",top:0,left:0,width:0,height:0,pointerEvents:"none",zIndex:-1}),p.appendChild(d),document.body.appendChild(p);try{if(o||localStorage.getItem("reportsPdf.strict")==="on"){const n=`<!DOCTYPE html><html lang="ar" dir="rtl"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1" /><title>${i("reservations.reports.print.title","تقرير الحجوزات","Reservations report")}</title><style>@page{size:A4;margin:0;}html,body{margin:0;padding:0;background:#fff;direction:rtl;text-align:right;}#reports-a4-root{width:${j}px;height:auto} .a4-page{width:${j}px;height:${T}px} @media print { [data-a4-pages]{display:block!important}.a4-page{page-break-after:always;break-after:page}.a4-page:last-child{page-break-after:auto;break-after:auto}.a4-page,.a4-inner{break-inside:avoid;-webkit-column-break-inside:avoid} }</style></head><body></body></html>`;if(l&&typeof l.document?.open=="function"){const u=l.document;try{u.open(),u.write(n),u.close()}catch{}try{const x=d.cloneNode(!0);u.body.appendChild(x),u.fonts?.ready&&await u.fonts.ready}catch{}await new Promise(x=>setTimeout(x,60));try{l.focus(),l.print()}catch{}setTimeout(()=>{try{l.close()}catch{}},1500);return}await new Promise(u=>setTimeout(u,0));const a=document.createElement("iframe");Object.assign(a.style,{position:"fixed",width:"1px",height:"1px",right:"0",bottom:"0",border:"0",opacity:"0",pointerEvents:"none"}),document.body.appendChild(a);const s=a.contentWindow?.document;try{s.open(),s.write(n),s.close()}catch{}try{const u=d.cloneNode(!0);s.body.appendChild(u),s.fonts?.ready&&await s.fonts.ready}catch{}await new Promise(u=>setTimeout(u,60));try{a.contentWindow?.focus(),a.contentWindow?.print()}catch{}setTimeout(()=>{try{a.remove()}catch{}},1500);return}try{await H()}catch{}let b=window.jspdf&&window.jspdf.jsPDF||window.jsPDF&&window.jsPDF.jsPDF||window.jspdf&&window.jspdf.default&&window.jspdf.default.jsPDF||window.jsPDF&&window.jsPDF.default&&window.jsPDF.default.jsPDF,h=window.html2canvas;if(typeof b!="function")try{await I("https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"),b=window.jspdf&&window.jspdf.jsPDF||window.jsPDF&&window.jsPDF.jsPDF||window.jsPDF&&window.jsPDF.default&&window.jsPDF.default.jsPDF||window.jspdf&&window.jspdf.default&&window.jspdf.default.jsPDF}catch{}if(typeof h!="function")try{await I("https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"),h=window.html2canvas}catch{}if(typeof b!="function"||typeof h!="function"){const n=typeof b=="function",a=typeof h=="function";throw new Error(`PDF dependencies not available (jsPDF: ${n}, html2canvas: ${a})`)}const m=new b({unit:"mm",format:"a4",orientation:"portrait",compress:!0}),c=Math.min(2,Math.max(1.6,(window.devicePixelRatio||1)*1.25)),g=(()=>{try{const n=e&&e[0]?Object.keys(e[0]):Object.keys(P.lastSnapshot?.tableRows?.[0]||{}),a=_(n);return n.filter(s=>a.has(s))}catch{return null}})(),y={showPaid:localStorage.getItem("reportsPdf.rows.paid")!=="0",showUnpaid:localStorage.getItem("reportsPdf.rows.unpaid")!=="0",showConfirmed:localStorage.getItem("reportsPdf.rows.confirmed")!=="0",showPending:localStorage.getItem("reportsPdf.rows.pending")!=="0",showCompleted:localStorage.getItem("reportsPdf.rows.completed")!=="0"},f=N(e,{context:"export",columns:g||void 0,rowFilters:y});p.innerHTML="",p.appendChild(f);const v=Array.from(f.querySelectorAll(".a4-page"));for(let n=0;n<v.length;n+=1){const a=v[n],u=(await h(a,{scale:c,scrollX:0,scrollY:0,backgroundColor:"#ffffff",useCORS:!0,allowTaint:!1,windowWidth:j,windowHeight:T,letterRendering:!0,imageTimeout:0})).toDataURL("image/jpeg",.98);n>0&&m.addPage(),m.addImage(u,"JPEG",0,0,D,$,`page-${n+1}`,"FAST"),await new Promise(x=>requestAnimationFrame(x))}if(t==="print"){const n=m.output("bloburl");await new Promise(a=>{const s=document.createElement("iframe");Object.assign(s.style,{position:"fixed",right:0,bottom:0,width:"1px",height:"1px",border:0}),s.onload=()=>{try{s.contentWindow?.focus(),s.contentWindow?.print()}catch{}setTimeout(()=>{s.remove(),a()},700)},s.src=n,document.body.appendChild(s)})}else{const n=m.output("blob"),a=URL.createObjectURL(n),s=document.createElement("a");s.href=a,s.download="reservations-report.pdf",s.rel="noopener",s.style.display="none",document.body.appendChild(s),s.click(),setTimeout(()=>{try{URL.revokeObjectURL(a),s.remove()}catch{}},1500)}}finally{p.remove()}}async function ue(e=[]){await X();const t=window.XLSX;if(!t)throw new Error("XLSX dependency not available");const o=e&&e[0]?Object.keys(e[0]):Object.keys(P.lastSnapshot?.tableRows?.[0]||{}),l=_(o),r=o.filter(a=>l.has(a)),d={showPaid:localStorage.getItem("reportsPdf.rows.paid")!=="0",showPartial:localStorage.getItem("reportsPdf.rows.partial")!=="0",showUnpaid:localStorage.getItem("reportsPdf.rows.unpaid")!=="0",showConfirmed:localStorage.getItem("reportsPdf.rows.confirmed")!=="0",showPending:localStorage.getItem("reportsPdf.rows.pending")!=="0",showCompleted:localStorage.getItem("reportsPdf.rows.completed")!=="0",showCancelled:localStorage.getItem("reportsPdf.rows.cancelled")!=="0"},p=Array.isArray(e)&&e.length?e:P.lastSnapshot?.tableRows||[],w=F(p,r,d),b=i("reservations.reports.print.title","تقرير الحجوزات","Reservations report"),h=`${L(new Date)} • ${i("reservations.reports.print.generated","تاريخ التوليد","Generated on")}`,m=P.lastSnapshot?.metrics||{},c=[];c.push([b]),c.push([h]),c.push([]),c.push([i("reservations.reports.kpi.total.label","إجمالي الحجوزات","Total"),String(m.total??0),i("reservations.reports.kpi.revenue.label","الإيرادات","Revenue"),String(m.revenue??0),i("reservations.reports.kpi.net.label","صافي الربح","Net"),String(m.netProfit??0)]),c.push([i("reservations.reports.kpi.share.label","نسبة الشركة","Company share"),String(m.companyShareTotal??0),i("reservations.reports.kpi.tax.label","الضريبة","Tax"),String(m.taxTotal??0),i("reservations.reports.kpi.maintenance.label","مصاريف الصيانة","Maintenance"),String(m.maintenanceExpense??0)]),c.push([]),c.push(r),w.forEach(a=>{const s=r.map(u=>a[u]!=null?String(a[u]):"");c.push(s)});const g=t.utils.aoa_to_sheet(c);g["!merges"]||(g["!merges"]=[]);const y=Math.max(1,r.length)-1;g["!merges"].push({s:{r:0,c:0},e:{r:0,c:Math.max(3,y)}}),g["!merges"].push({s:{r:1,c:0},e:{r:1,c:Math.max(3,y)}});const f=r.map((a,s)=>{let x=(a||"").length+2;for(let C=7;C<c.length;C+=1){const E=c[C][s]||"";x=Math.max(x,String(E).length)}return{wch:Math.min(40,Math.max(10,x))}});g["!cols"]=f;const v=t.utils.book_new();t.utils.book_append_sheet(v,g,i("reservations.reports.export.sheetName","الحجوزات","Reservations"));const n=`${i("reservations.reports.export.filePrefix","تقرير-الحجوزات","reservations-report")}.xlsx`;t.writeFile(v,n)}async function fe(e=[]){const t=e&&e[0]?Object.keys(e[0]):Object.keys(P.lastSnapshot?.tableRows?.[0]||{}),o=_(t),l=t.filter(f=>o.has(f)),r={showPaid:localStorage.getItem("reportsPdf.rows.paid")!=="0",showPartial:localStorage.getItem("reportsPdf.rows.partial")!=="0",showUnpaid:localStorage.getItem("reportsPdf.rows.unpaid")!=="0",showConfirmed:localStorage.getItem("reportsPdf.rows.confirmed")!=="0",showPending:localStorage.getItem("reportsPdf.rows.pending")!=="0",showCompleted:localStorage.getItem("reportsPdf.rows.completed")!=="0",showCancelled:localStorage.getItem("reportsPdf.rows.cancelled")!=="0"},d=Array.isArray(e)&&e.length?e:P.lastSnapshot?.tableRows||[],p=F(d,l,r),w=i("reservations.reports.print.title","تقرير الحجوزات","Reservations report"),b=`${L(new Date)} • ${i("reservations.reports.print.generated","تاريخ التوليد","Generated on")}`,h=P.lastSnapshot?.metrics||{},m=U(),c=f=>{const v=String(f??"");return/[",\n]/.test(v)?'"'+v.replace(/"/g,'""')+'"':v},g=[];g.push(c(w)),g.push(c(b)),g.push(`Logo,${c(m)}`),g.push(""),g.push([i("reservations.reports.kpi.total.label","إجمالي الحجوزات","Total"),h.total??0,i("reservations.reports.kpi.revenue.label","الإيرادات","Revenue"),h.revenue??0,i("reservations.reports.kpi.net.label","صافي الربح","Net"),h.netProfit??0].map(c).join(",")),g.push([i("reservations.reports.kpi.share.label","نسبة الشركة","Company share"),h.companyShareTotal??0,i("reservations.reports.kpi.tax.label","الضريبة","Tax"),h.taxTotal??0,i("reservations.reports.kpi.maintenance.label","مصاريف الصيانة","Maintenance"),h.maintenanceExpense??0].map(c).join(",")),g.push(""),g.push(l.map(c).join(",")),p.forEach(f=>{const v=l.map(n=>c(f[n]!=null?f[n]:""));g.push(v.join(","))});let y=!1;try{await G();const f=window.JSZip;if(f){const v=new f,n=i("reservations.reports.export.filePrefix","تقرير-الحجوزات","reservations-report"),a=["\uFEFF"+g.slice(0,g.indexOf(l.map(c).join(","))).join(`
`)],s=["\uFEFF"+[l.map(c).join(","),...p.map(E=>l.map(R=>c(E[R]??"")).join(","))].join(`
`)];v.file(`${n}-metadata.csv`,a.join("")),v.file(`${n}.csv`,s.join(""));try{const R=await(await fetch(m,{mode:"cors"})).blob();v.file("logo.png",R)}catch{}const u=await v.generateAsync({type:"blob"}),x=URL.createObjectURL(u),C=document.createElement("a");C.href=x,C.download=`${n}.zip`,C.style.display="none",document.body.appendChild(C),C.click(),setTimeout(()=>{URL.revokeObjectURL(x),C.remove()},1500),y=!0}}catch{}if(!y){const f=new Blob(["\uFEFF"+g.join(`
`)],{type:"text/csv;charset=utf-8"}),v=URL.createObjectURL(f),n=document.createElement("a");n.href=v,n.download=`${i("reservations.reports.export.filePrefix","تقرير-الحجوزات","reservations-report")}.csv`,n.style.display="none",document.body.appendChild(n),n.click(),setTimeout(()=>{URL.revokeObjectURL(v),n.remove()},1500)}}const ne="https://art-ratio.sirv.com/AR-Logo-v3.5-curved.png";function U(){try{const e=localStorage.getItem("reportsPdf.logoUrl");if(e&&/^https?:|^data:|^blob:/.test(e))return e}catch{}return ne}export{N as buildA4ReportPages,fe as exportA4ReportCsv,ue as exportA4ReportExcel,he as exportA4ReportPdf};
