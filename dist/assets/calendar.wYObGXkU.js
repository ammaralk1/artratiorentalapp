import{s as te,k as Ce}from"./state.nYJEgFB_.js";import{t as l,p as O,d as Q,n as ne}from"./auth.DjG6Y4HV.js";import{e as Ee}from"./reservationsActions.BeoFjJsZ.js";import{y as Ae,g as ae,d as Le,c as re,e as se,a as xe}from"./reservationsService.CgInooAt.js";import{c as oe}from"./details.B8tyWZhq.js";import{o as _e}from"./view.BLD1TlfF.js";import"./uiBridge.BVmq7b7i.js";const Te={limit:200};let u=null,ie=!1,le=!1,ce=!1,de=null,G=null,ue=!1,U=null,K=null,Z=!1,k="",z=null;const J=new Map;function M(e=""){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function X(){const e=document.getElementById("calendar"),n=document.getElementById("calendar-panel")||e?.parentElement||null,r=document.getElementById("calendar-status");return{calendarEl:e,panelEl:n,statusEl:r}}function pe(){try{if(typeof FullCalendar<"u")return FullCalendar}catch{}return typeof window<"u"&&window.FullCalendar?window.FullCalendar:typeof global<"u"&&global.FullCalendar?global.FullCalendar:typeof globalThis<"u"&&globalThis.FullCalendar?globalThis.FullCalendar:null}async function ke(){const e=pe();return e||z||(z=new Promise(n=>{try{const r="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js",a=document.createElement("script");a.src=r,a.async=!0,a.onload=()=>n(pe()),a.onerror=()=>n(null),document.head.appendChild(a)}catch{n(null)}}),z)}function Me(){if(typeof window>"u")return null;const e=window.tui?.Calendar||window.toastui?.Calendar||window.Calendar;return typeof e=="function"?e:null}function Ie(e){return J.has(e)||J.set(e,new Intl.DateTimeFormat(e,{hour:"2-digit",minute:"2-digit"})),J.get(e)}function Y(e,n,r=!1){if(r){const m=(O?.()==="en"?"en":"ar")==="en"?"All day":"Ø·ÙˆØ§Ù„ Ø§Ù„ÙŠÙˆÙ…";return l("calendar.labels.allDay",m)}if(!e)return"";const a=new Date(e);if(Number.isNaN(a.getTime()))return"";const s=O?.()==="en"?"en-US":"ar-SA-u-ca-gregory-nu-latn",c=Ie(s),t=c.format(a);if(!n)return t;const i=new Date(n);if(Number.isNaN(i.getTime()))return t;const h=c.format(i);return t===h?t:`${t} â€“ ${h}`}function Re({paidStatus:e,confirmed:n,completed:r,cancelled:a}){const s=["calendar-event"];return(r===!0||r==="true")&&s.push("calendar-event--completed"),(a===!0||a==="true")&&s.push("calendar-event--cancelled"),n===!0||n==="true"?s.push("calendar-event--confirmed"):s.push("calendar-event--pending"),e==="paid"?s.push("calendar-event--paid"):e==="partial"?s.push("calendar-event--partial"):s.push("calendar-event--unpaid"),s}function je(e){try{const{event:n}=e||{},r=n?.extendedProps||{},a=Y(n?.startStr,n?.endStr,n?.allDay),s=r?.reservationId?String(r.reservationId):n?.id!=null?String(n.id):l("common.placeholder.empty","â€”"),c=r?.customerName||l("calendar.labels.unknownCustomer","ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"),t=r?.confirmed===!0||r?.confirmed==="true",i=typeof r?.paidStatus=="string"?r.paidStatus:r?.paid===!0||r?.paid==="paid"?"paid":"unpaid",h=i==="paid",y=r?.completed===!0||r?.completed==="true",m=(S,x)=>`<span class="calendar-chip ${S}">${M(x)}</span>`,p=t?l("calendar.badges.confirmed","Ù…Ø¤ÙƒØ¯"):l("calendar.badges.pending","ØºÙŠØ± Ù…Ø¤ÙƒØ¯"),I=i==="paid"?l("calendar.badges.paid","Ù…Ø¯ÙÙˆØ¹"):i==="partial"?l("calendar.badges.partial","Ù…Ø¯ÙÙˆØ¹ Ø¬Ø²Ø¦ÙŠØ§Ù‹","Partially paid"):l("calendar.badges.unpaid","ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹"),v=r?.cancelled===!0||r?.cancelled==="true";let w=[];if(v)w=[m("status-cancelled",l("calendar.badges.cancelled","Ù…Ù„ØºÙŠ"))];else{const S=i==="paid"?"status-paid":i==="partial"?"status-partial":"status-unpaid";w=[m(t?"status-confirmed":"status-pending",p),m(S,I)],y&&w.push(m("status-completed",l("calendar.badges.completed","Ù…ØºÙ„Ù‚")))}return{html:`
      <div class="calendar-event-wrapper">
        <div class="calendar-event-card">
          <div class="calendar-event-card__head">
            <span class="calendar-event-card__time">${M(a||"")}</span>
            <span class="calendar-event-card__id">${M(s)}</span>
          </div>
          <div class="calendar-event-card__customer">${M(c)}</div>
          <div class="calendar-event-card__chips">${w.join("")}</div>
        </div>
      </div>`}}catch{return{html:""}}}function Ne(){const{calendarEl:e}=X();if(!e)return;const n=e.querySelector(".fc-header-toolbar");if(!n)return;n.classList.add("calendar-toolbar"),n.querySelectorAll(".fc-toolbar-chunk").forEach(a=>{a.classList.add("calendar-toolbar__chunk")});const r=n.querySelector(".fc-toolbar-title");r&&r.classList.add("calendar-toolbar__title"),n.querySelectorAll(".fc-button").forEach(a=>{a.classList.add("calendar-toolbar__button")})}function j({loading:e=!1,error:n="",empty:r=!1}={}){const{panelEl:a,statusEl:s}=X();if(!a||!s)return;const c=typeof n=="string"?n.trim().length>0:!!n,t=!e&&!c&&!!r,i=e||c||t;if(a.classList.toggle("is-loading",e),a.classList.toggle("has-error",c),a.classList.toggle("is-empty",t),s.dataset.initialized||(s.classList.add("calendar-status-card","shadow-2xl","bg-base-100/95","border","border-base-200/80","rounded-3xl","text-base-content","px-8","py-8","flex","flex-col","items-center","justify-center","gap-4"),s.dataset.initialized="true"),s.classList.remove("calendar-status-card--loading","calendar-status-card--error","calendar-status-card--empty"),s.classList.toggle("hidden",!i),!i){s.innerHTML="",s.removeAttribute("data-status");return}let h="";e?h=l("calendar.status.loading","â³ Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª..."):c?h=typeof n=="string"&&n.trim().length>0?n:l("calendar.status.error","ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª. Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹."):t&&(h=l("calendar.status.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø¬ÙˆØ²Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©."));const y=e?"loading":c?"error":"empty";if(s.setAttribute("data-status",y),s.classList.add(`calendar-status-card--${y}`),s.innerHTML="",e){const p=document.createElement("span");p.className="loading loading-spinner loading-md text-primary",p.setAttribute("aria-hidden","true"),s.appendChild(p)}else{const p=document.createElement("span");p.className="calendar-status-card__icon",p.setAttribute("aria-hidden","true"),p.textContent=c?"âš ï¸":"ğŸ—“ï¸",s.appendChild(p)}const m=document.createElement("span");m.className="calendar-status-card__message text-center text-sm font-semibold",m.textContent=h,s.appendChild(m)}function ye(e,n=null){if(!e||typeof e!="object")return null;const r=e.start??e.startDatetime??e.start_datetime??null,a=e.end??e.endDatetime??e.end_datetime??r;if(!r)return null;const s=String(e.status??e.reservationStatus??"").toLowerCase(),c=Array.isArray(e.items)?e.items:[],t=Array.isArray(e.crewAssignments)?e.crewAssignments:[],i=t.length?t:Array.isArray(e.technicians)?e.technicians:[],h=Array.isArray(i)&&i.length&&typeof i[0]=="object",y=Array.isArray(i)&&i.length&&typeof i[0]!="object",m=e.discount??e.discountValue??e.discount_value??e.discountAmount??0,p=Number.parseFloat(ne(String(m)))||0,I=e.discountType??e.discount_type??e.discountMode??"percent",v=String(I).toLowerCase()==="amount"?"amount":"percent",w=!!(e.applyTax??e.apply_tax??e.taxApplied),N=e.companySharePercent??e.company_share_percent??e.companyShare??e.company_share??0,S=Number.parseFloat(ne(String(N)))||0;let x=0;try{const f=Le({items:c,technicianIds:y?i:[],crewAssignments:h?i:[],discount:p,discountType:v,applyTax:w,start:e.start,end:e.end,companySharePercent:S>0?S:null,groupingSource:e});x=Number(f?.finalTotal||0)||0}catch{x=Number(e.totalAmount??e.cost??0)||0}const _=x,F=e.paymentHistory||e.payment_history||[],P=re({totalAmount:_,paidAmount:F.length?0:e.paidAmount,paidPercent:F.length?0:e.paidPercent,history:F});let $=se({manualStatus:null,paidAmount:P.paidAmount,paidPercent:P.paidPercent,totalAmount:_});if(n)try{const f=_e(n)||{},T=Number(f.totalWithTax||0),E=n.paymentHistory||n.payments||[],R=re({totalAmount:T,paidAmount:E.length?0:n.paidAmount,paidPercent:E.length?0:n.paidPercent,history:E}),D=se({manualStatus:null,paidAmount:R.paidAmount,paidPercent:R.paidPercent,totalAmount:T});D&&($=D)}catch{}const W=$==="paid",{effectiveConfirmed:V}=xe(e,n),o=e.reservationId??e.reservationCode??e.reservation_code??e.id??r,g=e.customerName??e.customer_name??"";let d=!!e.completed;if(!d&&a){const f=new Date(a);Number.isNaN(f.getTime())||(d=f<new Date)}return{id:e.id??o??r,start:r,end:a||r,paid:W,paidStatus:$,confirmed:V,completed:d,cancelled:s==="cancelled"||s==="canceled",reservationId:o??"",customerName:g,raw:e}}function Fe(e=[]){const{projects:n=[]}=Q(),r=new Map(n.map(a=>[String(a.id),a]));return e.map(a=>{const s=a?.projectId??a?.project_id??null,c=s!=null&&s!==""&&r.get(String(s))||null,t=ye(a,c);if(!t)return null;const i=Re({paidStatus:t.paidStatus,confirmed:t.confirmed,completed:t.completed,cancelled:t.cancelled});return{id:t.id,title:"",start:t.start,end:t.end,display:"block",backgroundColor:"transparent",borderColor:"transparent",textColor:"",classNames:i,extendedProps:{...a,raw:a,paid:t.paid,paidStatus:t.paidStatus,confirmed:t.confirmed,completed:t.completed,cancelled:t.cancelled,reservationId:t.reservationId,customerName:t.customerName}}}).filter(Boolean)}async function me(){if(Z)return ae();Z=!0,k="";try{await Ee({suppressError:!1,params:Te})}catch(e){console.error("âŒ [calendar] Failed to load reservations for calendar view",e),k=Ae(e)?e.message:e instanceof Error&&e.message||""}finally{Z=!1}return ae()}function q(){if(u){try{typeof u.destroy=="function"&&u.destroy()}catch{}u=null}}function fe(e){const n={events:e};typeof window<"u"&&typeof window.dispatchEvent=="function"?window.dispatchEvent(new CustomEvent("calendar:updated",{detail:n})):typeof dispatchEvent=="function"&&dispatchEvent(new CustomEvent("calendar:updated",{detail:n}))}function he(){we()}function Pe(){ie||(document.addEventListener("language:changed",()=>{u&&u.setOption("locale",O()),we()}),ie=!0),le||(document.addEventListener("reservations:changed",()=>{he()}),le=!0)}function ee(e){return e<=480?"xs":e<=768?"sm":"lg"}function be(){if(typeof window>"u")return"month";const e=window.innerWidth||1024,n=ee(e);return n==="xs"?"day":n==="sm"?"week":"month"}function H(){if(!u)return;const e=typeof window<"u"&&window.innerWidth||1024,n=ee(e),r=u.__isFullCalendar?ve():be();de!==n&&typeof u.changeView=="function"&&(de=n,u.changeView(r,!0))}function De(){ce||typeof window>"u"||(window.addEventListener("resize",()=>{G&&clearTimeout(G),G=setTimeout(()=>{H()},160)},{passive:!0}),ce=!0)}function Be(){if(ue||typeof MutationObserver>"u"||typeof document>"u")return;const e=()=>{K&&clearTimeout(K),K=setTimeout(()=>{he()},80)};U=new MutationObserver(e),U.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),document.body&&U.observe(document.body,{attributes:!0,attributeFilter:["class"]}),ue=!0}function ge(e){const n=document.getElementById("calendar-reservation-details");if(!n){alert(l("calendar.alerts.cannotShowDetails","Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²"));return}const r=Q()||{},{reservations:a=[],customers:s=[],projects:c=[],technicians:t=[]}=r,i=e?.raw&&typeof e.raw=="object"?{...e.raw,...e}:{...e},h=[i.id,i.reservationId,i.reservation_id,i.reservationCode,i.reservation_code].map(o=>o==null?"":String(o)).filter(o=>o.length>0);let y=-1,m=null;h.length>0&&(y=a.findIndex(o=>{const g=[o?.id,o?.reservationId,o?.reservation_id,o?.reservationCode,o?.reservation_code].map(d=>d==null?"":String(d)).filter(d=>d.length>0);return g.length===0?!1:g.some(d=>h.includes(d))}),y>=0&&(m=a[y]));let p;m?(p={...i,...m},Array.isArray(m.items)&&m.items.length&&(p.items=m.items),Array.isArray(m.packages)&&m.packages.length&&(p.packages=m.packages)):p=i;const I=p.projectId??p.project_id??null,v=I!=null&&c.find(o=>String(o.id)===String(I))||null,w=p.customerId??p.customer_id,N=s.find(o=>String(o.id)===String(w)),S=te(),x=[...Array.isArray(S)?S:[],...Array.isArray(t)?t:[]],_=new Map;x.forEach(o=>{if(!o||o.id==null)return;const g=String(o.id),d=_.get(g)||{};_.set(g,{...d,...o})});const F=Array.from(_.values());let P="";try{P=oe(p,N,F,y>=0?y:0,v)}catch(o){console.error("âŒ [calendar] Failed to build reservation details for calendar modal",o),n.innerHTML=`<p class="text-sm text-error">${M(l("calendar.alerts.cannotShowDetails","Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²"))}</p>`;return}n.innerHTML=P,n.classList.add("calendar-reservation-details");try{const o=n.querySelector("[data-tech-slider]");if(o){const g=o.querySelector("[data-slider-track]"),d=o.querySelector("[data-slider-prev]"),f=o.querySelector("[data-slider-next]");if(g&&(d||f)){const T=document.documentElement.getAttribute("dir")==="rtl"||document.body.getAttribute("dir")==="rtl",E=()=>{const A=g.querySelector(".reservation-technician-card"),C=A&&A.getBoundingClientRect().width||220,b=12,L=Math.max(1,Math.floor(g.clientWidth/(C+b)));return Math.max(C+b,Math.floor(L*(C+b)*.9))},R=()=>{const A=Math.max(0,g.scrollWidth-g.clientWidth-2),C=g.scrollLeft<=1,b=g.scrollLeft>=A;d&&(d.disabled=C),f&&(f.disabled=b)},D=A=>{const C=E()*A,b=T?-C:C;g.scrollBy({left:b,behavior:"smooth"})};d?.addEventListener("click",()=>D(-1)),f?.addEventListener("click",()=>D(1)),g.addEventListener("scroll",R,{passive:!0}),window.addEventListener("resize",R,{passive:!0}),setTimeout(R,0)}}}catch{}try{Ce()?.then(()=>{try{const o=Array.from(new Map((te()||[]).map(d=>[String(d.id),d])).values()),g=oe(p,N,o,y>=0?y:0,v);n.innerHTML=g,n.classList.add("calendar-reservation-details");try{const d=n.querySelector("[data-tech-slider]");if(d){const f=d.querySelector("[data-slider-track]"),T=d.querySelector("[data-slider-prev]"),E=d.querySelector("[data-slider-next]");if(f&&(T||E)){const R=document.documentElement.getAttribute("dir")==="rtl"||document.body.getAttribute("dir")==="rtl",D=()=>{const b=f.querySelector(".reservation-technician-card"),L=b&&b.getBoundingClientRect().width||220,B=12,Se=Math.max(1,Math.floor(f.clientWidth/(L+B)));return Math.max(L+B,Math.floor(Se*(L+B)*.9))},A=()=>{const b=Math.max(0,f.scrollWidth-f.clientWidth-2),L=f.scrollLeft<=1,B=f.scrollLeft>=b;T&&(T.disabled=L),E&&(E.disabled=B)},C=b=>{const L=D()*b,B=R?-L:L;f.scrollBy({left:B,behavior:"smooth"})};T?.addEventListener("click",()=>C(-1)),E?.addEventListener("click",()=>C(1)),f.addEventListener("scroll",A,{passive:!0}),window.addEventListener("resize",A,{passive:!0}),setTimeout(A,0)}}}catch{}}catch{}}).catch(()=>{})}catch{}n.querySelector(".reservation-modal-actions")?.remove(),n.querySelectorAll(".reservation-qty-btn, .reservation-remove-button").forEach(o=>{o instanceof HTMLElement&&(o.setAttribute("disabled","true"),o.setAttribute("aria-disabled","true"),o.setAttribute("tabindex","-1"))});const W=n.querySelector('[data-action="open-project"]');W&&(v?W.addEventListener("click",()=>{const o=v?.id!=null?String(v.id):"",g=o?`projects.html?project=${encodeURIComponent(o)}`:"projects.html";window.location.href=g}):W instanceof HTMLElement&&W.setAttribute("disabled","true"));const V=document.getElementById("calendarReservationModal");V&&window.bootstrap?.Modal?window.bootstrap.Modal.getOrCreateInstance(V).show():alert(l("calendar.alerts.cannotOpenModal","Ù„Ø§ ÙŠÙ…ÙƒÙ† ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„"))}function we(){Pe(),De(),Be();const{calendarEl:e}=X();if(!e)return;const n=Me();if(!n){(async()=>{const r=await ke();if(!r||typeof r.Calendar!="function"){const c=l("calendar.status.missingLibrary","ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© Ø§Ù„ØªÙ‚ÙˆÙŠÙ…. ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©.");j({error:c}),q();return}j({loading:!0});const a=await me();if(k){const c=l("calendar.status.error","ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª. Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹.");j({loading:!1,error:k||c}),q();return}const s=Fe(a);u?u.batchRendering?.(()=>{u.removeAllEvents(),u.addEventSource(s)}):(u=new r.Calendar(e,{initialView:ve(),locale:O(),timeZone:"local",expandRows:!0,height:"auto",contentHeight:"auto",slotMinTime:"06:00:00",slotMaxTime:"24:00:00",slotDuration:"00:30:00",headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay"},dayMaxEventRows:2,fixedWeekCount:!0,showNonCurrentDates:!0,views:{dayGridMonth:{dayMaxEventRows:2,fixedWeekCount:!0}},moreLinkClick:"popover",lazyFetching:!1,noEventsContent(){return l("calendar.noEvents","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø¬ÙˆØ²Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù†Ø·Ø§Ù‚")},buttonText:{today:l("calendar.buttons.today","Ø§Ù„ÙŠÙˆÙ…"),month:l("calendar.buttons.month","Ø´Ù‡Ø±"),week:l("calendar.buttons.week","Ø£Ø³Ø¨ÙˆØ¹"),day:l("calendar.buttons.day","ÙŠÙˆÙ…")},events:s,eventContent:je,eventClick(c){ge(c.event.extendedProps)},windowResize:H,datesSet(){Ne()}}),u.render(),u.__isFullCalendar=!0),H(),fe(s),j({loading:!1,error:"",empty:s.length===0})})();return}(async()=>{j({loading:!0});const r=await me();if(k){const t=l("calendar.status.error","ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª. Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹.");j({loading:!1,error:k||t}),q();return}const a=We(r);q();const s=be();u=new n("#calendar",{defaultView:s,usageStatistics:!1,isReadOnly:!0,week:{taskView:!1,hourStart:6,hourEnd:24},month:{visibleWeeksCount:0,startDayOfWeek:0,isAlways6Weeks:!0,maxVisibleEventCount:6,moreLayerSize:420},template:{time(t){const i=typeof t?.raw?.paidStatus=="string"?t.raw.paidStatus:t?.raw?.paid===!0||t?.raw?.paid==="paid"?"paid":"unpaid",h=t?.raw?.confirmed===!0||t?.raw?.confirmed==="true",y=t?.raw?.completed===!0||t?.raw?.completed==="true",m=l("calendar.labels.unknownCustomer","ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"),p=Y(t.start?.toString?.()||t.start,t.end?.toString?.()||t.end,t.isAllDay),I=t?.raw?.reservationId?String(t.raw.reservationId):l("common.placeholder.empty","â€”"),v=t?.raw?.customerName||m,w=(F,P)=>`<span class="badge ${F} badge-sm">${M(P)}</span>`,N=h?l("calendar.badges.confirmed","Ù…Ø¤ÙƒØ¯"):l("calendar.badges.pending","ØºÙŠØ± Ù…Ø¤ÙƒØ¯"),S=i==="paid"?l("calendar.badges.paid","Ù…Ø¯ÙÙˆØ¹"):i==="partial"?l("calendar.badges.partial","Ù…Ø¯ÙÙˆØ¹ Ø¬Ø²Ø¦ÙŠØ§Ù‹"):l("calendar.badges.unpaid","ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹"),x=i==="paid"?"badge-info":i==="partial"?"badge-warning":"badge-error",_=[w(h?"badge-success":"badge-warning",N),w(x,S)];return y&&_.push(w("badge-neutral",l("calendar.badges.completed","Ù…ØºÙ„Ù‚"))),`
            <div class="card bg-base-100/90 border border-base-200 shadow-sm rounded-xl p-2">
              <div class="flex items-baseline justify-between text-[0.8rem]">
                <span class="font-bold">${M(p||"")}</span>
                <span class="font-semibold">${M(I)}</span>
              </div>
              <div class="mt-1 font-semibold text-sm truncate">${M(v)}</div>
              <div class="mt-1 flex gap-1 flex-wrap">${_.join("")}</div>
            </div>
          `}}}),u.__isTui=!0;const c=t=>{if(t)try{ge(t)}catch{}};typeof u.on=="function"&&(u.on("clickSchedule",t=>c(t?.schedule?.raw||t?.schedule)),u.on("clickEvent",t=>c(t?.event?.raw||t?.event)));try{typeof u.createSchedules=="function"?u.createSchedules(a):typeof u.createEvents=="function"&&u.createEvents(a)}catch{}H(),fe(a),j({loading:!1,error:"",empty:a.length===0}),setTimeout(()=>{H()},120)})().catch(r=>{console.error("âŒ [calendar] renderCalendar failed",r),k=r instanceof Error&&r.message||k||"";const a=l("calendar.status.error","ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª. Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹.");j({loading:!1,error:k||a}),q()})}function We(e=[]){const{projects:n=[]}=Q(),r=new Map(n.map(a=>[String(a.id),a]));return e.map(a=>{const s=a?.projectId??a?.project_id??null,c=s!=null&&r.get(String(s))||null,t=ye(a,c);if(!t)return null;const i=Y(t.start,t.end,!1),h=t.customerName||"",y=[i,h].filter(Boolean).join(" Â· ");return{id:String(t.id),calendarId:"default",title:y,category:"time",isAllDay:!1,isAllday:!1,start:t.start,end:t.end,raw:{...a,paid:t.paid,paidStatus:t.paidStatus,confirmed:t.confirmed,completed:t.completed,reservationId:t.reservationId,customerName:t.customerName}}}).filter(Boolean)}function ve(){if(typeof window>"u")return"dayGridMonth";const e=window.innerWidth||1024,n=ee(e);return n==="xs"?"timeGridDay":n==="sm"?"timeGridWeek":"dayGridMonth"}export{we as renderCalendar};
