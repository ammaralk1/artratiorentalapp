const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./reports.I-ZsSzlI.js","./uiBridge.CMaEDZm-.js","./auth.Bt1KphMA.js","./auth.DsXbKPFF.css","./state.CY6GwEtX.js","./calculations.BWHtFzv-.js","./reservationsService.CU7qTLqY.js","./maintenanceService.qEZY7V3Y.js","./canvasColorUtils.CviLtv6S.js","./reservationsUI.Vnv1_9Uc.js","./controller.CsizmL1D.js","./details.Fa3VNIik.js","./reservationPdf.Baa_uUhb.js","./view.UKoVu_6y.js","./quotePdf.DTFcIMe3.js","./reservationsActions.DvXXwwfF.js","./projectsService.BGLnOYZW.js","./calendar.DfCZY-Ya.js","./maintenance.D6FjjLtW.js","./dashboardMetrics.572guACh.js"])))=>i.map(i=>d[i]);
import{u as O,e as Y,f as we,s as Be,d as Z,b as G,h as Le,t as g,n as I,j as B,a as Pe,c as Re,i as Fe,l as xe}from"./auth.Bt1KphMA.js";import"./dashboard.412LJQM_.js";import{r as ye,_ as E,E as de,a as De,c as Ce,i as Ne,u as Me,g as je,w as $e}from"./uiBridge.CMaEDZm-.js";import{r as Oe}from"./customers.zezsBKpa.js";import{a as Ve,n as he,b as Ue}from"./state.CY6GwEtX.js";import{i as He}from"./dashboardShell.DF2kUed9.js";const ze={},re="__ART_RATIO_LAST_DASHBOARD_TAB__",P="__ART_RATIO_LAST_DASHBOARD_SUB_TAB__",J="create-tab",X=/^[a-z0-9\-]+$/i,Qe=typeof import.meta<"u"&&ze&&!1;function h(...e){Qe&&console.log(...e)}function ie(e){if(!(!e||typeof e.scrollIntoView!="function"))try{const t=e.closest("[data-tab-scroll-track]");if(!t)return;const n={behavior:"smooth",block:"nearest",inline:"center"};e.scrollIntoView(n);const o=t.closest("[data-tab-scroll]");o&&window.requestAnimationFrame(()=>{o.dispatchEvent(new CustomEvent("tabScroll:update",{bubbles:!0}))})}catch(t){console.warn("âš ï¸ [tabs.js] Failed to keep tab visible",t)}}function x(e){try{if(typeof window>"u"||!window.localStorage)return null;const t=window.localStorage.getItem(e);return!t||!X.test(t)?null:t}catch(t){return console.warn("âš ï¸ [tabs.js] Failed to read stored tab",t),null}}function oe(e,t){try{if(typeof window>"u"||!window.localStorage)return;if(!t||!X.test(t)){window.localStorage.removeItem(e);return}window.localStorage.setItem(e,t)}catch(n){console.warn("âš ï¸ [tabs.js] Failed to persist tab",n)}}function ve(e){try{if(typeof window>"u"||!window.localStorage)return;window.localStorage.removeItem(e)}catch(t){console.warn("âš ï¸ [tabs.js] Failed to clear stored tab",t)}}let L=null,T=null,D=!1,q=null,le=null,N=null,C=null,j=null,z=null,ee=null,te=null,ne=null,me=!1,pe=!1;function Ke(){return z||(z=E(()=>import("./reports.I-ZsSzlI.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]),import.meta.url).then(e=>{try{typeof e.initReports=="function"&&e.initReports()}catch(t){console.error("âŒ [tabs.js] Failed to initialise reports module",t)}return e}).catch(e=>{throw console.error("âŒ [tabs.js] Failed to load reports module",e),z=null,e})),z}function Ie(){return ee||(ee=E(()=>import("./reservationsUI.Vnv1_9Uc.js"),__vite__mapDeps([9,10,2,3,11,4,6,1,12,13,14,8,15,16]),import.meta.url)),ee}function We(){return te||(te=E(()=>import("./calendar.DfCZY-Ya.js"),__vite__mapDeps([17,4,2,3,15,1,6,11,13]),import.meta.url)),te}function Ye(){return ne||(ne=E(()=>import("./maintenance.D6FjjLtW.js"),__vite__mapDeps([18,2,3,1,4,7]),import.meta.url)),ne}function Ge(){h("ğŸš€ [tabs.js] setupTabs()");const e=Array.from(document.querySelectorAll("[data-tab]")),t=document.querySelectorAll(".tab-content-wrapper > .tab");h("ğŸ“Œ tabButtons:",e),h("ğŸ“Œ tabContents:",t);const n=(a,{skipStore:c=!1,skipRender:p=!1}={})=>{if(!a)return;const f=e.filter(u=>u?.getAttribute("data-tab")===a),l=document.getElementById(a);if(!(!f.length||!l)&&(e.forEach(u=>{const m=u?.getAttribute("data-tab")===a;u.classList.toggle("active",m),m?(u.setAttribute("aria-selected","true"),u.setAttribute("tabindex","0"),ie(u)):(u.setAttribute("aria-selected","false"),u.setAttribute("tabindex","-1"))}),t.forEach(u=>{const m=u.id===a;u.style.display=m?"block":"none",u.classList.toggle("active",m)}),L=a,oe(re,a),typeof document<"u"&&document.dispatchEvent(new CustomEvent("dashboard:tabChanged",{detail:{tabId:a}})),c||O({dashboardTab:a}).catch(u=>{console.warn("âš ï¸ [tabs.js] Failed to store dashboard tab preference",u)}),a!=="reservations-tab"&&(T=null,q=null,ve(P),c||O({dashboardSubTab:null}).catch(u=>{console.warn("âš ï¸ [tabs.js] Failed to clear sub-tab preference",u)})),!p&&a==="customers-tab"&&(h("ğŸ‘¤ Rendering customers"),Oe()),!p&&a==="equipment-tab"&&(h("ğŸ“¦ Rendering equipment"),ye()),!p&&a==="maintenance-tab"&&(h("ğŸ› ï¸ Rendering maintenance"),Ye().then(u=>{try{!me&&typeof u.initMaintenance=="function"?(u.initMaintenance(),me=!0):u.renderMaintenance?.()}catch(m){console.error("âŒ [tabs.js] Failed to initialise/render maintenance",m)}}).catch(u=>console.error("âŒ [tabs.js] Unable to load maintenance module",u))),!p&&a==="technicians-tab"&&(h("ğŸ› ï¸ Rendering technicians"),Ve()),a==="reservations-tab")){if(h("ğŸ“… Rendering reservations"),!p){try{const u=document.getElementById("reservations-tab");if(u&&!u.querySelector("[data-reservations-skeleton]")){const m=document.createElement("div");m.setAttribute("data-reservations-skeleton",""),m.setAttribute("aria-busy","true"),m.style.padding="1rem",m.style.display="grid",m.style.gap="12px";const b='<div class="loading loading-spinner loading-md text-primary" role="status" aria-label="Loading" style="justify-self:center;margin:6px 0;"></div>',y='<div style="height:12px;background:rgba(148,163,184,0.25);border-radius:8px"></div>'.repeat(6);m.innerHTML=b+y,u.prepend(m)}}catch{}Ie().then(async u=>{try{u.setupReservationEvents?.()}catch{}try{u.renderReservations?.()}catch{}try{const m=u?.initializeReservationUI;!pe&&typeof m=="function"&&(await m(),pe=!0)}catch{}try{const b=document.getElementById("reservations-tab")?.querySelector("[data-reservations-skeleton]");b&&b.remove()}catch{}}).catch(u=>console.error("âŒ [tabs.js] Unable to load reservations UI module",u))}if(!q){const u=x(P);q=T||u||J}Je(),q&&(Q(q),q=null)}};C=n;const o=a=>{if(!a||a.dataset.tabKeyboardBound==="true")return;const c=a.getAttribute("aria-orientation")==="vertical";a.addEventListener("keydown",p=>{const f=p.key,l=Array.from(a.querySelectorAll('[role="tab"], .tab-button, .sub-tab-button')).filter(M=>M.matches("[data-tab], [data-sub-tab]"));if(!l.length)return;const u=p.target,m=Math.max(0,l.indexOf(u));let b=m;const y=()=>{b=(m-1+l.length)%l.length},_=()=>{b=(m+1)%l.length},A=()=>{b=0},H=()=>{b=l.length-1};let w=!1;switch(f){case"ArrowLeft":c||(y(),w=!0);break;case"ArrowRight":c||(_(),w=!0);break;case"ArrowUp":c&&(y(),w=!0);break;case"ArrowDown":c&&(_(),w=!0);break;case"Home":A(),w=!0;break;case"End":H(),w=!0;break;case"Enter":case" ":w=!0,u?.click();break}if(w){p.preventDefault();const M=l[b];M&&M!==u&&(M.focus(),M.click())}}),a.dataset.tabKeyboardBound="true"};document.querySelectorAll('[role="tablist"]').forEach(o),e.forEach(a=>{a&&(a.getAttribute("type")||a.setAttribute("type","button"),a.setAttribute("role","tab"),a.hasAttribute("tabindex")||a.setAttribute("tabindex",a.classList.contains("active")?"0":"-1"),a.addEventListener("click",()=>{const c=a.getAttribute("data-tab");if(h("ğŸ–±ï¸ Tab clicked:",c),n(c),c==="reservations-tab"){const p=T||x(P)||J;typeof N=="function"?N(p):q=p}else O({dashboardSubTab:null}).catch(p=>{console.warn("âš ï¸ [tabs.js] Failed to clear sub-tab preference",p)})}))});const i=()=>{try{const a=typeof window<"u"&&window.location&&typeof window.location.hash=="string"?window.location.hash.replace(/^#/,""):"";if(!a)return null;let c=null;if(X.test(a)&&document.getElementById(a))c=a;else{const f=new URLSearchParams(a).get("tab");f&&X.test(f)&&document.getElementById(f)&&(c=f)}return c}catch{return null}},s=a=>{const c=document.querySelector("[data-tab].active"),p=x(re),f=e[0]?.getAttribute("data-tab")||null,m=[i(),a?.dashboardTab,p,L,c?.getAttribute("data-tab"),f].filter(Boolean).find(_=>document.getElementById(_))||f;m&&(!D||m!==L)&&(h("â­ Initial tab:",m),n(m,{skipStore:!0}));const y=[a?.dashboardSubTab,x(P)].filter(Boolean).find(_=>document.getElementById(_));if(y&&(L==="reservations-tab"&&typeof N=="function"?(!D||y!==T)&&N(y,{skipStore:!0}):q=y),!D){document.body?.classList.remove("tabs-loading"),document.body?.classList.remove("no-js"),D=!0;try{window.addEventListener("hashchange",()=>{const A=i();!A||A===L||typeof C!="function"||document.getElementById(A)&&C(A,{skipStore:!0})});const _=()=>{const A=L||i()||document.querySelector("[data-tab].active")?.getAttribute("data-tab")||e[0]?.getAttribute("data-tab");A&&typeof C=="function"&&C(A,{skipStore:!0,skipRender:!0})};document.addEventListener("language:changed",_),document.addEventListener("language:translationsReady",_)}catch{}}},d=typeof Y=="function"?Y():null;s(d||null),we().then(a=>s(a||null)).catch(a=>{console.warn("âš ï¸ [tabs.js] Failed to load tab preferences",a),s(null)}),le||(le=Be(a=>{if(!(!D||!a))if(a.dashboardTab&&a.dashboardTab!==L&&n(a.dashboardTab,{skipStore:!0}),L==="reservations-tab"){if(a.dashboardSubTab&&a.dashboardSubTab!==T)Q(a.dashboardSubTab);else if(!a.dashboardSubTab&&T){const c=x(P);c?c!==T&&Q(c):Q(null)}}else a.dashboardSubTab&&(q=a.dashboardSubTab)}))}function Je(){h("ğŸš€ [tabs.js] setupSubTabs()");const e=document.querySelectorAll("#reservations-tab .sub-tab-button"),t=document.querySelectorAll("#reservations-tab .sub-tab");if(h("ğŸ“Œ subTabButtons:",e),h("ğŸ“Œ subTabContents:",t),!e.length){console.warn("âš ï¸ [tabs.js] No reservation sub-tab buttons found");return}const n=Array.from(e).map(s=>s?.getAttribute("data-sub-tab")).filter(s=>typeof s=="string"&&s.trim().length>0),o=()=>n.length?n.includes(J)?J:n[0]:null,i=(s,{skipStore:d=!1}={})=>{if(!n.length)return;let a=s;(!a||!n.includes(a))&&(console.warn("âš ï¸ [tabs.js] Invalid sub-tab target, falling back to first available",{requested:a,available:n}),a=o());const c=document.querySelector(`#reservations-tab .sub-tab-button[data-sub-tab="${a}"]`),p=document.getElementById(a);if(!c||!p){console.warn("âš ï¸ [tabs.js] Unable to locate sub-tab button/content after fallback",{target:a});return}if(T===a&&c.classList.contains("active")&&p.classList.contains("active")&&p.getAttribute("aria-hidden")==="false"){p.removeAttribute("hidden"),p.style.display="block",p.setAttribute("aria-hidden","false"),T=a,ie(c),d||(oe(P,a),O({dashboardSubTab:a}).catch(l=>{console.warn("âš ï¸ [tabs.js] Failed to store sub-tab preference",l)}));return}e.forEach(l=>{l.classList.remove("active"),l.classList.contains("tab")&&l.classList.remove("tab-active"),l.setAttribute("aria-selected","false"),l.setAttribute("tabindex","-1")}),c.classList.add("active"),c.classList.contains("tab")&&c.classList.add("tab-active"),c.setAttribute("aria-selected","true"),c.setAttribute("tabindex","0"),ie(c),t.forEach(l=>{const u=l.id===a;l.classList.toggle("active",u),l.setAttribute("aria-hidden",u?"false":"true"),u?(l.removeAttribute("hidden"),l.style.display="block"):(l.setAttribute("hidden",""),l.style.display="none")}),T=a,oe(P,a),d||O({dashboardSubTab:a}).catch(l=>{console.warn("âš ï¸ [tabs.js] Failed to store sub-tab preference",l)}),typeof document<"u"&&document.dispatchEvent(new CustomEvent("reservations:subTabChanged",{detail:{subTabId:a}})),a==="my-reservations-tab"?(h("ğŸ“‹ Rendering reservations list"),setTimeout(()=>{Ie().then(l=>{try{l.renderReservations?.()}catch(u){console.error("âŒ [tabs.js] Failed to render reservations list",u)}}).catch(l=>console.error("âŒ [tabs.js] Unable to load reservations UI module",l))},50)):a==="calendar-tab"?(h("ğŸ“… Rendering calendar view"),setTimeout(()=>{We().then(l=>{try{l.renderCalendar?.()}catch(u){console.error("âŒ [tabs.js] Failed to render calendar",u)}}).catch(l=>console.error("âŒ [tabs.js] Unable to load calendar module",l))},100)):a==="reports-tab"&&(h("ğŸ“Š Rendering reports view"),Ke().then(l=>{const{renderReports:u}=l;setTimeout(()=>{try{u?.()}catch(m){console.error("âŒ [tabs.js] Failed to render reports tab",m)}},50)}).catch(l=>{console.error("âŒ [tabs.js] Unable to load reports tab",l)}))};if(N=(s,d={})=>{s?i(s,d):(e.forEach(a=>{a.classList.remove("active"),a.classList.contains("tab")&&a.classList.remove("tab-active"),a.setAttribute("aria-selected","false"),a.setAttribute("tabindex","-1")}),t.forEach(a=>{a.classList.remove("active"),a.setAttribute("aria-hidden","true"),a.setAttribute("hidden",""),a.style.display="none"}),T=null,ve(P))},e.forEach(s=>{s.dataset.subTabListenerAttached||(s.addEventListener("click",()=>{const d=s.getAttribute("data-sub-tab");h("ğŸ–±ï¸ Sub-tab clicked:",d),i(d)}),s.dataset.subTabListenerAttached="true")}),q)i(q,{skipStore:!0}),q=null;else{const s=document.querySelector("#reservations-tab .sub-tab-button.active"),d=o(),a=s?.getAttribute("data-sub-tab")||d;a&&(h("â­ Initial sub-tab:",a),i(a,{skipStore:!0}))}}function Q(e){typeof N=="function"?N(e,{skipStore:!0}):e&&(q=e)}function Xe(){try{if(typeof Y=="function")return Y()||{}}catch(e){console.warn("âš ï¸ [tabs.js] Failed to read cached preferences",e)}return{}}function Ze({attemptsLeft:e=0}={}){if(!D||typeof C!="function")return!1;const t=Xe(),n=Array.from(document.querySelectorAll("[data-tab]"));if(!n.length)return!1;const o=n[0]?.dataset.tab||null,s=[L,document.querySelector("[data-tab].active")?.getAttribute("data-tab")||null,t.dashboardTab,x(re),o].filter(Boolean).find(a=>document.getElementById(a));if(!s)return!1;const d=()=>{const a=document.querySelector(`[data-tab].active[data-tab="${s}"]`),c=document.getElementById(s);return!!(a&&c?.classList.contains("active")&&c?.style.display!=="none")};if(s==="reservations-tab"){const a=Array.from(document.querySelectorAll("#reservations-tab .sub-tab-button"));if(!a.length)return!1;const c=a[0]?.getAttribute("data-sub-tab")||null,f=[T,document.querySelector("#reservations-tab .sub-tab-button.active")?.getAttribute("data-sub-tab")||null,document.querySelector("#reservations-tab .sub-tab.active")?.id||null,t.dashboardSubTab,x(P),c].filter(Boolean).find(b=>document.getElementById(b)),l=document.querySelector("#reservations-tab .sub-tab-button.active"),u=document.querySelector("#reservations-tab .sub-tab.active"),m=u?.id||l?.getAttribute("data-sub-tab")||null;if(f&&m===f&&d())return u&&(u.removeAttribute("hidden"),u.style.display="block",u.setAttribute("aria-hidden","false")),!0;if(f)q=f;else if(e>0)return!1}else if(d())return!0;return C(s,{skipStore:!0,skipRender:!0}),!0}function ce(){if(!D)return;let e=0;const t=5;j&&(clearTimeout(j),j=null);const n=()=>{if(Ze({attemptsLeft:t-e})){j=null;return}if(e>=t){j=null;return}e+=1,j=setTimeout(n,50*(e+1))};n()}document.addEventListener("language:translationsReady",ce);document.addEventListener("language:changed",ce);document.addEventListener("theme:changed",ce);let S=[],k=[],V=null,F=!1,be=!1;const r={};function et(){r.form=document.getElementById("equipment-package-form"),r.hiddenId=document.getElementById("equipment-package-id"),r.nameInput=document.getElementById("equipment-package-name"),r.codeInput=document.getElementById("equipment-package-code"),r.priceInput=document.getElementById("equipment-package-price"),r.qtyInput=document.getElementById("equipment-package-qty"),r.descriptionInput=document.getElementById("equipment-package-description"),r.openSelector=document.getElementById("equipment-package-open-selector"),r.selectionWrapper=document.getElementById("equipment-package-selection-active"),r.selectionCounter=document.getElementById("equipment-package-selection-counter"),r.applySelection=document.getElementById("equipment-package-apply-selection"),r.cancelSelection=document.getElementById("equipment-package-cancel-selection"),r.itemsTableBody=document.querySelector("#equipment-package-items-table tbody"),r.itemsEmptyMessage=document.getElementById("equipment-package-items-empty"),r.resetButton=document.getElementById("equipment-package-reset"),r.submitButton=document.getElementById("equipment-package-submit"),r.tableBody=document.getElementById("equipment-packages-table-body"),r.emptyRow=document.getElementById("equipment-packages-empty-row"),r.countBadge=document.getElementById("equipment-packages-count"),r.applySelection&&(r.applySelection.style.display="none")}function Se(){const{equipment:e=[]}=Z()||{};return Array.isArray(e)?e:[]}function ue(){const e=new Map;return Se().forEach(t=>{const n=t?.id??t?.equipment_id??t?.equipmentId??null;n!=null&&e.set(String(n),t)}),e}function tt(){const e=new Map;return Se().forEach(t=>{const n=he(t?.barcode);n&&!e.has(n)&&e.set(n,t)}),e}function $(e,{persist:t=!1}={}){S=Array.isArray(e)?e.map(_e):[],ct(),t&&(Le({packages:S}),document.dispatchEvent(new CustomEvent("packages:changed",{detail:{packages:S}})))}function _e(e={}){const t=nt(e.items??e.equipment_ids??e.equipmentIds??[]);return{id:e.id!=null?String(e.id):"",package_code:e.package_code??e.code??e.slug??"",slug:e.slug??null,name:e.name??e.title??e.label??"",description:e.description??"",price:at(e.price??e.total_price??e.package_price??0),package_qty:Number.isFinite(Number(e.package_qty??e.packageQty))&&Number(e.package_qty??e.packageQty)>0?Number(e.package_qty??e.packageQty):1,is_active:rt(e.is_active??e.active??!0),items:t,created_at:e.created_at??null,updated_at:e.updated_at??null}}function nt(e){return Array.isArray(e)||(e=[]),e.map(t=>{if(t==null)return null;if(typeof t=="number"||typeof t=="string"){const n=String(t).trim();return n?{equipment_id:n,quantity:1,unit_price:null}:null}if(typeof t=="object"){const n=t.equipment_id??t.equipmentId??t.id??t.item_id??t.itemId??null;if(n==null)return null;const o=Number.isFinite(Number(t.quantity??t.qty))?Number(t.quantity??t.qty):1,i=Number.isFinite(Number(t.unit_price??t.price))?Number(t.unit_price??t.price):null;return{equipment_id:String(n),quantity:o>0?o:1,unit_price:i}}return null}).filter(Boolean)}function at(e){const t=Number.parseFloat(e);return Number.isFinite(t)?Math.round(t*100)/100:0}function rt(e){if(e===!0||e===!1)return e;if(e==null)return!0;const t=String(e).trim().toLowerCase();return!(t==="0"||t==="false"||t==="no")}function it(e){const t=e?.quantity??e?.qty??1,n=Number.parseFloat(I(String(t)));return!Number.isFinite(n)||n<=0?1:n}function ot(e,t){const n=[e?.unit_price,e?.price];for(const i of n){if(i==null)continue;const s=Number.parseFloat(I(String(i)));if(Number.isFinite(s))return s}const o=e?.equipment_id??e?.equipmentId??e?.id;if(o!=null&&t instanceof Map){const i=t.get(String(o));if(i&&typeof i=="object"){const s=[i.unit_price,i.unitPrice,i.price,i.daily_rate,i.dailyRate];for(const d of s){if(d==null)continue;const a=Number.parseFloat(I(String(d)));if(Number.isFinite(a))return a}}}return 0}function st(e=null){const t=e instanceof Map?e:ue();return k.reduce((n,o)=>{const i=it(o),s=ot(o,t),d=Number.isFinite(i)&&i>0?i:1,a=Number.isFinite(s)&&s>0?s:0;return n+d*a},0)}function fe(e){const t=r.priceInput;if(!t)return;const n=t.dataset.autoCalculated==="false",o=!!(t.value&&t.value.trim());if(n&&o)return;if(!Number.isFinite(e)||k.length===0){t.value="",t.dataset.autoCalculated="true";return}const i=e<0?0:e,s=Math.round(i*100)/100,d=Number.isInteger(s)?String(s):s.toFixed(2);t.value=d,t.dataset.autoCalculated="true"}function U(){if(!r.itemsTableBody||!r.itemsEmptyMessage)return;if(k.length===0){r.itemsTableBody.innerHTML="",r.itemsEmptyMessage.hidden=!1,fe(0);return}const e=ue(),t=k.map((o,i)=>{const s=e.get(String(o.equipment_id)),d=s?.desc||s?.name||g("equipment.packages.items.unknown","Ù…Ø¹Ø¯Ø© Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…"),a=s?.barcode?I(String(s.barcode)):"",c=I(String(o.quantity??1)),p=a?`${d} â€” ${a}`:d;return`
      <tr data-package-item-index="${i}">
        <td>${p}</td>
        <td>${c}</td>
        <td>
          <button type="button" class="btn btn-outline-danger btn-sm" data-action="remove-item" data-index="${i}">ğŸ—‘ï¸</button>
        </td>
      </tr>
    `});r.itemsTableBody.innerHTML=t.join(""),r.itemsEmptyMessage.hidden=!0;const n=st(e);fe(n)}function ct(){if(!r.tableBody||!r.emptyRow)return;if(!S.length){r.tableBody.innerHTML="",r.tableBody.appendChild(r.emptyRow),r.emptyRow.hidden=!1,r.countBadge&&(r.countBadge.textContent="0");return}const e=ue(),t=S.map(n=>{const o=Ue({...n,items:n.items}),i=o.map(c=>{const p=e.get(String(c.equipmentId??c.equipment_id)),f=p?.desc||p?.name||c.desc||g("equipment.packages.items.unknown","Ù…Ø¹Ø¯Ø© Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…"),l=I(String(c.qty??c.quantity??1)),u=c.barcode||p?.barcode,m=u?` (${I(String(u))})`:"";return`<li>${f}${m} Ã— ${l}</li>`}),s=o.reduce((c,p)=>c+(Number(p.qty??p.quantity??1)||0),0),d=Number(n.package_qty??1),a=`${I(n.price.toFixed(2))} ${g("reservations.create.summary.currency","SR")}`;return`
      <tr data-package-id="${n.id}">
        <td>${n.name||g("common.placeholder.empty","â€”")}</td>
        <td>${n.package_code||g("common.placeholder.empty","â€”")}</td>
        <td>${a}</td>
        <td>${I(String(d))}</td>
        <td>
          <details>
            <summary>${I(String(s||0))}</summary>
            <ul class="equipment-package-items-summary">${i.join("")}</ul>
          </details>
        </td>
        <td>
          <div class="d-flex gap-2">
            <button type="button" class="btn btn-sm btn-outline-primary" data-action="edit-package" data-id="${n.id}">âœï¸</button>
            <button type="button" class="btn btn-sm btn-outline-danger" data-action="delete-package" data-id="${n.id}">ğŸ—‘ï¸</button>
          </div>
        </td>
      </tr>
    `});r.tableBody.innerHTML=t.join(""),r.emptyRow.hidden=!0,r.countBadge&&(r.countBadge.textContent=I(String(S.length)))}function qe(){V=null,k=[],r.hiddenId&&(r.hiddenId.value=""),r.nameInput&&(r.nameInput.value=""),r.codeInput&&(r.codeInput.value=""),r.priceInput&&(r.priceInput.value="",r.priceInput.dataset.autoCalculated="true"),r.qtyInput&&(r.qtyInput.value="1"),r.descriptionInput&&(r.descriptionInput.value=""),r.submitButton&&(r.submitButton.textContent=g("equipment.packages.form.actions.save","ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø­Ø²Ù…Ø©")),U(),R(!1)}function ut(e){V=e.id||null,k=e.items.map(t=>({...t})),r.hiddenId&&(r.hiddenId.value=V||""),r.nameInput&&(r.nameInput.value=e.name||""),r.codeInput&&(r.codeInput.value=e.package_code||""),r.priceInput&&(r.priceInput.value=e.price!=null?String(e.price):"",r.priceInput.dataset.autoCalculated=e.price!=null?"false":"true"),r.qtyInput&&(r.qtyInput.value=e.package_qty!=null?String(e.package_qty):"1"),r.descriptionInput&&(r.descriptionInput.value=e.description||""),r.submitButton&&(r.submitButton.textContent=g("equipment.packages.form.actions.update","ğŸ’¾ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø²Ù…Ø©")),U(),R(!1)}function R(e=F){F=e,r.selectionWrapper&&(F?r.selectionWrapper.hidden=!1:r.selectionWrapper.hidden=!0),r.openSelector&&(r.openSelector.disabled=F),r.cancelSelection&&(r.cancelSelection.disabled=!F),Ee()}function Ee(){if(r.selectionCounter){if(!F){r.selectionCounter.textContent=g("equipment.packages.selection.counter","Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø¹Ù†Ø§ØµØ± Ø¨Ø¹Ø¯.");return}r.selectionCounter.textContent=g("equipment.packages.selection.autoMode","Ø£ÙŠ Ù…Ø¹Ø¯Ø© ØªØ®ØªØ§Ø±Ù‡Ø§ Ø³ØªÙØ¶Ø§Ù Ù…Ø¨Ø§Ø´Ø±Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø²Ù…Ø©. Ø§Ø³ØªØ®Ø¯Ù… Ø²Ø± Ø¥Ù„ØºØ§Ø¡ Ù„Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† ÙˆØ¶Ø¹ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±.")}}function dt(e){const t=e?.detail||{},n=!!t.active,o=t.selection||t.previous||{},i=o?.mode||o?.source||"";if(i!=="package-manager"&&i!=="equipment-packages"){!n&&F&&(R(!1),se());return}if(n){R(!0);return}R(!1),se()}function lt(e){const t=e?.detail;if(!t)return;const n=t.selection||{},o=n?.mode||n?.source||"";if(o!=="package-manager"&&o!=="equipment-packages")return;const i=Array.isArray(t.barcodes)?t.barcodes:[],s=Number.isInteger(t.quantity)&&t.quantity>0?t.quantity:1,d=i.length?i:t.barcode?[t.barcode]:[];if(!d.length)return;const a=tt(),c=[],p=new Set;d.forEach(m=>{const b=he(m);b&&!p.has(b)&&(p.add(b),c.push(b))});const f=Math.min(c.length,s);let l=0;const u=[];for(let m=0;m<f;m+=1){const b=c[m],y=a.get(b);if(!y)continue;const _=y?.id??y?.equipment_id??y?.equipmentId??null;if(_==null)continue;const A=y?.desc||y?.name||b,H=k.find(w=>w.equipment_id===String(_));H?H.quantity+=1:k.push({equipment_id:String(_),quantity:1,unit_price:Number.isFinite(Number(y?.price))?Number(y.price):null}),l+=1,u.push(A)}if(l>0){U(),Ee();const m=l===1?g("equipment.packages.selection.itemAddedSingle","âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© {name} Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø²Ù…Ø©"):g("equipment.packages.selection.itemAddedMulti","âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© {count} Ù…Ø¹Ø¯Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø²Ù…Ø©"),b=l===1?m.replace("{name}",u[0]||""):m.replace("{count}",I(String(l)));B(b)}else B(g("equipment.packages.selection.noMatch","âš ï¸ ØªØ¹Ø°Ø± Ø±Ø¨Ø· Ø§Ù„Ù…Ø¹Ø¯Ø§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© Ø¨Ø§Ù„Ø­Ø²Ù…ØŒ ØªØ­Ù‚Ù‚ Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"),4e3)}function mt(){R(!1),Ce("package-cancel"),se()}function se(){r.form&&(r.form.scrollIntoView({behavior:"smooth",block:"start"}),setTimeout(()=>{r.nameInput?.focus()},200))}function ae(e){const t=r.priceInput;if(!t)return;const n=t.value;if(n==null)return;const o=n.replace(/[\u066B\u066C\u060CØŒ,]/gu,".");let s=I(o).replace(/[^0-9.]/gu,"");const d=s.indexOf(".");if(d!==-1){const a=s.slice(0,d+1),c=s.slice(d+1).replace(/\./g,"");s=`${a}${c}`}if(s!==n&&(t.value=s,typeof t.setSelectionRange=="function")){const a=s.length;try{t.setSelectionRange(a,a)}catch{}}e?.type==="input"&&(t.dataset.autoCalculated=s.trim()?"false":"true")}function pt(){const e=r.nameInput?.value.trim(),t=r.codeInput?.value.trim(),n=r.descriptionInput?.value.trim()??"",o=r.priceInput?.value??"",i=Number.parseFloat(I(o)),s=r.qtyInput?.value??"",d=Number.parseInt(I(s),10);if(!e)return B(g("equipment.packages.validation.nameRequired","âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø­Ø²Ù…Ø©")),null;if(!t)return B(g("equipment.packages.validation.codeRequired","âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø­Ø²Ù…Ø©")),null;if(!k.length)return B(g("equipment.packages.validation.itemsRequired","âš ï¸ Ø£Ø¶Ù Ø¹Ù†ØµØ±Ù‹Ø§ ÙˆØ§Ø­Ø¯Ù‹Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ø­Ø²Ù…Ø©")),null;const a=k.map(c=>({equipment_id:c.equipment_id,quantity:Number.isFinite(Number(c.quantity))?Number(c.quantity):1,unit_price:c.unit_price!=null&&Number.isFinite(Number(c.unit_price))?Number(c.unit_price):null}));return{package_code:t,name:e,description:n,price:Number.isFinite(i)?i:0,package_qty:Number.isFinite(d)&&d>0?d:1,is_active:!0,items:a}}async function bt(e){if(e.preventDefault(),!r.form)return;const t=pt();if(t)try{let n;V?(n=await G(`/packages/?id=${encodeURIComponent(V)}`,{method:"PATCH",body:t}),B(g("equipment.packages.toast.updated","âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø²Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­"))):(n=await G("/packages/",{method:"POST",body:t}),B(g("equipment.packages.toast.created","âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø²Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­")));const o=_e(n?.data??n),i=S.findIndex(s=>s.id===o.id);i>=0?S.splice(i,1,o):S=[o,...S],$(S,{persist:!0}),qe()}catch(n){console.error("[equipmentPackagesManager] handlePackageSubmit error",n);const o=n?.message||g("equipment.packages.toast.saveFailed","âŒ ØªØ¹Ø°Ø± Ø­ÙØ¸ Ø§Ù„Ø­Ø²Ù…Ø©");B(o,4e3)}}function ft(e){const t=e.target.closest('[data-action="remove-item"]');if(!t)return;const n=Number(t.dataset.index);Number.isNaN(n)||(k=k.filter((o,i)=>i!==n),U())}async function gt(e){const t=e.target.closest('[data-action="edit-package"]');if(t){const o=t.dataset.id;if(!o)return;const i=S.find(s=>s.id===o);if(!i)return;ut(i);return}const n=e.target.closest('[data-action="delete-package"]');if(n){const o=n.dataset.id;if(!o||!window.confirm(g("equipment.packages.confirm.delete","Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø­Ø²Ù…Ø©ØŸ")))return;try{await G(`/packages/?id=${encodeURIComponent(o)}`,{method:"DELETE"}),S=S.filter(s=>s.id!==o),$(S,{persist:!0}),B(g("equipment.packages.toast.deleted","ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ø­Ø²Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­"))}catch(s){console.error("[equipmentPackagesManager] delete package error",s),B(g("equipment.packages.toast.deleteFailed","âŒ ØªØ¹Ø°Ø± Ø­Ø°Ù Ø§Ù„Ø­Ø²Ù…Ø©"),4e3)}}}async function Te(){try{const e=await G("/packages/?all=1"),t=Array.isArray(e?.data)?e.data:Array.isArray(e)?e:[];$(t,{persist:!0})}catch(e){console.warn("[equipmentPackagesManager] Failed to fetch packages from API, falling back to cache",e);const{packages:t=[]}=Z()||{};$(t,{persist:!1})}}function yt(){const{packages:e=[]}=Z()||{};Array.isArray(e)&&e.length?$(e,{persist:!1}):$([],{persist:!1}),U(),R(!1)}function ht(){if(F){R(!0);return}R(!0),De({mode:"package-manager",source:"equipment-packages",activatedAt:Date.now()});const e=document.querySelector('[data-tab="equipment-tab"]');e&&e.click(),window.requestAnimationFrame(()=>{setTimeout(()=>{document.getElementById("search-equipment")?.focus();const t=document.getElementById("equipment-list");t&&t.scrollIntoView({behavior:"smooth",block:"start"})},200)})}function vt(){r.form&&(r.form.addEventListener("submit",bt),r.itemsTableBody?.addEventListener("click",ft),r.resetButton?.addEventListener("click",()=>{qe()}),r.tableBody?.addEventListener("click",gt),r.openSelector?.addEventListener("click",e=>{e.preventDefault(),ht()}),r.cancelSelection?.addEventListener("click",e=>{e.preventDefault(),mt()}),r.priceInput&&!r.priceInput.dataset.normalizedAttached&&(r.priceInput.addEventListener("input",ae),r.priceInput.addEventListener("blur",ae),r.priceInput.dataset.normalizedAttached="true",ae()),be||(document.addEventListener(de.change,dt),document.addEventListener(de.requestAdd,lt),be=!0))}function ke(){typeof document>"u"||(et(),r.form&&(yt(),vt(),Te()))}const It=Object.freeze(Object.defineProperty({__proto__:null,initEquipmentPackages:ke,refreshPackagesFromApi:Te},Symbol.toStringTag,{value:"Module"}));function St(){try{const e=document.getElementById("equipment-back-to-top"),t=document.getElementById("equipment-tab");if(!e||!t)return;const n=240,o=()=>t.classList.contains("active")&&t.style.display!=="none",i=()=>{try{const d=o()&&(window.scrollY||window.pageYOffset||0)>n;e.style.display=d?"":"none"}catch{}},s=d=>{d.preventDefault();try{window.scrollTo({top:0,behavior:"smooth"})}catch{window.scrollTo(0,0)}};window.addEventListener("scroll",i,{passive:!0}),document.addEventListener("dashboard:tabChanged",i),e.addEventListener("click",s),setTimeout(i,0),setTimeout(i,250)}catch{}}function _t(){const e=n=>{try{const o=n?.target;if(!o||!(o instanceof Element)||!o.classList?.contains("modal"))return;const i=document.activeElement;if(i&&o.contains(i)){try{i.blur()}catch{}try{document.body?.focus({preventScroll:!0})}catch{}}}catch{}};document.addEventListener("hide.bs.modal",e,!0),document.addEventListener("hidden.bs.modal",e,!0);const t=n=>{try{const i=(n.target instanceof Element?n.target:null)?.closest('[data-bs-dismiss="modal"], .btn-close');if(!i)return;try{i.blur()}catch{}try{document.body?.focus({preventScroll:!0})}catch{}}catch{}};document.addEventListener("click",t,!0)}Pe();let v=null,K=null,W=null;function qt(){try{const e="reservations:create:draft",n=(()=>{try{if(typeof window<"u"&&window.sessionStorage){const i=window.sessionStorage.getItem(e);if(i)return JSON.parse(i)}}catch{}try{if(typeof window<"u"&&window.localStorage){const i=window.localStorage.getItem(e);if(i)return JSON.parse(i)}}catch{}return null})();if(!n)return;const o=(i,s)=>{const d=document.getElementById(i);d&&typeof s=="string"&&(d.value||(d.value=s))};o("res-start",n.startDate||""),o("res-end",n.endDate||""),o("res-start-time",n.startTime||""),o("res-end-time",n.endTime||"");try{const i=document.getElementById("res-customer-input"),s=document.getElementById("res-customer");i&&typeof n.customerLabel=="string"&&!i.value&&(i.value=n.customerLabel),s&&typeof n.customerId=="string"&&!s.value&&(s.value=n.customerId)}catch{}}catch{}}function Et(){return W||(W=E(()=>import("./dashboardMetrics.572guACh.js"),__vite__mapDeps([19,2,3]),import.meta.url).then(e=>{try{typeof e.initDashboardMetrics=="function"&&e.initDashboardMetrics()}catch(t){console.error("âŒ Failed to initialise dashboard metrics",t)}return e}).catch(e=>{throw console.error("âŒ Failed to load dashboard metrics module",e),W=null,e})),W}function Tt(){const e=()=>{Et()};typeof window<"u"&&typeof window.requestIdleCallback=="function"?window.requestIdleCallback(()=>{e()},{timeout:1500}):setTimeout(e,0)}function kt(){const e=async()=>{try{const t=[];t.push(E(()=>import("./projectsService.BGLnOYZW.js"),__vite__mapDeps([16,2,3]),import.meta.url).then(n=>n.refreshProjectsFromApi().catch(()=>{})).catch(()=>{})),t.push(E(()=>import("./reservationsService.CU7qTLqY.js").then(n=>n.Q),__vite__mapDeps([6,2,3,4]),import.meta.url).then(n=>n.refreshReservationsFromApi().catch(()=>{})).catch(()=>{})),t.push(E(()=>import("./state.CY6GwEtX.js").then(n=>n.P),__vite__mapDeps([4,2,3]),import.meta.url).then(n=>n.refreshTechniciansFromApi().catch(()=>{})).catch(()=>{})),t.push(E(()=>import("./maintenanceService.qEZY7V3Y.js"),__vite__mapDeps([7,2,3]),import.meta.url).then(n=>n.refreshMaintenanceFromApi().catch(()=>{})).catch(()=>{})),t.push(E(()=>import("./uiBridge.CMaEDZm-.js").then(n=>n.h),__vite__mapDeps([1,2,3,4]),import.meta.url).then(n=>n.refreshEquipmentFromApi({showToastOnError:!1}).catch(()=>{})).catch(()=>{})),t.push(E(()=>Promise.resolve().then(()=>It),void 0,import.meta.url).then(n=>n.refreshPackagesFromApi().catch(()=>{})).catch(()=>{})),t.push(E(()=>import("./reservationsUI.Vnv1_9Uc.js"),__vite__mapDeps([9,10,2,3,11,4,6,1,12,13,14,8,15,16]),import.meta.url).catch(()=>{})),await Promise.allSettled(t)}catch{}};typeof window<"u"&&typeof window.requestIdleCallback=="function"?window.requestIdleCallback(()=>{e()},{timeout:2500}):setTimeout(e,500)}async function ge(){if(!await Re())return;He();try{qt()}catch{}Ge(),St(),Fe(),ye(),ke(),Ne();try{_t()}catch{}Tt(),kt();const t=document.getElementById("excel-upload");t&&t.addEventListener("change",async o=>{const i=o.target.files&&o.target.files[0];i&&(await Me(i),o.target.value="")});const n=document.getElementById("excel-upload-trigger");n&&t&&n.addEventListener("click",o=>{o.preventDefault(),t.click()}),document.getElementById("logout-btn")?.addEventListener("click",xe),At(),wt()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{ge().catch(e=>{console.error("âŒ Failed to initialise app",e)})},{once:!0}):ge().catch(e=>{console.error("âŒ Failed to initialise app",e)});function At(){document.querySelectorAll('input[type="datetime-local"]').forEach(e=>{e.addEventListener("input",()=>{const t=e.value;if(!t.includes("T"))return;const[n,o]=t.split("T"),[i]=o.split(":"),s=`${i.padStart(2,"0")}:00`,d=`${n}T${s}`;e.value!==d&&(e.value=d,setTimeout(()=>e.blur(),150))})})}function wt(){const e=new URLSearchParams(window.location.search),t=e.get("reservationEditId"),n=e.get("reservationEditIndex");if(!t&&!n)return;v={reservationId:t,reservationIndex:n!=null?Number(n):null},Ae(),e.delete("reservationEditId"),e.delete("reservationEditIndex");const o=e.toString(),i=`${window.location.pathname}${o?`?${o}`:""}${window.location.hash||""}`;window.history.replaceState({},document.title,i)}function Bt(e){const t=document.getElementById(e);return!!(t?.classList.contains("active")&&t?.style.display!=="none")}function Lt(e){return new Promise(t=>{if(Bt(e)){t();return}const n=i=>{i?.detail?.tabId===e&&(document.removeEventListener("dashboard:tabChanged",n),t())};document.addEventListener("dashboard:tabChanged",n),document.querySelector(`[data-tab="${e}"]`)?.click()})}function Pt(e){const t=document.querySelector(`#reservations-tab .sub-tab-button[data-sub-tab="${e}"]`),n=document.getElementById(e);return!!(t?.classList.contains("active")&&n?.classList.contains("active")&&n?.getAttribute("aria-hidden")==="false")}function Rt(e){return new Promise(t=>{if(Pt(e)){t();return}const n=i=>{i?.detail?.subTabId===e&&(document.removeEventListener("reservations:subTabChanged",n),t())};document.addEventListener("reservations:subTabChanged",n),document.querySelector(`#reservations-tab .sub-tab-button[data-sub-tab="${e}"]`)?.click()})}async function Ft(){const e=je("openReservationEditor");if(typeof e=="function")return e;const t=await $e("openReservationEditor");if(typeof t=="function")return t;throw new Error("Reservation editor handler is unavailable")}async function Ae(){if(!v)return;if(K)return K;const e=(async()=>{const n=Z().reservations||[];let o=null;if(v.reservationId){const a=n.findIndex(c=>String(c?.id)===v.reservationId||String(c?.reservationId)===v.reservationId);a!==-1&&(o=a)}if(o===null&&typeof v.reservationIndex=="number"&&!Number.isNaN(v.reservationIndex)&&v.reservationIndex>=0&&v.reservationIndex<n.length&&(o=v.reservationIndex),o===null)return;const i="my-reservations-tab",s="reservations-tab",d=v;v=null;try{await Lt(s),await Rt(i);const a=await Ft();typeof a=="function"?a(o):(console.warn("âš ï¸ Pending reservation edit skipped: editor is not available"),v=d)}catch(a){console.error("âŒ Failed to open pending reservation editor",a),v=d}})();K=e;try{await e}finally{K=null}}document.addEventListener("reservations:changed",()=>{v&&Ae()});
