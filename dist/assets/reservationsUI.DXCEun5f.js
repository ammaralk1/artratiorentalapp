import{b as l,s as f,g as m,l as p,c as v,d as n,a as h,i as b,h as R,f as w,u as s,j as E}from"./controller.D81DiyQ4.js";import{n as K,m as V,o as B,p as J,k as N}from"./controller.D81DiyQ4.js";import{i as y,j as I}from"./reservationsService.xTOvDkMk.js";import{d as g}from"./auth.CfSWwk88.js";import{e as k}from"./reservationsActions.DlJBPW9u.js";import{ensureProjectsLoaded as T}from"./projectsService.DGUdVQyF.js";import"./state.r7LAfWRX.js";import"./uiBridge.COTfT8h5.js";import"./quotePdf.WC1ebubv.js";import"./canvasColorUtils.CviLtv6S.js";let i=!1;function F(){document.querySelectorAll('input[type="time"]').forEach(t=>{t.setAttribute("step","300")})}function C(){return typeof window<"u"&&typeof window.flatpickr=="function"?window.flatpickr.bind(window):typeof globalThis<"u"&&typeof globalThis.flatpickr=="function"?globalThis.flatpickr.bind(globalThis):(console.warn("⚠️ Flatpickr غير متاح - سيتم تخطي تهيئة عناصر التاريخ"),null)}function S(){const e=C(),t={dateFormat:"Y-m-d",altInput:!0,altFormat:"Y-m-d",allowInput:!0,disableMobile:!0,altInputClass:"flatpickr-alt-input form-control"},o=[["#res-start",{}],["#res-end",{}],["#filter-start-date",{}],["#filter-end-date",{}],["#edit-res-start",{}],["#edit-res-end",{}]],d={enableTime:!0,noCalendar:!0,dateFormat:"H:i",altInput:!0,altFormat:"h:i K",time_24hr:!1,defaultHour:9,defaultMinute:0,disableMobile:!0,minuteIncrement:5,altInputClass:"flatpickr-alt-input form-control"},c=["#res-start-time","#res-end-time","#edit-res-start-time","#edit-res-end-time"];e&&(o.forEach(([r,u])=>{document.querySelector(r)&&e(r,{...t,...u})}),c.forEach(r=>{document.querySelector(r)&&e(r,{...d})}));const a=document.querySelector("#res-start-time");a&&a.dispatchEvent(new Event("change",{bubbles:!0}))}function L(){if(!i){F(),l(()=>n()),f(m()),y({onDraftChange:E,onEditChange:s}),p(),v(),i=!0;try{const e=()=>n();document.addEventListener("reservations:updated",e),window.addEventListener("reservations:updated",e)}catch{}}}function D(){const e=document.body;e&&e.dataset.reservationsTechListener!=="true"&&(document.addEventListener("technicians:updated",()=>{const{technicians:t=[]}=g();I(t),w(),s()}),e.dataset.reservationsTechListener="true")}async function Y(){await k();try{await T({force:!0})}catch(e){console.warn("⚠️ [reservations/events] Failed to pre-load projects for reservation form",e)}n(),h(),b({onAfterSubmit:R}),i||L(),S(),D()}export{K as confirmReservation,V as deleteReservation,m as getReservationsEditContext,R as handleReservationsMutation,b as initCreateReservationForm,Y as initializeReservationUI,p as loadReservationForm,B as openReservationEditor,h as registerReservationGlobals,E as renderDraftReservationSummary,n as renderReservations,J as setFlatpickrValue,f as setupEditReservationModalEvents,v as setupEquipmentDescriptionInputs,L as setupReservationEvents,N as showReservationDetails,s as updateEditReservationSummary};
