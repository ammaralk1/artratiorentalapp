import{b as f,s as m,g as p,l as v,c as h,d as i,a as R,i as y,h as b,f as g,u as d,j as E,p as w}from"./controller.D1uSiY_A.js";import{n as J,m as O,o as Q,q as W,k as X}from"./controller.D1uSiY_A.js";import{i as I,j as F}from"./reservationsService.ChFctUBH.js";import{d as c,t as T}from"./auth.CBLJBoUs.js";import{e as k}from"./reservationsActions.o3a_wJw8.js";import{ensureProjectsLoaded as C}from"./projectsService.DBmi5eI4.js";import"./technicians.CyB3jWyP.js";import"./uiBridge.CXgb5c0H.js";import"./quotePdf.WC1ebubv.js";import"./canvasColorUtils.CviLtv6S.js";let s=!1;function S(){document.querySelectorAll('input[type="time"]').forEach(t=>{t.setAttribute("step","300")})}function L(){return typeof window<"u"&&typeof window.flatpickr=="function"?window.flatpickr.bind(window):typeof globalThis<"u"&&typeof globalThis.flatpickr=="function"?globalThis.flatpickr.bind(globalThis):(console.warn("⚠️ Flatpickr غير متاح - سيتم تخطي تهيئة عناصر التاريخ"),null)}function q(){const e=L(),t={dateFormat:"Y-m-d",altInput:!0,altFormat:"Y-m-d",allowInput:!0,disableMobile:!0,altInputClass:"flatpickr-alt-input form-control"},r=[["#res-start",{}],["#res-end",{}],["#filter-start-date",{}],["#filter-end-date",{}],["#edit-res-start",{}],["#edit-res-end",{}]],a={enableTime:!0,noCalendar:!0,dateFormat:"H:i",altInput:!0,altFormat:"h:i K",time_24hr:!1,defaultHour:9,defaultMinute:0,disableMobile:!0,minuteIncrement:5,altInputClass:"flatpickr-alt-input form-control"},l=["#res-start-time","#res-end-time","#edit-res-start-time","#edit-res-end-time"];e&&(r.forEach(([n,u])=>{document.querySelector(n)&&e(n,{...t,...u})}),l.forEach(n=>{document.querySelector(n)&&e(n,{...a})}));const o=document.querySelector("#res-start-time");o&&o.dispatchEvent(new Event("change",{bubbles:!0}))}function A(){if(!s){S(),f(()=>i()),m(p()),I({onDraftChange:()=>{E();try{w()}catch{}},onEditChange:d}),v(),h(),s=!0;try{const e=()=>i();document.addEventListener("reservations:updated",e),window.addEventListener("reservations:updated",e)}catch{}}}function j(){const e=document.body;e&&e.dataset.reservationsTechListener!=="true"&&(document.addEventListener("technicians:updated",()=>{const{technicians:t=[]}=c();F(t),g(),d()}),e.dataset.reservationsTechListener="true")}function D(){try{const{reservations:e=[]}=c();return Array.isArray(e)&&e.length>0}catch{return!1}}function _(){const e=document.getElementById("reservations-list");if(!e||e.querySelector("[data-reservations-loader]"))return;const t=document.createElement("div");t.className="reservations-inline-loader",t.setAttribute("data-reservations-loader","true"),t.setAttribute("aria-live","polite");const r=T("reservations.list.loading","جارٍ تحميل الحجوزات...");t.innerHTML=`
    <div class="loading loading-spinner loading-lg text-primary" aria-hidden="true"></div>
    <p class="reservations-inline-loader__text">${r}</p>
  `,e.replaceChildren(t)}function x(){const e=document.getElementById("reservations-list");if(!e)return;const t=e.querySelector("[data-reservations-loader]");t&&t.remove()}async function N(){if(D())try{i()}catch{}else _();const[t,r]=await Promise.allSettled([k(),C({force:!0})]);t.status==="rejected"&&console.warn("⚠️ [reservations/events] Failed to load reservations from API",t.reason),r.status==="rejected"&&console.warn("⚠️ [reservations/events] Failed to pre-load projects for reservation form",r.reason),x();try{i()}catch(a){console.error("❌ [reservations/events] Failed to render reservations after load",a)}R(),y({onAfterSubmit:b}),s||A(),q(),j()}export{J as confirmReservation,O as deleteReservation,p as getReservationsEditContext,b as handleReservationsMutation,y as initCreateReservationForm,N as initializeReservationUI,v as loadReservationForm,Q as openReservationEditor,R as registerReservationGlobals,E as renderDraftReservationSummary,i as renderReservations,W as setFlatpickrValue,m as setupEditReservationModalEvents,h as setupEquipmentDescriptionInputs,A as setupReservationEvents,X as showReservationDetails,d as updateEditReservationSummary};
