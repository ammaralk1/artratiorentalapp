import{n as p,t as o,p as qt}from"./auth.BW38ChCf.js";import{c as Ht,e as d,d as Et,t as Bt,f as $}from"./state.DQTUmXyj.js";import{d as it,c as Lt,e as kt,g as Dt}from"./reservationsService.COr1lRhW.js";import{f as nt}from"./view.CLSBpaJ2.js";const q=.15,Vt=2,Mt={upcoming:"Upcoming",ongoing:"In Progress",completed:"Completed"},Wt={upcoming:"timeline-status-badge timeline-status-badge--upcoming",ongoing:"timeline-status-badge timeline-status-badge--ongoing",completed:"timeline-status-badge timeline-status-badge--completed"};function st(t){if(!t)return null;const e=[t?.id,t?.reservationId,t?.reservation_id,t?.reservationID].find(s=>s!=null&&s!=="");return e!=null?String(e):null}function zt(t,a){if(!t)return{dateHtml:"â€”",timeText:""};const e=nt(t),s=a?nt(a):"",c=b=>{const g=String(b).split(" ").filter(Boolean),f=g.shift()||"",_=g.join(" ");return{date:f,time:_}},i=c(e),l=s?c(s):{date:"",time:""};let n="",m="";return l.date&&i.date===l.date?(n=`<div class="date-range"><div class="date-line">${i.date}</div></div>`,m=`Ù…Ù† ${i.time||"â€”:â€”"} Ø¥Ù„Ù‰ ${l.time||"â€”:â€”"}`):(n=`<div class="date-range"><div class="date-line">${i.date}</div>`+(l.date?`<div class="date-line">${l.date}</div>`:"")+"</div>",m=`Ù…Ù† ${i.time||"â€”:â€”"} Ø¥Ù„Ù‰ ${l.time||"â€”:â€”"}`),{dateHtml:n,timeText:m}}function Ot(t=[]){const a=Dt();return t.map(e=>{const s=e?.reservation??e;if(!s||typeof s!="object")return null;let c=Number.isInteger(e?.index)&&e.index>=0?e.index:Number.isInteger(e?.reservationIndex)&&e.reservationIndex>=0?e.reservationIndex:null;if(!Number.isInteger(c)||c<0){const i=st(s);i&&(c=a.findIndex(l=>{const n=st(l);return n&&n===i}))}return{reservation:s,index:Number.isInteger(c)&&c>=0?c:-1}}).filter(Boolean)}function Ut(t){return t?t.id!=null?String(t.id):t.projectId!=null?String(t.projectId):t.project_id!=null?String(t.project_id):null:null}function ae(t,{customer:a=null,techniciansMap:e=new Map,reservations:s=[]}={}){const i=Ot(s).map(({reservation:u})=>u),l=i.length,n=Ut(t),m=n?d(n):"",b=Et(t),g=o(`projects.status.${b}`,Mt[b]),f=Wt[b]||"bg-secondary",_=ot(t)||{},v=Number(_.subtotal||0),h=(i||[]).reduce((u,r)=>u+ct(r),0),y=_.applyTax?Number(((v+h)*q).toFixed(2)):0,T=Number((v+h+y).toFixed(2)),P=Array.isArray(t?.paymentHistory)?t.paymentHistory:Array.isArray(t?.payments)?t.payments:[],E=Lt({totalAmount:T,paidAmount:P.length?0:t.paidAmount,paidPercent:P.length?0:t.paidPercent,history:P}),A=kt({manualStatus:null,paidAmount:E.paidAmount,paidPercent:E.paidPercent,totalAmount:T}),rt=o(`projects.paymentStatus.${A}`,A==="paid"?"Paid":A==="partial"?"Partially Paid":"Unpaid"),lt=A==="paid"?"status-paid":A==="partial"?"status-partial":"status-unpaid",B=[A==="paid"?"project-focus-card--paid":"project-focus-card--unpaid"],I=t?.confirmed===!0||t?.confirmed==="true";I&&B.push("project-focus-card--confirmed");const L=t?.projectCode||(n?`PRJ-${p(n)}`:""),j=L?p(String(L).replace(/^#/,"")):"",ut=j?`<span class="project-code-badge project-focus-card__code">#${d(j)}</span>`:"",k=Gt(t?.type),dt="",mt=`<span class="${f}">${d(g)}</span>`,pt=`<span class="reservation-chip ${lt} project-focus-card__payment-chip">${d(rt)}</span>`,ft=(t?.title||"").trim()||o("projects.fallback.untitled","Untitled project"),D=(t?.description||"").trim(),yt=D?d(Bt(D,110)):d(o("projects.fallback.noDescription","No description")),V=Array.isArray(t?.technicians)?t.technicians:[],M=V.map(u=>e.get(String(u))?.name).filter(Boolean);M.length&&Xt(M);const W=a?.customerName||t?.clientName||"";(t?.clientCompany||a?.companyName||"").trim();const S=i.reduce((u,r)=>{const w=ct(r),tt=Array.isArray(r?.items)?r.items:[],Pt=tt.reduce((Ft,Rt)=>Ft+(Number(Rt?.qty)||0),0),It=Array.isArray(r?.technicians)?r.technicians.length:0,et=Array.isArray(r?.crewAssignments)?r.crewAssignments:[],C=et.length?et:Array.isArray(r?.technicians)?r.technicians:[],R=it({items:tt,technicianIds:Array.isArray(C)&&!C.length?C:[],crewAssignments:Array.isArray(C)&&C.length&&typeof C[0]=="object"?C:[],discount:r?.discount??0,discountType:r?.discountType||"percent",applyTax:!1,start:r?.start,end:r?.end,companySharePercent:null});return{total:u.total+w,equipment:u.equipment+Number(R.equipmentTotal||0),crew:u.crew+Number(R.crewTotal||0),crewCost:u.crewCost+Number(R.crewCostTotal||0),equipmentCountTotal:(u.equipmentCountTotal||0)+Pt,crewCountTotal:(u.crewCountTotal||0)+It}},{total:0,equipment:0,crew:0,crewCost:0,equipmentCountTotal:0,crewCountTotal:0}),z=Number(S.total.toFixed(2)),O=S.equipmentCountTotal||0,U=S.crewCountTotal||V.length,J=ot(t),X=Number(t?.servicesClientPrice??0),N=Number((S.equipment+S.crew+X).toFixed(2)),G=Number.parseFloat(t?.discount??t?.discountValue??0)||0;let x=(t?.discountType==="amount"?"amount":"percent")==="amount"?G:N*(G/100);(!Number.isFinite(x)||x<0)&&(x=0),x>N&&(x=N);const F=Math.max(0,N-x),bt=t?.companyShareEnabled===!0||t?.companyShareEnabled==="true"||t?.company_share_enabled===!0||t?.company_share_enabled==="true",K=Number.parseFloat(t?.companySharePercent??t?.company_share_percent??t?.companyShare??t?.company_share??0)||0,Q=bt&&K>0?K:0,Y=Number((F*(Q/100)).toFixed(2)),gt=J.applyTax?Number(((F+Y)*q).toFixed(2)):0,ht=Number((F+Y+gt).toFixed(2)),{dateHtml:Tt,timeText:Z}=zt(t?.start,t?.end),_t=[j?{icon:"ğŸ†”",label:o("projectCards.meta.code","Ø±Ù‚Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),value:`#${j}`}:null,W?{icon:"ğŸ‘¤",label:o("projectCards.meta.client","Ø§Ù„Ø¹Ù…ÙŠÙ„"),value:W}:null,k?{icon:"ğŸ·ï¸",label:o("projects.details.type","Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),value:`<span class="project-type-chip project-type-chip--${t.type||"default"}">${d(k)}</span>`}:null,{icon:"ğŸ“…",label:o("projects.focus.summary.range","Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©"),value:Tt},Z?{icon:"â°",label:o("projects.focus.summary.time","Ø§Ù„ÙˆÙ‚Øª"),value:Z}:null].filter(Boolean);o("projectCards.stats.reservationsShort","Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª"),p(String(l)),o("projectCards.stats.equipmentCount","Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"),p(String(O)),o("projectCards.stats.crewCount","Ø¹Ø¯Ø¯ Ø£ÙØ±Ø§Ø¯ Ø§Ù„Ø·Ø§Ù‚Ù…"),p(String(U)),o("projectCards.stats.reservationValue","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª"),$(z);const Ct=Q>0&&J.applyTax?` ${o("projects.details.chips.vatOn","(Ø´Ø§Ù…Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©)")}`:"",At=`${o("projects.details.summary.finalTotal","Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ")}${Ct}`,xt=[{icon:"ğŸ’¼",label:o("projectCards.stats.servicesClientPrice","Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©"),value:$(X)},{icon:"ğŸ’µ",label:At,value:$(ht)}].map(({icon:u,label:r,value:w})=>H(u,r,w)).join(""),vt=[{icon:"ğŸ”—",label:o("projectCards.stats.reservationsShort","Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª"),value:p(String(l))},{icon:"ğŸ“¦",label:o("projectCards.stats.equipmentCount","Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"),value:p(String(O))},{icon:"ğŸ˜",label:o("projectCards.stats.crewCount","Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ø§Ù‚Ù…"),value:p(String(U))},{icon:"ğŸ’µ",label:o("projectCards.stats.reservationValue","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª"),value:$(z)}].map(({icon:u,label:r,value:w})=>H(u,r,w)).join(""),St=[Jt("projects.focus.summary.project","Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",_t),at("projects.focus.summary.reservations","Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©",vt),at("projects.focus.summary.payment","Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ",xt)].filter(Boolean).join(""),wt=o("projects.focus.confirmed","âœ… Ù…Ø´Ø±ÙˆØ¹ Ù…Ø¤ÙƒØ¯"),jt=o("projects.focus.pending","âŒ› Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ£ÙƒÙŠØ¯"),Nt=`<div class="project-focus-card__actions"><span class="reservation-chip ${I?"status-confirmed":"status-pending"} project-focus-card__confirm-indicator">${d(I?wt:jt)}</span></div>`,$t=[ut,dt,mt,pt].filter(Boolean).join(`
          `);return`
    <div class="project-card-grid__item">
      <article class="${["project-focus-card",...B].join(" ")}" data-project-id="${m}">
        <div class="project-focus-card__accent"></div>
        <div class="project-focus-card__top">
          ${$t}
        </div>
        <h6 class="project-focus-card__title">${d(ft)}</h6>
        <p class="project-focus-card__description">${yt}</p>
        <div class="project-focus-card__sections">
          ${St}
        </div>
        ${Nt}
      </article>
    </div>
  `}function H(t,a,e){const s=t?`<span class="project-focus-card__row-icon">${d(t)}</span>`:"",c=String(e??""),n=c.trim().startsWith("<")?c:d(c);return`
    <div class="project-focus-card__row">
      <span class="project-focus-card__row-label">${s}${d(a)}</span>
      <span class="project-focus-card__row-value">${n}</span>
    </div>
  `}function Jt(t,a,e=[]){if(!e.length)return"";const s=e.map(({icon:c,label:i,value:l})=>H(c,i,l)).join("");return`
    <div class="project-focus-card__section">
      <span class="project-focus-card__section-title">${d(o(t,a))}</span>
      <div class="project-focus-card__section-box">
        ${s}
      </div>
    </div>
  `}function at(t,a,e){return e?`
    <div class="project-focus-card__section">
      <span class="project-focus-card__section-title">${d(o(t,a))}</span>
      <div class="project-focus-card__section-box">
        ${e}
      </div>
    </div>
  `:""}function Xt(t=[]){if(!t.length)return"";const a=t.slice(0,Vt),e=t.length-a.length,s=qt()==="ar"?"ØŒ ":", ";let c=a.join(s);return e>0&&(c+=`${s}+${p(String(e))}`),c}function ot(t){const a=Number(t?.equipmentEstimate)||0,e=Ht(t),s=a+e,c=t?.applyTax===!0||t?.applyTax==="true",i=Number.parseFloat(t?.discount??t?.discountValue??0)||0;let n=(t?.discountType==="amount"?"amount":"percent")==="amount"?i:s*(i/100);(!Number.isFinite(n)||n<0)&&(n=0),n>s&&(n=s);const m=Math.max(0,s-n),b=t?.companyShareEnabled===!0||t?.companyShareEnabled==="true"||t?.company_share_enabled===!0||t?.company_share_enabled==="true",g=Number.parseFloat(t?.companySharePercent??t?.company_share_percent??t?.companyShare??t?.company_share??0)||0,f=c||b&&g>0,_=b&&f&&g>0?g:0,v=_>0?Number((m*(_/100)).toFixed(2)):0,h=m+v;let y=f?h*q:0;(!Number.isFinite(y)||y<0)&&(y=0),y=Number(y.toFixed(2));let T=f?Number(t?.totalWithTax):h;return f?(!Number.isFinite(T)||T<=0)&&(T=Number((h+y).toFixed(2))):T=h,{equipmentEstimate:a,expensesTotal:e,baseSubtotal:s,discountAmount:n,subtotalAfterDiscount:m,companyShareAmount:v,subtotal:h,applyTax:f,taxAmount:y,totalWithTax:T}}function ct(t){if(!t)return 0;const a=Array.isArray(t?.items)?t.items:[],e=t?.discount??t?.discountValue??0,s=Number(p(String(e)))||0,c=t?.discountType??t?.discount_type??"percent",i=String(c).toLowerCase()==="amount"?"amount":"percent",l=Array.isArray(t?.crewAssignments)?t.crewAssignments:[],n=l.length?l:Array.isArray(t?.technicians)?t.technicians:[],m=it({items:a,technicianIds:Array.isArray(n)&&!n.length?n:[],crewAssignments:Array.isArray(n)&&n.length&&typeof n[0]=="object"?n:[],discount:s,discountType:i,applyTax:!1,start:t?.start,end:t?.end,companySharePercent:0,groupingSource:t});return Number.isFinite(Number(m?.finalTotal))?Number(m.finalTotal):0}function Gt(t){if(!t)return o("projects.form.types.unknown","Ù†ÙˆØ¹ ØºÙŠØ± Ù…Ø­Ø¯Ø¯");const e={commercial:"projects.form.types.commercial",coverage:"projects.form.types.coverage",photography:"projects.form.types.photography",social:"projects.form.types.social"}[t]||"projects.form.types.unknown";return o(e,t)}function oe(t){if(!t)return null;const a=t.projectId??t.project_id??t.projectID??null;return a!=null?String(a):null}export{q as P,ct as a,ae as b,oe as e,Ut as g,ot as r};
