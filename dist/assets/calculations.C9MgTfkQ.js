import{n as W,r as G,i as Q,p as J,l as X,m as I}from"./reservationsService.DfT39y4i.js";import{t as Z,n as A,g as E}from"./auth.Bd_qICJc.js";const y={filters:{range:"all",status:"all",payment:"all",share:"all",search:"",start:null,end:null},data:{reservations:[],customers:[],equipment:[],technicians:[],projects:[],maintenance:[],projectsMap:new Map},formatters:{cachedLocale:null,numberFormatter:null},initialized:!1,languageListenerAttached:!1,searchDebounceTimer:null,loading:!1,errorMessage:"",emptyDefaults:{icon:null,title:null,subtitle:null},dataListenersAttached:!1,loadedScripts:new Map,apexChartsReady:null,html2PdfReady:null,xlsxReady:null,techniciansIndex:null,charts:{trend:null,status:null,payment:null},chartsMeta:{trend:{categoriesSig:"",theme:""},status:{labelsSig:"",theme:""},payment:{labelsSig:"",theme:""}},lastSnapshot:{filtered:[],metrics:null,trend:[],statusBreakdown:[],paymentBreakdown:[],tableRows:[],maintenance:{total:0,items:[]}},columnPreferences:{code:!0,customer:!0,date:!0,status:!0,payment:!0,total:!0,share:!0,net:!0},exportHandlersBound:!1,columnControlsBound:!1,drilldownBound:!1,lastTrendData:[],lastStatusData:[],lastPaymentData:[],themeListenerAttached:!1,startDatePicker:null,endDatePicker:null,startDateInputRef:null,endDateInputRef:null,callbacks:{onRender:null,onBeforeRender:null,onAfterRender:null,onTrendDrilldown:null,onStatusDrilldown:null,onPaymentDrilldown:null},sort:{key:"date",dir:"desc"},pagination:{page:1,pageSize:50}};function ut(t){y.callbacks.onRender=typeof t=="function"?t:null}function it(t){y.callbacks.onBeforeRender=typeof t=="function"?t:null}function mt(t){y.callbacks.onAfterRender=typeof t=="function"?t:null}function dt(t){y.callbacks.onTrendDrilldown=typeof t=="function"?t:null}function pt(t){y.callbacks.onStatusDrilldown=typeof t=="function"?t:null}function ft(t){y.callbacks.onPaymentDrilldown=typeof t=="function"?t:null}function S(t,e,o=e){const r=E()==="en"?o??e:e;return Z(t,r)}function gt(){y.formatters.cachedLocale=null,y.formatters.numberFormatter=null}function L(){return(E()||"ar").toLowerCase().startsWith("ar")?"ar-SA-u-ca-gregory-nu-latn":"en-US"}function z(){const t=E();if(t!==y.formatters.cachedLocale||!y.formatters.numberFormatter||!y.formatters.currencyFormatter){y.formatters.cachedLocale=t;const e=L();y.formatters.numberFormatter=new Intl.NumberFormat(e,{maximumFractionDigits:0}),y.formatters.currencyFormatter=new Intl.NumberFormat(e,{minimumFractionDigits:2,maximumFractionDigits:2})}return{numberFormatter:y.formatters.numberFormatter,currencyFormatter:y.formatters.currencyFormatter}}function ht(t){const{numberFormatter:e}=z(),o=e.format(Math.round(t||0));return A(o)}function yt(t){const{currencyFormatter:e}=z(),o=Number.isFinite(Number(t))?Number(t):0,a=e.format(o);return`${A(a)} SR`}function Y(t){const e=t instanceof Date?t:new Date(t);if(!(e instanceof Date)||Number.isNaN(e.getTime()))return"";const o=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${o}-${a}-${r}`}function bt(t){if(!t)return"—";const e=t instanceof Date?t:new Date(t);if(Number.isNaN(e.getTime()))return"—";const o=new Intl.DateTimeFormat(L(),{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"});return A(o.format(e))}function v(t){return new Intl.DateTimeFormat(L(),{month:"short"}).format(t)}const tt=new Map([["confirmed","confirmed"],["مؤكد","confirmed"],["مؤكدة","confirmed"],["approved","confirmed"],["pending","pending"],["قيد التأكيد","pending"],["غير مؤكد","pending"],["in-progress","pending"],["awaiting","pending"],["completed","completed"],["منتهي","completed"],["منتهية","completed"],["done","completed"],["finished","completed"],["cancelled","cancelled"],["ملغي","cancelled"],["ملغية","cancelled"],["ملغى","cancelled"],["canceled","cancelled"]]),$=new Map([["paid",!0],["مدفوع",!0],["مدفوعة",!0],["تم الدفع",!0],["completed",!0],["unpaid",!1],["غير مدفوع",!1],["غير مدفوعة",!1],["pending",!1],["قيد الدفع",!1]]),et=1440*60*1e3,N={metrics:new Map,trend:new Map,status:new Map,payment:new Map,topCustomers:new Map,topEquipment:new Map};function F(t){const e=Array.isArray(t)?t.length:0;if(e===0)return"0|";const o=t[0]||{},a=t[e-1]||{},r=`${o.id??o.reservationId??""}-${o.start??""}`,n=`${a.id??a.reservationId??""}-${a.start??""}`,s=y.formatters?.cachedLocale||"ar";return`${e}|${r}|${n}|${s}`}function P(t,e){return t.get(e)}function R(t,e,o){if(t.set(e,o),t.size>64){const a=t.keys().next().value;t.delete(a)}return o}function H(t){return A(String(t||"")).toLowerCase().trim()}function _(t){return(t||"").toString().trim()}function K(t,e){if(!t||!e)return 1;const o=new Date(t),a=new Date(e);if(Number.isNaN(o.getTime())||Number.isNaN(a.getTime()))return 1;const r=a.getTime()-o.getTime();return r<=0?1:Math.max(1,Math.ceil(r/et))}function j(t){return t?(y.techniciansIndex||(y.techniciansIndex=new Map((y.data.technicians||[]).map(e=>[String(e.id),e]))),y.techniciansIndex.get(String(t))||null):null}function k(t={}){const e=[t.dailyWage,t.daily_rate,t.dailyRate,t.wage,t.rate];for(const o of e){if(o==null)continue;const a=Number.parseFloat(A(String(o)));if(Number.isFinite(a))return a}return 0}function q(t={}){const e=[t.dailyTotal,t.daily_total,t.totalRate,t.total,t.total_wage];for(const o of e){if(o==null)continue;const a=Number.parseFloat(A(String(o)));if(Number.isFinite(a))return a}return k(t)}function C(t){if(!t)return{rentalDays:1,equipmentTotal:0,crewTotal:0,crewCostTotal:0,discountAmount:0,subtotalAfterDiscount:0,taxableAmount:0,taxAmount:0,finalTotal:0,companySharePercent:0,companyShareAmount:0,netProfit:0};if(t.__financials)return t.__financials;K(t.start,t.end);const e=Number(t.discount??t.discountValue??0)||0,o=t.discountType||t.discount_type||"percent",a=String(o).toLowerCase()==="amount"?"amount":"percent",r=t.applyTax===!0||t.apply_tax===!0||t.apply_tax===1||t.apply_tax==="1",n=t.companySharePercent??t.company_share_percent??t.companyShare??t.company_share??null,s=n!=null?J(n):Number.NaN,l=(t.companyShareEnabled??t.company_share_enabled??t.companyShareApplied??t.company_share_applied??null)===!0&&Number.isFinite(s)&&s>0?s:null,i=Array.isArray(t.crewAssignments)?t.crewAssignments:[],d=i.length?i.map(h=>h?.technicianId).filter(Boolean):Array.isArray(t.technicians)?t.technicians:[],c=X({items:Array.isArray(t.items)?t.items:[],technicianIds:d,crewAssignments:i,discount:e,discountType:a,applyTax:r,start:t.start,end:t.end,companySharePercent:l}),u=Number(t.cost);let p=c.finalTotal,f=c.taxAmount;if(Number.isFinite(u)&&u>0&&(p=I(u),r)){const h=p-c.taxableAmount;Number.isFinite(h)&&h>=0&&(f=I(h))}const g={rentalDays:c.rentalDays,equipmentTotal:c.equipmentTotal,crewTotal:c.crewTotal,crewCostTotal:c.crewCostTotal,discountAmount:c.discountAmount,subtotalAfterDiscount:c.subtotalAfterDiscount,taxableAmount:c.taxableAmount,taxAmount:f,finalTotal:p,companySharePercent:c.companySharePercent,companyShareAmount:c.companyShareAmount,netProfit:c.netProfit,companyShareEnabled:c.companySharePercent>0};return t.__financials=g,g}function O(t){return t?.projectId&&y.data.projectsMap.get(String(t.projectId))||null}function B(t=""){const e=String(t).toLowerCase().trim();return e?tt.get(e)||e:""}function nt(t){const e=[t?.paymentStatus,t?.payment_status,t?.payment,t?.paymentState,t?.payment_state];for(const o of e){const a=String(o||"").toLowerCase().trim();if(a&&$.has(a))return $.get(a)}return t?.paid===!0||t?.paid==="true"}function D(t){const e=O(t),o=G(t,e),a=B(o.projectStatus);let r=B(t?.status??t?.reservationStatus??t?.reservation_status??t?.state??"");o.projectLinked&&a&&r!=="cancelled"&&(r=a),r||(r=o.effectiveConfirmed?"confirmed":"pending"),r!=="cancelled"&&(Q(t)||a==="completed")&&(r="completed");let n=o.effectiveConfirmed||r==="confirmed"||r==="completed";r==="cancelled"&&(n=!1),n&&r!=="completed"&&r!=="cancelled"&&(r="confirmed");const s=nt(t),m=t?.paidStatus??t?.paid_status??(s?"paid":"unpaid");return{statusValue:r,confirmed:n,paid:s,paidStatus:m}}function wt(t){const e=t.length;let o=0,a=0,r=0,n=0,s=0,m=0,l=0,i=0,d=0,c=0;t.forEach(p=>{const{statusValue:f,confirmed:g,paid:h}=D(p);if(f==="completed"&&(a+=1),f==="cancelled"&&(r+=1),g&&(o+=1),h&&f!=="cancelled"&&(n+=1),f!=="cancelled"){const b=C(p);s+=b.finalTotal,m+=b.companyShareAmount,l+=b.taxAmount,i+=b.crewTotal,d+=b.crewCostTotal??0,c+=b.netProfit}});const u=e?s/e:0;return{total:e,confirmed:o,completed:a,cancelled:r,activeTotal:Math.max(0,e-r),paidCount:n,revenue:s,average:u,companyShareTotal:m,taxTotal:l,crewTotal:i,crewCostTotal:d,netProfit:c}}function U({range:t,start:e,end:o}){const a=new Date;if(a.setHours(23,59,59,999),t==="custom"){const s=e?new Date(`${e}T00:00:00`):null,m=o?new Date(`${o}T23:59:59`):null;return{startDate:V(s)?s:null,endDate:V(m)?m:null}}let r=new Date(a),n=null;switch(t){case"last30":{n=new Date(a),n.setDate(n.getDate()-29);break}case"thisWeek":{const s=new Date(a),l=(s.getDay()-6+7)%7;s.setDate(s.getDate()-l),s.setHours(0,0,0,0);const i=new Date(s);i.setDate(s.getDate()+6),i.setHours(23,59,59,999),n=s,r=i;break}case"thisMonth":{n=new Date(a.getFullYear(),a.getMonth(),1),r=new Date(a.getFullYear(),a.getMonth()+1,0),r.setHours(23,59,59,999);break}case"thisQuarter":{const s=Math.floor(a.getMonth()/3);n=new Date(a.getFullYear(),s*3,1),r=new Date(a.getFullYear(),(s+1)*3,0),r.setHours(23,59,59,999);break}case"thisYear":{n=new Date(a.getFullYear(),0,1),r=new Date(a.getFullYear(),12,0),r.setHours(23,59,59,999);break}case"all":default:n=null,r=null;break}return n&&n.setHours(0,0,0,0),{startDate:n,endDate:r}}function V(t){return t instanceof Date&&!Number.isNaN(t.getTime())}function St(t,e){const{startDate:o,endDate:a}=U(e);let r=0;const n=[];return(t||[]).forEach(s=>{if(!s)return;const m=typeof s.repairCost=="number"?s.repairCost:Number.parseFloat(A(String(s.repairCost??"")));if(!Number.isFinite(m)||m<=0)return;const l=String(s.statusRaw??s.status??"").toLowerCase();if(!(l==="closed"||l==="completed"||l==="cancelled"))return;const d=s.resolvedAt??s.resolved_at??null,c=s.reportedAt??s.reported_at??null,u=s.createdAt??s.created_at??null,p=d?new Date(d):null,f=c?new Date(c):u?new Date(u):null,g=p&&!Number.isNaN(p.getTime())?p:f&&!Number.isNaN(f.getTime())?f:null;if(g&&(o&&g<o||a&&g>a))return;const h=Math.round(m*100)/100;r+=h,n.push({id:s.id,cost:h,date:g})}),{total:r,items:n}}function Nt(t,e){const o=Number.isFinite(e)?e:0;return{...t,maintenanceExpense:o,netProfit:(t.netProfit||0)-o}}function Dt(t){const e=`trend:${F(t)}`,o=P(N.trend,e);if(o)return o;const a=new Date,r=[],n=(t||[]).map(l=>l?.start?new Date(l.start):null).filter(l=>l&&!Number.isNaN(l.getTime()));let s=6,m=new Date(a.getFullYear(),a.getMonth(),1);if(n.length){const l=new Date(Math.min(...n.map(f=>f.getTime()))),i=new Date(Math.max(...n.map(f=>f.getTime()))),d=new Date(l.getFullYear(),l.getMonth(),1);m=new Date(i.getFullYear(),i.getMonth(),1);const c=m.getFullYear()-d.getFullYear(),u=m.getMonth()-d.getMonth(),p=c*12+u;s=Math.min(12,Math.max(6,p+1))}for(let l=s-1;l>=0;l-=1){const i=new Date(m.getFullYear(),m.getMonth()-l,1),d=i.getFullYear(),c=i.getMonth(),u=t.filter(M=>{const T=M?.start?new Date(M.start):null;return T&&T.getFullYear()===d&&T.getMonth()===c}).filter(M=>D(M).statusValue!=="cancelled"),p=u.length;let f=0,g=0,h=0;u.forEach(M=>{const T=C(M);f+=T.finalTotal,g+=T.netProfit,h+=T.companyShareAmount});const b=v(i),w=new Date(i.getFullYear(),i.getMonth(),1),x=new Date(i.getFullYear(),i.getMonth()+1,0);r.push({label:b,count:p,revenue:f,netProfit:g,companyShare:h,periodStart:w,periodEnd:x,startInput:Y(w),endInput:Y(x)})}try{const l=new Map;(t||[]).forEach(c=>{if(D(c).statusValue==="cancelled")return;const u=c?.start?new Date(c.start):null;if(!u||Number.isNaN(u.getTime()))return;const p=`${u.getFullYear()}-${String(u.getMonth()+1).padStart(2,"0")}`,f=C(c),g=l.get(p)||0;l.set(p,g+(Number(f.finalTotal)||0))});const i=r.map(c=>Number(c.revenue||0)),d=r.map((c,u)=>u<2?null:(i[u]+i[u-1]+i[u-2])/3);r.forEach((c,u)=>{const p=u>0?Number(r[u-1]?.revenue||0):null;let f=null;p!=null&&Number.isFinite(p)&&p>0&&(f=(Number(c.revenue||0)-p)/p*100);const g=c.periodStart instanceof Date?c.periodStart:null;let h=null;if(g&&!Number.isNaN(g.getTime())){const b=`${g.getFullYear()-1}-${String(g.getMonth()+1).padStart(2,"0")}`,w=l.get(b);Number.isFinite(w)&&w>0&&(h=(Number(c.revenue||0)-w)/w*100)}c.momChange=f,c.yoyChange=h,c.movingAvgRevenue=d[u]})}catch{}return R(N.trend,e,r)}function Mt(t){const e=`status:${F(t)}`,o=P(N.status,e);if(o)return o;const a={confirmed:0,pending:0,completed:0,cancelled:0};(t||[]).forEach(d=>{const{statusValue:c,confirmed:u}=D(d);c==="completed"?a.completed+=1:c==="cancelled"?a.cancelled+=1:c==="confirmed"||u?a.confirmed+=1:a.pending+=1});const r=Math.max(1,(t||[]).length),n=a.confirmed,s=a.pending,m=a.completed,l=a.cancelled,i=[{label:S("reservations.reports.status.confirmedLabel","مؤكدة","Confirmed"),value:n,percent:Math.round(n/r*100)||0,rawCount:n,className:"status-confirmed",filterKey:"confirmed"},{label:S("reservations.reports.status.pendingLabel","قيد التأكيد","Pending confirmation"),value:s,percent:Math.round(s/r*100)||0,rawCount:s,className:"status-pending",filterKey:"pending"},{label:S("reservations.reports.status.completedLabel","منتهية","Completed"),value:m,percent:Math.round(m/r*100)||0,rawCount:m,className:"status-completed",filterKey:"completed"},{label:S("reservations.reports.status.cancelledLabel","ملغاة","Cancelled"),value:l,percent:Math.round(l/r*100)||0,rawCount:l,className:"status-cancelled",filterKey:"cancelled"}];return R(N.status,e,i)}function Tt(t){const e=`payment:${F(t)}`,o=P(N.payment,e);if(o)return o;const a=t.length||1;let r=0,n=0,s=0;(t||[]).forEach(l=>{const{paidStatus:i}=D(l);i==="paid"?r+=1:i==="partial"?n+=1:s+=1});const m=[{label:S("reservations.reports.payment.paidLabel","مدفوعة","Paid"),value:r,percent:Math.round(r/a*100)||0,rawCount:r,className:"status-paid",filterKey:"paid"},{label:S("reservations.reports.payment.partialLabel","مدفوعة جزئياً","Partially paid"),value:n,percent:Math.round(n/a*100)||0,rawCount:n,className:"status-partial",filterKey:"partial"},{label:S("reservations.reports.payment.unpaidLabel","غير مدفوعة","Unpaid"),value:s,percent:Math.round(s/a*100)||0,rawCount:s,className:"status-unpaid",filterKey:"unpaid"}];return R(N.payment,e,m)}function At(t,e){const o=`topCustomers:${F(t)}`,a=P(N.topCustomers,o);if(a)return a;const r=new Map,n=new Map((e||[]).map(m=>[String(m.id),m]));t.forEach(m=>{const{statusValue:l}=D(m);if(l==="cancelled")return;const i=String(m?.customerId??"unknown"),d=r.get(i)||{count:0,revenue:0},c=C(m);d.count+=1,d.revenue+=c.finalTotal,r.set(i,d)});const s=Array.from(r.entries()).map(([m,l])=>({name:n.get(m)?.customerName||S("reservations.reports.topCustomers.unknown","عميل غير معروف","Unknown customer"),count:l.count,revenue:l.revenue})).sort((m,l)=>l.revenue-m.revenue).slice(0,5);return R(N.topCustomers,o,s)}function Ct(t,e){const o=`topEquipment:${F(t)}`,a=P(N.topEquipment,o);if(a)return a;const r=new Map,n=new Map((e||[]).map(l=>[_(l?.barcode),l])),s=S("reservations.reports.topEquipment.unknown","معدة بدون اسم","Unnamed equipment");t.forEach(l=>{(l?.items||[]).forEach(i=>{const d=_(i?.barcode),c=d?n.get(d):null,u=i?.desc||i?.description||i?.name||c?.desc||c?.description||c?.name||"",p=u&&u.trim()?u:s,f=W(p)||"unknown",g=Number(i?.qty)||1,h=Number(i?.price)||0,b=g*h,w=r.get(f)||{name:p,count:0,revenue:0};w.name=p,w.count+=g,w.revenue+=b,r.set(f,w)})});const m=Array.from(r.values()).sort((l,i)=>i.count!==l.count?i.count-l.count:i.revenue-l.revenue).slice(0,5);return R(N.topEquipment,o,m)}function Ft(){Object.values(N).forEach(t=>t.clear())}function at(t,e,o,a,r){const n=[],s=t?.reservationId||t?.id;s&&n.push(s),t?.notes&&n.push(t.notes);const{statusValue:m,paidStatus:l}=D(t);m&&n.push(m);const i=t?.paymentStatus||t?.payment_status;i&&n.push(i),t?.paid!=null&&n.push(t.paid?"paid":"unpaid"),l&&n.push(l);const d=o.get(String(t?.customerId));d&&n.push(d.customerName,d.company_name||d.companyName,d.contact_person||"");const c=O(t);return c&&n.push(c.title,c.code,c.status),n.push(rt(l)),(t?.items||[]).forEach(p=>{p?.desc&&n.push(p.desc),p?.barcode&&n.push(p.barcode);const f=a.get(_(p?.barcode));f&&n.push(f.desc,f.description,f.name)}),(t?.technicians||[]).forEach(p=>{const f=r.get(String(p));f&&n.push(f.name,f.role,f.department)}),H(n.filter(Boolean).join(" ")).includes(e)}function Pt(t,e,o,a,r){const{startDate:n,endDate:s}=U(e),m=H(e.search),l=!!m,i=new Map((o||[]).map(u=>[String(u.id),u])),d=new Map((a||[]).map(u=>[_(u?.barcode),u])),c=new Map((r||[]).map(u=>[String(u.id),u]));return(t||[]).filter(u=>{if(u&&u.projectId!=null&&String(u.projectId).trim()!=="")return!1;const p=u?.start?new Date(u.start):null;if(!p||Number.isNaN(p.getTime()))return!1;let f=u?.end?new Date(u.end):p;if(Number.isNaN(f.getTime())&&(f=p),n&&f<n||s&&p>s)return!1;const{statusValue:g,confirmed:h,paid:b,paidStatus:w}=D(u);if(e.status==="confirmed"&&!(g==="confirmed"||g==="completed"||h)||e.status==="pending"&&g!=="pending"||e.status==="completed"&&g!=="completed"||e.status==="cancelled"&&g!=="cancelled"||e.payment==="paid"&&!b||e.payment==="unpaid"&&b||e.payment==="partial"&&w!=="partial")return!1;if(e.share&&e.share!=="all"){const M=C(u).companySharePercent>0;if(e.share==="with"&&!M||e.share==="without"&&M)return!1}return!(l&&!at(u,m,i,d,c))})}function rt(t){const e=String(t??"").toLowerCase();return e==="paid"?S("reservations.reports.payment.paidLabel","مدفوعة","Paid"):e==="partial"?S("reservations.reports.payment.partialLabel","مدفوعة جزئياً","Partially paid"):S("reservations.reports.payment.unpaidLabel","غير مدفوعة","Unpaid")}function Rt(t,e){const o=new Map((e||[]).map(n=>[String(n.id),n])),a=new Map;return(t||[]).forEach(n=>{const{statusValue:s}=D(n);if(s==="cancelled")return;const m=K(n.start,n.end),l=Array.isArray(n.crewAssignments)?n.crewAssignments:[];if(l.length){l.forEach(d=>{const c=d?.technicianId!=null?String(d.technicianId):null;if(!c)return;const u=o.get(c)||j(c)||{},p=Number.isFinite(Number(d?.positionClientPrice))&&Number(d.positionClientPrice)>0?Number(d.positionClientPrice):q(u),f=Number.isFinite(Number(d?.positionCost))&&Number(d.positionCost)>0?Number(d.positionCost):k(u),g=p*m,h=f*m,b=a.get(c)||{id:c,name:u?.name||String(c),days:0,billable:0,cost:0};b.days+=m,b.billable+=g,b.cost+=h,a.set(c,b)});return}(Array.isArray(n.technicians)?n.technicians.map(d=>String(d)):[]).forEach(d=>{const c=o.get(d)||j(d)||{},u=q(c),p=k(c),f=u*m,g=p*m,h=a.get(d)||{id:d,name:c?.name||String(d),days:0,billable:0,cost:0};h.days+=m,h.billable+=f,h.cost+=g,a.set(d,h)})}),Array.from(a.values()).map(n=>({...n,net:n.billable-n.cost})).sort((n,s)=>s.net-n.net)}function ot(t=[]){if(!Array.isArray(t)||!t.length)return 0;let e=0;return t.forEach(o=>{const a=Number(o?.amount);Number.isFinite(a)&&a>0&&(e+=a)}),e}function st(t){const e=C(t),o=Number(e.finalTotal||0);let a=Number(t?.paidAmount);if(!Number.isFinite(a)||a<=0){const n=ot(t?.paymentHistory||t?.payment_history||[]);Number.isFinite(n)&&n>0&&(a=n)}if((!Number.isFinite(a)||a<=0)&&Number.isFinite(Number(t?.paidPercent))){const n=Number(t.paidPercent);n>0&&n<=100&&(a=n/100*o)}return Number.isFinite(a)||(a=0),Math.max(0,Math.round((o-a)*100)/100)}function _t(t,e,o=5){const a=new Map((e||[]).map(n=>[String(n.id),n])),r=[];return(t||[]).forEach(n=>{const{paidStatus:s,statusValue:m}=D(n);if(m==="cancelled"||s!=="unpaid"&&s!=="partial")return;const l=st(n);if(!Number.isFinite(l)||l<=0)return;const i=a.get(String(n.customerId));r.push({id:n.id||n.reservationId||"",code:n.reservationCode||n.reservationId||n.id||"",customer:i?.customerName||n.customerName||"",outstanding:l,paidStatus:s})}),r.sort((n,s)=>s.outstanding-n.outstanding).slice(0,o)}export{pt as A,ft as B,gt as C,C as a,yt as b,D as c,ht as d,Y as e,bt as f,Ft as g,U as h,Pt as i,wt as j,St as k,Nt as l,Dt as m,Mt as n,Tt as o,rt as p,At as q,y as r,Ct as s,S as t,Rt as u,_t as v,ut as w,it as x,mt as y,dt as z};
