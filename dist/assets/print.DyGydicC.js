import{e as f}from"./calculations.49tK_B3V.js";import{p as u,e as h,a as g}from"./projects.CBIUyS7m.js";import"./reservationsService.BGgi72ed.js";import"./auth.Dym-pMl4.js";import"./state.D0_ft4YH.js";import"./dashboard.DgtQZpbL.js";import"./form.BoSw5-Ka.js";import"./projectsService.CtAJ7Bct.js";import"./constants.Cby_zQyZ.js";import"./customers.BzFjEKEv.js";import"./controller.DzvKBGXH.js";import"./details.BmsEvKGd.js";import"./equipment.CAaKsH40.js";import"./quotePdf.C2lQPEPC.js";import"./canvasColorUtils.CviLtv6S.js";import"./reservationsActions.DuW1PrtF.js";import"./uiBridge.BLZZT8b9.js";import"./dashboardShell.DF2kUed9.js";function y(){try{return String(localStorage.getItem("templatesPdf.mode")||"").trim()==="html2pdf"?"html2pdf":"iframe"}catch{return"iframe"}}async function $(o){if(!o)throw new Error("No host");let c=null;try{c=await f()}catch{c=null}const m=document.createElement("div");Object.assign(m.style,{position:"fixed",top:"0",left:"-12000px",pointerEvents:"none",zIndex:"-1",backgroundColor:"#ffffff"});const t=document.createElement("div");t.id="templates-a4-root",t.setAttribute("data-render-context","export"),t.setAttribute("dir",o.getAttribute("dir")||document.documentElement.getAttribute("dir")||"rtl");const l=document.createElement("div");l.setAttribute("data-a4-pages","");const e=o.querySelector("[data-a4-pages]")?.cloneNode(!0)||o.cloneNode(!0);e.classList&&e.hasAttribute("data-a4-pages")?t.appendChild(e):(l.appendChild(e),t.appendChild(l)),m.appendChild(t),document.body.appendChild(m);try{try{const a=Array.from(t.querySelectorAll(".cs-logo img")).map(i=>i.getAttribute("src")).filter(Boolean);await u(a)}catch{}if(await h(),Array.from(t.querySelectorAll(".a4-page")).forEach(a=>{g(a)||a.parentElement?.removeChild(a)}),y()==="html2pdf"&&typeof c=="function"){await c().set({margin:0,html2canvas:{scale:1.5,useCORS:!0,allowTaint:!1,backgroundColor:"#ffffff"},jsPDF:{unit:"mm",format:"a4",orientation:"landscape"},pagebreak:{mode:["css","legacy"]},image:{type:"jpeg",quality:.98}}).from(t).save("template-callsheet.pdf");return}const d=`<!doctype html><html dir="${t.getAttribute("dir")||"rtl"}"><head><meta charset="utf-8"><title>Call Sheet</title><style>@page{size:A4 landscape;margin:0}html,body{margin:0;padding:0;background:#fff}#templates-a4-root{transform:none!important}</style></head><body>${t.innerHTML}</body></html>`,n=document.createElement("iframe");Object.assign(n.style,{position:"fixed",right:"0",bottom:"0",width:"1px",height:"1px",border:"0"}),document.body.appendChild(n);const r=n.contentWindow?.document;r&&(r.open(),r.write(d),r.close(),n.onload=()=>{try{n.contentWindow?.focus(),n.contentWindow?.print()}catch{}setTimeout(()=>n.remove(),1200)})}finally{try{m.remove()}catch{}}}async function z(o,{orientation:c="portrait",filename:m="template.pdf"}={}){if(!o)throw new Error("No host");let t=null;try{t=await f()}catch{t=null}const l=document.createElement("div");Object.assign(l.style,{position:"fixed",top:"0",left:"-12000px",pointerEvents:"none",zIndex:"-1",backgroundColor:"#ffffff"});const e=document.createElement("div");e.id="templates-a4-root",e.setAttribute("data-render-context","export"),e.setAttribute("dir",o.getAttribute("dir")||document.documentElement.getAttribute("dir")||"rtl");const p=o.querySelector("[data-a4-pages]")?.cloneNode(!0)||o.cloneNode(!0);if(p.classList&&p.hasAttribute("data-a4-pages"))e.appendChild(p);else{const d=document.createElement("div");d.setAttribute("data-a4-pages",""),Array.from(o.children).forEach(n=>d.appendChild(n.cloneNode(!0))),e.appendChild(d)}l.appendChild(e),document.body.appendChild(l);try{try{const i=Array.from(e.querySelectorAll("img")).map(s=>s.getAttribute("src")).filter(Boolean);await u(i)}catch{}if(await h(),Array.from(e.querySelectorAll(".a4-page")).forEach(i=>{if(!g(i))try{i.parentElement?.removeChild(i)}catch{}}),y()==="html2pdf"&&typeof t=="function"){await t().set({margin:0,html2canvas:{scale:1.5,useCORS:!0,allowTaint:!1,backgroundColor:"#ffffff"},jsPDF:{unit:"mm",format:"a4",orientation:c==="landscape"?"landscape":"portrait"},pagebreak:{mode:["css","legacy"]},image:{type:"jpeg",quality:.98}}).from(e).save(m);return}const n=`<!doctype html><html dir="${e.getAttribute("dir")||"rtl"}"><head><meta charset="utf-8"><title>Print</title><style>@page{size:A4 ${c};margin:0}html,body{margin:0;padding:0;background:#fff}#templates-a4-root{transform:none!important}</style></head><body>${e.innerHTML}</body></html>`,r=document.createElement("iframe");Object.assign(r.style,{position:"fixed",right:"0",bottom:"0",width:"1px",height:"1px",border:"0"}),document.body.appendChild(r);const a=r.contentWindow?.document;a&&(a.open(),a.write(n),a.close(),r.onload=()=>{try{r.contentWindow?.focus(),r.contentWindow?.print()}catch{}setTimeout(()=>r.remove(),1200)})}finally{try{l.remove()}catch{}}}export{$ as printCallsheetFromHost,z as printGenericTemplate};
