const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./reports.DMPzpsGJ.js","./preload-helper.PPVm8Dsz.js","./calculations.CeKETfrq.js","./reservationsService.ypr2Cr4i.js","./auth.nraNoQb5.js","./auth.DWGNFSY-.css","./state.QEOaSBGz.js","./maintenanceService.CDxi_Thf.js","./canvasColorUtils.CviLtv6S.js","./reservationsUI.D9gL7nZn.js","./controller.TPGmKbSD.js","./details.Deneewnn.js","./equipment.Bc_ULOIF.js","./constants.elS93Cob.js","./quotePdf.C2lQPEPC.js","./reservationsActions.Boo7POEh.js","./projectsService.D_ZSNbGY.js","./uiBridge.Dv6JMAlF.js","./calendar.LtikMbFG.js","./maintenance.B3CwLSQn.js","./dashboardMetrics.CHXoZ3YW.js"])))=>i.map(i=>d[i]);
import{u as j,e as K,f as Ae,s as ke,d as G,b as W,h as we,t as f,n as S,j as k,a as Be,c as Le,i as Pe,l as Re}from"./auth.nraNoQb5.js";import{i as Fe}from"./dashboardShell.Br-4FT3a.js";import{_ as T}from"./preload-helper.PPVm8Dsz.js";import{r as Ce}from"./customers.Cf1Xu-I3.js";import{r as pe,E as ce,a as xe,c as De,i as Ne,u as Me}from"./equipment.Bc_ULOIF.js";import{a as je,n as fe,b as $e}from"./state.QEOaSBGz.js";import{g as Oe,w as Ve}from"./uiBridge.Dv6JMAlF.js";const Ue={},te="__ART_RATIO_LAST_DASHBOARD_TAB__",w="__ART_RATIO_LAST_DASHBOARD_SUB_TAB__",Y="create-tab",ge=/^[a-z0-9\-]+$/i,ze=typeof import.meta<"u"&&Ue&&!1;function h(...e){ze&&console.log(...e)}function ne(e){if(!(!e||typeof e.scrollIntoView!="function"))try{const t=e.closest("[data-tab-scroll-track]");if(!t)return;const n={behavior:"smooth",block:"nearest",inline:"center"};e.scrollIntoView(n);const o=t.closest("[data-tab-scroll]");o&&window.requestAnimationFrame(()=>{o.dispatchEvent(new CustomEvent("tabScroll:update",{bubbles:!0}))})}catch(t){console.warn("âš ï¸ [tabs.js] Failed to keep tab visible",t)}}function F(e){try{if(typeof window>"u"||!window.localStorage)return null;const t=window.localStorage.getItem(e);return!t||!ge.test(t)?null:t}catch(t){return console.warn("âš ï¸ [tabs.js] Failed to read stored tab",t),null}}function ae(e,t){try{if(typeof window>"u"||!window.localStorage)return;if(!t||!ge.test(t)){window.localStorage.removeItem(e);return}window.localStorage.setItem(e,t)}catch(n){console.warn("âš ï¸ [tabs.js] Failed to persist tab",n)}}function he(e){try{if(typeof window>"u"||!window.localStorage)return;window.localStorage.removeItem(e)}catch(t){console.warn("âš ï¸ [tabs.js] Failed to clear stored tab",t)}}let R=null,_=null,C=!1,I=null,ue=null,x=null,ie=null,D=null,V=null,J=null,X=null,Z=null,de=!1;function He(){return V||(V=T(()=>import("./reports.DMPzpsGJ.js").then(e=>e.r),__vite__mapDeps([0,1,2,3,4,5,6,7,8]),import.meta.url).then(e=>{try{typeof e.initReports=="function"&&e.initReports()}catch(t){console.error("âŒ [tabs.js] Failed to initialise reports module",t)}return e}).catch(e=>{throw console.error("âŒ [tabs.js] Failed to load reports module",e),V=null,e})),V}function ye(){return J||(J=T(()=>import("./reservationsUI.D9gL7nZn.js"),__vite__mapDeps([9,10,4,5,11,6,3,12,13,14,8,15,16,17]),import.meta.url)),J}function Ke(){return X||(X=T(()=>import("./calendar.LtikMbFG.js"),__vite__mapDeps([18,6,4,5,15,12,3,11]),import.meta.url)),X}function We(){return Z||(Z=T(()=>import("./maintenance.B3CwLSQn.js"),__vite__mapDeps([19,4,5,12,6,7]),import.meta.url)),Z}function Ye(){h("ğŸš€ [tabs.js] setupTabs()");const e=Array.from(document.querySelectorAll("[data-tab]")),t=document.querySelectorAll(".tab-content-wrapper > .tab");h("ğŸ“Œ tabButtons:",e),h("ğŸ“Œ tabContents:",t);const n=(a,{skipStore:r=!1,skipRender:d=!1}={})=>{if(!a)return;const m=e.filter(s=>s?.getAttribute("data-tab")===a),p=document.getElementById(a);if(!(!m.length||!p)&&(e.forEach(s=>{const l=s?.getAttribute("data-tab")===a;s.classList.toggle("active",l),l?(s.setAttribute("aria-selected","true"),s.setAttribute("tabindex","0"),ne(s)):(s.setAttribute("aria-selected","false"),s.setAttribute("tabindex","-1"))}),t.forEach(s=>{const l=s.id===a;s.style.display=l?"block":"none",s.classList.toggle("active",l)}),R=a,ae(te,a),typeof document<"u"&&document.dispatchEvent(new CustomEvent("dashboard:tabChanged",{detail:{tabId:a}})),r||j({dashboardTab:a}).catch(s=>{console.warn("âš ï¸ [tabs.js] Failed to store dashboard tab preference",s)}),a!=="reservations-tab"&&(_=null,I=null,he(w),r||j({dashboardSubTab:null}).catch(s=>{console.warn("âš ï¸ [tabs.js] Failed to clear sub-tab preference",s)})),!d&&a==="customers-tab"&&(h("ğŸ‘¤ Rendering customers"),Ce()),!d&&a==="equipment-tab"&&(h("ğŸ“¦ Rendering equipment"),pe()),!d&&a==="maintenance-tab"&&(h("ğŸ› ï¸ Rendering maintenance"),We().then(s=>{try{s.renderMaintenance?.()}catch(l){console.error("âŒ [tabs.js] Failed to render maintenance",l)}}).catch(s=>console.error("âŒ [tabs.js] Unable to load maintenance module",s))),!d&&a==="technicians-tab"&&(h("ğŸ› ï¸ Rendering technicians"),je()),a==="reservations-tab")){if(h("ğŸ“… Rendering reservations"),d||ye().then(async s=>{try{if(!de&&typeof s.initializeReservationUI=="function")await s.initializeReservationUI(),de=!0;else{try{s.setupReservationEvents?.()}catch{}try{s.renderReservations?.()}catch{}}}catch(l){console.error("âŒ [tabs.js] Failed to initialise reservations UI",l)}}).catch(s=>console.error("âŒ [tabs.js] Unable to load reservations UI module",s)),!I){const s=F(w);I=_||s||Y}Ge(),I&&(U(I),I=null)}};ie=n;const o=a=>{if(!a||a.dataset.tabKeyboardBound==="true")return;const r=a.getAttribute("aria-orientation")==="vertical";a.addEventListener("keydown",d=>{const m=d.key,p=Array.from(a.querySelectorAll('[role="tab"], .tab-button, .sub-tab-button')).filter(L=>L.matches("[data-tab], [data-sub-tab]"));if(!p.length)return;const s=d.target,l=Math.max(0,p.indexOf(s));let b=l;const g=()=>{b=(l-1+p.length)%p.length},q=()=>{b=(l+1)%p.length},M=()=>{b=0},Q=()=>{b=p.length-1};let A=!1;switch(m){case"ArrowLeft":r||(g(),A=!0);break;case"ArrowRight":r||(q(),A=!0);break;case"ArrowUp":r&&(g(),A=!0);break;case"ArrowDown":r&&(q(),A=!0);break;case"Home":M(),A=!0;break;case"End":Q(),A=!0;break;case"Enter":case" ":A=!0,s?.click();break}if(A){d.preventDefault();const L=p[b];L&&L!==s&&(L.focus(),L.click())}}),a.dataset.tabKeyboardBound="true"};document.querySelectorAll('[role="tablist"]').forEach(o),e.forEach(a=>{a&&(a.getAttribute("type")||a.setAttribute("type","button"),a.setAttribute("role","tab"),a.hasAttribute("tabindex")||a.setAttribute("tabindex",a.classList.contains("active")?"0":"-1"),a.addEventListener("click",()=>{const r=a.getAttribute("data-tab");if(h("ğŸ–±ï¸ Tab clicked:",r),n(r),r==="reservations-tab"){const d=_||F(w)||Y;typeof x=="function"?x(d):I=d}else j({dashboardSubTab:null}).catch(d=>{console.warn("âš ï¸ [tabs.js] Failed to clear sub-tab preference",d)})}))});const c=a=>{const r=document.querySelector("[data-tab].active"),d=F(te),m=e[0]?.getAttribute("data-tab")||null,s=[a?.dashboardTab,d,R,r?.getAttribute("data-tab"),m].filter(Boolean).find(g=>document.getElementById(g))||m;s&&(!C||s!==R)&&(h("â­ Initial tab:",s),n(s,{skipStore:!0}));const b=[a?.dashboardSubTab,F(w)].filter(Boolean).find(g=>document.getElementById(g));b&&(R==="reservations-tab"&&typeof x=="function"?(!C||b!==_)&&x(b,{skipStore:!0}):I=b),C||(document.body?.classList.remove("tabs-loading"),document.body?.classList.remove("no-js"),C=!0)},u=typeof K=="function"?K():null;c(u||null),Ae().then(a=>c(a||null)).catch(a=>{console.warn("âš ï¸ [tabs.js] Failed to load tab preferences",a),c(null)}),ue||(ue=ke(a=>{if(!(!C||!a))if(a.dashboardTab&&a.dashboardTab!==R&&n(a.dashboardTab,{skipStore:!0}),R==="reservations-tab"){if(a.dashboardSubTab&&a.dashboardSubTab!==_)U(a.dashboardSubTab);else if(!a.dashboardSubTab&&_){const r=F(w);r?r!==_&&U(r):U(null)}}else a.dashboardSubTab&&(I=a.dashboardSubTab)}))}function Ge(){h("ğŸš€ [tabs.js] setupSubTabs()");const e=document.querySelectorAll("#reservations-tab .sub-tab-button"),t=document.querySelectorAll("#reservations-tab .sub-tab");if(h("ğŸ“Œ subTabButtons:",e),h("ğŸ“Œ subTabContents:",t),!e.length){console.warn("âš ï¸ [tabs.js] No reservation sub-tab buttons found");return}const n=Array.from(e).map(u=>u?.getAttribute("data-sub-tab")).filter(u=>typeof u=="string"&&u.trim().length>0),o=()=>n.length?n.includes(Y)?Y:n[0]:null,c=(u,{skipStore:a=!1}={})=>{if(!n.length)return;let r=u;(!r||!n.includes(r))&&(console.warn("âš ï¸ [tabs.js] Invalid sub-tab target, falling back to first available",{requested:r,available:n}),r=o());const d=document.querySelector(`#reservations-tab .sub-tab-button[data-sub-tab="${r}"]`),m=document.getElementById(r);if(!d||!m){console.warn("âš ï¸ [tabs.js] Unable to locate sub-tab button/content after fallback",{target:r});return}if(_===r&&d.classList.contains("active")&&m.classList.contains("active")&&m.getAttribute("aria-hidden")==="false"){m.removeAttribute("hidden"),m.style.display="block",m.setAttribute("aria-hidden","false"),_=r,ne(d),a||(ae(w,r),j({dashboardSubTab:r}).catch(s=>{console.warn("âš ï¸ [tabs.js] Failed to store sub-tab preference",s)}));return}e.forEach(s=>{s.classList.remove("active"),s.classList.contains("tab")&&s.classList.remove("tab-active"),s.setAttribute("aria-selected","false"),s.setAttribute("tabindex","-1")}),d.classList.add("active"),d.classList.contains("tab")&&d.classList.add("tab-active"),d.setAttribute("aria-selected","true"),d.setAttribute("tabindex","0"),ne(d),t.forEach(s=>{const l=s.id===r;s.classList.toggle("active",l),s.setAttribute("aria-hidden",l?"false":"true"),l?(s.removeAttribute("hidden"),s.style.display="block"):(s.setAttribute("hidden",""),s.style.display="none")}),_=r,ae(w,r),a||j({dashboardSubTab:r}).catch(s=>{console.warn("âš ï¸ [tabs.js] Failed to store sub-tab preference",s)}),typeof document<"u"&&document.dispatchEvent(new CustomEvent("reservations:subTabChanged",{detail:{subTabId:r}})),r==="my-reservations-tab"?(h("ğŸ“‹ Rendering reservations list"),setTimeout(()=>{ye().then(s=>{try{s.renderReservations?.()}catch(l){console.error("âŒ [tabs.js] Failed to render reservations list",l)}}).catch(s=>console.error("âŒ [tabs.js] Unable to load reservations UI module",s))},50)):r==="calendar-tab"?(h("ğŸ“… Rendering calendar view"),setTimeout(()=>{Ke().then(s=>{try{s.renderCalendar?.()}catch(l){console.error("âŒ [tabs.js] Failed to render calendar",l)}}).catch(s=>console.error("âŒ [tabs.js] Unable to load calendar module",s))},100)):r==="reports-tab"&&(h("ğŸ“Š Rendering reports view"),He().then(s=>{const{renderReports:l}=s;setTimeout(()=>{try{l?.()}catch(b){console.error("âŒ [tabs.js] Failed to render reports tab",b)}},50)}).catch(s=>{console.error("âŒ [tabs.js] Unable to load reports tab",s)}))};if(x=(u,a={})=>{u?c(u,a):(e.forEach(r=>{r.classList.remove("active"),r.classList.contains("tab")&&r.classList.remove("tab-active"),r.setAttribute("aria-selected","false"),r.setAttribute("tabindex","-1")}),t.forEach(r=>{r.classList.remove("active"),r.setAttribute("aria-hidden","true"),r.setAttribute("hidden",""),r.style.display="none"}),_=null,he(w))},e.forEach(u=>{u.dataset.subTabListenerAttached||(u.addEventListener("click",()=>{const a=u.getAttribute("data-sub-tab");h("ğŸ–±ï¸ Sub-tab clicked:",a),c(a)}),u.dataset.subTabListenerAttached="true")}),I)c(I,{skipStore:!0}),I=null;else{const u=document.querySelector("#reservations-tab .sub-tab-button.active"),a=o(),r=u?.getAttribute("data-sub-tab")||a;r&&(h("â­ Initial sub-tab:",r),c(r,{skipStore:!0}))}}function U(e){typeof x=="function"?x(e,{skipStore:!0}):e&&(I=e)}function Qe(){try{if(typeof K=="function")return K()||{}}catch(e){console.warn("âš ï¸ [tabs.js] Failed to read cached preferences",e)}return{}}function Je({attemptsLeft:e=0}={}){if(!C||typeof ie!="function")return!1;const t=Qe(),n=Array.from(document.querySelectorAll("[data-tab]"));if(!n.length)return!1;const o=n[0]?.dataset.tab||null,u=[R,document.querySelector("[data-tab].active")?.getAttribute("data-tab")||null,t.dashboardTab,F(te),o].filter(Boolean).find(r=>document.getElementById(r));if(!u)return!1;const a=()=>{const r=document.querySelector(`[data-tab].active[data-tab="${u}"]`),d=document.getElementById(u);return!!(r&&d?.classList.contains("active")&&d?.style.display!=="none")};if(u==="reservations-tab"){const r=Array.from(document.querySelectorAll("#reservations-tab .sub-tab-button"));if(!r.length)return!1;const d=r[0]?.getAttribute("data-sub-tab")||null,p=[_,document.querySelector("#reservations-tab .sub-tab-button.active")?.getAttribute("data-sub-tab")||null,document.querySelector("#reservations-tab .sub-tab.active")?.id||null,t.dashboardSubTab,F(w),d].filter(Boolean).find(g=>document.getElementById(g)),s=document.querySelector("#reservations-tab .sub-tab-button.active"),l=document.querySelector("#reservations-tab .sub-tab.active"),b=l?.id||s?.getAttribute("data-sub-tab")||null;if(p&&b===p&&a())return l&&(l.removeAttribute("hidden"),l.style.display="block",l.setAttribute("aria-hidden","false")),!0;if(p)I=p;else if(e>0)return!1}else if(a())return!0;return ie(u,{skipStore:!0,skipRender:!0}),!0}function oe(){if(!C)return;let e=0;const t=5;D&&(clearTimeout(D),D=null);const n=()=>{if(Je({attemptsLeft:t-e})){D=null;return}if(e>=t){D=null;return}e+=1,D=setTimeout(n,50*(e+1))};n()}document.addEventListener("language:translationsReady",oe);document.addEventListener("language:changed",oe);document.addEventListener("theme:changed",oe);let v=[],E=[],$=null,P=!1,le=!1;const i={};function Xe(){i.form=document.getElementById("equipment-package-form"),i.hiddenId=document.getElementById("equipment-package-id"),i.nameInput=document.getElementById("equipment-package-name"),i.codeInput=document.getElementById("equipment-package-code"),i.priceInput=document.getElementById("equipment-package-price"),i.descriptionInput=document.getElementById("equipment-package-description"),i.openSelector=document.getElementById("equipment-package-open-selector"),i.selectionWrapper=document.getElementById("equipment-package-selection-active"),i.selectionCounter=document.getElementById("equipment-package-selection-counter"),i.applySelection=document.getElementById("equipment-package-apply-selection"),i.cancelSelection=document.getElementById("equipment-package-cancel-selection"),i.itemsTableBody=document.querySelector("#equipment-package-items-table tbody"),i.itemsEmptyMessage=document.getElementById("equipment-package-items-empty"),i.resetButton=document.getElementById("equipment-package-reset"),i.submitButton=document.getElementById("equipment-package-submit"),i.tableBody=document.getElementById("equipment-packages-table-body"),i.emptyRow=document.getElementById("equipment-packages-empty-row"),i.countBadge=document.getElementById("equipment-packages-count"),i.applySelection&&(i.applySelection.style.display="none")}function ve(){const{equipment:e=[]}=G()||{};return Array.isArray(e)?e:[]}function se(){const e=new Map;return ve().forEach(t=>{const n=t?.id??t?.equipment_id??t?.equipmentId??null;n!=null&&e.set(String(n),t)}),e}function Ze(){const e=new Map;return ve().forEach(t=>{const n=fe(t?.barcode);n&&!e.has(n)&&e.set(n,t)}),e}function N(e,{persist:t=!1}={}){v=Array.isArray(e)?e.map(Ie):[],ot(),t&&(we({packages:v}),document.dispatchEvent(new CustomEvent("packages:changed",{detail:{packages:v}})))}function Ie(e={}){const t=et(e.items??e.equipment_ids??e.equipmentIds??[]);return{id:e.id!=null?String(e.id):"",package_code:e.package_code??e.code??e.slug??"",slug:e.slug??null,name:e.name??e.title??e.label??"",description:e.description??"",price:tt(e.price??e.total_price??e.package_price??0),is_active:nt(e.is_active??e.active??!0),items:t,created_at:e.created_at??null,updated_at:e.updated_at??null}}function et(e){return Array.isArray(e)||(e=[]),e.map(t=>{if(t==null)return null;if(typeof t=="number"||typeof t=="string"){const n=String(t).trim();return n?{equipment_id:n,quantity:1,unit_price:null}:null}if(typeof t=="object"){const n=t.equipment_id??t.equipmentId??t.id??t.item_id??t.itemId??null;if(n==null)return null;const o=Number.isFinite(Number(t.quantity??t.qty))?Number(t.quantity??t.qty):1,c=Number.isFinite(Number(t.unit_price??t.price))?Number(t.unit_price??t.price):null;return{equipment_id:String(n),quantity:o>0?o:1,unit_price:c}}return null}).filter(Boolean)}function tt(e){const t=Number.parseFloat(e);return Number.isFinite(t)?Math.round(t*100)/100:0}function nt(e){if(e===!0||e===!1)return e;if(e==null)return!0;const t=String(e).trim().toLowerCase();return!(t==="0"||t==="false"||t==="no")}function at(e){const t=e?.quantity??e?.qty??1,n=Number.parseFloat(S(String(t)));return!Number.isFinite(n)||n<=0?1:n}function it(e,t){const n=[e?.unit_price,e?.price];for(const c of n){if(c==null)continue;const u=Number.parseFloat(S(String(c)));if(Number.isFinite(u))return u}const o=e?.equipment_id??e?.equipmentId??e?.id;if(o!=null&&t instanceof Map){const c=t.get(String(o));if(c&&typeof c=="object"){const u=[c.unit_price,c.unitPrice,c.price,c.daily_rate,c.dailyRate];for(const a of u){if(a==null)continue;const r=Number.parseFloat(S(String(a)));if(Number.isFinite(r))return r}}}return 0}function rt(e=null){const t=e instanceof Map?e:se();return E.reduce((n,o)=>{const c=at(o),u=it(o,t),a=Number.isFinite(c)&&c>0?c:1,r=Number.isFinite(u)&&u>0?u:0;return n+a*r},0)}function be(e){const t=i.priceInput;if(!t)return;const n=t.dataset.autoCalculated==="false",o=!!(t.value&&t.value.trim());if(n&&o)return;if(!Number.isFinite(e)||E.length===0){t.value="",t.dataset.autoCalculated="true";return}const c=e<0?0:e,u=Math.round(c*100)/100,a=Number.isInteger(u)?String(u):u.toFixed(2);t.value=a,t.dataset.autoCalculated="true"}function O(){if(!i.itemsTableBody||!i.itemsEmptyMessage)return;if(E.length===0){i.itemsTableBody.innerHTML="",i.itemsEmptyMessage.hidden=!1,be(0);return}const e=se(),t=E.map((o,c)=>{const u=e.get(String(o.equipment_id)),a=u?.desc||u?.name||f("equipment.packages.items.unknown","Ù…Ø¹Ø¯Ø© Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…"),r=u?.barcode?S(String(u.barcode)):"",d=S(String(o.quantity??1)),m=r?`${a} â€” ${r}`:a;return`
      <tr data-package-item-index="${c}">
        <td>${m}</td>
        <td>${d}</td>
        <td>
          <button type="button" class="btn btn-outline-danger btn-sm" data-action="remove-item" data-index="${c}">ğŸ—‘ï¸</button>
        </td>
      </tr>
    `});i.itemsTableBody.innerHTML=t.join(""),i.itemsEmptyMessage.hidden=!0;const n=rt(e);be(n)}function ot(){if(!i.tableBody||!i.emptyRow)return;if(!v.length){i.tableBody.innerHTML="",i.tableBody.appendChild(i.emptyRow),i.emptyRow.hidden=!1,i.countBadge&&(i.countBadge.textContent="0");return}const e=se(),t=v.map(n=>{const o=$e({...n,items:n.items}),c=o.map(r=>{const d=e.get(String(r.equipmentId??r.equipment_id)),m=d?.desc||d?.name||r.desc||f("equipment.packages.items.unknown","Ù…Ø¹Ø¯Ø© Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…"),p=S(String(r.qty??r.quantity??1)),s=r.barcode||d?.barcode,l=s?` (${S(String(s))})`:"";return`<li>${m}${l} Ã— ${p}</li>`}),u=o.reduce((r,d)=>r+(Number(d.qty??d.quantity??1)||0),0),a=`${S(n.price.toFixed(2))} ${f("reservations.create.summary.currency","SR")}`;return`
      <tr data-package-id="${n.id}">
        <td>${n.name||"â€”"}</td>
        <td>${n.package_code||"â€”"}</td>
        <td>${a}</td>
        <td>
          <details>
            <summary>${S(String(u||0))}</summary>
            <ul class="equipment-package-items-summary">${c.join("")}</ul>
          </details>
        </td>
        <td>
          <div class="d-flex gap-2">
            <button type="button" class="btn btn-sm btn-outline-primary" data-action="edit-package" data-id="${n.id}">âœï¸</button>
            <button type="button" class="btn btn-sm btn-outline-danger" data-action="delete-package" data-id="${n.id}">ğŸ—‘ï¸</button>
          </div>
        </td>
      </tr>
    `});i.tableBody.innerHTML=t.join(""),i.emptyRow.hidden=!0,i.countBadge&&(i.countBadge.textContent=S(String(v.length)))}function Se(){$=null,E=[],i.hiddenId&&(i.hiddenId.value=""),i.nameInput&&(i.nameInput.value=""),i.codeInput&&(i.codeInput.value=""),i.priceInput&&(i.priceInput.value="",i.priceInput.dataset.autoCalculated="true"),i.descriptionInput&&(i.descriptionInput.value=""),i.submitButton&&(i.submitButton.textContent=f("equipment.packages.form.actions.save","ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø­Ø²Ù…Ø©")),O(),B(!1)}function st(e){$=e.id||null,E=e.items.map(t=>({...t})),i.hiddenId&&(i.hiddenId.value=$||""),i.nameInput&&(i.nameInput.value=e.name||""),i.codeInput&&(i.codeInput.value=e.package_code||""),i.priceInput&&(i.priceInput.value=e.price!=null?String(e.price):"",i.priceInput.dataset.autoCalculated=e.price!=null?"false":"true"),i.descriptionInput&&(i.descriptionInput.value=e.description||""),i.submitButton&&(i.submitButton.textContent=f("equipment.packages.form.actions.update","ğŸ’¾ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø²Ù…Ø©")),O(),B(!1)}function B(e=P){P=e,i.selectionWrapper&&(P?i.selectionWrapper.hidden=!1:i.selectionWrapper.hidden=!0),i.openSelector&&(i.openSelector.disabled=P),i.cancelSelection&&(i.cancelSelection.disabled=!P),Te()}function Te(){if(i.selectionCounter){if(!P){i.selectionCounter.textContent=f("equipment.packages.selection.counter","Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø¹Ù†Ø§ØµØ± Ø¨Ø¹Ø¯.");return}i.selectionCounter.textContent=f("equipment.packages.selection.autoMode","Ø£ÙŠ Ù…Ø¹Ø¯Ø© ØªØ®ØªØ§Ø±Ù‡Ø§ Ø³ØªÙØ¶Ø§Ù Ù…Ø¨Ø§Ø´Ø±Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø²Ù…Ø©. Ø§Ø³ØªØ®Ø¯Ù… Ø²Ø± Ø¥Ù„ØºØ§Ø¡ Ù„Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† ÙˆØ¶Ø¹ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±.")}}function ct(e){const t=e?.detail||{},n=!!t.active,o=t.selection||t.previous||{},c=o?.mode||o?.source||"";if(c!=="package-manager"&&c!=="equipment-packages"){!n&&P&&(B(!1),re());return}if(n){B(!0);return}B(!1),re()}function ut(e){const t=e?.detail;if(!t)return;const n=t.selection||{},o=n?.mode||n?.source||"";if(o!=="package-manager"&&o!=="equipment-packages")return;const c=Array.isArray(t.barcodes)?t.barcodes:[],u=Number.isInteger(t.quantity)&&t.quantity>0?t.quantity:1,a=c.length?c:t.barcode?[t.barcode]:[];if(!a.length)return;const r=Ze(),d=[],m=new Set;a.forEach(b=>{const g=fe(b);g&&!m.has(g)&&(m.add(g),d.push(g))});const p=Math.min(d.length,u);let s=0;const l=[];for(let b=0;b<p;b+=1){const g=d[b],q=r.get(g);if(!q)continue;const M=q?.id??q?.equipment_id??q?.equipmentId??null;if(M==null)continue;const Q=q?.desc||q?.name||g,A=E.find(L=>L.equipment_id===String(M));A?A.quantity+=1:E.push({equipment_id:String(M),quantity:1,unit_price:Number.isFinite(Number(q?.price))?Number(q.price):null}),s+=1,l.push(Q)}if(s>0){O(),Te();const b=s===1?f("equipment.packages.selection.itemAddedSingle","âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© {name} Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø²Ù…Ø©"):f("equipment.packages.selection.itemAddedMulti","âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© {count} Ù…Ø¹Ø¯Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø²Ù…Ø©"),g=s===1?b.replace("{name}",l[0]||""):b.replace("{count}",S(String(s)));k(g)}else k(f("equipment.packages.selection.noMatch","âš ï¸ ØªØ¹Ø°Ø± Ø±Ø¨Ø· Ø§Ù„Ù…Ø¹Ø¯Ø§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© Ø¨Ø§Ù„Ø­Ø²Ù…ØŒ ØªØ­Ù‚Ù‚ Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"),4e3)}function dt(){B(!1),De("package-cancel"),re()}function re(){i.form&&(i.form.scrollIntoView({behavior:"smooth",block:"start"}),setTimeout(()=>{i.nameInput?.focus()},200))}function ee(e){const t=i.priceInput;if(!t)return;const n=t.value;if(n==null)return;const o=n.replace(/[\u066B\u066C\u060CØŒ,]/gu,".");let u=S(o).replace(/[^0-9.]/gu,"");const a=u.indexOf(".");if(a!==-1){const r=u.slice(0,a+1),d=u.slice(a+1).replace(/\./g,"");u=`${r}${d}`}if(u!==n&&(t.value=u,typeof t.setSelectionRange=="function")){const r=u.length;try{t.setSelectionRange(r,r)}catch{}}e?.type==="input"&&(t.dataset.autoCalculated=u.trim()?"false":"true")}function lt(){const e=i.nameInput?.value.trim(),t=i.codeInput?.value.trim(),n=i.descriptionInput?.value.trim()??"",o=i.priceInput?.value??"",c=Number.parseFloat(S(o));if(!e)return k(f("equipment.packages.validation.nameRequired","âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø­Ø²Ù…Ø©")),null;if(!t)return k(f("equipment.packages.validation.codeRequired","âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø­Ø²Ù…Ø©")),null;if(!E.length)return k(f("equipment.packages.validation.itemsRequired","âš ï¸ Ø£Ø¶Ù Ø¹Ù†ØµØ±Ù‹Ø§ ÙˆØ§Ø­Ø¯Ù‹Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ø­Ø²Ù…Ø©")),null;const u=E.map(a=>({equipment_id:a.equipment_id,quantity:Number.isFinite(Number(a.quantity))?Number(a.quantity):1,unit_price:a.unit_price!=null&&Number.isFinite(Number(a.unit_price))?Number(a.unit_price):null}));return{package_code:t,name:e,description:n,price:Number.isFinite(c)?c:0,is_active:!0,items:u}}async function bt(e){if(e.preventDefault(),!i.form)return;const t=lt();if(t)try{let n;$?(n=await W(`/packages/?id=${encodeURIComponent($)}`,{method:"PATCH",body:t}),k(f("equipment.packages.toast.updated","âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø²Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­"))):(n=await W("/packages/",{method:"POST",body:t}),k(f("equipment.packages.toast.created","âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø²Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­")));const o=Ie(n?.data??n),c=v.findIndex(u=>u.id===o.id);c>=0?v.splice(c,1,o):v=[o,...v],N(v,{persist:!0}),Se()}catch(n){console.error("[equipmentPackagesManager] handlePackageSubmit error",n);const o=n?.message||f("equipment.packages.toast.saveFailed","âŒ ØªØ¹Ø°Ø± Ø­ÙØ¸ Ø§Ù„Ø­Ø²Ù…Ø©");k(o,4e3)}}function mt(e){const t=e.target.closest('[data-action="remove-item"]');if(!t)return;const n=Number(t.dataset.index);Number.isNaN(n)||(E=E.filter((o,c)=>c!==n),O())}async function pt(e){const t=e.target.closest('[data-action="edit-package"]');if(t){const o=t.dataset.id;if(!o)return;const c=v.find(u=>u.id===o);if(!c)return;st(c);return}const n=e.target.closest('[data-action="delete-package"]');if(n){const o=n.dataset.id;if(!o||!window.confirm(f("equipment.packages.confirm.delete","Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø­Ø²Ù…Ø©ØŸ")))return;try{await W(`/packages/?id=${encodeURIComponent(o)}`,{method:"DELETE"}),v=v.filter(u=>u.id!==o),N(v,{persist:!0}),k(f("equipment.packages.toast.deleted","ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ø­Ø²Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­"))}catch(u){console.error("[equipmentPackagesManager] delete package error",u),k(f("equipment.packages.toast.deleteFailed","âŒ ØªØ¹Ø°Ø± Ø­Ø°Ù Ø§Ù„Ø­Ø²Ù…Ø©"),4e3)}}}async function _e(){try{const e=await W("/packages/?all=1"),t=Array.isArray(e?.data)?e.data:Array.isArray(e)?e:[];N(t,{persist:!0})}catch(e){console.warn("[equipmentPackagesManager] Failed to fetch packages from API, falling back to cache",e);const{packages:t=[]}=G()||{};N(t,{persist:!1})}}function ft(){const{packages:e=[]}=G()||{};Array.isArray(e)&&e.length?N(e,{persist:!1}):N([],{persist:!1}),O(),B(!1)}function gt(){if(P){B(!0);return}B(!0),xe({mode:"package-manager",source:"equipment-packages",activatedAt:Date.now()});const e=document.querySelector('[data-tab="equipment-tab"]');e&&e.click(),window.requestAnimationFrame(()=>{setTimeout(()=>{document.getElementById("search-equipment")?.focus();const t=document.getElementById("equipment-list");t&&t.scrollIntoView({behavior:"smooth",block:"start"})},200)})}function ht(){i.form&&(i.form.addEventListener("submit",bt),i.itemsTableBody?.addEventListener("click",mt),i.resetButton?.addEventListener("click",()=>{Se()}),i.tableBody?.addEventListener("click",pt),i.openSelector?.addEventListener("click",e=>{e.preventDefault(),gt()}),i.cancelSelection?.addEventListener("click",e=>{e.preventDefault(),dt()}),i.priceInput&&!i.priceInput.dataset.normalizedAttached&&(i.priceInput.addEventListener("input",ee),i.priceInput.addEventListener("blur",ee),i.priceInput.dataset.normalizedAttached="true",ee()),le||(document.addEventListener(ce.change,ct),document.addEventListener(ce.requestAdd,ut),le=!0))}function Ee(){typeof document>"u"||(Xe(),i.form&&(ft(),ht(),_e()))}const yt=Object.freeze(Object.defineProperty({__proto__:null,initEquipmentPackages:Ee,refreshPackagesFromApi:_e},Symbol.toStringTag,{value:"Module"}));function vt(){try{const e=document.getElementById("equipment-back-to-top"),t=document.getElementById("equipment-tab");if(!e||!t)return;const n=240,o=()=>t.classList.contains("active")&&t.style.display!=="none",c=()=>{try{const a=o()&&(window.scrollY||window.pageYOffset||0)>n;e.style.display=a?"":"none"}catch{}},u=a=>{a.preventDefault();try{window.scrollTo({top:0,behavior:"smooth"})}catch{window.scrollTo(0,0)}};window.addEventListener("scroll",c,{passive:!0}),document.addEventListener("dashboard:tabChanged",c),e.addEventListener("click",u),setTimeout(c,0),setTimeout(c,250)}catch{}}function It(){const e=n=>{try{const o=n?.target;if(!o||!(o instanceof Element)||!o.classList?.contains("modal"))return;const c=document.activeElement;if(c&&o.contains(c)){try{c.blur()}catch{}try{document.body?.focus({preventScroll:!0})}catch{}}}catch{}};document.addEventListener("hide.bs.modal",e,!0),document.addEventListener("hidden.bs.modal",e,!0);const t=n=>{try{const c=(n.target instanceof Element?n.target:null)?.closest('[data-bs-dismiss="modal"], .btn-close');if(!c)return;try{c.blur()}catch{}try{document.body?.focus({preventScroll:!0})}catch{}}catch{}};document.addEventListener("click",t,!0)}Be();let y=null,z=null,H=null;function St(){return H||(H=T(()=>import("./dashboardMetrics.CHXoZ3YW.js"),__vite__mapDeps([20,4,5]),import.meta.url).then(e=>{try{typeof e.initDashboardMetrics=="function"&&e.initDashboardMetrics()}catch(t){console.error("âŒ Failed to initialise dashboard metrics",t)}return e}).catch(e=>{throw console.error("âŒ Failed to load dashboard metrics module",e),H=null,e})),H}function Tt(){const e=()=>{St()};typeof window<"u"&&typeof window.requestIdleCallback=="function"?window.requestIdleCallback(()=>{e()},{timeout:1500}):setTimeout(e,0)}function _t(){const e=async()=>{try{const t=[];t.push(T(()=>import("./projectsService.D_ZSNbGY.js"),__vite__mapDeps([16,4,5]),import.meta.url).then(n=>n.refreshProjectsFromApi().catch(()=>{})).catch(()=>{})),t.push(T(()=>import("./reservationsService.ypr2Cr4i.js").then(n=>n.K),__vite__mapDeps([3,4,5,6]),import.meta.url).then(n=>n.refreshReservationsFromApi().catch(()=>{})).catch(()=>{})),t.push(T(()=>import("./state.QEOaSBGz.js").then(n=>n.M),__vite__mapDeps([6,4,5]),import.meta.url).then(n=>n.refreshTechniciansFromApi().catch(()=>{})).catch(()=>{})),t.push(T(()=>import("./maintenanceService.CDxi_Thf.js"),__vite__mapDeps([7,4,5]),import.meta.url).then(n=>n.refreshMaintenanceFromApi().catch(()=>{})).catch(()=>{})),t.push(T(()=>import("./equipment.Bc_ULOIF.js").then(n=>n.e),__vite__mapDeps([12,4,5,6]),import.meta.url).then(n=>n.refreshEquipmentFromApi({showToastOnError:!1}).catch(()=>{})).catch(()=>{})),t.push(T(()=>Promise.resolve().then(()=>yt),void 0,import.meta.url).then(n=>n.refreshPackagesFromApi().catch(()=>{})).catch(()=>{})),t.push(T(()=>import("./reservationsUI.D9gL7nZn.js"),__vite__mapDeps([9,10,4,5,11,6,3,12,13,14,8,15,16,17]),import.meta.url).catch(()=>{})),await Promise.allSettled(t)}catch{}};typeof window<"u"&&typeof window.requestIdleCallback=="function"?window.requestIdleCallback(()=>{e()},{timeout:2500}):setTimeout(e,500)}async function me(){if(!await Le())return;Fe(),Ye(),vt(),Pe(),pe(),Ee(),Ne();try{It()}catch{}Tt(),_t();const t=document.getElementById("excel-upload");t&&t.addEventListener("change",async o=>{const c=o.target.files&&o.target.files[0];c&&(await Me(c),o.target.value="")});const n=document.getElementById("excel-upload-trigger");n&&t&&n.addEventListener("click",o=>{o.preventDefault(),t.click()}),document.getElementById("logout-btn")?.addEventListener("click",Re),Et(),qt()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{me().catch(e=>{console.error("âŒ Failed to initialise app",e)})},{once:!0}):me().catch(e=>{console.error("âŒ Failed to initialise app",e)});function Et(){document.querySelectorAll('input[type="datetime-local"]').forEach(e=>{e.addEventListener("input",()=>{const t=e.value;if(!t.includes("T"))return;const[n,o]=t.split("T"),[c]=o.split(":"),u=`${c.padStart(2,"0")}:00`,a=`${n}T${u}`;e.value!==a&&(e.value=a,setTimeout(()=>e.blur(),150))})})}function qt(){const e=new URLSearchParams(window.location.search),t=e.get("reservationEditId"),n=e.get("reservationEditIndex");if(!t&&!n)return;y={reservationId:t,reservationIndex:n!=null?Number(n):null},qe(),e.delete("reservationEditId"),e.delete("reservationEditIndex");const o=e.toString(),c=`${window.location.pathname}${o?`?${o}`:""}${window.location.hash||""}`;window.history.replaceState({},document.title,c)}function At(e){const t=document.getElementById(e);return!!(t?.classList.contains("active")&&t?.style.display!=="none")}function kt(e){return new Promise(t=>{if(At(e)){t();return}const n=c=>{c?.detail?.tabId===e&&(document.removeEventListener("dashboard:tabChanged",n),t())};document.addEventListener("dashboard:tabChanged",n),document.querySelector(`[data-tab="${e}"]`)?.click()})}function wt(e){const t=document.querySelector(`#reservations-tab .sub-tab-button[data-sub-tab="${e}"]`),n=document.getElementById(e);return!!(t?.classList.contains("active")&&n?.classList.contains("active")&&n?.getAttribute("aria-hidden")==="false")}function Bt(e){return new Promise(t=>{if(wt(e)){t();return}const n=c=>{c?.detail?.subTabId===e&&(document.removeEventListener("reservations:subTabChanged",n),t())};document.addEventListener("reservations:subTabChanged",n),document.querySelector(`#reservations-tab .sub-tab-button[data-sub-tab="${e}"]`)?.click()})}async function Lt(){const e=Oe("openReservationEditor");if(typeof e=="function")return e;const t=await Ve("openReservationEditor");if(typeof t=="function")return t;throw new Error("Reservation editor handler is unavailable")}async function qe(){if(!y)return;if(z)return z;const e=(async()=>{const n=G().reservations||[];let o=null;if(y.reservationId){const r=n.findIndex(d=>String(d?.id)===y.reservationId||String(d?.reservationId)===y.reservationId);r!==-1&&(o=r)}if(o===null&&typeof y.reservationIndex=="number"&&!Number.isNaN(y.reservationIndex)&&y.reservationIndex>=0&&y.reservationIndex<n.length&&(o=y.reservationIndex),o===null)return;const c="my-reservations-tab",u="reservations-tab",a=y;y=null;try{await kt(u),await Bt(c);const r=await Lt();typeof r=="function"?r(o):(console.warn("âš ï¸ Pending reservation edit skipped: editor is not available"),y=a)}catch(r){console.error("âŒ Failed to open pending reservation editor",r),y=a}})();z=e;try{await e}finally{z=null}}document.addEventListener("reservations:changed",()=>{y&&qe()});
