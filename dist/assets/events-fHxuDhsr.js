import{r as s,b as l,i as c,c as m,d as f,l as v,e as h,f as p,u as o,g as F,h as b,j as y}from"./controller-D_GaW-RD.js";import{e as E,v as R,w as T,x as w}from"./projectsService-C0nhVRUy.js";import{e as I}from"./auth-CXJ9BVF7.js";let d=!1;function g(){document.querySelectorAll('input[type="time"]').forEach(t=>{t.setAttribute("step","3600"),t.dataset.listenerAttached!=="true"&&(t.addEventListener("change",()=>{if(!t.value)return;const[a]=t.value.split(":");t.value=`${a.padStart(2,"0")}:00`}),t.dataset.listenerAttached="true")})}function C(){return typeof window<"u"&&typeof window.flatpickr=="function"?window.flatpickr.bind(window):typeof globalThis<"u"&&typeof globalThis.flatpickr=="function"?globalThis.flatpickr.bind(globalThis):(console.warn("⚠️ Flatpickr غير متاح - سيتم تخطي تهيئة عناصر التاريخ"),null)}function S(){const e=C();if(!e)return;const t=[["#res-start",{dateFormat:"Y-m-d"}],["#res-end",{dateFormat:"Y-m-d"}],["#filter-start-date",{dateFormat:"Y-m-d"}],["#filter-end-date",{dateFormat:"Y-m-d"}],["#edit-res-start",{dateFormat:"Y-m-d"}],["#edit-res-end",{dateFormat:"Y-m-d"}]],a=[["#res-start-time",{enableTime:!0,noCalendar:!0,dateFormat:"H:i",altInput:!0,altFormat:"h:i K",time_24hr:!1,defaultHour:9,defaultMinute:0}],["#res-end-time",{enableTime:!0,noCalendar:!0,dateFormat:"H:i",altInput:!0,altFormat:"h:i K",time_24hr:!1,defaultHour:9,defaultMinute:0}],["#edit-res-start-time",{enableTime:!0,noCalendar:!0,dateFormat:"H:i",altInput:!0,altFormat:"h:i K",time_24hr:!1,defaultHour:9,defaultMinute:0}],["#edit-res-end-time",{enableTime:!0,noCalendar:!0,dateFormat:"H:i",altInput:!0,altFormat:"h:i K",time_24hr:!1,defaultHour:9,defaultMinute:0}]];[...t,...a].forEach(([n,u])=>{document.querySelector(n)&&e(n,u)});const r=document.querySelector("#res-start-time");r&&r.dispatchEvent(new Event("change",{bubbles:!0}))}function k(){g(),m(()=>s()),f(F()),T({onDraftChange:b,onEditChange:o}),v(),h(),d=!0}function L(){const e=document.body;e&&e.dataset.reservationsTechListener!=="true"&&(document.addEventListener("technicians:updated",()=>{const{technicians:t=[]}=I();w(t),p(),o()}),e.dataset.reservationsTechListener="true")}async function i(){await E();try{await R({force:!0})}catch(e){console.warn("⚠️ [reservations/events] Failed to pre-load projects for reservation form",e)}s(),l(),c({onAfterSubmit:y}),d||k(),S(),L()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{i().catch(e=>{console.error("❌ [reservations/events] Failed to initialize reservations UI",e)})},{once:!0}):i().catch(e=>{console.error("❌ [reservations/events] Failed to initialize reservations UI",e)});export{k as s};
