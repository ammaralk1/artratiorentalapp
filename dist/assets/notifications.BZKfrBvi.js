import{r as y,a as b,c as v,g as $,j as r,t as d,b as h}from"./auth.BO9j1-fU.js";import{i as T}from"./dashboardShell.DF2kUed9.js";y({ar:{notifications:{title:"Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª",header:"ğŸ”” Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª",subtitle:"Ø£Ø±Ø³Ù„ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù„Ù„ÙØ±ÙŠÙ‚ Ø¨Ø®ØµÙˆØµ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª/Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ØŒ ÙˆØ­Ø¯Ø¯ Ø§Ù„Ù‚Ù†ÙˆØ§Øª ÙˆØ§Ù„Ù…Ø³ØªÙ„Ù…ÙŠÙ†.",form:{entityType:"Ø§Ù„Ù†ÙˆØ¹",entity:{reservation:"Ø­Ø¬Ø²",project:"Ù…Ø´Ø±ÙˆØ¹"},search:"Ø¨Ø­Ø«","search.placeholder":"Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„ÙƒÙˆØ¯ Ø£Ùˆ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†"},table:{headers:{code:"Ø§Ù„ÙƒÙˆØ¯",title:"Ø§Ù„Ø¹Ù†ÙˆØ§Ù†",when:"Ø§Ù„ÙˆÙ‚Øª",customer:"Ø§Ù„Ø¹Ù…ÙŠÙ„",actions:"Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª"},loading:"â³ Ø§ÙƒØªØ¨ Ù„Ù„Ø¨Ø­Ø«â€¦",select:"Ø§Ø®ØªÙŠØ§Ø±"},channels:{email:"Ø¥ÙŠÙ…ÙŠÙ„",whatsapp:"ÙˆØ§ØªØ³Ø§Ø¨"},compose:{title:"âœ‰ï¸ Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø³Ø§Ù„Ø©",recipients:"Ø§Ù„Ù…Ø³ØªÙ„Ù…ÙˆÙ†",toTechnicians:"Ø§Ù„ÙÙ†ÙŠÙˆÙ† Ø§Ù„Ù…Ø¹ÙŠÙ‘Ù†ÙˆÙ†",toAdmins:"Ø§Ù„Ø¥Ø¯Ù…Ù†",subject:"Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹",body:"Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©",templates:{reminder:"ğŸ“Œ ØªØ°ÙƒÙŠØ±",note:"ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø© Ø¥Ø¯Ø§Ø±ÙŠØ©"},send:"ğŸš€ Ø¥Ø±Ø³Ø§Ù„",sentOk:"ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­"}}}});b();T();const t={};let c=null,m=null;function a(e){return document.querySelector(e)}function x(){t.entityType=a("#notif-entity-type"),t.search=a("#notif-search"),t.resultsBody=a("#notif-results-body"),t.composeSection=a("#notif-compose-section"),t.selectedSummary=a("#notif-selected-summary"),t.chEmail=a("#notif-channel-email"),t.chWhatsapp=a("#notif-channel-whatsapp"),t.toTechs=a("#notif-to-techs"),t.toAdmins=a("#notif-to-admins"),t.extraEmails=a("#notif-extra-emails"),t.extraPhones=a("#notif-extra-phones"),t.subject=a("#notif-subject"),t.body=a("#notif-body"),t.sendBtn=a("#notif-send-btn"),t.tReminder=a("#notif-template-reminder"),t.tNote=a("#notif-template-note")}function p(e,n){const s=e.start_datetime||e.startDate||"",o=e.end_datetime||e.endDate||"";return s&&o&&s!==o?`${s} â€” ${o}`:s||o||""}function _(e,n){if(!Array.isArray(e)||e.length===0){t.resultsBody.innerHTML=`<tr><td colspan="5" class="text-center text-muted">${d("notifications.table.loading","Ù„Ø§ Ù†ØªØ§Ø¦Ø¬")}</td></tr>`;return}t.resultsBody.innerHTML=e.map(s=>{const o=n==="reservation"?s.reservation_code||"":s.project_code||"",i=s.title||"",l=p(s),u=n==="reservation"?s.customer_name||"":s.client_name||"";return`
      <tr>
        <td>${o||"â€”"}</td>
        <td>${i||"â€”"}</td>
        <td>${l||"â€”"}</td>
        <td>${u||"â€”"}</td>
        <td><button type="button" class="btn btn-sm btn-primary" data-select-id="${s.id}" data-select-type="${n}">${d("notifications.table.select","Ø§Ø®ØªÙŠØ§Ø±")}</button></td>
      </tr>
    `}).join("")}async function f(){const e=t.entityType.value,n=(t.search.value||"").trim();if(n===""){t.resultsBody.innerHTML=`<tr><td colspan="5" class="text-center text-muted">${d("notifications.table.loading","Ø§ÙƒØªØ¨ Ù„Ù„Ø¨Ø­Ø«â€¦")}</td></tr>`;return}try{const o=await h(`${e==="reservation"?"/reservations/":"/projects/"}?search=${encodeURIComponent(n)}&limit=10`);_(o?.data??[],e)}catch(s){console.error(s),t.resultsBody.innerHTML='<tr><td colspan="5" class="text-center text-error">ÙØ´Ù„ Ø§Ù„Ø¨Ø­Ø«</td></tr>'}}function g(){m&&clearTimeout(m),m=setTimeout(f,350)}function j(e,n){const s=e==="reservation"?n.reservation_code||"":n.project_code||"",o=n.title||s||e,i=p(n),l=n.location||"",u=e==="reservation"?n.customer_name||"":n.client_name||"";return[s?`Ø§Ù„ÙƒÙˆØ¯: ${s}`:"",`Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${o}`,i?`Ø§Ù„ÙˆÙ‚Øª: ${i}`:"",l?`Ø§Ù„Ù…ÙˆÙ‚Ø¹: ${l}`:"",u?`Ø§Ù„Ø¹Ù…ÙŠÙ„: ${u}`:""].filter(Boolean).join(" | ")}async function E(e,n){try{const i=(await h(`${n==="reservation"?"/reservations/":"/projects/"}?id=${encodeURIComponent(e)}`))?.data;if(!i)throw new Error("Not found");c={type:n,id:Number(i.id),summary:j(n,i)},t.selectedSummary.textContent=c.summary,t.composeSection.hidden=!1}catch(s){console.error(s),r("âš ï¸ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù…Ø­Ø¯Ø¯")}}async function w(){if(!c){r("Ø§Ø®ØªØ± Ø¹Ù†ØµØ±Ø§Ù‹ Ø£ÙˆÙ„Ø§Ù‹");return}const e={email:!!t.chEmail.checked,whatsapp:!!t.chWhatsapp.checked};if(!e.email&&!e.whatsapp){r("Ø§Ø®ØªØ± Ù‚Ù†Ø§Ø© Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„");return}const n={technicians:!!t.toTechs.checked,admins:!!t.toAdmins.checked,additional_emails:(t.extraEmails.value||"").split(",").map(o=>o.trim()).filter(Boolean),additional_phones:(t.extraPhones.value||"").split(",").map(o=>o.trim()).filter(Boolean)},s={subject:(t.subject.value||"ØªÙ†Ø¨ÙŠÙ‡ Ø¥Ø¯Ø§Ø±ÙŠ").trim(),text:(t.body.value||"").trim()};if(!s.text){r("Ø§ÙƒØªØ¨ Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©");return}try{const o=await h("/notifications/send.php",{method:"POST",body:{entity_type:c.type,entity_id:c.id,channels:e,recipients:n,message:s}});r(d("notifications.compose.sentOk","ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­"))}catch(o){console.error(o),r("ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„")}}function B(){t.search.addEventListener("input",g),t.entityType.addEventListener("change",()=>{t.resultsBody.innerHTML=`<tr><td colspan="5" class="text-center text-muted">${d("notifications.table.loading","Ø§ÙƒØªØ¨ Ù„Ù„Ø¨Ø­Ø«â€¦")}</td></tr>`,t.search.value&&f()}),t.resultsBody.addEventListener("click",e=>{const n=e.target.closest("[data-select-id]");n&&E(n.getAttribute("data-select-id"),n.getAttribute("data-select-type"))}),t.tReminder.addEventListener("click",()=>{const e=`ØªØ°ÙƒÙŠØ± Ø¨Ø§Ù„Ø­Ø¬Ø²/Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:
ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ø·Ù„Ø§Ø¹ ÙˆØ§ØªØ®Ø§Ø° Ø§Ù„Ù„Ø§Ø²Ù….`;t.body.value=e}),t.tNote.addEventListener("click",()=>{const e=`Ù…Ù„Ø§Ø­Ø¸Ø© Ø¥Ø¯Ø§Ø±ÙŠØ©:
ÙŠØ±Ø¬Ù‰ Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨.`;t.body.value=e}),t.sendBtn.addEventListener("click",w)}(async function(){await v();const n=await $();if(!n||n.role!=="admin"){r("Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ† ÙÙ‚Ø·"),window.location.href="home.html";return}x(),B()})();
