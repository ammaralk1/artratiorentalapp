import{e as u}from"./calculations.49tK_B3V.js";import{p as h,e as y,a as g}from"./projects.Bl71o1L8.js";import"./reservationsService.BGgi72ed.js";import"./auth.Dym-pMl4.js";import"./state.D0_ft4YH.js";import"./dashboard.DgtQZpbL.js";import"./form.BoSw5-Ka.js";import"./projectsService.CtAJ7Bct.js";import"./constants.Cby_zQyZ.js";import"./customers.BzFjEKEv.js";import"./controller.DzvKBGXH.js";import"./details.BmsEvKGd.js";import"./equipment.CAaKsH40.js";import"./quotePdf.C2lQPEPC.js";import"./canvasColorUtils.CviLtv6S.js";import"./reservationsActions.DuW1PrtF.js";import"./uiBridge.BLZZT8b9.js";import"./dashboardShell.DF2kUed9.js";function b(){try{return String(localStorage.getItem("templatesPdf.mode")||"").trim()==="html2pdf"?"html2pdf":"iframe"}catch{return"iframe"}}async function w(){let r="";try{Array.from(document.styleSheets||[]).forEach(a=>{try{const t=a.cssRules;if(!t)return;for(let o=0;o<t.length;o+=1){const e=t[o];r+=e&&e.cssText?e.cssText:""}}catch{}})}catch{}return`<style>${r}</style>`}function C(){try{return Array.from(document.querySelectorAll('link[rel="stylesheet"]')).map(n=>{const a=n.getAttribute("href");return a?`<link rel="stylesheet" href="${a}">`:""}).join("")}catch{return""}}async function A({orientation:r="portrait",title:n="Print"}={}){const a=await w(),t=C(),o=`@page{size:A4 ${r};margin:0}html,body{margin:0;padding:0;background:#fff}#templates-a4-root{transform:none!important}`;return`<!doctype html><html><head><meta charset="utf-8"><title>${n}</title>${t}${a}<style>${o}</style></head>`}async function M(r){if(!r)throw new Error("No host");let n=null;try{n=await u()}catch{n=null}const a=document.createElement("div");Object.assign(a.style,{position:"fixed",top:"0",left:"-12000px",pointerEvents:"none",zIndex:"-1",backgroundColor:"#ffffff"});const t=document.createElement("div");t.id="templates-a4-root",t.setAttribute("data-render-context","export"),t.setAttribute("dir",r.getAttribute("dir")||document.documentElement.getAttribute("dir")||"rtl");const o=document.createElement("div");o.setAttribute("data-a4-pages","");const e=r.querySelector("[data-a4-pages]")?.cloneNode(!0)||r.cloneNode(!0);e.classList&&e.hasAttribute("data-a4-pages")?t.appendChild(e):(o.appendChild(e),t.appendChild(o)),a.appendChild(t),document.body.appendChild(a);try{try{const i=Array.from(t.querySelectorAll(".cs-logo img")).map(c=>c.getAttribute("src")).filter(Boolean);await h(i)}catch{}if(await y(),Array.from(t.querySelectorAll(".a4-page")).forEach(i=>{g(i)||i.parentElement?.removeChild(i)}),b()==="html2pdf"&&typeof n=="function"){await n().set({margin:0,html2canvas:{scale:1.5,useCORS:!0,allowTaint:!1,backgroundColor:"#ffffff"},jsPDF:{unit:"mm",format:"a4",orientation:"landscape"},pagebreak:{mode:["css","legacy"]},image:{type:"jpeg",quality:.98}}).from(t).save("template-callsheet.pdf");return}const p=`${await A({orientation:"landscape",title:"Call Sheet"})}<body dir="${t.getAttribute("dir")||"rtl"}">${t.outerHTML}</body></html>`,s=document.createElement("iframe");Object.assign(s.style,{position:"fixed",right:"0",bottom:"0",width:"1px",height:"1px",border:"0"}),document.body.appendChild(s);const l=s.contentWindow?.document;l&&(l.open(),l.write(p),l.close(),setTimeout(()=>{try{s.contentWindow?.focus(),s.contentWindow?.print()}catch{}setTimeout(()=>s.remove(),1200)},400))}finally{try{a.remove()}catch{}}}async function R(r,{orientation:n="portrait",filename:a="template.pdf"}={}){if(!r)throw new Error("No host");let t=null;try{t=await u()}catch{t=null}const o=document.createElement("div");Object.assign(o.style,{position:"fixed",top:"0",left:"-12000px",pointerEvents:"none",zIndex:"-1",backgroundColor:"#ffffff"});const e=document.createElement("div");e.id="templates-a4-root",e.setAttribute("data-render-context","export"),e.setAttribute("dir",r.getAttribute("dir")||document.documentElement.getAttribute("dir")||"rtl");const m=r.querySelector("[data-a4-pages]")?.cloneNode(!0)||r.cloneNode(!0);if(m.classList&&m.hasAttribute("data-a4-pages"))e.appendChild(m);else{const d=document.createElement("div");d.setAttribute("data-a4-pages",""),Array.from(r.children).forEach(p=>d.appendChild(p.cloneNode(!0))),e.appendChild(d)}o.appendChild(e),document.body.appendChild(o);try{try{const c=Array.from(e.querySelectorAll("img")).map(f=>f.getAttribute("src")).filter(Boolean);await h(c)}catch{}if(await y(),Array.from(e.querySelectorAll(".a4-page")).forEach(c=>{if(!g(c))try{c.parentElement?.removeChild(c)}catch{}}),b()==="html2pdf"&&typeof t=="function"){await t().set({margin:0,html2canvas:{scale:1.5,useCORS:!0,allowTaint:!1,backgroundColor:"#ffffff"},jsPDF:{unit:"mm",format:"a4",orientation:n==="landscape"?"landscape":"portrait"},pagebreak:{mode:["css","legacy"]},image:{type:"jpeg",quality:.98}}).from(e).save(a);return}const s=`${await A({orientation:n,title:"Print"})}<body dir="${e.getAttribute("dir")||"rtl"}">${e.outerHTML}</body></html>`,l=document.createElement("iframe");Object.assign(l.style,{position:"fixed",right:"0",bottom:"0",width:"1px",height:"1px",border:"0"}),document.body.appendChild(l);const i=l.contentWindow?.document;i&&(i.open(),i.write(s),i.close(),setTimeout(()=>{try{l.contentWindow?.focus(),l.contentWindow?.print()}catch{}setTimeout(()=>l.remove(),1200)},400))}finally{try{o.remove()}catch{}}}export{M as printCallsheetFromHost,R as printGenericTemplate};
