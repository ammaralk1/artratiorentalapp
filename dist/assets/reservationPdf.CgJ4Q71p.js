import{n as C,j as kt,t as r,d as Xt,b as Jt,h as da,p as re,B as pa,y as it,C as xn}from"./auth.TVJ8X2CT.js";import{n as ma,F as yt,E as _t,a as fa,b as Zt,d as $n,C as Tn,g as jn,r as ha,c as ya,e as ba,h as va}from"./reservationsService.DbQdg0Yk.js";import{s as ga,i as hn,j as yn,H as En,O as Nn}from"./state.BcSvKqfh.js";import{h as wa}from"./view.BH-BD-0N.js";import{q as qa}from"./quotePdf.BXe1f9wz.js";import{s as Cn,a as Pn,e as In,p as Sa}from"./canvasColorUtils.CviLtv6S.js";function Ln(e){const t=new Date;if(t.setHours(0,0,0,0),e==="today")return{startDate:Xe(t),endDate:Xe(t)};if(e==="week"){const n=new Date(t),a=n.getDay(),s=a===0?6:a-1;n.setDate(n.getDate()-s);const u=new Date(n);return u.setDate(n.getDate()+6),{startDate:Xe(n),endDate:Xe(u)}}if(e==="month"){const n=new Date(t.getFullYear(),t.getMonth(),1),a=new Date(t.getFullYear(),t.getMonth()+1,0);return{startDate:Xe(n),endDate:Xe(a)}}return e==="upcoming"?{startDate:Xe(t),endDate:""}:{startDate:"",endDate:""}}function Ms(){const e=document.getElementById("search-reservation"),t=document.getElementById("filter-start-date"),n=document.getElementById("filter-end-date"),a=document.getElementById("reservation-date-range"),s=document.getElementById("reservation-status-filter");let u=C(t?.value||"").trim(),o=C(n?.value||"").trim(),l=a?.value||"";if(new Set(["","today","week","month"]).has(l)||(l="",a&&(a.value=""),xt(t),xt(n),u="",o=""),!u&&!o&&l){const y=Ln(l);u=y.startDate,o=y.endDate}return{searchTerm:ma(e?.value||""),startDate:u,endDate:o,status:s?.value||"",quickRange:l}}function Rs(e){const t=()=>{typeof e=="function"&&e()},n=document.getElementById("search-reservation");n&&!n.dataset.listenerAttached&&(n.addEventListener("input",()=>{n.value=C(n.value),t()}),n.dataset.listenerAttached="true");const a=document.getElementById("filter-start-date");a&&!a.dataset.listenerAttached&&(a.addEventListener("change",()=>{const p=document.getElementById("reservation-date-range");p&&(p.value=""),t()}),a.dataset.listenerAttached="true");const s=document.getElementById("filter-end-date");s&&!s.dataset.listenerAttached&&(s.addEventListener("change",()=>{const p=document.getElementById("reservation-date-range");p&&(p.value=""),t()}),s.dataset.listenerAttached="true");const u=document.getElementById("reservation-date-range");u&&!u.dataset.listenerAttached&&(u.addEventListener("change",()=>{Aa(u.value),t()}),u.dataset.listenerAttached="true");const o=document.getElementById("reservation-status-filter");o&&!o.dataset.listenerAttached&&(o.addEventListener("change",t),o.dataset.listenerAttached="true");const l=document.getElementById("clear-filters");l&&!l.dataset.listenerAttached&&(l.addEventListener("click",()=>{n&&(n.value=""),xt(a),xt(s),u&&(u.value=""),o&&(o.value=""),t()}),l.dataset.listenerAttached="true")}function Aa(e){const t=document.getElementById("filter-start-date"),n=document.getElementById("filter-end-date");if(!t||!n)return;const{startDate:a,endDate:s}=Ln(e);t._flatpickr?a?t._flatpickr.setDate(a,!1,"Y-m-d"):t._flatpickr.clear():t.value=a,n._flatpickr?s?n._flatpickr.setDate(s,!1,"Y-m-d"):n._flatpickr.clear():n.value=s}function Xe(e){if(!e)return"";const t=e.getTimezoneOffset()*6e4;return new Date(e.getTime()-t).toISOString().split("T")[0]}function xt(e){e&&(e._flatpickr&&e._flatpickr.clear(),e.value="")}const ka=""+new URL("Tajawal-400.ttf",import.meta.url).href,_a=""+new URL("Tajawal-500.ttf",import.meta.url).href,bn=""+new URL("Tajawal-700.ttf",import.meta.url).href,Dn="reservations.quote.sequence",vn={reservation:"reservations.quote.togglePrefs.v1",project:"projects.quote.togglePrefs.v1",reservationChecklist:"reservations.checklist.togglePrefs.v1"},Fn="https://help.artratio.sa/guide/quote-preview",ye={logoUrl:"https://art-ratio.sirv.com/AR-Logo-v3.5-curved.png",companyName:"Ø´Ø±ÙƒØ© ÙÙˆØ¯ Ø¢Ø±Øª Ù„Ù„Ø¯Ø¹Ø§ÙŠØ© ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù† (Ø´Ø±ÙƒØ© Ø´Ø®Øµ ÙˆØ§Ø­Ø¯)",commercialRegistry:"4030485240",beneficiaryName:"Ø´Ø±ÙƒØ© ÙÙˆØ¯ Ø¢Ø±Øª Ù„Ù„Ø¯Ø¹Ø§ÙŠØ© ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù† (Ø´Ø±ÙƒØ© Ø´Ø®Øµ ÙˆØ§Ø­Ø¯)",bankName:"Ù…ØµØ±Ù Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠ",accountNumber:"Ù£Ù¥Ù¨Ù Ù Ù Ù Ù¡Ù Ù Ù Ù¦Ù Ù¨Ù¦Ù Ù¦Ù¥Ù§Ù Ù¦",iban:"SA1680000358608016065706",approvalNote:"Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø±Ø¶ ØªØ¹ØªØ¨Ø± Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…."},xa=["ÙŠÙˆÙ… Ø§Ù„Ø¹Ù…Ù„ Ù‡Ùˆ 12 Ø³Ø§Ø¹Ø©ØŒ ÙˆÙŠØªÙ… Ø§Ø­ØªØ³Ø§Ø¨ Ù†ØµÙ ÙŠÙˆÙ… Ø¥Ø¶Ø§ÙÙŠ Ø¨Ø¹Ø¯ 20 Ø³Ø§Ø¹Ø©ØŒ Ø«Ù… ÙŠÙˆÙ… ÙƒØ§Ù…Ù„ Ø¨Ø¹Ø¯ Ø°Ù„Ùƒ.","ÙŠÙ…Ù†Ø¹ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙÙŠ Ø£Ù†Ø´Ø·Ø© ØºÙŠØ± Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©.","ÙŠØªØ­Ù…Ù„ Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø± Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© Ø£ÙŠ ØªÙ„Ù Ø£Ùˆ ÙÙ‚Ø¯Ø§Ù†.","ÙŠØ¬Ø¨ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙÙŠ Ø­Ø§Ù„ØªÙ‡Ø§ Ø§Ù„Ø£ØµÙ„ÙŠØ©.","ÙŠØªÙ… ÙØ±Ø¶ Ø±Ø³ÙˆÙ… Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ù„ØºØ§Ø¡ Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ù‚Ø¨Ù„ 24 Ø³Ø§Ø¹Ø©."],_e=[...xa],$a=["ÙŠØªÙ… Ø¯ÙØ¹ 50% Ù…Ù† Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø±ØŒ ÙˆÙŠØªÙ… Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø§Ù„Ù€ 50% Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ.","ÙŠØ­ØµÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¹Ù„Ù‰ Ø­Ù‚ÙˆÙ‚ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© ÙÙŠ Ø£ÙŠ Ù…ÙƒØ§Ù† ÙŠØ±Ø§Ù‡ Ù…Ù†Ø§Ø³Ø¨Ø§Ù‹ØŒ Ø¨ÙŠÙ†Ù…Ø§ ØªØ­ØªÙØ¸ Ø§Ù„Ø´Ø±ÙƒØ© Ø¨Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø®Ø§Ù… ÙˆÙ„Ø§ ØªØ³ØªØ®Ø¯Ù…Ù‡Ø§ Ø¥Ù„Ø§ Ø¨Ø¹Ø¯ Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ø§ Ù„Ù… ÙŠÙØªÙÙ‚ Ø¹Ù„Ù‰ ØºÙŠØ± Ø°Ù„Ùƒ.","ÙŠØªÙ… Ø§Ù„Ø§ØªÙØ§Ù‚ Ø¹Ù„Ù‰ Ø¬Ø¯ÙˆÙ„ Ø²Ù…Ù†ÙŠ Ù„Ù„ØªÙ†ÙÙŠØ°ØŒ ÙˆØ£ÙŠ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ø®Ø§Ø±Ø¬ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ù…ØªÙÙ‚ Ø¹Ù„ÙŠÙ‡ ØªØ®Ø¶Ø¹ Ù„Ø±Ø³ÙˆÙ… Ø¥Ø¶Ø§ÙÙŠØ©.","Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù† ØªÙˆÙÙŠØ± Ø§Ù„ØªØµØ§Ø±ÙŠØ­ Ø§Ù„Ù„Ø§Ø²Ù…Ø© Ù„Ù„ØªØµÙˆÙŠØ± ÙÙŠ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©ØŒ ÙˆØ£ÙŠ ØªØ£Ø®ÙŠØ± Ù†Ø§ØªØ¬ Ø¹Ù† Ø°Ù„Ùƒ Ù‚Ø¯ ÙŠØ¤Ø«Ø± Ø¹Ù„Ù‰ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„ØªØ³Ù„ÙŠÙ….","ØªÙØ­ÙÙŽØ¸ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ù„Ù„Ù…Ø´Ø±ÙˆØ¹ Ù„Ù…Ø¯Ø© 12 Ø´Ù‡Ø±Ø§Ù‹ ÙÙŠ Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ø´Ø±ÙƒØ©ØŒ ÙˆÙŠÙ…ÙƒÙ† Ù„Ù„Ø¹Ù…ÙŠÙ„ Ø·Ù„Ø¨ Ù†Ø³Ø® Ø¥Ø¶Ø§ÙÙŠØ© Ø®Ù„Ø§Ù„ ØªÙ„Ùƒ Ø§Ù„ÙØªØ±Ø©.","ÙŠØªØ­Ù…Ù‘Ù„ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© ØªÙˆÙÙŠØ± Ø¨ÙŠØ¦Ø© Ø¹Ù…Ù„ Ø¢Ù…Ù†Ø© Ù„Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ ÙˆØ§Ù„Ù…Ø¹Ø¯Ø§Øª ÙÙŠ Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªØµÙˆÙŠØ±ØŒ ÙˆÙŠØ¶Ù…Ù† Ø§ØªØ®Ø§Ø° ÙƒØ§ÙØ© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·Ø§Øª Ø§Ù„Ù„Ø§Ø²Ù…Ø© Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø³Ù„Ø§Ù…ØªÙ‡Ù…."];function Qt(e){return e?e.split(/\r?\n/).map(t=>t.trim()).filter(t=>t.length>0):[..._e]}function Ta(){const e=document.getElementById("reservation-terms");if(e&&e.value.trim().length>0){const a=Qt(e.value);if(a.length)return a}const t=document.getElementById("edit-res-terms");if(t&&t.value.trim().length>0){const a=Qt(t.value);if(a.length)return a}const n=_e.join(`
`);return e&&e.value.trim().length===0&&(e.value=n),t&&t.value.trim().length===0&&(t.value=n),[..._e]}const ja=[{id:"customerInfo",labelKey:"reservations.quote.sections.customer",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„",defaultSelected:!0},{id:"reservationInfo",labelKey:"reservations.quote.sections.reservation",fallback:"ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²",defaultSelected:!0},{id:"projectInfo",labelKey:"reservations.quote.sections.project",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",defaultSelected:!0},{id:"financialSummary",labelKey:"reservations.quote.sections.financial",fallback:"Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ",defaultSelected:!0},{id:"items",labelKey:"reservations.quote.sections.items",fallback:"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",defaultSelected:!0},{id:"crew",labelKey:"reservations.quote.sections.crew",fallback:"Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„",defaultSelected:!0},{id:"notes",labelKey:"reservations.quote.sections.notes",fallback:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø­Ø¬Ø²",defaultSelected:!0},{id:"payment",labelKey:"reservations.quote.sections.payment",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹",defaultSelected:!1}],It=[{id:"rowNumber",labelKey:null,fallback:"#",render:(e,t)=>i(C(String(t+1)))},{id:"code",labelKey:"reservations.details.table.headers.code",fallback:"Ø§Ù„ÙƒÙˆØ¯",render:e=>{if(e?.isPackage){const t=e?.packageCodeResolved||e?.barcode||"";return i(t||"-")}return i(e?.barcode||"-")}},{id:"description",labelKey:"reservations.details.table.headers.description",fallback:"Ø§Ù„ÙˆØµÙ",render:e=>{const t=String(e?.desc||e?.description||"-");return`<div class="quote-cell quote-cell--desc">${i(t)}</div>`}},{id:"quantity",labelKey:"reservations.details.table.headers.quantity",fallback:"Ø§Ù„ÙƒÙ…ÙŠØ©",render:e=>i(C(String(e?.qty||1)))},{id:"unitPrice",labelKey:"reservations.quote.columns.unitPrice",fallback:"Ù„ÙƒÙ„ ÙŠÙˆÙ…",render:e=>i(C(Number(e?.unitPriceValue||0).toFixed(2)))},{id:"price",labelKey:"reservations.quote.columns.total",fallback:"Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹",render:e=>i(C(Number(e?.price||0).toFixed(2)))}],Lt=[{id:"rowNumber",labelKey:null,fallback:"#",render:(e,t)=>i(C(String(t+1)))},{id:"position",labelKey:"reservations.details.crew.position",fallback:"Ø§Ù„Ù…Ù†ØµØ¨",render:e=>{const t=typeof re=="function"?re():"ar",n=e?.positionLabelEn??e?.position_label_en??e?.position_name_en??e?.positionLabelAlt??e?.position_label_alt??e?.role,a=e?.positionLabel??e?.position_name??e?.role??r("reservations.crew.positionFallback","Ù…Ù†ØµØ¨ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…");return i(C(String(t==="en"&&n?n:a)))}},{id:"unitPrice",labelKey:"reservations.quote.columns.unitPrice",fallback:"Ù„ÙƒÙ„ ÙŠÙˆÙ…",render:e=>{const t=Number.isFinite(Number(e?.positionClientPrice))?Number(e.positionClientPrice):0;return i(`${C(t.toFixed(2))} ${r("reservations.create.summary.currency","SR")}`)}},{id:"price",labelKey:"reservations.quote.columns.total",fallback:"Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹",render:e=>{const t=Number.isFinite(Number(e?.positionClientPrice))?Number(e.positionClientPrice):0;return i(`${C(t.toFixed(2))} ${r("reservations.create.summary.currency","SR")}`)}}],Ve={customerInfo:[{id:"customerName",labelKey:"reservations.details.labels.customer",fallback:"Ø§Ù„Ø¹Ù…ÙŠÙ„"},{id:"customerCompany",labelKey:"reservations.details.labels.company",fallback:"Ø§Ù„Ø´Ø±ÙƒØ©"},{id:"customerPhone",labelKey:"reservations.details.labels.phone",fallback:"Ø§Ù„Ù‡Ø§ØªÙ"},{id:"customerEmail",labelKey:"reservations.details.labels.email",fallback:"Ø§Ù„Ø¨Ø±ÙŠØ¯"}],reservationInfo:[{id:"reservationId",labelKey:"reservations.details.labels.reservationId",fallback:"Ø±Ù‚Ù… Ø§Ù„Ø­Ø¬Ø²"},{id:"reservationStart",labelKey:"reservations.details.labels.start",fallback:"Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø­Ø¬Ø²"},{id:"reservationEnd",labelKey:"reservations.details.labels.end",fallback:"Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø­Ø¬Ø²"},{id:"reservationDuration",labelKey:"reservations.details.labels.duration",fallback:"Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…"}],projectInfo:[{id:"projectTitle",labelKey:"reservations.details.labels.project",fallback:"Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectCode",labelKey:"reservations.details.labels.code",fallback:"Ø§Ù„Ø±Ù…Ø²"}],financialSummary:[{id:"discountAmount",labelKey:"reservations.details.labels.discount",fallback:"Ø§Ù„Ø®ØµÙ…"},{id:"subtotalBeforeTax",labelKey:"reservations.details.labels.subtotalBeforeTax",fallback:"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"},{id:"taxAmount",labelKey:"reservations.details.labels.tax",fallback:"Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"},{id:"finalTotal",labelKey:"reservations.details.labels.total",fallback:"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ"}],payment:[{id:"beneficiary",labelKey:"reservations.quote.labels.beneficiary",fallback:"Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙÙŠØ¯"},{id:"bank",labelKey:"reservations.quote.labels.bank",fallback:"Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ"},{id:"account",labelKey:"reservations.quote.labels.account",fallback:"Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨"},{id:"iban",labelKey:"reservations.quote.labels.iban",fallback:"Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ¨Ø§Ù†"}],items:[...It.map(({id:e,labelKey:t,fallback:n})=>({id:e,labelKey:t,fallback:n})),{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…"},{id:"equipmentSubtotal",labelKey:"reservations.details.labels.equipmentTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"}],crew:[...Lt.map(({id:e,labelKey:t,fallback:n})=>({id:e,labelKey:t,fallback:n})),{id:"quantity",labelKey:"reservations.details.table.headers.quantity",fallback:"Ø§Ù„ÙƒÙ…ÙŠØ©"},{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…"},{id:"crewSubtotal",labelKey:"reservations.details.labels.crewTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±ÙŠÙ‚"}]},Mn=[{id:"rowNumber",labelKey:null,fallback:"#",render:(e,t)=>i(C(String(t+1)))},{id:"label",labelKey:null,fallback:"Ø§Ù„Ø¨Ù†Ø¯",render:e=>i(e?.label||"-")},{id:"amount",labelKey:null,fallback:"Ø§Ù„Ø³Ø¹Ø±",render:e=>{const t=Number.isFinite(Number(e?.salePrice??e?.sale_price))?Number(e?.salePrice??e?.sale_price):Number(e?.amount??0)||0;return i(X(t,r("reservations.create.summary.currency","SR")))}},{id:"note",labelKey:null,fallback:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª",render:e=>i(e?.note||"-")}],Ea=[{id:"customerInfo",labelKey:"projects.quote.sections.customer",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„",defaultSelected:!0},{id:"projectInfo",labelKey:"projects.quote.sections.project",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",defaultSelected:!0},{id:"projectExpenses",labelKey:"projects.quote.sections.expenses",fallback:"Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©",defaultSelected:!0},{id:"projectCrew",labelKey:"projects.quote.sections.crew",fallback:"Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„",defaultSelected:!0},{id:"financialSummary",labelKey:"projects.quote.sections.financial",fallback:"Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ",defaultSelected:!0},{id:"projectEquipment",labelKey:"projects.quote.sections.equipment",fallback:"Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",defaultSelected:!0},{id:"projectNotes",labelKey:"projects.quote.sections.notes",fallback:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",defaultSelected:!0},{id:"payment",labelKey:"reservations.quote.sections.payment",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹",defaultSelected:!1}],Na={customerInfo:Ve.customerInfo,projectInfo:[{id:"projectTitle",labelKey:"projects.details.overview.heading",fallback:"Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectCode",labelKey:"projects.details.labels.code",fallback:"Ø±Ù‚Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectType",labelKey:"projects.details.type",fallback:"Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectStart",labelKey:"projects.details.start",fallback:"Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectEnd",labelKey:"projects.details.end",fallback:"Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectDuration",labelKey:"projects.details.duration",fallback:"Ù…Ø¯Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectStatus",labelKey:"projects.details.status",fallback:"Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"}],financialSummary:[{id:"reservationsTotal",labelKey:"projects.details.reservationsTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª"},{id:"discountAmount",labelKey:"projects.details.summary.discount",fallback:"Ø§Ù„Ø®ØµÙ…"},{id:"taxAmount",labelKey:"projects.details.summary.combinedTax",fallback:"Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"},{id:"overallTotal",labelKey:"projects.details.summary.overallTotal",fallback:"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ"}],payment:Ve.payment,projectExpenses:[...Mn.map(({id:e,labelKey:t,fallback:n})=>({id:e,labelKey:t,fallback:n})),{id:"expensesSubtotal",labelKey:"projects.details.expensesTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©"}],projectCrew:[...Lt.map(({id:e,labelKey:t,fallback:n})=>({id:e,labelKey:t,fallback:n})),{id:"quantity",labelKey:"reservations.details.table.headers.quantity",fallback:"Ø§Ù„ÙƒÙ…ÙŠØ©"},{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…"},{id:"crewSubtotal",labelKey:"reservations.details.labels.crewTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±ÙŠÙ‚"}],projectEquipment:[...It.map(({id:e,labelKey:t,fallback:n})=>({id:e,labelKey:t,fallback:n})),{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…"},{id:"equipmentSubtotal",labelKey:"reservations.details.labels.equipmentTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"}],projectNotes:[]},Kt=new Map;function Dt(e="reservation"){if(Kt.has(e))return Kt.get(e);const t=e==="project"?Ea:e==="reservationChecklist"?[{id:"customerInfo",labelKey:"reservations.quote.sections.customer",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„",defaultSelected:!0},{id:"reservationInfo",labelKey:"reservations.quote.sections.reservation",fallback:"ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²",defaultSelected:!0},{id:"projectInfo",labelKey:"reservations.quote.sections.project",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",defaultSelected:!0},{id:"notes",labelKey:"reservations.quote.sections.notes",fallback:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø­Ø¬Ø²",defaultSelected:!0},{id:"items",labelKey:"reservations.quote.sections.items",fallback:"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",defaultSelected:!0},{id:"crew",labelKey:"reservations.quote.sections.crew",fallback:"Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„",defaultSelected:!0}]:ja,n=e==="project"?Na:e==="reservationChecklist"?{customerInfo:Ve.customerInfo,reservationInfo:Ve.reservationInfo,projectInfo:Ve.projectInfo,notes:[],items:Ve.items,crew:Ve.crew}:Ve,a=new Set(t.map(({id:o})=>o)),s=Object.fromEntries(Object.entries(n).map(([o,l=[]])=>[o,new Set(l.map(p=>p.id))])),u={sectionDefs:t,fieldDefs:n,sectionIdSet:a,fieldIdMap:s};return Kt.set(e,u),u}function Ft(e="reservation"){return Dt(e).sectionDefs}function Rn(e="reservation"){return Dt(e).fieldDefs}function Bn(e="reservation"){return Dt(e).sectionIdSet}function On(e="reservation"){return Dt(e).fieldIdMap}function Kn(e){switch(e){case"export":return r("reservations.quote.status.exporting","Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ù…Ù„Ù PDF...");case"render":default:return r("reservations.quote.status.rendering","Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©...")}}const Ca="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js",Pa="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js",Ia="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js",Hn=qa.trim(),Qn=`
@font-face { font-family: 'Tajawal'; font-style: normal; font-weight: 400; font-display: swap; src: url(${JSON.stringify(ka)}) format('truetype'); }
@font-face { font-family: 'Tajawal'; font-style: normal; font-weight: 500; font-display: swap; src: url(${JSON.stringify(_a)}) format('truetype'); }
@font-face { font-family: 'Tajawal'; font-style: normal; font-weight: 600; font-display: swap; src: url(${JSON.stringify(bn)}) format('truetype'); }
@font-face { font-family: 'Tajawal'; font-style: normal; font-weight: 700; font-display: swap; src: url(${JSON.stringify(bn)}) format('truetype'); }
`,Un=/^data:image\/svg\+xml/i,La=/\.svg($|[?#])/i,mt=512,Ut="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/B8AAusB9YwpClgAAAAASUVORK5CYII=",zn=96,Vn=25.4,zt=210,gt=297,wt=Math.round(zt/Vn*zn),qt=Math.round(gt/Vn*zn);function fe(e){const t=Number(e),n=Number.isFinite(t)?t:0;try{const a=Math.abs(n%1)>1e-9;return C(n.toLocaleString("en-US",{minimumFractionDigits:a?2:0,maximumFractionDigits:2}))}catch{return Number.isInteger(n)?C(String(n)):C(n.toFixed(2))}}let $t=!1,Tt=null;function en(){$t||(Tt=async function(){try{if(!c||!A?.modal?.classList.contains("show")||(c.context||"reservation")!=="reservation")return;const n=c.reservation;if(!n)return;const a=[n.id,n.reservationId,n.reservation_id,n.reservationCode,n.reservation_code].map(b=>b==null?"":String(b)).filter(b=>b.length>0);if(!a.length)return;const s=jn(),u=(Array.isArray(s)?s:[]).find(b=>[b?.id,b?.reservationId,b?.reservation_id,b?.reservationCode,b?.reservation_code].map(S=>S==null?"":String(S)).filter(S=>S.length>0).some(S=>a.includes(S)));if(!u)return;const o=Bt(u),{totalsDisplay:l,totals:p,rentalDays:y}=cn(u,o,c.project);c.reservation=u,c.crewAssignments=o,c.totals=p,c.totalsDisplay=l,c.rentalDays=y,At(),Ae()}catch(t){console.warn("[reservationPdf] live update failed",t)}},document.addEventListener("reservations:changed",Tt),$t=!0)}function Wn(){if($t){try{document.removeEventListener("reservations:changed",Tt)}catch{}Tt=null,$t=!1}}const Gn=2,Yn=/safari/i,Da=/(iphone|ipad|ipod)/i,gn=/(iphone|ipad|ipod)/i,Fa=/(crios|fxios|edgios|opios)/i,jt="[reservations/pdf]";let A=null,c=null,Re=1,dt=null,pt=null,We=null,ot=null,ft=!1;function Je(e="render",{message:t,actionLabel:n,onAction:a,showSpinner:s=e!=="error"}={}){if(!A?.statusIndicator||!A?.statusText)return;A.statusKind=e;const u=t||Kn(e);A.statusText.textContent=u,A.statusSpinner&&(A.statusSpinner.hidden=!s),A.statusAction&&(A.statusAction.hidden=!0,A.statusAction.onclick=null,n&&typeof a=="function"&&(A.statusAction.textContent=n,A.statusAction.hidden=!1,A.statusAction.onclick=o=>{o.preventDefault(),a()})),A.statusIndicator.hidden=!1,requestAnimationFrame(()=>{A.statusIndicator.classList.add("is-visible")})}function rt(e){try{return String(e||"").toLowerCase().normalize("NFKD").replace(/[\u064B-\u065F\u0670\u06D6-\u06ED]/g,"").replace(/\s+/g," ").trim()}catch{return String(e||"").trim().toLowerCase()}}function ht(e){!A?.statusIndicator||!A?.statusText||(A.statusKind=null,A.statusIndicator.classList.remove("is-visible"),setTimeout(()=>{A?.statusIndicator&&(A.statusIndicator.hidden=!0,A.statusAction&&(A.statusAction.hidden=!0,A.statusAction.onclick=null),A.statusSpinner&&(A.statusSpinner.hidden=!1))},220))}function Vt(){return!!window?.bootstrap?.Modal}function Ma(e){if(e&&!e.classList.contains("show")){e.classList.add("show"),e.style.display="block",e.removeAttribute("aria-hidden"),e.setAttribute("aria-modal","true"),e.getAttribute("role")||e.setAttribute("role","dialog"),document.body.classList.add("modal-open"),We||(We=document.createElement("div"),We.className="modal-backdrop fade show",We.dataset.quotePdfFallbackBackdrop="true",document.body.appendChild(We)),ot||(ot=t=>{t.key==="Escape"&&Wt(e)},document.addEventListener("keydown",ot));try{e.focus({preventScroll:!0})}catch{}}}function Wt(e){if(!(!e||!e.classList.contains("show"))){try{const t=e.ownerDocument?.activeElement;if(t&&e.contains(t)){try{t.blur()}catch{}try{e.ownerDocument?.body?.focus({preventScroll:!0})}catch{}}}catch{}e.classList.remove("show"),e.style.display="none",e.setAttribute("aria-hidden","true"),e.removeAttribute("aria-modal"),document.body.classList.remove("modal-open"),We&&(We.remove(),We=null),ot&&(document.removeEventListener("keydown",ot),ot=null);try{Wn()}catch{}}}function Ra(e){if(e){if(Vt()){const t=window.bootstrap.Modal.getOrCreateInstance(e);try{const n=()=>{try{const a=document.activeElement;if(a&&e.contains(a)){try{a.blur()}catch{}try{document.body?.focus({preventScroll:!0})}catch{}}}catch{}try{Wn()}catch{}try{e.removeEventListener("hidden.bs.modal",n)}catch{}};e.addEventListener("hidden.bs.modal",n,{once:!0}),e.addEventListener("hide.bs.modal",()=>{try{const a=document.activeElement;if(a&&e.contains(a))try{a.blur()}catch{}}catch{}})}catch{}t.show();return}Ma(e)}}function Ba(){if(ft)return;ft=!0;const e=r("reservations.quote.toast.viewGuide","ðŸ“˜ Ø¹Ø±Ø¶ Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø­Ù„ Ø§Ù„Ø³Ø±ÙŠØ¹"),t=r("reservations.quote.toast.retry","Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©"),n=r("reservations.quote.toast.assetsFailed","âš ï¸ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø¨Ø¹Ø¶ Ø§Ù„ØµÙˆØ± Ø¶Ù…Ù† Ø¹Ø±Ø¶ Ø³Ø¹Ø±."),a=!!A?.modal?.classList.contains("show"),s=()=>{A?.modal?.classList.contains("show")&&(Je("render"),ft=!1,Ae())};xn({message:n,duration:9e3,actionLabel:a?t:void 0,onAction:a?s:void 0,linkLabel:e,linkHref:Fn}),a&&Je("error",{message:n,actionLabel:t,onAction:s,showSpinner:!1})}function vt(e="reservation"){const t={},n=Rn(e);return Object.entries(n).forEach(([a,s=[]])=>{t[a]=new Set(s.filter(u=>u?.default!==!1).map(u=>u.id))}),t}function tn(e={}){const t={};return Object.entries(e).forEach(([n,a])=>{t[n]=new Set(Array.from(a||[]))}),t}function Oa(e={},t){if(t)return e[t]||(e[t]=new Set),e[t]}function nn(e={},t,n){const a=e?.[t];return a?a instanceof Set?a.has(n):Array.isArray(a)?a.includes(n):!!a?.[n]:!0}function Mt(e="reservation"){return Object.fromEntries(Ft(e).map(({id:t})=>[t,!1]))}function an(e,t){return e.sectionExpansions||(e.sectionExpansions=Mt(e.context||"reservation")),t&&typeof e.sectionExpansions[t]!="boolean"&&(e.sectionExpansions[t]=!1),e.sectionExpansions}function Ka(e,t){return an(e,t)?.[t]!==!1}function sn(){return typeof window>"u"||typeof window.matchMedia!="function"?!1:window.matchMedia("(max-width: 768px)").matches}function Ha(){if(typeof navigator>"u")return!1;const e=navigator.userAgent||navigator.platform||"";return Da.test(e)}function Qa(){if(typeof navigator>"u")return!1;const e=navigator.userAgent||"",t=Yn.test(e),n=e.includes("Chrome")||e.includes("CriOS")||e.includes("Chromium"),a=e.includes("Edg");return t&&!n&&!a}function Xn(){return Ha()&&Qa()}function Rt(){if(typeof navigator>"u")return!1;const e=navigator.userAgent||"",t=navigator.platform||"",n=Number.isFinite(navigator.maxTouchPoints)?navigator.maxTouchPoints:0,a=gn.test(e)||gn.test(t),s=/Macintosh/i.test(e)&&n>1;return Yn.test(e)&&!Fa.test(e)&&(a||s)}function Ht(e,...t){try{console.log(`${jt} ${e}`,...t)}catch{}}function Be(e,...t){try{console.warn(`${jt} ${e}`,...t)}catch{}}function Ua(e,t,...n){try{t?console.error(`${jt} ${e}`,t,...n):console.error(`${jt} ${e}`,...n)}catch{}}function oe(e,{blockType:t="section",extraAttributes:n=""}={}){if(!e)return"";const a=n?` ${n.trim()}`:"";return e.replace(/^(<\w+)/,`$1 data-quote-block data-block-type="${t}"${a}`)}function za(e,t="Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¹Ø±Ø¶."){const n=i(r(e,t));return oe(`<section class="quote-section quote-placeholder">${n}</section>`,{blockType:"placeholder"})}function Et(e,t){return Array.isArray(e)&&e.length?e:[za(t)]}const Va=/[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF]/;function Jn(e=""){return Va.test(e)}function Wa(){const e=window.CanvasRenderingContext2D?.prototype;if(!e||e.__artRatioDirectionPatched)return;const t=n=>{const a=e[n];typeof a=="function"&&(e[n]=function(u,...o){if(typeof u!="string"||!Jn(u))return a.call(this,u,...o);let l,p=!1;try{"direction"in this&&(l=this.direction,l!=="rtl"&&(this.direction="rtl"),p=!0)}catch{}try{if(!p){const y=this.canvas;y&&y.style?.direction!=="rtl"&&(y.__artRatioOriginalDirection=y.style.direction,y.style.direction="rtl")}return a.call(this,u,...o)}finally{if(p&&l!==void 0&&l!=="rtl")try{this.direction=l}catch{}else if(!p){const y=this.canvas;y&&y.__artRatioOriginalDirection!==void 0&&(y.style.direction=y.__artRatioOriginalDirection,delete y.__artRatioOriginalDirection)}}})};t("fillText"),t("strokeText"),e.__artRatioDirectionPatched=!0}function wn(e,t=mt){if(typeof e!="string"&&typeof e!="number")return t;const n=parseFloat(String(e).replace(/[^0-9.+-]/g,""));return Number.isFinite(n)&&n>0?n:t}function Ga(e){if(!e)return{width:mt,height:mt};const t=e.getAttribute?.("width"),n=e.getAttribute?.("height");let a=t?wn(t,0):0,s=n?wn(n,0):0;if(a>0&&s>0)return{width:a,height:s};const u=e.getAttribute?.("viewBox");if(u){const o=u.trim().split(/[\s,]+/).map(l=>parseFloat(l||"0"));if(o.length>=4){const[,,l,p]=o;a=a||(Number.isFinite(l)&&l>0?l:0),s=s||(Number.isFinite(p)&&p>0?p:0)}}return{width:a||mt,height:s||mt}}function Zn(e=""){return typeof e!="string"?!1:Un.test(e)||La.test(e)}function Ya(e=""){const t=e.indexOf(",");if(t===-1)return"";const n=e.slice(0,t),a=e.slice(t+1);try{return/;base64/i.test(n)?typeof atob=="function"?atob(a):"":decodeURIComponent(a)}catch(s){return console.warn("[reservations/pdf] failed to decode SVG data URI",s),""}}function Xa(e,{crossOrigin:t}={}){return new Promise((n,a)=>{const s=new Image;t&&(s.crossOrigin=t),s.onload=()=>n(s),s.onerror=u=>{const o=u?.message||`Unable to load image from ${e}`;a(new Error(o))},s.src=e})}async function ea(e,t={}){if(!e)return null;const n=document,a=new Blob([e],{type:"image/svg+xml;charset=utf-8"}),s=URL.createObjectURL(a);try{const u=await Xa(s),o=n.createElement("canvas"),l=Math.max(t.width||u.naturalWidth||u.width||0,1),p=Math.max(t.height||u.naturalHeight||u.height||l,1);o.width=l,o.height=p;const y=o.getContext("2d");return y.clearRect(0,0,l,p),y.drawImage(u,0,0,l,p),o.toDataURL("image/png")}catch(u){return console.warn("[reservations/pdf] failed to rasterize SVG content",u),null}finally{URL.revokeObjectURL(s)}}async function Ja(e){if(!e)return null;if(Un.test(e))return Ya(e);try{const t=await fetch(e,{mode:"cors",credentials:"omit",cache:"default"});return t.ok?await t.text():(console.warn("[reservations/pdf] failed to fetch SVG image",e,t.status),null)}catch(t){return console.warn("[reservations/pdf] error fetching SVG image",e,t),null}}async function Za(e){if(!e)return!1;const t=e.getAttribute?.("src")||"";if(!Zn(t))return!1;const n=await Ja(t);if(!n)return e.dataset.svgRasterization="failed",e.setAttribute("src",Ut),!1;const a=await ea(n);return a?(e.dataset.svgOriginalSrc=t,e.setAttribute("src",a),e.setAttribute("data-rasterized","true"),!0):(e.dataset.svgRasterization="failed",e.setAttribute("src",Ut),!1)}async function es(e){if(!e||e.tagName?.toLowerCase()!=="svg")return!1;const n=new XMLSerializer().serializeToString(e),a=Ga(e),s=await ea(n,a),o=(e.ownerDocument||document).createElement("img");o.setAttribute("src",s||Ut),o.setAttribute("alt",e.getAttribute("aria-label")||e.getAttribute("title")||""),o.setAttribute("data-svg-replaced","true"),e.hasAttribute("class")&&o.setAttribute("class",e.getAttribute("class")),e.hasAttribute("style")&&o.setAttribute("style",e.getAttribute("style"));const l=e.getAttribute("width"),p=e.getAttribute("height");return l&&o.setAttribute("width",l),p&&o.setAttribute("height",p),e.parentNode?.replaceChild(o,e),!!s}async function ta(e){if(!e)return;const t=Array.from(e.querySelectorAll?.("img")||[]),n=Array.from(e.querySelectorAll?.("svg")||[]),a=[];t.forEach(s=>{Zn(s.getAttribute?.("src"))&&a.push(Za(s))}),n.forEach(s=>{a.push(es(s))}),a.length&&await Promise.allSettled(a)}function ts(e,{pixelRatio:t=1}={}){if(!e)return null;const n=e.ownerDocument||document,s=(n.defaultView||window).getComputedStyle?.(e);if(!s)return null;const u=($,J=0)=>{const G=parseFloat($);return Number.isFinite(G)?G:J},o=u(s.paddingTop),l=u(s.paddingBottom),p=u(s.paddingRight),y=u(s.paddingLeft),b=u(s.borderRadius),N=u(s.fontSize,14),S=(()=>{const $=s.lineHeight;if(!$||$==="normal")return N*1.6;const J=u($,N*1.6);return J>0?J:N*1.6})(),w=Math.max(e.clientWidth||0,e.scrollWidth||0,u(s.width,0));if(w<=0)return null;const v=Math.max(1,w-y-p),j=e.textContent||"",q=j.split(/\r?\n/),E=n.createElement("canvas"),_=E.getContext("2d");if(!_)return null;const M=s.fontStyle||"normal",V=s.fontVariant||"normal",ae=s.fontWeight||"400",m=s.fontFamily||"sans-serif",g=s.fontStretch||"normal",k=$=>$.join(" "),R=[],z=$=>_.measureText($).width;_.font=`${M} ${V} ${ae} ${g} ${N}px ${m}`,q.forEach($=>{const J=$.trim();if(J.length===0){R.push("");return}const G=J.split(/\s+/);let ue=[];G.forEach((Ne,xe)=>{const be=Ne.trim();if(!be)return;const Oe=k(ue.concat(be));if(z(Oe)<=v||ue.length===0){ue.push(be);return}R.push(k(ue)),ue=[be]}),ue.length&&R.push(k(ue))}),R.length||R.push("");const T=o+l+R.length*S,se=Math.ceil(Math.max(1,w)*t),P=Math.ceil(Math.max(1,T)*t);E.width=se,E.height=P,E.style.width=`${Math.max(1,w)}px`,E.style.height=`${Math.max(1,T)}px`,_.scale(t,t);const ne=s.backgroundColor&&s.backgroundColor!=="rgba(0, 0, 0, 0)"?s.backgroundColor:"#ffffff";if(b>0){_.save(),_.beginPath();const $=Math.max(1,w),J=Math.max(1,T),G=Math.min(b,$/2,J/2);_.moveTo(G,0),_.lineTo($-G,0),_.quadraticCurveTo($,0,$,G),_.lineTo($,J-G),_.quadraticCurveTo($,J,$-G,J),_.lineTo(G,J),_.quadraticCurveTo(0,J,0,J-G),_.lineTo(0,G),_.quadraticCurveTo(0,0,G,0),_.closePath(),_.clip()}if(_.fillStyle=ne,_.fillRect(0,0,Math.max(1,w),Math.max(1,T)),_.font=`${M} ${V} ${ae} ${g} ${N}px ${m}`,_.fillStyle=s.color||"#000000",_.textBaseline="top",_.textAlign="right","direction"in _)try{_.direction="rtl"}catch{}const ee=Math.max(0,w-p);let B=o;R.forEach($=>{const J=$.length?$:" ";_.fillText(J,ee,B,v),B+=S});const W=n.createElement("img");let pe;try{pe=E.toDataURL("image/png")}catch($){return Be("note canvas toDataURL failed",$),null}return W.src=pe,W.alt=j,W.style.width=`${Math.max(1,w)}px`,W.style.height=`${Math.max(1,T)}px`,W.style.display="block",W.setAttribute("data-quote-note-image","true"),{image:W,canvas:E,totalHeight:T,width:w}}function ns(e,{pixelRatio:t=1}={}){if(!e||!Rt())return;Array.from(e.querySelectorAll?.(".quote-notes")||[]).forEach(a=>{if(!a||a.dataset.quoteNoteRasterized==="true"||!Jn(a.textContent||""))return;let s;try{s=ts(a,{pixelRatio:t})}catch(u){Be("failed to rasterize note content",u),s=null}s&&(a.dataset.quoteNoteRasterized="true",a.innerHTML="",a.appendChild(s.image))})}function Gt(e,t="export",{toastMessage:n,suppressToast:a=!1}={}){Ua(`${t} failed`,e);const s=!!(e&&e.__artRatioPdfNotified);if(!a&&!s){const u=r("reservations.quote.errors.exportFailed","âš ï¸ ØªØ¹Ø°Ø± Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù PDFØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰."),o=n||u,l=r("reservations.quote.toast.viewGuide","ðŸ“˜ Ø¹Ø±Ø¶ Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø­Ù„ Ø§Ù„Ø³Ø±ÙŠØ¹"),p=r("reservations.quote.toast.retry","Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©"),y=["exportQuoteAsPdf","renderQuotePreview","layoutQuoteDocument","pageCapture"].includes(t),b=()=>{t==="exportQuoteAsPdf"?(Je("export"),ua()):(Je("render"),ft=!1,Ae())};if(xn({message:o,duration:9e3,actionLabel:y?p:void 0,onAction:y?b:void 0,linkLabel:l,linkHref:Fn}),A?.modal?.classList.contains("show")&&Je("error",{message:o,actionLabel:y?p:void 0,onAction:y?b:void 0,showSpinner:!1}),e&&typeof e=="object")try{Object.defineProperty(e,"__artRatioPdfNotified",{value:!0,writable:!1,enumerable:!1,configurable:!0})}catch{}}}function Yt({container:e,safariWindowRef:t,mobileWindowRef:n}={}){try{n&&!n.closed&&n.close()}catch(a){Be("failed to close mobile window",a)}try{t&&!t.closed&&t.close()}catch(a){Be("failed to close safari window",a)}e&&e.parentNode&&e.parentNode.removeChild(e)}function on(e){return new Promise((t,n)=>{const a=document.querySelector(`script[src="${e}"]`);if(a){a.addEventListener("load",()=>t()),a.addEventListener("error",u=>n(u)),a.readyState==="complete"&&t();return}const s=document.createElement("script");s.src=e,s.async=!0,s.onload=()=>t(),s.onerror=u=>n(u),document.head.appendChild(s)})}function qn(){const e=[window.jspdf?.jsPDF,typeof window.jspdf=="function"?window.jspdf:null,window.jsPDF?.jsPDF,typeof window.jsPDF=="function"?window.jsPDF:null].filter(t=>typeof t=="function");return e.length?e[0]:null}function Sn(){return typeof window.html2canvas=="function"?window.html2canvas:null}async function as(){const e=Sn();return e||(pt||(pt=on(Pa).catch(t=>{throw pt=null,t}).then(()=>{const t=Sn();if(!t)throw pt=null,new Error("ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© html2canvas Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.");return t})),pt)}async function ss(){const e=qn();return e||(dt||(dt=on(Ia).catch(t=>{throw dt=null,t}).then(()=>{const t=qn();if(!t)throw dt=null,new Error("ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© jsPDF Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.");return t})),dt)}async function os(){if(window.html2pdf||await on(Ca),window.html2pdf&&!window.html2pdf.__artRatioConfigured){const e=window.html2pdf.defaultOptions||window.html2pdf.defaultOpt||{},t={...e.html2canvas||{}};t.useCORS=!0,t.allowTaint=!1,t.logging=!0;const n={unit:"mm",format:"a4",orientation:"portrait",compress:!0,...e.jsPDF||{}},a={image:{type:"jpeg",quality:.95,...e.image||{}},margin:e.margin??[0,0,0,0],filename:e.filename||"document.pdf",html2canvas:t,jsPDF:n};window.html2pdf.defaultOptions=a,window.html2pdf.defaultOpt=a,window.html2pdf.__artRatioConfigured=!0}Sa(),Wa()}function i(e=""){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function rs(e="reservation"){return e==="project"?"QP":"Q"}function Nt(e,t="reservation"){const n=Number(e),a=rs(t);return!Number.isFinite(n)||n<=0?`${a}-0001`:`${a}-${String(n).padStart(4,"0")}`}function na(e="reservation"){return e==="project"?"quote_project":"quote_reservation"}async function is(e="reservation"){const t=na(e);try{const n=await Jt(`/sequence/?name=${encodeURIComponent(t)}`,{method:"POST"}),a=Number(n?.value),s=Number.isFinite(a)&&a>0?a:1;return{sequence:s,quoteNumber:Nt(s,e)}}catch(n){console.warn("âš ï¸ [reservations/pdf] sequence reservation failed, falling back to local",n);const a=window.localStorage?.getItem?.(Dn),u=(Number.isFinite(parseInt(a??"",10))?parseInt(a??"",10):0)+1;return{sequence:u,quoteNumber:Nt(u,e)}}}async function ls(e="reservation"){const t=na(e);try{const n=await Jt(`/sequence/?name=${encodeURIComponent(t)}`,{method:"GET"}),a=Number(n?.value),s=Number.isFinite(a)&&a>=0?a+1:1;return{sequence:s,quoteNumber:Nt(s,e)}}catch(n){return console.warn("âš ï¸ [reservations/pdf] sequence peek failed, falling back to 1",n),{sequence:1,quoteNumber:Nt(1,e)}}}function aa(e="reservation"){return vn[e]||vn.reservation}function cs(){try{window.localStorage?.removeItem?.(Dn)}catch{}}function us(e="reservation"){try{cs();const t=aa(e),n=window.localStorage?.getItem?.(t);if(!n)return null;const a=JSON.parse(n);return a&&typeof a=="object"?a:null}catch(t){return console.warn("âš ï¸ [reservations/pdf] failed to read toggle preferences",t),null}}function ds(e,t="reservation"){try{const n=aa(t);if(!e){window.localStorage?.removeItem?.(n);return}window.localStorage?.setItem?.(n,JSON.stringify(e))}catch(n){console.warn("âš ï¸ [reservations/pdf] failed to persist toggle preferences",n)}}function ps(e){if(!e)return{ids:null,emptyExplicitly:!1};if(e instanceof Set)return{ids:Array.from(e),emptyExplicitly:e.size===0};if(Array.isArray(e))return{ids:e.slice(),emptyExplicitly:e.length===0};if(typeof e=="object"){const t=Object.entries(e).filter(([,n])=>!!n);return{ids:t.map(([n])=>n),emptyExplicitly:t.length===0}}return{ids:null,emptyExplicitly:!1}}function ms(e,t="reservation"){if(!e)return null;const n=Bn(t),a=On(t),s=Array.from(e.sections instanceof Set?e.sections:new Set(e.sections||[])).filter(l=>n.has(l)),u={},o=e.fields||{};return Object.entries(a).forEach(([l,p])=>{const y=o[l];if(y==null)return;const{ids:b,emptyExplicitly:N}=ps(y);if(!b&&!N)return;const S=Array.isArray(b)?b.filter(w=>p.has(w)):[];(S.length>0||N)&&(u[l]=S)}),{version:1,sections:s,fields:u}}function sa(e){if(!e)return;const t=e.context||"reservation",n=ms(e,t);n&&ds(n,t)}function rn(e){if(!e)return;const t=e.context||"reservation",n=us(t);if(!n)return;const a=Bn(t),s=Array.isArray(n.sections)?n.sections.filter(u=>a.has(u)):[];if(s.length&&(e.sections=new Set(s)),n.fields&&typeof n.fields=="object"){const u=tn(e.fields||vt(t)),o=On(t);Object.entries(n.fields).forEach(([l,p])=>{const y=o[l];if(!y)return;const b=Array.isArray(p)?p.filter(N=>y.has(N)):[];u[l]=new Set(b)}),e.fields=u}}function ln(e=new Date){try{return e.toLocaleDateString("en-GB",{year:"numeric",month:"2-digit",day:"2-digit"})}catch{return e.toISOString().slice(0,10)}}function Bt(e){const t=ga()||[],{technicians:n=[]}=Xt(),a=[].concat(Array.isArray(t)?t:[]).concat(Array.isArray(n)?n:[]),s=new Map;return a.forEach(o=>{if(!o||o.id==null)return;const l=String(o.id),p=s.get(l)||{};s.set(l,{...p,...o})}),(Array.isArray(e.crewAssignments)&&e.crewAssignments.length?e.crewAssignments:Array.isArray(e.techniciansDetails)&&e.techniciansDetails.length?e.techniciansDetails:(e.technicians||[]).map(o=>({technicianId:o}))).map((o,l)=>{const p=o?.technicianId!=null?s.get(String(o.technicianId)):null;let y=o.positionLabel??o.position_name??o.position_label??o.role??o.position??p?.role??r("reservations.crew.positionFallback","Ù…Ù†ØµØ¨ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…");(!y||y.trim()==="")&&(y=o.positionLabelAr??o.position_label_ar??o.positionLabelEn??o.position_label_en??o.position_name_ar??o.position_name_en??p?.role??r("reservations.crew.positionFallback","Ù…Ù†ØµØ¨ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…"));try{const S=typeof hn=="function"?hn()||[]:[];let w=null;if(o?.positionId!=null&&(w=S.find(v=>String(v?.id)===String(o.positionId))||null),!w){const v=o.positionKey??o.position_key??o.positionName??o.position_name??o.position??"";if(v&&(w=typeof yn=="function"&&yn(v)||null,!w&&S.length)){const j=String(v).trim().toLowerCase();w=S.find(q=>[q.name,q.labelAr,q.labelEn].filter(Boolean).map(E=>String(E).toLowerCase()).includes(j))||null}}if(w){const v=w.labelAr||w.labelEn||w.name||"";v&&v.trim()&&(y=v)}}catch{}const b=yt(_t(o.positionCost??o.position_cost??o.cost??o.daily_wage??o.dailyWage??p?.dailyWage??p?.wage??0)),N=yt(_t(o.positionClientPrice??o.position_client_price??o.client_price??o.clientPrice??o.daily_total??o.dailyTotal??o.total??p?.dailyTotal??p?.total??p?.total_wage??0));return{assignmentId:o.assignmentId??o.assignment_id??`crew-${l}`,positionId:o.positionId??o.position_id??null,positionLabel:y,positionLabelAlt:o.positionLabelAlt??o.position_label_alt??"",positionCost:b,positionClientPrice:N,technicianId:o.technicianId!=null?String(o.technicianId):p?.id!=null?String(p.id):null,technicianName:o.technicianName??o.technician_name??p?.name??null,technicianRole:o.technicianRole??p?.role??null}})}function cn(e,t,n){const{projectLinked:a}=fa(e,n);Zt(e.start,e.end);const s=e.discount??e.discountValue??0,u=Number(C(String(s)))||0,o=e.discountType??e.discount_type??"percent",l=String(o).toLowerCase()==="amount"?"amount":"percent",p=a?!1:!!(e.applyTax??e.apply_tax??e.taxApplied),y=e.companySharePercent??e.company_share_percent??e.companyShare??e.company_share??null,b=y!=null?_t(y):Number.NaN,S=(e.companyShareEnabled??e.company_share_enabled??e.companyShareApplied??e.company_share_applied)===!0&&Number.isFinite(b)&&b>0?b:null,w=Array.isArray(t)?t.map(V=>V?.technicianId).filter(Boolean):[],v=$n({items:Array.isArray(e.items)?e.items:[],technicianIds:w,crewAssignments:Array.isArray(t)?t:[],discount:u,discountType:l,applyTax:p,start:e.start,end:e.end,companySharePercent:S,groupingSource:e}),j=_t(e.cost??e.total??e.finalTotal),q=Number.isFinite(j),E=a?v.finalTotal:q?yt(j):v.finalTotal,_={equipmentTotal:v.equipmentTotal,crewTotal:v.crewTotal,crewCostTotal:v.crewCostTotal,discountAmount:v.discountAmount,subtotalAfterDiscount:v.subtotalAfterDiscount,taxableAmount:v.taxableAmount,taxAmount:v.taxAmount,finalTotal:E,companySharePercent:v.companySharePercent,companyShareAmount:v.companyShareAmount,netProfit:v.netProfit},M={equipmentTotal:fe(v.equipmentTotal),crewTotal:fe(v.crewTotal),discountAmount:fe(v.discountAmount),subtotalAfterDiscount:fe(v.subtotalAfterDiscount),taxableAmount:fe(v.taxableAmount),taxAmount:fe(v.taxAmount),finalTotal:fe(E),companySharePercent:C((Number.isFinite(v.companySharePercent)?v.companySharePercent:0).toFixed(2)),companyShareAmount:fe(v.companyShareAmount),netProfit:C(v.netProfit.toFixed(2))};return{totals:_,totalsDisplay:M,rentalDays:v.rentalDays}}function lt(e){if(e==null||e==="")return null;const t=Number.parseFloat(C(String(e)));return Number.isFinite(t)?t:null}function oa(e){if(!e)return new Date().toISOString();const t=new Date(e);return Number.isNaN(t.getTime())?new Date().toISOString():t.toISOString()}function fs(e){if(!e||typeof e!="object")return null;const t=e.type??e.payment_type??e.paymentType??null;let n=typeof t=="string"?t.trim().toLowerCase():null;n!=="percent"&&(n="amount");const a=lt(e.amount??(n==="amount"?e.value:null)),s=lt(e.percentage??(n==="percent"?e.value:null)),u=n==="percent"?s??null:a??null,o=e.note??e.memo??null,l=oa(e.recordedAt??e.recorded_at??e.date??e.created_at??null);return n==="amount"&&a==null||n==="percent"&&s==null?null:{type:n,amount:a??null,percentage:s??null,value:u,note:o,recordedAt:l}}function hs(e={}){const n=(Array.isArray(e.paymentHistory)?e.paymentHistory:Array.isArray(e.payment_history)?e.payment_history:[]).map(fs).filter(Boolean);if(n.length>0)return n;const a=lt(e.paidPercent??e.paid_percent),s=lt(e.paidAmount??e.paid_amount),u=e.updatedAt??e.updated_at??e.createdAt??e.created_at??null,o=oa(u);return a!=null&&a>0?[{type:"percent",amount:s!=null&&s>0?s:null,percentage:a,value:a,note:null,recordedAt:o}]:s!=null&&s>0?[{type:"amount",amount:s,percentage:null,value:s,note:null,recordedAt:o}]:[]}function ys(e){if(!e)return r("projects.form.types.unknown","Ù†ÙˆØ¹ ØºÙŠØ± Ù…Ø­Ø¯Ø¯");const t={commercial:"projects.form.types.commercial",coverage:"projects.form.types.coverage",photography:"projects.form.types.photography",social:"projects.form.types.social"}[e]||"projects.form.types.unknown";return r(t,e)}function bs(e){const t=new Date,n=e?.start?new Date(e.start):null,a=e?.end?new Date(e.end):null;return n&&!Number.isNaN(n.getTime())&&n>t?"upcoming":a&&!Number.isNaN(a.getTime())&&a<t?"completed":"ongoing"}function vs(e){if(Array.isArray(e?.expenses)&&e.expenses.some(a=>Number.isFinite(Number(a?.salePrice??a?.sale_price))))return e.expenses.reduce((a,s)=>a+(Number(s?.salePrice??s?.sale_price)||0),0);const t=Number(e?.servicesClientPrice??e?.services_client_price);return Number.isFinite(t)&&t>=0?t:typeof e?.expensesTotal=="number"?e.expensesTotal:Array.isArray(e?.expenses)?e.expenses.reduce((n,a)=>n+(Number(a?.amount)||0),0):0}function gs(e){if(!e)return 0;const t=Array.isArray(e.items)?e.items:[],n=e.discount??0,a=Number(C(String(n)))||0,s=e.discountType||"percent",u=Array.isArray(e.crewAssignments)?e.crewAssignments:[],o=u.length?u:Array.isArray(e.technicians)?e.technicians:[],l=va(t,a,s,!1,o,{start:e.start,end:e.end,companySharePercent:0});if(Number.isFinite(l))return l;const p=Number(C(String(e.cost??0)));return Number.isFinite(p)?Math.round(p):0}function ws(e,t){if(!e)return"â€”";const n=it(e);return t?`${n} - ${it(t)}`:n}function X(e,t="SR",n=2){const a=Number(e);return`${fe(a)} ${t}`}function An(e,t=2){if(!Number.isFinite(Number(e)))return"0%";const n=Number.isInteger(t)?t:2;return`${C(Number(e).toFixed(n))}%`}function qs(e){if(!e?.start)return null;if(!e?.end)return 1;const t=Zt(e.start,e.end);return Number.isFinite(t)?t:1}function Ss(e){return Number.isFinite(e)?e<=1?"ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯":`${C(String(Math.round(e)))} Ø£ÙŠØ§Ù…`:"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}function kn(e){const t=r("reservations.create.summary.currency","SR"),n=Xt()||{},a=Array.isArray(n.customers)?n.customers:[],s=Array.isArray(n.projects)?n.projects:[],u=Array.isArray(n.technicians)?n.technicians:[];let o=[];try{const h=jn?.()||[];o=Array.isArray(h)&&h.length?h:n.reservations||[]}catch{o=n.reservations||[]}const l=e?.id!=null?s.find(h=>String(h.id)===String(e.id))||e:e||null,p={projectStatusLabel:r("projects.status.ongoing","Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°"),paymentStatusLabel:r("projects.paymentStatus.unpaid","ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹")};if(!l)return{project:null,customer:null,clientInfo:{name:"-",company:"-",phone:"-",email:"-"},projectInfo:{title:"-",code:"-",typeLabel:"-",startDisplay:"-",endDisplay:"-",durationLabel:"-",statusLabel:p.projectStatusLabel},expenses:[],equipment:[],reservations:[],totals:{equipmentEstimate:0,expensesTotal:0,baseSubtotal:0,discountAmount:0,subtotalAfterDiscount:0,companyShareAmount:0,subtotal:0,applyTax:!1,taxAmount:0,totalWithTax:0},totalsDisplay:{projectSubtotal:X(0,t),expensesTotal:X(0,t),reservationsTotal:X(0,t),discountAmount:X(0,t),taxAmount:X(0,t),overallTotal:X(0,t),paidAmount:X(0,t),remainingAmount:X(0,t)},projectTotals:{combinedTaxAmount:0,overallTotal:0,reservationsTotal:0,paidAmount:0,paidPercent:0,remainingAmount:0,paymentStatus:"unpaid"},paymentSummary:{status:"unpaid",statusLabel:p.paymentStatusLabel,paidAmount:0,paidPercent:0,remainingAmount:0,paidAmountDisplay:X(0,t),remainingAmountDisplay:X(0,t),paidPercentDisplay:An(0)},notes:"",currencyLabel:t,projectStatus:"ongoing",projectStatusLabel:p.projectStatusLabel,projectDurationDays:null,projectDurationLabel:"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",paymentHistory:[]};const y=l.clientId??l.customerId??l.client_id??l.customer_id??null,b=y!=null&&a.find(h=>String(h.id)===String(y))||null,N=b?.customerName??b?.name??l.clientName??l.customerName??r("projects.fallback.unknownClient","Ø¹Ù…ÙŠÙ„ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"),S=(l.clientCompany||b?.companyName||b?.company||"").trim(),w=b?.phone??b?.customerPhone??l.clientPhone??l.customerPhone??"",v=w?C(String(w).trim()):r("projects.details.client.noPhone","Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù‚Ù… Ù…ØªØ§Ø­"),j=b?.email??l.clientEmail??l.customerEmail??"",q=j?String(j).trim():r("projects.details.client.noEmail","Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨Ø±ÙŠØ¯ Ù…ØªØ§Ø­"),E=l.projectCode||`PRJ-${C(String(l.id??""))}`,_=C(String(E)),M=(l.title||"").trim()||r("projects.fallback.untitled","Ù…Ø´Ø±ÙˆØ¹ Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†"),V=ys(l.type),ae=l.start?it(l.start):"â€”",m=l.end?it(l.end):"â€”",g=qs(l),k=g!=null?Ss(g):"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",R=bs(l),z={upcoming:"Ù‚Ø§Ø¯Ù…",ongoing:"Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°",completed:"Ù…ÙƒØªÙ…Ù„"},T=r(`projects.status.${R}`,z[R]||R),se=l.id!=null?String(l.id):null,P=se?o.filter(h=>{const Y=h?.projectId??h?.project_id??null;return Y!=null&&String(Y)===se}):[];P.map(h=>{const Y=h.reservationId||h.id||"",x=h.status||h.state||"pending",ie=String(x).toLowerCase(),te=r(`reservations.status.${ie}`,ie),me=gs(h),Se=h.start?new Date(h.start).getTime():0;return{reservationId:C(String(Y||"-")),status:ie,statusLabel:te,total:me,totalLabel:X(me,t),dateRange:ws(h.start,h.end),startTimestamp:Number.isNaN(Se)?0:Se}}).sort((h,Y)=>Y.startTimestamp-h.startTimestamp).map(({startTimestamp:h,...Y})=>Y);let ne=0,ee=0;try{P.forEach(h=>{const Y=$n({items:Array.isArray(h.items)?h.items:[],technicianIds:Array.isArray(h.technicians)?h.technicians:[],crewAssignments:Array.isArray(h.crewAssignments)?h.crewAssignments:[],discount:Number(h.discount??0)||0,discountType:h.discountType||"percent",applyTax:!1,start:h.start,end:h.end,groupingSource:h,companySharePercent:0});ne+=Number(Y.equipmentTotal||0),ee+=Number(Y.crewTotal||0)})}catch{}const B=vs(l),W=Number(ne+ee+B),pe=[];try{P.forEach(h=>{const{groups:Y}=Tn(h);Y.forEach(x=>{const ie=Number(x?.count??x?.quantity??1)||1,te=Number(x?.unitPrice);let me=Number.isFinite(te)?te:0;if(!me||me<=0){const ve=Number(x?.totalPrice);Number.isFinite(ve)&&ie>0&&(me=Number((ve/ie).toFixed(2)))}Number.isFinite(me)||(me=0);const Se=x?.type==="package"||Array.isArray(x?.items)&&x.items.some(ve=>ve?.type==="package"),De=Array.isArray(x?.barcodes)&&x.barcodes.length?x.barcodes[0]:Array.isArray(x?.items)&&x.items.length?x.items[0]?.barcode:null;let we=x?.packageDisplayCode??x?.package_code??x?.code??x?.packageCode??(Array.isArray(x?.items)&&x.items.length?x.items[0]?.package_code??x.items[0]?.code??x.items[0]?.packageCode:null);const Ge=ve=>{const d=(ve==null?"":String(ve)).trim();return!!(!d||/^pkg-/i.test(d)||/^\d+$/.test(d)&&d.length<=4)};if(!we||Ge(we)){const ve=x?.packageId??x?.package_id??(Array.isArray(x?.items)&&x.items.length?x.items[0]?.packageId??x.items[0]?.package_id:null);if(ve)try{const d=En(ve);d&&d.package_code&&(we=d.package_code)}catch{}}if(!we||Ge(we))try{const ve=rt(x?.description||"");if(ve){const d=Nn();let D=d.find(O=>rt(O?.name||O?.title||O?.label||"")===ve);D||(D=d.find(O=>{const le=rt(O?.name||O?.title||O?.label||"");return le.includes(ve)||ve.includes(le)})),D&&D.package_code&&(we=D.package_code)}}catch{}const at=Se?we??De??"":x?.barcode??De??"",st=at!=null?String(at):"",Ot=Number.isFinite(Number(x?.totalPrice))?Number(x.totalPrice):Number((me*ie).toFixed(2));pe.push({...x,isPackage:Se,desc:x?.description,barcode:st,packageCodeResolved:we||"",qty:ie,price:me,totalPrice:yt(Ot),unitPriceValue:me})})})}catch{}const $=new Map;P.forEach(h=>{const Y=Array.isArray(h.items)?h.items:[],x=Zt(h.start,h.end),ie=h.reservationId||h.id||"";Y.forEach((te,me)=>{if(!te)return;const Se=te.barcode||te.code||te.id||te.desc||te.description||`item-${me}`,De=String(Se||`item-${me}`),we=$.get(De)||{description:te.desc||te.description||te.name||te.barcode||`#${C(String(me+1))}`,totalQuantity:0,reservationsCount:0,reservationIds:new Set,totalCost:0},Ge=Number(te.qty)||1,at=Number(te.price)||0;we.totalQuantity+=Ge,we.reservationIds.add(String(ie));const st=at*Ge*Math.max(1,x);Number.isFinite(st)&&(we.totalCost+=st),$.set(De,we)})});const J=Array.from($.values()).map(h=>({description:h.description,totalQuantity:h.totalQuantity,reservationsCount:h.reservationIds.size,displayCost:X(h.totalCost,t)})),G=new Map((u||[]).filter(Boolean).map(h=>[String(h.id),h])),ue=new Map,Ne=h=>{if(!h)return;let Y=null;typeof h=="object"?Y=h.id??h.technicianId??h.technician_id??h.userId??h.user_id??null:(typeof h=="string"||typeof h=="number")&&(Y=h);const x=Y!=null?String(Y):null,ie=x&&G.has(x)?G.get(x):typeof h=="object"?h:null,te=ie?.name||ie?.full_name||ie?.fullName||ie?.displayName||(typeof h=="string"?h:null),me=ie?.role||ie?.title||null,Se=ie?.phone||ie?.mobile||ie?.contact||null;if(!te&&!x)return;const De=x||te;ue.has(De)||ue.set(De,{id:x,name:te||"-",role:me||null,phone:Se||null})};Array.isArray(l?.technicians)&&l.technicians.forEach(h=>Ne(h)),P.forEach(h=>{(Array.isArray(h.crewAssignments)&&h.crewAssignments.length?h.crewAssignments:Array.isArray(h.technicians)?h.technicians.map(x=>({technicianId:x})):[]).forEach(x=>Ne(x))});const xe=Array.from(ue.values()),be=Array.isArray(l.expenses)?l.expenses.map(h=>{const Y=Number(h?.salePrice??h?.sale_price??h?.amount)||0;return{label:h?.label||h?.name||"-",amount:Y,displayAmount:X(Y,t),note:h?.note||h?.description||""}}):[],Oe=l?.applyTax===!0||l?.applyTax==="true",Ie=Number.parseFloat(l?.discount??l?.discountValue??0)||0;let qe=(l?.discountType==="amount"?"amount":"percent")==="amount"?Ie:W*(Ie/100);(!Number.isFinite(qe)||qe<0)&&(qe=0),qe>W&&(qe=W);const $e=Math.max(0,W-qe),Ze=l?.companyShareEnabled===!0||l?.company_share_enabled===!0||l?.companyShareApplied===!0||l?.company_share_applied===!0,et=Number.parseFloat(l?.companySharePercent??l?.company_share_percent??l?.companyShare??l?.company_share??0)||0,Ke=Ze&&et>0?et:0,He=Ke>0?Number(($e*(Ke/100)).toFixed(2)):0,ge=Number(($e+He).toFixed(2)),Le=Oe?Number((ge*wa).toFixed(2)):0,Te=Number((ge+Le).toFixed(2)),Qe=hs(l),tt=lt(l.paidAmount??l.paid_amount)||0,nt=lt(l.paidPercent??l.paid_percent)||0,Ue=ya({totalAmount:Te,paidAmount:tt,paidPercent:nt,history:Qe}),f=typeof l.paymentStatus=="string"?l.paymentStatus.toLowerCase():"",I=ba({manualStatus:f,paidAmount:Ue.paidAmount,paidPercent:Ue.paidPercent,totalAmount:Te}),K={paid:"Ù…Ø¯ÙÙˆØ¹",partial:"Ù…Ø¯ÙÙˆØ¹ Ø¬Ø²Ø¦ÙŠØ§Ù‹",unpaid:"ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹"},Z=r(`projects.paymentStatus.${I}`,K[I]||I),Q=Number(Ue.paidAmount||0),F=Number(Ue.paidPercent||0),H=Math.max(0,Number((Te-Q).toFixed(2))),de={projectSubtotal:X(ge,t),expensesTotal:X(B,t),reservationsTotal:X(ge,t),discountAmount:X(qe,t),taxAmount:X(Le,t),overallTotal:X(Te,t),paidAmount:X(Q,t),remainingAmount:X(H,t)},je={status:I,statusLabel:Z,paidAmount:Q,paidPercent:F,remainingAmount:H,paidAmountDisplay:X(Q,t),remainingAmountDisplay:X(H,t),paidPercentDisplay:An(F)},ze=(l.description||"").trim();return{project:l,customer:b,clientInfo:{name:N,company:S||"â€”",phone:v,email:q},projectInfo:{title:M,code:_,typeLabel:V,startDisplay:ae,endDisplay:m,durationLabel:k,statusLabel:T},expenses:be,equipment:J,crew:xe,equipmentItems:pe,crewAssignments:P.flatMap(h=>Bt(h)),totals:{equipmentEstimate:ne,expensesTotal:B,baseSubtotal:W,discountAmount:qe,subtotalAfterDiscount:$e,companyShareAmount:He,subtotal:ge,applyTax:Oe,taxAmount:Le,totalWithTax:Te},totalsDisplay:de,projectTotals:{combinedTaxAmount:Le,overallTotal:Te,reservationsTotal:ge,paidAmount:Q,paidPercent:F,remainingAmount:H,paymentStatus:I},paymentSummary:je,notes:ze,currencyLabel:t,projectStatus:R,projectStatusLabel:T,projectDurationDays:g,projectDurationLabel:k,paymentHistory:Qe}}function As({project:e,clientInfo:t={},projectInfo:n={},projectCrew:a=[],projectExpenses:s=[],projectEquipment:u=[],totalsDisplay:o={},projectTotals:l={},paymentSummary:p={},currencyLabel:y="SR",sections:b,fieldSelections:N={},quoteNumber:S,quoteDate:w,terms:v=_e}){const j=tn(N),q=(f,I)=>nn(j,f,I),E=f=>b?.has?.(f),_=`<div class="quote-placeholder">${i(r("reservations.quote.placeholder.noFields","Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù„Ù„Ø¹Ø±Ø¶ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…."))}</div>`,M=(f,I)=>`<div class="info-plain__item">
      <span class="info-plain__label">${i(f)}</span>
      <span class="info-plain__separator">:</span>
      <span class="info-plain__value">${i(I)}</span>
    </div>`,V=(f,I,{variant:K="inline"}={})=>K==="final"?`<div class="totals-item totals-item--final">
        <span class="totals-item__label">${i(f)}</span>
        <span class="totals-item__slash">/</span>
        <span class="totals-item__value">${i(I)}</span>
      </div>`:`<span class="totals-inline__item">
      <span class="totals-inline__label">${i(f)}</span>
      <span class="totals-inline__slash">/</span>
      <span class="totals-inline__value">${i(I)}</span>
    </span>`,ae=(f,I)=>`<div class="payment-row">
      <span class="payment-row__label">${i(f)}</span>
      <span class="payment-row__slash">/</span>
      <span class="payment-row__value">${i(I)}</span>
    </div>`,m=[];q("customerInfo","customerName")&&m.push(M(r("projects.details.client","Ø§Ù„Ø¹Ù…ÙŠÙ„"),t.name||"-")),q("customerInfo","customerCompany")&&m.push(M(r("projects.details.company","Ø´Ø±ÙƒØ© Ø§Ù„Ø¹Ù…ÙŠÙ„"),t.company||"â€”")),q("customerInfo","customerPhone")&&m.push(M(r("projects.details.labels.clientPhone","Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„"),t.phone||"-")),q("customerInfo","customerEmail")&&m.push(M(r("projects.details.labels.clientEmail","Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"),t.email||"-"));const g=E("customerInfo")?`<section class="quote-section quote-section--plain quote-section--customer">
        <h3 class="quote-section__title">${i(r("projects.quote.sections.customer","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„"))}</h3>
        ${m.length?`<div class="info-plain">${m.join("")}</div>`:_}
      </section>`:"",k=[];q("projectInfo","projectType")&&k.push(M(r("projects.details.type","Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.typeLabel||"-")),q("projectInfo","projectTitle")&&k.push(M(r("projects.details.projectTitle","Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.title||"-")),q("projectInfo","projectCode")&&k.push(M(r("projects.details.labels.code","Ø±Ù‚Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.code||"-")),q("projectInfo","projectStart")&&k.push(M(r("projects.details.start","Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.startDisplay||"-")),q("projectInfo","projectEnd")&&k.push(M(r("projects.details.end","Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.endDisplay||"-")),q("projectInfo","projectDuration")&&k.push(M(r("projects.details.duration","Ù…Ø¯Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.durationLabel||"-")),q("projectInfo","projectStatus")&&k.push(M(r("projects.details.status","Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.statusLabel||"-"));const R=E("projectInfo")?`<section class="quote-section quote-section--plain quote-section--project">
        <h3 class="quote-section__title">${i(r("projects.quote.sections.project","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"))}</h3>
        ${k.length?`<div class="info-plain">${k.join("")}</div>`:_}
      </section>`:"",z=Lt.filter(f=>q("projectCrew",f.id)),T=Array.isArray(c?.crewAssignments)?c.crewAssignments:[],se=f=>{const I=f&&f.positionId!=null?`id:${String(f.positionId)}`:(()=>{const Q=(f?.positionLabel||f?.position_name||f?.position||"").trim().toLowerCase();return Q?`label:${Q}`:""})(),K=Number.isFinite(Number(f?.positionClientPrice))?Number(f.positionClientPrice):0,Z=K>0?`|p:${K.toFixed(2)}`:"";return`${I}${Z}`};(()=>{const f=new Map;return T.forEach(I=>{const K=se(I);K&&f.set(K,(f.get(K)||0)+1)}),f})();const P=(()=>{const f=[];if(z.forEach(F=>{F.id==="position"?(f.push({...F,render:H=>{const de=typeof re=="function"?re():"ar",je=H?.positionLabelEn??H?.position_label_en??H?.position_name_en??H?.positionLabelAlt??H?.position_label_alt??H?.role,ze=H?.positionLabel??H?.position_name??H?.role??r("reservations.crew.positionFallback","Ù…Ù†ØµØ¨ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…");return i(C(String(de==="en"&&je?je:ze)))}}),q("projectCrew","quantity")&&f.push({id:"quantity",labelKey:"reservations.details.table.headers.quantity",fallback:"Ø§Ù„ÙƒÙ…ÙŠØ©",render:H=>i(C(String(Math.max(1,Number(H?.__count||1)))))})):F.id==="price"?f.push({...F,render:H=>{const de=Number.isFinite(Number(H?.positionClientPrice))?Number(H.positionClientPrice):0,je=Math.max(1,Number(H?.__count||1)),ze=Math.max(1,Number(c?.rentalDays||1)),Ce=de*je*ze;return i(`${fe(Ce)} ${r("reservations.create.summary.currency","SR")}`)}}):F.id==="unitPrice"?f.push({...F,render:H=>{const de=Number.isFinite(Number(H?.positionClientPrice))?Number(H.positionClientPrice):0;return i(`${fe(de)} ${r("reservations.create.summary.currency","SR")}`)}}):f.push(F)}),q("projectCrew","days")){const F=Math.max(1,Number(c?.rentalDays||1)),H=f.findIndex(je=>je.id==="price"),de=Math.max(0,H);f.splice(de,0,{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…",render:()=>i(C(String(F)))})}const I=new Map(f.map(F=>[F.id,F])),K=new Set,Z=[],Q=F=>{const H=I.get(F);H&&!K.has(F)&&(Z.push(H),K.add(F))};return Q("rowNumber"),Q("position"),Q("unitPrice"),Q("quantity"),Q("days"),Q("price"),f.forEach(F=>{K.has(F.id)||(Z.push(F),K.add(F.id))}),Z})(),ne=(()=>{const f=new Map;return T.forEach(I=>{const K=se(I);if(!K)return;const Z=f.get(K);Z?Z.__count+=1:f.set(K,{...I,__count:1})}),Array.from(f.values())})(),ee=(()=>{try{const f=Math.max(1,Number(c?.rentalDays||1)),I=(ne||[]).reduce((K,Z)=>{const Q=Number.isFinite(Number(Z?.positionClientPrice))?Number(Z.positionClientPrice):0,F=Math.max(1,Number(Z?.__count||1));return K+Q*F*f},0);return fe(I)}catch{return"0.00"}})(),B=E("projectCrew")?P.length?`<section class="quote-section quote-section--table">
            <h3>${i(r("projects.quote.sections.crew","Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„"))}</h3>
            <table class="quote-table">
              <thead>
                <tr>${P.map(f=>`<th>${i(f.labelKey?r(f.labelKey,f.fallback):f.fallback)}</th>`).join("")}</tr>
              </thead>
              <tbody>${ne.length?ne.map((f,I)=>`<tr>${P.map(K=>`<td><div class="quote-cell">${K.render(f,I)}</div></td>`).join("")}</tr>`).join(""):`<tr><td colspan="${Math.max(P.length,1)}" class="empty">${i(r("projects.details.crew.empty","Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ø§Ù‚Ù… ÙÙ†ÙŠ Ù…Ø±ØªØ¨Ø·."))}</td></tr>`}
              </tbody>
            </table>
            ${q("projectCrew","crewSubtotal")?`
              <div class="quote-table-subtotal">
                <span class="quote-table-subtotal__pill">
                  <span class="quote-table-subtotal__label">${i(r("reservations.details.labels.crewTotal","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±ÙŠÙ‚"))}</span>
                  <span class="quote-table-subtotal__value">${i(`${ee} ${y}`)}</span>
                </span>
              </div>
            `:""}
          </section>`:`<section class="quote-section quote-section--table">
            <h3>${i(r("projects.quote.sections.crew","Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„"))}</h3>
            ${_}
          </section>`:"",W=[];q("financialSummary","discountAmount")&&W.push(V(r("reservations.details.labels.discount","Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ…"),o.discountAmount||X(0,y)));const pe=r("projects.details.summary.preTaxTotal","Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©");q("financialSummary","reservationsTotal")&&W.push(V(pe,o.reservationsTotal||X(0,y))),q("financialSummary","taxAmount")&&W.push(V(r("projects.details.summary.combinedTax","Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"),o.taxAmount||X(0,y)));const $=[];q("financialSummary","overallTotal")&&$.push(V(r("projects.details.summary.overallTotal","Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ"),o.overallTotal||X(0,y),{variant:"final"}));const J=E("financialSummary")?!W.length&&!$.length?`<section class="quote-section quote-section--financial">${_}</section>`:`<section class="quote-section quote-section--financial">
          <div class="totals-block">
            <h3>${i(r("projects.quote.sections.financial","Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ"))}</h3>
            ${W.length?`<div class="totals-inline">${W.join("")}</div>`:""}
            ${$.length?`<div class="totals-final">${$.join("")}</div>`:""}
          </div>
        </section>`:"",G=Mn.filter(f=>q("projectExpenses",f.id)),ue=E("projectExpenses")?G.length?`<section class="quote-section quote-section--table">
            <h3>${i(r("projects.quote.sections.expenses","Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©"))}</h3>
            <table class="quote-table">
              <thead>
                <tr>${G.map(f=>`<th>${i(f.labelKey?r(f.labelKey,f.fallback):f.fallback)}</th>`).join("")}</tr>
              </thead>
              <tbody>${s.length?s.map((f,I)=>`<tr>${G.map(K=>`<td><div class="quote-cell">${K.render(f,I)}</div></td>`).join("")}</tr>`).join(""):`<tr><td colspan="${Math.max(G.length,1)}" class="empty">${i(r("projects.details.expenses.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ØªØ·Ù„Ø¨Ø§Øª Ù…Ø³Ø¬Ù„Ø©."))}</td></tr>`}
              </tbody>
            </table>
            ${q("projectExpenses","expensesSubtotal")?`
              <div class="quote-table-subtotal">
                <span class="quote-table-subtotal__pill">
                  <span class="quote-table-subtotal__label">${i(r("projects.details.expensesTotal","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©"))}</span>
                  <span class="quote-table-subtotal__value">${i(o.expensesTotal||X(0,y))}</span>
                </span>
              </div>
            `:""}
          </section>`:`<section class="quote-section quote-section--table">
            <h3>${i(r("projects.quote.sections.expenses","Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©"))}</h3>
            ${_}
          </section>`:"",Ne=It.filter(f=>q("projectEquipment",f.id)),xe=(()=>{let f=[];if(Ne.forEach(Q=>{Q.id==="price"?f.push({...Q,render:F=>{const H=Number.isFinite(Number(F?.unitPriceValue))?Number(F.unitPriceValue):0,de=Number.isFinite(Number(F?.qty))?Math.max(1,Number(F.qty)):1,je=Math.max(1,Number(c?.rentalDays||1)),ze=H*de*je;return i(`${fe(ze)} ${r("reservations.create.summary.currency","SR")}`)}}):Q.id==="unitPrice"?f.push({...Q,render:F=>{const H=Number.isFinite(Number(F?.unitPriceValue))?Number(F.unitPriceValue):0;return i(`${fe(H)} ${r("reservations.create.summary.currency","SR")}`)}}):f.push(Q)}),q("projectEquipment","days")){const Q=Math.max(1,Number(c?.rentalDays||1)),F=f.findIndex(de=>de.id==="price"),H=Math.max(0,F);f.splice(H,0,{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…",render:()=>i(C(String(Q)))})}const I=new Map(f.map(Q=>[Q.id,Q])),K=f.filter(Q=>!["unitPrice","quantity","days","price"].includes(Q.id)),Z=["unitPrice","quantity","days","price"].map(Q=>I.get(Q)).filter(Boolean);return f=[...K,...Z],f})(),be=Array.isArray(c?.equipmentItems)?c.equipmentItems:[],Oe=(()=>{try{const f=Math.max(1,Number(c?.rentalDays||1)),I=(be||[]).reduce((K,Z)=>{const Q=Number.isFinite(Number(Z?.unitPriceValue))?Number(Z.unitPriceValue):0,F=Number.isFinite(Number(Z?.qty))?Math.max(1,Number(Z.qty)):1;return K+Q*F*f},0);return fe(I)}catch{return"0.00"}})(),Ie=E("projectEquipment")?xe.length?`<section class="quote-section quote-section--table">
            <h3>${i(r("projects.quote.sections.equipment","Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</h3>
            <table class="quote-table">
              <thead>
                <tr>${xe.map(f=>`<th>${i(f.labelKey?r(f.labelKey,f.fallback):f.fallback)}</th>`).join("")}</tr>
              </thead>
              <tbody>${be.length?be.map((f,I)=>`<tr>${xe.map(K=>`<td><div class="quote-cell">${K.render(f,I)}</div></td>`).join("")}</tr>`).join(""):`<tr><td colspan="${Math.max(xe.length,1)}" class="empty">${i(r("projects.details.equipment.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø¯Ø§Øª Ù…Ø±ØªØ¨Ø·Ø© Ø­Ø§Ù„ÙŠØ§Ù‹."))}</td></tr>`}
              </tbody>
            </table>
            ${q("projectEquipment","equipmentSubtotal")?`
              <div class="quote-table-subtotal">
                <span class="quote-table-subtotal__pill">
                  <span class="quote-table-subtotal__label">${i(r("reservations.details.labels.equipmentTotal","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</span>
                  <span class="quote-table-subtotal__value">${i(`${Oe} ${y}`)}</span>
                </span>
              </div>
            `:""}
          </section>`:`<section class="quote-section quote-section--table">
            <h3>${i(r("projects.quote.sections.equipment","Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</h3>
            ${_}
          </section>`:"",ct=(e?.description||"").trim()||"",qe=E("projectNotes")?`<section class="quote-section">
        <h3>${i(r("projects.quote.sections.notes","Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"))}</h3>
        <div class="quote-notes">${i(ct||r("projects.fallback.noDescription","Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ Ù„Ù„Ù…Ø´Ø±ÙˆØ¹."))}</div>
      </section>`:"",$e=[];q("payment","beneficiary")&&$e.push(ae(r("reservations.quote.labels.beneficiary","Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙÙŠØ¯"),ye.beneficiaryName)),q("payment","bank")&&$e.push(ae(r("reservations.quote.labels.bank","Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ"),ye.bankName)),q("payment","account")&&$e.push(ae(r("reservations.quote.labels.account","Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨"),C(ye.accountNumber))),q("payment","iban")&&$e.push(ae(r("reservations.quote.labels.iban","Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ¨Ø§Ù†"),C(ye.iban)));const Ze=`<section class="quote-section">
      <div class="payment-block">
        <h3>${i(r("reservations.quote.sections.payment","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹"))}</h3>
        <div class="payment-rows">${$e.length?$e.join(""):_}</div>
      </div>
      <p class="quote-approval-note">${i(ye.approvalNote)}</p>
    </section>`,et=Array.isArray(v)&&v.length?v:_e,Ke=`<footer class="quote-footer">
        <h4>${i(r("reservations.quote.labels.terms","Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø¹Ø§Ù…Ø©"))}</h4>
        <ul>${et.map(f=>`<li>${i(f)}</li>`).join("")}</ul>
      </footer>`,He=[],ge=[];if(R&&ge.push({key:"project",html:R}),g&&ge.push({key:"customer",html:g}),ge.length>1){const f=ge.find(Z=>Z.key==="project"),I=ge.find(Z=>Z.key==="customer"),K=[];f?.html&&K.push(f.html),I?.html&&K.push(I.html),He.push(oe(`<div class="quote-section-row quote-section-row--primary">${K.join("")}</div>`,{blockType:"group"}))}else ge.length===1&&He.push(oe(ge[0].html));const Le=[];B&&Le.push(oe(B,{blockType:"table",extraAttributes:'data-table-id="project-crew"'})),ue&&Le.push(oe(ue,{blockType:"table",extraAttributes:'data-table-id="project-expenses"'})),Ie&&Le.push(oe(Ie,{blockType:"table",extraAttributes:'data-table-id="project-equipment"'}));const Te=[];J&&Te.push(oe(J,{blockType:"summary"})),qe&&Te.push(oe(qe));let Qe=[];if(!isChecklist)Qe=[...E("payment")?[oe(Ze,{blockType:"payment"})]:[],oe(Ke,{blockType:"footer"})];else{const f=String(options?.checklistNotes||"").trim();if(f.length>0){const I=`<section class="quote-section">
        <h3>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</h3>
        <div class="quote-notes">${i(f)}</div>
      </section>`;Qe=[oe(I)]}}const tt=[...Et(He,"projects.quote.placeholder.primary"),...Le,...Et(Te,"projects.quote.placeholder.summary"),...Qe],nt=typeof re=="function"?re():"ar",Ue=`
    <header class="quote-header" data-quote-header-template>
      <div class="quote-header__logo">
        <img class="quote-logo" src="${i(ye.logoUrl)}" alt="${i(ye.companyName)}" crossorigin="anonymous"/>
      </div>
      <div class="quote-header__title">
        <h1>${i(r("projects.quote.title","Ø¹Ø±Ø¶ Ø³Ø¹Ø±"))}</h1>
        <p class="quote-company-name">${i(r("quote.companyName",ye.companyName))}</p>
        <p class="quote-company-cr">${i(r("reservations.quote.labels.cr","Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ"))}: ${i(ye.commercialRegistry)}</p>
        <p class="quote-company-license">${i(r("reservations.quote.labels.mediaLicense","ØªØ±Ø®ÙŠØµ Ø¥Ø¹Ù„Ø§Ù…ÙŠ"))}: 159460</p>
      </div>
      <div class="quote-header__meta">
        <div class="quote-header__meta-item">
          <span>${i(r("reservations.details.labels.reservationId","Ø±Ù‚Ù… Ø§Ù„Ø¹Ø±Ø¶"))}</span>
          <strong>${i(S)}</strong>
        </div>
        <div class="quote-header__meta-item">
          <span>${i(r("projects.quote.labels.date","Ø§Ù„ØªØ§Ø±ÙŠØ®"))}</span>
          <strong>${i(w)}</strong>
        </div>
      </div>
    </header>
  `.trim();return`
    <div id="quotation-pdf-root" dir="rtl" data-lang="${i(nt)}">
      <style>${Qn}${Hn}</style>
      <div class="quote-document" data-quote-document>
        <div class="quote-preview-pages" data-quote-pages></div>
        <div class="quote-content-source" data-quote-source>
          ${Ue}
          ${tt.join("")}
        </div>
      </div>
    </div>
  `}function ra(e){if(e?.context==="project")return As(e);const{reservation:t,customer:n,project:a,crewAssignments:s,totals:u,totalsDisplay:o,rentalDays:l,currencyLabel:p,sections:y,fieldSelections:b={},quoteNumber:N,quoteDate:S,terms:w=_e}=e,v=C(String(t?.reservationId??t?.id??"")),j=typeof re=="function"?re():"ar",q=t.start?C(it(t.start)):"-",E=t.end?C(it(t.end)):"-",_=n?.customerName||n?.full_name||n?.name||"-",M=n?.phone||"-",V=n?.email||"-",ae=n?.company||n?.company_name||"-",m=C(M),g=a?.title||a?.name||r("reservations.details.project.none","ØºÙŠØ± Ù…Ø±ØªØ¨Ø· Ø¨Ù…Ø´Ø±ÙˆØ¹"),k=a?.code||a?.projectCode||"",R=C(String(l)),z=t?.notes||"",T=Array.isArray(w)&&w.length?w:_e,se=tn(b),P=(d,D)=>nn(se,d,D),ne=d=>y?.has?.(d),ee=`<div class="quote-placeholder">${i(r("reservations.quote.placeholder.noFields","Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù„Ù„Ø¹Ø±Ø¶ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…."))}</div>`,B=(d,D)=>{const O=j==="en"?": ":" / ";return`<div class="info-plain__item">${i(d)}<span class="info-plain__slash">${O}</span><strong class="info-plain__value">${i(D)}</strong></div>`},W=(d,D,{variant:O="inline"}={})=>O==="final"?`<div class="totals-item totals-item--final">
        <span class="totals-item__label">${i(d)}</span>
        <span class="totals-item__slash">/</span>
        <span class="totals-item__value">${i(D)}</span>
      </div>`:`<span class="totals-inline__item">
      <span class="totals-inline__label">${i(d)}</span>
      <span class="totals-inline__slash">/</span>
      <span class="totals-inline__value">${i(D)}</span>
    </span>`,pe=(d,D)=>`<div class="payment-row">
      <span class="payment-row__label">${i(d)}</span>
      <span class="payment-row__slash">/</span>
      <span class="payment-row__value">${i(D)}</span>
    </div>`,$=[];P("customerInfo","customerName")&&$.push(B(r("reservations.details.labels.customer","Ø§Ù„Ø¹Ù…ÙŠÙ„"),_)),P("customerInfo","customerCompany")&&$.push(B(r("reservations.details.labels.company","Ø§Ù„Ø´Ø±ÙƒØ©"),ae)),P("customerInfo","customerPhone")&&$.push(B(r("reservations.details.labels.phone","Ø§Ù„Ù‡Ø§ØªÙ"),m)),P("customerInfo","customerEmail")&&$.push(B(r("reservations.details.labels.email","Ø§Ù„Ø¨Ø±ÙŠØ¯"),V));const J=ne("customerInfo")&&$.length?`<section class="quote-section quote-section--plain quote-section--customer">
            <h3 class="quote-section__title">${i(r("reservations.quote.sections.customer","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„"))}</h3>
            <div class="info-plain">${$.join("")}</div>
          </section>`:"",G=[];P("reservationInfo","reservationId")&&G.push(B(r("reservations.details.labels.reservationId","Ø±Ù‚Ù… Ø§Ù„Ø­Ø¬Ø²"),v||"-")),P("reservationInfo","reservationStart")&&G.push(B(r("reservations.details.labels.start","Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø­Ø¬Ø²"),q)),P("reservationInfo","reservationEnd")&&G.push(B(r("reservations.details.labels.end","Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø­Ø¬Ø²"),E)),P("reservationInfo","reservationDuration")&&G.push(B(r("reservations.details.labels.duration","Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…"),R));const ue=ne("reservationInfo")&&G.length?`<section class="quote-section quote-section--plain quote-section--reservation">
            <h3 class="quote-section__title">${i(r("reservations.quote.sections.reservation","ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²"))}</h3>
            <div class="info-plain">${G.join("")}</div>
          </section>`:"",Ne=[];P("projectInfo","projectTitle")&&Ne.push(B(r("reservations.details.labels.project","Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),g)),P("projectInfo","projectCode")&&Ne.push(B(r("reservations.details.labels.code","Ø§Ù„Ø±Ù…Ø²"),k||"-"));const xe=ne("projectInfo")&&Ne.length?`<section class="quote-section quote-section--plain quote-section--project">
            <h3 class="quote-section__title">${i(r("reservations.quote.sections.project","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"))}</h3>
            <div class="info-plain">${Ne.join("")}</div>
          </section>`:"",be=[];P("financialSummary","discountAmount")&&be.push(W(r("reservations.details.labels.discount","Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ…"),`${o.discountAmount} ${p}`)),P("financialSummary","subtotalBeforeTax")&&be.push(W(r("reservations.details.labels.subtotalBeforeTax","Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"),`${o.taxableAmount} ${p}`)),P("financialSummary","taxAmount")&&be.push(W(r("reservations.details.labels.tax","Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"),`${o.taxAmount} ${p}`));const Oe=P("financialSummary","finalTotal"),Ie=[];Oe&&Ie.push(W(r("reservations.details.labels.total","Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ"),`${o.finalTotal} ${p}`,{variant:"final"}));const ct=Ie.length?`<div class="totals-final">${Ie.join("")}</div>`:"",qe=ne("financialSummary")?!be.length&&!Oe?`<section class="quote-section quote-section--financial">${ee}</section>`:`<section class="quote-section quote-section--financial">
          <div class="totals-block">
            <h3>${i(r("reservations.details.labels.summary","Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ"))}</h3>
            ${be.length?`<div class="totals-inline">${be.join("")}</div>`:""}
            ${ct}
          </div>
        </section>`:"",{groups:$e}=Tn(t),Ze=$e.map(d=>{const D=Number(d?.count??d?.quantity??1)||1,O=Number(d?.unitPrice);let le=Number.isFinite(O)?O:0;if(!le||le<=0){const ce=Number(d?.totalPrice);Number.isFinite(ce)&&D>0&&(le=Number((ce/D).toFixed(2)))}Number.isFinite(le)||(le=0);const ke=d?.type==="package"||Array.isArray(d?.items)&&d.items.some(ce=>ce?.type==="package"),Pe=Array.isArray(d?.barcodes)&&d.barcodes.length?d.barcodes[0]:Array.isArray(d?.items)&&d.items.length?d.items[0]?.barcode:null;let L=d?.packageDisplayCode??d?.package_code??d?.code??d?.packageCode??(Array.isArray(d?.items)&&d.items.length?d.items[0]?.package_code??d.items[0]?.code??d.items[0]?.packageCode:null);const U=ce=>{const Ee=(ce==null?"":String(ce)).trim();return!!(!Ee||/^pkg-/i.test(Ee)||/^\d+$/.test(Ee)&&Ee.length<=4)};if(!L||U(L)){const ce=d?.packageId??d?.package_id??(Array.isArray(d?.items)&&d.items.length?d.items[0]?.packageId??d.items[0]?.package_id:null);if(ce)try{const Ee=En(ce);Ee&&Ee.package_code&&(L=Ee.package_code)}catch{}}if(!L||U(L))try{const ce=rt(d?.description||"");if(ce){const Ee=Nn();let ut=Ee.find(Ye=>rt(Ye?.name||Ye?.title||Ye?.label||"")===ce);ut||(ut=Ee.find(Ye=>{const fn=rt(Ye?.name||Ye?.title||Ye?.label||"");return fn.includes(ce)||ce.includes(fn)})),ut&&ut.package_code&&(L=ut.package_code)}}catch{}const he=ke?L??Pe??"":d?.barcode??Pe??"",Fe=he!=null?String(he):"";let Me=Number.isFinite(Number(d?.totalPrice))?Number(d.totalPrice):Number((le*D).toFixed(2));return Me=yt(Me),{...d,isPackage:ke,desc:d?.description,barcode:Fe,packageCodeResolved:L||"",qty:D,price:Me,totalPrice:Me,unitPriceValue:le}}),et=It.filter(d=>P("items",d.id)),Ke=(()=>{let d=[];et.forEach(L=>{L.id==="price"?d.push({...L,render:U=>{const he=Number.isFinite(Number(U?.unitPriceValue))?Number(U.unitPriceValue):0,Fe=Number.isFinite(Number(U?.qty))?Math.max(1,Number(U.qty)):1,Me=Math.max(1,Number(c?.rentalDays||1)),ce=he*Fe*Me;return i(`${fe(ce)} ${r("reservations.create.summary.currency","SR")}`)}}):L.id==="unitPrice"?d.push({...L,render:U=>{const he=Number.isFinite(Number(U?.unitPriceValue))?Number(U.unitPriceValue):0;return i(`${fe(he)} ${r("reservations.create.summary.currency","SR")}`)}}):d.push(L)});const D=Math.max(1,Number(c?.rentalDays||1));if(P("items","days")){const L=d.findIndex(he=>he.id==="price"),U=Math.max(0,L);d.splice(U,0,{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…",render:()=>i(C(String(D)))})}const O=new Map(d.map(L=>[L.id,L])),le=d.filter(L=>!["unitPrice","quantity","days","price"].includes(L.id)),ke=["unitPrice","quantity"];O.has("days")&&ke.push("days"),ke.push("price");const Pe=ke.map(L=>O.get(L)).filter(Boolean);return d=[...le,...Pe],d})(),He=Ke.length>0,ge=He?Ke.map(d=>`<th>${i(d.labelKey?r(d.labelKey,d.fallback):d.fallback)}</th>`).join(""):"",Te=Ze.length>0?Ze.map((d,D)=>`<tr>${Ke.map(O=>`<td><div class="quote-cell">${O.render(d,D)}</div></td>`).join("")}</tr>`).join(""):`<tr><td colspan="${Math.max(Ke.length,1)}" class="empty">${i(r("reservations.details.noItems","ðŸ“¦ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø¯Ø§Øª Ø¶Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø² Ø­Ø§Ù„ÙŠØ§Ù‹."))}</td></tr>`,Qe=ne("items")?He?`<section class="quote-section quote-section--table">
            <h3>${i(r("reservations.details.items.title","Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</h3>
            <table class="quote-table">
              <thead>
                <tr>${ge}</tr>
              </thead>
              <tbody>${Te}</tbody>
            </table>
            ${P("items","equipmentSubtotal")?`
              <div class="quote-table-subtotal">
                <span class="quote-table-subtotal__pill">
                  <span class="quote-table-subtotal__label">${i(r("reservations.details.labels.equipmentTotal","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</span>
                  <span class="quote-table-subtotal__value">${i(`${o.equipmentTotal} ${p}`)}</span>
                </span>
              </div>
            `:""}
          </section>`:`<section class="quote-section quote-section--table">
            <h3>${i(r("reservations.details.items.title","Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</h3>
            ${ee}
          </section>`:"",tt=Lt.filter(d=>P("crew",d.id)),nt=tt.length>0,Ue=Array.isArray(s)?s:[],f=d=>{const D=d&&d.positionId!=null?`id:${String(d.positionId)}`:(()=>{const ke=(d?.positionLabel||d?.position_name||d?.position||"").trim().toLowerCase();return ke?`label:${ke}`:""})(),O=Number.isFinite(Number(d?.positionClientPrice))?Number(d.positionClientPrice):0,le=O>0?`|p:${O.toFixed(2)}`:"";return`${D}${le}`};(()=>{const d=new Map;return Ue.forEach(D=>{const O=f(D);O&&d.set(O,(d.get(O)||0)+1)}),d})();const I=(()=>{let d=[],D=null;if(tt.forEach(L=>{L.id==="position"?(d.push({...L,render:U=>{const he=typeof re=="function"?re():"ar",Fe=U?.positionLabelEn??U?.position_label_en??U?.position_name_en??U?.positionLabelAlt??U?.position_label_alt??U?.role,Me=U?.positionLabel??U?.position_name??U?.role??r("reservations.crew.positionFallback","Ù…Ù†ØµØ¨ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…");return i(C(String(he==="en"&&Fe?Fe:Me)))}}),P("crew","quantity")&&(D={id:"quantity",labelKey:"reservations.details.table.headers.quantity",fallback:"Ø§Ù„ÙƒÙ…ÙŠØ©",render:U=>{const he=Number(U?.__count||1);return i(C(String(Math.max(1,he))))}})):L.id==="price"?d.push({...L,render:U=>{const he=Number.isFinite(Number(U?.positionClientPrice))?Number(U.positionClientPrice):0,Fe=Math.max(1,Number(U?.__count||1)),Me=Math.max(1,Number(c?.rentalDays||1)),ce=he*Fe*Me;return i(`${fe(ce)} ${r("reservations.create.summary.currency","SR")}`)}}):L.id==="unitPrice"?d.push({...L,render:U=>{const he=Number.isFinite(Number(U?.positionClientPrice))?Number(U.positionClientPrice):0;return i(`${fe(he)} ${r("reservations.create.summary.currency","SR")}`)}}):d.push(L)}),D&&d.push(D),P("crew","days")){const L=Math.max(1,Number(c?.rentalDays||1)),U=d.findIndex(Fe=>Fe.id==="price"),he=Math.max(0,U);d.splice(he,0,{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…",render:()=>i(C(String(L)))})}const O=new Map(d.map(L=>[L.id,L])),le=new Set,ke=[],Pe=L=>{const U=O.get(L);U&&!le.has(L)&&(ke.push(U),le.add(L))};return Pe("rowNumber"),Pe("position"),Pe("unitPrice"),Pe("quantity"),Pe("days"),Pe("price"),d.forEach(L=>{le.has(L.id)||(ke.push(L),le.add(L.id))}),d=ke,d})(),K=nt?I.map(d=>`<th>${i(d.labelKey?r(d.labelKey,d.fallback):d.fallback)}</th>`).join(""):"",Z=(()=>{const d=new Map;return Ue.forEach(D=>{const O=f(D);if(!O)return;const le=d.get(O);le?le.__count+=1:d.set(O,{...D,__count:1})}),Array.from(d.values())})(),Q=Z.length?Z.map((d,D)=>`<tr>${I.map(O=>`<td><div class="quote-cell">${O.render(d,D)}</div></td>`).join("")}</tr>`).join(""):`<tr><td colspan="${Math.max(I.length,1)}" class="empty">${i(r("reservations.details.noCrew","ðŸ˜Ž Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙØ±ÙŠÙ‚ Ù…Ø±ØªØ¨Ø· Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø²."))}</td></tr>`,F=ne("crew")?nt?`<section class="quote-section quote-section--table">
            <h3>${i(r("reservations.details.technicians.title","Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„"))}</h3>
            <table class="quote-table">
              <thead>
                <tr>${K}</tr>
              </thead>
              <tbody>${Q}</tbody>
            </table>
            ${P("crew","crewSubtotal")?`
              <div class="quote-table-subtotal">
                <span class="quote-table-subtotal__pill">
                  <span class="quote-table-subtotal__label">${i(r("reservations.details.labels.crewTotal","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±ÙŠÙ‚"))}</span>
                  <span class="quote-table-subtotal__value">${i(`${o.crewTotal} ${p}`)}</span>
                </span>
              </div>
            `:""}
          </section>`:`<section class="quote-section quote-section--table">
            <h3>${i(r("reservations.details.technicians.title","Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„"))}</h3>
            ${ee}
          </section>`:"",H=ne("notes")?`<section class="quote-section">
        <h3>${i(r("reservations.details.labels.notes","Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø­Ø¬Ø²"))}</h3>
        <div class="quote-notes">${i(z||r("reservations.quote.emptyNotes","Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©."))}</div>
      </section>`:"",de=[];P("payment","beneficiary")&&de.push(pe(r("reservations.quote.labels.beneficiary","Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙÙŠØ¯"),ye.beneficiaryName)),P("payment","bank")&&de.push(pe(r("reservations.quote.labels.bank","Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ"),ye.bankName)),P("payment","account")&&de.push(pe(r("reservations.quote.labels.account","Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨"),C(ye.accountNumber))),P("payment","iban")&&de.push(pe(r("reservations.quote.labels.iban","Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ¨Ø§Ù†"),C(ye.iban)));const je=`<section class="quote-section">
      <div class="payment-block">
        <h3>${i(r("reservations.quote.sections.payment","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹"))}</h3>
        <div class="payment-rows">${de.length?de.join(""):ee}</div>
      </div>
      <p class="quote-approval-note">${i(ye.approvalNote)}</p>
    </section>`,ze=`<footer class="quote-footer">
        <h4>${i(r("reservations.quote.labels.terms","Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø¹Ø§Ù…Ø©"))}</h4>
        <ul>${T.map(d=>`<li>${i(d)}</li>`).join("")}</ul>
      </footer>`,Ce=[];if(J&&ue){const D=(typeof re=="function"?re():"ar")==="en"?`${ue}${J}`:`${J}${ue}`;Ce.push(oe(`<div class="quote-section-row">${D}</div>`,{blockType:"group"}))}else ue&&Ce.push(oe(ue)),J&&Ce.push(oe(J));if(xe)try{const d=typeof re=="function"?re():"ar",D='<section class="quote-section quote-section--empty"></section>',O=d==="en"?`<div class="quote-section-row">${D}${xe}</div>`:`<div class="quote-section-row">${xe}${D}</div>`;Ce.push(oe(O,{blockType:"group"}))}catch{Ce.push(oe(xe))}const h=[];Qe&&h.push(oe(Qe,{blockType:"table",extraAttributes:'data-table-id="items"'})),F&&h.push(oe(F,{blockType:"table",extraAttributes:'data-table-id="crew"'}));const Y=[];qe&&Y.push(oe(qe,{blockType:"summary"})),H&&Y.push(oe(H));let x=[];if((e?.context||"reservation")!=="reservationChecklist")x=[...ne("payment")?[oe(je,{blockType:"payment"})]:[],oe(ze,{blockType:"footer"})];else{const d=String(e?.checklistNotes||"").trim(),D=String(e?.checklistNotesTitle||"").trim()||r("reservations.checklist.controls.notes.sectionTitleDefault","Ù…Ù„Ø§Ø­Ø¸Ø§Øª");if(d.length>0){const O=`<section class="quote-section">
        <h3>${i(D)}</h3>
        <div class="quote-notes">${i(d)}</div>
      </section>`;x=[oe(O)]}}const ie=[...e?.context==="reservationChecklist"?Ce:Et(Ce,"reservations.quote.placeholder.page1"),...h,...e?.context==="reservationChecklist"?Y:Et(Y,"reservations.quote.placeholder.page2"),...x],te=e?.context==="reservationChecklist",me=e?.checklistType==="crew"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ":e?.checklistType==="both"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙˆØ§Ù„Ø·Ø§Ù‚Ù… Ø§Ù„ÙÙ†ÙŠ":"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",Se=typeof re=="function"?re():"ar",De=e?.checklistType==="crew"?"Crew List":e?.checklistType==="both"?"Equipment & Crew List":"Equipment List",we=te?Se==="en"?De:me:r("reservations.quote.title","Ø¹Ø±Ø¶ Ø³Ø¹Ø±"),Ge=te?`<div class="quote-header__meta" ${Se==="en"?'dir="ltr"':""}>
        <div class="quote-header__meta-item">
          <span>${i(r("reservations.quote.labels.date","Ø§Ù„ØªØ§Ø±ÙŠØ®"))}</span>
          <strong>${i(S)}</strong>
        </div>
      </div>`:`<div class="quote-header__meta">
        <div class="quote-header__meta-item">
          <span>Ø±Ù‚Ù… Ø§Ù„Ø¹Ø±Ø¶</span>
          <strong>${i(N)}</strong>
        </div>
        <div class="quote-header__meta-item">
          <span>Ø§Ù„ØªØ§Ø±ÙŠØ®</span>
          <strong>${i(S)}</strong>
        </div>
      </div>`,at=!te||!e?.hideLogo,st=!te||!e?.hideCompany,Ot=`
    <header class="quote-header" data-quote-header-template style="${Number.isFinite(Number(e?.headerOffset))?`margin-top:${Number(e.headerOffset)}px;`:""}">
      <div class="quote-header__logo">
        ${at?`<img class="quote-logo" src="${i(ye.logoUrl)}" alt="${i(ye.companyName)}" crossorigin="anonymous"/>`:'<span class="quote-logo quote-logo--placeholder" aria-hidden="true"></span>'}
      </div>
      <div class="quote-header__title">
        <h1>${i(we)}</h1>
        ${st?`
          <p class="quote-company-name">${i(r("quote.companyName",ye.companyName))}</p>
          <p class="quote-company-cr">${i(r("reservations.quote.labels.cr","Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ"))}: ${i(ye.commercialRegistry)}</p>
          <p class="quote-company-license">${i(r("reservations.quote.labels.mediaLicense","ØªØ±Ø®ÙŠØµ Ø¥Ø¹Ù„Ø§Ù…ÙŠ"))}: 159460</p>
        `:""}
      </div>
      ${Ge}
    </header>
  `.trim();return`
    <div id="quotation-pdf-root" dir="${i(te&&Se==="en"?"ltr":"rtl")}" data-lang="${i(Se)}">
      <style>${Qn}${Hn}</style>
      <div class="quote-document" data-quote-document>
        <div class="quote-preview-pages" data-quote-pages></div>
        <div class="quote-content-source" data-quote-source>
          ${Ot}
          ${ie.join("")}
        </div>
      </div>
    </div>
  `}async function un(){try{const e=Xt();if((Array.isArray(e?.packages)?e.packages:[]).length>0)return;const n=await Jt("/packages/?all=1"),a=Array.isArray(n?.data)?n.data:Array.isArray(n)?n:[];a.length&&(da({packages:a}),document.dispatchEvent?.(new CustomEvent("packages:changed",{detail:{packages:a}})))}catch{}}function ks(e){return e?e.complete?e.naturalHeight===0?Promise.reject(new Error(`image failed to load: ${e.src||"unknown"}`)):Promise.resolve():new Promise((t,n)=>{const a=()=>{u(),t()},s=()=>{u(),n(new Error(`image failed to load: ${e.src||"unknown"}`))},u=()=>{e.removeEventListener("load",a),e.removeEventListener("error",s)};e.addEventListener("load",a,{once:!0}),e.addEventListener("error",s,{once:!0})}):Promise.resolve()}async function bt(e){if(!e)return;const t=e.ownerDocument||document,n=t.defaultView||window,a=Array.from(e.querySelectorAll?.("img")||[]),s=t.fonts?.ready?t.fonts.ready:Promise.resolve(),u=a.map(l=>ks(l)),o=[s,...u].map(l=>l.catch(p=>(Be("asset load failed",p),Ba(),null)));await Promise.all(o),await new Promise(l=>n.requestAnimationFrame(()=>l()))}async function Ct(e,{context:t="preview"}={}){if(!e)return;const n=t==="preview",a=e.ownerDocument||document;e.setAttribute("data-quote-render-context",t);const s=e.querySelector("[data-quote-pages]"),u=e.querySelector("[data-quote-source]"),o=u?.querySelector("[data-quote-header-template]");if(!s||!u||!o)return;s.style.display="block",s.style.margin="0",s.style.padding="0",s.style.gap="0px",s.style.rowGap="0px",s.style.columnGap="0px",s.style.alignItems="stretch",s.style.justifyContent="flex-start",await ta(u),await bt(u),s.innerHTML="";const l=Array.from(u.querySelectorAll(":scope > [data-quote-block]"));let p=null,y=null;const b=m=>{m.style.margin="0 auto",m.style.breakInside="avoid",m.style.pageBreakInside="avoid",m.style.pageBreakAfter="auto",m.style.breakAfter="auto"},N=()=>{const m=a.createElement("div"),g=s.childElementCount===0;if(m.className="quote-page",m.dataset.pageIndex=String(s.childElementCount),g){m.classList.add("quote-page--primary");const R=o.cloneNode(!0);R.removeAttribute("data-quote-header-template"),m.appendChild(R)}else m.classList.add("quote-page--continuation");const k=a.createElement("main");k.className="quote-body",m.appendChild(k),s.appendChild(m),b(m),p=m,y=k},S=()=>{(!p||!y||!y.isConnected)&&N()},w=()=>{if(!p||!y||y.childElementCount>0)return;const m=p;p=null,y=null,m.parentNode&&m.parentNode.removeChild(m)},v=()=>{p=null,y=null},j=()=>p?p.scrollHeight-p.clientHeight>Gn:!1,q=(m,{allowOverflow:g=!1}={})=>(S(),y.appendChild(m),j()&&!g?(y.removeChild(m),w(),!1):!0),E=m=>{const g=m.cloneNode(!0);g.removeAttribute?.("data-quote-block"),g.removeAttribute?.("data-block-type"),g.removeAttribute?.("data-table-id"),!q(g)&&(v(),!q(g)&&q(g,{allowOverflow:!0}))},_=m=>{const g=m.querySelector("table");if(!g){E(m);return}const k=m.querySelector("h3"),R=g.querySelector("thead"),z=Array.from(g.querySelectorAll("tbody tr"));if(!z.length){E(m);return}let T=null,se=0;const P=(ee=!1)=>{const B=m.cloneNode(!1);B.removeAttribute("data-quote-block"),B.removeAttribute("data-block-type"),B.removeAttribute("data-table-id"),B.classList.add("quote-section--table-fragment"),ee&&B.classList.add("quote-section--table-fragment--continued");const W=k?k.cloneNode(!0):null;W&&B.appendChild(W);const pe=g.cloneNode(!1);pe.classList.add("quote-table--fragment"),R&&pe.appendChild(R.cloneNode(!0));const $=a.createElement("tbody");return pe.appendChild($),B.appendChild(pe),{section:B,body:$}},ne=(ee=!1)=>T||(T=P(ee),q(T.section)||(v(),q(T.section)||q(T.section,{allowOverflow:!0})),T);z.forEach(ee=>{ne(se>0);const B=ee.cloneNode(!0);if(T.body.appendChild(B),j()&&(T.body.removeChild(B),T.body.childElementCount||(y.removeChild(T.section),T=null,w()),v(),T=null,ne(se>0),T.body.appendChild(B),j())){T.section.classList.add("quote-section--table-fragment--overflow"),se+=1;return}se+=1}),T=null;try{const ee=m.querySelector(":scope > .quote-table-subtotal");ee&&E(ee)}catch{}};if(!l.length)return;l.forEach(m=>{m.getAttribute("data-block-type")==="table"?_(m):E(m)});const M=Array.from(s.children),V=[];if(M.forEach((m,g)=>{const k=m.querySelector(".quote-body");if(g!==0&&(!k||k.childElementCount===0)){m.remove();return}V.push(m)}),!n){const m=a.defaultView||window,g=Math.min(3,Math.max(1,m.devicePixelRatio||1)),k=Rt()?Math.min(2,g):g;V.forEach(R=>ns(R,{pixelRatio:k}))}V.forEach((m,g)=>{const k=g===0;m.style.pageBreakAfter="auto",m.style.breakAfter="auto",m.style.pageBreakBefore=k?"auto":"always",m.style.breakBefore=k?"auto":"page",n?m.style.boxShadow="":m.style.boxShadow="none"});const ae=V[V.length-1]||null;p=ae,y=ae?.querySelector(".quote-body")||null,await bt(s),n&&(s.style.display="flex",s.style.flexDirection="column",s.style.alignItems="center",s.style.justifyContent="flex-start",s.style.rowGap="18px",s.style.columnGap="0px",s.style.gap="18px")}function ia(e=0){return e<=0?new Promise(t=>requestAnimationFrame(()=>t())):new Promise(t=>setTimeout(t,e))}function la(e){return e?Array.from(e.querySelectorAll(".quote-page")).some(n=>n.scrollHeight-n.clientHeight>Gn):!1}function dn(e,t="#000000"){if(!e)return;e.querySelectorAll('[style*="color"], [class*="text"], h1, h2, h3, h4, h5, h6, p, span, th, td, li, strong, em, label, dt, dd, caption, div').forEach(a=>{a instanceof HTMLElement&&a.style.setProperty("color",t,"important")})}async function _s(e,{filename:t,safariWindowRef:n=null,mobileWindowRef:a=null}){if(!e)return;const s=Array.from(e.querySelectorAll(".quote-page"));if(!s.length)throw new Error("Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙØ­Ø§Øª Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§.");const[u,o]=await Promise.all([ss(),as()]),l=e.ownerDocument||document,p=l?.defaultView?.getComputedStyle?.(e)?.direction,b=[e.getAttribute?.("dir"),e.style?.direction,p,l?.documentElement?.getAttribute?.("dir")].some(m=>typeof m=="string"&&m.toLowerCase().startsWith("rtl")),N=typeof window<"u"&&window.devicePixelRatio||1,S=sn(),w=Xn(),v=Rt();let j;v?j=1.5:w?j=Math.min(1.7,Math.max(1.2,N*1.1)):S?j=Math.min(1.8,Math.max(1.25,N*1.2)):j=Math.min(2,Math.max(1.6,N*1.4));const q=v||w?.9:S?.92:.95,E=new u({unit:"mm",format:"a4",orientation:"portrait",compress:!0}),_={scale:j,useCORS:!0,allowTaint:!1,backgroundColor:"#ffffff",letterRendering:!b,removeContainer:!1,logging:!0};let M=0;const V=r("reservations.quote.errors.browserLimit","ØªØ¹Ø°Ø± Ø¥ØªÙ…Ø§Ù… Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ø³Ø¨Ø¨ Ù‚ÙŠÙˆØ¯ Ø§Ù„Ù…ØªØµÙØ­ØŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø£Ùˆ ØªÙ‚Ù„ÙŠÙ„ Ø­Ø¬Ù… Ø§Ù„Ù…Ø­ØªÙˆÙ‰.");try{for(let m=0;m<s.length;m+=1){const g=s[m];await ta(g),await bt(g);const k=g.ownerDocument||document,R=k.createElement("div");Object.assign(R.style,{position:"fixed",top:"0",left:"-12000px",pointerEvents:"none",zIndex:"-1",backgroundColor:"#ffffff"});const z=g.cloneNode(!0);z.style.width=`${wt}px`,z.style.maxWidth=`${wt}px`,z.style.minWidth=`${wt}px`,z.style.height=`${qt}px`,z.style.maxHeight=`${qt}px`,z.style.minHeight=`${qt}px`,z.style.position="relative",z.style.background="#ffffff",dn(z),R.appendChild(z),k.body.appendChild(R);let T;try{await bt(z),T=await o(z,{..._,scale:j,backgroundColor:"#ffffff",scrollX:0,scrollY:0})}catch($){throw Gt($,"pageCapture",{toastMessage:V}),$}finally{R.parentNode?.removeChild(R)}if(!T)continue;const se=T.width||1,ne=(T.height||1)/se;let ee=zt,B=ee*ne,W=0;if(B>gt){const $=gt/B;B=gt,ee=ee*$,W=Math.max(0,(zt-ee)/2)}const pe=T.toDataURL("image/jpeg",q);M>0&&E.addPage(),E.addImage(pe,"JPEG",W,0,ee,B,`page-${M+1}`,"FAST"),M+=1,await new Promise($=>window.requestAnimationFrame($))}}catch(m){throw Yt({safariWindowRef:n,mobileWindowRef:a}),m}if(M===0)throw Yt({safariWindowRef:n,mobileWindowRef:a}),new Error("PDF generation produced no pages.");if(w||v){const m=E.output("blob");if(v){const g=URL.createObjectURL(m);ht();try{window.location.assign(g)}catch(k){Be("mobile safari blob navigation failed",k)}finally{setTimeout(()=>URL.revokeObjectURL(g),6e4)}}else{const g=URL.createObjectURL(m),k=()=>w&&n&&!n.closed?n:a&&!a.closed?a:null,R=(T,se)=>{if(ht(),!T){window.location.assign(se);return}try{T.location.replace(se),T.focus?.()}catch(P){Be("direct blob navigation failed",P);try{T.document.open(),T.document.write(`<!DOCTYPE html><html lang="ar" dir="rtl"><head><meta charset="utf-8"><title>${i(r("reservations.quote.actions.export","ØªÙ†Ø²ÙŠÙ„ PDF"))}</title><style>html,body{margin:0;height:100%;background:#0f172a;color:#f8fafc;font-family:'Tajawal',sans-serif;} iframe{border:none;width:100%;height:100%;display:block;}</style></head><body><iframe src="${se}" title="PDF preview"></iframe></body></html>`),T.document.close()}catch(ne){Be("iframe blob delivery failed",ne),window.location.assign(se)}}},z=k();R(z,g),setTimeout(()=>URL.revokeObjectURL(g),6e4)}}else{ht();const m=E.output("bloburl"),g=document.createElement("a");g.href=m,g.download=t,g.rel="noopener",g.style.display="none",document.body.appendChild(g),g.click(),setTimeout(()=>{URL.revokeObjectURL(m),g.remove()},2e3)}}function Ae(){if(!c||!A)return;const{previewFrame:e}=A;if(!e)return;const t=c.context||"reservation",n=ra({context:t,reservation:c.reservation,customer:c.customer,project:c.project,crewAssignments:c.crewAssignments,totals:c.totals,totalsDisplay:c.totalsDisplay,rentalDays:c.rentalDays,currencyLabel:c.currencyLabel,sections:c.sections,fieldSelections:c.fields,quoteNumber:c.quoteNumber,quoteDate:c.quoteDateLabel,terms:c.terms,checklistType:c.checklistType,checklistNotes:c.checklistNotes,checklistNotesTitle:c.checklistNotesTitle,hideLogo:!!c.hideLogo,hideCompany:!!c.hideCompany,headerOffset:Number(c.headerOffset||0),projectCrew:c.projectCrew,projectExpenses:c.projectExpenses,projectEquipment:c.projectEquipment,projectInfo:c.projectInfo,clientInfo:c.clientInfo,paymentSummary:c.paymentSummary,projectTotals:c.projectTotals});Je("render"),e.srcdoc=`<!DOCTYPE html>${n}`,e.addEventListener("load",async()=>{try{const a=e.contentDocument,s=a?.defaultView||window,u=a?.documentElement||a;u&&(Cn(u),Pn(u,s),In(u,s));const o=a?.getElementById("quotation-pdf-root");try{o&&(await Ct(o,{context:"preview"}),await ia(120),la(o)&&await Ct(o,{context:"preview"}),dn(o))}catch(w){console.error("[reservations/pdf] failed to layout preview document",w)}const l=Array.from(a?.querySelectorAll?.(".quote-page")||[]);try{if(c?.context==="reservationChecklist"&&c?.hideCompany){const v=a.querySelector(".quote-header");if(v&&!v.dataset.dragReady){v.style.cursor="grab";let j=!1,q=0,E=Number(c.headerOffset||0);const _=ae=>{j=!0,q=ae.clientY||ae.touches?.[0]?.clientY||0,E=Number(c.headerOffset||0),v.style.cursor="grabbing",a.addEventListener("mousemove",M),a.addEventListener("mouseup",V,{once:!0}),a.addEventListener("touchmove",M,{passive:!1}),a.addEventListener("touchend",V,{once:!0})},M=ae=>{if(!j)return;const g=(ae.clientY||ae.touches?.[0]?.clientY||0)-q,k=Math.max(0,Math.min(240,E+g));v.style.marginTop=`${k}px`,c.headerOffset=k,ae.preventDefault?.()},V=()=>{j=!1,v.style.cursor="grab",a.removeEventListener("mousemove",M),a.removeEventListener("touchmove",M)};v.addEventListener("mousedown",_),v.addEventListener("touchstart",_,{passive:!0}),v.dataset.dragReady="true"}}}catch{}const p=a?.querySelector(".quote-preview-pages"),y=wt;let b=18;if(p&&a?.defaultView){const w=a.defaultView.getComputedStyle(p),v=parseFloat(w.rowGap||w.gap||`${b}`);Number.isFinite(v)&&v>=0&&(b=v)}const N=qt,S=l.length?l.length*N+Math.max(0,(l.length-1)*b):N;if(e.dataset.baseWidth=String(y),e.dataset.baseHeight=String(S),e.style.width=`${y}px`,e.style.minWidth=`${y}px`,e.style.height=`${S}px`,e.style.minHeight=`${S}px`,A?.previewFrameWrapper&&!A?.userAdjustedZoom){const w=A.previewFrameWrapper.clientWidth-24;w>0&&w<y?Re=Math.max(w/y,.3):Re=1}ca(Re)}finally{ht()}},{once:!0})}function xs(e){if(!c)return;const t=e.currentTarget,n=t?.dataset?.sectionId;n&&(t.checked?c.sections.add(n):c.sections.delete(n),sa(c),St(),Ae())}function $s(e){if(!c)return;const t=e.currentTarget,n=t?.dataset?.sectionId,a=t?.dataset?.fieldId;if(!n||!a)return;const s=c.context||"reservation",u=c.fields||(c.fields=vt(s)),o=Oa(u,n);t.checked?o.add(a):o.delete(a),sa(c),Ae()}function Ts(e){if(!c)return;const t=e.currentTarget,n=t?.dataset?.sectionId;n&&(an(c,n),c.sectionExpansions[n]=t.open)}function St(){if(!A?.toggles||!c)return;const{toggles:e}=A,t=c.fields||{},n=c.context||"reservation";an(c);const a=Ft(n),s=Rn(n),u=a.map(({id:o,labelKey:l,fallback:p})=>{const y=r(l,p),b=c.sections.has(o),N=s[o]||[],S=Ka(c,o),w=N.length?`<div class="quote-toggle-sublist">
          ${N.map(v=>{const j=nn(t,o,v.id),q=b?"":"disabled",E=v.labelKey?r(v.labelKey,v.fallback):v.fallback;return`
              <label class="quote-toggle quote-toggle--field">
                <input type="checkbox" data-field-toggle data-section-id="${o}" data-field-id="${v.id}" ${j?"checked":""} ${q}>
                <span>${i(E)}</span>
              </label>
            `}).join("")}
        </div>`:"";return`
      <details class="quote-toggle-group" data-section-group data-section-id="${o}" ${S?"open":""}>
        <summary class="quote-toggle-summary">
          <label class="quote-toggle quote-toggle--section">
            <input type="checkbox" data-section-toggle data-section-id="${o}" ${b?"checked":""}>
            <span>${i(y)}</span>
          </label>
          ${N.length?'<span class="quote-toggle-caret" aria-hidden="true"></span>':""}
        </summary>
        ${w}
      </details>
    `}).join("");e.innerHTML=u,e.querySelectorAll("input[data-section-toggle]").forEach(o=>{o.addEventListener("change",xs)}),e.querySelectorAll("input[data-field-toggle]").forEach(o=>{o.addEventListener("change",$s)}),e.querySelectorAll("details[data-section-group]").forEach(o=>{o.addEventListener("toggle",Ts)})}function js(){if(A?.modal)return A;const e=document.createElement("div");e.id="reservationQuoteModal",e.className="modal fade quote-preview-modal",e.tabIndex=-1,e.setAttribute("aria-labelledby","reservationQuoteModalLabel"),e.setAttribute("aria-hidden","true"),e.style.display="none",e.innerHTML=`
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="reservationQuoteModalLabel">${i(r("reservations.quote.previewTitle","Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¹Ø±Ø¶ Ø³Ø¹Ø±"))}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="quote-preview-layout">
            <aside class="quote-preview-sidebar">
              <h6>${i(r("reservations.quote.toggleHeading","Ø­Ø¯Ø¯ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø¯ ØªØµØ¯ÙŠØ±Ù‡Ø§"))}</h6>
              <div class="quote-toggle-list" data-quote-toggles></div>
              <div class="quote-meta-info" data-quote-meta></div>
              <div class="quote-terms-editor" data-quote-terms-editor>
                <label class="quote-terms-editor__label" for="quote-terms-input">${i(r("reservations.quote.termsEditor.title","Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø¹Ø§Ù…Ø© (Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„)"))}</label>
                <textarea id="quote-terms-input" class="quote-terms-editor__textarea" rows="6" data-quote-terms-input placeholder="${i(r("reservations.quote.termsEditor.placeholder","Ø§ÙƒØªØ¨ ÙƒÙ„ Ø´Ø±Ø· ÙÙŠ Ø³Ø·Ø± Ù…Ø³ØªÙ‚Ù„"))}"></textarea>
                <button type="button" class="quote-terms-reset" data-quote-terms-reset>${i(r("reservations.quote.termsEditor.reset","Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©"))}</button>
              </div>
            </aside>
            <section class="quote-preview-panel">
              <div class="quote-preview" data-quote-preview></div>
            </section>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-light" data-bs-dismiss="modal">${i(r("reservations.quote.actions.close","Ø¥ØºÙ„Ø§Ù‚"))}</button>
          <button type="button" class="btn btn-primary" data-quote-download>
            ${i(r("reservations.quote.actions.export","ðŸ“„ ØªÙ†Ø²ÙŠÙ„ PDF"))}
          </button>
        </div>
      </div>
    </div>
  `,document.body.appendChild(e);const t=e.querySelector("[data-quote-toggles]"),n=e.querySelector("[data-quote-preview]"),a=e.querySelector("[data-quote-meta]"),s=e.querySelector("[data-quote-terms-input]"),u=e.querySelector("[data-quote-terms-reset]"),o=e.querySelector("[data-quote-download]"),l=e.querySelector(".modal-header"),p=l?.querySelector(".btn-close"),y=Array.from(e.querySelectorAll('[data-bs-dismiss="modal"]')),b=document.createElement("div");b.className="quote-preview-header-actions",l&&l.insertBefore(b,p||null);const N=document.createElement("iframe");N.className="quote-preview-frame",N.setAttribute("title",r("reservations.quote.previewTitle","Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¹Ø±Ø¶ Ø³Ø¹Ø±")),N.setAttribute("loading","lazy"),N.setAttribute("frameborder","0");const S=document.createElement("div");S.className="quote-preview-zoom-controls",S.innerHTML=`
    <button type="button" class="quote-preview-zoom-btn" data-zoom-out title="${i(r("reservations.quote.zoom.out","ØªØµØºÙŠØ±"))}">âˆ’</button>
    <span class="quote-preview-zoom-value" data-zoom-value>100%</span>
    <button type="button" class="quote-preview-zoom-btn" data-zoom-in title="${i(r("reservations.quote.zoom.in","ØªÙƒØ¨ÙŠØ±"))}">+</button>
    <button type="button" class="quote-preview-zoom-btn" data-zoom-reset title="${i(r("reservations.quote.zoom.reset","Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¶Ø¨Ø·"))}">1:1</button>
  `;const w=document.createElement("div");w.className="quote-preview-frame-wrapper",w.appendChild(N),n.innerHTML="";const v=document.createElement("div");v.className="quote-preview-scroll",v.appendChild(w),n.appendChild(v);const j=document.createElement("div");j.className="quote-preview-status",j.setAttribute("role","status"),j.setAttribute("aria-live","polite"),j.hidden=!0,j.innerHTML=`
    <span class="quote-preview-spinner" data-quote-status-spinner aria-hidden="true"></span>
    <span data-quote-status-text>${i(Kn("render"))}</span>
    <button type="button" class="quote-preview-status-action" data-quote-status-action hidden></button>
  `,n.appendChild(j),b.appendChild(S),o?.addEventListener("click",async()=>{if(c){o.disabled=!0;try{await ua()}finally{o.disabled=!1}}});const q=()=>{Vt()||Wt(e)};y.forEach(V=>{V?.addEventListener("click",q)}),p&&!y.includes(p)&&p.addEventListener("click",q),e.addEventListener("click",V=>{Vt()||V.target===e&&Wt(e)}),A={modal:e,toggles:t,preview:n,previewScroll:v,previewFrameWrapper:w,zoomControls:S,zoomValue:S.querySelector("[data-zoom-value]"),previewFrame:N,meta:a,downloadBtn:o,statusIndicator:j,statusText:j.querySelector("[data-quote-status-text]"),statusSpinner:j.querySelector("[data-quote-status-spinner]"),statusAction:j.querySelector("[data-quote-status-action]"),termsInput:s,termsReset:u,statusKind:null,userAdjustedZoom:!1};const E=S.querySelector("[data-zoom-out]"),_=S.querySelector("[data-zoom-in]"),M=S.querySelector("[data-zoom-reset]");return E?.addEventListener("click",()=>_n(-.1)),_?.addEventListener("click",()=>_n(.1)),M?.addEventListener("click",()=>Pt(1,{markManual:!0})),s&&s.addEventListener("input",Es),u&&u.addEventListener("click",Ns),Pt(Re),A}function Pt(e,{silent:t=!1,markManual:n=!1}={}){Re=Math.min(Math.max(e,.25),2.2),n&&A&&(A.userAdjustedZoom=!0),ca(Re),!t&&A?.zoomValue&&(A.zoomValue.textContent=`${Math.round(Re*100)}%`)}function _n(e){Pt(Re+e,{markManual:!0})}function ca(e){if(!A?.previewFrame||!A.previewFrameWrapper)return;const t=A.previewFrame,n=A.previewFrameWrapper,a=Number(t.dataset.baseWidth)||794,s=Number(t.dataset.baseHeight)||t.contentDocument?.body?.scrollHeight||1123;t.style.transform=`scale(${e})`,t.style.transformOrigin="top center",sn()?(n.style.width="100%",n.style.maxWidth="100%",n.style.minWidth="0"):(n.style.width=`${a}px`,n.style.maxWidth=`${a}px`,n.style.minWidth=`${a}px`),n.style.minHeight=`${s}px`,n.style.height=`${s}px`}function At(){if(!A?.meta||!c)return;const{meta:e}=A;(c.context||"reservation")==="reservationChecklist"?e.innerHTML=`
      <div class="quote-meta-card">
        <div><span>${i(r("reservations.quote.labels.dateGregorian","Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ"))}</span><strong>${i(c.quoteDateLabel)}</strong></div>
      </div>
    `:e.innerHTML=`
      <div class="quote-meta-card">
        <div><span>${i(r("reservations.quote.labels.number","Ø±Ù‚Ù… Ø¹Ø±Ø¶ Ø³Ø¹Ø±"))}</span><strong>${i(c.quoteNumber)}</strong></div>
        <div><span>${i(r("reservations.quote.labels.dateGregorian","Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ"))}</span><strong>${i(c.quoteDateLabel)}</strong></div>
      </div>
    `}function pn(){if(!A?.termsInput)return;const e=(c?.terms&&c.terms.length?c.terms:_e).join(`
`);A.termsInput.value!==e&&(A.termsInput.value=e)}function Es(e){if(!c)return;const t=Qt(e?.target?.value??"");if(t.length){c.terms=t;const n=document.getElementById("reservation-terms");n&&(n.value=e.target.value);const a=document.getElementById("edit-res-terms");a&&(a.value=e.target.value)}else{c.terms=[..._e],pn();const n=_e.join(`
`),a=document.getElementById("reservation-terms");a&&(a.value=n);const s=document.getElementById("edit-res-terms");s&&(s.value=n)}Ae()}function Ns(e){if(e?.preventDefault?.(),!c)return;c.terms=[..._e];const t=document.getElementById("reservation-terms");t&&(t.value=_e.join(`
`));const n=document.getElementById("edit-res-terms");n&&(n.value=_e.join(`
`)),pn(),Ae()}async function ua(){if(!c)return;Je("export");const t=!sn()&&Xn(),n=Rt(),a=null,s=!n&&t?window.open("","_blank"):null;(p=>{if(p)try{p.document.open(),p.document.write(`<!DOCTYPE html><html lang="ar" dir="rtl"><head><meta charset="utf-8"><title>${i(r("reservations.quote.status.exporting","Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ù…Ù„Ù PDF..."))}</title><style>body{font-family:'Tajawal',sans-serif;margin:0;height:100vh;display:flex;align-items:center;justify-content:center;background:#0f172a;color:#f8fafc;text-align:center;padding:24px;} .loader{width:42px;height:42px;border-radius:50%;border:4px solid rgba(248,250,252,0.35);border-top-color:#38bdf8;animation:spin 1s linear infinite;margin:0 auto 18px;}@keyframes spin{to{transform:rotate(360deg);}} h1{margin:0 0 6px;font-size:1.05rem;} p{margin:0;font-size:0.9rem;opacity:0.8;}</style></head><body><div><div class="loader" aria-hidden="true"></div><h1>${i(r("reservations.quote.status.exporting","Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ù…Ù„Ù PDF..."))}</h1><p>${i(r("reservations.quote.status.exportingHint","Ù‚Ø¯ ÙŠØ³ØªØºØ±Ù‚ Ø°Ù„Ùƒ Ø¨Ø¶Ø¹ Ø«ÙˆØ§Ù†ÙØŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±..."))}</p></div></body></html>`),p.document.close()}catch(y){Be("failed to prime download window",y)}})(s);let o=null;const l=r("reservations.quote.errors.browserLimit","ØªØ¹Ø°Ø± Ø¥ØªÙ…Ø§Ù… Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ø³Ø¨Ø¨ Ù‚ÙŠÙˆØ¯ Ø§Ù„Ù…ØªØµÙØ­ØŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø£Ùˆ ØªÙ‚Ù„ÙŠÙ„ Ø­Ø¬Ù… Ø§Ù„Ù…Ø­ØªÙˆÙ‰.");try{await os(),Ht("html2pdf ensured");const p=c.context||"reservation";if(p!=="reservationChecklist")try{const{sequence:S,quoteNumber:w}=await is(p);c.quoteSequence=S,c.quoteNumber=w,c.sequenceCommitted=!0}catch(S){Be("failed to reserve sequence at export time, proceeding with preview number",S)}const y=ra({context:p,reservation:c.reservation,customer:c.customer,project:c.project,crewAssignments:c.crewAssignments,totals:c.totals,totalsDisplay:c.totalsDisplay,rentalDays:c.rentalDays,currencyLabel:c.currencyLabel,sections:c.sections,fieldSelections:c.fields,quoteNumber:c.quoteNumber,quoteDate:c.quoteDateLabel,terms:c.terms,checklistType:c.checklistType,checklistNotes:c.checklistNotes,checklistNotesTitle:c.checklistNotesTitle,hideLogo:!!c.hideLogo,hideCompany:!!c.hideCompany,headerOffset:Number(c.headerOffset||0),projectCrew:c.projectCrew,projectExpenses:c.projectExpenses,projectEquipment:c.projectEquipment,projectInfo:c.projectInfo,clientInfo:c.clientInfo,paymentSummary:c.paymentSummary,projectTotals:c.projectTotals});o=document.createElement("div"),o.innerHTML=y,Object.assign(o.style,{position:"fixed",top:"0",left:"0",pointerEvents:"none",zIndex:"-1"}),document.body.appendChild(o),Cn(o),Pn(o),In(o),Ht("export container prepared");const b=o.firstElementChild;if(b){b.setAttribute("dir","rtl"),b.style.direction="rtl",b.style.textAlign="right",b.setAttribute("data-theme","light"),b.classList.remove("dark","dark-mode"),b.style.margin="0",b.style.padding="0",b.style.width="210mm",b.style.maxWidth="210mm",b.style.marginLeft="auto",b.style.marginRight="auto",b.scrollTop=0,b.scrollLeft=0;try{await Ct(b,{context:"export"}),await ia(120),la(b)&&await Ct(b,{context:"export"}),await bt(b),dn(b),Ht("layout complete for export document")}catch(S){Gt(S,"layoutQuoteDocument",{suppressToast:!0})}}const N=p==="reservationChecklist"?(()=>{const S=c?.reservation?.reservationCode||c?.reservation?.reservationId||c?.reservation?.id||"res",w=c?.checklistType==="crew"?"crew":c?.checklistType==="both"?"equipment-crew":"equipment";return`checklist-${String(S)}-${w}.pdf`})():`quotation-${c.quoteNumber}.pdf`;await _s(b,{filename:N,safariWindowRef:s,mobileWindowRef:a})}catch(p){Yt({container:o,safariWindowRef:s,mobileWindowRef:a}),o=null,Gt(p,"exportQuoteAsPdf",{toastMessage:l})}finally{o&&o.parentNode&&o.parentNode.removeChild(o),ht()}}function mn(){const e=js();if(e?.modal){if(ft=!1,Re=1,A&&(A.userAdjustedZoom=!1),Pt(Re,{silent:!0}),c?.context==="reservationChecklist")try{const t=e.modal.querySelector("#reservationQuoteModalLabel"),n=e.modal.querySelector(".quote-preview-sidebar"),a=e.modal.querySelector("[data-quote-terms-editor]");a&&(a.style.display="none");let s=n.querySelector("[data-checklist-controls]");if(!s){s=document.createElement("div"),s.setAttribute("data-checklist-controls","");const u=i(r("reservations.checklist.controls.items","Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª")),o=i(r("reservations.checklist.controls.crew","Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ")),l=i(r("reservations.checklist.controls.both","Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙˆØ§Ù„Ø·Ø§Ù‚Ù… Ø§Ù„ÙÙ†ÙŠ")),p=i(r("reservations.checklist.controls.hideLogo","Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø´Ø¹Ø§Ø±")),y=i(r("reservations.checklist.controls.hideCompany","Ø¥Ø®ÙØ§Ø¡ Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©")),b=i(r("reservations.checklist.controls.notes.title","Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù„Ø³ØªØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)")),N=i(r("reservations.checklist.controls.notes.placeholder","Ø§ÙƒØªØ¨ Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø®Ø§ØµØ© Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ù„Ø³ØªØ©")),S=typeof re=="function"?re():"ar",w=i(S==="en"?r("language.toggle.labelAr","ðŸ‡¸ðŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"):r("language.toggle.labelEn","ðŸ‡¬ðŸ‡§ English"));s.innerHTML=`
          <div class="quote-meta-card" style="margin-bottom:10px">
            <div style="display:flex;gap:10px;flex-wrap:wrap">
              <label style="display:flex;align-items:center;gap:6px">
                <input type="radio" name="checklist-type" value="items" checked>
                <span data-i18n data-i18n-key="reservations.checklist.controls.items">${u}</span>
              </label>
              <label style="display:flex;align-items:center;gap:6px">
                <input type="radio" name="checklist-type" value="crew">
                <span data-i18n data-i18n-key="reservations.checklist.controls.crew">${o}</span>
              </label>
              <label style="display:flex;align-items:center;gap:6px">
                <input type="radio" name="checklist-type" value="both">
                <span data-i18n data-i18n-key="reservations.checklist.controls.both">${l}</span>
              </label>
            </div>
          </div>
          <div class="quote-meta-card" style="margin-bottom:10px">
            <div style="display:flex;gap:8px;flex-wrap:wrap">
              <button type="button" class="btn btn-sm btn-light" data-checklist-lang>${w}</button>
              <label style="display:flex;align-items:center;gap:6px">
                <input type="checkbox" data-checklist-hide-logo>
                <span data-i18n data-i18n-key="reservations.checklist.controls.hideLogo">${p}</span>
              </label>
              <label style="display:flex;align-items:center;gap:6px">
                <input type="checkbox" data-checklist-hide-company>
                <span data-i18n data-i18n-key="reservations.checklist.controls.hideCompany">${y}</span>
              </label>
            </div>
          </div>
          <div class="quote-terms-editor" data-checklist-notes>
            <label class="quote-terms-editor__label" for="checklist-notes-title-input" data-i18n data-i18n-key="reservations.checklist.controls.notes.titleLabel">${i(r("reservations.checklist.controls.notes.titleLabel","Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª"))}</label>
            <input id="checklist-notes-title-input" class="quote-terms-editor__input" type="text" value="${i(r("reservations.checklist.controls.notes.sectionTitleDefault","Ù…Ù„Ø§Ø­Ø¸Ø§Øª"))}" data-i18n-value-key="reservations.checklist.controls.notes.sectionTitleDefault">
            <label class="quote-terms-editor__label" for="checklist-notes-input" data-i18n data-i18n-key="reservations.checklist.controls.notes.title">${b}</label>
            <textarea id="checklist-notes-input" class="quote-terms-editor__textarea" rows="4" data-i18n-placeholder-key="reservations.checklist.controls.notes.placeholder" placeholder="${N}"></textarea>
          </div>
        `,n.prepend(s),s.querySelectorAll('input[name="checklist-type"]').forEach(m=>{m.addEventListener("change",()=>{const g=s.querySelector('input[name="checklist-type"]:checked')?.value||"items";c.checklistType=g==="crew"||g==="both"?g:"items";const k=new Set(["customerInfo","reservationInfo","projectInfo","notes"]);if(c.checklistType==="crew"?k.add("crew"):c.checklistType==="both"?(k.add("items"),k.add("crew")):k.add("items"),c.sections=k,t){const R=re?.()||"ar",z=c.checklistType==="crew"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ":c.checklistType==="both"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙˆØ§Ù„Ø·Ø§Ù‚Ù… Ø§Ù„ÙÙ†ÙŠ":"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",T=c.checklistType==="crew"?"Crew List":c.checklistType==="both"?"Equipment & Crew List":"Equipment List";t.textContent=R==="en"?T:z}St(),At(),Ae()})});const j=s.querySelector("#checklist-notes-input"),q=s.querySelector("#checklist-notes-title-input"),E=()=>{try{const m=re?.()||"ar",g=m==="en"?"ltr":"rtl",k=m==="en"?"left":"right";j&&(j.setAttribute("dir",g),j.style.textAlign=k),q&&(q.setAttribute("dir",g),q.style.textAlign=k)}catch{}};E();try{const m=()=>E();document.addEventListener("language:changed",m),s._onLangChanged=m}catch{}j.addEventListener("input",m=>{c.checklistNotes=String(m.target.value||""),Ae()}),q.addEventListener("input",m=>{c.checklistNotesTitle=String(m.target.value||""),Ae()});const _=s.querySelector("[data-checklist-lang]");if(_){const m=()=>{const g=re?.()||"ar";_.textContent=g==="ar"?"ðŸ‡¬ðŸ‡§ English":"ðŸ‡¸ðŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"};m(),_.addEventListener("click",()=>{const k=(re?.()||"ar")==="ar"?"en":"ar";try{pa?.(k)}catch{}if(m(),E(),t){const R=re?.()||"ar",z=c.checklistType,T=z==="crew"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ":z==="both"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙˆØ§Ù„Ø·Ø§Ù‚Ù… Ø§Ù„ÙÙ†ÙŠ":"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",se=z==="crew"?"Crew List":z==="both"?"Equipment & Crew List":"Equipment List";t.textContent=R==="en"?se:T}St(),At(),Ae()})}const M=s.querySelector("[data-checklist-hide-logo]"),V=s.querySelector("[data-checklist-hide-company]");(()=>{M&&(M.checked=!!c.hideLogo),V&&(V.checked=!!c.hideCompany)})(),M?.addEventListener("change",m=>{c.hideLogo=!!m.target.checked,Ae()}),V?.addEventListener("change",m=>{c.hideCompany=!!m.target.checked,Ae()})}t&&(t.textContent=c.checklistType==="crew"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ":"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª");try{e.previewFrame?.setAttribute("title","Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù„Ø³ØªØ©")}catch{}}catch{}St(),At(),pn(),Ae(),Ra(e.modal)}}async function Bs({reservation:e,customer:t,project:n}){if(!e){kt(r("reservations.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø²"));return}await un();const a=Bt(e),{totalsDisplay:s,totals:u,rentalDays:o}=cn(e,a,n),l=r("reservations.create.summary.currency","SR"),p=new Date,y=Ta();c={context:"reservation",reservation:e,customer:t,project:n,crewAssignments:a,totals:u,totalsDisplay:s,rentalDays:o,currencyLabel:l,projectCrew:[],projectExpenses:[],projectEquipment:[],sections:new Set(Ft("reservation").filter(b=>b.defaultSelected).map(b=>b.id)),sectionExpansions:Mt("reservation"),fields:vt("reservation"),terms:y,quoteDate:p,quoteDateLabel:ln(p),sequenceCommitted:!1},rn(c),mn();try{en()}catch{}}async function Os({reservation:e,customer:t,project:n}){if(!e){kt(r("reservations.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø²"));return}await un();const a=Bt(e),{totalsDisplay:s,totals:u,rentalDays:o}=cn(e,a,n),l=r("reservations.create.summary.currency","SR"),p=new Date;c={context:"reservationChecklist",reservation:e,customer:t,project:n,crewAssignments:a,totals:u,totalsDisplay:s,rentalDays:o,currencyLabel:l,checklistType:"items",checklistNotes:"",projectCrew:[],projectExpenses:[],projectEquipment:[],sections:new Set(["customerInfo","reservationInfo","projectInfo","notes","items"]),sectionExpansions:Mt("reservationChecklist"),fields:vt("reservationChecklist"),terms:[],quoteDate:p,quoteDateLabel:ln(p),sequenceCommitted:!1},rn(c),mn();try{en()}catch{}}async function Ks({project:e}){if(!e){kt(r("projects.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"));return}await un();let t=kn(e);const{project:n}=t;if(!n){kt(r("projects.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"));return}try{(!Array.isArray(t.equipmentItems)||t.equipmentItems.length===0)&&n?.id!=null&&(await ha({project_id:n.id}),t=kn(n))}catch(l){console.warn("[reservationPdf] refreshReservationsForProject failed, proceeding with snapshot/state",l)}const{sequence:a,quoteNumber:s}=await ls("project"),u=new Date,o=[...$a];c={context:"project",reservation:null,customer:t.customer,project:n,technicians:t.crew||[],clientInfo:t.clientInfo,projectInfo:t.projectInfo,projectCrew:t.crew,projectExpenses:t.expenses,projectEquipment:t.equipment,equipmentItems:t.equipmentItems||[],crewAssignments:t.crewAssignments||[],totals:t.totals,projectTotals:t.projectTotals,totalsDisplay:t.totalsDisplay,rentalDays:t.projectDurationDays,currencyLabel:t.currencyLabel,sections:new Set(Ft("project").filter(l=>l.defaultSelected).map(l=>l.id)),sectionExpansions:Mt("project"),fields:vt("project"),terms:o,quoteSequence:a,quoteNumber:s,quoteDate:u,quoteDateLabel:ln(u),sequenceCommitted:!1,paymentSummary:t.paymentSummary,projectNotes:t.notes,paymentHistory:t.paymentHistory},rn(c),mn();try{en()}catch{}}export{Bs as a,Os as b,Ks as e,Ms as g,Ln as r,Rs as s};
