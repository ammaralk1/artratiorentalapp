import{n as j,j as ht,t as i,d as Qt,b as Ut,h as sa,y as tt,B as gn}from"./auth.DPPwhYNj.js";import{n as oa,F as lt,E as bt,a as ra,b as zt,d as wn,C as qn,g as Sn,r as ia,c as ca,e as la,h as ua}from"./reservationsService.DofAzaoX.js";import{s as da,i as cn,j as ln,H as An,O as _n}from"./state.CdpE6Oc4.js";import{h as pa}from"./view.nMj7WoZi.js";import{q as ma}from"./quotePdf.C2lQPEPC.js";import{s as kn,a as xn,e as jn,p as fa}from"./canvasColorUtils.CviLtv6S.js";function $n(e){const t=new Date;if(t.setHours(0,0,0,0),e==="today")return{startDate:We(t),endDate:We(t)};if(e==="week"){const n=new Date(t),a=n.getDay(),s=a===0?6:a-1;n.setDate(n.getDate()-s);const l=new Date(n);return l.setDate(n.getDate()+6),{startDate:We(n),endDate:We(l)}}if(e==="month"){const n=new Date(t.getFullYear(),t.getMonth(),1),a=new Date(t.getFullYear(),t.getMonth()+1,0);return{startDate:We(n),endDate:We(a)}}return e==="upcoming"?{startDate:We(t),endDate:""}:{startDate:"",endDate:""}}function Es(){const e=document.getElementById("search-reservation"),t=document.getElementById("filter-start-date"),n=document.getElementById("filter-end-date"),a=document.getElementById("reservation-date-range"),s=document.getElementById("reservation-status-filter");let l=j(t?.value||"").trim(),o=j(n?.value||"").trim(),r=a?.value||"";if(new Set(["","today","week","month"]).has(r)||(r="",a&&(a.value=""),vt(t),vt(n),l="",o=""),!l&&!o&&r){const y=$n(r);l=y.startDate,o=y.endDate}return{searchTerm:oa(e?.value||""),startDate:l,endDate:o,status:s?.value||"",quickRange:r}}function Ns(e){const t=()=>{typeof e=="function"&&e()},n=document.getElementById("search-reservation");n&&!n.dataset.listenerAttached&&(n.addEventListener("input",()=>{n.value=j(n.value),t()}),n.dataset.listenerAttached="true");const a=document.getElementById("filter-start-date");a&&!a.dataset.listenerAttached&&(a.addEventListener("change",()=>{const p=document.getElementById("reservation-date-range");p&&(p.value=""),t()}),a.dataset.listenerAttached="true");const s=document.getElementById("filter-end-date");s&&!s.dataset.listenerAttached&&(s.addEventListener("change",()=>{const p=document.getElementById("reservation-date-range");p&&(p.value=""),t()}),s.dataset.listenerAttached="true");const l=document.getElementById("reservation-date-range");l&&!l.dataset.listenerAttached&&(l.addEventListener("change",()=>{ya(l.value),t()}),l.dataset.listenerAttached="true");const o=document.getElementById("reservation-status-filter");o&&!o.dataset.listenerAttached&&(o.addEventListener("change",t),o.dataset.listenerAttached="true");const r=document.getElementById("clear-filters");r&&!r.dataset.listenerAttached&&(r.addEventListener("click",()=>{n&&(n.value=""),vt(a),vt(s),l&&(l.value=""),o&&(o.value=""),t()}),r.dataset.listenerAttached="true")}function ya(e){const t=document.getElementById("filter-start-date"),n=document.getElementById("filter-end-date");if(!t||!n)return;const{startDate:a,endDate:s}=$n(e);t._flatpickr?a?t._flatpickr.setDate(a,!1,"Y-m-d"):t._flatpickr.clear():t.value=a,n._flatpickr?s?n._flatpickr.setDate(s,!1,"Y-m-d"):n._flatpickr.clear():n.value=s}function We(e){if(!e)return"";const t=e.getTimezoneOffset()*6e4;return new Date(e.getTime()-t).toISOString().split("T")[0]}function vt(e){e&&(e._flatpickr&&e._flatpickr.clear(),e.value="")}const ha=""+new URL("Tajawal-400.ttf",import.meta.url).href,ba=""+new URL("Tajawal-500.ttf",import.meta.url).href,un=""+new URL("Tajawal-700.ttf",import.meta.url).href,Tn="reservations.quote.sequence",dn={reservation:"reservations.quote.togglePrefs.v1",project:"projects.quote.togglePrefs.v1",reservationChecklist:"reservations.checklist.togglePrefs.v1"},En="https://help.artratio.sa/guide/quote-preview",be={logoUrl:"https://art-ratio.sirv.com/AR-Logo-v3.5-curved.png",companyName:"Ø´Ø±ÙƒØ© ÙÙˆØ¯ Ø¢Ø±Øª Ù„Ù„Ø¯Ø¹Ø§ÙŠØ© ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù† (Ø´Ø±ÙƒØ© Ø´Ø®Øµ ÙˆØ§Ø­Ø¯)",commercialRegistry:"4030485240",beneficiaryName:"Ø´Ø±ÙƒØ© ÙÙˆØ¯ Ø¢Ø±Øª Ù„Ù„Ø¯Ø¹Ø§ÙŠØ© ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù† (Ø´Ø±ÙƒØ© Ø´Ø®Øµ ÙˆØ§Ø­Ø¯)",bankName:"Ù…ØµØ±Ù Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠ",accountNumber:"Ù£Ù¥Ù¨Ù Ù Ù Ù Ù¡Ù Ù Ù Ù¦Ù Ù¨Ù¦Ù Ù¦Ù¥Ù§Ù Ù¦",iban:"SA1680000358608016065706",approvalNote:"Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø±Ø¶ ØªØ¹ØªØ¨Ø± Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…."},va=["ÙŠÙˆÙ… Ø§Ù„Ø¹Ù…Ù„ Ù‡Ùˆ 12 Ø³Ø§Ø¹Ø©ØŒ ÙˆÙŠØªÙ… Ø§Ø­ØªØ³Ø§Ø¨ Ù†ØµÙ ÙŠÙˆÙ… Ø¥Ø¶Ø§ÙÙŠ Ø¨Ø¹Ø¯ 20 Ø³Ø§Ø¹Ø©ØŒ Ø«Ù… ÙŠÙˆÙ… ÙƒØ§Ù…Ù„ Ø¨Ø¹Ø¯ Ø°Ù„Ùƒ.","ÙŠÙ…Ù†Ø¹ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙÙŠ Ø£Ù†Ø´Ø·Ø© ØºÙŠØ± Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©.","ÙŠØªØ­Ù…Ù„ Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø± Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© Ø£ÙŠ ØªÙ„Ù Ø£Ùˆ ÙÙ‚Ø¯Ø§Ù†.","ÙŠØ¬Ø¨ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙÙŠ Ø­Ø§Ù„ØªÙ‡Ø§ Ø§Ù„Ø£ØµÙ„ÙŠØ©.","ÙŠØªÙ… ÙØ±Ø¶ Ø±Ø³ÙˆÙ… Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ù„ØºØ§Ø¡ Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ù‚Ø¨Ù„ 24 Ø³Ø§Ø¹Ø©."],xe=[...va],ga=["ÙŠØªÙ… Ø¯ÙØ¹ 50% Ù…Ù† Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø±ØŒ ÙˆÙŠØªÙ… Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø§Ù„Ù€ 50% Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ.","ÙŠØ­ØµÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¹Ù„Ù‰ Ø­Ù‚ÙˆÙ‚ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© ÙÙŠ Ø£ÙŠ Ù…ÙƒØ§Ù† ÙŠØ±Ø§Ù‡ Ù…Ù†Ø§Ø³Ø¨Ø§Ù‹ØŒ Ø¨ÙŠÙ†Ù…Ø§ ØªØ­ØªÙØ¸ Ø§Ù„Ø´Ø±ÙƒØ© Ø¨Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø®Ø§Ù… ÙˆÙ„Ø§ ØªØ³ØªØ®Ø¯Ù…Ù‡Ø§ Ø¥Ù„Ø§ Ø¨Ø¹Ø¯ Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ø§ Ù„Ù… ÙŠÙØªÙÙ‚ Ø¹Ù„Ù‰ ØºÙŠØ± Ø°Ù„Ùƒ.","ÙŠØªÙ… Ø§Ù„Ø§ØªÙØ§Ù‚ Ø¹Ù„Ù‰ Ø¬Ø¯ÙˆÙ„ Ø²Ù…Ù†ÙŠ Ù„Ù„ØªÙ†ÙÙŠØ°ØŒ ÙˆØ£ÙŠ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ø®Ø§Ø±Ø¬ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ù…ØªÙÙ‚ Ø¹Ù„ÙŠÙ‡ ØªØ®Ø¶Ø¹ Ù„Ø±Ø³ÙˆÙ… Ø¥Ø¶Ø§ÙÙŠØ©.","Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù† ØªÙˆÙÙŠØ± Ø§Ù„ØªØµØ§Ø±ÙŠØ­ Ø§Ù„Ù„Ø§Ø²Ù…Ø© Ù„Ù„ØªØµÙˆÙŠØ± ÙÙŠ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©ØŒ ÙˆØ£ÙŠ ØªØ£Ø®ÙŠØ± Ù†Ø§ØªØ¬ Ø¹Ù† Ø°Ù„Ùƒ Ù‚Ø¯ ÙŠØ¤Ø«Ø± Ø¹Ù„Ù‰ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„ØªØ³Ù„ÙŠÙ….","ØªÙØ­ÙÙŽØ¸ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ù„Ù„Ù…Ø´Ø±ÙˆØ¹ Ù„Ù…Ø¯Ø© 12 Ø´Ù‡Ø±Ø§Ù‹ ÙÙŠ Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ø´Ø±ÙƒØ©ØŒ ÙˆÙŠÙ…ÙƒÙ† Ù„Ù„Ø¹Ù…ÙŠÙ„ Ø·Ù„Ø¨ Ù†Ø³Ø® Ø¥Ø¶Ø§ÙÙŠØ© Ø®Ù„Ø§Ù„ ØªÙ„Ùƒ Ø§Ù„ÙØªØ±Ø©.","ÙŠØªØ­Ù…Ù‘Ù„ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© ØªÙˆÙÙŠØ± Ø¨ÙŠØ¦Ø© Ø¹Ù…Ù„ Ø¢Ù…Ù†Ø© Ù„Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ ÙˆØ§Ù„Ù…Ø¹Ø¯Ø§Øª ÙÙŠ Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªØµÙˆÙŠØ±ØŒ ÙˆÙŠØ¶Ù…Ù† Ø§ØªØ®Ø§Ø° ÙƒØ§ÙØ© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·Ø§Øª Ø§Ù„Ù„Ø§Ø²Ù…Ø© Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø³Ù„Ø§Ù…ØªÙ‡Ù…."];function Dt(e){return e?e.split(/\r?\n/).map(t=>t.trim()).filter(t=>t.length>0):[...xe]}function wa(){const e=document.getElementById("reservation-terms");if(e&&e.value.trim().length>0){const a=Dt(e.value);if(a.length)return a}const t=document.getElementById("edit-res-terms");if(t&&t.value.trim().length>0){const a=Dt(t.value);if(a.length)return a}const n=xe.join(`
`);return e&&e.value.trim().length===0&&(e.value=n),t&&t.value.trim().length===0&&(t.value=n),[...xe]}const qa=[{id:"customerInfo",labelKey:"reservations.quote.sections.customer",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„",defaultSelected:!0},{id:"reservationInfo",labelKey:"reservations.quote.sections.reservation",fallback:"ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²",defaultSelected:!0},{id:"projectInfo",labelKey:"reservations.quote.sections.project",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",defaultSelected:!0},{id:"financialSummary",labelKey:"reservations.quote.sections.financial",fallback:"Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ",defaultSelected:!0},{id:"items",labelKey:"reservations.quote.sections.items",fallback:"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",defaultSelected:!0},{id:"crew",labelKey:"reservations.quote.sections.crew",fallback:"Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„",defaultSelected:!0},{id:"notes",labelKey:"reservations.quote.sections.notes",fallback:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø­Ø¬Ø²",defaultSelected:!0},{id:"payment",labelKey:"reservations.quote.sections.payment",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹",defaultSelected:!1}],xt=[{id:"rowNumber",labelKey:null,fallback:"#",render:(e,t)=>c(j(String(t+1)))},{id:"code",labelKey:"reservations.details.table.headers.code",fallback:"Ø§Ù„ÙƒÙˆØ¯",render:e=>{if(e?.isPackage){const t=e?.packageCodeResolved||e?.barcode||"";return c(t||"-")}return c(e?.barcode||"-")}},{id:"description",labelKey:"reservations.details.table.headers.description",fallback:"Ø§Ù„ÙˆØµÙ",render:e=>{const t=String(e?.desc||e?.description||"-");return`<div class="quote-cell quote-cell--desc">${c(t)}</div>`}},{id:"quantity",labelKey:"reservations.details.table.headers.quantity",fallback:"Ø§Ù„ÙƒÙ…ÙŠØ©",render:e=>c(j(String(e?.qty||1)))},{id:"unitPrice",labelKey:null,fallback:"Ù„ÙƒÙ„ ÙŠÙˆÙ…",render:e=>c(j(Number(e?.unitPriceValue||0).toFixed(2)))},{id:"price",labelKey:null,fallback:"Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹",render:e=>c(j(Number(e?.price||0).toFixed(2)))}],jt=[{id:"rowNumber",labelKey:null,fallback:"#",render:(e,t)=>c(j(String(t+1)))},{id:"position",labelKey:"reservations.details.crew.position",fallback:"Ø§Ù„Ù…Ù†ØµØ¨",render:e=>c(j(e?.positionLabel??e?.position_name??e?.role??i("reservations.crew.positionFallback","Ù…Ù†ØµØ¨ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…")))},{id:"unitPrice",labelKey:null,fallback:"Ù„ÙƒÙ„ ÙŠÙˆÙ…",render:e=>{const t=Number.isFinite(Number(e?.positionClientPrice))?Number(e.positionClientPrice):0;return c(`${j(t.toFixed(2))} ${i("reservations.create.summary.currency","SR")}`)}},{id:"price",labelKey:null,fallback:"Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹",render:e=>{const t=Number.isFinite(Number(e?.positionClientPrice))?Number(e.positionClientPrice):0;return c(`${j(t.toFixed(2))} ${i("reservations.create.summary.currency","SR")}`)}}],He={customerInfo:[{id:"customerName",labelKey:"reservations.details.labels.customer",fallback:"Ø§Ù„Ø¹Ù…ÙŠÙ„"},{id:"customerCompany",labelKey:"reservations.details.labels.company",fallback:"Ø§Ù„Ø´Ø±ÙƒØ©"},{id:"customerPhone",labelKey:"reservations.details.labels.phone",fallback:"Ø§Ù„Ù‡Ø§ØªÙ"},{id:"customerEmail",labelKey:"reservations.details.labels.email",fallback:"Ø§Ù„Ø¨Ø±ÙŠØ¯"}],reservationInfo:[{id:"reservationId",labelKey:"reservations.details.labels.reservationId",fallback:"Ø±Ù‚Ù… Ø§Ù„Ø­Ø¬Ø²"},{id:"reservationStart",labelKey:"reservations.details.labels.start",fallback:"Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø­Ø¬Ø²"},{id:"reservationEnd",labelKey:"reservations.details.labels.end",fallback:"Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø­Ø¬Ø²"},{id:"reservationDuration",labelKey:"reservations.details.labels.duration",fallback:"Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…"}],projectInfo:[{id:"projectTitle",labelKey:"reservations.details.labels.project",fallback:"Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectCode",labelKey:"reservations.details.labels.code",fallback:"Ø§Ù„Ø±Ù…Ø²"}],financialSummary:[{id:"discountAmount",labelKey:"reservations.details.labels.discount",fallback:"Ø§Ù„Ø®ØµÙ…"},{id:"subtotalBeforeTax",labelKey:"reservations.details.labels.subtotalBeforeTax",fallback:"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"},{id:"taxAmount",labelKey:"reservations.details.labels.tax",fallback:"Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"},{id:"finalTotal",labelKey:"reservations.details.labels.total",fallback:"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ"}],payment:[{id:"beneficiary",labelKey:"reservations.quote.labels.beneficiary",fallback:"Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙÙŠØ¯"},{id:"bank",labelKey:"reservations.quote.labels.bank",fallback:"Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ"},{id:"account",labelKey:"reservations.quote.labels.account",fallback:"Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨"},{id:"iban",labelKey:"reservations.quote.labels.iban",fallback:"Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ¨Ø§Ù†"}],items:[...xt.map(({id:e,labelKey:t,fallback:n})=>({id:e,labelKey:t,fallback:n})),{id:"equipmentSubtotal",labelKey:"reservations.details.labels.equipmentTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"}],crew:[...jt.map(({id:e,labelKey:t,fallback:n})=>({id:e,labelKey:t,fallback:n})),{id:"crewSubtotal",labelKey:"reservations.details.labels.crewTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±ÙŠÙ‚"}]},Nn=[{id:"rowNumber",labelKey:null,fallback:"#",render:(e,t)=>c(j(String(t+1)))},{id:"label",labelKey:null,fallback:"Ø§Ù„Ø¨Ù†Ø¯",render:e=>c(e?.label||"-")},{id:"amount",labelKey:null,fallback:"Ø§Ù„Ø³Ø¹Ø±",render:e=>{const t=Number.isFinite(Number(e?.salePrice??e?.sale_price))?Number(e?.salePrice??e?.sale_price):Number(e?.amount??0)||0;return c(V(t,i("reservations.create.summary.currency","SR")))}},{id:"note",labelKey:null,fallback:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª",render:e=>c(e?.note||"-")}],Sa=[{id:"customerInfo",labelKey:"projects.quote.sections.customer",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„",defaultSelected:!0},{id:"projectInfo",labelKey:"projects.quote.sections.project",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",defaultSelected:!0},{id:"projectExpenses",labelKey:"projects.quote.sections.expenses",fallback:"Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©",defaultSelected:!0},{id:"projectCrew",labelKey:"projects.quote.sections.crew",fallback:"Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„",defaultSelected:!0},{id:"financialSummary",labelKey:"projects.quote.sections.financial",fallback:"Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ",defaultSelected:!0},{id:"projectEquipment",labelKey:"projects.quote.sections.equipment",fallback:"Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",defaultSelected:!0},{id:"projectNotes",labelKey:"projects.quote.sections.notes",fallback:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",defaultSelected:!0},{id:"payment",labelKey:"reservations.quote.sections.payment",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹",defaultSelected:!1}],Aa={customerInfo:He.customerInfo,projectInfo:[{id:"projectTitle",labelKey:"projects.details.overview.heading",fallback:"Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectCode",labelKey:"projects.details.labels.code",fallback:"Ø±Ù‚Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectType",labelKey:"projects.details.type",fallback:"Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectStart",labelKey:"projects.details.start",fallback:"Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectEnd",labelKey:"projects.details.end",fallback:"Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectDuration",labelKey:"projects.details.duration",fallback:"Ù…Ø¯Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectStatus",labelKey:"projects.details.status",fallback:"Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"}],financialSummary:[{id:"reservationsTotal",labelKey:"projects.details.reservationsTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª"},{id:"discountAmount",labelKey:"projects.details.summary.discount",fallback:"Ø§Ù„Ø®ØµÙ…"},{id:"taxAmount",labelKey:"projects.details.summary.combinedTax",fallback:"Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"},{id:"overallTotal",labelKey:"projects.details.summary.overallTotal",fallback:"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ"}],payment:He.payment,projectExpenses:[...Nn.map(({id:e,labelKey:t,fallback:n})=>({id:e,labelKey:t,fallback:n})),{id:"expensesSubtotal",labelKey:"projects.details.expensesTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©"}],projectCrew:[...jt.map(({id:e,labelKey:t,fallback:n})=>({id:e,labelKey:t,fallback:n})),{id:"quantity",labelKey:"reservations.details.table.headers.quantity",fallback:"Ø§Ù„ÙƒÙ…ÙŠØ©"},{id:"days",labelKey:null,fallback:"Ø§Ù„Ø£ÙŠØ§Ù…"},{id:"crewSubtotal",labelKey:"reservations.details.labels.crewTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±ÙŠÙ‚"}],projectEquipment:[...xt.map(({id:e,labelKey:t,fallback:n})=>({id:e,labelKey:t,fallback:n})),{id:"days",labelKey:null,fallback:"Ø§Ù„Ø£ÙŠØ§Ù…"},{id:"equipmentSubtotal",labelKey:"reservations.details.labels.equipmentTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"}],projectNotes:[]},It=new Map;function $t(e="reservation"){if(It.has(e))return It.get(e);const t=e==="project"?Sa:e==="reservationChecklist"?[{id:"customerInfo",labelKey:"reservations.quote.sections.customer",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„",defaultSelected:!0},{id:"reservationInfo",labelKey:"reservations.quote.sections.reservation",fallback:"ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²",defaultSelected:!0},{id:"projectInfo",labelKey:"reservations.quote.sections.project",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",defaultSelected:!0},{id:"notes",labelKey:"reservations.quote.sections.notes",fallback:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø­Ø¬Ø²",defaultSelected:!0},{id:"items",labelKey:"reservations.quote.sections.items",fallback:"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",defaultSelected:!0},{id:"crew",labelKey:"reservations.quote.sections.crew",fallback:"Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„",defaultSelected:!0}]:qa,n=e==="project"?Aa:e==="reservationChecklist"?{customerInfo:He.customerInfo,reservationInfo:He.reservationInfo,projectInfo:He.projectInfo,notes:[],items:He.items,crew:He.crew}:He,a=new Set(t.map(({id:o})=>o)),s=Object.fromEntries(Object.entries(n).map(([o,r=[]])=>[o,new Set(r.map(p=>p.id))])),l={sectionDefs:t,fieldDefs:n,sectionIdSet:a,fieldIdMap:s};return It.set(e,l),l}function Tt(e="reservation"){return $t(e).sectionDefs}function Cn(e="reservation"){return $t(e).fieldDefs}function In(e="reservation"){return $t(e).sectionIdSet}function Pn(e="reservation"){return $t(e).fieldIdMap}function Dn(e){switch(e){case"export":return i("reservations.quote.status.exporting","Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ù…Ù„Ù PDF...");case"render":default:return i("reservations.quote.status.rendering","Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©...")}}const _a="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js",ka="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js",xa="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js",Fn=ma.trim(),Ln=`
@font-face { font-family: 'Tajawal'; font-style: normal; font-weight: 400; font-display: swap; src: url(${JSON.stringify(ha)}) format('truetype'); }
@font-face { font-family: 'Tajawal'; font-style: normal; font-weight: 500; font-display: swap; src: url(${JSON.stringify(ba)}) format('truetype'); }
@font-face { font-family: 'Tajawal'; font-style: normal; font-weight: 600; font-display: swap; src: url(${JSON.stringify(un)}) format('truetype'); }
@font-face { font-family: 'Tajawal'; font-style: normal; font-weight: 700; font-display: swap; src: url(${JSON.stringify(un)}) format('truetype'); }
`,Mn=/^data:image\/svg\+xml/i,ja=/\.svg($|[?#])/i,rt=512,Ft="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/B8AAusB9YwpClgAAAAASUVORK5CYII=",Rn=96,Kn=25.4,Lt=210,mt=297,ft=Math.round(Lt/Kn*Rn),yt=Math.round(mt/Kn*Rn);function he(e){const t=Number(e),n=Number.isFinite(t)?t:0;try{const a=Math.abs(n%1)>1e-9;return j(n.toLocaleString("en-US",{minimumFractionDigits:a?2:0,maximumFractionDigits:2}))}catch{return Number.isInteger(n)?j(String(n)):j(n.toFixed(2))}}let gt=!1,wt=null;function Vt(){gt||(wt=async function(){try{if(!u||!w?.modal?.classList.contains("show")||(u.context||"reservation")!=="reservation")return;const n=u.reservation;if(!n)return;const a=[n.id,n.reservationId,n.reservation_id,n.reservationCode,n.reservation_code].map(h=>h==null?"":String(h)).filter(h=>h.length>0);if(!a.length)return;const s=Sn(),l=(Array.isArray(s)?s:[]).find(h=>[h?.id,h?.reservationId,h?.reservation_id,h?.reservationCode,h?.reservation_code].map(q=>q==null?"":String(q)).filter(q=>q.length>0).some(q=>a.includes(q)));if(!l)return;const o=Ct(l),{totalsDisplay:r,totals:p,rentalDays:y}=tn(l,o,u.project);u.reservation=l,u.crewAssignments=o,u.totals=p,u.totalsDisplay=r,u.rentalDays=y,Ht(),Pe()}catch(t){console.warn("[reservationPdf] live update failed",t)}},document.addEventListener("reservations:changed",wt),gt=!0)}function Bn(){if(gt){try{document.removeEventListener("reservations:changed",wt)}catch{}wt=null,gt=!1}}const On=2,Hn=/safari/i,$a=/(iphone|ipad|ipod)/i,pn=/(iphone|ipad|ipod)/i,Ta=/(crios|fxios|edgios|opios)/i,qt="[reservations/pdf]";let w=null,u=null,Ce=1,st=null,ot=null,Qe=null,Ze=null,it=!1;function Ge(e="render",{message:t,actionLabel:n,onAction:a,showSpinner:s=e!=="error"}={}){if(!w?.statusIndicator||!w?.statusText)return;w.statusKind=e;const l=t||Dn(e);w.statusText.textContent=l,w.statusSpinner&&(w.statusSpinner.hidden=!s),w.statusAction&&(w.statusAction.hidden=!0,w.statusAction.onclick=null,n&&typeof a=="function"&&(w.statusAction.textContent=n,w.statusAction.hidden=!1,w.statusAction.onclick=o=>{o.preventDefault(),a()})),w.statusIndicator.hidden=!1,requestAnimationFrame(()=>{w.statusIndicator.classList.add("is-visible")})}function et(e){try{return String(e||"").toLowerCase().normalize("NFKD").replace(/[\u064B-\u065F\u0670\u06D6-\u06ED]/g,"").replace(/\s+/g," ").trim()}catch{return String(e||"").trim().toLowerCase()}}function ct(e){!w?.statusIndicator||!w?.statusText||(w.statusKind=null,w.statusIndicator.classList.remove("is-visible"),setTimeout(()=>{w?.statusIndicator&&(w.statusIndicator.hidden=!0,w.statusAction&&(w.statusAction.hidden=!0,w.statusAction.onclick=null),w.statusSpinner&&(w.statusSpinner.hidden=!1))},220))}function Mt(){return!!window?.bootstrap?.Modal}function Ea(e){if(e&&!e.classList.contains("show")){e.classList.add("show"),e.style.display="block",e.removeAttribute("aria-hidden"),e.setAttribute("aria-modal","true"),e.getAttribute("role")||e.setAttribute("role","dialog"),document.body.classList.add("modal-open"),Qe||(Qe=document.createElement("div"),Qe.className="modal-backdrop fade show",Qe.dataset.quotePdfFallbackBackdrop="true",document.body.appendChild(Qe)),Ze||(Ze=t=>{t.key==="Escape"&&Rt(e)},document.addEventListener("keydown",Ze));try{e.focus({preventScroll:!0})}catch{}}}function Rt(e){if(!(!e||!e.classList.contains("show"))){try{const t=e.ownerDocument?.activeElement;if(t&&e.contains(t)){try{t.blur()}catch{}try{e.ownerDocument?.body?.focus({preventScroll:!0})}catch{}}}catch{}e.classList.remove("show"),e.style.display="none",e.setAttribute("aria-hidden","true"),e.removeAttribute("aria-modal"),document.body.classList.remove("modal-open"),Qe&&(Qe.remove(),Qe=null),Ze&&(document.removeEventListener("keydown",Ze),Ze=null);try{Bn()}catch{}}}function Na(e){if(e){if(Mt()){const t=window.bootstrap.Modal.getOrCreateInstance(e);try{const n=()=>{try{const a=document.activeElement;if(a&&e.contains(a)){try{a.blur()}catch{}try{document.body?.focus({preventScroll:!0})}catch{}}}catch{}try{Bn()}catch{}try{e.removeEventListener("hidden.bs.modal",n)}catch{}};e.addEventListener("hidden.bs.modal",n,{once:!0}),e.addEventListener("hide.bs.modal",()=>{try{const a=document.activeElement;if(a&&e.contains(a))try{a.blur()}catch{}}catch{}})}catch{}t.show();return}Ea(e)}}function Ca(){if(it)return;it=!0;const e=i("reservations.quote.toast.viewGuide","ðŸ“˜ Ø¹Ø±Ø¶ Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø­Ù„ Ø§Ù„Ø³Ø±ÙŠØ¹"),t=i("reservations.quote.toast.retry","Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©"),n=i("reservations.quote.toast.assetsFailed","âš ï¸ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø¨Ø¹Ø¶ Ø§Ù„ØµÙˆØ± Ø¶Ù…Ù† Ø¹Ø±Ø¶ Ø³Ø¹Ø±."),a=!!w?.modal?.classList.contains("show"),s=()=>{w?.modal?.classList.contains("show")&&(Ge("render"),it=!1,Pe())};gn({message:n,duration:9e3,actionLabel:a?t:void 0,onAction:a?s:void 0,linkLabel:e,linkHref:En}),a&&Ge("error",{message:n,actionLabel:t,onAction:s,showSpinner:!1})}function dt(e="reservation"){const t={},n=Cn(e);return Object.entries(n).forEach(([a,s=[]])=>{t[a]=new Set(s.filter(l=>l?.default!==!1).map(l=>l.id))}),t}function Wt(e={}){const t={};return Object.entries(e).forEach(([n,a])=>{t[n]=new Set(Array.from(a||[]))}),t}function Ia(e={},t){if(t)return e[t]||(e[t]=new Set),e[t]}function Gt(e={},t,n){const a=e?.[t];return a?a instanceof Set?a.has(n):Array.isArray(a)?a.includes(n):!!a?.[n]:!0}function Et(e="reservation"){return Object.fromEntries(Tt(e).map(({id:t})=>[t,!1]))}function Xt(e,t){return e.sectionExpansions||(e.sectionExpansions=Et(e.context||"reservation")),t&&typeof e.sectionExpansions[t]!="boolean"&&(e.sectionExpansions[t]=!1),e.sectionExpansions}function Pa(e,t){return Xt(e,t)?.[t]!==!1}function Jt(){return typeof window>"u"||typeof window.matchMedia!="function"?!1:window.matchMedia("(max-width: 768px)").matches}function Da(){if(typeof navigator>"u")return!1;const e=navigator.userAgent||navigator.platform||"";return $a.test(e)}function Fa(){if(typeof navigator>"u")return!1;const e=navigator.userAgent||"",t=Hn.test(e),n=e.includes("Chrome")||e.includes("CriOS")||e.includes("Chromium"),a=e.includes("Edg");return t&&!n&&!a}function Qn(){return Da()&&Fa()}function Nt(){if(typeof navigator>"u")return!1;const e=navigator.userAgent||"",t=navigator.platform||"",n=Number.isFinite(navigator.maxTouchPoints)?navigator.maxTouchPoints:0,a=pn.test(e)||pn.test(t),s=/Macintosh/i.test(e)&&n>1;return Hn.test(e)&&!Ta.test(e)&&(a||s)}function Pt(e,...t){try{console.log(`${qt} ${e}`,...t)}catch{}}function Ie(e,...t){try{console.warn(`${qt} ${e}`,...t)}catch{}}function La(e,t,...n){try{t?console.error(`${qt} ${e}`,t,...n):console.error(`${qt} ${e}`,...n)}catch{}}function me(e,{blockType:t="section",extraAttributes:n=""}={}){if(!e)return"";const a=n?` ${n.trim()}`:"";return e.replace(/^(<\w+)/,`$1 data-quote-block data-block-type="${t}"${a}`)}function Ma(e,t="Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¹Ø±Ø¶."){const n=c(i(e,t));return me(`<section class="quote-section quote-placeholder">${n}</section>`,{blockType:"placeholder"})}function St(e,t){return Array.isArray(e)&&e.length?e:[Ma(t)]}const Ra=/[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF]/;function Un(e=""){return Ra.test(e)}function Ka(){const e=window.CanvasRenderingContext2D?.prototype;if(!e||e.__artRatioDirectionPatched)return;const t=n=>{const a=e[n];typeof a=="function"&&(e[n]=function(l,...o){if(typeof l!="string"||!Un(l))return a.call(this,l,...o);let r,p=!1;try{"direction"in this&&(r=this.direction,r!=="rtl"&&(this.direction="rtl"),p=!0)}catch{}try{if(!p){const y=this.canvas;y&&y.style?.direction!=="rtl"&&(y.__artRatioOriginalDirection=y.style.direction,y.style.direction="rtl")}return a.call(this,l,...o)}finally{if(p&&r!==void 0&&r!=="rtl")try{this.direction=r}catch{}else if(!p){const y=this.canvas;y&&y.__artRatioOriginalDirection!==void 0&&(y.style.direction=y.__artRatioOriginalDirection,delete y.__artRatioOriginalDirection)}}})};t("fillText"),t("strokeText"),e.__artRatioDirectionPatched=!0}function mn(e,t=rt){if(typeof e!="string"&&typeof e!="number")return t;const n=parseFloat(String(e).replace(/[^0-9.+-]/g,""));return Number.isFinite(n)&&n>0?n:t}function Ba(e){if(!e)return{width:rt,height:rt};const t=e.getAttribute?.("width"),n=e.getAttribute?.("height");let a=t?mn(t,0):0,s=n?mn(n,0):0;if(a>0&&s>0)return{width:a,height:s};const l=e.getAttribute?.("viewBox");if(l){const o=l.trim().split(/[\s,]+/).map(r=>parseFloat(r||"0"));if(o.length>=4){const[,,r,p]=o;a=a||(Number.isFinite(r)&&r>0?r:0),s=s||(Number.isFinite(p)&&p>0?p:0)}}return{width:a||rt,height:s||rt}}function zn(e=""){return typeof e!="string"?!1:Mn.test(e)||ja.test(e)}function Oa(e=""){const t=e.indexOf(",");if(t===-1)return"";const n=e.slice(0,t),a=e.slice(t+1);try{return/;base64/i.test(n)?typeof atob=="function"?atob(a):"":decodeURIComponent(a)}catch(s){return console.warn("[reservations/pdf] failed to decode SVG data URI",s),""}}function Ha(e,{crossOrigin:t}={}){return new Promise((n,a)=>{const s=new Image;t&&(s.crossOrigin=t),s.onload=()=>n(s),s.onerror=l=>{const o=l?.message||`Unable to load image from ${e}`;a(new Error(o))},s.src=e})}async function Vn(e,t={}){if(!e)return null;const n=document,a=new Blob([e],{type:"image/svg+xml;charset=utf-8"}),s=URL.createObjectURL(a);try{const l=await Ha(s),o=n.createElement("canvas"),r=Math.max(t.width||l.naturalWidth||l.width||0,1),p=Math.max(t.height||l.naturalHeight||l.height||r,1);o.width=r,o.height=p;const y=o.getContext("2d");return y.clearRect(0,0,r,p),y.drawImage(l,0,0,r,p),o.toDataURL("image/png")}catch(l){return console.warn("[reservations/pdf] failed to rasterize SVG content",l),null}finally{URL.revokeObjectURL(s)}}async function Qa(e){if(!e)return null;if(Mn.test(e))return Oa(e);try{const t=await fetch(e,{mode:"cors",credentials:"omit",cache:"default"});return t.ok?await t.text():(console.warn("[reservations/pdf] failed to fetch SVG image",e,t.status),null)}catch(t){return console.warn("[reservations/pdf] error fetching SVG image",e,t),null}}async function Ua(e){if(!e)return!1;const t=e.getAttribute?.("src")||"";if(!zn(t))return!1;const n=await Qa(t);if(!n)return e.dataset.svgRasterization="failed",e.setAttribute("src",Ft),!1;const a=await Vn(n);return a?(e.dataset.svgOriginalSrc=t,e.setAttribute("src",a),e.setAttribute("data-rasterized","true"),!0):(e.dataset.svgRasterization="failed",e.setAttribute("src",Ft),!1)}async function za(e){if(!e||e.tagName?.toLowerCase()!=="svg")return!1;const n=new XMLSerializer().serializeToString(e),a=Ba(e),s=await Vn(n,a),o=(e.ownerDocument||document).createElement("img");o.setAttribute("src",s||Ft),o.setAttribute("alt",e.getAttribute("aria-label")||e.getAttribute("title")||""),o.setAttribute("data-svg-replaced","true"),e.hasAttribute("class")&&o.setAttribute("class",e.getAttribute("class")),e.hasAttribute("style")&&o.setAttribute("style",e.getAttribute("style"));const r=e.getAttribute("width"),p=e.getAttribute("height");return r&&o.setAttribute("width",r),p&&o.setAttribute("height",p),e.parentNode?.replaceChild(o,e),!!s}async function Wn(e){if(!e)return;const t=Array.from(e.querySelectorAll?.("img")||[]),n=Array.from(e.querySelectorAll?.("svg")||[]),a=[];t.forEach(s=>{zn(s.getAttribute?.("src"))&&a.push(Ua(s))}),n.forEach(s=>{a.push(za(s))}),a.length&&await Promise.allSettled(a)}function Va(e,{pixelRatio:t=1}={}){if(!e)return null;const n=e.ownerDocument||document,s=(n.defaultView||window).getComputedStyle?.(e);if(!s)return null;const l=(k,U=0)=>{const Y=parseFloat(k);return Number.isFinite(Y)?Y:U},o=l(s.paddingTop),r=l(s.paddingBottom),p=l(s.paddingRight),y=l(s.paddingLeft),h=l(s.borderRadius),T=l(s.fontSize,14),q=(()=>{const k=s.lineHeight;if(!k||k==="normal")return T*1.6;const U=l(k,T*1.6);return U>0?U:T*1.6})(),g=Math.max(e.clientWidth||0,e.scrollWidth||0,l(s.width,0));if(g<=0)return null;const v=Math.max(1,g-y-p),F=e.textContent||"",S=F.split(/\r?\n/),D=n.createElement("canvas"),x=D.getContext("2d");if(!x)return null;const Q=s.fontStyle||"normal",ne=s.fontVariant||"normal",ge=s.fontWeight||"400",b=s.fontFamily||"sans-serif",A=s.fontStretch||"normal",I=k=>k.join(" "),M=[],ae=k=>x.measureText(k).width;x.font=`${Q} ${ne} ${ge} ${A} ${T}px ${b}`,S.forEach(k=>{const U=k.trim();if(U.length===0){M.push("");return}const Y=U.split(/\s+/);let fe=[];Y.forEach((De,qe)=>{const Se=De.trim();if(!Se)return;const Ee=I(fe.concat(Se));if(ae(Ee)<=v||fe.length===0){fe.push(Se);return}M.push(I(fe)),fe=[Se]}),fe.length&&M.push(I(fe))}),M.length||M.push("");const $=o+r+M.length*q,N=Math.ceil(Math.max(1,g)*t),J=Math.ceil(Math.max(1,$)*t);D.width=N,D.height=J,D.style.width=`${Math.max(1,g)}px`,D.style.height=`${Math.max(1,$)}px`,x.scale(t,t);const oe=s.backgroundColor&&s.backgroundColor!=="rgba(0, 0, 0, 0)"?s.backgroundColor:"#ffffff";if(h>0){x.save(),x.beginPath();const k=Math.max(1,g),U=Math.max(1,$),Y=Math.min(h,k/2,U/2);x.moveTo(Y,0),x.lineTo(k-Y,0),x.quadraticCurveTo(k,0,k,Y),x.lineTo(k,U-Y),x.quadraticCurveTo(k,U,k-Y,U),x.lineTo(Y,U),x.quadraticCurveTo(0,U,0,U-Y),x.lineTo(0,Y),x.quadraticCurveTo(0,0,Y,0),x.closePath(),x.clip()}if(x.fillStyle=oe,x.fillRect(0,0,Math.max(1,g),Math.max(1,$)),x.font=`${Q} ${ne} ${ge} ${A} ${T}px ${b}`,x.fillStyle=s.color||"#000000",x.textBaseline="top",x.textAlign="right","direction"in x)try{x.direction="rtl"}catch{}const R=Math.max(0,g-p);let K=o;M.forEach(k=>{const U=k.length?k:" ";x.fillText(U,R,K,v),K+=q});const O=n.createElement("img");let de;try{de=D.toDataURL("image/png")}catch(k){return Ie("note canvas toDataURL failed",k),null}return O.src=de,O.alt=F,O.style.width=`${Math.max(1,g)}px`,O.style.height=`${Math.max(1,$)}px`,O.style.display="block",O.setAttribute("data-quote-note-image","true"),{image:O,canvas:D,totalHeight:$,width:g}}function Wa(e,{pixelRatio:t=1}={}){if(!e||!Nt())return;Array.from(e.querySelectorAll?.(".quote-notes")||[]).forEach(a=>{if(!a||a.dataset.quoteNoteRasterized==="true"||!Un(a.textContent||""))return;let s;try{s=Va(a,{pixelRatio:t})}catch(l){Ie("failed to rasterize note content",l),s=null}s&&(a.dataset.quoteNoteRasterized="true",a.innerHTML="",a.appendChild(s.image))})}function Kt(e,t="export",{toastMessage:n,suppressToast:a=!1}={}){La(`${t} failed`,e);const s=!!(e&&e.__artRatioPdfNotified);if(!a&&!s){const l=i("reservations.quote.errors.exportFailed","âš ï¸ ØªØ¹Ø°Ø± Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù PDFØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰."),o=n||l,r=i("reservations.quote.toast.viewGuide","ðŸ“˜ Ø¹Ø±Ø¶ Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø­Ù„ Ø§Ù„Ø³Ø±ÙŠØ¹"),p=i("reservations.quote.toast.retry","Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©"),y=["exportQuoteAsPdf","renderQuotePreview","layoutQuoteDocument","pageCapture"].includes(t),h=()=>{t==="exportQuoteAsPdf"?(Ge("export"),aa()):(Ge("render"),it=!1,Pe())};if(gn({message:o,duration:9e3,actionLabel:y?p:void 0,onAction:y?h:void 0,linkLabel:r,linkHref:En}),w?.modal?.classList.contains("show")&&Ge("error",{message:o,actionLabel:y?p:void 0,onAction:y?h:void 0,showSpinner:!1}),e&&typeof e=="object")try{Object.defineProperty(e,"__artRatioPdfNotified",{value:!0,writable:!1,enumerable:!1,configurable:!0})}catch{}}}function Bt({container:e,safariWindowRef:t,mobileWindowRef:n}={}){try{n&&!n.closed&&n.close()}catch(a){Ie("failed to close mobile window",a)}try{t&&!t.closed&&t.close()}catch(a){Ie("failed to close safari window",a)}e&&e.parentNode&&e.parentNode.removeChild(e)}function Yt(e){return new Promise((t,n)=>{const a=document.querySelector(`script[src="${e}"]`);if(a){a.addEventListener("load",()=>t()),a.addEventListener("error",l=>n(l)),a.readyState==="complete"&&t();return}const s=document.createElement("script");s.src=e,s.async=!0,s.onload=()=>t(),s.onerror=l=>n(l),document.head.appendChild(s)})}function fn(){const e=[window.jspdf?.jsPDF,typeof window.jspdf=="function"?window.jspdf:null,window.jsPDF?.jsPDF,typeof window.jsPDF=="function"?window.jsPDF:null].filter(t=>typeof t=="function");return e.length?e[0]:null}function yn(){return typeof window.html2canvas=="function"?window.html2canvas:null}async function Ga(){const e=yn();return e||(ot||(ot=Yt(ka).catch(t=>{throw ot=null,t}).then(()=>{const t=yn();if(!t)throw ot=null,new Error("ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© html2canvas Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.");return t})),ot)}async function Xa(){const e=fn();return e||(st||(st=Yt(xa).catch(t=>{throw st=null,t}).then(()=>{const t=fn();if(!t)throw st=null,new Error("ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© jsPDF Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.");return t})),st)}async function Ja(){if(window.html2pdf||await Yt(_a),window.html2pdf&&!window.html2pdf.__artRatioConfigured){const e=window.html2pdf.defaultOptions||window.html2pdf.defaultOpt||{},t={...e.html2canvas||{}};t.useCORS=!0,t.allowTaint=!1,t.logging=!0;const n={unit:"mm",format:"a4",orientation:"portrait",compress:!0,...e.jsPDF||{}},a={image:{type:"jpeg",quality:.95,...e.image||{}},margin:e.margin??[0,0,0,0],filename:e.filename||"document.pdf",html2canvas:t,jsPDF:n};window.html2pdf.defaultOptions=a,window.html2pdf.defaultOpt=a,window.html2pdf.__artRatioConfigured=!0}fa(),Ka()}function c(e=""){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function Ya(e="reservation"){return e==="project"?"QP":"Q"}function At(e,t="reservation"){const n=Number(e),a=Ya(t);return!Number.isFinite(n)||n<=0?`${a}-0001`:`${a}-${String(n).padStart(4,"0")}`}function Gn(e="reservation"){return e==="project"?"quote_project":"quote_reservation"}async function Za(e="reservation"){const t=Gn(e);try{const n=await Ut(`/sequence/?name=${encodeURIComponent(t)}`,{method:"POST"}),a=Number(n?.value),s=Number.isFinite(a)&&a>0?a:1;return{sequence:s,quoteNumber:At(s,e)}}catch(n){console.warn("âš ï¸ [reservations/pdf] sequence reservation failed, falling back to local",n);const a=window.localStorage?.getItem?.(Tn),l=(Number.isFinite(parseInt(a??"",10))?parseInt(a??"",10):0)+1;return{sequence:l,quoteNumber:At(l,e)}}}async function es(e="reservation"){const t=Gn(e);try{const n=await Ut(`/sequence/?name=${encodeURIComponent(t)}`,{method:"GET"}),a=Number(n?.value),s=Number.isFinite(a)&&a>=0?a+1:1;return{sequence:s,quoteNumber:At(s,e)}}catch(n){return console.warn("âš ï¸ [reservations/pdf] sequence peek failed, falling back to 1",n),{sequence:1,quoteNumber:At(1,e)}}}function Xn(e="reservation"){return dn[e]||dn.reservation}function ts(){try{window.localStorage?.removeItem?.(Tn)}catch{}}function ns(e="reservation"){try{ts();const t=Xn(e),n=window.localStorage?.getItem?.(t);if(!n)return null;const a=JSON.parse(n);return a&&typeof a=="object"?a:null}catch(t){return console.warn("âš ï¸ [reservations/pdf] failed to read toggle preferences",t),null}}function as(e,t="reservation"){try{const n=Xn(t);if(!e){window.localStorage?.removeItem?.(n);return}window.localStorage?.setItem?.(n,JSON.stringify(e))}catch(n){console.warn("âš ï¸ [reservations/pdf] failed to persist toggle preferences",n)}}function ss(e){if(!e)return{ids:null,emptyExplicitly:!1};if(e instanceof Set)return{ids:Array.from(e),emptyExplicitly:e.size===0};if(Array.isArray(e))return{ids:e.slice(),emptyExplicitly:e.length===0};if(typeof e=="object"){const t=Object.entries(e).filter(([,n])=>!!n);return{ids:t.map(([n])=>n),emptyExplicitly:t.length===0}}return{ids:null,emptyExplicitly:!1}}function os(e,t="reservation"){if(!e)return null;const n=In(t),a=Pn(t),s=Array.from(e.sections instanceof Set?e.sections:new Set(e.sections||[])).filter(r=>n.has(r)),l={},o=e.fields||{};return Object.entries(a).forEach(([r,p])=>{const y=o[r];if(y==null)return;const{ids:h,emptyExplicitly:T}=ss(y);if(!h&&!T)return;const q=Array.isArray(h)?h.filter(g=>p.has(g)):[];(q.length>0||T)&&(l[r]=q)}),{version:1,sections:s,fields:l}}function Jn(e){if(!e)return;const t=e.context||"reservation",n=os(e,t);n&&as(n,t)}function Zt(e){if(!e)return;const t=e.context||"reservation",n=ns(t);if(!n)return;const a=In(t),s=Array.isArray(n.sections)?n.sections.filter(l=>a.has(l)):[];if(s.length&&(e.sections=new Set(s)),n.fields&&typeof n.fields=="object"){const l=Wt(e.fields||dt(t)),o=Pn(t);Object.entries(n.fields).forEach(([r,p])=>{const y=o[r];if(!y)return;const h=Array.isArray(p)?p.filter(T=>y.has(T)):[];l[r]=new Set(h)}),e.fields=l}}function en(e=new Date){try{return e.toLocaleDateString("en-GB",{year:"numeric",month:"2-digit",day:"2-digit"})}catch{return e.toISOString().slice(0,10)}}function Ct(e){const t=da()||[],{technicians:n=[]}=Qt(),a=[].concat(Array.isArray(t)?t:[]).concat(Array.isArray(n)?n:[]),s=new Map;return a.forEach(o=>{if(!o||o.id==null)return;const r=String(o.id),p=s.get(r)||{};s.set(r,{...p,...o})}),(Array.isArray(e.crewAssignments)&&e.crewAssignments.length?e.crewAssignments:Array.isArray(e.techniciansDetails)&&e.techniciansDetails.length?e.techniciansDetails:(e.technicians||[]).map(o=>({technicianId:o}))).map((o,r)=>{const p=o?.technicianId!=null?s.get(String(o.technicianId)):null;let y=o.positionLabel??o.position_name??o.position_label??o.role??o.position??p?.role??i("reservations.crew.positionFallback","Ù…Ù†ØµØ¨ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…");(!y||y.trim()==="")&&(y=o.positionLabelAr??o.position_label_ar??o.positionLabelEn??o.position_label_en??o.position_name_ar??o.position_name_en??p?.role??i("reservations.crew.positionFallback","Ù…Ù†ØµØ¨ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…"));try{const q=typeof cn=="function"?cn()||[]:[];let g=null;if(o?.positionId!=null&&(g=q.find(v=>String(v?.id)===String(o.positionId))||null),!g){const v=o.positionKey??o.position_key??o.positionName??o.position_name??o.position??"";if(v&&(g=typeof ln=="function"&&ln(v)||null,!g&&q.length)){const F=String(v).trim().toLowerCase();g=q.find(S=>[S.name,S.labelAr,S.labelEn].filter(Boolean).map(D=>String(D).toLowerCase()).includes(F))||null}}if(g){const v=g.labelAr||g.labelEn||g.name||"";v&&v.trim()&&(y=v)}}catch{}const h=lt(bt(o.positionCost??o.position_cost??o.cost??o.daily_wage??o.dailyWage??p?.dailyWage??p?.wage??0)),T=lt(bt(o.positionClientPrice??o.position_client_price??o.client_price??o.clientPrice??o.daily_total??o.dailyTotal??o.total??p?.dailyTotal??p?.total??p?.total_wage??0));return{assignmentId:o.assignmentId??o.assignment_id??`crew-${r}`,positionId:o.positionId??o.position_id??null,positionLabel:y,positionLabelAlt:o.positionLabelAlt??o.position_label_alt??"",positionCost:h,positionClientPrice:T,technicianId:o.technicianId!=null?String(o.technicianId):p?.id!=null?String(p.id):null,technicianName:o.technicianName??o.technician_name??p?.name??null,technicianRole:o.technicianRole??p?.role??null}})}function tn(e,t,n){const{projectLinked:a}=ra(e,n);zt(e.start,e.end);const s=e.discount??e.discountValue??0,l=Number(j(String(s)))||0,o=e.discountType??e.discount_type??"percent",r=String(o).toLowerCase()==="amount"?"amount":"percent",p=a?!1:!!(e.applyTax??e.apply_tax??e.taxApplied),y=e.companySharePercent??e.company_share_percent??e.companyShare??e.company_share??null,h=y!=null?bt(y):Number.NaN,q=(e.companyShareEnabled??e.company_share_enabled??e.companyShareApplied??e.company_share_applied)===!0&&Number.isFinite(h)&&h>0?h:null,g=Array.isArray(t)?t.map(ne=>ne?.technicianId).filter(Boolean):[],v=wn({items:Array.isArray(e.items)?e.items:[],technicianIds:g,crewAssignments:Array.isArray(t)?t:[],discount:l,discountType:r,applyTax:p,start:e.start,end:e.end,companySharePercent:q,groupingSource:e}),F=bt(e.cost??e.total??e.finalTotal),S=Number.isFinite(F),D=a?v.finalTotal:S?lt(F):v.finalTotal,x={equipmentTotal:v.equipmentTotal,crewTotal:v.crewTotal,crewCostTotal:v.crewCostTotal,discountAmount:v.discountAmount,subtotalAfterDiscount:v.subtotalAfterDiscount,taxableAmount:v.taxableAmount,taxAmount:v.taxAmount,finalTotal:D,companySharePercent:v.companySharePercent,companyShareAmount:v.companyShareAmount,netProfit:v.netProfit},Q={equipmentTotal:he(v.equipmentTotal),crewTotal:he(v.crewTotal),discountAmount:he(v.discountAmount),subtotalAfterDiscount:he(v.subtotalAfterDiscount),taxableAmount:he(v.taxableAmount),taxAmount:he(v.taxAmount),finalTotal:he(D),companySharePercent:j((Number.isFinite(v.companySharePercent)?v.companySharePercent:0).toFixed(2)),companyShareAmount:he(v.companyShareAmount),netProfit:j(v.netProfit.toFixed(2))};return{totals:x,totalsDisplay:Q,rentalDays:v.rentalDays}}function nt(e){if(e==null||e==="")return null;const t=Number.parseFloat(j(String(e)));return Number.isFinite(t)?t:null}function Yn(e){if(!e)return new Date().toISOString();const t=new Date(e);return Number.isNaN(t.getTime())?new Date().toISOString():t.toISOString()}function rs(e){if(!e||typeof e!="object")return null;const t=e.type??e.payment_type??e.paymentType??null;let n=typeof t=="string"?t.trim().toLowerCase():null;n!=="percent"&&(n="amount");const a=nt(e.amount??(n==="amount"?e.value:null)),s=nt(e.percentage??(n==="percent"?e.value:null)),l=n==="percent"?s??null:a??null,o=e.note??e.memo??null,r=Yn(e.recordedAt??e.recorded_at??e.date??e.created_at??null);return n==="amount"&&a==null||n==="percent"&&s==null?null:{type:n,amount:a??null,percentage:s??null,value:l,note:o,recordedAt:r}}function is(e={}){const n=(Array.isArray(e.paymentHistory)?e.paymentHistory:Array.isArray(e.payment_history)?e.payment_history:[]).map(rs).filter(Boolean);if(n.length>0)return n;const a=nt(e.paidPercent??e.paid_percent),s=nt(e.paidAmount??e.paid_amount),l=e.updatedAt??e.updated_at??e.createdAt??e.created_at??null,o=Yn(l);return a!=null&&a>0?[{type:"percent",amount:s!=null&&s>0?s:null,percentage:a,value:a,note:null,recordedAt:o}]:s!=null&&s>0?[{type:"amount",amount:s,percentage:null,value:s,note:null,recordedAt:o}]:[]}function cs(e){if(!e)return i("projects.form.types.unknown","Ù†ÙˆØ¹ ØºÙŠØ± Ù…Ø­Ø¯Ø¯");const t={commercial:"projects.form.types.commercial",coverage:"projects.form.types.coverage",photography:"projects.form.types.photography",social:"projects.form.types.social"}[e]||"projects.form.types.unknown";return i(t,e)}function ls(e){const t=new Date,n=e?.start?new Date(e.start):null,a=e?.end?new Date(e.end):null;return n&&!Number.isNaN(n.getTime())&&n>t?"upcoming":a&&!Number.isNaN(a.getTime())&&a<t?"completed":"ongoing"}function us(e){if(Array.isArray(e?.expenses)&&e.expenses.some(a=>Number.isFinite(Number(a?.salePrice??a?.sale_price))))return e.expenses.reduce((a,s)=>a+(Number(s?.salePrice??s?.sale_price)||0),0);const t=Number(e?.servicesClientPrice??e?.services_client_price);return Number.isFinite(t)&&t>=0?t:typeof e?.expensesTotal=="number"?e.expensesTotal:Array.isArray(e?.expenses)?e.expenses.reduce((n,a)=>n+(Number(a?.amount)||0),0):0}function ds(e){if(!e)return 0;const t=Array.isArray(e.items)?e.items:[],n=e.discount??0,a=Number(j(String(n)))||0,s=e.discountType||"percent",l=Array.isArray(e.crewAssignments)?e.crewAssignments:[],o=l.length?l:Array.isArray(e.technicians)?e.technicians:[],r=ua(t,a,s,!1,o,{start:e.start,end:e.end,companySharePercent:0});if(Number.isFinite(r))return r;const p=Number(j(String(e.cost??0)));return Number.isFinite(p)?Math.round(p):0}function ps(e,t){if(!e)return"â€”";const n=tt(e);return t?`${n} - ${tt(t)}`:n}function V(e,t="SR",n=2){const a=Number(e);return`${he(a)} ${t}`}function hn(e,t=2){if(!Number.isFinite(Number(e)))return"0%";const n=Number.isInteger(t)?t:2;return`${j(Number(e).toFixed(n))}%`}function ms(e){if(!e?.start)return null;if(!e?.end)return 1;const t=zt(e.start,e.end);return Number.isFinite(t)?t:1}function fs(e){return Number.isFinite(e)?e<=1?"ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯":`${j(String(Math.round(e)))} Ø£ÙŠØ§Ù…`:"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}function bn(e){const t=i("reservations.create.summary.currency","SR"),n=Qt()||{},a=Array.isArray(n.customers)?n.customers:[],s=Array.isArray(n.projects)?n.projects:[],l=Array.isArray(n.technicians)?n.technicians:[];let o=[];try{const f=Sn?.()||[];o=Array.isArray(f)&&f.length?f:n.reservations||[]}catch{o=n.reservations||[]}const r=e?.id!=null?s.find(f=>String(f.id)===String(e.id))||e:e||null,p={projectStatusLabel:i("projects.status.ongoing","Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°"),paymentStatusLabel:i("projects.paymentStatus.unpaid","ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹")};if(!r)return{project:null,customer:null,clientInfo:{name:"-",company:"-",phone:"-",email:"-"},projectInfo:{title:"-",code:"-",typeLabel:"-",startDisplay:"-",endDisplay:"-",durationLabel:"-",statusLabel:p.projectStatusLabel},expenses:[],equipment:[],reservations:[],totals:{equipmentEstimate:0,expensesTotal:0,baseSubtotal:0,discountAmount:0,subtotalAfterDiscount:0,companyShareAmount:0,subtotal:0,applyTax:!1,taxAmount:0,totalWithTax:0},totalsDisplay:{projectSubtotal:V(0,t),expensesTotal:V(0,t),reservationsTotal:V(0,t),discountAmount:V(0,t),taxAmount:V(0,t),overallTotal:V(0,t),paidAmount:V(0,t),remainingAmount:V(0,t)},projectTotals:{combinedTaxAmount:0,overallTotal:0,reservationsTotal:0,paidAmount:0,paidPercent:0,remainingAmount:0,paymentStatus:"unpaid"},paymentSummary:{status:"unpaid",statusLabel:p.paymentStatusLabel,paidAmount:0,paidPercent:0,remainingAmount:0,paidAmountDisplay:V(0,t),remainingAmountDisplay:V(0,t),paidPercentDisplay:hn(0)},notes:"",currencyLabel:t,projectStatus:"ongoing",projectStatusLabel:p.projectStatusLabel,projectDurationDays:null,projectDurationLabel:"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",paymentHistory:[]};const y=r.clientId??r.customerId??r.client_id??r.customer_id??null,h=y!=null&&a.find(f=>String(f.id)===String(y))||null,T=h?.customerName??h?.name??r.clientName??r.customerName??i("projects.fallback.unknownClient","Ø¹Ù…ÙŠÙ„ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"),q=(r.clientCompany||h?.companyName||h?.company||"").trim(),g=h?.phone??h?.customerPhone??r.clientPhone??r.customerPhone??"",v=g?j(String(g).trim()):i("projects.details.client.noPhone","Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù‚Ù… Ù…ØªØ§Ø­"),F=h?.email??r.clientEmail??r.customerEmail??"",S=F?String(F).trim():i("projects.details.client.noEmail","Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨Ø±ÙŠØ¯ Ù…ØªØ§Ø­"),D=r.projectCode||`PRJ-${j(String(r.id??""))}`,x=j(String(D)),Q=(r.title||"").trim()||i("projects.fallback.untitled","Ù…Ø´Ø±ÙˆØ¹ Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†"),ne=cs(r.type),ge=r.start?tt(r.start):"â€”",b=r.end?tt(r.end):"â€”",A=ms(r),I=A!=null?fs(A):"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",M=ls(r),ae={upcoming:"Ù‚Ø§Ø¯Ù…",ongoing:"Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°",completed:"Ù…ÙƒØªÙ…Ù„"},$=i(`projects.status.${M}`,ae[M]||M),N=r.id!=null?String(r.id):null,J=N?o.filter(f=>{const ee=f?.projectId??f?.project_id??null;return ee!=null&&String(ee)===N}):[];J.map(f=>{const ee=f.reservationId||f.id||"",_=f.status||f.state||"pending",ie=String(_).toLowerCase(),ce=i(`reservations.status.${ie}`,ie),ye=ds(f),$e=f.start?new Date(f.start).getTime():0;return{reservationId:j(String(ee||"-")),status:ie,statusLabel:ce,total:ye,totalLabel:V(ye,t),dateRange:ps(f.start,f.end),startTimestamp:Number.isNaN($e)?0:$e}}).sort((f,ee)=>ee.startTimestamp-f.startTimestamp).map(({startTimestamp:f,...ee})=>ee);let oe=0,R=0;try{J.forEach(f=>{const ee=wn({items:Array.isArray(f.items)?f.items:[],technicianIds:Array.isArray(f.technicians)?f.technicians:[],crewAssignments:Array.isArray(f.crewAssignments)?f.crewAssignments:[],discount:Number(f.discount??0)||0,discountType:f.discountType||"percent",applyTax:!1,start:f.start,end:f.end,groupingSource:f,companySharePercent:0});oe+=Number(ee.equipmentTotal||0),R+=Number(ee.crewTotal||0)})}catch{}const K=us(r),O=Number(oe+R+K),de=[];try{J.forEach(f=>{const{groups:ee}=qn(f);ee.forEach(_=>{const ie=Number(_?.count??_?.quantity??1)||1,ce=Number(_?.unitPrice);let ye=Number.isFinite(ce)?ce:0;if(!ye||ye<=0){const le=Number(_?.totalPrice);Number.isFinite(le)&&ie>0&&(ye=Number((le/ie).toFixed(2)))}Number.isFinite(ye)||(ye=0);const $e=_?.type==="package"||Array.isArray(_?.items)&&_.items.some(le=>le?.type==="package"),Ne=Array.isArray(_?.barcodes)&&_.barcodes.length?_.barcodes[0]:Array.isArray(_?.items)&&_.items.length?_.items[0]?.barcode:null;let d=_?.packageDisplayCode??_?.package_code??_?.code??_?.packageCode??(Array.isArray(_?.items)&&_.items.length?_.items[0]?.package_code??_.items[0]?.code??_.items[0]?.packageCode:null);const L=le=>{const X=(le==null?"":String(le)).trim();return!!(!X||/^pkg-/i.test(X)||/^\d+$/.test(X)&&X.length<=4)};if(!d||L(d)){const le=_?.packageId??_?.package_id??(Array.isArray(_?.items)&&_.items.length?_.items[0]?.packageId??_.items[0]?.package_id:null);if(le)try{const X=An(le);X&&X.package_code&&(d=X.package_code)}catch{}}if(!d||L(d))try{const le=et(_?.description||"");if(le){const X=_n();let Z=X.find(se=>et(se?.name||se?.title||se?.label||"")===le);Z||(Z=X.find(se=>{const z=et(se?.name||se?.title||se?.label||"");return z.includes(le)||le.includes(z)})),Z&&Z.package_code&&(d=Z.package_code)}}catch{}const G=$e?d??Ne??"":_?.barcode??Ne??"",pe=G!=null?String(G):"",Te=Number.isFinite(Number(_?.totalPrice))?Number(_.totalPrice):Number((ye*ie).toFixed(2));de.push({..._,isPackage:$e,desc:_?.description,barcode:pe,packageCodeResolved:d||"",qty:ie,price:ye,totalPrice:lt(Te),unitPriceValue:ye})})})}catch{}const k=new Map;J.forEach(f=>{const ee=Array.isArray(f.items)?f.items:[],_=zt(f.start,f.end),ie=f.reservationId||f.id||"";ee.forEach((ce,ye)=>{if(!ce)return;const $e=ce.barcode||ce.code||ce.id||ce.desc||ce.description||`item-${ye}`,Ne=String($e||`item-${ye}`),d=k.get(Ne)||{description:ce.desc||ce.description||ce.name||ce.barcode||`#${j(String(ye+1))}`,totalQuantity:0,reservationsCount:0,reservationIds:new Set,totalCost:0},L=Number(ce.qty)||1,G=Number(ce.price)||0;d.totalQuantity+=L,d.reservationIds.add(String(ie));const pe=G*L*Math.max(1,_);Number.isFinite(pe)&&(d.totalCost+=pe),k.set(Ne,d)})});const U=Array.from(k.values()).map(f=>({description:f.description,totalQuantity:f.totalQuantity,reservationsCount:f.reservationIds.size,displayCost:V(f.totalCost,t)})),Y=new Map((l||[]).filter(Boolean).map(f=>[String(f.id),f])),fe=new Map,De=f=>{if(!f)return;let ee=null;typeof f=="object"?ee=f.id??f.technicianId??f.technician_id??f.userId??f.user_id??null:(typeof f=="string"||typeof f=="number")&&(ee=f);const _=ee!=null?String(ee):null,ie=_&&Y.has(_)?Y.get(_):typeof f=="object"?f:null,ce=ie?.name||ie?.full_name||ie?.fullName||ie?.displayName||(typeof f=="string"?f:null),ye=ie?.role||ie?.title||null,$e=ie?.phone||ie?.mobile||ie?.contact||null;if(!ce&&!_)return;const Ne=_||ce;fe.has(Ne)||fe.set(Ne,{id:_,name:ce||"-",role:ye||null,phone:$e||null})};Array.isArray(r?.technicians)&&r.technicians.forEach(f=>De(f)),J.forEach(f=>{(Array.isArray(f.crewAssignments)&&f.crewAssignments.length?f.crewAssignments:Array.isArray(f.technicians)?f.technicians.map(_=>({technicianId:_})):[]).forEach(_=>De(_))});const qe=Array.from(fe.values()),Se=Array.isArray(r.expenses)?r.expenses.map(f=>{const ee=Number(f?.salePrice??f?.sale_price??f?.amount)||0;return{label:f?.label||f?.name||"-",amount:ee,displayAmount:V(ee,t),note:f?.note||f?.description||""}}):[],Ee=r?.applyTax===!0||r?.applyTax==="true",Be=Number.parseFloat(r?.discount??r?.discountValue??0)||0;let Ae=(r?.discountType==="amount"?"amount":"percent")==="amount"?Be:O*(Be/100);(!Number.isFinite(Ae)||Ae<0)&&(Ae=0),Ae>O&&(Ae=O);const _e=Math.max(0,O-Ae),at=r?.companyShareEnabled===!0||r?.company_share_enabled===!0||r?.companyShareApplied===!0||r?.company_share_applied===!0,Fe=Number.parseFloat(r?.companySharePercent??r?.company_share_percent??r?.companyShare??r?.company_share??0)||0,Ue=at&&Fe>0?Fe:0,Oe=Ue>0?Number((_e*(Ue/100)).toFixed(2)):0,we=Number((_e+Oe).toFixed(2)),je=Ee?Number((we*pa).toFixed(2)):0,ke=Number((we+je).toFixed(2)),Le=is(r),Je=nt(r.paidAmount??r.paid_amount)||0,Ye=nt(r.paidPercent??r.paid_percent)||0,m=ca({totalAmount:ke,paidAmount:Je,paidPercent:Ye,history:Le}),P=typeof r.paymentStatus=="string"?r.paymentStatus.toLowerCase():"",C=la({manualStatus:P,paidAmount:m.paidAmount,paidPercent:m.paidPercent,totalAmount:ke}),W={paid:"Ù…Ø¯ÙÙˆØ¹",partial:"Ù…Ø¯ÙÙˆØ¹ Ø¬Ø²Ø¦ÙŠØ§Ù‹",unpaid:"ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹"},B=i(`projects.paymentStatus.${C}`,W[C]||C),E=Number(m.paidAmount||0),H=Number(m.paidPercent||0),re=Math.max(0,Number((ke-E).toFixed(2))),Me={projectSubtotal:V(we,t),expensesTotal:V(K,t),reservationsTotal:V(we,t),discountAmount:V(Ae,t),taxAmount:V(je,t),overallTotal:V(ke,t),paidAmount:V(E,t),remainingAmount:V(re,t)},ze={status:C,statusLabel:B,paidAmount:E,paidPercent:H,remainingAmount:re,paidAmountDisplay:V(E,t),remainingAmountDisplay:V(re,t),paidPercentDisplay:hn(H)},Re=(r.description||"").trim();return{project:r,customer:h,clientInfo:{name:T,company:q||"â€”",phone:v,email:S},projectInfo:{title:Q,code:x,typeLabel:ne,startDisplay:ge,endDisplay:b,durationLabel:I,statusLabel:$},expenses:Se,equipment:U,crew:qe,equipmentItems:de,crewAssignments:J.flatMap(f=>Ct(f)),totals:{equipmentEstimate:oe,expensesTotal:K,baseSubtotal:O,discountAmount:Ae,subtotalAfterDiscount:_e,companyShareAmount:Oe,subtotal:we,applyTax:Ee,taxAmount:je,totalWithTax:ke},totalsDisplay:Me,projectTotals:{combinedTaxAmount:je,overallTotal:ke,reservationsTotal:we,paidAmount:E,paidPercent:H,remainingAmount:re,paymentStatus:C},paymentSummary:ze,notes:Re,currencyLabel:t,projectStatus:M,projectStatusLabel:$,projectDurationDays:A,projectDurationLabel:I,paymentHistory:Le}}function ys({project:e,clientInfo:t={},projectInfo:n={},projectCrew:a=[],projectExpenses:s=[],projectEquipment:l=[],totalsDisplay:o={},projectTotals:r={},paymentSummary:p={},currencyLabel:y="SR",sections:h,fieldSelections:T={},quoteNumber:q,quoteDate:g,terms:v=xe}){const F=Wt(T),S=(m,P)=>Gt(F,m,P),D=m=>h?.has?.(m),x=`<div class="quote-placeholder">${c(i("reservations.quote.placeholder.noFields","Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù„Ù„Ø¹Ø±Ø¶ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…."))}</div>`,Q=(m,P)=>`<div class="info-plain__item">
      <span class="info-plain__label">${c(m)}</span>
      <span class="info-plain__separator">:</span>
      <span class="info-plain__value">${c(P)}</span>
    </div>`,ne=(m,P,{variant:C="inline"}={})=>C==="final"?`<div class="totals-item totals-item--final">
        <span class="totals-item__label">${c(m)}</span>
        <span class="totals-item__slash">/</span>
        <span class="totals-item__value">${c(P)}</span>
      </div>`:`<span class="totals-inline__item">
      <span class="totals-inline__label">${c(m)}</span>
      <span class="totals-inline__slash">/</span>
      <span class="totals-inline__value">${c(P)}</span>
    </span>`,ge=(m,P)=>`<div class="payment-row">
      <span class="payment-row__label">${c(m)}</span>
      <span class="payment-row__slash">/</span>
      <span class="payment-row__value">${c(P)}</span>
    </div>`,b=[];S("customerInfo","customerName")&&b.push(Q(i("projects.details.client","Ø§Ù„Ø¹Ù…ÙŠÙ„"),t.name||"-")),S("customerInfo","customerCompany")&&b.push(Q(i("projects.details.company","Ø´Ø±ÙƒØ© Ø§Ù„Ø¹Ù…ÙŠÙ„"),t.company||"â€”")),S("customerInfo","customerPhone")&&b.push(Q(i("projects.details.labels.clientPhone","Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„"),t.phone||"-")),S("customerInfo","customerEmail")&&b.push(Q(i("projects.details.labels.clientEmail","Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"),t.email||"-"));const A=D("customerInfo")?`<section class="quote-section quote-section--plain quote-section--customer">
        <h3 class="quote-section__title">${c(i("projects.quote.sections.customer","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„"))}</h3>
        ${b.length?`<div class="info-plain">${b.join("")}</div>`:x}
      </section>`:"",I=[];S("projectInfo","projectType")&&I.push(Q(i("projects.details.type","Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.typeLabel||"-")),S("projectInfo","projectTitle")&&I.push(Q(i("projects.details.projectTitle","Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.title||"-")),S("projectInfo","projectCode")&&I.push(Q(i("projects.details.labels.code","Ø±Ù‚Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.code||"-")),S("projectInfo","projectStart")&&I.push(Q(i("projects.details.start","Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.startDisplay||"-")),S("projectInfo","projectEnd")&&I.push(Q(i("projects.details.end","Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.endDisplay||"-")),S("projectInfo","projectDuration")&&I.push(Q(i("projects.details.duration","Ù…Ø¯Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.durationLabel||"-")),S("projectInfo","projectStatus")&&I.push(Q(i("projects.details.status","Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.statusLabel||"-"));const M=D("projectInfo")?`<section class="quote-section quote-section--plain quote-section--project">
        <h3 class="quote-section__title">${c(i("projects.quote.sections.project","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"))}</h3>
        ${I.length?`<div class="info-plain">${I.join("")}</div>`:x}
      </section>`:"",ae=jt.filter(m=>S("projectCrew",m.id)),$=Array.isArray(u?.crewAssignments)?u.crewAssignments:[],N=m=>{const P=m&&m.positionId!=null?`id:${String(m.positionId)}`:(()=>{const B=(m?.positionLabel||m?.position_name||m?.position||"").trim().toLowerCase();return B?`label:${B}`:""})(),C=Number.isFinite(Number(m?.positionClientPrice))?Number(m.positionClientPrice):0,W=C>0?`|p:${C.toFixed(2)}`:"";return`${P}${W}`};(()=>{const m=new Map;return $.forEach(P=>{const C=N(P);C&&m.set(C,(m.get(C)||0)+1)}),m})();const J=(()=>{const m=[];if(ae.forEach(E=>{E.id==="position"?(m.push({...E,render:H=>{const re=H?.positionLabel??H?.position_name??H?.role??i("reservations.crew.positionFallback","Ù…Ù†ØµØ¨ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…");return c(j(String(re)))}}),S("projectCrew","quantity")&&m.push({id:"quantity",labelKey:"reservations.details.table.headers.quantity",fallback:"Ø§Ù„ÙƒÙ…ÙŠØ©",render:H=>c(j(String(Math.max(1,Number(H?.__count||1)))))})):E.id==="price"?m.push({...E,render:H=>{const re=Number.isFinite(Number(H?.positionClientPrice))?Number(H.positionClientPrice):0,Me=Math.max(1,Number(H?.__count||1)),ze=Math.max(1,Number(u?.rentalDays||1)),Re=re*Me*ze;return c(`${he(Re)} ${i("reservations.create.summary.currency","SR")}`)}}):E.id==="unitPrice"?m.push({...E,render:H=>{const re=Number.isFinite(Number(H?.positionClientPrice))?Number(H.positionClientPrice):0;return c(`${he(re)} ${i("reservations.create.summary.currency","SR")}`)}}):m.push(E)}),S("projectCrew","days")){const E=Math.max(1,Number(u?.rentalDays||1)),H=m.findIndex(Me=>Me.id==="price"),re=Math.max(0,H);m.splice(re,0,{id:"days",labelKey:null,fallback:"Ø§Ù„Ø£ÙŠØ§Ù…",render:()=>c(j(String(E)))})}const P=new Map(m.map(E=>[E.id,E])),C=new Set,W=[],B=E=>{const H=P.get(E);H&&!C.has(E)&&(W.push(H),C.add(E))};return B("rowNumber"),B("position"),B("unitPrice"),B("quantity"),B("days"),B("price"),m.forEach(E=>{C.has(E.id)||(W.push(E),C.add(E.id))}),W})(),oe=(()=>{const m=new Map;return $.forEach(P=>{const C=N(P);if(!C)return;const W=m.get(C);W?W.__count+=1:m.set(C,{...P,__count:1})}),Array.from(m.values())})(),R=(()=>{try{const m=Math.max(1,Number(u?.rentalDays||1)),P=(oe||[]).reduce((C,W)=>{const B=Number.isFinite(Number(W?.positionClientPrice))?Number(W.positionClientPrice):0,E=Math.max(1,Number(W?.__count||1));return C+B*E*m},0);return he(P)}catch{return"0.00"}})(),K=D("projectCrew")?J.length?`<section class="quote-section quote-section--table">
            <h3>${c(i("projects.quote.sections.crew","Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„"))}</h3>
            <table class="quote-table">
              <thead>
                <tr>${J.map(m=>`<th>${c(m.labelKey?i(m.labelKey,m.fallback):m.fallback)}</th>`).join("")}</tr>
              </thead>
              <tbody>${oe.length?oe.map((m,P)=>`<tr>${J.map(C=>`<td><div class="quote-cell">${C.render(m,P)}</div></td>`).join("")}</tr>`).join(""):`<tr><td colspan="${Math.max(J.length,1)}" class="empty">${c(i("projects.details.crew.empty","Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ø§Ù‚Ù… ÙÙ†ÙŠ Ù…Ø±ØªØ¨Ø·."))}</td></tr>`}
              </tbody>
            </table>
            ${S("projectCrew","crewSubtotal")?`
              <div class="quote-table-subtotal">
                <span class="quote-table-subtotal__pill">
                  <span class="quote-table-subtotal__label">${c(i("reservations.details.labels.crewTotal","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±ÙŠÙ‚"))}</span>
                  <span class="quote-table-subtotal__value">${c(`${R} ${y}`)}</span>
                </span>
              </div>
            `:""}
          </section>`:`<section class="quote-section quote-section--table">
            <h3>${c(i("projects.quote.sections.crew","Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„"))}</h3>
            ${x}
          </section>`:"",O=[];S("financialSummary","discountAmount")&&O.push(ne(i("reservations.details.labels.discount","Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ…"),o.discountAmount||V(0,y)));const de=i("projects.details.summary.preTaxTotal","Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©");S("financialSummary","reservationsTotal")&&O.push(ne(de,o.reservationsTotal||V(0,y))),S("financialSummary","taxAmount")&&O.push(ne(i("projects.details.summary.combinedTax","Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"),o.taxAmount||V(0,y)));const k=[];S("financialSummary","overallTotal")&&k.push(ne(i("projects.details.summary.overallTotal","Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ"),o.overallTotal||V(0,y),{variant:"final"}));const U=D("financialSummary")?!O.length&&!k.length?`<section class="quote-section quote-section--financial">${x}</section>`:`<section class="quote-section quote-section--financial">
          <div class="totals-block">
            <h3>${c(i("projects.quote.sections.financial","Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ"))}</h3>
            ${O.length?`<div class="totals-inline">${O.join("")}</div>`:""}
            ${k.length?`<div class="totals-final">${k.join("")}</div>`:""}
          </div>
        </section>`:"",Y=Nn.filter(m=>S("projectExpenses",m.id)),fe=D("projectExpenses")?Y.length?`<section class="quote-section quote-section--table">
            <h3>${c(i("projects.quote.sections.expenses","Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©"))}</h3>
            <table class="quote-table">
              <thead>
                <tr>${Y.map(m=>`<th>${c(m.labelKey?i(m.labelKey,m.fallback):m.fallback)}</th>`).join("")}</tr>
              </thead>
              <tbody>${s.length?s.map((m,P)=>`<tr>${Y.map(C=>`<td><div class="quote-cell">${C.render(m,P)}</div></td>`).join("")}</tr>`).join(""):`<tr><td colspan="${Math.max(Y.length,1)}" class="empty">${c(i("projects.details.expenses.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ØªØ·Ù„Ø¨Ø§Øª Ù…Ø³Ø¬Ù„Ø©."))}</td></tr>`}
              </tbody>
            </table>
            ${S("projectExpenses","expensesSubtotal")?`
              <div class="quote-table-subtotal">
                <span class="quote-table-subtotal__pill">
                  <span class="quote-table-subtotal__label">${c(i("projects.details.expensesTotal","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©"))}</span>
                  <span class="quote-table-subtotal__value">${c(o.expensesTotal||V(0,y))}</span>
                </span>
              </div>
            `:""}
          </section>`:`<section class="quote-section quote-section--table">
            <h3>${c(i("projects.quote.sections.expenses","Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©"))}</h3>
            ${x}
          </section>`:"",De=xt.filter(m=>S("projectEquipment",m.id)),qe=(()=>{let m=[];if(De.forEach(B=>{B.id==="price"?m.push({...B,render:E=>{const H=Number.isFinite(Number(E?.unitPriceValue))?Number(E.unitPriceValue):0,re=Number.isFinite(Number(E?.qty))?Math.max(1,Number(E.qty)):1,Me=Math.max(1,Number(u?.rentalDays||1)),ze=H*re*Me;return c(`${he(ze)} ${i("reservations.create.summary.currency","SR")}`)}}):B.id==="unitPrice"?m.push({...B,render:E=>{const H=Number.isFinite(Number(E?.unitPriceValue))?Number(E.unitPriceValue):0;return c(`${he(H)} ${i("reservations.create.summary.currency","SR")}`)}}):m.push(B)}),S("projectEquipment","days")){const B=Math.max(1,Number(u?.rentalDays||1)),E=m.findIndex(re=>re.id==="price"),H=Math.max(0,E);m.splice(H,0,{id:"days",labelKey:null,fallback:"Ø§Ù„Ø£ÙŠØ§Ù…",render:()=>c(j(String(B)))})}const P=new Map(m.map(B=>[B.id,B])),C=m.filter(B=>!["unitPrice","quantity","days","price"].includes(B.id)),W=["unitPrice","quantity","days","price"].map(B=>P.get(B)).filter(Boolean);return m=[...C,...W],m})(),Se=Array.isArray(u?.equipmentItems)?u.equipmentItems:[],Ee=(()=>{try{const m=Math.max(1,Number(u?.rentalDays||1)),P=(Se||[]).reduce((C,W)=>{const B=Number.isFinite(Number(W?.unitPriceValue))?Number(W.unitPriceValue):0,E=Number.isFinite(Number(W?.qty))?Math.max(1,Number(W.qty)):1;return C+B*E*m},0);return he(P)}catch{return"0.00"}})(),Be=D("projectEquipment")?qe.length?`<section class="quote-section quote-section--table">
            <h3>${c(i("projects.quote.sections.equipment","Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</h3>
            <table class="quote-table">
              <thead>
                <tr>${qe.map(m=>`<th>${c(m.labelKey?i(m.labelKey,m.fallback):m.fallback)}</th>`).join("")}</tr>
              </thead>
              <tbody>${Se.length?Se.map((m,P)=>`<tr>${qe.map(C=>`<td><div class="quote-cell">${C.render(m,P)}</div></td>`).join("")}</tr>`).join(""):`<tr><td colspan="${Math.max(qe.length,1)}" class="empty">${c(i("projects.details.equipment.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø¯Ø§Øª Ù…Ø±ØªØ¨Ø·Ø© Ø­Ø§Ù„ÙŠØ§Ù‹."))}</td></tr>`}
              </tbody>
            </table>
            ${S("projectEquipment","equipmentSubtotal")?`
              <div class="quote-table-subtotal">
                <span class="quote-table-subtotal__pill">
                  <span class="quote-table-subtotal__label">${c(i("reservations.details.labels.equipmentTotal","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</span>
                  <span class="quote-table-subtotal__value">${c(`${Ee} ${y}`)}</span>
                </span>
              </div>
            `:""}
          </section>`:`<section class="quote-section quote-section--table">
            <h3>${c(i("projects.quote.sections.equipment","Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</h3>
            ${x}
          </section>`:"",Xe=(e?.description||"").trim()||"",Ae=D("projectNotes")?`<section class="quote-section">
        <h3>${c(i("projects.quote.sections.notes","Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"))}</h3>
        <div class="quote-notes">${c(Xe||i("projects.fallback.noDescription","Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ Ù„Ù„Ù…Ø´Ø±ÙˆØ¹."))}</div>
      </section>`:"",_e=[];S("payment","beneficiary")&&_e.push(ge(i("reservations.quote.labels.beneficiary","Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙÙŠØ¯"),be.beneficiaryName)),S("payment","bank")&&_e.push(ge(i("reservations.quote.labels.bank","Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ"),be.bankName)),S("payment","account")&&_e.push(ge(i("reservations.quote.labels.account","Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨"),j(be.accountNumber))),S("payment","iban")&&_e.push(ge(i("reservations.quote.labels.iban","Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ¨Ø§Ù†"),j(be.iban)));const at=`<section class="quote-section">
      <div class="payment-block">
        <h3>${c(i("reservations.quote.sections.payment","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹"))}</h3>
        <div class="payment-rows">${_e.length?_e.join(""):x}</div>
      </div>
      <p class="quote-approval-note">${c(be.approvalNote)}</p>
    </section>`,Fe=Array.isArray(v)&&v.length?v:xe,Ue=`<footer class="quote-footer">
        <h4>${c(i("reservations.quote.labels.terms","Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø¹Ø§Ù…Ø©"))}</h4>
        <ul>${Fe.map(m=>`<li>${c(m)}</li>`).join("")}</ul>
      </footer>`,Oe=[],we=[];if(M&&we.push({key:"project",html:M}),A&&we.push({key:"customer",html:A}),we.length>1){const m=we.find(W=>W.key==="project"),P=we.find(W=>W.key==="customer"),C=[];m?.html&&C.push(m.html),P?.html&&C.push(P.html),Oe.push(me(`<div class="quote-section-row quote-section-row--primary">${C.join("")}</div>`,{blockType:"group"}))}else we.length===1&&Oe.push(me(we[0].html));const je=[];K&&je.push(me(K,{blockType:"table",extraAttributes:'data-table-id="project-crew"'})),fe&&je.push(me(fe,{blockType:"table",extraAttributes:'data-table-id="project-expenses"'})),Be&&je.push(me(Be,{blockType:"table",extraAttributes:'data-table-id="project-equipment"'}));const ke=[];U&&ke.push(me(U,{blockType:"summary"})),Ae&&ke.push(me(Ae));let Le=[];if(!isChecklist)Le=[...D("payment")?[me(at,{blockType:"payment"})]:[],me(Ue,{blockType:"footer"})];else{const m=String(options?.checklistNotes||"").trim();if(m.length>0){const P=`<section class="quote-section">
        <h3>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</h3>
        <div class="quote-notes">${c(m)}</div>
      </section>`;Le=[me(P)]}}const Je=[...St(Oe,"projects.quote.placeholder.primary"),...je,...St(ke,"projects.quote.placeholder.summary"),...Le],Ye=`
    <header class="quote-header" data-quote-header-template>
      <div class="quote-header__logo">
        <img class="quote-logo" src="${c(be.logoUrl)}" alt="${c(be.companyName)}" crossorigin="anonymous"/>
      </div>
      <div class="quote-header__title">
        <h1>${c(i("projects.quote.title","Ø¹Ø±Ø¶ Ø³Ø¹Ø±"))}</h1>
        <p class="quote-company-name">${c(be.companyName)}</p>
        <p class="quote-company-cr">${c(i("reservations.quote.labels.cr","Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ"))}: ${c(be.commercialRegistry)}</p>
        <p class="quote-company-license">ØªØ±Ø®ÙŠØµ Ø¥Ø¹Ù„Ø§Ù…ÙŠ: 159460</p>
      </div>
      <div class="quote-header__meta">
        <div class="quote-header__meta-item">
          <span>${c(i("reservations.details.labels.reservationId","Ø±Ù‚Ù… Ø§Ù„Ø¹Ø±Ø¶"))}</span>
          <strong>${c(q)}</strong>
        </div>
        <div class="quote-header__meta-item">
          <span>${c(i("projects.quote.labels.date","Ø§Ù„ØªØ§Ø±ÙŠØ®"))}</span>
          <strong>${c(g)}</strong>
        </div>
      </div>
    </header>
  `.trim();return`
    <div id="quotation-pdf-root" dir="rtl">
        <style>${Ln}${Fn}</style>
      <div class="quote-document" data-quote-document>
        <div class="quote-preview-pages" data-quote-pages></div>
        <div class="quote-content-source" data-quote-source>
          ${Ye}
          ${Je.join("")}
        </div>
      </div>
    </div>
  `}function Zn(e){if(e?.context==="project")return ys(e);const{reservation:t,customer:n,project:a,crewAssignments:s,totals:l,totalsDisplay:o,rentalDays:r,currencyLabel:p,sections:y,fieldSelections:h={},quoteNumber:T,quoteDate:q,terms:g=xe}=e,v=j(String(t?.reservationId??t?.id??"")),F=t.start?j(tt(t.start)):"-",S=t.end?j(tt(t.end)):"-",D=n?.customerName||n?.full_name||n?.name||"-",x=n?.phone||"-",Q=n?.email||"-",ne=n?.company||n?.company_name||"-",ge=j(x),b=a?.title||a?.name||i("reservations.details.project.none","ØºÙŠØ± Ù…Ø±ØªØ¨Ø· Ø¨Ù…Ø´Ø±ÙˆØ¹"),A=a?.code||a?.projectCode||"",I=j(String(r)),M=t?.notes||"",ae=Array.isArray(g)&&g.length?g:xe,$=Wt(h),N=(d,L)=>Gt($,d,L),J=d=>y?.has?.(d),oe=`<div class="quote-placeholder">${c(i("reservations.quote.placeholder.noFields","Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù„Ù„Ø¹Ø±Ø¶ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…."))}</div>`,R=(d,L)=>`<div class="info-plain__item">${c(d)} <span class="info-plain__slash">/</span> <strong class="info-plain__value">${c(L)}</strong></div>`,K=(d,L,{variant:G="inline"}={})=>G==="final"?`<div class="totals-item totals-item--final">
        <span class="totals-item__label">${c(d)}</span>
        <span class="totals-item__slash">/</span>
        <span class="totals-item__value">${c(L)}</span>
      </div>`:`<span class="totals-inline__item">
      <span class="totals-inline__label">${c(d)}</span>
      <span class="totals-inline__slash">/</span>
      <span class="totals-inline__value">${c(L)}</span>
    </span>`,O=(d,L)=>`<div class="payment-row">
      <span class="payment-row__label">${c(d)}</span>
      <span class="payment-row__slash">/</span>
      <span class="payment-row__value">${c(L)}</span>
    </div>`,de=[];N("customerInfo","customerName")&&de.push(R(i("reservations.details.labels.customer","Ø§Ù„Ø¹Ù…ÙŠÙ„"),D)),N("customerInfo","customerCompany")&&de.push(R(i("reservations.details.labels.company","Ø§Ù„Ø´Ø±ÙƒØ©"),ne)),N("customerInfo","customerPhone")&&de.push(R(i("reservations.details.labels.phone","Ø§Ù„Ù‡Ø§ØªÙ"),ge)),N("customerInfo","customerEmail")&&de.push(R(i("reservations.details.labels.email","Ø§Ù„Ø¨Ø±ÙŠØ¯"),Q));const k=J("customerInfo")?`<section class="quote-section quote-section--plain quote-section--customer">
        <h3 class="quote-section__title">${c(i("reservations.quote.sections.customer","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„"))}</h3>
        ${de.length?`<div class="info-plain">${de.join("")}</div>`:oe}
      </section>`:"",U=[];N("reservationInfo","reservationId")&&U.push(R(i("reservations.details.labels.reservationId","Ø±Ù‚Ù… Ø§Ù„Ø­Ø¬Ø²"),v||"-")),N("reservationInfo","reservationStart")&&U.push(R(i("reservations.details.labels.start","Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø­Ø¬Ø²"),F)),N("reservationInfo","reservationEnd")&&U.push(R(i("reservations.details.labels.end","Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø­Ø¬Ø²"),S)),N("reservationInfo","reservationDuration")&&U.push(R(i("reservations.details.labels.duration","Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…"),I));const Y=J("reservationInfo")?`<section class="quote-section quote-section--plain quote-section--reservation">
        <h3 class="quote-section__title">${c(i("reservations.quote.sections.reservation","ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²"))}</h3>
        ${U.length?`<div class="info-plain">${U.join("")}</div>`:oe}
      </section>`:"",fe=[];N("projectInfo","projectTitle")&&fe.push(R(i("reservations.details.labels.project","Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),b)),N("projectInfo","projectCode")&&fe.push(R(i("reservations.details.labels.code","Ø§Ù„Ø±Ù…Ø²"),A||"-"));const De=J("projectInfo")?`<section class="quote-section quote-section--plain">
        <h3 class="quote-section__title">${c(i("reservations.quote.sections.project","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"))}</h3>
        ${fe.length?`<div class="info-plain">${fe.join("")}</div>`:oe}
      </section>`:"",qe=[];N("financialSummary","discountAmount")&&qe.push(K(i("reservations.details.labels.discount","Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ…"),`${o.discountAmount} ${p}`)),N("financialSummary","subtotalBeforeTax")&&qe.push(K(i("reservations.details.labels.subtotalBeforeTax","Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"),`${o.taxableAmount} ${p}`)),N("financialSummary","taxAmount")&&qe.push(K(i("reservations.details.labels.tax","Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"),`${o.taxAmount} ${p}`));const Se=N("financialSummary","finalTotal"),Ee=[];Se&&Ee.push(K(i("reservations.details.labels.total","Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ"),`${o.finalTotal} ${p}`,{variant:"final"}));const Be=Ee.length?`<div class="totals-final">${Ee.join("")}</div>`:"",Xe=J("financialSummary")?!qe.length&&!Se?`<section class="quote-section quote-section--financial">${oe}</section>`:`<section class="quote-section quote-section--financial">
          <div class="totals-block">
            <h3>${c(i("reservations.details.labels.summary","Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ"))}</h3>
            ${qe.length?`<div class="totals-inline">${qe.join("")}</div>`:""}
            ${Be}
          </div>
        </section>`:"",{groups:Ae}=qn(t),_e=Ae.map(d=>{const L=Number(d?.count??d?.quantity??1)||1,G=Number(d?.unitPrice);let pe=Number.isFinite(G)?G:0;if(!pe||pe<=0){const te=Number(d?.totalPrice);Number.isFinite(te)&&L>0&&(pe=Number((te/L).toFixed(2)))}Number.isFinite(pe)||(pe=0);const Te=d?.type==="package"||Array.isArray(d?.items)&&d.items.some(te=>te?.type==="package"),le=Array.isArray(d?.barcodes)&&d.barcodes.length?d.barcodes[0]:Array.isArray(d?.items)&&d.items.length?d.items[0]?.barcode:null;let X=d?.packageDisplayCode??d?.package_code??d?.code??d?.packageCode??(Array.isArray(d?.items)&&d.items.length?d.items[0]?.package_code??d.items[0]?.code??d.items[0]?.packageCode:null);const Z=te=>{const ve=(te==null?"":String(te)).trim();return!!(!ve||/^pkg-/i.test(ve)||/^\d+$/.test(ve)&&ve.length<=4)};if(!X||Z(X)){const te=d?.packageId??d?.package_id??(Array.isArray(d?.items)&&d.items.length?d.items[0]?.packageId??d.items[0]?.package_id:null);if(te)try{const ve=An(te);ve&&ve.package_code&&(X=ve.package_code)}catch{}}if(!X||Z(X))try{const te=et(d?.description||"");if(te){const ve=_n();let Ve=ve.find(Ke=>et(Ke?.name||Ke?.title||Ke?.label||"")===te);Ve||(Ve=ve.find(Ke=>{const rn=et(Ke?.name||Ke?.title||Ke?.label||"");return rn.includes(te)||te.includes(rn)})),Ve&&Ve.package_code&&(X=Ve.package_code)}}catch{}const se=Te?X??le??"":d?.barcode??le??"",z=se!=null?String(se):"";let ue=Number.isFinite(Number(d?.totalPrice))?Number(d.totalPrice):Number((pe*L).toFixed(2));return ue=lt(ue),{...d,isPackage:Te,desc:d?.description,barcode:z,packageCodeResolved:X||"",qty:L,price:ue,totalPrice:ue,unitPriceValue:pe}}),at=xt.filter(d=>N("items",d.id)),Fe=(()=>{let d=[];at.forEach(Z=>{Z.id==="price"?d.push({...Z,render:se=>{const z=Number.isFinite(Number(se?.unitPriceValue))?Number(se.unitPriceValue):0,ue=Number.isFinite(Number(se?.qty))?Math.max(1,Number(se.qty)):1,te=Math.max(1,Number(u?.rentalDays||1)),ve=z*ue*te;return c(`${he(ve)} ${i("reservations.create.summary.currency","SR")}`)}}):Z.id==="unitPrice"?d.push({...Z,render:se=>{const z=Number.isFinite(Number(se?.unitPriceValue))?Number(se.unitPriceValue):0;return c(`${he(z)} ${i("reservations.create.summary.currency","SR")}`)}}):d.push(Z)});const L=Math.max(1,Number(u?.rentalDays||1)),G=d.findIndex(Z=>Z.id==="price"),pe=Math.max(0,G);d.splice(pe,0,{id:"days",labelKey:null,fallback:"Ø§Ù„Ø£ÙŠØ§Ù…",render:()=>c(j(String(L)))});const Te=new Map(d.map(Z=>[Z.id,Z])),le=d.filter(Z=>!["unitPrice","quantity","days","price"].includes(Z.id)),X=["unitPrice","quantity","days","price"].map(Z=>Te.get(Z)).filter(Boolean);return d=[...le,...X],d})(),Ue=Fe.length>0,Oe=Ue?Fe.map(d=>`<th>${c(d.labelKey?i(d.labelKey,d.fallback):d.fallback)}</th>`).join(""):"",je=_e.length>0?_e.map((d,L)=>`<tr>${Fe.map(G=>`<td><div class="quote-cell">${G.render(d,L)}</div></td>`).join("")}</tr>`).join(""):`<tr><td colspan="${Math.max(Fe.length,1)}" class="empty">${c(i("reservations.details.noItems","ðŸ“¦ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø¯Ø§Øª Ø¶Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø² Ø­Ø§Ù„ÙŠØ§Ù‹."))}</td></tr>`,ke=J("items")?Ue?`<section class="quote-section quote-section--table">
            <h3>${c(i("reservations.details.items.title","Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</h3>
            <table class="quote-table">
              <thead>
                <tr>${Oe}</tr>
              </thead>
              <tbody>${je}</tbody>
            </table>
            ${N("items","equipmentSubtotal")?`
              <div class="quote-table-subtotal">
                <span class="quote-table-subtotal__pill">
                  <span class="quote-table-subtotal__label">${c(i("reservations.details.labels.equipmentTotal","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</span>
                  <span class="quote-table-subtotal__value">${c(`${o.equipmentTotal} ${p}`)}</span>
                </span>
              </div>
            `:""}
          </section>`:`<section class="quote-section quote-section--table">
            <h3>${c(i("reservations.details.items.title","Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</h3>
            ${oe}
          </section>`:"",Le=jt.filter(d=>N("crew",d.id)),Je=Le.length>0,Ye=Array.isArray(s)?s:[],m=d=>{const L=d&&d.positionId!=null?`id:${String(d.positionId)}`:(()=>{const Te=(d?.positionLabel||d?.position_name||d?.position||"").trim().toLowerCase();return Te?`label:${Te}`:""})(),G=Number.isFinite(Number(d?.positionClientPrice))?Number(d.positionClientPrice):0,pe=G>0?`|p:${G.toFixed(2)}`:"";return`${L}${pe}`};(()=>{const d=new Map;return Ye.forEach(L=>{const G=m(L);G&&d.set(G,(d.get(G)||0)+1)}),d})();const P=(()=>{let d=[],L=null;Le.forEach(z=>{z.id==="position"?(d.push({...z,render:ue=>{const te=ue?.positionLabel??ue?.position_name??ue?.role??i("reservations.crew.positionFallback","Ù…Ù†ØµØ¨ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…");return c(j(String(te)))}}),L={id:"quantity",labelKey:"reservations.details.table.headers.quantity",fallback:"Ø§Ù„ÙƒÙ…ÙŠØ©",render:ue=>{const te=Number(ue?.__count||1);return c(j(String(Math.max(1,te))))}}):z.id==="price"?d.push({...z,render:ue=>{const te=Number.isFinite(Number(ue?.positionClientPrice))?Number(ue.positionClientPrice):0,ve=Math.max(1,Number(ue?.__count||1)),Ve=Math.max(1,Number(u?.rentalDays||1)),Ke=te*ve*Ve;return c(`${he(Ke)} ${i("reservations.create.summary.currency","SR")}`)}}):z.id==="unitPrice"?d.push({...z,render:ue=>{const te=Number.isFinite(Number(ue?.positionClientPrice))?Number(ue.positionClientPrice):0;return c(`${he(te)} ${i("reservations.create.summary.currency","SR")}`)}}):d.push(z)}),L&&d.push(L);const G=Math.max(1,Number(u?.rentalDays||1)),pe=d.findIndex(z=>z.id==="price"),Te=Math.max(0,pe);d.splice(Te,0,{id:"days",labelKey:null,fallback:"Ø§Ù„Ø£ÙŠØ§Ù…",render:()=>c(j(String(G)))});const le=new Map(d.map(z=>[z.id,z])),X=new Set,Z=[],se=z=>{const ue=le.get(z);ue&&!X.has(z)&&(Z.push(ue),X.add(z))};return se("rowNumber"),se("position"),se("unitPrice"),se("quantity"),se("days"),se("price"),d.forEach(z=>{X.has(z.id)||(Z.push(z),X.add(z.id))}),d=Z,d})(),C=Je?P.map(d=>`<th>${c(d.labelKey?i(d.labelKey,d.fallback):d.fallback)}</th>`).join(""):"",W=(()=>{const d=new Map;return Ye.forEach(L=>{const G=m(L);if(!G)return;const pe=d.get(G);pe?pe.__count+=1:d.set(G,{...L,__count:1})}),Array.from(d.values())})(),B=W.length?W.map((d,L)=>`<tr>${P.map(G=>`<td><div class="quote-cell">${G.render(d,L)}</div></td>`).join("")}</tr>`).join(""):`<tr><td colspan="${Math.max(P.length,1)}" class="empty">${c(i("reservations.details.noCrew","ðŸ˜Ž Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙØ±ÙŠÙ‚ Ù…Ø±ØªØ¨Ø· Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø²."))}</td></tr>`,E=J("crew")?Je?`<section class="quote-section quote-section--table">
            <h3>${c(i("reservations.details.technicians.title","Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„"))}</h3>
            <table class="quote-table">
              <thead>
                <tr>${C}</tr>
              </thead>
              <tbody>${B}</tbody>
            </table>
            ${N("crew","crewSubtotal")?`
              <div class="quote-table-subtotal">
                <span class="quote-table-subtotal__pill">
                  <span class="quote-table-subtotal__label">${c(i("reservations.details.labels.crewTotal","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±ÙŠÙ‚"))}</span>
                  <span class="quote-table-subtotal__value">${c(`${o.crewTotal} ${p}`)}</span>
                </span>
              </div>
            `:""}
          </section>`:`<section class="quote-section quote-section--table">
            <h3>${c(i("reservations.details.technicians.title","Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„"))}</h3>
            ${oe}
          </section>`:"",H=J("notes")?`<section class="quote-section">
        <h3>${c(i("reservations.details.labels.notes","Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø­Ø¬Ø²"))}</h3>
        <div class="quote-notes">${c(M||i("reservations.quote.emptyNotes","Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©."))}</div>
      </section>`:"",re=[];N("payment","beneficiary")&&re.push(O(i("reservations.quote.labels.beneficiary","Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙÙŠØ¯"),be.beneficiaryName)),N("payment","bank")&&re.push(O(i("reservations.quote.labels.bank","Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ"),be.bankName)),N("payment","account")&&re.push(O(i("reservations.quote.labels.account","Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨"),j(be.accountNumber))),N("payment","iban")&&re.push(O(i("reservations.quote.labels.iban","Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ¨Ø§Ù†"),j(be.iban)));const Me=`<section class="quote-section">
      <div class="payment-block">
        <h3>${c(i("reservations.quote.sections.payment","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹"))}</h3>
        <div class="payment-rows">${re.length?re.join(""):oe}</div>
      </div>
      <p class="quote-approval-note">${c(be.approvalNote)}</p>
    </section>`,ze=`<footer class="quote-footer">
        <h4>${c(i("reservations.quote.labels.terms","Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø¹Ø§Ù…Ø©"))}</h4>
        <ul>${ae.map(d=>`<li>${c(d)}</li>`).join("")}</ul>
      </footer>`,Re=[];k&&Y?Re.push(me(`<div class="quote-section-row">${k}${Y}</div>`,{blockType:"group"})):(Y&&Re.push(me(Y)),k&&Re.push(me(k))),De&&Re.push(me(De));const pt=[];ke&&pt.push(me(ke,{blockType:"table",extraAttributes:'data-table-id="items"'})),E&&pt.push(me(E,{blockType:"table",extraAttributes:'data-table-id="crew"'}));const f=[];Xe&&f.push(me(Xe,{blockType:"summary"})),H&&f.push(me(H));const ee=[...J("payment")?[me(Me,{blockType:"payment"})]:[],me(ze,{blockType:"footer"})],_=[...St(Re,"reservations.quote.placeholder.page1"),...pt,...St(f,"reservations.quote.placeholder.page2"),...ee],ie=e?.context==="reservationChecklist",ce=e?.checklistType==="crew"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ":"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",ye=ie?ce:i("reservations.quote.title","Ø¹Ø±Ø¶ Ø³Ø¹Ø±"),$e=ie?`<div class="quote-header__meta">
        <div class="quote-header__meta-item">
          <span>Ø§Ù„ØªØ§Ø±ÙŠØ®</span>
          <strong>${c(q)}</strong>
        </div>
      </div>`:`<div class="quote-header__meta">
        <div class="quote-header__meta-item">
          <span>Ø±Ù‚Ù… Ø§Ù„Ø¹Ø±Ø¶</span>
          <strong>${c(T)}</strong>
        </div>
        <div class="quote-header__meta-item">
          <span>Ø§Ù„ØªØ§Ø±ÙŠØ®</span>
          <strong>${c(q)}</strong>
        </div>
      </div>`,Ne=`
    <header class="quote-header" data-quote-header-template>
      <div class="quote-header__logo">
        <img class="quote-logo" src="${c(be.logoUrl)}" alt="${c(be.companyName)}" crossorigin="anonymous"/>
      </div>
      <div class="quote-header__title">
        <h1>${c(ye)}</h1>
        <p class="quote-company-name">${c(be.companyName)}</p>
        <p class="quote-company-cr">${c(i("reservations.quote.labels.cr","Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ"))}: ${c(be.commercialRegistry)}</p>
        <p class="quote-company-license">ØªØ±Ø®ÙŠØµ Ø¥Ø¹Ù„Ø§Ù…ÙŠ: 159460</p>
      </div>
      ${$e}
    </header>
  `.trim();return`
    <div id="quotation-pdf-root" dir="rtl">
      <style>${Ln}${Fn}</style>
      <div class="quote-document" data-quote-document>
        <div class="quote-preview-pages" data-quote-pages></div>
        <div class="quote-content-source" data-quote-source>
          ${Ne}
          ${_.join("")}
        </div>
      </div>
    </div>
  `}async function nn(){try{const e=Qt();if((Array.isArray(e?.packages)?e.packages:[]).length>0)return;const n=await Ut("/packages/?all=1"),a=Array.isArray(n?.data)?n.data:Array.isArray(n)?n:[];a.length&&(sa({packages:a}),document.dispatchEvent?.(new CustomEvent("packages:changed",{detail:{packages:a}})))}catch{}}function hs(e){return e?e.complete?e.naturalHeight===0?Promise.reject(new Error(`image failed to load: ${e.src||"unknown"}`)):Promise.resolve():new Promise((t,n)=>{const a=()=>{l(),t()},s=()=>{l(),n(new Error(`image failed to load: ${e.src||"unknown"}`))},l=()=>{e.removeEventListener("load",a),e.removeEventListener("error",s)};e.addEventListener("load",a,{once:!0}),e.addEventListener("error",s,{once:!0})}):Promise.resolve()}async function ut(e){if(!e)return;const t=e.ownerDocument||document,n=t.defaultView||window,a=Array.from(e.querySelectorAll?.("img")||[]),s=t.fonts?.ready?t.fonts.ready:Promise.resolve(),l=a.map(r=>hs(r)),o=[s,...l].map(r=>r.catch(p=>(Ie("asset load failed",p),Ca(),null)));await Promise.all(o),await new Promise(r=>n.requestAnimationFrame(()=>r()))}async function _t(e,{context:t="preview"}={}){if(!e)return;const n=t==="preview",a=e.ownerDocument||document;e.setAttribute("data-quote-render-context",t);const s=e.querySelector("[data-quote-pages]"),l=e.querySelector("[data-quote-source]"),o=l?.querySelector("[data-quote-header-template]");if(!s||!l||!o)return;s.style.display="block",s.style.margin="0",s.style.padding="0",s.style.gap="0px",s.style.rowGap="0px",s.style.columnGap="0px",s.style.alignItems="stretch",s.style.justifyContent="flex-start",await Wn(l),await ut(l),s.innerHTML="";const r=Array.from(l.querySelectorAll(":scope > [data-quote-block]"));let p=null,y=null;const h=b=>{b.style.margin="0 auto",b.style.breakInside="avoid",b.style.pageBreakInside="avoid",b.style.pageBreakAfter="auto",b.style.breakAfter="auto"},T=()=>{const b=a.createElement("div"),A=s.childElementCount===0;if(b.className="quote-page",b.dataset.pageIndex=String(s.childElementCount),A){b.classList.add("quote-page--primary");const M=o.cloneNode(!0);M.removeAttribute("data-quote-header-template"),b.appendChild(M)}else b.classList.add("quote-page--continuation");const I=a.createElement("main");I.className="quote-body",b.appendChild(I),s.appendChild(b),h(b),p=b,y=I},q=()=>{(!p||!y||!y.isConnected)&&T()},g=()=>{if(!p||!y||y.childElementCount>0)return;const b=p;p=null,y=null,b.parentNode&&b.parentNode.removeChild(b)},v=()=>{p=null,y=null},F=()=>p?p.scrollHeight-p.clientHeight>On:!1,S=(b,{allowOverflow:A=!1}={})=>(q(),y.appendChild(b),F()&&!A?(y.removeChild(b),g(),!1):!0),D=b=>{const A=b.cloneNode(!0);A.removeAttribute?.("data-quote-block"),A.removeAttribute?.("data-block-type"),A.removeAttribute?.("data-table-id"),!S(A)&&(v(),!S(A)&&S(A,{allowOverflow:!0}))},x=b=>{const A=b.querySelector("table");if(!A){D(b);return}const I=b.querySelector("h3"),M=A.querySelector("thead"),ae=Array.from(A.querySelectorAll("tbody tr"));if(!ae.length){D(b);return}let $=null,N=0;const J=(R=!1)=>{const K=b.cloneNode(!1);K.removeAttribute("data-quote-block"),K.removeAttribute("data-block-type"),K.removeAttribute("data-table-id"),K.classList.add("quote-section--table-fragment"),R&&K.classList.add("quote-section--table-fragment--continued");const O=I?I.cloneNode(!0):null;O&&K.appendChild(O);const de=A.cloneNode(!1);de.classList.add("quote-table--fragment"),M&&de.appendChild(M.cloneNode(!0));const k=a.createElement("tbody");return de.appendChild(k),K.appendChild(de),{section:K,body:k}},oe=(R=!1)=>$||($=J(R),S($.section)||(v(),S($.section)||S($.section,{allowOverflow:!0})),$);ae.forEach(R=>{oe(N>0);const K=R.cloneNode(!0);if($.body.appendChild(K),F()&&($.body.removeChild(K),$.body.childElementCount||(y.removeChild($.section),$=null,g()),v(),$=null,oe(N>0),$.body.appendChild(K),F())){$.section.classList.add("quote-section--table-fragment--overflow"),N+=1;return}N+=1}),$=null;try{const R=b.querySelector(":scope > .quote-table-subtotal");R&&D(R)}catch{}};if(!r.length)return;r.forEach(b=>{b.getAttribute("data-block-type")==="table"?x(b):D(b)});const Q=Array.from(s.children),ne=[];if(Q.forEach((b,A)=>{const I=b.querySelector(".quote-body");if(A!==0&&(!I||I.childElementCount===0)){b.remove();return}ne.push(b)}),!n){const b=a.defaultView||window,A=Math.min(3,Math.max(1,b.devicePixelRatio||1)),I=Nt()?Math.min(2,A):A;ne.forEach(M=>Wa(M,{pixelRatio:I}))}ne.forEach((b,A)=>{const I=A===0;b.style.pageBreakAfter="auto",b.style.breakAfter="auto",b.style.pageBreakBefore=I?"auto":"always",b.style.breakBefore=I?"auto":"page",n?b.style.boxShadow="":b.style.boxShadow="none"});const ge=ne[ne.length-1]||null;p=ge,y=ge?.querySelector(".quote-body")||null,await ut(s),n&&(s.style.display="flex",s.style.flexDirection="column",s.style.alignItems="center",s.style.justifyContent="flex-start",s.style.rowGap="18px",s.style.columnGap="0px",s.style.gap="18px")}function ea(e=0){return e<=0?new Promise(t=>requestAnimationFrame(()=>t())):new Promise(t=>setTimeout(t,e))}function ta(e){return e?Array.from(e.querySelectorAll(".quote-page")).some(n=>n.scrollHeight-n.clientHeight>On):!1}function an(e,t="#000000"){if(!e)return;e.querySelectorAll('[style*="color"], [class*="text"], h1, h2, h3, h4, h5, h6, p, span, th, td, li, strong, em, label, dt, dd, caption, div').forEach(a=>{a instanceof HTMLElement&&a.style.setProperty("color",t,"important")})}async function bs(e,{filename:t,safariWindowRef:n=null,mobileWindowRef:a=null}){if(!e)return;const s=Array.from(e.querySelectorAll(".quote-page"));if(!s.length)throw new Error("Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙØ­Ø§Øª Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§.");const[l,o]=await Promise.all([Xa(),Ga()]),r=e.ownerDocument||document,p=r?.defaultView?.getComputedStyle?.(e)?.direction,h=[e.getAttribute?.("dir"),e.style?.direction,p,r?.documentElement?.getAttribute?.("dir")].some(b=>typeof b=="string"&&b.toLowerCase().startsWith("rtl")),T=typeof window<"u"&&window.devicePixelRatio||1,q=Jt(),g=Qn(),v=Nt();let F;v?F=1.5:g?F=Math.min(1.7,Math.max(1.2,T*1.1)):q?F=Math.min(1.8,Math.max(1.25,T*1.2)):F=Math.min(2,Math.max(1.6,T*1.4));const S=v||g?.9:q?.92:.95,D=new l({unit:"mm",format:"a4",orientation:"portrait",compress:!0}),x={scale:F,useCORS:!0,allowTaint:!1,backgroundColor:"#ffffff",letterRendering:!h,removeContainer:!1,logging:!0};let Q=0;const ne=i("reservations.quote.errors.browserLimit","ØªØ¹Ø°Ø± Ø¥ØªÙ…Ø§Ù… Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ø³Ø¨Ø¨ Ù‚ÙŠÙˆØ¯ Ø§Ù„Ù…ØªØµÙØ­ØŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø£Ùˆ ØªÙ‚Ù„ÙŠÙ„ Ø­Ø¬Ù… Ø§Ù„Ù…Ø­ØªÙˆÙ‰.");try{for(let b=0;b<s.length;b+=1){const A=s[b];await Wn(A),await ut(A);const I=A.ownerDocument||document,M=I.createElement("div");Object.assign(M.style,{position:"fixed",top:"0",left:"-12000px",pointerEvents:"none",zIndex:"-1",backgroundColor:"#ffffff"});const ae=A.cloneNode(!0);ae.style.width=`${ft}px`,ae.style.maxWidth=`${ft}px`,ae.style.minWidth=`${ft}px`,ae.style.height=`${yt}px`,ae.style.maxHeight=`${yt}px`,ae.style.minHeight=`${yt}px`,ae.style.position="relative",ae.style.background="#ffffff",an(ae),M.appendChild(ae),I.body.appendChild(M);let $;try{await ut(ae),$=await o(ae,{...x,scale:F,backgroundColor:"#ffffff",scrollX:0,scrollY:0})}catch(k){throw Kt(k,"pageCapture",{toastMessage:ne}),k}finally{M.parentNode?.removeChild(M)}if(!$)continue;const N=$.width||1,oe=($.height||1)/N;let R=Lt,K=R*oe,O=0;if(K>mt){const k=mt/K;K=mt,R=R*k,O=Math.max(0,(Lt-R)/2)}const de=$.toDataURL("image/jpeg",S);Q>0&&D.addPage(),D.addImage(de,"JPEG",O,0,R,K,`page-${Q+1}`,"FAST"),Q+=1,await new Promise(k=>window.requestAnimationFrame(k))}}catch(b){throw Bt({safariWindowRef:n,mobileWindowRef:a}),b}if(Q===0)throw Bt({safariWindowRef:n,mobileWindowRef:a}),new Error("PDF generation produced no pages.");if(g||v){const b=D.output("blob");if(v){const A=URL.createObjectURL(b);ct();try{window.location.assign(A)}catch(I){Ie("mobile safari blob navigation failed",I)}finally{setTimeout(()=>URL.revokeObjectURL(A),6e4)}}else{const A=URL.createObjectURL(b),I=()=>g&&n&&!n.closed?n:a&&!a.closed?a:null,M=($,N)=>{if(ct(),!$){window.location.assign(N);return}try{$.location.replace(N),$.focus?.()}catch(J){Ie("direct blob navigation failed",J);try{$.document.open(),$.document.write(`<!DOCTYPE html><html lang="ar" dir="rtl"><head><meta charset="utf-8"><title>${c(i("reservations.quote.actions.export","ØªÙ†Ø²ÙŠÙ„ PDF"))}</title><style>html,body{margin:0;height:100%;background:#0f172a;color:#f8fafc;font-family:'Tajawal',sans-serif;} iframe{border:none;width:100%;height:100%;display:block;}</style></head><body><iframe src="${N}" title="PDF preview"></iframe></body></html>`),$.document.close()}catch(oe){Ie("iframe blob delivery failed",oe),window.location.assign(N)}}},ae=I();M(ae,A),setTimeout(()=>URL.revokeObjectURL(A),6e4)}}else{ct();const b=D.output("bloburl"),A=document.createElement("a");A.href=b,A.download=t,A.rel="noopener",A.style.display="none",document.body.appendChild(A),A.click(),setTimeout(()=>{URL.revokeObjectURL(b),A.remove()},2e3)}}function Pe(){if(!u||!w)return;const{previewFrame:e}=w;if(!e)return;const t=u.context||"reservation",n=Zn({context:t,reservation:u.reservation,customer:u.customer,project:u.project,crewAssignments:u.crewAssignments,totals:u.totals,totalsDisplay:u.totalsDisplay,rentalDays:u.rentalDays,currencyLabel:u.currencyLabel,sections:u.sections,fieldSelections:u.fields,quoteNumber:u.quoteNumber,quoteDate:u.quoteDateLabel,terms:u.terms,checklistType:u.checklistType,checklistNotes:u.checklistNotes,projectCrew:u.projectCrew,projectExpenses:u.projectExpenses,projectEquipment:u.projectEquipment,projectInfo:u.projectInfo,clientInfo:u.clientInfo,paymentSummary:u.paymentSummary,projectTotals:u.projectTotals});Ge("render"),e.srcdoc=`<!DOCTYPE html>${n}`,e.addEventListener("load",async()=>{try{const a=e.contentDocument,s=a?.defaultView||window,l=a?.documentElement||a;l&&(kn(l),xn(l,s),jn(l,s));const o=a?.getElementById("quotation-pdf-root");try{o&&(await _t(o,{context:"preview"}),await ea(120),ta(o)&&await _t(o,{context:"preview"}),an(o))}catch(g){console.error("[reservations/pdf] failed to layout preview document",g)}const r=Array.from(a?.querySelectorAll?.(".quote-page")||[]),p=a?.querySelector(".quote-preview-pages"),y=ft;let h=18;if(p&&a?.defaultView){const g=a.defaultView.getComputedStyle(p),v=parseFloat(g.rowGap||g.gap||`${h}`);Number.isFinite(v)&&v>=0&&(h=v)}const T=yt,q=r.length?r.length*T+Math.max(0,(r.length-1)*h):T;if(e.dataset.baseWidth=String(y),e.dataset.baseHeight=String(q),e.style.width=`${y}px`,e.style.minWidth=`${y}px`,e.style.height=`${q}px`,e.style.minHeight=`${q}px`,w?.previewFrameWrapper&&!w?.userAdjustedZoom){const g=w.previewFrameWrapper.clientWidth-24;g>0&&g<y?Ce=Math.max(g/y,.3):Ce=1}na(Ce)}finally{ct()}},{once:!0})}function vs(e){if(!u)return;const t=e.currentTarget,n=t?.dataset?.sectionId;n&&(t.checked?u.sections.add(n):u.sections.delete(n),Jn(u),Ot(),Pe())}function gs(e){if(!u)return;const t=e.currentTarget,n=t?.dataset?.sectionId,a=t?.dataset?.fieldId;if(!n||!a)return;const s=u.context||"reservation",l=u.fields||(u.fields=dt(s)),o=Ia(l,n);t.checked?o.add(a):o.delete(a),Jn(u),Pe()}function ws(e){if(!u)return;const t=e.currentTarget,n=t?.dataset?.sectionId;n&&(Xt(u,n),u.sectionExpansions[n]=t.open)}function Ot(){if(!w?.toggles||!u)return;const{toggles:e}=w,t=u.fields||{},n=u.context||"reservation";Xt(u);const a=Tt(n),s=Cn(n),l=a.map(({id:o,labelKey:r,fallback:p})=>{const y=i(r,p),h=u.sections.has(o),T=s[o]||[],q=Pa(u,o),g=T.length?`<div class="quote-toggle-sublist">
          ${T.map(v=>{const F=Gt(t,o,v.id),S=h?"":"disabled",D=v.labelKey?i(v.labelKey,v.fallback):v.fallback;return`
              <label class="quote-toggle quote-toggle--field">
                <input type="checkbox" data-field-toggle data-section-id="${o}" data-field-id="${v.id}" ${F?"checked":""} ${S}>
                <span>${c(D)}</span>
              </label>
            `}).join("")}
        </div>`:"";return`
      <details class="quote-toggle-group" data-section-group data-section-id="${o}" ${q?"open":""}>
        <summary class="quote-toggle-summary">
          <label class="quote-toggle quote-toggle--section">
            <input type="checkbox" data-section-toggle data-section-id="${o}" ${h?"checked":""}>
            <span>${c(y)}</span>
          </label>
          ${T.length?'<span class="quote-toggle-caret" aria-hidden="true"></span>':""}
        </summary>
        ${g}
      </details>
    `}).join("");e.innerHTML=l,e.querySelectorAll("input[data-section-toggle]").forEach(o=>{o.addEventListener("change",vs)}),e.querySelectorAll("input[data-field-toggle]").forEach(o=>{o.addEventListener("change",gs)}),e.querySelectorAll("details[data-section-group]").forEach(o=>{o.addEventListener("toggle",ws)})}function qs(){if(w?.modal)return w;const e=document.createElement("div");e.id="reservationQuoteModal",e.className="modal fade quote-preview-modal",e.tabIndex=-1,e.setAttribute("aria-labelledby","reservationQuoteModalLabel"),e.setAttribute("aria-hidden","true"),e.style.display="none",e.innerHTML=`
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="reservationQuoteModalLabel">${c(i("reservations.quote.previewTitle","Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¹Ø±Ø¶ Ø³Ø¹Ø±"))}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="quote-preview-layout">
            <aside class="quote-preview-sidebar">
              <h6>${c(i("reservations.quote.toggleHeading","Ø­Ø¯Ø¯ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø¯ ØªØµØ¯ÙŠØ±Ù‡Ø§"))}</h6>
              <div class="quote-toggle-list" data-quote-toggles></div>
              <div class="quote-meta-info" data-quote-meta></div>
              <div class="quote-terms-editor" data-quote-terms-editor>
                <label class="quote-terms-editor__label" for="quote-terms-input">${c(i("reservations.quote.termsEditor.title","Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø¹Ø§Ù…Ø© (Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„)"))}</label>
                <textarea id="quote-terms-input" class="quote-terms-editor__textarea" rows="6" data-quote-terms-input placeholder="${c(i("reservations.quote.termsEditor.placeholder","Ø§ÙƒØªØ¨ ÙƒÙ„ Ø´Ø±Ø· ÙÙŠ Ø³Ø·Ø± Ù…Ø³ØªÙ‚Ù„"))}"></textarea>
                <button type="button" class="quote-terms-reset" data-quote-terms-reset>${c(i("reservations.quote.termsEditor.reset","Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©"))}</button>
              </div>
            </aside>
            <section class="quote-preview-panel">
              <div class="quote-preview" data-quote-preview></div>
            </section>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-light" data-bs-dismiss="modal">${c(i("reservations.quote.actions.close","Ø¥ØºÙ„Ø§Ù‚"))}</button>
          <button type="button" class="btn btn-primary" data-quote-download>
            ${c(i("reservations.quote.actions.export","ðŸ“„ ØªÙ†Ø²ÙŠÙ„ PDF"))}
          </button>
        </div>
      </div>
    </div>
  `,document.body.appendChild(e);const t=e.querySelector("[data-quote-toggles]"),n=e.querySelector("[data-quote-preview]"),a=e.querySelector("[data-quote-meta]"),s=e.querySelector("[data-quote-terms-input]"),l=e.querySelector("[data-quote-terms-reset]"),o=e.querySelector("[data-quote-download]"),r=e.querySelector(".modal-header"),p=r?.querySelector(".btn-close"),y=Array.from(e.querySelectorAll('[data-bs-dismiss="modal"]')),h=document.createElement("div");h.className="quote-preview-header-actions",r&&r.insertBefore(h,p||null);const T=document.createElement("iframe");T.className="quote-preview-frame",T.setAttribute("title",i("reservations.quote.previewTitle","Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¹Ø±Ø¶ Ø³Ø¹Ø±")),T.setAttribute("loading","lazy"),T.setAttribute("frameborder","0");const q=document.createElement("div");q.className="quote-preview-zoom-controls",q.innerHTML=`
    <button type="button" class="quote-preview-zoom-btn" data-zoom-out title="${c(i("reservations.quote.zoom.out","ØªØµØºÙŠØ±"))}">âˆ’</button>
    <span class="quote-preview-zoom-value" data-zoom-value>100%</span>
    <button type="button" class="quote-preview-zoom-btn" data-zoom-in title="${c(i("reservations.quote.zoom.in","ØªÙƒØ¨ÙŠØ±"))}">+</button>
    <button type="button" class="quote-preview-zoom-btn" data-zoom-reset title="${c(i("reservations.quote.zoom.reset","Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¶Ø¨Ø·"))}">1:1</button>
  `;const g=document.createElement("div");g.className="quote-preview-frame-wrapper",g.appendChild(T),n.innerHTML="";const v=document.createElement("div");v.className="quote-preview-scroll",v.appendChild(g),n.appendChild(v);const F=document.createElement("div");F.className="quote-preview-status",F.setAttribute("role","status"),F.setAttribute("aria-live","polite"),F.hidden=!0,F.innerHTML=`
    <span class="quote-preview-spinner" data-quote-status-spinner aria-hidden="true"></span>
    <span data-quote-status-text>${c(Dn("render"))}</span>
    <button type="button" class="quote-preview-status-action" data-quote-status-action hidden></button>
  `,n.appendChild(F),h.appendChild(q),o?.addEventListener("click",async()=>{if(u){o.disabled=!0;try{await aa()}finally{o.disabled=!1}}});const S=()=>{Mt()||Rt(e)};y.forEach(ne=>{ne?.addEventListener("click",S)}),p&&!y.includes(p)&&p.addEventListener("click",S),e.addEventListener("click",ne=>{Mt()||ne.target===e&&Rt(e)}),w={modal:e,toggles:t,preview:n,previewScroll:v,previewFrameWrapper:g,zoomControls:q,zoomValue:q.querySelector("[data-zoom-value]"),previewFrame:T,meta:a,downloadBtn:o,statusIndicator:F,statusText:F.querySelector("[data-quote-status-text]"),statusSpinner:F.querySelector("[data-quote-status-spinner]"),statusAction:F.querySelector("[data-quote-status-action]"),termsInput:s,termsReset:l,statusKind:null,userAdjustedZoom:!1};const D=q.querySelector("[data-zoom-out]"),x=q.querySelector("[data-zoom-in]"),Q=q.querySelector("[data-zoom-reset]");return D?.addEventListener("click",()=>vn(-.1)),x?.addEventListener("click",()=>vn(.1)),Q?.addEventListener("click",()=>kt(1,{markManual:!0})),s&&s.addEventListener("input",Ss),l&&l.addEventListener("click",As),kt(Ce),w}function kt(e,{silent:t=!1,markManual:n=!1}={}){Ce=Math.min(Math.max(e,.25),2.2),n&&w&&(w.userAdjustedZoom=!0),na(Ce),!t&&w?.zoomValue&&(w.zoomValue.textContent=`${Math.round(Ce*100)}%`)}function vn(e){kt(Ce+e,{markManual:!0})}function na(e){if(!w?.previewFrame||!w.previewFrameWrapper)return;const t=w.previewFrame,n=w.previewFrameWrapper,a=Number(t.dataset.baseWidth)||794,s=Number(t.dataset.baseHeight)||t.contentDocument?.body?.scrollHeight||1123;t.style.transform=`scale(${e})`,t.style.transformOrigin="top center",Jt()?(n.style.width="100%",n.style.maxWidth="100%",n.style.minWidth="0"):(n.style.width=`${a}px`,n.style.maxWidth=`${a}px`,n.style.minWidth=`${a}px`),n.style.minHeight=`${s}px`,n.style.height=`${s}px`}function Ht(){if(!w?.meta||!u)return;const{meta:e}=w;(u.context||"reservation")==="reservationChecklist"?e.innerHTML=`
      <div class="quote-meta-card">
        <div><span>${c(i("reservations.quote.labels.dateGregorian","Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ"))}</span><strong>${c(u.quoteDateLabel)}</strong></div>
      </div>
    `:e.innerHTML=`
      <div class="quote-meta-card">
        <div><span>${c(i("reservations.quote.labels.number","Ø±Ù‚Ù… Ø¹Ø±Ø¶ Ø³Ø¹Ø±"))}</span><strong>${c(u.quoteNumber)}</strong></div>
        <div><span>${c(i("reservations.quote.labels.dateGregorian","Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ"))}</span><strong>${c(u.quoteDateLabel)}</strong></div>
      </div>
    `}function sn(){if(!w?.termsInput)return;const e=(u?.terms&&u.terms.length?u.terms:xe).join(`
`);w.termsInput.value!==e&&(w.termsInput.value=e)}function Ss(e){if(!u)return;const t=Dt(e?.target?.value??"");if(t.length){u.terms=t;const n=document.getElementById("reservation-terms");n&&(n.value=e.target.value);const a=document.getElementById("edit-res-terms");a&&(a.value=e.target.value)}else{u.terms=[...xe],sn();const n=xe.join(`
`),a=document.getElementById("reservation-terms");a&&(a.value=n);const s=document.getElementById("edit-res-terms");s&&(s.value=n)}Pe()}function As(e){if(e?.preventDefault?.(),!u)return;u.terms=[...xe];const t=document.getElementById("reservation-terms");t&&(t.value=xe.join(`
`));const n=document.getElementById("edit-res-terms");n&&(n.value=xe.join(`
`)),sn(),Pe()}async function aa(){if(!u)return;Ge("export");const t=!Jt()&&Qn(),n=Nt(),a=null,s=!n&&t?window.open("","_blank"):null;(p=>{if(p)try{p.document.open(),p.document.write(`<!DOCTYPE html><html lang="ar" dir="rtl"><head><meta charset="utf-8"><title>${c(i("reservations.quote.status.exporting","Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ù…Ù„Ù PDF..."))}</title><style>body{font-family:'Tajawal',sans-serif;margin:0;height:100vh;display:flex;align-items:center;justify-content:center;background:#0f172a;color:#f8fafc;text-align:center;padding:24px;} .loader{width:42px;height:42px;border-radius:50%;border:4px solid rgba(248,250,252,0.35);border-top-color:#38bdf8;animation:spin 1s linear infinite;margin:0 auto 18px;}@keyframes spin{to{transform:rotate(360deg);}} h1{margin:0 0 6px;font-size:1.05rem;} p{margin:0;font-size:0.9rem;opacity:0.8;}</style></head><body><div><div class="loader" aria-hidden="true"></div><h1>${c(i("reservations.quote.status.exporting","Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ù…Ù„Ù PDF..."))}</h1><p>${c(i("reservations.quote.status.exportingHint","Ù‚Ø¯ ÙŠØ³ØªØºØ±Ù‚ Ø°Ù„Ùƒ Ø¨Ø¶Ø¹ Ø«ÙˆØ§Ù†ÙØŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±..."))}</p></div></body></html>`),p.document.close()}catch(y){Ie("failed to prime download window",y)}})(s);let o=null;const r=i("reservations.quote.errors.browserLimit","ØªØ¹Ø°Ø± Ø¥ØªÙ…Ø§Ù… Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ø³Ø¨Ø¨ Ù‚ÙŠÙˆØ¯ Ø§Ù„Ù…ØªØµÙØ­ØŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø£Ùˆ ØªÙ‚Ù„ÙŠÙ„ Ø­Ø¬Ù… Ø§Ù„Ù…Ø­ØªÙˆÙ‰.");try{await Ja(),Pt("html2pdf ensured");const p=u.context||"reservation";if(p!=="reservationChecklist")try{const{sequence:q,quoteNumber:g}=await Za(p);u.quoteSequence=q,u.quoteNumber=g,u.sequenceCommitted=!0}catch(q){Ie("failed to reserve sequence at export time, proceeding with preview number",q)}const y=Zn({context:p,reservation:u.reservation,customer:u.customer,project:u.project,crewAssignments:u.crewAssignments,totals:u.totals,totalsDisplay:u.totalsDisplay,rentalDays:u.rentalDays,currencyLabel:u.currencyLabel,sections:u.sections,fieldSelections:u.fields,quoteNumber:u.quoteNumber,quoteDate:u.quoteDateLabel,terms:u.terms,projectCrew:u.projectCrew,projectExpenses:u.projectExpenses,projectEquipment:u.projectEquipment,projectInfo:u.projectInfo,clientInfo:u.clientInfo,paymentSummary:u.paymentSummary,projectTotals:u.projectTotals});o=document.createElement("div"),o.innerHTML=y,Object.assign(o.style,{position:"fixed",top:"0",left:"0",pointerEvents:"none",zIndex:"-1"}),document.body.appendChild(o),kn(o),xn(o),jn(o),Pt("export container prepared");const h=o.firstElementChild;if(h){h.setAttribute("dir","rtl"),h.style.direction="rtl",h.style.textAlign="right",h.setAttribute("data-theme","light"),h.classList.remove("dark","dark-mode"),h.style.margin="0",h.style.padding="0",h.style.width="210mm",h.style.maxWidth="210mm",h.style.marginLeft="auto",h.style.marginRight="auto",h.scrollTop=0,h.scrollLeft=0;try{await _t(h,{context:"export"}),await ea(120),ta(h)&&await _t(h,{context:"export"}),await ut(h),an(h),Pt("layout complete for export document")}catch(q){Kt(q,"layoutQuoteDocument",{suppressToast:!0})}}const T=p==="reservationChecklist"?(()=>{const q=u?.reservation?.reservationCode||u?.reservation?.reservationId||u?.reservation?.id||"res",g=u?.checklistType==="crew"?"crew":"equipment";return`checklist-${String(q)}-${g}.pdf`})():`quotation-${u.quoteNumber}.pdf`;await bs(h,{filename:T,safariWindowRef:s,mobileWindowRef:a})}catch(p){Bt({container:o,safariWindowRef:s,mobileWindowRef:a}),o=null,Kt(p,"exportQuoteAsPdf",{toastMessage:r})}finally{o&&o.parentNode&&o.parentNode.removeChild(o),ct()}}function on(){const e=qs();if(e?.modal){if(it=!1,Ce=1,w&&(w.userAdjustedZoom=!1),kt(Ce,{silent:!0}),u?.context==="reservationChecklist")try{const t=e.modal.querySelector("#reservationQuoteModalLabel"),n=e.modal.querySelector(".quote-preview-sidebar"),a=e.modal.querySelector("[data-quote-terms-editor]");a&&(a.style.display="none");let s=n.querySelector("[data-checklist-controls]");s||(s=document.createElement("div"),s.setAttribute("data-checklist-controls",""),s.innerHTML=`
          <div class="quote-meta-card" style="margin-bottom:10px">
            <div style="display:flex;gap:10px;flex-wrap:wrap">
              <label style="display:flex;align-items:center;gap:6px">
                <input type="radio" name="checklist-type" value="items" checked>
                <span>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª</span>
              </label>
              <label style="display:flex;align-items:center;gap:6px">
                <input type="radio" name="checklist-type" value="crew">
                <span>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ</span>
              </label>
            </div>
          </div>
          <div class="quote-terms-editor" data-checklist-notes>
            <label class="quote-terms-editor__label" for="checklist-notes-input">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù„Ø³ØªØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
            <textarea id="checklist-notes-input" class="quote-terms-editor__textarea" rows="4" placeholder="Ø§ÙƒØªØ¨ Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø®Ø§ØµØ© Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ù„Ø³ØªØ©"></textarea>
          </div>
        `,n.prepend(s),s.querySelectorAll('input[name="checklist-type"]').forEach(r=>{r.addEventListener("change",()=>{const p=s.querySelector('input[name="checklist-type"]:checked')?.value||"items";u.checklistType=p==="crew"?"crew":"items";const y=new Set(["customerInfo","reservationInfo","projectInfo","notes"]);u.checklistType==="crew"?y.add("crew"):y.add("items"),u.sections=y,t&&(t.textContent=u.checklistType==="crew"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ":"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"),Ot(),Ht(),Pe()})}),s.querySelector("#checklist-notes-input").addEventListener("input",r=>{u.checklistNotes=String(r.target.value||""),Pe()})),t&&(t.textContent=u.checklistType==="crew"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ":"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª");try{e.previewFrame?.setAttribute("title","Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù„Ø³ØªØ©")}catch{}}catch{}Ot(),Ht(),sn(),Pe(),Na(e.modal)}}async function Cs({reservation:e,customer:t,project:n}){if(!e){ht(i("reservations.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø²"));return}await nn();const a=Ct(e),{totalsDisplay:s,totals:l,rentalDays:o}=tn(e,a,n),r=i("reservations.create.summary.currency","SR"),p=new Date,y=wa();u={context:"reservation",reservation:e,customer:t,project:n,crewAssignments:a,totals:l,totalsDisplay:s,rentalDays:o,currencyLabel:r,projectCrew:[],projectExpenses:[],projectEquipment:[],sections:new Set(Tt("reservation").filter(h=>h.defaultSelected).map(h=>h.id)),sectionExpansions:Et("reservation"),fields:dt("reservation"),terms:y,quoteDate:p,quoteDateLabel:en(p),sequenceCommitted:!1},Zt(u),on();try{Vt()}catch{}}async function Is({reservation:e,customer:t,project:n}){if(!e){ht(i("reservations.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø²"));return}await nn();const a=Ct(e),{totalsDisplay:s,totals:l,rentalDays:o}=tn(e,a,n),r=i("reservations.create.summary.currency","SR"),p=new Date;u={context:"reservationChecklist",reservation:e,customer:t,project:n,crewAssignments:a,totals:l,totalsDisplay:s,rentalDays:o,currencyLabel:r,checklistType:"items",checklistNotes:"",projectCrew:[],projectExpenses:[],projectEquipment:[],sections:new Set(["customerInfo","reservationInfo","projectInfo","notes","items"]),sectionExpansions:Et("reservationChecklist"),fields:dt("reservationChecklist"),terms:[],quoteDate:p,quoteDateLabel:en(p),sequenceCommitted:!1},Zt(u),on();try{Vt()}catch{}}async function Ps({project:e}){if(!e){ht(i("projects.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"));return}await nn();let t=bn(e);const{project:n}=t;if(!n){ht(i("projects.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"));return}try{(!Array.isArray(t.equipmentItems)||t.equipmentItems.length===0)&&n?.id!=null&&(await ia({project_id:n.id}),t=bn(n))}catch(r){console.warn("[reservationPdf] refreshReservationsForProject failed, proceeding with snapshot/state",r)}const{sequence:a,quoteNumber:s}=await es("project"),l=new Date,o=[...ga];u={context:"project",reservation:null,customer:t.customer,project:n,technicians:t.crew||[],clientInfo:t.clientInfo,projectInfo:t.projectInfo,projectCrew:t.crew,projectExpenses:t.expenses,projectEquipment:t.equipment,equipmentItems:t.equipmentItems||[],crewAssignments:t.crewAssignments||[],totals:t.totals,projectTotals:t.projectTotals,totalsDisplay:t.totalsDisplay,rentalDays:t.projectDurationDays,currencyLabel:t.currencyLabel,sections:new Set(Tt("project").filter(r=>r.defaultSelected).map(r=>r.id)),sectionExpansions:Et("project"),fields:dt("project"),terms:o,quoteSequence:a,quoteNumber:s,quoteDate:l,quoteDateLabel:en(l),sequenceCommitted:!1,paymentSummary:t.paymentSummary,projectNotes:t.notes,paymentHistory:t.paymentHistory},Zt(u),on();try{Vt()}catch{}}export{Cs as a,Is as b,Ps as e,Es as g,$n as r,Ns as s};
