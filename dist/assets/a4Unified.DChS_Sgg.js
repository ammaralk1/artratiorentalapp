import{r as C,t as o,e as N,d as T,b as P,p as M}from"./calculations.BlsvwTLx.js";import{e as H,l as F,a as X,b as G}from"./reports.DJNMxAWq.js";import"./reservationsService.DwVbVNH4.js";import"./auth.D09_E0J1.js";import"./dashboard.DXuA61sg.js";import"./controller.BK6CqFPh.js";/* empty css              */import"./dashboardShell.BTjbDc9Z.js";import"./customers.Cpz8J_vg.js";import"./maintenanceService.DLPgwUA9.js";const B=`@page { size: A4; margin: 0; }
@import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;600;700;800&display=swap');

/* جذر وثيقة A4 للمعاينة/التصدير */
#reports-a4-root {
  color-scheme: light;
  direction: rtl;
  text-align: right;
  font-family: 'Tajawal', 'Arial', 'Tahoma', sans-serif;
  color: #000 !important;
}

/* إزالة تأثيرات الثيم والظلال كلياً داخل الجذر */
#reports-a4-root, #reports-a4-root * {
  color: #000 !important; background: #fff !important; box-shadow: none !important; filter: none !important;
  letter-spacing: normal !important; word-spacing: normal !important; font-kerning: normal !important; font-variant-ligatures: normal !important;
  -webkit-font-smoothing: antialiased; text-rendering: optimizeLegibility;
}

/* حاوية الصفحات */
#reports-a4-root [data-a4-pages] {
  display: flex; flex-direction: column; gap: 0; padding: 0; margin: 0; align-items: center; justify-content: flex-start;
}

/* فصل بصري بين الصفحات في المعاينة */
#reports-a4-root[data-render-context="preview"] [data-a4-pages] { gap: 18px; }
#reports-a4-root[data-render-context="preview"] .a4-page { margin: 0; }
#reports-a4-root[data-render-context="preview"] .a4-page + .a4-page::before {
  content: '';
  position: absolute;
  top: -9px;
  left: 14mm;
  right: 14mm;
  height: 1px;
  background: rgba(148, 163, 184, 0.5);
}

/* صفحة A4 ثابتة بالبكسل، بدون أي هوامش خارجية */
.a4-page {
  position: relative;
  width: 794px; /* 210mm @ 96dpi */
  height: 1123px; /* 297mm @ 96dpi */
  overflow: hidden; background: #fff; border-radius: 0; margin: 0; padding: 0;
}

/* طبقة داخلية تمتد على كامل الصفحة وتُطبّق الحشوات بالـ mm */
.a4-inner { position: absolute; inset: 0; padding: 12mm 14mm 12mm; }
.a4-page--primary .a4-inner { padding-top: 6mm; }

/* العناوين والـ KPI */
.rpt-header { display: flex; flex-direction: column; gap: 8px; margin: 0 0 6mm 0; }
.rpt-header-top { display: flex; align-items: center; justify-content: space-between; gap: 12px; }
.rpt-titleblock { display: flex; flex-direction: column; gap: 4px; text-align: right; }
.rpt-header h1 { margin: 0; font-weight: 800; font-size: 18px; text-align: right; }
.rpt-subtitle { margin: 0; font-size: 12px; opacity: .9; text-align: right; }
.rpt-logo { width: 56px; height: 56px; object-fit: contain; border-radius: 12px; border: 1px solid #e5e7eb; background: #fff; }

.rpt-kpis { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin: 8px 0 6mm; }
.rpt-kpi { border: 1px solid #e5e7eb; border-radius: 8px; padding: 8px 10px; }
.rpt-kpi .label { font-size: 11px; opacity: .85; }
.rpt-kpi .value { font-weight: 700; font-size: 14px; }

/* الجدول */
.rpt-table { width: 100%; border-collapse: collapse; font-size: 11px; border: 1px solid #9ca3af; table-layout: fixed; print-color-adjust: exact; -webkit-print-color-adjust: exact; }
.rpt-table tbody tr:last-child td { border-bottom: 1px solid #9ca3af; }
.rpt-table td, .rpt-table th { vertical-align: middle; border-color: #9ca3af; }
/* تأكيد إغلاق الحواف الخارجية يمين/يسار وأعلى/أسفل */
.rpt-table thead tr:first-child th { border-top: 1px solid #9ca3af; }
.rpt-table thead th:first-child, .rpt-table tbody td:first-child { border-right: 1px solid #9ca3af; }
.rpt-table thead th:last-child, .rpt-table tbody td:last-child { border-left: 1px solid #9ca3af; }
.rpt-table tbody tr + tr td { border-top: 1px solid #9ca3af; }
/* تفاصيل الجسم فقط أصغر وبسطر واحد */
.rpt-table tr { height: 26px; }
.rpt-table tbody td { font-size: 10px; line-height: 1; height: 26px; padding: 0 !important; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; border: 1px solid #9ca3af; position: relative; }

/* تفاصيل الإيرادات داخل المعاينة */
.rpt-revenue {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 8px 12px;
  margin: 6mm 0 6mm;
}
.rpt-revenue__item { display: flex; align-items: center; justify-content: space-between; border: 1px solid #9ca3af; border-radius: 8px; padding: 8px 10px; }
.rpt-revenue__label { font-size: 11px; opacity: .9; }
.rpt-revenue__value { font-weight: 700; font-size: 13px; }
.rpt-revenue__title { margin: 0 0 6px 0; font-size: 13px; font-weight: 800; }
.rpt-table th { background: #f3f4f6 !important; color: #000 !important; border: 1px solid #9ca3af; padding: 6px 8px; text-align: right; font-weight: 800; }
.rpt-table td { background: #ffffff !important; color: #000 !important; border: 1px solid #9ca3af; padding: 0 !important; text-align: right; height: 24px; }

/* عنوان جدول تفاصيل الحجوزات */
.rpt-table-title {
  margin: 6mm 0 3mm;
  font-size: 13px;
  font-weight: 800;
}

/* تحسين ظهور الحدود في وضع المعاينة (قد تضيع عند التصغير) */
#reports-a4-root[data-render-context="preview"] .rpt-table { border-width: 2px; outline: 2px solid #475569; outline-offset: 0; box-shadow: inset 0 0 0 2px #475569; }
#reports-a4-root[data-render-context="preview"] .rpt-table th,
#reports-a4-root[data-render-context="preview"] .rpt-table td { border-color: #475569; border-width: 1.5px; }

/* توسيط المحتوى عمودياً داخل الخلايا بشكل صريح */
.rpt-table th, .rpt-table td { vertical-align: middle !important; }
.rpt-cell { display: flex; align-items: center; justify-content: flex-start; height: 26px; min-height: 26px; width: 100%; padding: 0 8px; box-sizing: border-box; line-height: 1; direction: rtl; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

/* إخفاء العناصر حسب التفضيلات */
#reports-a4-root[data-hide-header] .rpt-header { display: none !important; }
#reports-a4-root[data-hide-kpis] .rpt-kpis { display: none !important; }
#reports-a4-root[data-hide-revenue] .rpt-revenue-section { display: none !important; }
#reports-a4-root[data-hide-outstanding] .rpt-outstanding-section { display: none !important; }
#reports-a4-root[data-hide-crew] .rpt-crew-section { display: none !important; }
#reports-a4-root[data-hide-forecast] .rpt-forecast-section { display: none !important; }

.rpt-outstanding-section { margin: 4mm 0 6mm; }
.rpt-outstanding__title { margin: 0 0 6px 0; font-size: 13px; font-weight: 800; }
.rpt-outstanding__table { width: 100%; border-collapse: collapse; font-size: 11px; border: 1px solid #9ca3af; }
.rpt-outstanding__table th { background: #f3f4f6; border: 1px solid #9ca3af; padding: 6px 8px; text-align: right; }
.rpt-outstanding__table td { border: 1px solid #9ca3af; padding: 6px 8px; text-align: right; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; vertical-align: middle; }

/* طاقم: جدول وقسم */
.rpt-crew-section { margin: 4mm 0 6mm; }
.rpt-crew__title { margin: 0 0 6px 0; font-size: 13px; font-weight: 800; }
.rpt-crew__table { width: 100%; border-collapse: collapse; font-size: 11px; border: 1px solid #9ca3af; }
.rpt-crew__table th { background: #f3f4f6; border: 1px solid #9ca3af; padding: 6px 8px; text-align: right; }
.rpt-crew__table td { border: 1px solid #9ca3af; padding: 6px 8px; text-align: right; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; vertical-align: middle; }

/* توقعات الدفعات */
.rpt-forecast-section { margin: 4mm 0 6mm; }
.rpt-forecast__title { margin: 0 0 6px 0; font-size: 13px; font-weight: 800; }
.rpt-forecast__table { width: 100%; border-collapse: collapse; font-size: 11px; border: 1px solid #9ca3af; }
.rpt-forecast__table th { background: #f3f4f6; border: 1px solid #9ca3af; padding: 6px 8px; text-align: right; }
.rpt-forecast__table td { border: 1px solid #9ca3af; padding: 6px 8px; text-align: right; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; vertical-align: middle; }

/* قواعد الطباعة لتفادي الصفحات الفارغة في iOS/Safari */
@media print {
  /* لا تستخدم Flex للحاوية أثناء الطباعة لتجنب حسابات الارتفاع غير الدقيقة */
  #reports-a4-root [data-a4-pages] { display: block !important; }
  /* أجبر فاصل صفحة بعد كل صفحة ما عدا الأخيرة */
  .a4-page { page-break-after: always; break-after: page; }
  .a4-page:last-child { page-break-after: auto; break-after: auto; }
  /* لا تسمح بتقسيم محتويات صفحة واحدة بين صفحتين */
  .a4-page, .a4-inner { break-inside: avoid; -webkit-column-break-inside: avoid; }
}
`,O=96,D=25.4,z=210,$=297,_=Math.round(z/D*O),I=Math.round($/D*O);function W(){try{return{header:localStorage.getItem("reportsPdf.hide.header")==="1",kpis:localStorage.getItem("reportsPdf.hide.kpis")==="1",revenue:localStorage.getItem("reportsPdf.hide.revenue")==="1",outstanding:localStorage.getItem("reportsPdf.hide.outstanding")==="1",crew:localStorage.getItem("reportsPdf.hide.crew")==="1",forecast:localStorage.getItem("reportsPdf.hide.forecast")==="1"}}catch{return{header:!1,kpis:!1,revenue:!1}}}function J(t,e){!t||!e||(t.toggleAttribute("data-hide-header",!!e.header),t.toggleAttribute("data-hide-kpis",!!e.kpis),t.toggleAttribute("data-hide-revenue",!!e.revenue),t.toggleAttribute("data-hide-outstanding",!!e.outstanding),t.toggleAttribute("data-hide-crew",!!e.crew),t.toggleAttribute("data-hide-forecast",!!e.forecast))}function q(t="preview"){const e=document.createElement("div");e.id="reports-a4-root",e.setAttribute("dir",document.documentElement.getAttribute("dir")||"rtl"),e.setAttribute("data-render-context",t);const n=document.createElement("style");n.textContent=String(B).trim(),e.appendChild(n);const s=document.createElement("div");return s.setAttribute("data-a4-pages",""),e.appendChild(s),J(e,W()),e}function K(){const t=document.createElement("div");t.className="rpt-header";const e=document.createElement("div");e.className="rpt-header-top";const n=document.createElement("div");n.className="rpt-titleblock";const s=document.createElement("h1");s.textContent=o("reservations.reports.print.title","تقرير الحجوزات","Reservations report");const l=document.createElement("p");l.className="rpt-subtitle",l.textContent=`${N(new Date)} • ${o("reservations.reports.print.generated","تاريخ التوليد","Generated on")}`,n.appendChild(s),n.appendChild(l);const p=document.createElement("img");return p.className="rpt-logo",p.alt="Logo",p.decoding="async",p.loading="lazy",p.src=U(),e.appendChild(n),e.appendChild(p),t.appendChild(e),t}function S(t){return Number.isFinite(Number(t))?Math.round(Number(t)*100)/100:0}function V(){const t=C.lastSnapshot?.metrics||{},e=document.createElement("div");e.className="rpt-kpis";const n=(d,f)=>{const u=document.createElement("div");return u.className="rpt-kpi",u.innerHTML=`<div class="label">${d}</div><div class="value">${f??"—"}</div>`,u},s=T(t.total||0),l=P(S(t.revenue)),p=P(S(t.netProfit)),c=P(S(t.companyShareTotal)),b=P(S(t.taxTotal)),r=P(S(t.maintenanceExpense));return e.appendChild(n(o("reservations.reports.kpi.total.label","الحجوزات","Reservations"),s)),e.appendChild(n(o("reservations.reports.kpi.revenue.label","الإيرادات","Revenue"),l)),e.appendChild(n(o("reservations.reports.kpi.net.label","صافي الربح","Net profit"),p)),e.appendChild(n(o("reservations.reports.kpi.share.label","نسبة الشركة","Company share"),c)),e.appendChild(n(o("reservations.reports.kpi.tax.label","الضريبة","Tax"),b)),e.appendChild(n(o("reservations.reports.kpi.maintenance.label","مصاريف الصيانة","Maintenance"),r)),e}function Z(){const t=C.lastSnapshot?.metrics||{},e=document.createElement("section");e.className="rpt-revenue-section";const n=document.createElement("h4");n.className="rpt-revenue__title",n.textContent=o("reservations.reports.kpi.revenue.details.title","تفاصيل الإيرادات","Revenue details");const s=document.createElement("div");s.className="rpt-revenue";const l=(c,b)=>{const r=document.createElement("div");r.className="rpt-revenue__item";const d=document.createElement("span");d.className="rpt-revenue__label",d.textContent=c;const f=document.createElement("strong");f.className="rpt-revenue__value",f.textContent=b,r.appendChild(d),r.appendChild(f),s.appendChild(r)},p=c=>P(S(c||0));return l(o("reservations.reports.kpi.revenue.details.gross","الإيراد الكلي","Gross revenue"),p(t.revenue)),l(o("reservations.reports.kpi.revenue.details.share","نسبة الشركة","Company share"),p(t.companyShareTotal)),l(o("reservations.reports.kpi.revenue.details.tax","الضريبة","Tax"),p(t.taxTotal)),l(o("reservations.reports.kpi.revenue.details.crewGross","إجمالي الطاقم","Crew total"),p(t.crewTotal)),l(o("reservations.reports.kpi.revenue.details.crew","تكلفة الطاقم","Crew cost"),p(t.crewCostTotal)),Number.isFinite(Number(t.maintenanceExpense))&&l(o("reservations.reports.kpi.revenue.details.maintenance","مصاريف الصيانة","Maintenance"),p(t.maintenanceExpense)),l(o("reservations.reports.kpi.revenue.details.net","صافي الربح","Net profit"),p(t.netProfit)),e.appendChild(n),e.appendChild(s),e}function Y(){const t=(C.lastSnapshot?.outstanding||[]).slice(0,6),e=document.createElement("section");e.className="rpt-outstanding-section";const n=document.createElement("h4");if(n.className="rpt-outstanding__title",n.textContent=o("reservations.reports.topOutstanding.title","أعلى المستحقات","Top outstanding"),e.appendChild(n),!t.length){const c=document.createElement("p");return c.style.fontSize="11px",c.style.opacity=".8",c.textContent=o("reservations.reports.table.emptyPeriod","لا توجد بيانات في هذه الفترة.","No data for this period."),e.appendChild(c),e}const s=document.createElement("table");s.className="rpt-outstanding__table";const l=document.createElement("thead");document.createElement("tr"),["الحجز / العميل","حالة الدفع","المستحق"].forEach((c,b)=>{const r=document.createElement("th"),d=b===0?o("reservations.reports.topOutstanding.headers.reservation","الحجز / العميل","Reservation / Customer"):b===1?o("reservations.reports.topOutstanding.headers.status","حالة الدفع","Payment status"):o("reservations.reports.topOutstanding.headers.amount","المستحق","Outstanding");r.textContent=d,l.appendChild(r)});const p=document.createElement("tbody");return t.forEach(c=>{const b=document.createElement("tr"),r=document.createElement("td");r.textContent=`#${c.code} — ${c.customer||""}`,b.appendChild(r);const d=document.createElement("td");d.textContent=M(c.paidStatus),b.appendChild(d);const f=document.createElement("td");f.textContent=P(c.outstanding),b.appendChild(f),p.appendChild(b)}),s.appendChild(l),s.appendChild(p),e.appendChild(s),e}function Q(){const t=(C.lastSnapshot?.crewWork||[]).slice(0,12),e=document.createElement("section");e.className="rpt-crew-section";const n=document.createElement("h4");if(n.className="rpt-crew__title",n.textContent=o("reservations.reports.crew.title","تقرير عمل الطاقم","Crew work report"),e.appendChild(n),!t.length){const r=document.createElement("p");return r.style.fontSize="11px",r.style.opacity=".8",r.textContent=o("reservations.reports.table.emptyPeriod","لا توجد بيانات في هذه الفترة.","No data for this period."),e.appendChild(r),e}const s=document.createElement("table");s.className="rpt-crew__table";const l=document.createElement("thead"),p=document.createElement("tr");[o("reservations.reports.crew.headers.technician","الفني","Technician"),o("reservations.reports.crew.headers.days","أيام العمل","Work days"),o("reservations.reports.crew.headers.billable","فوتر الطاقم","Crew billable"),o("reservations.reports.crew.headers.cost","تكلفة الطاقم","Crew cost"),o("reservations.reports.crew.headers.net","صافي المساهمة","Net contribution")].forEach(r=>{const d=document.createElement("th");d.textContent=r,p.appendChild(d)}),l.appendChild(p);const b=document.createElement("tbody");return t.forEach(r=>{const d=document.createElement("tr");[r.name||String(r.id||""),T(r.days||0),P(r.billable||0),P(r.cost||0),P((r.billable||0)-(r.cost||0))].forEach(u=>{const m=document.createElement("td");m.textContent=u,d.appendChild(m)}),b.appendChild(d)}),s.appendChild(l),s.appendChild(b),e.appendChild(s),e}function ee(){const t=Array.isArray(C.lastSnapshot?.paymentForecast)?C.lastSnapshot.paymentForecast.slice(0,16):[],e=document.createElement("section");e.className="rpt-forecast-section";const n=document.createElement("h4");if(n.className="rpt-forecast__title",n.textContent=o("reservations.reports.forecast.title","خريطة الدفعات القادمة","Upcoming payments"),e.appendChild(n),!t.length){const r=document.createElement("p");return r.style.fontSize="11px",r.style.opacity=".8",r.textContent=o("reservations.reports.table.emptyPeriod","لا توجد بيانات في هذه الفترة.","No data for this period."),e.appendChild(r),e}const s=document.createElement("table");s.className="rpt-forecast__table";const l=document.createElement("thead"),p=document.createElement("tr");[o("reservations.reports.forecast.headers.date","التاريخ","Date"),o("reservations.reports.forecast.headers.count","عدد الحجوزات","Count"),o("reservations.reports.forecast.headers.amount","المبلغ المتوقع","Expected amount")].forEach(r=>{const d=document.createElement("th");d.textContent=r,p.appendChild(d)}),l.appendChild(p);const b=document.createElement("tbody");return t.forEach(r=>{const d=document.createElement("tr");[r.date||"",T(r.count||0),P(r.amount||0)].forEach(u=>{const m=document.createElement("td");m.textContent=u,d.appendChild(m)}),b.appendChild(d)}),s.appendChild(l),s.appendChild(b),e.appendChild(s),e}function te(t){const e=document.createElement("table");e.className="rpt-table";const n=document.createElement("thead"),s=document.createElement("tr");t.forEach(p=>{const c=document.createElement("th");c.textContent=p,s.appendChild(c)}),n.appendChild(s);const l=document.createElement("tbody");return e.appendChild(n),e.appendChild(l),{table:e,tbody:l}}function ne(t,e,n){const s=t.querySelector("[data-a4-pages]"),l=m=>{const v=document.createElement("section");v.className=`a4-page ${m===0?"a4-page--primary":"a4-page--continuation"}`,v.style.width=`${_}px`,v.style.height=`${I}px`;const g=document.createElement("div");if(g.className="a4-inner",m===0){g.appendChild(K()),g.appendChild(V()),g.appendChild(Z()),g.appendChild(Y()),g.appendChild(ee()),g.appendChild(Q());const i=document.createElement("h4");i.className="rpt-table-title",i.textContent=o("reservations.reports.results.title","تفاصيل الحجوزات","Reservations details"),g.appendChild(i)}const{table:w,tbody:a}=te(n);return g.appendChild(w),v.appendChild(g),s.appendChild(v),{page:v,table:w,tbody:a}},p=(m,v)=>{const g=document.createElement("tr");return n.forEach(w=>{const a=document.createElement("td"),i=document.createElement("div");i.className="rpt-cell",i.textContent=v[w]!=null?String(v[w]):"",a.appendChild(i),g.appendChild(a)}),m.appendChild(g),g},c=(m,v)=>{try{const w=(m.querySelector(".a4-inner")||m).getBoundingClientRect(),a=v.lastElementChild;if(!a)return!0;const i=a.getBoundingClientRect(),h=w.bottom-1;return i.bottom<=h}catch{return!0}};let b=0,{page:r,table:d,tbody:f}=l(b),u=0;for(let m=0;m<e.length;m+=1){const v=p(f,e[m]);if(c(r,f))u+=1;else{if(v.remove(),u===0)try{d.remove()}catch{}({page:r,table:d,tbody:f}=l(++b)),p(f,e[m]),u=1}}}function ae(t=""){const e=String(t||"").toLowerCase();return/الحجز|reservation/.test(e)||/العميل|customer/.test(e)||/التاريخ|date/.test(e)||/الحالة|status/.test(e)||/الدفع|payment/.test(e)||/الإجمالي|total/.test(e)}function j(t=[]){try{const e=new Set;return t.forEach(n=>{const s=`reportsPdf.column.${n}`,l=localStorage.getItem(s);l==null?ae(n)&&e.add(n):l==="1"&&e.add(n)}),e.size===0&&t.forEach(n=>e.add(n)),e}catch{return new Set(t)}}function L(t,e,n){if(!n)return t;const s=n.showPaid??!0,l=n.showPartial??!0,p=n.showUnpaid??!0,c=n.showConfirmed??!0,b=n.showPending??!0,r=n.showCompleted??!0,d=n.showCancelled??!0,f=e.find(a=>/الحالة|status/i.test(a))||null,u=e.find(a=>/الدفع|payment/i.test(a))||null;if(!f&&!u)return t;const m=a=>/جزئ|partial/i.test(String(a||"")),v=a=>/مدفوعة|مدفوع|paid/i.test(String(a||""))&&!m(a),g=a=>/غير مدفوعة|غير مدفوع|unpaid/i.test(String(a||"")),w=a=>{const i=String(a||"").toLowerCase();return/completed|منته/.test(i)?"completed":/confirmed|مؤكد/.test(i)?"confirmed":/pending|غير مؤكد|قيد التأكيد/.test(i)?"pending":/cancel|ملغ/.test(i)?"cancelled":"other"};return t.filter(a=>{let i=!0;if(u){const h=a[u];!s&&v(h)&&(i=!1),!l&&m(h)&&(i=!1),!p&&g(h)&&(i=!1)}if(f){const h=w(a[f]);!r&&h==="completed"&&(i=!1),!c&&h==="confirmed"&&(i=!1),!b&&h==="pending"&&(i=!1),!d&&h==="cancelled"&&(i=!1)}return i})}function A(t=[],{context:e="preview",columns:n,rowFilters:s}={}){const l=q(e),p=Array.isArray(t)&&t.length?t:C.lastSnapshot?.tableRows||[];let c=Object.keys(p[0]||{});const b=n&&n.length?new Set(n):j(c);c=c.filter(f=>b.has(f));const r=L(p,c,s),d=document.createElement("div");Object.assign(d.style,{position:"fixed",left:0,top:0,width:`${_}px`,height:"0",pointerEvents:"none",zIndex:-1,visibility:"hidden"}),document.body.appendChild(d),d.appendChild(l);try{ne(l,r,c)}finally{try{l.parentElement?.removeChild(l)}catch{}try{d.parentElement?.removeChild(d)}catch{}}return l}async function fe(t=[],{action:e="save",strict:n=!1,popupWindow:s=null}={}){const l={showPaid:localStorage.getItem("reportsPdf.rows.paid")!=="0",showPartial:localStorage.getItem("reportsPdf.rows.partial")!=="0",showUnpaid:localStorage.getItem("reportsPdf.rows.unpaid")!=="0",showConfirmed:localStorage.getItem("reportsPdf.rows.confirmed")!=="0",showPending:localStorage.getItem("reportsPdf.rows.pending")!=="0",showCompleted:localStorage.getItem("reportsPdf.rows.completed")!=="0",showCancelled:localStorage.getItem("reportsPdf.rows.cancelled")!=="0"},p=A(t,{context:"export",rowFilters:l}),c=document.createElement("div");Object.assign(c.style,{position:"fixed",top:0,left:0,width:0,height:0,pointerEvents:"none",zIndex:-1}),c.appendChild(p),document.body.appendChild(c);try{if(n||localStorage.getItem("reportsPdf.strict")==="on"){const a=`<!DOCTYPE html><html lang="ar" dir="rtl"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1" /><title>${o("reservations.reports.print.title","تقرير الحجوزات","Reservations report")}</title><style>@page{size:A4;margin:0;}html,body{margin:0;padding:0;background:#fff;direction:rtl;text-align:right;}#reports-a4-root{width:${_}px;height:auto} .a4-page{width:${_}px;height:${I}px} @media print { [data-a4-pages]{display:block!important}.a4-page{page-break-after:always;break-after:page}.a4-page:last-child{page-break-after:auto;break-after:auto}.a4-page,.a4-inner{break-inside:avoid;-webkit-column-break-inside:avoid} }</style></head><body></body></html>`;if(s&&typeof s.document?.open=="function"){const x=s.document;try{x.open(),x.write(a),x.close()}catch{}try{const y=p.cloneNode(!0);x.body.appendChild(y),x.fonts?.ready&&await x.fonts.ready}catch{}await new Promise(y=>setTimeout(y,60));try{s.focus(),s.print()}catch{}setTimeout(()=>{try{s.close()}catch{}},1500);return}await new Promise(x=>setTimeout(x,0));const i=document.createElement("iframe");Object.assign(i.style,{position:"fixed",width:"1px",height:"1px",right:"0",bottom:"0",border:"0",opacity:"0",pointerEvents:"none"}),document.body.appendChild(i);const h=i.contentWindow?.document;try{h.open(),h.write(a),h.close()}catch{}try{const x=p.cloneNode(!0);h.body.appendChild(x),h.fonts?.ready&&await h.fonts.ready}catch{}await new Promise(x=>setTimeout(x,60));try{i.contentWindow?.focus(),i.contentWindow?.print()}catch{}setTimeout(()=>{try{i.remove()}catch{}},1500);return}try{await H()}catch{}let r=window.jspdf&&window.jspdf.jsPDF||window.jsPDF&&window.jsPDF.jsPDF||window.jspdf&&window.jspdf.default&&window.jspdf.default.jsPDF||window.jsPDF&&window.jsPDF.default&&window.jsPDF.default.jsPDF,d=window.html2canvas;if(typeof r!="function")try{await F("https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"),r=window.jspdf&&window.jspdf.jsPDF||window.jsPDF&&window.jsPDF.jsPDF||window.jsPDF&&window.jsPDF.default&&window.jsPDF.default.jsPDF||window.jspdf&&window.jspdf.default&&window.jspdf.default.jsPDF}catch{}if(typeof d!="function")try{await F("https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"),d=window.html2canvas}catch{}if(typeof r!="function"||typeof d!="function"){const a=typeof r=="function",i=typeof d=="function";throw new Error(`PDF dependencies not available (jsPDF: ${a}, html2canvas: ${i})`)}const f=new r({unit:"mm",format:"a4",orientation:"portrait",compress:!0}),u=Math.min(2,Math.max(1.6,(window.devicePixelRatio||1)*1.25)),m=(()=>{try{const a=t&&t[0]?Object.keys(t[0]):Object.keys(C.lastSnapshot?.tableRows?.[0]||{}),i=j(a);return a.filter(h=>i.has(h))}catch{return null}})(),v={showPaid:localStorage.getItem("reportsPdf.rows.paid")!=="0",showUnpaid:localStorage.getItem("reportsPdf.rows.unpaid")!=="0",showConfirmed:localStorage.getItem("reportsPdf.rows.confirmed")!=="0",showPending:localStorage.getItem("reportsPdf.rows.pending")!=="0",showCompleted:localStorage.getItem("reportsPdf.rows.completed")!=="0"},g=A(t,{context:"export",columns:m||void 0,rowFilters:v});c.innerHTML="",c.appendChild(g);const w=Array.from(g.querySelectorAll(".a4-page"));for(let a=0;a<w.length;a+=1){const i=w[a],x=(await d(i,{scale:u,scrollX:0,scrollY:0,backgroundColor:"#ffffff",useCORS:!0,allowTaint:!1,windowWidth:_,windowHeight:I,letterRendering:!0,imageTimeout:0})).toDataURL("image/jpeg",.98);a>0&&f.addPage(),f.addImage(x,"JPEG",0,0,z,$,`page-${a+1}`,"FAST"),await new Promise(y=>requestAnimationFrame(y))}if(e==="print"){const a=f.output("bloburl");await new Promise(i=>{const h=document.createElement("iframe");Object.assign(h.style,{position:"fixed",right:0,bottom:0,width:"1px",height:"1px",border:0}),h.onload=()=>{try{h.contentWindow?.focus(),h.contentWindow?.print()}catch{}setTimeout(()=>{h.remove(),i()},700)},h.src=a,document.body.appendChild(h)})}else{const a=f.output("blob"),i=URL.createObjectURL(a),h=document.createElement("a");h.href=i,h.download="reservations-report.pdf",h.rel="noopener",h.style.display="none",document.body.appendChild(h),h.click(),setTimeout(()=>{try{URL.revokeObjectURL(i),h.remove()}catch{}},1500)}}finally{c.remove()}}async function ge(t=[]){await X();const e=window.XLSX;if(!e)throw new Error("XLSX dependency not available");const n=t&&t[0]?Object.keys(t[0]):Object.keys(C.lastSnapshot?.tableRows?.[0]||{}),s=j(n),l=n.filter(i=>s.has(i)),p={showPaid:localStorage.getItem("reportsPdf.rows.paid")!=="0",showPartial:localStorage.getItem("reportsPdf.rows.partial")!=="0",showUnpaid:localStorage.getItem("reportsPdf.rows.unpaid")!=="0",showConfirmed:localStorage.getItem("reportsPdf.rows.confirmed")!=="0",showPending:localStorage.getItem("reportsPdf.rows.pending")!=="0",showCompleted:localStorage.getItem("reportsPdf.rows.completed")!=="0",showCancelled:localStorage.getItem("reportsPdf.rows.cancelled")!=="0"},c=Array.isArray(t)&&t.length?t:C.lastSnapshot?.tableRows||[],b=L(c,l,p),r=o("reservations.reports.print.title","تقرير الحجوزات","Reservations report"),d=`${N(new Date)} • ${o("reservations.reports.print.generated","تاريخ التوليد","Generated on")}`,f=C.lastSnapshot?.metrics||{},u=[];u.push([r]),u.push([d]),u.push([]),u.push([o("reservations.reports.kpi.total.label","إجمالي الحجوزات","Total"),String(f.total??0),o("reservations.reports.kpi.revenue.label","الإيرادات","Revenue"),String(f.revenue??0),o("reservations.reports.kpi.net.label","صافي الربح","Net"),String(f.netProfit??0)]),u.push([o("reservations.reports.kpi.share.label","نسبة الشركة","Company share"),String(f.companyShareTotal??0),o("reservations.reports.kpi.tax.label","الضريبة","Tax"),String(f.taxTotal??0),o("reservations.reports.kpi.maintenance.label","مصاريف الصيانة","Maintenance"),String(f.maintenanceExpense??0)]),u.push([]),u.push(l),b.forEach(i=>{const h=l.map(x=>i[x]!=null?String(i[x]):"");u.push(h)});const m=e.utils.aoa_to_sheet(u);m["!merges"]||(m["!merges"]=[]);const v=Math.max(1,l.length)-1;m["!merges"].push({s:{r:0,c:0},e:{r:0,c:Math.max(3,v)}}),m["!merges"].push({s:{r:1,c:0},e:{r:1,c:Math.max(3,v)}});const g=l.map((i,h)=>{let y=(i||"").length+2;for(let E=7;E<u.length;E+=1){const k=u[E][h]||"";y=Math.max(y,String(k).length)}return{wch:Math.min(40,Math.max(10,y))}});m["!cols"]=g;const w=e.utils.book_new();e.utils.book_append_sheet(w,m,o("reservations.reports.export.sheetName","الحجوزات","Reservations"));const a=`${o("reservations.reports.export.filePrefix","تقرير-الحجوزات","reservations-report")}.xlsx`;e.writeFile(w,a)}async function be(t=[]){const e=t&&t[0]?Object.keys(t[0]):Object.keys(C.lastSnapshot?.tableRows?.[0]||{}),n=j(e),s=e.filter(g=>n.has(g)),l={showPaid:localStorage.getItem("reportsPdf.rows.paid")!=="0",showPartial:localStorage.getItem("reportsPdf.rows.partial")!=="0",showUnpaid:localStorage.getItem("reportsPdf.rows.unpaid")!=="0",showConfirmed:localStorage.getItem("reportsPdf.rows.confirmed")!=="0",showPending:localStorage.getItem("reportsPdf.rows.pending")!=="0",showCompleted:localStorage.getItem("reportsPdf.rows.completed")!=="0",showCancelled:localStorage.getItem("reportsPdf.rows.cancelled")!=="0"},p=Array.isArray(t)&&t.length?t:C.lastSnapshot?.tableRows||[],c=L(p,s,l),b=o("reservations.reports.print.title","تقرير الحجوزات","Reservations report"),r=`${N(new Date)} • ${o("reservations.reports.print.generated","تاريخ التوليد","Generated on")}`,d=C.lastSnapshot?.metrics||{},f=U(),u=g=>{const w=String(g??"");return/[",\n]/.test(w)?'"'+w.replace(/"/g,'""')+'"':w},m=[];m.push(u(b)),m.push(u(r)),m.push(`Logo,${u(f)}`),m.push(""),m.push([o("reservations.reports.kpi.total.label","إجمالي الحجوزات","Total"),d.total??0,o("reservations.reports.kpi.revenue.label","الإيرادات","Revenue"),d.revenue??0,o("reservations.reports.kpi.net.label","صافي الربح","Net"),d.netProfit??0].map(u).join(",")),m.push([o("reservations.reports.kpi.share.label","نسبة الشركة","Company share"),d.companyShareTotal??0,o("reservations.reports.kpi.tax.label","الضريبة","Tax"),d.taxTotal??0,o("reservations.reports.kpi.maintenance.label","مصاريف الصيانة","Maintenance"),d.maintenanceExpense??0].map(u).join(",")),m.push(""),m.push(s.map(u).join(",")),c.forEach(g=>{const w=s.map(a=>u(g[a]!=null?g[a]:""));m.push(w.join(","))});let v=!1;try{await G();const g=window.JSZip;if(g){const w=new g,a=o("reservations.reports.export.filePrefix","تقرير-الحجوزات","reservations-report"),i=["\uFEFF"+m.slice(0,m.indexOf(s.map(u).join(","))).join(`
`)],h=["\uFEFF"+[s.map(u).join(","),...c.map(k=>s.map(R=>u(k[R]??"")).join(","))].join(`
`)];w.file(`${a}-metadata.csv`,i.join("")),w.file(`${a}.csv`,h.join(""));try{const R=await(await fetch(f,{mode:"cors"})).blob();w.file("logo.png",R)}catch{}const x=await w.generateAsync({type:"blob"}),y=URL.createObjectURL(x),E=document.createElement("a");E.href=y,E.download=`${a}.zip`,E.style.display="none",document.body.appendChild(E),E.click(),setTimeout(()=>{URL.revokeObjectURL(y),E.remove()},1500),v=!0}}catch{}if(!v){const g=new Blob(["\uFEFF"+m.join(`
`)],{type:"text/csv;charset=utf-8"}),w=URL.createObjectURL(g),a=document.createElement("a");a.href=w,a.download=`${o("reservations.reports.export.filePrefix","تقرير-الحجوزات","reservations-report")}.csv`,a.style.display="none",document.body.appendChild(a),a.click(),setTimeout(()=>{URL.revokeObjectURL(w),a.remove()},1500)}}const re="https://art-ratio.sirv.com/AR-Logo-v3.5-curved.png";function U(){try{const t=localStorage.getItem("reportsPdf.logoUrl");if(t&&/^https?:|^data:|^blob:/.test(t))return t}catch{}return re}export{A as buildA4ReportPages,be as exportA4ReportCsv,ge as exportA4ReportExcel,fe as exportA4ReportPdf};
