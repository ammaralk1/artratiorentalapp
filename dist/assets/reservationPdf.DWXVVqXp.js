import{n as T,j as jt,t as r,d as Ft,b as Lt,h as ta,y as Xe,B as rn}from"./auth.DIejtHti.js";import{n as na,C as st,B as ut,a as aa,b as Mt,d as ln,A as cn,g as un,r as sa,c as oa,e as ra,h as ia}from"./reservationsService.aEDjNVCd.js";import{s as la,i as Gt,j as Xt,H as dn,O as pn}from"./state.EQiRnoyt.js";import{h as ca}from"./view.CGinDsx3.js";import{q as ua}from"./quotePdf.C2lQPEPC.js";import{s as mn,a as fn,e as yn,p as da}from"./canvasColorUtils.CviLtv6S.js";function bn(e){const t=new Date;if(t.setHours(0,0,0,0),e==="today")return{startDate:He(t),endDate:He(t)};if(e==="week"){const n=new Date(t),a=n.getDay(),s=a===0?6:a-1;n.setDate(n.getDate()-s);const u=new Date(n);return u.setDate(n.getDate()+6),{startDate:He(n),endDate:He(u)}}if(e==="month"){const n=new Date(t.getFullYear(),t.getMonth(),1),a=new Date(t.getFullYear(),t.getMonth()+1,0);return{startDate:He(n),endDate:He(a)}}return e==="upcoming"?{startDate:He(t),endDate:""}:{startDate:"",endDate:""}}function ks(){const e=document.getElementById("search-reservation"),t=document.getElementById("filter-start-date"),n=document.getElementById("filter-end-date"),a=document.getElementById("reservation-date-range"),s=document.getElementById("reservation-status-filter");let u=T(t?.value||"").trim(),o=T(n?.value||"").trim(),i=a?.value||"";if(new Set(["","today","week","month"]).has(i)||(i="",a&&(a.value=""),dt(t),dt(n),u="",o=""),!u&&!o&&i){const y=bn(i);u=y.startDate,o=y.endDate}return{searchTerm:na(e?.value||""),startDate:u,endDate:o,status:s?.value||"",quickRange:i}}function js(e){const t=()=>{typeof e=="function"&&e()},n=document.getElementById("search-reservation");n&&!n.dataset.listenerAttached&&(n.addEventListener("input",()=>{n.value=T(n.value),t()}),n.dataset.listenerAttached="true");const a=document.getElementById("filter-start-date");a&&!a.dataset.listenerAttached&&(a.addEventListener("change",()=>{const d=document.getElementById("reservation-date-range");d&&(d.value=""),t()}),a.dataset.listenerAttached="true");const s=document.getElementById("filter-end-date");s&&!s.dataset.listenerAttached&&(s.addEventListener("change",()=>{const d=document.getElementById("reservation-date-range");d&&(d.value=""),t()}),s.dataset.listenerAttached="true");const u=document.getElementById("reservation-date-range");u&&!u.dataset.listenerAttached&&(u.addEventListener("change",()=>{pa(u.value),t()}),u.dataset.listenerAttached="true");const o=document.getElementById("reservation-status-filter");o&&!o.dataset.listenerAttached&&(o.addEventListener("change",t),o.dataset.listenerAttached="true");const i=document.getElementById("clear-filters");i&&!i.dataset.listenerAttached&&(i.addEventListener("click",()=>{n&&(n.value=""),dt(a),dt(s),u&&(u.value=""),o&&(o.value=""),t()}),i.dataset.listenerAttached="true")}function pa(e){const t=document.getElementById("filter-start-date"),n=document.getElementById("filter-end-date");if(!t||!n)return;const{startDate:a,endDate:s}=bn(e);t._flatpickr?a?t._flatpickr.setDate(a,!1,"Y-m-d"):t._flatpickr.clear():t.value=a,n._flatpickr?s?n._flatpickr.setDate(s,!1,"Y-m-d"):n._flatpickr.clear():n.value=s}function He(e){if(!e)return"";const t=e.getTimezoneOffset()*6e4;return new Date(e.getTime()-t).toISOString().split("T")[0]}function dt(e){e&&(e._flatpickr&&e._flatpickr.clear(),e.value="")}const ma=""+new URL("Tajawal-400.ttf",import.meta.url).href,fa=""+new URL("Tajawal-500.ttf",import.meta.url).href,Jt=""+new URL("Tajawal-700.ttf",import.meta.url).href,hn="reservations.quote.sequence",Yt={reservation:"reservations.quote.togglePrefs.v1",project:"projects.quote.togglePrefs.v1"},gn="https://help.artratio.sa/guide/quote-preview",be={logoUrl:"https://art-ratio.sirv.com/AR-Logo-v3.5-curved.png",companyName:"Ø´Ø±ÙƒØ© ÙÙˆØ¯ Ø¢Ø±Øª Ù„Ù„Ø¯Ø¹Ø§ÙŠØ© ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù† (Ø´Ø±ÙƒØ© Ø´Ø®Øµ ÙˆØ§Ø­Ø¯)",commercialRegistry:"4030485240",beneficiaryName:"Ø´Ø±ÙƒØ© ÙÙˆØ¯ Ø¢Ø±Øª Ù„Ù„Ø¯Ø¹Ø§ÙŠØ© ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù† (Ø´Ø±ÙƒØ© Ø´Ø®Øµ ÙˆØ§Ø­Ø¯)",bankName:"Ù…ØµØ±Ù Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠ",accountNumber:"Ù£Ù¥Ù¨Ù Ù Ù Ù Ù¡Ù Ù Ù Ù¦Ù Ù¨Ù¦Ù Ù¦Ù¥Ù§Ù Ù¦",iban:"SA1680000358608016065706",approvalNote:"Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø±Ø¶ ØªØ¹ØªØ¨Ø± Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…."},ya=["ÙŠÙˆÙ… Ø§Ù„Ø¹Ù…Ù„ Ù‡Ùˆ 12 Ø³Ø§Ø¹Ø©ØŒ ÙˆÙŠØªÙ… Ø§Ø­ØªØ³Ø§Ø¨ Ù†ØµÙ ÙŠÙˆÙ… Ø¥Ø¶Ø§ÙÙŠ Ø¨Ø¹Ø¯ 20 Ø³Ø§Ø¹Ø©ØŒ Ø«Ù… ÙŠÙˆÙ… ÙƒØ§Ù…Ù„ Ø¨Ø¹Ø¯ Ø°Ù„Ùƒ.","ÙŠÙ…Ù†Ø¹ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙÙŠ Ø£Ù†Ø´Ø·Ø© ØºÙŠØ± Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©.","ÙŠØªØ­Ù…Ù„ Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø± Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© Ø£ÙŠ ØªÙ„Ù Ø£Ùˆ ÙÙ‚Ø¯Ø§Ù†.","ÙŠØ¬Ø¨ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙÙŠ Ø­Ø§Ù„ØªÙ‡Ø§ Ø§Ù„Ø£ØµÙ„ÙŠØ©.","ÙŠØªÙ… ÙØ±Ø¶ Ø±Ø³ÙˆÙ… Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ù„ØºØ§Ø¡ Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ù‚Ø¨Ù„ 24 Ø³Ø§Ø¹Ø©."],_e=[...ya],ba=["ÙŠØªÙ… Ø¯ÙØ¹ 50% Ù…Ù† Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø±ØŒ ÙˆÙŠØªÙ… Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø§Ù„Ù€ 50% Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ.","ÙŠØ­ØµÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¹Ù„Ù‰ Ø­Ù‚ÙˆÙ‚ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© ÙÙŠ Ø£ÙŠ Ù…ÙƒØ§Ù† ÙŠØ±Ø§Ù‡ Ù…Ù†Ø§Ø³Ø¨Ø§Ù‹ØŒ Ø¨ÙŠÙ†Ù…Ø§ ØªØ­ØªÙØ¸ Ø§Ù„Ø´Ø±ÙƒØ© Ø¨Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø®Ø§Ù… ÙˆÙ„Ø§ ØªØ³ØªØ®Ø¯Ù…Ù‡Ø§ Ø¥Ù„Ø§ Ø¨Ø¹Ø¯ Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ø§ Ù„Ù… ÙŠÙØªÙÙ‚ Ø¹Ù„Ù‰ ØºÙŠØ± Ø°Ù„Ùƒ.","ÙŠØªÙ… Ø§Ù„Ø§ØªÙØ§Ù‚ Ø¹Ù„Ù‰ Ø¬Ø¯ÙˆÙ„ Ø²Ù…Ù†ÙŠ Ù„Ù„ØªÙ†ÙÙŠØ°ØŒ ÙˆØ£ÙŠ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ø®Ø§Ø±Ø¬ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ù…ØªÙÙ‚ Ø¹Ù„ÙŠÙ‡ ØªØ®Ø¶Ø¹ Ù„Ø±Ø³ÙˆÙ… Ø¥Ø¶Ø§ÙÙŠØ©.","Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù† ØªÙˆÙÙŠØ± Ø§Ù„ØªØµØ§Ø±ÙŠØ­ Ø§Ù„Ù„Ø§Ø²Ù…Ø© Ù„Ù„ØªØµÙˆÙŠØ± ÙÙŠ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©ØŒ ÙˆØ£ÙŠ ØªØ£Ø®ÙŠØ± Ù†Ø§ØªØ¬ Ø¹Ù† Ø°Ù„Ùƒ Ù‚Ø¯ ÙŠØ¤Ø«Ø± Ø¹Ù„Ù‰ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„ØªØ³Ù„ÙŠÙ….","ØªÙØ­ÙÙŽØ¸ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ù„Ù„Ù…Ø´Ø±ÙˆØ¹ Ù„Ù…Ø¯Ø© 12 Ø´Ù‡Ø±Ø§Ù‹ ÙÙŠ Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ø´Ø±ÙƒØ©ØŒ ÙˆÙŠÙ…ÙƒÙ† Ù„Ù„Ø¹Ù…ÙŠÙ„ Ø·Ù„Ø¨ Ù†Ø³Ø® Ø¥Ø¶Ø§ÙÙŠØ© Ø®Ù„Ø§Ù„ ØªÙ„Ùƒ Ø§Ù„ÙØªØ±Ø©.","ÙŠØªØ­Ù…Ù‘Ù„ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© ØªÙˆÙÙŠØ± Ø¨ÙŠØ¦Ø© Ø¹Ù…Ù„ Ø¢Ù…Ù†Ø© Ù„Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ ÙˆØ§Ù„Ù…Ø¹Ø¯Ø§Øª ÙÙŠ Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªØµÙˆÙŠØ±ØŒ ÙˆÙŠØ¶Ù…Ù† Ø§ØªØ®Ø§Ø° ÙƒØ§ÙØ© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·Ø§Øª Ø§Ù„Ù„Ø§Ø²Ù…Ø© Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø³Ù„Ø§Ù…ØªÙ‡Ù…."];function $t(e){return e?e.split(/\r?\n/).map(t=>t.trim()).filter(t=>t.length>0):[..._e]}function ha(){const e=document.getElementById("reservation-terms");if(e&&e.value.trim().length>0){const a=$t(e.value);if(a.length)return a}const t=document.getElementById("edit-res-terms");if(t&&t.value.trim().length>0){const a=$t(t.value);if(a.length)return a}const n=_e.join(`
`);return e&&e.value.trim().length===0&&(e.value=n),t&&t.value.trim().length===0&&(t.value=n),[..._e]}const ga=[{id:"customerInfo",labelKey:"reservations.quote.sections.customer",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„",defaultSelected:!0},{id:"reservationInfo",labelKey:"reservations.quote.sections.reservation",fallback:"ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²",defaultSelected:!0},{id:"projectInfo",labelKey:"reservations.quote.sections.project",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",defaultSelected:!0},{id:"financialSummary",labelKey:"reservations.quote.sections.financial",fallback:"Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ",defaultSelected:!0},{id:"items",labelKey:"reservations.quote.sections.items",fallback:"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",defaultSelected:!0},{id:"crew",labelKey:"reservations.quote.sections.crew",fallback:"Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„",defaultSelected:!0},{id:"notes",labelKey:"reservations.quote.sections.notes",fallback:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø­Ø¬Ø²",defaultSelected:!0},{id:"payment",labelKey:"reservations.quote.sections.payment",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹",defaultSelected:!1}],vt=[{id:"rowNumber",labelKey:null,fallback:"#",render:(e,t)=>l(T(String(t+1)))},{id:"code",labelKey:"reservations.details.table.headers.code",fallback:"Ø§Ù„ÙƒÙˆØ¯",render:e=>{if(e?.isPackage){const t=e?.packageCodeResolved||e?.barcode||"";return l(t||"-")}return l(e?.barcode||"-")}},{id:"description",labelKey:"reservations.details.table.headers.description",fallback:"Ø§Ù„ÙˆØµÙ",render:e=>{const t=String(e?.desc||e?.description||"-");return`<div class="quote-cell quote-cell--desc">${l(t)}</div>`}},{id:"quantity",labelKey:"reservations.details.table.headers.quantity",fallback:"Ø§Ù„ÙƒÙ…ÙŠØ©",render:e=>l(T(String(e?.qty||1)))},{id:"unitPrice",labelKey:null,fallback:"Ù„ÙƒÙ„ ÙŠÙˆÙ…",render:e=>l(T(Number(e?.unitPriceValue||0).toFixed(2)))},{id:"price",labelKey:null,fallback:"Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹",render:e=>l(T(Number(e?.price||0).toFixed(2)))}],wt=[{id:"rowNumber",labelKey:null,fallback:"#",render:(e,t)=>l(T(String(t+1)))},{id:"position",labelKey:"reservations.details.crew.position",fallback:"Ø§Ù„Ù…Ù†ØµØ¨",render:e=>l(T(e?.positionLabel??e?.position_name??e?.role??r("reservations.crew.positionFallback","Ù…Ù†ØµØ¨ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…")))},{id:"unitPrice",labelKey:null,fallback:"Ù„ÙƒÙ„ ÙŠÙˆÙ…",render:e=>{const t=Number.isFinite(Number(e?.positionClientPrice))?Number(e.positionClientPrice):0;return l(`${T(t.toFixed(2))} ${r("reservations.create.summary.currency","SR")}`)}},{id:"price",labelKey:null,fallback:"Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹",render:e=>{const t=Number.isFinite(Number(e?.positionClientPrice))?Number(e.positionClientPrice):0;return l(`${T(t.toFixed(2))} ${r("reservations.create.summary.currency","SR")}`)}}],Tt={customerInfo:[{id:"customerName",labelKey:"reservations.details.labels.customer",fallback:"Ø§Ù„Ø¹Ù…ÙŠÙ„"},{id:"customerCompany",labelKey:"reservations.details.labels.company",fallback:"Ø§Ù„Ø´Ø±ÙƒØ©"},{id:"customerPhone",labelKey:"reservations.details.labels.phone",fallback:"Ø§Ù„Ù‡Ø§ØªÙ"},{id:"customerEmail",labelKey:"reservations.details.labels.email",fallback:"Ø§Ù„Ø¨Ø±ÙŠØ¯"}],reservationInfo:[{id:"reservationId",labelKey:"reservations.details.labels.reservationId",fallback:"Ø±Ù‚Ù… Ø§Ù„Ø­Ø¬Ø²"},{id:"reservationStart",labelKey:"reservations.details.labels.start",fallback:"Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø­Ø¬Ø²"},{id:"reservationEnd",labelKey:"reservations.details.labels.end",fallback:"Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø­Ø¬Ø²"},{id:"reservationDuration",labelKey:"reservations.details.labels.duration",fallback:"Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…"}],projectInfo:[{id:"projectTitle",labelKey:"reservations.details.labels.project",fallback:"Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectCode",labelKey:"reservations.details.labels.code",fallback:"Ø§Ù„Ø±Ù…Ø²"}],financialSummary:[{id:"discountAmount",labelKey:"reservations.details.labels.discount",fallback:"Ø§Ù„Ø®ØµÙ…"},{id:"subtotalBeforeTax",labelKey:"reservations.details.labels.subtotalBeforeTax",fallback:"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"},{id:"taxAmount",labelKey:"reservations.details.labels.tax",fallback:"Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"},{id:"finalTotal",labelKey:"reservations.details.labels.total",fallback:"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ"}],payment:[{id:"beneficiary",labelKey:"reservations.quote.labels.beneficiary",fallback:"Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙÙŠØ¯"},{id:"bank",labelKey:"reservations.quote.labels.bank",fallback:"Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ"},{id:"account",labelKey:"reservations.quote.labels.account",fallback:"Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨"},{id:"iban",labelKey:"reservations.quote.labels.iban",fallback:"Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ¨Ø§Ù†"}],items:[...vt.map(({id:e,labelKey:t,fallback:n})=>({id:e,labelKey:t,fallback:n})),{id:"equipmentSubtotal",labelKey:"reservations.details.labels.equipmentTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"}],crew:[...wt.map(({id:e,labelKey:t,fallback:n})=>({id:e,labelKey:t,fallback:n})),{id:"crewSubtotal",labelKey:"reservations.details.labels.crewTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±ÙŠÙ‚"}]},vn=[{id:"rowNumber",labelKey:null,fallback:"#",render:(e,t)=>l(T(String(t+1)))},{id:"label",labelKey:null,fallback:"Ø§Ù„Ø¨Ù†Ø¯",render:e=>l(e?.label||"-")},{id:"amount",labelKey:null,fallback:"Ø§Ù„Ø³Ø¹Ø±",render:e=>{const t=Number.isFinite(Number(e?.salePrice??e?.sale_price))?Number(e?.salePrice??e?.sale_price):Number(e?.amount??0)||0;return l(X(t,r("reservations.create.summary.currency","SR")))}},{id:"note",labelKey:null,fallback:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª",render:e=>l(e?.note||"-")}],va=[{id:"customerInfo",labelKey:"projects.quote.sections.customer",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„",defaultSelected:!0},{id:"projectInfo",labelKey:"projects.quote.sections.project",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",defaultSelected:!0},{id:"projectExpenses",labelKey:"projects.quote.sections.expenses",fallback:"Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©",defaultSelected:!0},{id:"projectCrew",labelKey:"projects.quote.sections.crew",fallback:"Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„",defaultSelected:!0},{id:"financialSummary",labelKey:"projects.quote.sections.financial",fallback:"Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ",defaultSelected:!0},{id:"projectEquipment",labelKey:"projects.quote.sections.equipment",fallback:"Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",defaultSelected:!0},{id:"projectNotes",labelKey:"projects.quote.sections.notes",fallback:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",defaultSelected:!0},{id:"payment",labelKey:"reservations.quote.sections.payment",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹",defaultSelected:!1}],wa={customerInfo:Tt.customerInfo,projectInfo:[{id:"projectTitle",labelKey:"projects.details.overview.heading",fallback:"Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectCode",labelKey:"projects.details.labels.code",fallback:"Ø±Ù‚Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectType",labelKey:"projects.details.type",fallback:"Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectStart",labelKey:"projects.details.start",fallback:"Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectEnd",labelKey:"projects.details.end",fallback:"Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectDuration",labelKey:"projects.details.duration",fallback:"Ù…Ø¯Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectStatus",labelKey:"projects.details.status",fallback:"Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"}],financialSummary:[{id:"reservationsTotal",labelKey:"projects.details.reservationsTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª"},{id:"discountAmount",labelKey:"projects.details.summary.discount",fallback:"Ø§Ù„Ø®ØµÙ…"},{id:"taxAmount",labelKey:"projects.details.summary.combinedTax",fallback:"Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"},{id:"overallTotal",labelKey:"projects.details.summary.overallTotal",fallback:"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ"}],payment:Tt.payment,projectExpenses:[...vn.map(({id:e,labelKey:t,fallback:n})=>({id:e,labelKey:t,fallback:n})),{id:"expensesSubtotal",labelKey:"projects.details.expensesTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©"}],projectCrew:[...wt.map(({id:e,labelKey:t,fallback:n})=>({id:e,labelKey:t,fallback:n})),{id:"quantity",labelKey:"reservations.details.table.headers.quantity",fallback:"Ø§Ù„ÙƒÙ…ÙŠØ©"},{id:"days",labelKey:null,fallback:"Ø§Ù„Ø£ÙŠØ§Ù…"},{id:"crewSubtotal",labelKey:"reservations.details.labels.crewTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±ÙŠÙ‚"}],projectEquipment:[...vt.map(({id:e,labelKey:t,fallback:n})=>({id:e,labelKey:t,fallback:n})),{id:"days",labelKey:null,fallback:"Ø§Ù„Ø£ÙŠØ§Ù…"},{id:"equipmentSubtotal",labelKey:"reservations.details.labels.equipmentTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"}],projectNotes:[]},xt=new Map;function qt(e="reservation"){if(xt.has(e))return xt.get(e);const t=e==="project"?va:ga,n=e==="project"?wa:Tt,a=new Set(t.map(({id:o})=>o)),s=Object.fromEntries(Object.entries(n).map(([o,i=[]])=>[o,new Set(i.map(d=>d.id))])),u={sectionDefs:t,fieldDefs:n,sectionIdSet:a,fieldIdMap:s};return xt.set(e,u),u}function St(e="reservation"){return qt(e).sectionDefs}function wn(e="reservation"){return qt(e).fieldDefs}function qn(e="reservation"){return qt(e).sectionIdSet}function Sn(e="reservation"){return qt(e).fieldIdMap}function An(e){switch(e){case"export":return r("reservations.quote.status.exporting","Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ù…Ù„Ù PDF...");case"render":default:return r("reservations.quote.status.rendering","Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©...")}}const qa="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js",Sa="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js",Aa="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js",_n=ua.trim(),xn=`
@font-face { font-family: 'Tajawal'; font-style: normal; font-weight: 400; font-display: swap; src: url(${JSON.stringify(ma)}) format('truetype'); }
@font-face { font-family: 'Tajawal'; font-style: normal; font-weight: 500; font-display: swap; src: url(${JSON.stringify(fa)}) format('truetype'); }
@font-face { font-family: 'Tajawal'; font-style: normal; font-weight: 600; font-display: swap; src: url(${JSON.stringify(Jt)}) format('truetype'); }
@font-face { font-family: 'Tajawal'; font-style: normal; font-weight: 700; font-display: swap; src: url(${JSON.stringify(Jt)}) format('truetype'); }
`,kn=/^data:image\/svg\+xml/i,_a=/\.svg($|[?#])/i,tt=512,Nt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/B8AAusB9YwpClgAAAAASUVORK5CYII=",jn=96,$n=25.4,Et=210,it=297,lt=Math.round(Et/$n*jn),ct=Math.round(it/$n*jn);function ye(e){const t=Number(e),n=Number.isFinite(t)?t:0;try{const a=Math.abs(n%1)>1e-9;return T(n.toLocaleString("en-US",{minimumFractionDigits:a?2:0,maximumFractionDigits:2}))}catch{return Number.isInteger(n)?T(String(n)):T(n.toFixed(2))}}let pt=!1,mt=null;function Tn(){pt||(mt=async function(){try{if(!p||!q?.modal?.classList.contains("show")||(p.context||"reservation")!=="reservation")return;const n=p.reservation;if(!n)return;const a=[n.id,n.reservationId,n.reservation_id,n.reservationCode,n.reservation_code].map(b=>b==null?"":String(b)).filter(b=>b.length>0);if(!a.length)return;const s=un(),u=(Array.isArray(s)?s:[]).find(b=>[b?.id,b?.reservationId,b?.reservation_id,b?.reservationCode,b?.reservation_code].map(w=>w==null?"":String(w)).filter(w=>w.length>0).some(w=>a.includes(w)));if(!u)return;const o=Ut(u),{totalsDisplay:i,totals:d,rentalDays:y}=Qn(u,o,p.project);p.reservation=u,p.crewAssignments=o,p.totals=d,p.totalsDisplay=i,p.rentalDays=y,Yn(),Re()}catch(t){console.warn("[reservationPdf] live update failed",t)}},document.addEventListener("reservations:changed",mt),pt=!0)}function Nn(){if(pt){try{document.removeEventListener("reservations:changed",mt)}catch{}mt=null,pt=!1}}const En=2,Pn=/safari/i,xa=/(iphone|ipad|ipod)/i,Zt=/(iphone|ipad|ipod)/i,ka=/(crios|fxios|edgios|opios)/i,ft="[reservations/pdf]";let q=null,p=null,Te=1,Ze=null,et=null,Me=null,We=null,nt=!1;function Qe(e="render",{message:t,actionLabel:n,onAction:a,showSpinner:s=e!=="error"}={}){if(!q?.statusIndicator||!q?.statusText)return;q.statusKind=e;const u=t||An(e);q.statusText.textContent=u,q.statusSpinner&&(q.statusSpinner.hidden=!s),q.statusAction&&(q.statusAction.hidden=!0,q.statusAction.onclick=null,n&&typeof a=="function"&&(q.statusAction.textContent=n,q.statusAction.hidden=!1,q.statusAction.onclick=o=>{o.preventDefault(),a()})),q.statusIndicator.hidden=!1,requestAnimationFrame(()=>{q.statusIndicator.classList.add("is-visible")})}function Ge(e){try{return String(e||"").toLowerCase().normalize("NFKD").replace(/[\u064B-\u065F\u0670\u06D6-\u06ED]/g,"").replace(/\s+/g," ").trim()}catch{return String(e||"").trim().toLowerCase()}}function at(e){!q?.statusIndicator||!q?.statusText||(q.statusKind=null,q.statusIndicator.classList.remove("is-visible"),setTimeout(()=>{q?.statusIndicator&&(q.statusIndicator.hidden=!0,q.statusAction&&(q.statusAction.hidden=!0,q.statusAction.onclick=null),q.statusSpinner&&(q.statusSpinner.hidden=!1))},220))}function Pt(){return!!window?.bootstrap?.Modal}function ja(e){if(e&&!e.classList.contains("show")){e.classList.add("show"),e.style.display="block",e.removeAttribute("aria-hidden"),e.setAttribute("aria-modal","true"),e.getAttribute("role")||e.setAttribute("role","dialog"),document.body.classList.add("modal-open"),Me||(Me=document.createElement("div"),Me.className="modal-backdrop fade show",Me.dataset.quotePdfFallbackBackdrop="true",document.body.appendChild(Me)),We||(We=t=>{t.key==="Escape"&&Ct(e)},document.addEventListener("keydown",We));try{e.focus({preventScroll:!0})}catch{}}}function Ct(e){if(!(!e||!e.classList.contains("show"))){try{const t=e.ownerDocument?.activeElement;if(t&&e.contains(t)){try{t.blur()}catch{}try{e.ownerDocument?.body?.focus({preventScroll:!0})}catch{}}}catch{}e.classList.remove("show"),e.style.display="none",e.setAttribute("aria-hidden","true"),e.removeAttribute("aria-modal"),document.body.classList.remove("modal-open"),Me&&(Me.remove(),Me=null),We&&(document.removeEventListener("keydown",We),We=null);try{Nn()}catch{}}}function $a(e){if(e){if(Pt()){const t=window.bootstrap.Modal.getOrCreateInstance(e);try{const n=()=>{try{const a=document.activeElement;if(a&&e.contains(a)){try{a.blur()}catch{}try{document.body?.focus({preventScroll:!0})}catch{}}}catch{}try{Nn()}catch{}try{e.removeEventListener("hidden.bs.modal",n)}catch{}};e.addEventListener("hidden.bs.modal",n,{once:!0}),e.addEventListener("hide.bs.modal",()=>{try{const a=document.activeElement;if(a&&e.contains(a))try{a.blur()}catch{}}catch{}})}catch{}t.show();return}ja(e)}}function Ta(){if(nt)return;nt=!0;const e=r("reservations.quote.toast.viewGuide","ðŸ“˜ Ø¹Ø±Ø¶ Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø­Ù„ Ø§Ù„Ø³Ø±ÙŠØ¹"),t=r("reservations.quote.toast.retry","Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©"),n=r("reservations.quote.toast.assetsFailed","âš ï¸ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø¨Ø¹Ø¶ Ø§Ù„ØµÙˆØ± Ø¶Ù…Ù† Ø¹Ø±Ø¶ Ø³Ø¹Ø±."),a=!!q?.modal?.classList.contains("show"),s=()=>{q?.modal?.classList.contains("show")&&(Qe("render"),nt=!1,Re())};rn({message:n,duration:9e3,actionLabel:a?t:void 0,onAction:a?s:void 0,linkLabel:e,linkHref:gn}),a&&Qe("error",{message:n,actionLabel:t,onAction:s,showSpinner:!1})}function At(e="reservation"){const t={},n=wn(e);return Object.entries(n).forEach(([a,s=[]])=>{t[a]=new Set(s.filter(u=>u?.default!==!1).map(u=>u.id))}),t}function Rt(e={}){const t={};return Object.entries(e).forEach(([n,a])=>{t[n]=new Set(Array.from(a||[]))}),t}function Na(e={},t){if(t)return e[t]||(e[t]=new Set),e[t]}function Bt(e={},t,n){const a=e?.[t];return a?a instanceof Set?a.has(n):Array.isArray(a)?a.includes(n):!!a?.[n]:!0}function Ot(e="reservation"){return Object.fromEntries(St(e).map(({id:t})=>[t,!1]))}function Kt(e,t){return e.sectionExpansions||(e.sectionExpansions=Ot(e.context||"reservation")),t&&typeof e.sectionExpansions[t]!="boolean"&&(e.sectionExpansions[t]=!1),e.sectionExpansions}function Ea(e,t){return Kt(e,t)?.[t]!==!1}function Ht(){return typeof window>"u"||typeof window.matchMedia!="function"?!1:window.matchMedia("(max-width: 768px)").matches}function Pa(){if(typeof navigator>"u")return!1;const e=navigator.userAgent||navigator.platform||"";return xa.test(e)}function Ca(){if(typeof navigator>"u")return!1;const e=navigator.userAgent||"",t=Pn.test(e),n=e.includes("Chrome")||e.includes("CriOS")||e.includes("Chromium"),a=e.includes("Edg");return t&&!n&&!a}function Cn(){return Pa()&&Ca()}function _t(){if(typeof navigator>"u")return!1;const e=navigator.userAgent||"",t=navigator.platform||"",n=Number.isFinite(navigator.maxTouchPoints)?navigator.maxTouchPoints:0,a=Zt.test(e)||Zt.test(t),s=/Macintosh/i.test(e)&&n>1;return Pn.test(e)&&!ka.test(e)&&(a||s)}function kt(e,...t){try{console.log(`${ft} ${e}`,...t)}catch{}}function Ne(e,...t){try{console.warn(`${ft} ${e}`,...t)}catch{}}function Ia(e,t,...n){try{t?console.error(`${ft} ${e}`,t,...n):console.error(`${ft} ${e}`,...n)}catch{}}function pe(e,{blockType:t="section",extraAttributes:n=""}={}){if(!e)return"";const a=n?` ${n.trim()}`:"";return e.replace(/^(<\w+)/,`$1 data-quote-block data-block-type="${t}"${a}`)}function Da(e,t="Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¹Ø±Ø¶."){const n=l(r(e,t));return pe(`<section class="quote-section quote-placeholder">${n}</section>`,{blockType:"placeholder"})}function yt(e,t){return Array.isArray(e)&&e.length?e:[Da(t)]}const Fa=/[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF]/;function In(e=""){return Fa.test(e)}function La(){const e=window.CanvasRenderingContext2D?.prototype;if(!e||e.__artRatioDirectionPatched)return;const t=n=>{const a=e[n];typeof a=="function"&&(e[n]=function(u,...o){if(typeof u!="string"||!In(u))return a.call(this,u,...o);let i,d=!1;try{"direction"in this&&(i=this.direction,i!=="rtl"&&(this.direction="rtl"),d=!0)}catch{}try{if(!d){const y=this.canvas;y&&y.style?.direction!=="rtl"&&(y.__artRatioOriginalDirection=y.style.direction,y.style.direction="rtl")}return a.call(this,u,...o)}finally{if(d&&i!==void 0&&i!=="rtl")try{this.direction=i}catch{}else if(!d){const y=this.canvas;y&&y.__artRatioOriginalDirection!==void 0&&(y.style.direction=y.__artRatioOriginalDirection,delete y.__artRatioOriginalDirection)}}})};t("fillText"),t("strokeText"),e.__artRatioDirectionPatched=!0}function en(e,t=tt){if(typeof e!="string"&&typeof e!="number")return t;const n=parseFloat(String(e).replace(/[^0-9.+-]/g,""));return Number.isFinite(n)&&n>0?n:t}function Ma(e){if(!e)return{width:tt,height:tt};const t=e.getAttribute?.("width"),n=e.getAttribute?.("height");let a=t?en(t,0):0,s=n?en(n,0):0;if(a>0&&s>0)return{width:a,height:s};const u=e.getAttribute?.("viewBox");if(u){const o=u.trim().split(/[\s,]+/).map(i=>parseFloat(i||"0"));if(o.length>=4){const[,,i,d]=o;a=a||(Number.isFinite(i)&&i>0?i:0),s=s||(Number.isFinite(d)&&d>0?d:0)}}return{width:a||tt,height:s||tt}}function Dn(e=""){return typeof e!="string"?!1:kn.test(e)||_a.test(e)}function Ra(e=""){const t=e.indexOf(",");if(t===-1)return"";const n=e.slice(0,t),a=e.slice(t+1);try{return/;base64/i.test(n)?typeof atob=="function"?atob(a):"":decodeURIComponent(a)}catch(s){return console.warn("[reservations/pdf] failed to decode SVG data URI",s),""}}function Ba(e,{crossOrigin:t}={}){return new Promise((n,a)=>{const s=new Image;t&&(s.crossOrigin=t),s.onload=()=>n(s),s.onerror=u=>{const o=u?.message||`Unable to load image from ${e}`;a(new Error(o))},s.src=e})}async function Fn(e,t={}){if(!e)return null;const n=document,a=new Blob([e],{type:"image/svg+xml;charset=utf-8"}),s=URL.createObjectURL(a);try{const u=await Ba(s),o=n.createElement("canvas"),i=Math.max(t.width||u.naturalWidth||u.width||0,1),d=Math.max(t.height||u.naturalHeight||u.height||i,1);o.width=i,o.height=d;const y=o.getContext("2d");return y.clearRect(0,0,i,d),y.drawImage(u,0,0,i,d),o.toDataURL("image/png")}catch(u){return console.warn("[reservations/pdf] failed to rasterize SVG content",u),null}finally{URL.revokeObjectURL(s)}}async function Oa(e){if(!e)return null;if(kn.test(e))return Ra(e);try{const t=await fetch(e,{mode:"cors",credentials:"omit",cache:"default"});return t.ok?await t.text():(console.warn("[reservations/pdf] failed to fetch SVG image",e,t.status),null)}catch(t){return console.warn("[reservations/pdf] error fetching SVG image",e,t),null}}async function Ka(e){if(!e)return!1;const t=e.getAttribute?.("src")||"";if(!Dn(t))return!1;const n=await Oa(t);if(!n)return e.dataset.svgRasterization="failed",e.setAttribute("src",Nt),!1;const a=await Fn(n);return a?(e.dataset.svgOriginalSrc=t,e.setAttribute("src",a),e.setAttribute("data-rasterized","true"),!0):(e.dataset.svgRasterization="failed",e.setAttribute("src",Nt),!1)}async function Ha(e){if(!e||e.tagName?.toLowerCase()!=="svg")return!1;const n=new XMLSerializer().serializeToString(e),a=Ma(e),s=await Fn(n,a),o=(e.ownerDocument||document).createElement("img");o.setAttribute("src",s||Nt),o.setAttribute("alt",e.getAttribute("aria-label")||e.getAttribute("title")||""),o.setAttribute("data-svg-replaced","true"),e.hasAttribute("class")&&o.setAttribute("class",e.getAttribute("class")),e.hasAttribute("style")&&o.setAttribute("style",e.getAttribute("style"));const i=e.getAttribute("width"),d=e.getAttribute("height");return i&&o.setAttribute("width",i),d&&o.setAttribute("height",d),e.parentNode?.replaceChild(o,e),!!s}async function Ln(e){if(!e)return;const t=Array.from(e.querySelectorAll?.("img")||[]),n=Array.from(e.querySelectorAll?.("svg")||[]),a=[];t.forEach(s=>{Dn(s.getAttribute?.("src"))&&a.push(Ka(s))}),n.forEach(s=>{a.push(Ha(s))}),a.length&&await Promise.allSettled(a)}function Qa(e,{pixelRatio:t=1}={}){if(!e)return null;const n=e.ownerDocument||document,s=(n.defaultView||window).getComputedStyle?.(e);if(!s)return null;const u=(x,G=0)=>{const Z=parseFloat(x);return Number.isFinite(Z)?Z:G},o=u(s.paddingTop),i=u(s.paddingBottom),d=u(s.paddingRight),y=u(s.paddingLeft),b=u(s.borderRadius),$=u(s.fontSize,14),w=(()=>{const x=s.lineHeight;if(!x||x==="normal")return $*1.6;const G=u(x,$*1.6);return G>0?G:$*1.6})(),v=Math.max(e.clientWidth||0,e.scrollWidth||0,u(s.width,0));if(v<=0)return null;const g=Math.max(1,v-y-d),L=e.textContent||"",S=L.split(/\r?\n/),F=n.createElement("canvas"),j=F.getContext("2d");if(!j)return null;const W=s.fontStyle||"normal",ne=s.fontVariant||"normal",he=s.fontWeight||"400",h=s.fontFamily||"sans-serif",A=s.fontStretch||"normal",D=x=>x.join(" "),B=[],ae=x=>j.measureText(x).width;j.font=`${W} ${ne} ${he} ${A} ${$}px ${h}`,S.forEach(x=>{const G=x.trim();if(G.length===0){B.push("");return}const Z=G.split(/\s+/);let me=[];Z.forEach((Ee,ve)=>{const we=Ee.trim();if(!we)return;const je=D(me.concat(we));if(ae(je)<=g||me.length===0){me.push(we);return}B.push(D(me)),me=[we]}),me.length&&B.push(D(me))}),B.length||B.push("");const N=o+i+B.length*w,C=Math.ceil(Math.max(1,v)*t),Y=Math.ceil(Math.max(1,N)*t);F.width=C,F.height=Y,F.style.width=`${Math.max(1,v)}px`,F.style.height=`${Math.max(1,N)}px`,j.scale(t,t);const oe=s.backgroundColor&&s.backgroundColor!=="rgba(0, 0, 0, 0)"?s.backgroundColor:"#ffffff";if(b>0){j.save(),j.beginPath();const x=Math.max(1,v),G=Math.max(1,N),Z=Math.min(b,x/2,G/2);j.moveTo(Z,0),j.lineTo(x-Z,0),j.quadraticCurveTo(x,0,x,Z),j.lineTo(x,G-Z),j.quadraticCurveTo(x,G,x-Z,G),j.lineTo(Z,G),j.quadraticCurveTo(0,G,0,G-Z),j.lineTo(0,Z),j.quadraticCurveTo(0,0,Z,0),j.closePath(),j.clip()}if(j.fillStyle=oe,j.fillRect(0,0,Math.max(1,v),Math.max(1,N)),j.font=`${W} ${ne} ${he} ${A} ${$}px ${h}`,j.fillStyle=s.color||"#000000",j.textBaseline="top",j.textAlign="right","direction"in j)try{j.direction="rtl"}catch{}const O=Math.max(0,v-d);let H=o;B.forEach(x=>{const G=x.length?x:" ";j.fillText(G,O,H,g),H+=w});const z=n.createElement("img");let ue;try{ue=F.toDataURL("image/png")}catch(x){return Ne("note canvas toDataURL failed",x),null}return z.src=ue,z.alt=L,z.style.width=`${Math.max(1,v)}px`,z.style.height=`${Math.max(1,N)}px`,z.style.display="block",z.setAttribute("data-quote-note-image","true"),{image:z,canvas:F,totalHeight:N,width:v}}function Ua(e,{pixelRatio:t=1}={}){if(!e||!_t())return;Array.from(e.querySelectorAll?.(".quote-notes")||[]).forEach(a=>{if(!a||a.dataset.quoteNoteRasterized==="true"||!In(a.textContent||""))return;let s;try{s=Qa(a,{pixelRatio:t})}catch(u){Ne("failed to rasterize note content",u),s=null}s&&(a.dataset.quoteNoteRasterized="true",a.innerHTML="",a.appendChild(s.image))})}function It(e,t="export",{toastMessage:n,suppressToast:a=!1}={}){Ia(`${t} failed`,e);const s=!!(e&&e.__artRatioPdfNotified);if(!a&&!s){const u=r("reservations.quote.errors.exportFailed","âš ï¸ ØªØ¹Ø°Ø± Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù PDFØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰."),o=n||u,i=r("reservations.quote.toast.viewGuide","ðŸ“˜ Ø¹Ø±Ø¶ Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø­Ù„ Ø§Ù„Ø³Ø±ÙŠØ¹"),d=r("reservations.quote.toast.retry","Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©"),y=["exportQuoteAsPdf","renderQuotePreview","layoutQuoteDocument","pageCapture"].includes(t),b=()=>{t==="exportQuoteAsPdf"?(Qe("export"),Zn()):(Qe("render"),nt=!1,Re())};if(rn({message:o,duration:9e3,actionLabel:y?d:void 0,onAction:y?b:void 0,linkLabel:i,linkHref:gn}),q?.modal?.classList.contains("show")&&Qe("error",{message:o,actionLabel:y?d:void 0,onAction:y?b:void 0,showSpinner:!1}),e&&typeof e=="object")try{Object.defineProperty(e,"__artRatioPdfNotified",{value:!0,writable:!1,enumerable:!1,configurable:!0})}catch{}}}function Dt({container:e,safariWindowRef:t,mobileWindowRef:n}={}){try{n&&!n.closed&&n.close()}catch(a){Ne("failed to close mobile window",a)}try{t&&!t.closed&&t.close()}catch(a){Ne("failed to close safari window",a)}e&&e.parentNode&&e.parentNode.removeChild(e)}function Qt(e){return new Promise((t,n)=>{const a=document.querySelector(`script[src="${e}"]`);if(a){a.addEventListener("load",()=>t()),a.addEventListener("error",u=>n(u)),a.readyState==="complete"&&t();return}const s=document.createElement("script");s.src=e,s.async=!0,s.onload=()=>t(),s.onerror=u=>n(u),document.head.appendChild(s)})}function tn(){const e=[window.jspdf?.jsPDF,typeof window.jspdf=="function"?window.jspdf:null,window.jsPDF?.jsPDF,typeof window.jsPDF=="function"?window.jsPDF:null].filter(t=>typeof t=="function");return e.length?e[0]:null}function nn(){return typeof window.html2canvas=="function"?window.html2canvas:null}async function za(){const e=nn();return e||(et||(et=Qt(Sa).catch(t=>{throw et=null,t}).then(()=>{const t=nn();if(!t)throw et=null,new Error("ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© html2canvas Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.");return t})),et)}async function Va(){const e=tn();return e||(Ze||(Ze=Qt(Aa).catch(t=>{throw Ze=null,t}).then(()=>{const t=tn();if(!t)throw Ze=null,new Error("ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© jsPDF Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.");return t})),Ze)}async function Wa(){if(window.html2pdf||await Qt(qa),window.html2pdf&&!window.html2pdf.__artRatioConfigured){const e=window.html2pdf.defaultOptions||window.html2pdf.defaultOpt||{},t={...e.html2canvas||{}};t.useCORS=!0,t.allowTaint=!1,t.logging=!0;const n={unit:"mm",format:"a4",orientation:"portrait",compress:!0,...e.jsPDF||{}},a={image:{type:"jpeg",quality:.95,...e.image||{}},margin:e.margin??[0,0,0,0],filename:e.filename||"document.pdf",html2canvas:t,jsPDF:n};window.html2pdf.defaultOptions=a,window.html2pdf.defaultOpt=a,window.html2pdf.__artRatioConfigured=!0}da(),La()}function l(e=""){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function Ga(e="reservation"){return e==="project"?"QP":"Q"}function bt(e,t="reservation"){const n=Number(e),a=Ga(t);return!Number.isFinite(n)||n<=0?`${a}-0001`:`${a}-${String(n).padStart(4,"0")}`}function Mn(e="reservation"){return e==="project"?"quote_project":"quote_reservation"}async function Xa(e="reservation"){const t=Mn(e);try{const n=await Lt(`/sequence/?name=${encodeURIComponent(t)}`,{method:"POST"}),a=Number(n?.value),s=Number.isFinite(a)&&a>0?a:1;return{sequence:s,quoteNumber:bt(s,e)}}catch(n){console.warn("âš ï¸ [reservations/pdf] sequence reservation failed, falling back to local",n);const a=window.localStorage?.getItem?.(hn),u=(Number.isFinite(parseInt(a??"",10))?parseInt(a??"",10):0)+1;return{sequence:u,quoteNumber:bt(u,e)}}}async function Rn(e="reservation"){const t=Mn(e);try{const n=await Lt(`/sequence/?name=${encodeURIComponent(t)}`,{method:"GET"}),a=Number(n?.value),s=Number.isFinite(a)&&a>=0?a+1:1;return{sequence:s,quoteNumber:bt(s,e)}}catch(n){return console.warn("âš ï¸ [reservations/pdf] sequence peek failed, falling back to 1",n),{sequence:1,quoteNumber:bt(1,e)}}}function Bn(e="reservation"){return Yt[e]||Yt.reservation}function Ja(){try{window.localStorage?.removeItem?.(hn)}catch{}}function Ya(e="reservation"){try{Ja();const t=Bn(e),n=window.localStorage?.getItem?.(t);if(!n)return null;const a=JSON.parse(n);return a&&typeof a=="object"?a:null}catch(t){return console.warn("âš ï¸ [reservations/pdf] failed to read toggle preferences",t),null}}function Za(e,t="reservation"){try{const n=Bn(t);if(!e){window.localStorage?.removeItem?.(n);return}window.localStorage?.setItem?.(n,JSON.stringify(e))}catch(n){console.warn("âš ï¸ [reservations/pdf] failed to persist toggle preferences",n)}}function es(e){if(!e)return{ids:null,emptyExplicitly:!1};if(e instanceof Set)return{ids:Array.from(e),emptyExplicitly:e.size===0};if(Array.isArray(e))return{ids:e.slice(),emptyExplicitly:e.length===0};if(typeof e=="object"){const t=Object.entries(e).filter(([,n])=>!!n);return{ids:t.map(([n])=>n),emptyExplicitly:t.length===0}}return{ids:null,emptyExplicitly:!1}}function ts(e,t="reservation"){if(!e)return null;const n=qn(t),a=Sn(t),s=Array.from(e.sections instanceof Set?e.sections:new Set(e.sections||[])).filter(i=>n.has(i)),u={},o=e.fields||{};return Object.entries(a).forEach(([i,d])=>{const y=o[i];if(y==null)return;const{ids:b,emptyExplicitly:$}=es(y);if(!b&&!$)return;const w=Array.isArray(b)?b.filter(v=>d.has(v)):[];(w.length>0||$)&&(u[i]=w)}),{version:1,sections:s,fields:u}}function On(e){if(!e)return;const t=e.context||"reservation",n=ts(e,t);n&&Za(n,t)}function Kn(e){if(!e)return;const t=e.context||"reservation",n=Ya(t);if(!n)return;const a=qn(t),s=Array.isArray(n.sections)?n.sections.filter(u=>a.has(u)):[];if(s.length&&(e.sections=new Set(s)),n.fields&&typeof n.fields=="object"){const u=Rt(e.fields||At(t)),o=Sn(t);Object.entries(n.fields).forEach(([i,d])=>{const y=o[i];if(!y)return;const b=Array.isArray(d)?d.filter($=>y.has($)):[];u[i]=new Set(b)}),e.fields=u}}function Hn(e=new Date){try{return e.toLocaleDateString("en-GB",{year:"numeric",month:"2-digit",day:"2-digit"})}catch{return e.toISOString().slice(0,10)}}function Ut(e){const t=la()||[],{technicians:n=[]}=Ft(),a=[].concat(Array.isArray(t)?t:[]).concat(Array.isArray(n)?n:[]),s=new Map;return a.forEach(o=>{if(!o||o.id==null)return;const i=String(o.id),d=s.get(i)||{};s.set(i,{...d,...o})}),(Array.isArray(e.crewAssignments)&&e.crewAssignments.length?e.crewAssignments:Array.isArray(e.techniciansDetails)&&e.techniciansDetails.length?e.techniciansDetails:(e.technicians||[]).map(o=>({technicianId:o}))).map((o,i)=>{const d=o?.technicianId!=null?s.get(String(o.technicianId)):null;let y=o.positionLabel??o.position_name??o.position_label??o.role??o.position??d?.role??r("reservations.crew.positionFallback","Ù…Ù†ØµØ¨ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…");(!y||y.trim()==="")&&(y=o.positionLabelAr??o.position_label_ar??o.positionLabelEn??o.position_label_en??o.position_name_ar??o.position_name_en??d?.role??r("reservations.crew.positionFallback","Ù…Ù†ØµØ¨ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…"));try{const w=typeof Gt=="function"?Gt()||[]:[];let v=null;if(o?.positionId!=null&&(v=w.find(g=>String(g?.id)===String(o.positionId))||null),!v){const g=o.positionKey??o.position_key??o.positionName??o.position_name??o.position??"";if(g&&(v=typeof Xt=="function"&&Xt(g)||null,!v&&w.length)){const L=String(g).trim().toLowerCase();v=w.find(S=>[S.name,S.labelAr,S.labelEn].filter(Boolean).map(F=>String(F).toLowerCase()).includes(L))||null}}if(v){const g=v.labelAr||v.labelEn||v.name||"";g&&g.trim()&&(y=g)}}catch{}const b=st(ut(o.positionCost??o.position_cost??o.cost??o.daily_wage??o.dailyWage??d?.dailyWage??d?.wage??0)),$=st(ut(o.positionClientPrice??o.position_client_price??o.client_price??o.clientPrice??o.daily_total??o.dailyTotal??o.total??d?.dailyTotal??d?.total??d?.total_wage??0));return{assignmentId:o.assignmentId??o.assignment_id??`crew-${i}`,positionId:o.positionId??o.position_id??null,positionLabel:y,positionLabelAlt:o.positionLabelAlt??o.position_label_alt??"",positionCost:b,positionClientPrice:$,technicianId:o.technicianId!=null?String(o.technicianId):d?.id!=null?String(d.id):null,technicianName:o.technicianName??o.technician_name??d?.name??null,technicianRole:o.technicianRole??d?.role??null}})}function Qn(e,t,n){const{projectLinked:a}=aa(e,n);Mt(e.start,e.end);const s=e.discount??e.discountValue??0,u=Number(T(String(s)))||0,o=e.discountType??e.discount_type??"percent",i=String(o).toLowerCase()==="amount"?"amount":"percent",d=a?!1:!!(e.applyTax??e.apply_tax??e.taxApplied),y=e.companySharePercent??e.company_share_percent??e.companyShare??e.company_share??null,b=y!=null?ut(y):Number.NaN,w=(e.companyShareEnabled??e.company_share_enabled??e.companyShareApplied??e.company_share_applied)===!0&&Number.isFinite(b)&&b>0?b:null,v=Array.isArray(t)?t.map(ne=>ne?.technicianId).filter(Boolean):[],g=ln({items:Array.isArray(e.items)?e.items:[],technicianIds:v,crewAssignments:Array.isArray(t)?t:[],discount:u,discountType:i,applyTax:d,start:e.start,end:e.end,companySharePercent:w,groupingSource:e}),L=ut(e.cost??e.total??e.finalTotal),S=Number.isFinite(L),F=a?g.finalTotal:S?st(L):g.finalTotal,j={equipmentTotal:g.equipmentTotal,crewTotal:g.crewTotal,crewCostTotal:g.crewCostTotal,discountAmount:g.discountAmount,subtotalAfterDiscount:g.subtotalAfterDiscount,taxableAmount:g.taxableAmount,taxAmount:g.taxAmount,finalTotal:F,companySharePercent:g.companySharePercent,companyShareAmount:g.companyShareAmount,netProfit:g.netProfit},W={equipmentTotal:ye(g.equipmentTotal),crewTotal:ye(g.crewTotal),discountAmount:ye(g.discountAmount),subtotalAfterDiscount:ye(g.subtotalAfterDiscount),taxableAmount:ye(g.taxableAmount),taxAmount:ye(g.taxAmount),finalTotal:ye(F),companySharePercent:T((Number.isFinite(g.companySharePercent)?g.companySharePercent:0).toFixed(2)),companyShareAmount:ye(g.companyShareAmount),netProfit:T(g.netProfit.toFixed(2))};return{totals:j,totalsDisplay:W,rentalDays:g.rentalDays}}function Je(e){if(e==null||e==="")return null;const t=Number.parseFloat(T(String(e)));return Number.isFinite(t)?t:null}function Un(e){if(!e)return new Date().toISOString();const t=new Date(e);return Number.isNaN(t.getTime())?new Date().toISOString():t.toISOString()}function ns(e){if(!e||typeof e!="object")return null;const t=e.type??e.payment_type??e.paymentType??null;let n=typeof t=="string"?t.trim().toLowerCase():null;n!=="percent"&&(n="amount");const a=Je(e.amount??(n==="amount"?e.value:null)),s=Je(e.percentage??(n==="percent"?e.value:null)),u=n==="percent"?s??null:a??null,o=e.note??e.memo??null,i=Un(e.recordedAt??e.recorded_at??e.date??e.created_at??null);return n==="amount"&&a==null||n==="percent"&&s==null?null:{type:n,amount:a??null,percentage:s??null,value:u,note:o,recordedAt:i}}function as(e={}){const n=(Array.isArray(e.paymentHistory)?e.paymentHistory:Array.isArray(e.payment_history)?e.payment_history:[]).map(ns).filter(Boolean);if(n.length>0)return n;const a=Je(e.paidPercent??e.paid_percent),s=Je(e.paidAmount??e.paid_amount),u=e.updatedAt??e.updated_at??e.createdAt??e.created_at??null,o=Un(u);return a!=null&&a>0?[{type:"percent",amount:s!=null&&s>0?s:null,percentage:a,value:a,note:null,recordedAt:o}]:s!=null&&s>0?[{type:"amount",amount:s,percentage:null,value:s,note:null,recordedAt:o}]:[]}function ss(e){if(!e)return r("projects.form.types.unknown","Ù†ÙˆØ¹ ØºÙŠØ± Ù…Ø­Ø¯Ø¯");const t={commercial:"projects.form.types.commercial",coverage:"projects.form.types.coverage",photography:"projects.form.types.photography",social:"projects.form.types.social"}[e]||"projects.form.types.unknown";return r(t,e)}function os(e){const t=new Date,n=e?.start?new Date(e.start):null,a=e?.end?new Date(e.end):null;return n&&!Number.isNaN(n.getTime())&&n>t?"upcoming":a&&!Number.isNaN(a.getTime())&&a<t?"completed":"ongoing"}function rs(e){if(Array.isArray(e?.expenses)&&e.expenses.some(a=>Number.isFinite(Number(a?.salePrice??a?.sale_price))))return e.expenses.reduce((a,s)=>a+(Number(s?.salePrice??s?.sale_price)||0),0);const t=Number(e?.servicesClientPrice??e?.services_client_price);return Number.isFinite(t)&&t>=0?t:typeof e?.expensesTotal=="number"?e.expensesTotal:Array.isArray(e?.expenses)?e.expenses.reduce((n,a)=>n+(Number(a?.amount)||0),0):0}function is(e){if(!e)return 0;const t=Array.isArray(e.items)?e.items:[],n=e.discount??0,a=Number(T(String(n)))||0,s=e.discountType||"percent",u=Array.isArray(e.crewAssignments)?e.crewAssignments:[],o=u.length?u:Array.isArray(e.technicians)?e.technicians:[],i=ia(t,a,s,!1,o,{start:e.start,end:e.end,companySharePercent:0});if(Number.isFinite(i))return i;const d=Number(T(String(e.cost??0)));return Number.isFinite(d)?Math.round(d):0}function ls(e,t){if(!e)return"â€”";const n=Xe(e);return t?`${n} - ${Xe(t)}`:n}function X(e,t="SR",n=2){const a=Number(e);return`${ye(a)} ${t}`}function an(e,t=2){if(!Number.isFinite(Number(e)))return"0%";const n=Number.isInteger(t)?t:2;return`${T(Number(e).toFixed(n))}%`}function cs(e){if(!e?.start)return null;if(!e?.end)return 1;const t=Mt(e.start,e.end);return Number.isFinite(t)?t:1}function us(e){return Number.isFinite(e)?e<=1?"ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯":`${T(String(Math.round(e)))} Ø£ÙŠØ§Ù…`:"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}function sn(e){const t=r("reservations.create.summary.currency","SR"),n=Ft()||{},a=Array.isArray(n.customers)?n.customers:[],s=Array.isArray(n.projects)?n.projects:[],u=Array.isArray(n.technicians)?n.technicians:[];let o=[];try{const f=un?.()||[];o=Array.isArray(f)&&f.length?f:n.reservations||[]}catch{o=n.reservations||[]}const i=e?.id!=null?s.find(f=>String(f.id)===String(e.id))||e:e||null,d={projectStatusLabel:r("projects.status.ongoing","Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°"),paymentStatusLabel:r("projects.paymentStatus.unpaid","ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹")};if(!i)return{project:null,customer:null,clientInfo:{name:"-",company:"-",phone:"-",email:"-"},projectInfo:{title:"-",code:"-",typeLabel:"-",startDisplay:"-",endDisplay:"-",durationLabel:"-",statusLabel:d.projectStatusLabel},expenses:[],equipment:[],reservations:[],totals:{equipmentEstimate:0,expensesTotal:0,baseSubtotal:0,discountAmount:0,subtotalAfterDiscount:0,companyShareAmount:0,subtotal:0,applyTax:!1,taxAmount:0,totalWithTax:0},totalsDisplay:{projectSubtotal:X(0,t),expensesTotal:X(0,t),reservationsTotal:X(0,t),discountAmount:X(0,t),taxAmount:X(0,t),overallTotal:X(0,t),paidAmount:X(0,t),remainingAmount:X(0,t)},projectTotals:{combinedTaxAmount:0,overallTotal:0,reservationsTotal:0,paidAmount:0,paidPercent:0,remainingAmount:0,paymentStatus:"unpaid"},paymentSummary:{status:"unpaid",statusLabel:d.paymentStatusLabel,paidAmount:0,paidPercent:0,remainingAmount:0,paidAmountDisplay:X(0,t),remainingAmountDisplay:X(0,t),paidPercentDisplay:an(0)},notes:"",currencyLabel:t,projectStatus:"ongoing",projectStatusLabel:d.projectStatusLabel,projectDurationDays:null,projectDurationLabel:"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",paymentHistory:[]};const y=i.clientId??i.customerId??i.client_id??i.customer_id??null,b=y!=null&&a.find(f=>String(f.id)===String(y))||null,$=b?.customerName??b?.name??i.clientName??i.customerName??r("projects.fallback.unknownClient","Ø¹Ù…ÙŠÙ„ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"),w=(i.clientCompany||b?.companyName||b?.company||"").trim(),v=b?.phone??b?.customerPhone??i.clientPhone??i.customerPhone??"",g=v?T(String(v).trim()):r("projects.details.client.noPhone","Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù‚Ù… Ù…ØªØ§Ø­"),L=b?.email??i.clientEmail??i.customerEmail??"",S=L?String(L).trim():r("projects.details.client.noEmail","Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨Ø±ÙŠØ¯ Ù…ØªØ§Ø­"),F=i.projectCode||`PRJ-${T(String(i.id??""))}`,j=T(String(F)),W=(i.title||"").trim()||r("projects.fallback.untitled","Ù…Ø´Ø±ÙˆØ¹ Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†"),ne=ss(i.type),he=i.start?Xe(i.start):"â€”",h=i.end?Xe(i.end):"â€”",A=cs(i),D=A!=null?us(A):"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",B=os(i),ae={upcoming:"Ù‚Ø§Ø¯Ù…",ongoing:"Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°",completed:"Ù…ÙƒØªÙ…Ù„"},N=r(`projects.status.${B}`,ae[B]||B),C=i.id!=null?String(i.id):null,Y=C?o.filter(f=>{const ee=f?.projectId??f?.project_id??null;return ee!=null&&String(ee)===C}):[];Y.map(f=>{const ee=f.reservationId||f.id||"",_=f.status||f.state||"pending",ce=String(_).toLowerCase(),c=r(`reservations.status.${ce}`,ce),k=is(f),K=f.start?new Date(f.start).getTime():0;return{reservationId:T(String(ee||"-")),status:ce,statusLabel:c,total:k,totalLabel:X(k,t),dateRange:ls(f.start,f.end),startTimestamp:Number.isNaN(K)?0:K}}).sort((f,ee)=>ee.startTimestamp-f.startTimestamp).map(({startTimestamp:f,...ee})=>ee);let oe=0,O=0;try{Y.forEach(f=>{const ee=ln({items:Array.isArray(f.items)?f.items:[],technicianIds:Array.isArray(f.technicians)?f.technicians:[],crewAssignments:Array.isArray(f.crewAssignments)?f.crewAssignments:[],discount:Number(f.discount??0)||0,discountType:f.discountType||"percent",applyTax:!1,start:f.start,end:f.end,groupingSource:f,companySharePercent:0});oe+=Number(ee.equipmentTotal||0),O+=Number(ee.crewTotal||0)})}catch{}const H=rs(i),z=Number(oe+O+H),ue=[];try{Y.forEach(f=>{const{groups:ee}=cn(f);ee.forEach(_=>{const ce=Number(_?.count??_?.quantity??1)||1,c=Number(_?.unitPrice);let k=Number.isFinite(c)?c:0;if(!k||k<=0){const P=Number(_?.totalPrice);Number.isFinite(P)&&ce>0&&(k=Number((P/ce).toFixed(2)))}Number.isFinite(k)||(k=0);const K=_?.type==="package"||Array.isArray(_?.items)&&_.items.some(P=>P?.type==="package"),se=Array.isArray(_?.barcodes)&&_.barcodes.length?_.barcodes[0]:Array.isArray(_?.items)&&_.items.length?_.items[0]?.barcode:null;let le=_?.packageDisplayCode??_?.package_code??_?.code??_?.packageCode??(Array.isArray(_?.items)&&_.items.length?_.items[0]?.package_code??_.items[0]?.code??_.items[0]?.packageCode:null);const xe=P=>{const R=(P==null?"":String(P)).trim();return!!(!R||/^pkg-/i.test(R)||/^\d+$/.test(R)&&R.length<=4)};if(!le||xe(le)){const P=_?.packageId??_?.package_id??(Array.isArray(_?.items)&&_.items.length?_.items[0]?.packageId??_.items[0]?.package_id:null);if(P)try{const R=dn(P);R&&R.package_code&&(le=R.package_code)}catch{}}if(!le||xe(le))try{const P=Ge(_?.description||"");if(P){const R=pn();let U=R.find(re=>Ge(re?.name||re?.title||re?.label||"")===P);U||(U=R.find(re=>{const $e=Ge(re?.name||re?.title||re?.label||"");return $e.includes(P)||P.includes($e)})),U&&U.package_code&&(le=U.package_code)}}catch{}const de=K?le??se??"":_?.barcode??se??"",te=de!=null?String(de):"",fe=Number.isFinite(Number(_?.totalPrice))?Number(_.totalPrice):Number((k*ce).toFixed(2));ue.push({..._,isPackage:K,desc:_?.description,barcode:te,packageCodeResolved:le||"",qty:ce,price:k,totalPrice:st(fe),unitPriceValue:k})})})}catch{}const x=new Map;Y.forEach(f=>{const ee=Array.isArray(f.items)?f.items:[],_=Mt(f.start,f.end),ce=f.reservationId||f.id||"";ee.forEach((c,k)=>{if(!c)return;const K=c.barcode||c.code||c.id||c.desc||c.description||`item-${k}`,se=String(K||`item-${k}`),le=x.get(se)||{description:c.desc||c.description||c.name||c.barcode||`#${T(String(k+1))}`,totalQuantity:0,reservationsCount:0,reservationIds:new Set,totalCost:0},xe=Number(c.qty)||1,de=Number(c.price)||0;le.totalQuantity+=xe,le.reservationIds.add(String(ce));const te=de*xe*Math.max(1,_);Number.isFinite(te)&&(le.totalCost+=te),x.set(se,le)})});const G=Array.from(x.values()).map(f=>({description:f.description,totalQuantity:f.totalQuantity,reservationsCount:f.reservationIds.size,displayCost:X(f.totalCost,t)})),Z=new Map((u||[]).filter(Boolean).map(f=>[String(f.id),f])),me=new Map,Ee=f=>{if(!f)return;let ee=null;typeof f=="object"?ee=f.id??f.technicianId??f.technician_id??f.userId??f.user_id??null:(typeof f=="string"||typeof f=="number")&&(ee=f);const _=ee!=null?String(ee):null,ce=_&&Z.has(_)?Z.get(_):typeof f=="object"?f:null,c=ce?.name||ce?.full_name||ce?.fullName||ce?.displayName||(typeof f=="string"?f:null),k=ce?.role||ce?.title||null,K=ce?.phone||ce?.mobile||ce?.contact||null;if(!c&&!_)return;const se=_||c;me.has(se)||me.set(se,{id:_,name:c||"-",role:k||null,phone:K||null})};Array.isArray(i?.technicians)&&i.technicians.forEach(f=>Ee(f)),Y.forEach(f=>{(Array.isArray(f.crewAssignments)&&f.crewAssignments.length?f.crewAssignments:Array.isArray(f.technicians)?f.technicians.map(_=>({technicianId:_})):[]).forEach(_=>Ee(_))});const ve=Array.from(me.values()),we=Array.isArray(i.expenses)?i.expenses.map(f=>{const ee=Number(f?.salePrice??f?.sale_price??f?.amount)||0;return{label:f?.label||f?.name||"-",amount:ee,displayAmount:X(ee,t),note:f?.note||f?.description||""}}):[],je=i?.applyTax===!0||i?.applyTax==="true",Fe=Number.parseFloat(i?.discount??i?.discountValue??0)||0;let qe=(i?.discountType==="amount"?"amount":"percent")==="amount"?Fe:z*(Fe/100);(!Number.isFinite(qe)||qe<0)&&(qe=0),qe>z&&(qe=z);const Se=Math.max(0,z-qe),Ye=i?.companyShareEnabled===!0||i?.company_share_enabled===!0||i?.companyShareApplied===!0||i?.company_share_applied===!0,Pe=Number.parseFloat(i?.companySharePercent??i?.company_share_percent??i?.companyShare??i?.company_share??0)||0,Be=Ye&&Pe>0?Pe:0,Le=Be>0?Number((Se*(Be/100)).toFixed(2)):0,ge=Number((Se+Le).toFixed(2)),ke=je?Number((ge*ca).toFixed(2)):0,Ae=Number((ge+ke).toFixed(2)),Oe=as(i),ze=Je(i.paidAmount??i.paid_amount)||0,Ve=Je(i.paidPercent??i.paid_percent)||0,m=oa({totalAmount:Ae,paidAmount:ze,paidPercent:Ve,history:Oe}),M=typeof i.paymentStatus=="string"?i.paymentStatus.toLowerCase():"",I=ra({manualStatus:M,paidAmount:m.paidAmount,paidPercent:m.paidPercent,totalAmount:Ae}),J={paid:"Ù…Ø¯ÙÙˆØ¹",partial:"Ù…Ø¯ÙÙˆØ¹ Ø¬Ø²Ø¦ÙŠØ§Ù‹",unpaid:"ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹"},Q=r(`projects.paymentStatus.${I}`,J[I]||I),E=Number(m.paidAmount||0),V=Number(m.paidPercent||0),ie=Math.max(0,Number((Ae-E).toFixed(2))),Ce={projectSubtotal:X(ge,t),expensesTotal:X(H,t),reservationsTotal:X(ge,t),discountAmount:X(qe,t),taxAmount:X(ke,t),overallTotal:X(Ae,t),paidAmount:X(E,t),remainingAmount:X(ie,t)},Ke={status:I,statusLabel:Q,paidAmount:E,paidPercent:V,remainingAmount:ie,paidAmountDisplay:X(E,t),remainingAmountDisplay:X(ie,t),paidPercentDisplay:an(V)},Ie=(i.description||"").trim();return{project:i,customer:b,clientInfo:{name:$,company:w||"â€”",phone:g,email:S},projectInfo:{title:W,code:j,typeLabel:ne,startDisplay:he,endDisplay:h,durationLabel:D,statusLabel:N},expenses:we,equipment:G,crew:ve,equipmentItems:ue,crewAssignments:Y.flatMap(f=>Ut(f)),totals:{equipmentEstimate:oe,expensesTotal:H,baseSubtotal:z,discountAmount:qe,subtotalAfterDiscount:Se,companyShareAmount:Le,subtotal:ge,applyTax:je,taxAmount:ke,totalWithTax:Ae},totalsDisplay:Ce,projectTotals:{combinedTaxAmount:ke,overallTotal:Ae,reservationsTotal:ge,paidAmount:E,paidPercent:V,remainingAmount:ie,paymentStatus:I},paymentSummary:Ke,notes:Ie,currencyLabel:t,projectStatus:B,projectStatusLabel:N,projectDurationDays:A,projectDurationLabel:D,paymentHistory:Oe}}function ds({project:e,clientInfo:t={},projectInfo:n={},projectCrew:a=[],projectExpenses:s=[],projectEquipment:u=[],totalsDisplay:o={},projectTotals:i={},paymentSummary:d={},currencyLabel:y="SR",sections:b,fieldSelections:$={},quoteNumber:w,quoteDate:v,terms:g=_e}){const L=Rt($),S=(m,M)=>Bt(L,m,M),F=m=>b?.has?.(m),j=`<div class="quote-placeholder">${l(r("reservations.quote.placeholder.noFields","Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù„Ù„Ø¹Ø±Ø¶ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…."))}</div>`,W=(m,M)=>`<div class="info-plain__item">
      <span class="info-plain__label">${l(m)}</span>
      <span class="info-plain__separator">:</span>
      <span class="info-plain__value">${l(M)}</span>
    </div>`,ne=(m,M,{variant:I="inline"}={})=>I==="final"?`<div class="totals-item totals-item--final">
        <span class="totals-item__label">${l(m)}</span>
        <span class="totals-item__slash">/</span>
        <span class="totals-item__value">${l(M)}</span>
      </div>`:`<span class="totals-inline__item">
      <span class="totals-inline__label">${l(m)}</span>
      <span class="totals-inline__slash">/</span>
      <span class="totals-inline__value">${l(M)}</span>
    </span>`,he=(m,M)=>`<div class="payment-row">
      <span class="payment-row__label">${l(m)}</span>
      <span class="payment-row__slash">/</span>
      <span class="payment-row__value">${l(M)}</span>
    </div>`,h=[];S("customerInfo","customerName")&&h.push(W(r("projects.details.client","Ø§Ù„Ø¹Ù…ÙŠÙ„"),t.name||"-")),S("customerInfo","customerCompany")&&h.push(W(r("projects.details.company","Ø´Ø±ÙƒØ© Ø§Ù„Ø¹Ù…ÙŠÙ„"),t.company||"â€”")),S("customerInfo","customerPhone")&&h.push(W(r("projects.details.labels.clientPhone","Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„"),t.phone||"-")),S("customerInfo","customerEmail")&&h.push(W(r("projects.details.labels.clientEmail","Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"),t.email||"-"));const A=F("customerInfo")?`<section class="quote-section quote-section--plain quote-section--customer">
        <h3 class="quote-section__title">${l(r("projects.quote.sections.customer","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„"))}</h3>
        ${h.length?`<div class="info-plain">${h.join("")}</div>`:j}
      </section>`:"",D=[];S("projectInfo","projectType")&&D.push(W(r("projects.details.type","Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.typeLabel||"-")),S("projectInfo","projectTitle")&&D.push(W(r("projects.details.projectTitle","Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.title||"-")),S("projectInfo","projectCode")&&D.push(W(r("projects.details.labels.code","Ø±Ù‚Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.code||"-")),S("projectInfo","projectStart")&&D.push(W(r("projects.details.start","Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.startDisplay||"-")),S("projectInfo","projectEnd")&&D.push(W(r("projects.details.end","Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.endDisplay||"-")),S("projectInfo","projectDuration")&&D.push(W(r("projects.details.duration","Ù…Ø¯Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.durationLabel||"-")),S("projectInfo","projectStatus")&&D.push(W(r("projects.details.status","Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.statusLabel||"-"));const B=F("projectInfo")?`<section class="quote-section quote-section--plain quote-section--project">
        <h3 class="quote-section__title">${l(r("projects.quote.sections.project","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"))}</h3>
        ${D.length?`<div class="info-plain">${D.join("")}</div>`:j}
      </section>`:"",ae=wt.filter(m=>S("projectCrew",m.id)),N=Array.isArray(p?.crewAssignments)?p.crewAssignments:[],C=m=>{const M=m&&m.positionId!=null?`id:${String(m.positionId)}`:(()=>{const Q=(m?.positionLabel||m?.position_name||m?.position||"").trim().toLowerCase();return Q?`label:${Q}`:""})(),I=Number.isFinite(Number(m?.positionClientPrice))?Number(m.positionClientPrice):0,J=I>0?`|p:${I.toFixed(2)}`:"";return`${M}${J}`};(()=>{const m=new Map;return N.forEach(M=>{const I=C(M);I&&m.set(I,(m.get(I)||0)+1)}),m})();const Y=(()=>{const m=[];if(ae.forEach(E=>{E.id==="position"?(m.push({...E,render:V=>{const ie=V?.positionLabel??V?.position_name??V?.role??r("reservations.crew.positionFallback","Ù…Ù†ØµØ¨ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…");return l(T(String(ie)))}}),S("projectCrew","quantity")&&m.push({id:"quantity",labelKey:"reservations.details.table.headers.quantity",fallback:"Ø§Ù„ÙƒÙ…ÙŠØ©",render:V=>l(T(String(Math.max(1,Number(V?.__count||1)))))})):E.id==="price"?m.push({...E,render:V=>{const ie=Number.isFinite(Number(V?.positionClientPrice))?Number(V.positionClientPrice):0,Ce=Math.max(1,Number(V?.__count||1)),Ke=Math.max(1,Number(p?.rentalDays||1)),Ie=ie*Ce*Ke;return l(`${ye(Ie)} ${r("reservations.create.summary.currency","SR")}`)}}):E.id==="unitPrice"?m.push({...E,render:V=>{const ie=Number.isFinite(Number(V?.positionClientPrice))?Number(V.positionClientPrice):0;return l(`${ye(ie)} ${r("reservations.create.summary.currency","SR")}`)}}):m.push(E)}),S("projectCrew","days")){const E=Math.max(1,Number(p?.rentalDays||1)),V=m.findIndex(Ce=>Ce.id==="price"),ie=Math.max(0,V);m.splice(ie,0,{id:"days",labelKey:null,fallback:"Ø§Ù„Ø£ÙŠØ§Ù…",render:()=>l(T(String(E)))})}const M=new Map(m.map(E=>[E.id,E])),I=new Set,J=[],Q=E=>{const V=M.get(E);V&&!I.has(E)&&(J.push(V),I.add(E))};return Q("rowNumber"),Q("position"),Q("unitPrice"),Q("quantity"),Q("days"),Q("price"),m.forEach(E=>{I.has(E.id)||(J.push(E),I.add(E.id))}),J})(),oe=(()=>{const m=new Map;return N.forEach(M=>{const I=C(M);if(!I)return;const J=m.get(I);J?J.__count+=1:m.set(I,{...M,__count:1})}),Array.from(m.values())})(),O=(()=>{try{const m=Math.max(1,Number(p?.rentalDays||1)),M=(oe||[]).reduce((I,J)=>{const Q=Number.isFinite(Number(J?.positionClientPrice))?Number(J.positionClientPrice):0,E=Math.max(1,Number(J?.__count||1));return I+Q*E*m},0);return ye(M)}catch{return"0.00"}})(),H=F("projectCrew")?Y.length?`<section class="quote-section quote-section--table">
            <h3>${l(r("projects.quote.sections.crew","Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„"))}</h3>
            <table class="quote-table">
              <thead>
                <tr>${Y.map(m=>`<th>${l(m.labelKey?r(m.labelKey,m.fallback):m.fallback)}</th>`).join("")}</tr>
              </thead>
              <tbody>${oe.length?oe.map((m,M)=>`<tr>${Y.map(I=>`<td><div class="quote-cell">${I.render(m,M)}</div></td>`).join("")}</tr>`).join(""):`<tr><td colspan="${Math.max(Y.length,1)}" class="empty">${l(r("projects.details.crew.empty","Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ø§Ù‚Ù… ÙÙ†ÙŠ Ù…Ø±ØªØ¨Ø·."))}</td></tr>`}
              </tbody>
            </table>
            ${S("projectCrew","crewSubtotal")?`
              <div class="quote-table-subtotal">
                <span class="quote-table-subtotal__pill">
                  <span class="quote-table-subtotal__label">${l(r("reservations.details.labels.crewTotal","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±ÙŠÙ‚"))}</span>
                  <span class="quote-table-subtotal__value">${l(`${O} ${y}`)}</span>
                </span>
              </div>
            `:""}
          </section>`:`<section class="quote-section quote-section--table">
            <h3>${l(r("projects.quote.sections.crew","Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„"))}</h3>
            ${j}
          </section>`:"",z=[];S("financialSummary","discountAmount")&&z.push(ne(r("reservations.details.labels.discount","Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ…"),o.discountAmount||X(0,y)));const ue=r("projects.details.summary.preTaxTotal","Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©");S("financialSummary","reservationsTotal")&&z.push(ne(ue,o.reservationsTotal||X(0,y))),S("financialSummary","taxAmount")&&z.push(ne(r("projects.details.summary.combinedTax","Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"),o.taxAmount||X(0,y)));const x=[];S("financialSummary","overallTotal")&&x.push(ne(r("projects.details.summary.overallTotal","Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ"),o.overallTotal||X(0,y),{variant:"final"}));const G=F("financialSummary")?!z.length&&!x.length?`<section class="quote-section quote-section--financial">${j}</section>`:`<section class="quote-section quote-section--financial">
          <div class="totals-block">
            <h3>${l(r("projects.quote.sections.financial","Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ"))}</h3>
            ${z.length?`<div class="totals-inline">${z.join("")}</div>`:""}
            ${x.length?`<div class="totals-final">${x.join("")}</div>`:""}
          </div>
        </section>`:"",Z=vn.filter(m=>S("projectExpenses",m.id)),me=F("projectExpenses")?Z.length?`<section class="quote-section quote-section--table">
            <h3>${l(r("projects.quote.sections.expenses","Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©"))}</h3>
            <table class="quote-table">
              <thead>
                <tr>${Z.map(m=>`<th>${l(m.labelKey?r(m.labelKey,m.fallback):m.fallback)}</th>`).join("")}</tr>
              </thead>
              <tbody>${s.length?s.map((m,M)=>`<tr>${Z.map(I=>`<td><div class="quote-cell">${I.render(m,M)}</div></td>`).join("")}</tr>`).join(""):`<tr><td colspan="${Math.max(Z.length,1)}" class="empty">${l(r("projects.details.expenses.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ØªØ·Ù„Ø¨Ø§Øª Ù…Ø³Ø¬Ù„Ø©."))}</td></tr>`}
              </tbody>
            </table>
            ${S("projectExpenses","expensesSubtotal")?`
              <div class="quote-table-subtotal">
                <span class="quote-table-subtotal__pill">
                  <span class="quote-table-subtotal__label">${l(r("projects.details.expensesTotal","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©"))}</span>
                  <span class="quote-table-subtotal__value">${l(o.expensesTotal||X(0,y))}</span>
                </span>
              </div>
            `:""}
          </section>`:`<section class="quote-section quote-section--table">
            <h3>${l(r("projects.quote.sections.expenses","Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©"))}</h3>
            ${j}
          </section>`:"",Ee=vt.filter(m=>S("projectEquipment",m.id)),ve=(()=>{let m=[];if(Ee.forEach(Q=>{Q.id==="price"?m.push({...Q,render:E=>{const V=Number.isFinite(Number(E?.unitPriceValue))?Number(E.unitPriceValue):0,ie=Number.isFinite(Number(E?.qty))?Math.max(1,Number(E.qty)):1,Ce=Math.max(1,Number(p?.rentalDays||1)),Ke=V*ie*Ce;return l(`${ye(Ke)} ${r("reservations.create.summary.currency","SR")}`)}}):Q.id==="unitPrice"?m.push({...Q,render:E=>{const V=Number.isFinite(Number(E?.unitPriceValue))?Number(E.unitPriceValue):0;return l(`${ye(V)} ${r("reservations.create.summary.currency","SR")}`)}}):m.push(Q)}),S("projectEquipment","days")){const Q=Math.max(1,Number(p?.rentalDays||1)),E=m.findIndex(ie=>ie.id==="price"),V=Math.max(0,E);m.splice(V,0,{id:"days",labelKey:null,fallback:"Ø§Ù„Ø£ÙŠØ§Ù…",render:()=>l(T(String(Q)))})}const M=new Map(m.map(Q=>[Q.id,Q])),I=m.filter(Q=>!["unitPrice","quantity","days","price"].includes(Q.id)),J=["unitPrice","quantity","days","price"].map(Q=>M.get(Q)).filter(Boolean);return m=[...I,...J],m})(),we=Array.isArray(p?.equipmentItems)?p.equipmentItems:[],je=(()=>{try{const m=Math.max(1,Number(p?.rentalDays||1)),M=(we||[]).reduce((I,J)=>{const Q=Number.isFinite(Number(J?.unitPriceValue))?Number(J.unitPriceValue):0,E=Number.isFinite(Number(J?.qty))?Math.max(1,Number(J.qty)):1;return I+Q*E*m},0);return ye(M)}catch{return"0.00"}})(),Fe=F("projectEquipment")?ve.length?`<section class="quote-section quote-section--table">
            <h3>${l(r("projects.quote.sections.equipment","Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</h3>
            <table class="quote-table">
              <thead>
                <tr>${ve.map(m=>`<th>${l(m.labelKey?r(m.labelKey,m.fallback):m.fallback)}</th>`).join("")}</tr>
              </thead>
              <tbody>${we.length?we.map((m,M)=>`<tr>${ve.map(I=>`<td><div class="quote-cell">${I.render(m,M)}</div></td>`).join("")}</tr>`).join(""):`<tr><td colspan="${Math.max(ve.length,1)}" class="empty">${l(r("projects.details.equipment.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø¯Ø§Øª Ù…Ø±ØªØ¨Ø·Ø© Ø­Ø§Ù„ÙŠØ§Ù‹."))}</td></tr>`}
              </tbody>
            </table>
            ${S("projectEquipment","equipmentSubtotal")?`
              <div class="quote-table-subtotal">
                <span class="quote-table-subtotal__pill">
                  <span class="quote-table-subtotal__label">${l(r("reservations.details.labels.equipmentTotal","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</span>
                  <span class="quote-table-subtotal__value">${l(`${je} ${y}`)}</span>
                </span>
              </div>
            `:""}
          </section>`:`<section class="quote-section quote-section--table">
            <h3>${l(r("projects.quote.sections.equipment","Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</h3>
            ${j}
          </section>`:"",Ue=(e?.description||"").trim()||"",qe=F("projectNotes")?`<section class="quote-section">
        <h3>${l(r("projects.quote.sections.notes","Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"))}</h3>
        <div class="quote-notes">${l(Ue||r("projects.fallback.noDescription","Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ Ù„Ù„Ù…Ø´Ø±ÙˆØ¹."))}</div>
      </section>`:"",Se=[];S("payment","beneficiary")&&Se.push(he(r("reservations.quote.labels.beneficiary","Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙÙŠØ¯"),be.beneficiaryName)),S("payment","bank")&&Se.push(he(r("reservations.quote.labels.bank","Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ"),be.bankName)),S("payment","account")&&Se.push(he(r("reservations.quote.labels.account","Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨"),T(be.accountNumber))),S("payment","iban")&&Se.push(he(r("reservations.quote.labels.iban","Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ¨Ø§Ù†"),T(be.iban)));const Ye=`<section class="quote-section">
      <div class="payment-block">
        <h3>${l(r("reservations.quote.sections.payment","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹"))}</h3>
        <div class="payment-rows">${Se.length?Se.join(""):j}</div>
      </div>
      <p class="quote-approval-note">${l(be.approvalNote)}</p>
    </section>`,Pe=Array.isArray(g)&&g.length?g:_e,Be=`<footer class="quote-footer">
        <h4>${l(r("reservations.quote.labels.terms","Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø¹Ø§Ù…Ø©"))}</h4>
        <ul>${Pe.map(m=>`<li>${l(m)}</li>`).join("")}</ul>
      </footer>`,Le=[],ge=[];if(B&&ge.push({key:"project",html:B}),A&&ge.push({key:"customer",html:A}),ge.length>1){const m=ge.find(J=>J.key==="project"),M=ge.find(J=>J.key==="customer"),I=[];m?.html&&I.push(m.html),M?.html&&I.push(M.html),Le.push(pe(`<div class="quote-section-row quote-section-row--primary">${I.join("")}</div>`,{blockType:"group"}))}else ge.length===1&&Le.push(pe(ge[0].html));const ke=[];H&&ke.push(pe(H,{blockType:"table",extraAttributes:'data-table-id="project-crew"'})),me&&ke.push(pe(me,{blockType:"table",extraAttributes:'data-table-id="project-expenses"'})),Fe&&ke.push(pe(Fe,{blockType:"table",extraAttributes:'data-table-id="project-equipment"'}));const Ae=[];G&&Ae.push(pe(G,{blockType:"summary"})),qe&&Ae.push(pe(qe));const Oe=[...F("payment")?[pe(Ye,{blockType:"payment"})]:[],pe(Be,{blockType:"footer"})],ze=[...yt(Le,"projects.quote.placeholder.primary"),...ke,...yt(Ae,"projects.quote.placeholder.summary"),...Oe],Ve=`
    <header class="quote-header" data-quote-header-template>
      <div class="quote-header__logo">
        <img class="quote-logo" src="${l(be.logoUrl)}" alt="${l(be.companyName)}" crossorigin="anonymous"/>
      </div>
      <div class="quote-header__title">
        <h1>${l(r("projects.quote.title","Ø¹Ø±Ø¶ Ø³Ø¹Ø±"))}</h1>
        <p class="quote-company-name">${l(be.companyName)}</p>
        <p class="quote-company-cr">${l(r("reservations.quote.labels.cr","Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ"))}: ${l(be.commercialRegistry)}</p>
        <p class="quote-company-license">ØªØ±Ø®ÙŠØµ Ø¥Ø¹Ù„Ø§Ù…ÙŠ: 159460</p>
      </div>
      <div class="quote-header__meta">
        <div class="quote-header__meta-item">
          <span>${l(r("reservations.details.labels.reservationId","Ø±Ù‚Ù… Ø§Ù„Ø¹Ø±Ø¶"))}</span>
          <strong>${l(w)}</strong>
        </div>
        <div class="quote-header__meta-item">
          <span>${l(r("projects.quote.labels.date","Ø§Ù„ØªØ§Ø±ÙŠØ®"))}</span>
          <strong>${l(v)}</strong>
        </div>
      </div>
    </header>
  `.trim();return`
    <div id="quotation-pdf-root" dir="rtl">
        <style>${xn}${_n}</style>
      <div class="quote-document" data-quote-document>
        <div class="quote-preview-pages" data-quote-pages></div>
        <div class="quote-content-source" data-quote-source>
          ${Ve}
          ${ze.join("")}
        </div>
      </div>
    </div>
  `}function zn(e){if(e?.context==="project")return ds(e);const{reservation:t,customer:n,project:a,crewAssignments:s,totals:u,totalsDisplay:o,rentalDays:i,currencyLabel:d,sections:y,fieldSelections:b={},quoteNumber:$,quoteDate:w,terms:v=_e}=e,g=T(String(t?.reservationId??t?.id??"")),L=t.start?T(Xe(t.start)):"-",S=t.end?T(Xe(t.end)):"-",F=n?.customerName||n?.full_name||n?.name||"-",j=n?.phone||"-",W=n?.email||"-",ne=n?.company||n?.company_name||"-",he=T(j),h=a?.title||a?.name||r("reservations.details.project.none","ØºÙŠØ± Ù…Ø±ØªØ¨Ø· Ø¨Ù…Ø´Ø±ÙˆØ¹"),A=a?.code||a?.projectCode||"",D=T(String(i)),B=t?.notes||"",ae=Array.isArray(v)&&v.length?v:_e,N=Rt(b),C=(c,k)=>Bt(N,c,k),Y=c=>y?.has?.(c),oe=`<div class="quote-placeholder">${l(r("reservations.quote.placeholder.noFields","Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù„Ù„Ø¹Ø±Ø¶ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…."))}</div>`,O=(c,k)=>`<div class="info-plain__item">${l(c)} <span class="info-plain__slash">/</span> <strong class="info-plain__value">${l(k)}</strong></div>`,H=(c,k,{variant:K="inline"}={})=>K==="final"?`<div class="totals-item totals-item--final">
        <span class="totals-item__label">${l(c)}</span>
        <span class="totals-item__slash">/</span>
        <span class="totals-item__value">${l(k)}</span>
      </div>`:`<span class="totals-inline__item">
      <span class="totals-inline__label">${l(c)}</span>
      <span class="totals-inline__slash">/</span>
      <span class="totals-inline__value">${l(k)}</span>
    </span>`,z=(c,k)=>`<div class="payment-row">
      <span class="payment-row__label">${l(c)}</span>
      <span class="payment-row__slash">/</span>
      <span class="payment-row__value">${l(k)}</span>
    </div>`,ue=[];C("customerInfo","customerName")&&ue.push(O(r("reservations.details.labels.customer","Ø§Ù„Ø¹Ù…ÙŠÙ„"),F)),C("customerInfo","customerCompany")&&ue.push(O(r("reservations.details.labels.company","Ø§Ù„Ø´Ø±ÙƒØ©"),ne)),C("customerInfo","customerPhone")&&ue.push(O(r("reservations.details.labels.phone","Ø§Ù„Ù‡Ø§ØªÙ"),he)),C("customerInfo","customerEmail")&&ue.push(O(r("reservations.details.labels.email","Ø§Ù„Ø¨Ø±ÙŠØ¯"),W));const x=Y("customerInfo")?`<section class="quote-section quote-section--plain quote-section--customer">
        <h3 class="quote-section__title">${l(r("reservations.quote.sections.customer","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„"))}</h3>
        ${ue.length?`<div class="info-plain">${ue.join("")}</div>`:oe}
      </section>`:"",G=[];C("reservationInfo","reservationId")&&G.push(O(r("reservations.details.labels.reservationId","Ø±Ù‚Ù… Ø§Ù„Ø­Ø¬Ø²"),g||"-")),C("reservationInfo","reservationStart")&&G.push(O(r("reservations.details.labels.start","Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø­Ø¬Ø²"),L)),C("reservationInfo","reservationEnd")&&G.push(O(r("reservations.details.labels.end","Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø­Ø¬Ø²"),S)),C("reservationInfo","reservationDuration")&&G.push(O(r("reservations.details.labels.duration","Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…"),D));const Z=Y("reservationInfo")?`<section class="quote-section quote-section--plain quote-section--reservation">
        <h3 class="quote-section__title">${l(r("reservations.quote.sections.reservation","ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²"))}</h3>
        ${G.length?`<div class="info-plain">${G.join("")}</div>`:oe}
      </section>`:"",me=[];C("projectInfo","projectTitle")&&me.push(O(r("reservations.details.labels.project","Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),h)),C("projectInfo","projectCode")&&me.push(O(r("reservations.details.labels.code","Ø§Ù„Ø±Ù…Ø²"),A||"-"));const Ee=Y("projectInfo")?`<section class="quote-section quote-section--plain">
        <h3 class="quote-section__title">${l(r("reservations.quote.sections.project","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"))}</h3>
        ${me.length?`<div class="info-plain">${me.join("")}</div>`:oe}
      </section>`:"",ve=[];C("financialSummary","discountAmount")&&ve.push(H(r("reservations.details.labels.discount","Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ…"),`${o.discountAmount} ${d}`)),C("financialSummary","subtotalBeforeTax")&&ve.push(H(r("reservations.details.labels.subtotalBeforeTax","Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"),`${o.taxableAmount} ${d}`)),C("financialSummary","taxAmount")&&ve.push(H(r("reservations.details.labels.tax","Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"),`${o.taxAmount} ${d}`));const we=C("financialSummary","finalTotal"),je=[];we&&je.push(H(r("reservations.details.labels.total","Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ"),`${o.finalTotal} ${d}`,{variant:"final"}));const Fe=je.length?`<div class="totals-final">${je.join("")}</div>`:"",Ue=Y("financialSummary")?!ve.length&&!we?`<section class="quote-section quote-section--financial">${oe}</section>`:`<section class="quote-section quote-section--financial">
          <div class="totals-block">
            <h3>${l(r("reservations.details.labels.summary","Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ"))}</h3>
            ${ve.length?`<div class="totals-inline">${ve.join("")}</div>`:""}
            ${Fe}
          </div>
        </section>`:"",{groups:qe}=cn(t),Se=qe.map(c=>{const k=Number(c?.count??c?.quantity??1)||1,K=Number(c?.unitPrice);let se=Number.isFinite(K)?K:0;if(!se||se<=0){const U=Number(c?.totalPrice);Number.isFinite(U)&&k>0&&(se=Number((U/k).toFixed(2)))}Number.isFinite(se)||(se=0);const le=c?.type==="package"||Array.isArray(c?.items)&&c.items.some(U=>U?.type==="package"),xe=Array.isArray(c?.barcodes)&&c.barcodes.length?c.barcodes[0]:Array.isArray(c?.items)&&c.items.length?c.items[0]?.barcode:null;let de=c?.packageDisplayCode??c?.package_code??c?.code??c?.packageCode??(Array.isArray(c?.items)&&c.items.length?c.items[0]?.package_code??c.items[0]?.code??c.items[0]?.packageCode:null);const te=U=>{const re=(U==null?"":String(U)).trim();return!!(!re||/^pkg-/i.test(re)||/^\d+$/.test(re)&&re.length<=4)};if(!de||te(de)){const U=c?.packageId??c?.package_id??(Array.isArray(c?.items)&&c.items.length?c.items[0]?.packageId??c.items[0]?.package_id:null);if(U)try{const re=dn(U);re&&re.package_code&&(de=re.package_code)}catch{}}if(!de||te(de))try{const U=Ge(c?.description||"");if(U){const re=pn();let $e=re.find(De=>Ge(De?.name||De?.title||De?.label||"")===U);$e||($e=re.find(De=>{const Wt=Ge(De?.name||De?.title||De?.label||"");return Wt.includes(U)||U.includes(Wt)})),$e&&$e.package_code&&(de=$e.package_code)}}catch{}const fe=le?de??xe??"":c?.barcode??xe??"",P=fe!=null?String(fe):"";let R=Number.isFinite(Number(c?.totalPrice))?Number(c.totalPrice):Number((se*k).toFixed(2));return R=st(R),{...c,isPackage:le,desc:c?.description,barcode:P,packageCodeResolved:de||"",qty:k,price:R,totalPrice:R,unitPriceValue:se}}),Ye=vt.filter(c=>C("items",c.id)),Pe=(()=>{let c=[];Ye.forEach(te=>{te.id==="price"?c.push({...te,render:fe=>{const P=Number.isFinite(Number(fe?.unitPriceValue))?Number(fe.unitPriceValue):0,R=Number.isFinite(Number(fe?.qty))?Math.max(1,Number(fe.qty)):1,U=Math.max(1,Number(p?.rentalDays||1)),re=P*R*U;return l(`${ye(re)} ${r("reservations.create.summary.currency","SR")}`)}}):te.id==="unitPrice"?c.push({...te,render:fe=>{const P=Number.isFinite(Number(fe?.unitPriceValue))?Number(fe.unitPriceValue):0;return l(`${ye(P)} ${r("reservations.create.summary.currency","SR")}`)}}):c.push(te)});const k=Math.max(1,Number(p?.rentalDays||1)),K=c.findIndex(te=>te.id==="price"),se=Math.max(0,K);c.splice(se,0,{id:"days",labelKey:null,fallback:"Ø§Ù„Ø£ÙŠØ§Ù…",render:()=>l(T(String(k)))});const le=new Map(c.map(te=>[te.id,te])),xe=c.filter(te=>!["unitPrice","quantity","days","price"].includes(te.id)),de=["unitPrice","quantity","days","price"].map(te=>le.get(te)).filter(Boolean);return c=[...xe,...de],c})(),Be=Pe.length>0,Le=Be?Pe.map(c=>`<th>${l(c.labelKey?r(c.labelKey,c.fallback):c.fallback)}</th>`).join(""):"",ke=Se.length>0?Se.map((c,k)=>`<tr>${Pe.map(K=>`<td><div class="quote-cell">${K.render(c,k)}</div></td>`).join("")}</tr>`).join(""):`<tr><td colspan="${Math.max(Pe.length,1)}" class="empty">${l(r("reservations.details.noItems","ðŸ“¦ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø¯Ø§Øª Ø¶Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø² Ø­Ø§Ù„ÙŠØ§Ù‹."))}</td></tr>`,Ae=Y("items")?Be?`<section class="quote-section quote-section--table">
            <h3>${l(r("reservations.details.items.title","Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</h3>
            <table class="quote-table">
              <thead>
                <tr>${Le}</tr>
              </thead>
              <tbody>${ke}</tbody>
            </table>
            ${C("items","equipmentSubtotal")?`
              <div class="quote-table-subtotal">
                <span class="quote-table-subtotal__pill">
                  <span class="quote-table-subtotal__label">${l(r("reservations.details.labels.equipmentTotal","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</span>
                  <span class="quote-table-subtotal__value">${l(`${o.equipmentTotal} ${d}`)}</span>
                </span>
              </div>
            `:""}
          </section>`:`<section class="quote-section quote-section--table">
            <h3>${l(r("reservations.details.items.title","Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</h3>
            ${oe}
          </section>`:"",Oe=wt.filter(c=>C("crew",c.id)),ze=Oe.length>0,Ve=Array.isArray(s)?s:[],m=c=>{const k=c&&c.positionId!=null?`id:${String(c.positionId)}`:(()=>{const le=(c?.positionLabel||c?.position_name||c?.position||"").trim().toLowerCase();return le?`label:${le}`:""})(),K=Number.isFinite(Number(c?.positionClientPrice))?Number(c.positionClientPrice):0,se=K>0?`|p:${K.toFixed(2)}`:"";return`${k}${se}`};(()=>{const c=new Map;return Ve.forEach(k=>{const K=m(k);K&&c.set(K,(c.get(K)||0)+1)}),c})();const M=(()=>{let c=[],k=null;Oe.forEach(P=>{P.id==="position"?(c.push({...P,render:R=>{const U=R?.positionLabel??R?.position_name??R?.role??r("reservations.crew.positionFallback","Ù…Ù†ØµØ¨ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…");return l(T(String(U)))}}),k={id:"quantity",labelKey:"reservations.details.table.headers.quantity",fallback:"Ø§Ù„ÙƒÙ…ÙŠØ©",render:R=>{const U=Number(R?.__count||1);return l(T(String(Math.max(1,U))))}}):P.id==="price"?c.push({...P,render:R=>{const U=Number.isFinite(Number(R?.positionClientPrice))?Number(R.positionClientPrice):0,re=Math.max(1,Number(R?.__count||1)),$e=Math.max(1,Number(p?.rentalDays||1)),De=U*re*$e;return l(`${ye(De)} ${r("reservations.create.summary.currency","SR")}`)}}):P.id==="unitPrice"?c.push({...P,render:R=>{const U=Number.isFinite(Number(R?.positionClientPrice))?Number(R.positionClientPrice):0;return l(`${ye(U)} ${r("reservations.create.summary.currency","SR")}`)}}):c.push(P)}),k&&c.push(k);const K=Math.max(1,Number(p?.rentalDays||1)),se=c.findIndex(P=>P.id==="price"),le=Math.max(0,se);c.splice(le,0,{id:"days",labelKey:null,fallback:"Ø§Ù„Ø£ÙŠØ§Ù…",render:()=>l(T(String(K)))});const xe=new Map(c.map(P=>[P.id,P])),de=new Set,te=[],fe=P=>{const R=xe.get(P);R&&!de.has(P)&&(te.push(R),de.add(P))};return fe("rowNumber"),fe("position"),fe("unitPrice"),fe("quantity"),fe("days"),fe("price"),c.forEach(P=>{de.has(P.id)||(te.push(P),de.add(P.id))}),c=te,c})(),I=ze?M.map(c=>`<th>${l(c.labelKey?r(c.labelKey,c.fallback):c.fallback)}</th>`).join(""):"",J=(()=>{const c=new Map;return Ve.forEach(k=>{const K=m(k);if(!K)return;const se=c.get(K);se?se.__count+=1:c.set(K,{...k,__count:1})}),Array.from(c.values())})(),Q=J.length?J.map((c,k)=>`<tr>${M.map(K=>`<td><div class="quote-cell">${K.render(c,k)}</div></td>`).join("")}</tr>`).join(""):`<tr><td colspan="${Math.max(M.length,1)}" class="empty">${l(r("reservations.details.noCrew","ðŸ˜Ž Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙØ±ÙŠÙ‚ Ù…Ø±ØªØ¨Ø· Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø²."))}</td></tr>`,E=Y("crew")?ze?`<section class="quote-section quote-section--table">
            <h3>${l(r("reservations.details.technicians.title","Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„"))}</h3>
            <table class="quote-table">
              <thead>
                <tr>${I}</tr>
              </thead>
              <tbody>${Q}</tbody>
            </table>
            ${C("crew","crewSubtotal")?`
              <div class="quote-table-subtotal">
                <span class="quote-table-subtotal__pill">
                  <span class="quote-table-subtotal__label">${l(r("reservations.details.labels.crewTotal","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±ÙŠÙ‚"))}</span>
                  <span class="quote-table-subtotal__value">${l(`${o.crewTotal} ${d}`)}</span>
                </span>
              </div>
            `:""}
          </section>`:`<section class="quote-section quote-section--table">
            <h3>${l(r("reservations.details.technicians.title","Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„"))}</h3>
            ${oe}
          </section>`:"",V=Y("notes")?`<section class="quote-section">
        <h3>${l(r("reservations.details.labels.notes","Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø­Ø¬Ø²"))}</h3>
        <div class="quote-notes">${l(B||r("reservations.quote.emptyNotes","Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©."))}</div>
      </section>`:"",ie=[];C("payment","beneficiary")&&ie.push(z(r("reservations.quote.labels.beneficiary","Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙÙŠØ¯"),be.beneficiaryName)),C("payment","bank")&&ie.push(z(r("reservations.quote.labels.bank","Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ"),be.bankName)),C("payment","account")&&ie.push(z(r("reservations.quote.labels.account","Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨"),T(be.accountNumber))),C("payment","iban")&&ie.push(z(r("reservations.quote.labels.iban","Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ¨Ø§Ù†"),T(be.iban)));const Ce=`<section class="quote-section">
      <div class="payment-block">
        <h3>${l(r("reservations.quote.sections.payment","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹"))}</h3>
        <div class="payment-rows">${ie.length?ie.join(""):oe}</div>
      </div>
      <p class="quote-approval-note">${l(be.approvalNote)}</p>
    </section>`,Ke=`<footer class="quote-footer">
        <h4>${l(r("reservations.quote.labels.terms","Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø¹Ø§Ù…Ø©"))}</h4>
        <ul>${ae.map(c=>`<li>${l(c)}</li>`).join("")}</ul>
      </footer>`,Ie=[];x&&Z?Ie.push(pe(`<div class="quote-section-row">${x}${Z}</div>`,{blockType:"group"})):(Z&&Ie.push(pe(Z)),x&&Ie.push(pe(x))),Ee&&Ie.push(pe(Ee));const rt=[];Ae&&rt.push(pe(Ae,{blockType:"table",extraAttributes:'data-table-id="items"'})),E&&rt.push(pe(E,{blockType:"table",extraAttributes:'data-table-id="crew"'}));const f=[];Ue&&f.push(pe(Ue,{blockType:"summary"})),V&&f.push(pe(V));const ee=[...Y("payment")?[pe(Ce,{blockType:"payment"})]:[],pe(Ke,{blockType:"footer"})],_=[...yt(Ie,"reservations.quote.placeholder.page1"),...rt,...yt(f,"reservations.quote.placeholder.page2"),...ee],ce=`
    <header class="quote-header" data-quote-header-template>
      <div class="quote-header__logo">
        <img class="quote-logo" src="${l(be.logoUrl)}" alt="${l(be.companyName)}" crossorigin="anonymous"/>
      </div>
      <div class="quote-header__title">
        <h1>${l(r("reservations.quote.title","Ø¹Ø±Ø¶ Ø³Ø¹Ø±"))}</h1>
        <p class="quote-company-name">${l(be.companyName)}</p>
        <p class="quote-company-cr">${l(r("reservations.quote.labels.cr","Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ"))}: ${l(be.commercialRegistry)}</p>
        <p class="quote-company-license">ØªØ±Ø®ÙŠØµ Ø¥Ø¹Ù„Ø§Ù…ÙŠ: 159460</p>
      </div>
      <div class="quote-header__meta">
        <div class="quote-header__meta-item">
          <span>Ø±Ù‚Ù… Ø§Ù„Ø¹Ø±Ø¶</span>
          <strong>${l($)}</strong>
        </div>
        <div class="quote-header__meta-item">
          <span>Ø§Ù„ØªØ§Ø±ÙŠØ®</span>
          <strong>${l(w)}</strong>
        </div>
      </div>
    </header>
  `.trim();return`
    <div id="quotation-pdf-root" dir="rtl">
      <style>${xn}${_n}</style>
      <div class="quote-document" data-quote-document>
        <div class="quote-preview-pages" data-quote-pages></div>
        <div class="quote-content-source" data-quote-source>
          ${ce}
          ${_.join("")}
        </div>
      </div>
    </div>
  `}async function Vn(){try{const e=Ft();if((Array.isArray(e?.packages)?e.packages:[]).length>0)return;const n=await Lt("/packages/?all=1"),a=Array.isArray(n?.data)?n.data:Array.isArray(n)?n:[];a.length&&(ta({packages:a}),document.dispatchEvent?.(new CustomEvent("packages:changed",{detail:{packages:a}})))}catch{}}function ps(e){return e?e.complete?e.naturalHeight===0?Promise.reject(new Error(`image failed to load: ${e.src||"unknown"}`)):Promise.resolve():new Promise((t,n)=>{const a=()=>{u(),t()},s=()=>{u(),n(new Error(`image failed to load: ${e.src||"unknown"}`))},u=()=>{e.removeEventListener("load",a),e.removeEventListener("error",s)};e.addEventListener("load",a,{once:!0}),e.addEventListener("error",s,{once:!0})}):Promise.resolve()}async function ot(e){if(!e)return;const t=e.ownerDocument||document,n=t.defaultView||window,a=Array.from(e.querySelectorAll?.("img")||[]),s=t.fonts?.ready?t.fonts.ready:Promise.resolve(),u=a.map(i=>ps(i)),o=[s,...u].map(i=>i.catch(d=>(Ne("asset load failed",d),Ta(),null)));await Promise.all(o),await new Promise(i=>n.requestAnimationFrame(()=>i()))}async function ht(e,{context:t="preview"}={}){if(!e)return;const n=t==="preview",a=e.ownerDocument||document;e.setAttribute("data-quote-render-context",t);const s=e.querySelector("[data-quote-pages]"),u=e.querySelector("[data-quote-source]"),o=u?.querySelector("[data-quote-header-template]");if(!s||!u||!o)return;s.style.display="block",s.style.margin="0",s.style.padding="0",s.style.gap="0px",s.style.rowGap="0px",s.style.columnGap="0px",s.style.alignItems="stretch",s.style.justifyContent="flex-start",await Ln(u),await ot(u),s.innerHTML="";const i=Array.from(u.querySelectorAll(":scope > [data-quote-block]"));let d=null,y=null;const b=h=>{h.style.margin="0 auto",h.style.breakInside="avoid",h.style.pageBreakInside="avoid",h.style.pageBreakAfter="auto",h.style.breakAfter="auto"},$=()=>{const h=a.createElement("div"),A=s.childElementCount===0;if(h.className="quote-page",h.dataset.pageIndex=String(s.childElementCount),A){h.classList.add("quote-page--primary");const B=o.cloneNode(!0);B.removeAttribute("data-quote-header-template"),h.appendChild(B)}else h.classList.add("quote-page--continuation");const D=a.createElement("main");D.className="quote-body",h.appendChild(D),s.appendChild(h),b(h),d=h,y=D},w=()=>{(!d||!y||!y.isConnected)&&$()},v=()=>{if(!d||!y||y.childElementCount>0)return;const h=d;d=null,y=null,h.parentNode&&h.parentNode.removeChild(h)},g=()=>{d=null,y=null},L=()=>d?d.scrollHeight-d.clientHeight>En:!1,S=(h,{allowOverflow:A=!1}={})=>(w(),y.appendChild(h),L()&&!A?(y.removeChild(h),v(),!1):!0),F=h=>{const A=h.cloneNode(!0);A.removeAttribute?.("data-quote-block"),A.removeAttribute?.("data-block-type"),A.removeAttribute?.("data-table-id"),!S(A)&&(g(),!S(A)&&S(A,{allowOverflow:!0}))},j=h=>{const A=h.querySelector("table");if(!A){F(h);return}const D=h.querySelector("h3"),B=A.querySelector("thead"),ae=Array.from(A.querySelectorAll("tbody tr"));if(!ae.length){F(h);return}let N=null,C=0;const Y=(O=!1)=>{const H=h.cloneNode(!1);H.removeAttribute("data-quote-block"),H.removeAttribute("data-block-type"),H.removeAttribute("data-table-id"),H.classList.add("quote-section--table-fragment"),O&&H.classList.add("quote-section--table-fragment--continued");const z=D?D.cloneNode(!0):null;z&&H.appendChild(z);const ue=A.cloneNode(!1);ue.classList.add("quote-table--fragment"),B&&ue.appendChild(B.cloneNode(!0));const x=a.createElement("tbody");return ue.appendChild(x),H.appendChild(ue),{section:H,body:x}},oe=(O=!1)=>N||(N=Y(O),S(N.section)||(g(),S(N.section)||S(N.section,{allowOverflow:!0})),N);ae.forEach(O=>{oe(C>0);const H=O.cloneNode(!0);if(N.body.appendChild(H),L()&&(N.body.removeChild(H),N.body.childElementCount||(y.removeChild(N.section),N=null,v()),g(),N=null,oe(C>0),N.body.appendChild(H),L())){N.section.classList.add("quote-section--table-fragment--overflow"),C+=1;return}C+=1}),N=null;try{const O=h.querySelector(":scope > .quote-table-subtotal");O&&F(O)}catch{}};if(!i.length)return;i.forEach(h=>{h.getAttribute("data-block-type")==="table"?j(h):F(h)});const W=Array.from(s.children),ne=[];if(W.forEach((h,A)=>{const D=h.querySelector(".quote-body");if(A!==0&&(!D||D.childElementCount===0)){h.remove();return}ne.push(h)}),!n){const h=a.defaultView||window,A=Math.min(3,Math.max(1,h.devicePixelRatio||1)),D=_t()?Math.min(2,A):A;ne.forEach(B=>Ua(B,{pixelRatio:D}))}ne.forEach((h,A)=>{const D=A===0;h.style.pageBreakAfter="auto",h.style.breakAfter="auto",h.style.pageBreakBefore=D?"auto":"always",h.style.breakBefore=D?"auto":"page",n?h.style.boxShadow="":h.style.boxShadow="none"});const he=ne[ne.length-1]||null;d=he,y=he?.querySelector(".quote-body")||null,await ot(s),n&&(s.style.display="flex",s.style.flexDirection="column",s.style.alignItems="center",s.style.justifyContent="flex-start",s.style.rowGap="18px",s.style.columnGap="0px",s.style.gap="18px")}function Wn(e=0){return e<=0?new Promise(t=>requestAnimationFrame(()=>t())):new Promise(t=>setTimeout(t,e))}function Gn(e){return e?Array.from(e.querySelectorAll(".quote-page")).some(n=>n.scrollHeight-n.clientHeight>En):!1}function zt(e,t="#000000"){if(!e)return;e.querySelectorAll('[style*="color"], [class*="text"], h1, h2, h3, h4, h5, h6, p, span, th, td, li, strong, em, label, dt, dd, caption, div').forEach(a=>{a instanceof HTMLElement&&a.style.setProperty("color",t,"important")})}async function ms(e,{filename:t,safariWindowRef:n=null,mobileWindowRef:a=null}){if(!e)return;const s=Array.from(e.querySelectorAll(".quote-page"));if(!s.length)throw new Error("Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙØ­Ø§Øª Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§.");const[u,o]=await Promise.all([Va(),za()]),i=e.ownerDocument||document,d=i?.defaultView?.getComputedStyle?.(e)?.direction,b=[e.getAttribute?.("dir"),e.style?.direction,d,i?.documentElement?.getAttribute?.("dir")].some(h=>typeof h=="string"&&h.toLowerCase().startsWith("rtl")),$=typeof window<"u"&&window.devicePixelRatio||1,w=Ht(),v=Cn(),g=_t();let L;g?L=1.5:v?L=Math.min(1.7,Math.max(1.2,$*1.1)):w?L=Math.min(1.8,Math.max(1.25,$*1.2)):L=Math.min(2,Math.max(1.6,$*1.4));const S=g||v?.9:w?.92:.95,F=new u({unit:"mm",format:"a4",orientation:"portrait",compress:!0}),j={scale:L,useCORS:!0,allowTaint:!1,backgroundColor:"#ffffff",letterRendering:!b,removeContainer:!1,logging:!0};let W=0;const ne=r("reservations.quote.errors.browserLimit","ØªØ¹Ø°Ø± Ø¥ØªÙ…Ø§Ù… Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ø³Ø¨Ø¨ Ù‚ÙŠÙˆØ¯ Ø§Ù„Ù…ØªØµÙØ­ØŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø£Ùˆ ØªÙ‚Ù„ÙŠÙ„ Ø­Ø¬Ù… Ø§Ù„Ù…Ø­ØªÙˆÙ‰.");try{for(let h=0;h<s.length;h+=1){const A=s[h];await Ln(A),await ot(A);const D=A.ownerDocument||document,B=D.createElement("div");Object.assign(B.style,{position:"fixed",top:"0",left:"-12000px",pointerEvents:"none",zIndex:"-1",backgroundColor:"#ffffff"});const ae=A.cloneNode(!0);ae.style.width=`${lt}px`,ae.style.maxWidth=`${lt}px`,ae.style.minWidth=`${lt}px`,ae.style.height=`${ct}px`,ae.style.maxHeight=`${ct}px`,ae.style.minHeight=`${ct}px`,ae.style.position="relative",ae.style.background="#ffffff",zt(ae),B.appendChild(ae),D.body.appendChild(B);let N;try{await ot(ae),N=await o(ae,{...j,scale:L,backgroundColor:"#ffffff",scrollX:0,scrollY:0})}catch(x){throw It(x,"pageCapture",{toastMessage:ne}),x}finally{B.parentNode?.removeChild(B)}if(!N)continue;const C=N.width||1,oe=(N.height||1)/C;let O=Et,H=O*oe,z=0;if(H>it){const x=it/H;H=it,O=O*x,z=Math.max(0,(Et-O)/2)}const ue=N.toDataURL("image/jpeg",S);W>0&&F.addPage(),F.addImage(ue,"JPEG",z,0,O,H,`page-${W+1}`,"FAST"),W+=1,await new Promise(x=>window.requestAnimationFrame(x))}}catch(h){throw Dt({safariWindowRef:n,mobileWindowRef:a}),h}if(W===0)throw Dt({safariWindowRef:n,mobileWindowRef:a}),new Error("PDF generation produced no pages.");if(v||g){const h=F.output("blob");if(g){const A=URL.createObjectURL(h);at();try{window.location.assign(A)}catch(D){Ne("mobile safari blob navigation failed",D)}finally{setTimeout(()=>URL.revokeObjectURL(A),6e4)}}else{const A=URL.createObjectURL(h),D=()=>v&&n&&!n.closed?n:a&&!a.closed?a:null,B=(N,C)=>{if(at(),!N){window.location.assign(C);return}try{N.location.replace(C),N.focus?.()}catch(Y){Ne("direct blob navigation failed",Y);try{N.document.open(),N.document.write(`<!DOCTYPE html><html lang="ar" dir="rtl"><head><meta charset="utf-8"><title>${l(r("reservations.quote.actions.export","ØªÙ†Ø²ÙŠÙ„ PDF"))}</title><style>html,body{margin:0;height:100%;background:#0f172a;color:#f8fafc;font-family:'Tajawal',sans-serif;} iframe{border:none;width:100%;height:100%;display:block;}</style></head><body><iframe src="${C}" title="PDF preview"></iframe></body></html>`),N.document.close()}catch(oe){Ne("iframe blob delivery failed",oe),window.location.assign(C)}}},ae=D();B(ae,A),setTimeout(()=>URL.revokeObjectURL(A),6e4)}}else{at();const h=F.output("bloburl"),A=document.createElement("a");A.href=h,A.download=t,A.rel="noopener",A.style.display="none",document.body.appendChild(A),A.click(),setTimeout(()=>{URL.revokeObjectURL(h),A.remove()},2e3)}}function Re(){if(!p||!q)return;const{previewFrame:e}=q;if(!e)return;const t=p.context||"reservation",n=zn({context:t,reservation:p.reservation,customer:p.customer,project:p.project,crewAssignments:p.crewAssignments,totals:p.totals,totalsDisplay:p.totalsDisplay,rentalDays:p.rentalDays,currencyLabel:p.currencyLabel,sections:p.sections,fieldSelections:p.fields,quoteNumber:p.quoteNumber,quoteDate:p.quoteDateLabel,terms:p.terms,projectCrew:p.projectCrew,projectExpenses:p.projectExpenses,projectEquipment:p.projectEquipment,projectInfo:p.projectInfo,clientInfo:p.clientInfo,paymentSummary:p.paymentSummary,projectTotals:p.projectTotals});Qe("render"),e.srcdoc=`<!DOCTYPE html>${n}`,e.addEventListener("load",async()=>{try{const a=e.contentDocument,s=a?.defaultView||window,u=a?.documentElement||a;u&&(mn(u),fn(u,s),yn(u,s));const o=a?.getElementById("quotation-pdf-root");try{o&&(await ht(o,{context:"preview"}),await Wn(120),Gn(o)&&await ht(o,{context:"preview"}),zt(o))}catch(v){console.error("[reservations/pdf] failed to layout preview document",v)}const i=Array.from(a?.querySelectorAll?.(".quote-page")||[]),d=a?.querySelector(".quote-preview-pages"),y=lt;let b=18;if(d&&a?.defaultView){const v=a.defaultView.getComputedStyle(d),g=parseFloat(v.rowGap||v.gap||`${b}`);Number.isFinite(g)&&g>=0&&(b=g)}const $=ct,w=i.length?i.length*$+Math.max(0,(i.length-1)*b):$;if(e.dataset.baseWidth=String(y),e.dataset.baseHeight=String(w),e.style.width=`${y}px`,e.style.minWidth=`${y}px`,e.style.height=`${w}px`,e.style.minHeight=`${w}px`,q?.previewFrameWrapper&&!q?.userAdjustedZoom){const v=q.previewFrameWrapper.clientWidth-24;v>0&&v<y?Te=Math.max(v/y,.3):Te=1}Jn(Te)}finally{at()}},{once:!0})}function fs(e){if(!p)return;const t=e.currentTarget,n=t?.dataset?.sectionId;n&&(t.checked?p.sections.add(n):p.sections.delete(n),On(p),Xn(),Re())}function ys(e){if(!p)return;const t=e.currentTarget,n=t?.dataset?.sectionId,a=t?.dataset?.fieldId;if(!n||!a)return;const s=p.context||"reservation",u=p.fields||(p.fields=At(s)),o=Na(u,n);t.checked?o.add(a):o.delete(a),On(p),Re()}function bs(e){if(!p)return;const t=e.currentTarget,n=t?.dataset?.sectionId;n&&(Kt(p,n),p.sectionExpansions[n]=t.open)}function Xn(){if(!q?.toggles||!p)return;const{toggles:e}=q,t=p.fields||{},n=p.context||"reservation";Kt(p);const a=St(n),s=wn(n),u=a.map(({id:o,labelKey:i,fallback:d})=>{const y=r(i,d),b=p.sections.has(o),$=s[o]||[],w=Ea(p,o),v=$.length?`<div class="quote-toggle-sublist">
          ${$.map(g=>{const L=Bt(t,o,g.id),S=b?"":"disabled",F=g.labelKey?r(g.labelKey,g.fallback):g.fallback;return`
              <label class="quote-toggle quote-toggle--field">
                <input type="checkbox" data-field-toggle data-section-id="${o}" data-field-id="${g.id}" ${L?"checked":""} ${S}>
                <span>${l(F)}</span>
              </label>
            `}).join("")}
        </div>`:"";return`
      <details class="quote-toggle-group" data-section-group data-section-id="${o}" ${w?"open":""}>
        <summary class="quote-toggle-summary">
          <label class="quote-toggle quote-toggle--section">
            <input type="checkbox" data-section-toggle data-section-id="${o}" ${b?"checked":""}>
            <span>${l(y)}</span>
          </label>
          ${$.length?'<span class="quote-toggle-caret" aria-hidden="true"></span>':""}
        </summary>
        ${v}
      </details>
    `}).join("");e.innerHTML=u,e.querySelectorAll("input[data-section-toggle]").forEach(o=>{o.addEventListener("change",fs)}),e.querySelectorAll("input[data-field-toggle]").forEach(o=>{o.addEventListener("change",ys)}),e.querySelectorAll("details[data-section-group]").forEach(o=>{o.addEventListener("toggle",bs)})}function hs(){if(q?.modal)return q;const e=document.createElement("div");e.id="reservationQuoteModal",e.className="modal fade quote-preview-modal",e.tabIndex=-1,e.setAttribute("aria-labelledby","reservationQuoteModalLabel"),e.setAttribute("aria-hidden","true"),e.style.display="none",e.innerHTML=`
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="reservationQuoteModalLabel">${l(r("reservations.quote.previewTitle","Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¹Ø±Ø¶ Ø³Ø¹Ø±"))}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="quote-preview-layout">
            <aside class="quote-preview-sidebar">
              <h6>${l(r("reservations.quote.toggleHeading","Ø­Ø¯Ø¯ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø¯ ØªØµØ¯ÙŠØ±Ù‡Ø§"))}</h6>
              <div class="quote-toggle-list" data-quote-toggles></div>
              <div class="quote-meta-info" data-quote-meta></div>
              <div class="quote-terms-editor" data-quote-terms-editor>
                <label class="quote-terms-editor__label" for="quote-terms-input">${l(r("reservations.quote.termsEditor.title","Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø¹Ø§Ù…Ø© (Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„)"))}</label>
                <textarea id="quote-terms-input" class="quote-terms-editor__textarea" rows="6" data-quote-terms-input placeholder="${l(r("reservations.quote.termsEditor.placeholder","Ø§ÙƒØªØ¨ ÙƒÙ„ Ø´Ø±Ø· ÙÙŠ Ø³Ø·Ø± Ù…Ø³ØªÙ‚Ù„"))}"></textarea>
                <button type="button" class="quote-terms-reset" data-quote-terms-reset>${l(r("reservations.quote.termsEditor.reset","Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©"))}</button>
              </div>
            </aside>
            <section class="quote-preview-panel">
              <div class="quote-preview" data-quote-preview></div>
            </section>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-light" data-bs-dismiss="modal">${l(r("reservations.quote.actions.close","Ø¥ØºÙ„Ø§Ù‚"))}</button>
          <button type="button" class="btn btn-primary" data-quote-download>
            ${l(r("reservations.quote.actions.export","ðŸ“„ ØªÙ†Ø²ÙŠÙ„ PDF"))}
          </button>
        </div>
      </div>
    </div>
  `,document.body.appendChild(e);const t=e.querySelector("[data-quote-toggles]"),n=e.querySelector("[data-quote-preview]"),a=e.querySelector("[data-quote-meta]"),s=e.querySelector("[data-quote-terms-input]"),u=e.querySelector("[data-quote-terms-reset]"),o=e.querySelector("[data-quote-download]"),i=e.querySelector(".modal-header"),d=i?.querySelector(".btn-close"),y=Array.from(e.querySelectorAll('[data-bs-dismiss="modal"]')),b=document.createElement("div");b.className="quote-preview-header-actions",i&&i.insertBefore(b,d||null);const $=document.createElement("iframe");$.className="quote-preview-frame",$.setAttribute("title",r("reservations.quote.previewTitle","Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¹Ø±Ø¶ Ø³Ø¹Ø±")),$.setAttribute("loading","lazy"),$.setAttribute("frameborder","0");const w=document.createElement("div");w.className="quote-preview-zoom-controls",w.innerHTML=`
    <button type="button" class="quote-preview-zoom-btn" data-zoom-out title="${l(r("reservations.quote.zoom.out","ØªØµØºÙŠØ±"))}">âˆ’</button>
    <span class="quote-preview-zoom-value" data-zoom-value>100%</span>
    <button type="button" class="quote-preview-zoom-btn" data-zoom-in title="${l(r("reservations.quote.zoom.in","ØªÙƒØ¨ÙŠØ±"))}">+</button>
    <button type="button" class="quote-preview-zoom-btn" data-zoom-reset title="${l(r("reservations.quote.zoom.reset","Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¶Ø¨Ø·"))}">1:1</button>
  `;const v=document.createElement("div");v.className="quote-preview-frame-wrapper",v.appendChild($),n.innerHTML="";const g=document.createElement("div");g.className="quote-preview-scroll",g.appendChild(v),n.appendChild(g);const L=document.createElement("div");L.className="quote-preview-status",L.setAttribute("role","status"),L.setAttribute("aria-live","polite"),L.hidden=!0,L.innerHTML=`
    <span class="quote-preview-spinner" data-quote-status-spinner aria-hidden="true"></span>
    <span data-quote-status-text>${l(An("render"))}</span>
    <button type="button" class="quote-preview-status-action" data-quote-status-action hidden></button>
  `,n.appendChild(L),b.appendChild(w),o?.addEventListener("click",async()=>{if(p){o.disabled=!0;try{await Zn()}finally{o.disabled=!1}}});const S=()=>{Pt()||Ct(e)};y.forEach(ne=>{ne?.addEventListener("click",S)}),d&&!y.includes(d)&&d.addEventListener("click",S),e.addEventListener("click",ne=>{Pt()||ne.target===e&&Ct(e)}),q={modal:e,toggles:t,preview:n,previewScroll:g,previewFrameWrapper:v,zoomControls:w,zoomValue:w.querySelector("[data-zoom-value]"),previewFrame:$,meta:a,downloadBtn:o,statusIndicator:L,statusText:L.querySelector("[data-quote-status-text]"),statusSpinner:L.querySelector("[data-quote-status-spinner]"),statusAction:L.querySelector("[data-quote-status-action]"),termsInput:s,termsReset:u,statusKind:null,userAdjustedZoom:!1};const F=w.querySelector("[data-zoom-out]"),j=w.querySelector("[data-zoom-in]"),W=w.querySelector("[data-zoom-reset]");return F?.addEventListener("click",()=>on(-.1)),j?.addEventListener("click",()=>on(.1)),W?.addEventListener("click",()=>gt(1,{markManual:!0})),s&&s.addEventListener("input",gs),u&&u.addEventListener("click",vs),gt(Te),q}function gt(e,{silent:t=!1,markManual:n=!1}={}){Te=Math.min(Math.max(e,.25),2.2),n&&q&&(q.userAdjustedZoom=!0),Jn(Te),!t&&q?.zoomValue&&(q.zoomValue.textContent=`${Math.round(Te*100)}%`)}function on(e){gt(Te+e,{markManual:!0})}function Jn(e){if(!q?.previewFrame||!q.previewFrameWrapper)return;const t=q.previewFrame,n=q.previewFrameWrapper,a=Number(t.dataset.baseWidth)||794,s=Number(t.dataset.baseHeight)||t.contentDocument?.body?.scrollHeight||1123;t.style.transform=`scale(${e})`,t.style.transformOrigin="top center",Ht()?(n.style.width="100%",n.style.maxWidth="100%",n.style.minWidth="0"):(n.style.width=`${a}px`,n.style.maxWidth=`${a}px`,n.style.minWidth=`${a}px`),n.style.minHeight=`${s}px`,n.style.height=`${s}px`}function Yn(){if(!q?.meta||!p)return;const{meta:e}=q;e.innerHTML=`
    <div class="quote-meta-card">
      <div><span>${l(r("reservations.quote.labels.number","Ø±Ù‚Ù… Ø¹Ø±Ø¶ Ø³Ø¹Ø±"))}</span><strong>${l(p.quoteNumber)}</strong></div>
      <div><span>${l(r("reservations.quote.labels.dateGregorian","Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ"))}</span><strong>${l(p.quoteDateLabel)}</strong></div>
    </div>
  `}function Vt(){if(!q?.termsInput)return;const e=(p?.terms&&p.terms.length?p.terms:_e).join(`
`);q.termsInput.value!==e&&(q.termsInput.value=e)}function gs(e){if(!p)return;const t=$t(e?.target?.value??"");if(t.length){p.terms=t;const n=document.getElementById("reservation-terms");n&&(n.value=e.target.value);const a=document.getElementById("edit-res-terms");a&&(a.value=e.target.value)}else{p.terms=[..._e],Vt();const n=_e.join(`
`),a=document.getElementById("reservation-terms");a&&(a.value=n);const s=document.getElementById("edit-res-terms");s&&(s.value=n)}Re()}function vs(e){if(e?.preventDefault?.(),!p)return;p.terms=[..._e];const t=document.getElementById("reservation-terms");t&&(t.value=_e.join(`
`));const n=document.getElementById("edit-res-terms");n&&(n.value=_e.join(`
`)),Vt(),Re()}async function Zn(){if(!p)return;Qe("export");const t=!Ht()&&Cn(),n=_t(),a=null,s=!n&&t?window.open("","_blank"):null;(d=>{if(d)try{d.document.open(),d.document.write(`<!DOCTYPE html><html lang="ar" dir="rtl"><head><meta charset="utf-8"><title>${l(r("reservations.quote.status.exporting","Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ù…Ù„Ù PDF..."))}</title><style>body{font-family:'Tajawal',sans-serif;margin:0;height:100vh;display:flex;align-items:center;justify-content:center;background:#0f172a;color:#f8fafc;text-align:center;padding:24px;} .loader{width:42px;height:42px;border-radius:50%;border:4px solid rgba(248,250,252,0.35);border-top-color:#38bdf8;animation:spin 1s linear infinite;margin:0 auto 18px;}@keyframes spin{to{transform:rotate(360deg);}} h1{margin:0 0 6px;font-size:1.05rem;} p{margin:0;font-size:0.9rem;opacity:0.8;}</style></head><body><div><div class="loader" aria-hidden="true"></div><h1>${l(r("reservations.quote.status.exporting","Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ù…Ù„Ù PDF..."))}</h1><p>${l(r("reservations.quote.status.exportingHint","Ù‚Ø¯ ÙŠØ³ØªØºØ±Ù‚ Ø°Ù„Ùƒ Ø¨Ø¶Ø¹ Ø«ÙˆØ§Ù†ÙØŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±..."))}</p></div></body></html>`),d.document.close()}catch(y){Ne("failed to prime download window",y)}})(s);let o=null;const i=r("reservations.quote.errors.browserLimit","ØªØ¹Ø°Ø± Ø¥ØªÙ…Ø§Ù… Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ø³Ø¨Ø¨ Ù‚ÙŠÙˆØ¯ Ø§Ù„Ù…ØªØµÙØ­ØŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø£Ùˆ ØªÙ‚Ù„ÙŠÙ„ Ø­Ø¬Ù… Ø§Ù„Ù…Ø­ØªÙˆÙ‰.");try{await Wa(),kt("html2pdf ensured");const d=p.context||"reservation";try{const{sequence:w,quoteNumber:v}=await Xa(d);p.quoteSequence=w,p.quoteNumber=v,p.sequenceCommitted=!0}catch(w){Ne("failed to reserve sequence at export time, proceeding with preview number",w)}const y=zn({context:d,reservation:p.reservation,customer:p.customer,project:p.project,crewAssignments:p.crewAssignments,totals:p.totals,totalsDisplay:p.totalsDisplay,rentalDays:p.rentalDays,currencyLabel:p.currencyLabel,sections:p.sections,fieldSelections:p.fields,quoteNumber:p.quoteNumber,quoteDate:p.quoteDateLabel,terms:p.terms,projectCrew:p.projectCrew,projectExpenses:p.projectExpenses,projectEquipment:p.projectEquipment,projectInfo:p.projectInfo,clientInfo:p.clientInfo,paymentSummary:p.paymentSummary,projectTotals:p.projectTotals});o=document.createElement("div"),o.innerHTML=y,Object.assign(o.style,{position:"fixed",top:"0",left:"0",pointerEvents:"none",zIndex:"-1"}),document.body.appendChild(o),mn(o),fn(o),yn(o),kt("export container prepared");const b=o.firstElementChild;if(b){b.setAttribute("dir","rtl"),b.style.direction="rtl",b.style.textAlign="right",b.setAttribute("data-theme","light"),b.classList.remove("dark","dark-mode"),b.style.margin="0",b.style.padding="0",b.style.width="210mm",b.style.maxWidth="210mm",b.style.marginLeft="auto",b.style.marginRight="auto",b.scrollTop=0,b.scrollLeft=0;try{await ht(b,{context:"export"}),await Wn(120),Gn(b)&&await ht(b,{context:"export"}),await ot(b),zt(b),kt("layout complete for export document")}catch(w){It(w,"layoutQuoteDocument",{suppressToast:!0})}}const $=`quotation-${p.quoteNumber}.pdf`;await ms(b,{filename:$,safariWindowRef:s,mobileWindowRef:a})}catch(d){Dt({container:o,safariWindowRef:s,mobileWindowRef:a}),o=null,It(d,"exportQuoteAsPdf",{toastMessage:i})}finally{o&&o.parentNode&&o.parentNode.removeChild(o),at()}}function ea(){const e=hs();e?.modal&&(nt=!1,Te=1,q&&(q.userAdjustedZoom=!1),gt(Te,{silent:!0}),Xn(),Yn(),Vt(),Re(),$a(e.modal))}async function $s({reservation:e,customer:t,project:n}){if(!e){jt(r("reservations.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø²"));return}await Vn();const a=Ut(e),{totalsDisplay:s,totals:u,rentalDays:o}=Qn(e,a,n),i=r("reservations.create.summary.currency","SR"),{sequence:d,quoteNumber:y}=await Rn("reservation"),b=new Date,$=ha();p={context:"reservation",reservation:e,customer:t,project:n,crewAssignments:a,totals:u,totalsDisplay:s,rentalDays:o,currencyLabel:i,projectCrew:[],projectExpenses:[],projectEquipment:[],sections:new Set(St("reservation").filter(w=>w.defaultSelected).map(w=>w.id)),sectionExpansions:Ot("reservation"),fields:At("reservation"),terms:$,quoteSequence:d,quoteNumber:y,quoteDate:b,quoteDateLabel:Hn(b),sequenceCommitted:!1},Kn(p),ea();try{Tn()}catch{}}async function Ts({project:e}){if(!e){jt(r("projects.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"));return}await Vn();let t=sn(e);const{project:n}=t;if(!n){jt(r("projects.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"));return}try{(!Array.isArray(t.equipmentItems)||t.equipmentItems.length===0)&&n?.id!=null&&(await sa({project_id:n.id}),t=sn(n))}catch(i){console.warn("[reservationPdf] refreshReservationsForProject failed, proceeding with snapshot/state",i)}const{sequence:a,quoteNumber:s}=await Rn("project"),u=new Date,o=[...ba];p={context:"project",reservation:null,customer:t.customer,project:n,technicians:t.crew||[],clientInfo:t.clientInfo,projectInfo:t.projectInfo,projectCrew:t.crew,projectExpenses:t.expenses,projectEquipment:t.equipment,equipmentItems:t.equipmentItems||[],crewAssignments:t.crewAssignments||[],totals:t.totals,projectTotals:t.projectTotals,totalsDisplay:t.totalsDisplay,rentalDays:t.projectDurationDays,currencyLabel:t.currencyLabel,sections:new Set(St("project").filter(i=>i.defaultSelected).map(i=>i.id)),sectionExpansions:Ot("project"),fields:At("project"),terms:o,quoteSequence:a,quoteNumber:s,quoteDate:u,quoteDateLabel:Hn(u),sequenceCommitted:!1,paymentSummary:t.paymentSummary,projectNotes:t.notes,paymentHistory:t.paymentHistory},Kn(p),ea();try{Tn()}catch{}}export{$s as a,Ts as e,ks as g,bn as r,js as s};
