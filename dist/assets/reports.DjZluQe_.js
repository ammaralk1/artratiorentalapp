const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./pdfPages.DrTWAVsk.js","./calculations.BWHtFzv-.js","./reservationsService.CU7qTLqY.js","./auth.Bt1KphMA.js","./auth.DsXbKPFF.css","./state.CY6GwEtX.js","./quotePdf.DE3PwiuQ.js","./canvasColorUtils.CviLtv6S.js","./a4Unified.DMBJiNK1.js","./preview.BnP90UHF.js"])))=>i.map(i=>d[i]);
import{_ as J}from"./uiBridge.CMaEDZm-.js";import{r as n,b as xt,d as Rt,t as c,f as rt,g as E,h as g,c as R,i as ft,j as Bt,p as kt,k as pt,a as qt,m as Nt,n as Ft,o as _t,q as Ht,s as jt,u as zt,v as Ot,w as Ut,x as Gt,y as Vt,z as Wt,A as Yt,B as Kt,C as Jt,D as Qt,E as Xt,F as Zt,G as te,H as ee,I as ne,J as yt}from"./calculations.BWHtFzv-.js";import{d as re,b as j,A as ae,n as Z,p as se}from"./auth.Bt1KphMA.js";import{M as oe,m as ie}from"./reservationsService.CU7qTLqY.js";import{m as St}from"./state.CY6GwEtX.js";import{mapMaintenanceFromApi as Et}from"./maintenanceService.qEZY7V3Y.js";import"./canvasColorUtils.CviLtv6S.js";function Ct(t={}){return{id:t?.id!=null?String(t.id):"",customerName:t?.full_name??t?.customerName??t?.name??"",companyName:t?.company??t?.company_name??t?.companyName??"",phone:t?.phone??""}}function $t(t={}){const e=String(t?.barcode??"").trim(),r=t?.description??t?.name??"";return{id:t?.id!=null?String(t.id):"",barcode:e,desc:r,description:r,name:t?.name??r,category:t?.category??"",subcategory:t?.subcategory??"",status:t?.status??"",price:Number.parseFloat(t?.unit_price??t?.price??0)||0}}function wt(t={}){const e=t?.title??t?.name??"",r=t?.project_code??t?.projectCode??"",s=t?.status??"",a=t?.confirmed===!0;return{id:t?.id!=null?String(t.id):"",title:e,code:r,status:s,confirmed:a}}function ce(){let t;try{t=re()}catch(x){return console.warn("âš ï¸ [reports] Failed to access cached data",x),!1}if(!t||typeof t!="object")return!1;const{reservations:e=[],customers:r=[],equipment:s=[],technicians:a=[],projects:o=[],maintenance:i=[]}=t;if(!(e.length||r.length||s.length||a.length||o.length))return!1;n.data.reservations=Array.isArray(e)?e.map(oe):[],n.data.customers=Array.isArray(r)?r.map(Ct):[],n.data.equipment=Array.isArray(s)?s.map($t):[],n.data.technicians=Array.isArray(a)?a.map(St):[],n.data.projects=Array.isArray(o)?o.map(wt):[],n.data.projectsMap=new Map(n.data.projects.map(x=>[x.id,x])),n.data.maintenance=Array.isArray(i)?i.map(Et):[],n.techniciansIndex=new Map((n.data.technicians||[]).map(x=>[String(x.id),x]));try{xt()}catch{}return!0}async function at({silent:t=!1,force:e=!1,signature:r=null,autoRender:s=!1}={}){if(n.loading){r&&(n.pendingFetchSignature=r,n.pendingFetchForce=e||n.pendingFetchForce);return}const a=Date.now();if(!(!e&&r&&n.lastFetchSignature===r&&a-n.lastFetchAt<1200)){n.loading=!0,n.errorMessage="",t||n.callbacks.onBeforeRender?.();try{const{startDate:o,endDate:i}=Rt(n.filters||{}),u=b=>{if(!b)return null;const w=b.getFullYear(),$=String(b.getMonth()+1).padStart(2,"0"),q=String(b.getDate()).padStart(2,"0");return`${w}-${$}-${q}`},x=u(o),p=u(i),h=200;let y=0,m=[];const d=50;for(let b=0;b<d;b+=1){const w=new URLSearchParams;w.set("limit",String(h)),w.set("offset",String(y)),x&&w.set("start_date",x),p&&w.set("end_date",p);const $=n.filters||{};$?.status&&$.status!=="all"&&w.set("status",String($.status)),$?.search&&w.set("search",String($.search));const q=await j(`/reservations/?${w.toString()}`),D=Array.isArray(q?.data)?q.data:[];if(m=m.concat(D),D.length<h)break;y+=h}const[v,k,C,L,f]=await Promise.all([j("/customers/?limit=500"),j("/equipment/?limit=500"),j("/technicians/?limit=500"),j("/projects/?limit=500"),j("/maintenance/?limit=500")]);n.data.reservations=Array.isArray(m)?m.map(b=>ie(b)):[],n.data.customers=Array.isArray(v?.data)?v.data.map(Ct):[],n.data.equipment=Array.isArray(k?.data)?k.data.map($t):[],n.data.technicians=Array.isArray(C?.data)?C.data.map(St):[],n.data.projects=Array.isArray(L?.data)?L.data.map(wt):[],n.data.projectsMap=new Map(n.data.projects.map(b=>[b.id,b])),n.data.maintenance=Array.isArray(f?.data)?f.data.map(Et):[],n.techniciansIndex=new Map((n.data.technicians||[]).map(b=>[String(b.id),b]));try{xt()}catch{}n.lastFetchSignature=r||null,n.lastFetchAt=Date.now()}catch(o){console.error("âŒ [reports] Failed to load reports data",o),n.errorMessage=o instanceof ae?o.message:c("reservations.reports.error.fetchFailed","ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±ØŒ Ø­Ø§ÙˆÙ„ Ù„Ø§Ø­Ù‚Ø§Ù‹"),(!n.data.projectsMap||!(n.data.projectsMap instanceof Map))&&(n.data.projectsMap=new Map)}finally{if(n.loading=!1,n.pendingFetchSignature){const o=n.pendingFetchSignature,i=n.pendingFetchForce;n.pendingFetchSignature=null,n.pendingFetchForce=!1,setTimeout(()=>{at({silent:!0,force:i,signature:o,autoRender:!0}).catch(u=>{console.error("âŒ [reports] Queued refresh failed",u)})},0)}(!t||s)&&n.callbacks.onAfterRender?.()}}}function H(){const t=document.documentElement;return t.classList.contains("dark")||t.dataset.theme==="dark"?"dark":"light"}function F(t,e){const r=document.getElementById(t);if(r){if(!e||e.length===0){r.innerHTML=`<div class="text-sm text-base-content/60">${c("reservations.reports.progress.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§.","No data to display.")}</div>`;return}r.innerHTML=e.map(s=>{const a=Math.min(Math.max(s.percent??0,0),100),o=c("reservations.reports.progress.meta","{count} Ø­Ø¬Ø²","{count} reservations").replace("{count}",E(s.rawCount??s.value??0)),i=s.className?`reports-progress-fill ${s.className}`:"reports-progress-fill";return`
        <div class="reports-progress-row">
          <div class="reports-progress-top">
            <span>${s.label}</span>
            <span class="reports-progress-value">${E(s.percent??0)}%</span>
          </div>
          <div class="reports-progress-bar">
            <div class="${i}" style="width: ${a}%;"></div>
          </div>
          <div class="reports-progress-meta">${o}</div>
        </div>
      `}).join("")}}function M(t,e){const r=document.querySelector(`[data-chart-loading="${t}"]`);r&&(r.style.display=e?"":"none")}async function le(t){const e=document.getElementById("reports-volume-chart");if(!e)return;const r=Array.isArray(t)?t:[];if(n.lastTrendData=r,M("volume",!0),!r.length){n.charts.trend&&(n.charts.trend.destroy(),n.charts.trend=null),e.innerHTML=`<p class="text-base-content/60 text-sm">${c("reservations.reports.progress.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§.","No data to display.")}</p>`,M("volume",!1);return}try{const s=await rt();if(!s){e.innerHTML=`<p class="text-base-content/60 text-sm">${c("reservations.reports.progress.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§.","No data to display.")}</p>`,M("volume",!1);return}const a=r.map(f=>f.label),o=r.map(f=>Math.round(f.count||0)),i=r.map(f=>Number(f.revenue||0)),u=r.map(f=>Number(f.netProfit||0)),x=r.map(f=>f.movingAvgRevenue!=null?Number(f.movingAvgRevenue):null),p=o.reduce((f,b)=>f+(Number.isFinite(b)?b:0),0),h=i.reduce((f,b)=>f+(Number.isFinite(b)?b:0),0),y=u.reduce((f,b)=>f+(Number.isFinite(b)?b:0),0);if(p===0&&h===0&&y===0){n.charts.trend&&(n.charts.trend.destroy(),n.charts.trend=null),e.innerHTML=`<p class="text-base-content/60 text-sm">${c("reservations.reports.progress.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§.","No data to display.")}</p>`;return}const m=[{name:c("reservations.reports.chart.volume.series.reservations","Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª","Reservations"),type:"column",data:o},{name:c("reservations.reports.chart.volume.series.revenue","Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª (SR)","Revenue (SR)"),type:"line",data:i,yAxisIndex:1},{name:c("reservations.reports.chart.volume.series.net","ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ (SR)","Net profit (SR)"),type:"line",data:u,yAxisIndex:1},{name:c("reservations.reports.chart.volume.series.movingAvg","Ù…ØªÙˆØ³Ø· Ù…ØªØ­Ø±Ùƒ (Ù£ Ø£Ø´Ù‡Ø±)","3-mo Moving Avg"),type:"line",data:x,yAxisIndex:1}],d={chart:{type:"line",height:320,stacked:!1,toolbar:{show:!1},background:"transparent",fontFamily:"Tajawal, sans-serif",animations:{enabled:!0},events:{dataPointSelection:(f,b,w)=>{if(w?.dataPointIndex!=null){const $=n.lastTrendData[w.dataPointIndex];n.callbacks.onTrendDrilldown?.($,w.dataPointIndex)}}}},theme:{mode:H()},stroke:{width:[0,4,4],curve:"smooth"},markers:{size:[0,4,4,0]},colors:["#6366f1","#22c55e","#f97316","#0ea5e9"],dataLabels:{enabled:!1},fill:{type:"solid",opacity:1},stroke:{curve:"smooth",width:[0,2,2,2],dashArray:[0,0,0,6]},xaxis:{categories:a,labels:{style:{colors:H()==="dark"?"#cbd5f5":"#475569"}}},yaxis:[{seriesName:c("reservations.reports.chart.volume.series.reservations","Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª","Reservations"),axisTicks:{show:!0},axisBorder:{show:!0,color:"#6366f1"},labels:{style:{colors:"#6366f1"},formatter:f=>E(f)},title:{text:c("reservations.reports.chart.volume.series.reservations","Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª","Reservations"),style:{color:"#6366f1"}}},{opposite:!0,seriesName:c("reservations.reports.chart.volume.series.revenue","Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª (SR)","Revenue (SR)"),axisTicks:{show:!0},axisBorder:{show:!0,color:"#22c55e"},labels:{style:{colors:"#22c55e"},formatter:f=>g(f)},title:{text:c("reservations.reports.chart.volume.series.revenue","Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª (SR)","Revenue (SR)"),style:{color:"#22c55e"}}}],legend:{position:"bottom"},tooltip:{shared:!0,intersect:!1,custom:({series:f,dataPointIndex:b,w})=>{const $=n.lastTrendData?.[b]||{},q=a?.[b]||"",D=[],G=f?.[0]?.[b];G!=null&&D.push(`<div><span>ğŸ“¦</span> ${E(G)}</div>`);const V=f?.[1]?.[b];if(V!=null){const Y=Number.isFinite($.yoyChange)?`${$.yoyChange>=0?"+":""}${E(Math.round($.yoyChange))}% YoY`:"",st=Number.isFinite($.momChange)?`${$.momChange>=0?"+":""}${E(Math.round($.momChange))}% MoM`:"",tt=[Y,st].filter(Boolean).join(" Â· ");D.push(`<div><span>ğŸ’°</span> ${g(V)}${tt?` <small class="text-base-content/60">(${tt})</small>`:""}</div>`)}const W=f?.[2]?.[b];W!=null&&D.push(`<div><span>ğŸ§®</span> ${g(W)}</div>`);const _=f?.[3]?.[b];return _!=null&&D.push(`<div><span>ğŸ“ˆ</span> ${g(_)}</div>`),`
            <div class="apex-tooltip">
              <div class="mb-1 font-semibold">${q}</div>
              ${D.join("")}
            </div>
          `}}},v=H(),k=String(a.join("|")),C=n.chartsMeta.trend,L=n.charts.trend&&C.theme===v&&C.categoriesSig===k;n.charts.trend&&L?n.charts.trend.updateSeries(m,!0):n.charts.trend?(n.charts.trend.updateOptions({...d},!0,!0),n.charts.trend.updateSeries(m,!0)):(e.innerHTML="",n.charts.trend=new s(e,{...d,series:m}),n.charts.trend.render()),n.chartsMeta.trend={categoriesSig:k,theme:v},M("volume",!1)}catch(s){console.error("âš ï¸ [reports] Failed to render trend chart",s),e.innerHTML=`<p class="text-base-content/60 text-sm">${c("reservations.reports.progress.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§.","No data to display.")}</p>`,M("volume",!1)}}async function de(t){const e=document.getElementById("reports-status-chart"),r="reports-status-breakdown";if(!e)return;const s=Array.isArray(t)?t:[];n.lastStatusData=s,M("status",!0);const a=s.map(i=>Math.max(0,i.value||0)),o=a.reduce((i,u)=>i+u,0);if(!s.length||o===0){n.charts.status&&(n.charts.status.destroy(),n.charts.status=null),F(r,[]),e.innerHTML=`<p class="text-base-content/60 text-sm">${c("reservations.reports.progress.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§.","No data to display.")}</p>`,M("status",!1);return}try{const i=await rt();if(!i){F(r,[]),e.innerHTML=`<p class="text-base-content/60 text-sm">${c("reservations.reports.progress.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§.","No data to display.")}</p>`,M("status",!1);return}const u=s.map(d=>d.label),x={chart:{type:"donut",height:300,fontFamily:"Tajawal, sans-serif",toolbar:{show:!1},background:"transparent",events:{dataPointSelection:(d,v,k)=>{if(k?.dataPointIndex!=null){const C=n.lastStatusData[k.dataPointIndex];C?.filterKey&&n.callbacks.onStatusDrilldown?.(C,k.dataPointIndex)}}}},theme:{mode:H()},labels:u,series:a,colors:["#22c55e","#f97316","#6366f1","#ef4444"],legend:{position:"bottom"},dataLabels:{formatter:d=>`${Math.round(d)}%`},plotOptions:{pie:{donut:{size:"68%",labels:{show:!0,total:{show:!0,label:c("reservations.reports.chart.status.title","ğŸ§¾ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª","Status distribution"),formatter:()=>E(a.reduce((d,v)=>d+v,0))}}}}},tooltip:{y:{formatter:(d,v)=>{const k=n.lastStatusData?.[v?.seriesIndex||0],C=k?`${E(k.percent)}%`:`${E(d)}%`;return`${k?E(k.rawCount??k.value??0):E(d)} / ${C}`}}}},p=H(),h=String(u.join("|")),y=n.chartsMeta.status,m=n.charts.status&&y.theme===p&&y.labelsSig===h;n.charts.status&&m?n.charts.status.updateSeries(a,!0):n.charts.status?(n.charts.status.updateOptions({...x},!0,!0),n.charts.status.updateSeries(a,!0)):(e.innerHTML="",n.charts.status=new i(e,{...x,series:a}),n.charts.status.render()),F(r,s),n.chartsMeta.status={labelsSig:h,theme:p},M("status",!1)}catch(i){console.error("âš ï¸ [reports] Failed to render status chart",i),F(r,[]),e.innerHTML=`<p class="text-base-content/60 text-sm">${c("reservations.reports.progress.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§.","No data to display.")}</p>`,M("status",!1)}}async function ue(t){const e=document.getElementById("reports-payment-chart"),r="reports-payment-breakdown";if(!e)return;const s=Array.isArray(t)?t:[];n.lastPaymentData=s,M("payment",!0);const a=s.map(i=>Math.max(0,i.value||0)),o=a.reduce((i,u)=>i+u,0);if(!s.length||o===0){n.charts.payment&&(n.charts.payment.destroy(),n.charts.payment=null),F(r,[]),e.innerHTML=`<p class="text-base-content/60 text-sm">${c("reservations.reports.progress.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§.","No data to display.")}</p>`,M("payment",!1);return}try{const i=await rt();if(!i){F(r,[]),e.innerHTML=`<p class="text-base-content/60 text-sm">${c("reservations.reports.progress.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§.","No data to display.")}</p>`,M("payment",!1);return}const u=s.map(d=>d.label),x={chart:{type:"pie",height:300,fontFamily:"Tajawal, sans-serif",toolbar:{show:!1},background:"transparent",events:{dataPointSelection:(d,v,k)=>{if(k?.dataPointIndex!=null){const C=n.lastPaymentData[k.dataPointIndex];C?.filterKey&&n.callbacks.onPaymentDrilldown?.(C,k.dataPointIndex)}}}},theme:{mode:H()},labels:u,series:a,colors:["#00ac69","#f59e0b","#f43f5e"],legend:{position:"bottom"},dataLabels:{formatter:d=>`${Math.round(d)}%`},tooltip:{y:{formatter:(d,v)=>{const k=n.lastPaymentData?.[v?.seriesIndex||0],C=k?`${E(k.percent)}%`:`${E(d)}%`;return`${k?E(k.rawCount??k.value??0):E(d)} / ${C}`}}}},p=H(),h=String(u.join("|")),y=n.chartsMeta.payment,m=n.charts.payment&&y.theme===p&&y.labelsSig===h;n.charts.payment&&m?n.charts.payment.updateSeries(a,!0):n.charts.payment?(n.charts.payment.updateOptions({...x},!0,!0),n.charts.payment.updateSeries(a,!0)):(e.innerHTML="",n.charts.payment=new i(e,{...x,series:a}),n.charts.payment.render()),F(r,s),n.chartsMeta.payment={labelsSig:h,theme:p},M("payment",!1)}catch(i){console.error("âš ï¸ [reports] Failed to render payment chart",i),F(r,[]),e.innerHTML=`<p class="text-base-content/60 text-sm">${c("reservations.reports.progress.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§.","No data to display.")}</p>`,M("payment",!1)}}async function pe(t){const e=document.getElementById("reports-status-stacked-chart");if(!e)return;const r=Array.isArray(t)?t:[];if(!r.length){e.innerHTML=`<p class="text-base-content/60 text-sm">${c("reservations.reports.progress.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§.","No data to display.")}</p>`;return}try{const s=await rt(),a=r.map(h=>h.label),o=r.map(h=>h.confirmed||0),i=r.map(h=>h.cancelled||0),u=[{name:c("reservations.reports.status.confirmedLabel","Ù…Ø¤ÙƒØ¯Ø©","Confirmed"),data:o},{name:c("reservations.reports.status.cancelledLabel","Ù…Ù„ØºØ§Ø©","Cancelled"),data:i}],x={chart:{type:"bar",height:320,stacked:!0,toolbar:{show:!1}},series:u,xaxis:{categories:a},plotOptions:{bar:{columnWidth:"55%",borderRadius:6}},colors:["#22c55e","#ef4444"],dataLabels:{enabled:!1},legend:{position:"bottom"}};e.innerHTML="",new s(e,x).render()}catch(s){console.error("[reports] failed to render stacked status chart",s)}}function me(t){const e=document.getElementById("reports-kpi-total"),r=document.getElementById("reports-kpi-total-meta"),s=document.getElementById("reports-kpi-revenue"),a=document.getElementById("reports-kpi-revenue-meta"),o=document.getElementById("reservations-revenue-breakdown"),i=document.getElementById("reports-kpi-outstanding"),u=document.getElementById("reports-kpi-outstanding-meta"),x=document.getElementById("reports-kpi-crew-cost"),p=document.getElementById("reports-kpi-crew-cost-meta"),h=document.getElementById("reports-kpi-equipment-cost"),y=document.getElementById("reports-kpi-equipment-cost-meta"),m=document.getElementById("reports-kpi-margin"),d=document.getElementById("reports-kpi-margin-meta"),v=document.getElementById("reports-kpi-net"),k=document.getElementById("reports-kpi-net-meta"),C=t.total||0,L=t.cancelled||0;t.activeTotal!=null?t.activeTotal:Math.max(0,C-L);const f=t.revenue||0;t.confirmed;const b=t.paidCount||0,w=t.unpaidCount||Math.max(0,(t.activeTotal||0)-b);t.average;const $=t.companyShareTotal||0,q=t.taxTotal||0,D=t.crewTotal||0,G=t.crewCostTotal||0,V=t.equipmentTotal||0,W=t.equipmentCostTotal||0,_=t.netProfit||0,Y=t.maintenanceExpense||0,st=f>0?Math.round(_/f*100):0,tt=t.outstandingTotal||0;if(e&&(e.textContent=E(C)),r){const T=c("reservations.reports.kpi.total.dynamicMeta","Ù…Ù†Ù‡Ø§ {count} Ù…ØºÙ„Ù‚Ø©","Includes {count} closed").replace("{count}",E(t.completed||0)),K=L>0?" "+c("reservations.reports.kpi.total.cancelledPart","â€¢ {count} Ù…Ù„ØºØ§Ø©","â€¢ {count} cancelled").replace("{count}",E(L)):"";r.textContent=T+K}if(s&&(s.textContent=g(f)),a)if(C===0)a.textContent=c("reservations.reports.progress.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§.","No data to display.");else{const K=c("reservations.reports.kpi.revenue.metaLite","Ù†Ø³Ø¨Ø© Ø§Ù„Ø´Ø±ÙƒØ© {share}","Company share {share}").replace("{share}",g($));a.textContent=K}if(o)if(f>0){const T=[{label:c("reservations.reports.kpi.revenue.details.gross","Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯ Ø§Ù„ÙƒÙ„ÙŠ","Gross revenue"),value:g(f),hint:c("reservations.reports.kpi.revenue.details.grossHint","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª (Ù‚Ø¨Ù„ Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª)","Total bookings value (before discounts)")},{label:c("reservations.reports.kpi.revenue.details.discount","Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª","Discounts"),value:t.discountTotal>0?`âˆ’${g(t.discountTotal)}`:g(0),hint:c("reservations.reports.kpi.revenue.details.discountHint","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø·Ø¨Ù‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù…Ø¤ÙƒØ¯Ø©","Sum of discounts applied to confirmed reservations")},{label:c("reservations.reports.kpi.revenue.details.share","Ù†Ø³Ø¨Ø© Ø§Ù„Ø´Ø±ÙƒØ©","Company share"),value:g($),hint:c("reservations.reports.kpi.revenue.details.shareHint","ØªÙØ­Ø³Ø¨ Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…ØŒ ÙˆØªÙØ¶Ø§Ù Ù„Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ","Applied after discount and added to total")},{label:c("reservations.reports.kpi.revenue.details.tax","Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©","Tax"),value:g(q),hint:c("reservations.reports.kpi.revenue.details.taxHint","Ø¶Ø±ÙŠØ¨Ø© 15% Ø¹Ù„Ù‰ (Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ… + Ù†Ø³Ø¨Ø© Ø§Ù„Ø´Ø±ÙƒØ©)","15% VAT on (after-discount total + company share)")},{label:c("reservations.reports.kpi.revenue.details.crewGross","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ø§Ù‚Ù…","Crew total"),value:g(D),hint:c("reservations.reports.kpi.revenue.details.crewGrossHint","Ù‚ÙŠÙ…Ø© Ø§Ù„Ø·Ø§Ù‚Ù… Ù„Ù„Ø¹Ù…ÙŠÙ„","Crew price billed to client")},{label:c("reservations.reports.kpi.revenue.details.crew","ØªÙƒÙ„ÙØ© Ø§Ù„Ø·Ø§Ù‚Ù…","Crew cost"),value:g(G),hint:c("reservations.reports.kpi.revenue.details.crewHint","ØªÙƒÙ„ÙØ© Ø§Ù„Ø·Ø§Ù‚Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙƒØ©","Crew cost to company")},{label:c("reservations.reports.kpi.revenue.details.equipmentGross","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª","Equipment total"),value:g(V),hint:c("reservations.reports.kpi.revenue.details.equipmentGrossHint","Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª Ù„Ù„Ø¹Ù…ÙŠÙ„","Equipment price billed to client")},{label:c("reservations.reports.kpi.revenue.details.equipment","ØªÙƒÙ„ÙØ© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª","Equipment cost"),value:g(W),hint:c("reservations.reports.kpi.revenue.details.equipmentHint","ØªÙƒÙ„ÙØ© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙƒØ©","Equipment cost to company")}];Y>0&&T.push({label:c("reservations.reports.kpi.revenue.details.maintenance","Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„ØµÙŠØ§Ù†Ø©","Maintenance expenses"),value:`âˆ’${g(Y)}`}),T.push({label:c("reservations.reports.kpi.revenue.details.net","ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­","Net profit"),value:g(_)}),o.innerHTML=T.map(({label:K,value:Pt,hint:Dt})=>`
          <div class="reports-kpi-detail-row" title="${Dt||""}">
            <span class="reports-kpi-detail-label">${K}</span>
            <span class="reports-kpi-detail-value">${Pt}</span>
          </div>
        `).join(""),o.classList.remove("hidden")}else o.innerHTML="",o.classList.add("hidden");if(i&&(i.textContent=g(tt)),u){const T=c("reservations.reports.kpi.outstanding.meta","{count} Ø­Ø¬Ø² ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹/Ø¬Ø²Ø¦ÙŠØ§Ù‹","{count} unpaid/partial reservations").replace("{count}",E(w));u.textContent=T}if(x&&(x.textContent=g(G)),p){const T=c("reservations.reports.kpi.crewCost.meta","Ø§Ù„Ù…ÙÙˆØªØ±Ø© {billable}","Billed {billable}").replace("{billable}",g(D));p.textContent=T}if(h&&(h.textContent=g(W)),y){const T=c("reservations.reports.kpi.equipmentCost.meta","Ø§Ù„Ù…ÙÙˆØªØ±Ø© {billable}","Billed {billable}").replace("{billable}",g(V));y.textContent=T}if(m&&(m.textContent=`${st}%`),d){const T=c("reservations.reports.kpi.margin.meta","ØµØ§ÙÙŠ {net} / Ø¥ÙŠØ±Ø§Ø¯Ø§Øª {rev}","Net {net} / Revenue {rev}").replace("{net}",g(_)).replace("{rev}",g(f));d.textContent=T}if(v&&(v.textContent=g(_)),k){const T=c("reservations.reports.kpi.net.meta","Ø¨Ø¹Ø¯ Ø§Ù„ØµÙŠØ§Ù†Ø© âˆ’ {maint}","After maintenance âˆ’ {maint}").replace("{maint}",g(Y));k.textContent=T}}function A(t=""){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function U(t=""){return String(t).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function he(t,e,r){const s=document.getElementById("reports-reservations-body");if(!s)return[];const a=(Array.isArray(t)?t:[]).filter(d=>nt(d)?.confirmed);if(a.length===0)return s.innerHTML=`<tr><td colspan="8" class="text-base-content/60">${c("reservations.reports.table.emptyPeriod","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©.","No data for this period.")}</td></tr>`,[];const o=new Map((e||[]).map(d=>[String(d.id),d]));new Map((r||[]).map(d=>[String(d.id),d]));const i={code:c("reservations.reports.results.headers.id","Ø§Ù„Ø­Ø¬Ø²","Reservation"),customer:c("reservations.reports.results.headers.customer","Ø§Ù„Ø¹Ù…ÙŠÙ„","Customer"),company:c("reservations.reports.results.headers.company","Ø§Ù„Ø´Ø±ÙƒØ©","Company"),phone:c("reservations.reports.results.headers.phone","Ø§Ù„Ù‡Ø§ØªÙ","Phone"),date:c("reservations.reports.results.headers.date","Ø§Ù„ØªØ§Ø±ÙŠØ®","Date"),status:c("reservations.reports.results.headers.status","Ø§Ù„Ø­Ø§Ù„Ø©","Status"),payment:c("reservations.reports.results.headers.payment","Ø§Ù„Ø¯ÙØ¹","Payment"),paymentsCount:c("reservations.reports.results.headers.paymentsCount","Ø¹Ø¯Ø¯ Ø§Ù„Ø¯ÙØ¹Ø§Øª","Payments count"),days:c("reservations.reports.results.headers.days","Ø§Ù„Ø£ÙŠØ§Ù…","Days"),equipment:c("reservations.reports.results.headers.equipment","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª","Equipment"),crewGross:c("reservations.reports.results.headers.crewGross","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ø§Ù‚Ù…","Crew total"),crewCost:c("reservations.reports.results.headers.crewCost","ØªÙƒÙ„ÙØ© Ø§Ù„Ø·Ø§Ù‚Ù…","Crew cost"),equipmentCost:c("reservations.reports.results.headers.equipmentCost","ØªÙƒÙ„ÙØ© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª","Equipment cost"),discount:c("reservations.reports.results.headers.discount","Ø§Ù„Ø®ØµÙ…","Discount"),tax:c("reservations.reports.results.headers.tax","Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©","Tax"),total:c("reservations.reports.results.headers.total","Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ","Total"),share:c("reservations.reports.results.headers.share","Ù†Ø³Ø¨Ø© Ø§Ù„Ø´Ø±ÙƒØ©","Company share"),sharePercent:c("reservations.reports.results.headers.sharePercent","Ù†Ø³Ø¨Ø© Ø§Ù„Ø´Ø±ÙƒØ© %","Company share %"),shareAmount:c("reservations.reports.results.headers.shareAmount","Ù…Ø¨Ù„Øº Ù†Ø³Ø¨Ø© Ø§Ù„Ø´Ø±ÙƒØ©","Company share amount"),net:c("reservations.reports.results.headers.net","ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­","Net profit")},u=ye([...a]),{page:x,pageSize:p}=n.pagination,h=Math.max(0,(x-1)*p),m=u.slice(h,h+p).map(d=>{const v=be(d,o),k=o.get(String(d?.customerId)),L=(Array.isArray(d.paymentHistory)?d.paymentHistory:Array.isArray(d.payment_history)?d.payment_history:[]).length,f=R(d),b={[i.code]:v.code.text,[i.customer]:v.customer.text,[i.company]:k?.companyName||"",[i.phone]:k?.phone||"",[i.date]:v.date.text,[i.status]:v.status.text,[i.payment]:v.payment.text,[i.paymentsCount]:String(L),[i.days]:String(f.rentalDays??0),[i.equipment]:g(f.equipmentTotal),[i.crewGross]:g(f.crewTotal),[i.crewCost]:g(f.crewCostTotal??0),[i.equipmentCost]:g(f.equipmentCostTotal??0),[i.discount]:g(f.discountAmount??0),[i.tax]:g(f.taxAmount??0),[i.total]:v.total.text,[i.share]:v.share.text,[i.sharePercent]:`${E(f.companySharePercent??0)}%`,[i.shareAmount]:g(f.companyShareAmount??0),[i.net]:v.net.text},w=c("common.placeholder.empty","â€”","â€”");return Object.keys(b).forEach($=>{String(b[$]??"").trim()===""&&(b[$]=w)}),{formatted:v,exportRow:b}});return s.innerHTML=m.map(({formatted:d})=>`
      <tr data-drilldown="reservation" data-search="${U(d.code.text)}">
        <td data-report-column="code">${d.code.html}</td>
        <td data-report-column="customer">${d.customer.html}</td>
        <td data-report-column="date">${d.date.html}</td>
        <td data-report-column="status">${d.status.html}</td>
        <td data-report-column="payment">${d.payment.html}</td>
        <td data-report-column="total">${d.total.html}</td>
        <td data-report-column="share">${d.share.html}</td>
        <td data-report-column="equipmentCost">${d.equipmentCost.html}</td>
        <td data-report-column="net">${d.net.html}</td>
      </tr>
    `).join(""),ve(u.length),fe(),m.map(({exportRow:d})=>d)}function fe(){const t=document.querySelector("#reports-reservations-table thead");t&&t.querySelectorAll("th.sortable").forEach(e=>{e.dataset.sortBound!=="true"&&(e.addEventListener("click",()=>{const r=e.dataset.sortKey;r&&(n.sort.key===r?n.sort.dir=n.sort.dir==="asc"?"desc":"asc":(n.sort.key=r,n.sort.dir="asc"),n.pagination.page=1,n.callbacks.onRender?.())}),e.dataset.sortBound="true")})}function ye(t){const{key:e,dir:r}=n.sort||{key:"date",dir:"desc"},s=r==="asc"?1:-1;return t.sort((a,o)=>s*ge(a,o,e))}function ge(t,e,r){switch(r){case"code":return String(t?.reservationId??t?.id??"").localeCompare(String(e?.reservationId??e?.id??""),"ar",{numeric:!0});case"customer":return String(t?.customerName??t?.customerId??"").localeCompare(String(e?.customerName??e?.customerId??""),"ar",{numeric:!0});case"date":return new Date(t?.start||0)-new Date(e?.start||0);case"status":{const s=nt(t)?.statusValue||"",a=nt(e)?.statusValue||"";return String(s).localeCompare(String(a),"ar")}case"total":{const s=R(t)?.finalTotal||0,a=R(e)?.finalTotal||0;return s-a}case"share":{const s=R(t)?.companyShareAmount||0,a=R(e)?.companyShareAmount||0;return s-a}case"equipmentCost":{const s=R(t)?.equipmentCostTotal||0,a=R(e)?.equipmentCostTotal||0;return s-a}case"net":{const s=R(t)?.netProfit||0,a=R(e)?.netProfit||0;return s-a}default:return new Date(t?.start||0)-new Date(e?.start||0)}}function nt(t){if(!t)return ft(t);if(t.__reportsStatusCache)return t.__reportsStatusCache;const e=ft(t);return t.__reportsStatusCache=e,e}function ve(t){const e=document.getElementById("reports-table-pagination");if(!e)return;const{page:r,pageSize:s}=n.pagination,a=Math.max(1,Math.ceil(t/s)),o=r<=1?"disabled":"",i=r>=a?"disabled":"",u=t===0?0:(r-1)*s+1,x=Math.min(r*s,t);if(t<=s){e.innerHTML=`<div class="page-info">${E(u)}â€“${E(x)} / ${E(t)}</div>`;return}e.innerHTML=`
    <div class="pager">
      <button type="button" ${o} data-page="prev">â—€</button>
      <button type="button" ${i} data-page="next">â–¶</button>
    </div>
    <div class="page-info">${E(u)}â€“${E(x)} / ${E(t)}</div>
    <div class="pager page-size">
      <label>${c("reservations.reports.pageSize","Ù„ÙƒÙ„ ØµÙØ­Ø©","Per page")}</label>
      <button type="button" data-size="25">25</button>
      <button type="button" data-size="50">50</button>
      <button type="button" data-size="100">100</button>
    </div>
  `,e.querySelector('[data-page="prev"]')?.addEventListener("click",()=>{n.pagination.page>1&&(n.pagination.page-=1,n.callbacks.onRender?.())}),e.querySelector('[data-page="next"]')?.addEventListener("click",()=>{const p=Math.max(1,Math.ceil(t/n.pagination.pageSize));n.pagination.page<p&&(n.pagination.page+=1,n.callbacks.onRender?.())}),e.querySelectorAll("[data-size]")?.forEach(p=>{p.addEventListener("click",()=>{const h=Number(p.dataset.size);Number.isFinite(h)&&h>0&&(n.pagination.pageSize=h,n.pagination.page=1,n.callbacks.onRender?.())})})}function be(t,e,r){const s=t?.reservationId||t?.id||c("common.placeholder.empty","â€”","â€”"),a=Z(String(s)),i=e.get(String(t?.customerId))?.customerName||c("reservations.reports.topCustomers.unknown","Ø¹Ù…ÙŠÙ„ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ","Unknown customer"),u=nt(t),x=xe(u.statusValue),p=ke(u.statusValue,x),h=Array.isArray(t.paymentHistory)?t.paymentHistory:Array.isArray(t.payment_history)?t.payment_history:[],y=Se(u.paidStatus,h),m=h.length;let d=y.html;if(m>0){const $=c("reservations.paymentHistory.countLabel","{count} Ø¯ÙØ¹Ø©","{count} payments").replace("{count}",E(m));d=`<div class="reports-payment-cell">${y.html}<small class="reports-payment-subtext">${A($)}</small></div>`}const v=Bt(t?.start),k=R(t),C=g(k.finalTotal),L=k.companySharePercent>0?`${E(k.companySharePercent)}% (${g(k.companyShareAmount)})`:c("reservations.reports.results.share.none","Ø¨Ø¯ÙˆÙ† Ù†Ø³Ø¨Ø© Ø§Ù„Ø´Ø±ÙƒØ©","No company share"),f=g(k.netProfit),b=g(k.equipmentCostTotal??0),w=A(i);return{code:{html:A(a),text:a},customer:{html:w,text:i},date:{html:A(v),text:v},status:p,payment:{html:d,text:y.text},total:{html:A(C),text:C},share:{html:A(L),text:L},net:{html:A(f),text:f},equipmentCost:{html:A(b),text:b}}}function xe(t){switch(t){case"completed":return Q(c("reservations.list.status.completed","ğŸ“ Ù…ØºÙ„Ù‚","Closed"));case"confirmed":return Q(c("reservations.list.status.confirmed","âœ… Ù…Ø¤ÙƒØ¯","Confirmed"));case"pending":return Q(c("reservations.list.status.pending","â³ ØºÙŠØ± Ù…Ø¤ÙƒØ¯","Pending"));case"cancelled":return Q(c("reservations.list.status.cancelled","âŒ Ù…Ù„ØºÙŠ","Cancelled"));default:return Z(t||c("common.placeholder.empty","â€”","â€”"))}}function ke(t,e){const r=Q(e);return{html:`<span class="reservation-chip status-${["completed","confirmed","pending","cancelled"].includes(t)?t:"info"}">${A(r)}</span>`,text:r}}function Se(t,e=[]){const r=kt(t),s=String(t??"").toLowerCase(),a=s==="paid"?"paid":s==="partial"?"partial":"unpaid";let o="";const i=c("reservations.create.summary.currency","Ø±ÙŠØ§Ù„","SR");Array.isArray(e)&&e.length&&(o=e.map(p=>{const h=p?.recordedAt?pt(p.recordedAt):c("common.placeholder.empty","â€”","â€”"),y=Number.isFinite(Number(p?.amount))&&Number(p.amount)>0?`${Z(Number(p.amount).toFixed(2))} ${i}`:"",m=Number.isFinite(Number(p?.percentage))&&Number(p.percentage)>0?`${Z(Number(p.percentage).toFixed(2))}%`:"",d=[h];return y&&d.push(y),m&&d.push(m),d.filter(Boolean).join(" â€¢ ")}).join(`
`));const u=o?` title="${U(o)}"`:"";return{html:`<span class="reservation-chip status-${a}"${u}>${A(r)}</span>`,text:r}}function Q(t){return Z(String(t??"")).replace(/^[^A-Za-z0-9\u0600-\u06FF]+/,"").trim()||c("common.placeholder.empty","â€”","â€”")}function At(t){const e=pt(new Date).replace(/-/g,"");return`${c("reservations.reports.export.filePrefix","ØªÙ‚Ø±ÙŠØ±-Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª","reservations-report")}-${e}.${t}`}function Ee(t,e,r){const s=new Blob([t],{type:r}),a=URL.createObjectURL(s),o=document.createElement("a");o.href=a,o.download=e,document.body.appendChild(o),o.click(),document.body.removeChild(o),setTimeout(()=>URL.revokeObjectURL(a),4e3)}function lt(t){if(!t||!t.length)return;const e=Object.keys(t[0]),r=[e.join(",")];t.forEach(a=>{const o=e.map(i=>`"${String(a[i]??"").replace(/"/g,'""')}"`);r.push(o.join(","))});const s=`\uFEFF${r.join(`\r
`)}\r
`;Ee(s,At("csv"),"text/csv;charset=utf-8;")}async function Ce(t){try{const e=await qt();if(!e){lt(t);return}const r=e.utils.json_to_sheet(t),s=e.utils.book_new(),a=c("reservations.reports.export.sheetName","Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª","Reservations");e.utils.book_append_sheet(s,r,a),e.writeFile(s,At("xlsx"))}catch(e){console.error("âš ï¸ [reports] Excel export failed, falling back to CSV",e),lt(t)}}async function $e(t=[],e={}){const{exportReportsPdf:r}=await J(async()=>{const{exportReportsPdf:a}=await import("./pdfPages.DrTWAVsk.js");return{exportReportsPdf:a}},__vite__mapDeps([0,1,2,3,4,5,6,7]),import.meta.url),s=e?.action==="print"?"print":"save";await r(t,{action:s})}async function we(t,e){switch(t){case"pdf":await $e(e);break;case"excel":await Ce(e);break;case"csv":default:lt(e);break}}function Ae(t){const e=document.getElementById("reports-top-customers");if(e){if(!t||t.length===0){e.innerHTML=`<tr><td colspan="3" class="text-base-content/60">${c("reservations.reports.table.emptyPeriod","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©.","No data for this period.")}</td></tr>`;return}e.innerHTML=t.map(r=>`
      <tr class="hover:bg-base-200 cursor-pointer" data-drilldown="customer" data-search="${U(r.name)}">
        <td>${A(r.name)}</td>
        <td>${E(r.count)}</td>
        <td>${g(r.revenue)}</td>
      </tr>
    `).join("")}}function Le(t){const e=document.getElementById("reports-top-equipment");if(e){if(!t||t.length===0){e.innerHTML=`<tr><td colspan="3" class="text-base-content/60">${c("reservations.reports.table.emptyPeriod","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©.","No data for this period.")}</td></tr>`;return}e.innerHTML=t.map(r=>`
      <tr class="hover:bg-base-200 cursor-pointer" data-drilldown="equipment" data-search="${U(r.name)}">
        <td>${A(r.name)}</td>
        <td>${E(r.count)}</td>
        <td>${g(r.revenue)}</td>
      </tr>
    `).join("")}}function Te(t){const e=document.getElementById("reports-equipment-costs");if(e){if(!t||t.length===0){e.innerHTML=`<tr><td colspan="6" class="text-base-content/60">${c("reservations.reports.table.emptyPeriod","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©.","No data for this period.")}</td></tr>`;return}e.innerHTML=t.map(r=>`
      <tr class="hover:bg-base-200">
        <td>${A(r.name)}</td>
        <td>${E(r.quantity)}</td>
        <td>${E(r.days??0)}</td>
        <td>${g(r.billable)}</td>
        <td>${g(r.cost)}</td>
        <td>${g(r.net)}</td>
      </tr>
    `).join("")}}function Me(t){const e=document.getElementById("reports-crew-work");if(e){if(!t||t.length===0){e.innerHTML=`<tr><td colspan="5" class="text-base-content/60">${c("reservations.reports.table.emptyPeriod","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©.","No data for this period.")}</td></tr>`;return}e.innerHTML=t.map(r=>`
      <tr class="hover:bg-base-200 cursor-pointer" data-drilldown="technician" data-search="${U(r.name)}">
        <td>${A(r.name)}</td>
        <td>${E(r.days)}</td>
        <td>${g(r.billable)}</td>
        <td>${g(r.cost)}</td>
        <td>${g(r.billable-r.cost)}</td>
      </tr>
    `).join("")}}function Ie(t){const e=document.getElementById("reports-payment-forecast");if(e){if(!t||t.length===0){e.innerHTML=`<tr><td colspan="3" class="text-base-content/60">${c("reservations.reports.table.emptyPeriod","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©.","No data for this period.")}</td></tr>`;return}e.innerHTML=t.map(r=>`
      <tr>
        <td>${r.date}</td>
        <td>${c("reservations.reports.forecast.count","{count} Ø­Ø¬ÙˆØ²Ø§Øª","{count} reservations").replace("{count}",String(r.count||0))}</td>
        <td>${g(r.amount||0)}</td>
      </tr>
    `).join("")}}function Pe(t){const e=document.getElementById("reports-top-outstanding");if(e){if(!t||t.length===0){e.innerHTML=`<tr><td colspan="3" class="text-base-content/60">${c("reservations.reports.table.emptyPeriod","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©.","No data for this period.")}</td></tr>`;return}e.innerHTML=t.map(r=>`
      <tr class="hover:bg-base-200 cursor-pointer" data-drilldown="reservation" data-search="${U(r.code)}">
        <td>#${A(String(r.code))} â€” ${A(r.customer||"")}</td>
        <td>${A(kt(r.paidStatus))}</td>
        <td>${g(r.outstanding)}</td>
      </tr>
    `).join("")}}function De(t,e=[]){const r=document.getElementById("reports-maintenance-costs");if(!r)return;const s=Array.isArray(t?.items)?t.items:[],a=Array.isArray(e)?e:[];if(!s.length){r.innerHTML=`<tr><td colspan="5" class="text-base-content/60">${c("reservations.reports.table.emptyPeriod","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©.","No data for this period.")}</td></tr>`;return}const o=c("reservations.reports.maintenance.noEquipment","Ù…Ø¹Ø¯Ø© ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ©","Unknown equipment"),i=c("reservations.reports.maintenance.noStatus","ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©","Not specified"),u=p=>{if(!p)return 0;const h=new Date(p).getTime();return Number.isFinite(h)?h:0},x=s.map(p=>{const h=a.find(v=>String(v.id)===String(p.id)),y=h?.equipmentDesc||h?.equipmentBarcode||o,m=h?.statusLabel||h?.status||i,d=h?.equipmentBarcode||"";return{...p,equipment:y,status:m,barcode:d}}).sort((p,h)=>u(h?.date)-u(p?.date));r.innerHTML=x.map(p=>{const h=p?.id!=null?`#${A(String(p.id))}`:c("common.placeholder.empty","â€”","â€”"),y=p?.date?pt(p.date):c("common.placeholder.empty","â€”","â€”"),m=A(p.equipment||o),d=A(p.status||i),v=p.barcode?`<div class="text-xs text-base-content/70">${A(p.barcode)}</div>`:"";return`
        <tr>
          <td>${h}</td>
          <td>${m}${v}</td>
          <td>${d}</td>
          <td>${y}</td>
          <td>${g(p.cost||0)}</td>
        </tr>
      `}).join("")}const S=n.filters;function Re(t){if(n.columnControlsBound)return;const e=document.getElementById("reports-column-controls");e&&(e.querySelectorAll("input[data-column-toggle]").forEach(r=>{const s=r.dataset.columnToggle;s&&(r.checked=n.columnPreferences[s]!==!1,r.addEventListener("change",()=>{n.columnPreferences[s]=r.checked,t()}))}),n.columnControlsBound=!0,t())}function Lt(){Object.entries(n.columnPreferences).forEach(([t,e])=>{document.querySelectorAll(`[data-report-column="${t}"]`).forEach(r=>{r.classList.toggle("hidden",!e)})})}function Be(t){if(n.exportHandlersBound)return;const e=document.querySelectorAll("[data-export]");e.length&&(e.forEach(r=>{r.addEventListener("click",async()=>{const{export:s=""}=r.dataset;if(s){r.disabled=!0;try{await t(s)}catch(a){console.error("âš ï¸ [reports] export failed",a)}finally{r.disabled=!1}}})}),n.exportHandlersBound=!0)}function qe(t,e){n.searchDebounceTimer&&(clearTimeout(n.searchDebounceTimer),n.searchDebounceTimer=null),n.searchDebounceTimer=setTimeout(()=>{S.search=t||"",e()},220)}function Ne(t,e){t&&(S.range="custom",S.start=t.startInput||null,S.end=t.endInput||null,e())}function Fe(t,e){t&&(S.status=S.status===t?"all":t,e())}function _e(t,e){t&&(S.payment=S.payment===t?"all":t,e())}function He(t,e){t&&(S.search=t,e())}function je({onClear:t}={}){const e=document.getElementById("reservations-active-filters");if(!e)return;const r=[],s=(a,o,i)=>{r.push(`<span class="filter-chip" data-chip="${a}">${o} <button type="button" aria-label="clear" data-clear="${a}">âœ•</button></span>`)};if(S.range&&S.range!=="all"||S.start||S.end){let a="";switch(S.range){case"thisWeek":a=c("reservations.reports.filters.range.thisWeek","Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹","This week");break;case"thisMonth":a=c("reservations.reports.filters.range.thisMonth","Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±","This month");break;case"thisQuarter":a=c("reservations.reports.filters.range.thisQuarter","Ù‡Ø°Ø§ Ø§Ù„Ø±Ø¨Ø¹","This quarter");break;case"thisYear":a=c("reservations.reports.filters.range.thisYear","Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø§Ù…","This year");break;case"custom":default:a=`${c("reservations.reports.filters.range.custom","Ù…Ø®ØµØµ","Custom")} (${S.start||c("common.placeholder.empty","â€”","â€”")} â†’ ${S.end||c("common.placeholder.empty","â€”","â€”")})`}s("range",a)}if(S.status&&S.status!=="all"){const a=c(`reservations.reports.filters.status.${S.status}`,S.status,S.status);s("status",a)}if(S.payment&&S.payment!=="all"){const a=c(`reservations.reports.filters.payment.${S.payment}`,S.payment,S.payment);s("payment",a)}if(S.share&&S.share!=="all"){const a=c(`reservations.reports.filters.share.${S.share}`,S.share,S.share);s("share",a)}S.search&&S.search.trim().length&&s("search",`ğŸ” ${S.search.trim()}`),e.innerHTML=r.join(""),e.querySelectorAll("[data-clear]").forEach(a=>{a.addEventListener("click",()=>{const o=a.dataset.clear;o&&(o==="range"?(S.range="all",S.start=null,S.end=null):o in S&&(o==="search"?S.search="":S[o]="all"),t?.(o))})})}function ze(t=[],e=[]){const r=document.getElementById("reports-quick-chips");if(!r)return;const s=Array.isArray(t)?t:[],a=Array.isArray(e)?e:[],o=S.status||"all",i=S.payment||"all",u=(m,d,v,k,C)=>`<button type="button" class="${`chip ${C?"chip-active":""}`}" data-quick-${k}="${m}" title="${d}">${d} <span class="chip-count">${v}</span></button>`,x=(m,d)=>m.find(v=>(v.filterKey||"").toLowerCase()===d),p=[];["confirmed","completed"].forEach(m=>{const d=x(s,m)||{label:m,rawCount:0};p.push(u(m,d.label||m,d.rawCount||0,"status",o===m))}),p.push('<span style="padding:0 6px;opacity:.6;">|</span>'),["paid","partial","unpaid"].forEach(m=>{const d=x(a,m)||{label:m,rawCount:0};p.push(u(m,d.label||m,d.rawCount||0,"payment",i===m))}),r.innerHTML=p.join("")}const l=n.filters,Oe=new Set(["all","confirmed","completed"]);function Tt(t){const e=t||"all";return Oe.has(e)?e:"all"}function mt(){l.status=Tt(l.status)}function ht(){const t={range:l.range,status:l.status,payment:l.payment,share:l.share,search:(l.search||"").trim(),start:l.start,end:l.end};return JSON.stringify(t)}function X(){try{const t=document.querySelector(".dashboard-header"),e=Math.max(0,Math.round(t?.getBoundingClientRect()?.height||64));document.documentElement.style.setProperty("--reports-sticky-offset",`${e}px`)}catch{}}const Mt="reports.presets.v1";function et(){try{const t=JSON.parse(localStorage.getItem(Mt)||"[]");return Array.isArray(t)?t:[]}catch{return[]}}function gt(t){try{localStorage.setItem(Mt,JSON.stringify(Array.isArray(t)?t:[]))}catch{}}function Ue(t){if(!t||!t.filters)return;const e=t.filters;l.range=e.range??l.range,l.status=e.status??l.status,l.payment=e.payment??l.payment,l.share=e.share??l.share,l.search=e.search??"",l.start=e.start??null,l.end=e.end??null,B(),P(),I()}function ot(){const t=document.getElementById("reports-preset-select");if(!t)return;const e=et();t.innerHTML='<option value="">â€”</option>'+e.map((r,s)=>`<option value="${s}">${r.name||"Preset"}</option>`).join("")}function Ge(){const t=document.getElementById("reports-preset-select"),e=document.getElementById("reports-preset-save"),r=document.getElementById("reports-preset-delete"),s=document.getElementById("reports-preset-share");!t||t.dataset.bound||(ot(),t.addEventListener("change",()=>{const a=Number(t.value),o=et();Number.isInteger(a)&&a>=0&&a<o.length&&Ue(o[a])}),e?.addEventListener("click",()=>{const a=window.prompt(c("reservations.reports.presets.savePrompt","Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù‚Ø§Ù„Ø¨","Enter preset name"),"Ù‚Ø§Ù„Ø¨");if(!a)return;const o=et(),i={range:l.range,status:l.status,payment:l.payment,share:l.share,search:l.search||"",start:l.start||null,end:l.end||null},u=o.findIndex(x=>(x.name||"").toLowerCase()===a.toLowerCase());u>=0?o[u]={name:a,filters:i}:o.push({name:a,filters:i}),gt(o),ot()}),r?.addEventListener("click",()=>{const a=Number(t.value),o=et();!Number.isInteger(a)||a<0||a>=o.length||window.confirm(c("reservations.reports.presets.deleteConfirm","Ø­Ø°Ù Ø§Ù„Ù‚Ø§Ù„Ø¨ Ø§Ù„Ù…Ø®ØªØ§Ø±ØŸ","Delete selected preset?"))&&(o.splice(a,1),gt(o),ot(),t.value="")}),s?.addEventListener("click",async()=>{try{P(),await new Promise(o=>setTimeout(o,140));const a=window.location.href;await(navigator.clipboard?.writeText?navigator.clipboard.writeText(a):Promise.reject()),console.log("[reports] Link copied")}catch{try{const o=document.createElement("a");o.href=window.location.href,o.target="_blank",document.body.appendChild(o),o.click(),o.remove()}catch{}}}),t.dataset.bound="true")}function vt(){yt(),N(),setTimeout(()=>{yt(),N(),dt(),X()},0),dt(),X()}let it=null,ct=null;function N({refresh:t=!1}={}){it&&clearTimeout(it),it=setTimeout(()=>{if(I(),t){const e=ht();at({silent:!0,signature:e,autoRender:!0}).catch(()=>{})}},140)}function O(){N({refresh:!0})}function dt(t,e){if(!window.flatpickr)return;t&&(n.startDateInputRef=t),e&&(n.endDateInputRef=e);const r=n.startDateInputRef,s=n.endDateInputRef;if(!r&&!s)return;const a=Ve(),o=i=>{const u={dateFormat:"Y-m-d",allowInput:!0,disableMobile:!0,altInput:!1,...i};return a&&(u.locale=a),u};if(n.startDatePicker&&(n.startDatePicker.destroy(),n.startDatePicker=null),n.endDatePicker&&(n.endDatePicker.destroy(),n.endDatePicker=null),r&&(n.startDatePicker=window.flatpickr(r,o({onChange(i,u){l.start=u||null,l.start||l.end?l.range="custom":!l.end&&l.range==="custom"&&(l.range="all"),n.endDatePicker&&(i?.length?n.endDatePicker.set("minDate",i[0]):n.endDatePicker.set("minDate",null)),O()},onValueUpdate(i,u){l.start=u||null,l.start||l.end?l.range="custom":!l.end&&l.range==="custom"&&(l.range="all"),O()}}))),s&&(n.endDatePicker=window.flatpickr(s,o({onChange(i,u){l.end=u||null,l.start||l.end?l.range="custom":!l.start&&l.range==="custom"&&(l.range="all"),n.startDatePicker&&(i?.length?n.startDatePicker.set("maxDate",i[0]):n.startDatePicker.set("maxDate",null)),O()},onValueUpdate(i,u){l.end=u||null,l.start||l.end?l.range="custom":!l.start&&l.range==="custom"&&(l.range="all"),O()}}))),n.startDatePicker&&r){n.startDatePicker.setDate(r.value,!1);const i=n.endDatePicker?.selectedDates?.[0]||n.endDateInputRef?.value;i&&n.startDatePicker.set("maxDate",i)}if(n.endDatePicker&&s){n.endDatePicker.setDate(s.value,!1);const i=n.startDatePicker?.selectedDates?.[0]||n.startDateInputRef?.value;i&&n.endDatePicker.set("minDate",i)}}function Ve(){return(se()||"ar").toLowerCase().startsWith("ar")?window.flatpickr?.l10ns?.ar?"ar":null:window.flatpickr?.l10ns?.en?"en":null}function ut(t,e){t&&(t.classList.add("active"),t.classList.remove("hidden"))}function B(){mt();const t=document.getElementById("reports-range"),e=document.getElementById("reports-status-filter"),r=document.getElementById("reports-payment-filter"),s=document.getElementById("reports-share-filter"),a=document.getElementById("reports-search"),o=document.getElementById("reports-start"),i=document.getElementById("reports-end"),u=document.getElementById("reports-custom-range");t&&t.value!==l.range&&(t.value=l.range),e&&e.value!==l.status&&(e.value=l.status),r&&r.value!==l.payment&&(r.value=l.payment),s&&s.value!==l.share&&(s.value=l.share),a&&a.value!==l.search&&(a.value=l.search||""),o&&o.value!==(l.start||"")&&(o.value=l.start||""),i&&i.value!==(l.end||"")&&(i.value=l.end||""),ut(u)}function We(){try{const t=new URLSearchParams(window.location.search),e=s=>t.get(s),r=s=>s==null||s===""?null:s;l.range=e("range")||l.range,l.status=e("status")||l.status,l.payment=e("payment")||l.payment,l.share=e("share")||l.share,l.search=e("search")||"",l.start=r(e("start")),l.end=r(e("end")),(l.start||l.end)&&(l.range="custom"),mt()}catch{}}function P(){ct&&clearTimeout(ct),ct=setTimeout(()=>{try{const t=new URLSearchParams,e=(a,o,i)=>{o!=null&&o!==""&&o!==i&&t.set(a,o)};e("range",l.range,"all"),e("status",l.status,"all"),e("payment",l.payment,"all"),e("share",l.share,"all"),e("search",l.search,""),e("start",l.start,null),e("end",l.end,null);const r=t.toString(),s=r?`${location.pathname}?${r}`:location.pathname;window.history.replaceState({},"",s)}catch{}},120)}function It({active:t,icon:e,title:r,subtitle:s}){const a=document.getElementById("reports-empty-state");if(!a)return;const o=a.querySelector(".reports-empty-icon"),i=a.querySelector("h4"),u=a.querySelector("p");n.emptyDefaults.icon===null&&o&&(n.emptyDefaults.icon=o.textContent),n.emptyDefaults.title===null&&i&&(n.emptyDefaults.title=i.textContent),n.emptyDefaults.subtitle===null&&u&&(n.emptyDefaults.subtitle=u.textContent),a.classList.toggle("active",!!t),a.classList.toggle("hidden",!t),!(!o||!i||!u)&&(t?(o.textContent=e!==void 0?e:n.emptyDefaults.icon??o.textContent,i.textContent=r!==void 0?r:n.emptyDefaults.title??i.textContent,u.textContent=s!==void 0?s:n.emptyDefaults.subtitle??u.textContent):(o.textContent=n.emptyDefaults.icon??o.textContent,i.textContent=n.emptyDefaults.title??i.textContent,u.textContent=n.emptyDefaults.subtitle??u.textContent))}function Ye(t){It({active:!!t})}function bt(t){const e=document.getElementById("reports-kpi-skeleton"),r=document.getElementById("reservations-reports-kpis"),s=document.getElementById("reports-table-skeleton"),a=document.getElementById("reports-reservations-table"),o=document.getElementById("reservations-revenue-skeleton"),i=document.getElementById("reservations-revenue-breakdown");e&&r&&(e.style.display=t?"":"none",r.style.opacity=t?"0.4":"1"),s&&a&&(s.style.display=t?"":"none",a.style.opacity=t?"0.4":"1"),o&&i&&(o.style.display=t?"":"none",i.style.opacity=t?"0.4":"1")}function Ke(){if(n.drilldownBound)return;const t=document.getElementById("reports-top-customers"),e=document.getElementById("reports-top-equipment"),r=document.getElementById("reports-reservations-body"),s=document.getElementById("reports-quick-chips"),a=o=>{const i=o.target?.closest("[data-drilldown]");if(!i)return;const u=i.dataset.search||"";He(u,()=>{B(),I()})};t?.addEventListener("click",a),e?.addEventListener("click",a),r?.addEventListener("click",a),s?.addEventListener("click",o=>{const i=o.target?.closest("[data-quick-status], [data-quick-payment]");if(i){if(i.hasAttribute("data-quick-status")){const u=i.getAttribute("data-quick-status")||"all";l.status=l.status===u?"all":u}else if(i.hasAttribute("data-quick-payment")){const u=i.getAttribute("data-quick-payment")||"all";l.payment=l.payment===u?"all":u}B(),P(),I()}}),n.drilldownBound=!0}function z(){const t=ht();at({silent:!0,signature:t,autoRender:!0}).catch(e=>{console.error("âŒ [reports] Background refresh failed",e)})}function I(){if(mt(),B(),P(),je({onClear:()=>{B(),P(),I()}}),n.loading){bt(!0);return}if(n.errorMessage){It({active:!0,icon:"âš ï¸",title:n.errorMessage,subtitle:c("reservations.reports.status.retry","Ø¬Ø±Ù‘Ø¨ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø£Ùˆ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©.")});return}bt(!1);const{reservations:t,customers:e,equipment:r,technicians:s,maintenance:a}=n.data,o=Nt(t,l,e,r,s),i=Ft(o),u=_t(a,l),x=Ht(i,u.total),p=jt(o),h=zt(o),y=Ot(o),m=Ut(o),d=Gt(o,e),v=Vt(o,r),k=Wt(o,s),C=Yt(o),L=Kt(o),f=Jt(o,e,5);me(x),le(p),de(h),pe(y),ue(m),ze(h,m),Ae(d),Le(v),Te(C),Pe(f),Me(k),De(u,a);try{Ie(L)}catch{}const b=he(o,e,s);Lt(),Ye(o.length===0),n.lastSnapshot.filtered=o,n.lastSnapshot.metrics=x,n.lastSnapshot.trend=p,n.lastSnapshot.statusBreakdown=h,n.lastSnapshot.paymentBreakdown=m,n.lastSnapshot.tableRows=b,n.lastSnapshot.maintenance=u,n.lastSnapshot.outstanding=f,n.lastSnapshot.crewWork=k,n.lastSnapshot.equipmentCosts=C,n.lastSnapshot.paymentForecast=L}function rn(){if(n.initialized)return;n.initialized=!0;const t=document.getElementById("reports-range"),e=document.getElementById("reports-status-filter"),r=document.getElementById("reports-payment-filter"),s=document.getElementById("reports-share-filter"),a=document.getElementById("reports-start"),o=document.getElementById("reports-end"),i=document.getElementById("reports-custom-range"),u=document.getElementById("reports-search");if(!t)return;We(),B(),X(),ce()&&I(),t.addEventListener("change",()=>{l.range=t.value,ut(i),l.range!=="custom"&&(l.start=null,l.end=null),P(),N({refresh:!0})}),e?.addEventListener("change",()=>{l.status=Tt(e.value),e.value=l.status,P(),N()}),r?.addEventListener("change",()=>{l.payment=r.value,P(),N()}),s?.addEventListener("change",()=>{l.share=s.value,P(),N()}),u?.addEventListener("input",()=>{const y=u.value||"";qe(y,()=>{B(),P(),N()})}),a?.addEventListener("change",()=>{l.start=a.value||null,(l.start||l.end)&&(l.range="custom"),P(),O()}),o?.addEventListener("change",()=>{l.end=o.value||null,(l.start||l.end)&&(l.range="custom"),P(),O()}),dt(a,o),ut(i),Ge(),n.languageListenerAttached||(document.addEventListener("language:changed",vt),document.addEventListener("language:translationsReady",vt),n.languageListenerAttached=!0),n.dataListenersAttached||(document.addEventListener("reservations:changed",z),document.addEventListener("customers:changed",z),document.addEventListener("equipment:changed",z),document.addEventListener("projects:changed",z),document.addEventListener("technicians:updated",z),window.addEventListener("maintenance:updated",z),n.dataListenersAttached=!0),Re?.(Lt),Be(async y=>{const m=n.lastSnapshot.tableRows||[];if(!m.length){console.warn("[reports] No reservation data to export");return}if(y==="pdf")try{const{exportA4ReportPdf:d}=await J(async()=>{const{exportA4ReportPdf:v}=await import("./a4Unified.DMBJiNK1.js");return{exportA4ReportPdf:v}},__vite__mapDeps([8,1,2,3,4,5]),import.meta.url);await d(m,{action:"save",strict:!0});return}catch(d){console.warn("[reports] page-based PDF export failed, falling back to legacy",d)}else if(y==="excel")try{const{exportA4ReportExcel:d}=await J(async()=>{const{exportA4ReportExcel:v}=await import("./a4Unified.DMBJiNK1.js");return{exportA4ReportExcel:v}},__vite__mapDeps([8,1,2,3,4,5]),import.meta.url);await d(m);return}catch(d){console.warn("[reports] A4-based Excel export failed, falling back to legacy",d)}else if(y==="csv")try{const{exportA4ReportCsv:d}=await J(async()=>{const{exportA4ReportCsv:v}=await import("./a4Unified.DMBJiNK1.js");return{exportA4ReportCsv:v}},__vite__mapDeps([8,1,2,3,4,5]),import.meta.url);await d(m);return}catch(d){console.warn("[reports] A4-based CSV export failed, falling back to legacy",d)}await we(y,m)});const p=document.getElementById("reports-preview-pdf");if(p&&!p.dataset.bound&&(p.addEventListener("click",async()=>{try{const y=await J(()=>import("./preview.BnP90UHF.js"),__vite__mapDeps([9,1,2,3,4,5,8]),import.meta.url),m=n.lastSnapshot.tableRows||[];y.openReportsPdfPreview(m)}catch(y){console.error("âš ï¸ [reports] Failed to open PDF preview",y)}}),p.dataset.bound="true"),Ke(),n.themeListenerAttached||(document.addEventListener("theme:changed",()=>{setTimeout(()=>{I(),X()},0)}),n.themeListenerAttached=!0),!n.stickyOffsetListenerAttached){const y=()=>X();window.addEventListener("resize",y),setTimeout(y,100),setTimeout(y,500),n.stickyOffsetListenerAttached=!0}Qt(I),Xt(()=>{I()}),Zt(()=>{I()}),te(y=>{Ne(y,()=>{B(),I()})}),ee(y=>{Fe(y?.filterKey,()=>{B(),I()})}),ne(y=>{_e(y?.filterKey,()=>{B(),I()})});const h=ht();at({signature:h}).catch(y=>{console.error("âŒ [reports] Failed to initialise reports data",y)})}export{rn as initReports,I as renderReports};
