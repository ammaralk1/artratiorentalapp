const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./reservationsUI.DhTbOZvF.js","./auth.DosFGXpu.js","./auth.Db9-ZDk1.css","./details.D3YTmwbp.js","./state.B8nukEs0.js","./reservationsService.CGMlYuIv.js","./uiBridge.CZ52ZDcj.js","./reservationsFilters.I9-AbYg0.js","./view.DsU2yTUC.js","./reservationPdf.DJYiRgD1.js","./quotePdf.WC1ebubv.js","./canvasColorUtils.CviLtv6S.js","./reservationsActions.JNbCxOo6.js","./projectsService.CcNn8Yfo.js"])))=>i.map(i=>d[i]);
import{n as S,d as z,t as m,a as me,c as fe,i as pe,m as ye,l as he,b as nt,A as ge,j as gt,h as at}from"./auth.DosFGXpu.js";import"./dashboard.CKRim6jK.js";import{o as ve}from"./projectDetails.iH38KzV6.js";import{g as be,b as Ee,r as Ae,a as qt,P as Se}from"./projectFocusTemplates.BspTJB-F.js";import{_ as te,s as Ie,b as De}from"./uiBridge.CZ52ZDcj.js";import{r as Bt}from"./reservationsFilters.I9-AbYg0.js";import{d as _e,r as xe,f as bt,m as je}from"./state.B8nukEs0.js";import{getProjectsState as ee,refreshProjectsFromApi as ke,mapProjectFromApi as Be}from"./projectsService.CcNn8Yfo.js";import{g as ne,r as Te,c as zt,m as Ne}from"./reservationsService.CGMlYuIv.js";import{d as Ht,s as Et}from"./view.DsU2yTUC.js";import{i as Ce}from"./dashboardShell.DF2kUed9.js";import{initDashboardMetrics as Pe}from"./dashboardMetrics.pOGXsfxP.js";import"./reservationPdf.DJYiRgD1.js";import"./quotePdf.WC1ebubv.js";import"./canvasColorUtils.CviLtv6S.js";let At={},D={initialized:!1,currentId:null,modal:{el:null,body:null}};function Dt(t=""){return S(String(t)).trim().toLowerCase()}function ae(t,e,n){if(!e||!n)return;const{startDate:a,endDate:r}=Bt(t);e._flatpickr?a?e._flatpickr.setDate(a,!1,"Y-m-d"):e._flatpickr.clear():e.value=a||"",n._flatpickr?r?n._flatpickr.setDate(r,!1,"Y-m-d"):n._flatpickr.clear():n.value=r||""}function Ut(t,{endOfDay:e=!1}={}){if(!t)return null;const n=String(t).trim();if(!n)return null;const a=n.includes("T")?n:`${n}T00:00:00`,r=new Date(a);return Number.isNaN(r.getTime())?null:(e?r.setHours(23,59,59,999):r.setHours(0,0,0,0),r)}function St(t){const e=[t?.start,t?.start_datetime,t?.startDatetime,t?.startDate,t?.createdAt,t?.created_at];for(const n of e){if(!n)continue;const a=new Date(n);if(!Number.isNaN(a.getTime()))return a.setHours(0,0,0,0),a}return null}function vt(t){if(!document.getElementById("customer-reservations"))return;const n=document.getElementById("customer-search-reservation"),a=document.getElementById("customer-filter-start-date"),r=document.getElementById("customer-filter-end-date"),i=document.getElementById("customer-reservation-date-range"),c=document.getElementById("customer-reservation-status-filter"),u=document.getElementById("customer-clear-filters");window.flatpickr&&(a&&window.flatpickr(a,{dateFormat:"Y-m-d"}),r&&window.flatpickr(r,{dateFormat:"Y-m-d"}));const l=()=>{let y=S(a?.value||"").trim(),g=S(r?.value||"").trim(),h=i?.value||"";if(new Set(["","today","week","month"]).has(h)||(h="",i&&(i.value=""),a&&(a._flatpickr&&a._flatpickr.clear(),a.value=""),r&&(r._flatpickr&&r._flatpickr.clear(),r.value=""),y="",g=""),!y&&!g&&h){const{startDate:b,endDate:j}=Bt(h);y=b,g=j}return{searchTerm:Dt(n?.value||""),startDate:y,endDate:g,status:c?.value||"",quickRange:h,customerId:t}},f=()=>{At=l(),Vt("customer-reservations",At)};n&&!n.dataset.listenerAttached&&(n.addEventListener("input",()=>{n.value=S(n.value),f()}),n.dataset.listenerAttached="true"),a&&!a.dataset.listenerAttached&&(a.addEventListener("change",()=>{i&&(i.value=""),f()}),a.dataset.listenerAttached="true"),r&&!r.dataset.listenerAttached&&(r.addEventListener("change",()=>{i&&(i.value=""),f()}),r.dataset.listenerAttached="true"),i&&!i.dataset.listenerAttached&&(i.addEventListener("change",()=>{ae(i.value,a,r),f()}),i.dataset.listenerAttached="true"),c&&!c.dataset.listenerAttached&&(c.addEventListener("change",f),c.dataset.listenerAttached="true"),u&&!u.dataset.listenerAttached&&(u.addEventListener("click",()=>{n&&(n.value=""),a&&(a._flatpickr&&a._flatpickr.clear(),a.value=""),r&&(r._flatpickr&&r._flatpickr.clear(),r.value=""),i&&(i.value=""),c&&(c.value=""),f()}),u.dataset.listenerAttached="true"),window.refreshCustomerReservationsViews=()=>{Vt("customer-reservations",At)},f()}function st(t){D.currentId=t;const{container:e}=J();e&&(D.initialized||(Le(),Re(),Me(),document.addEventListener("projects:changed",()=>{D.currentId&&N()}),document.addEventListener("language:changed",()=>{D.currentId&&N()}),document.addEventListener("technicians:updated",()=>{D.currentId&&N()}),D.initialized=!0),N())}function J(){return{container:document.getElementById("customer-projects"),searchInput:document.getElementById("customer-project-search"),startInput:document.getElementById("customer-project-start-date"),endInput:document.getElementById("customer-project-end-date"),rangeSelect:document.getElementById("customer-project-date-range"),statusSelect:document.getElementById("customer-project-status-filter"),clearBtn:document.getElementById("customer-projects-clear-filters")}}function Le(){const{searchInput:t,statusSelect:e,clearBtn:n,startInput:a,endInput:r,rangeSelect:i}=J();window.flatpickr&&(a&&!a.dataset.datepickerAttached&&(window.flatpickr(a,{dateFormat:"Y-m-d"}),a.dataset.datepickerAttached="true"),r&&!r.dataset.datepickerAttached&&(window.flatpickr(r,{dateFormat:"Y-m-d"}),r.dataset.datepickerAttached="true")),t&&!t.dataset.listenerAttached&&(t.addEventListener("input",()=>{t.value=S(t.value),N()}),t.dataset.listenerAttached="true"),e&&!e.dataset.listenerAttached&&(e.addEventListener("change",()=>{N()}),e.dataset.listenerAttached="true"),a&&!a.dataset.listenerAttached&&(a.addEventListener("change",()=>{a.value=S(a.value),i&&(i.value=""),N()}),a.dataset.listenerAttached="true"),r&&!r.dataset.listenerAttached&&(r.addEventListener("change",()=>{r.value=S(r.value),i&&(i.value=""),N()}),r.dataset.listenerAttached="true"),i&&!i.dataset.listenerAttached&&(i.addEventListener("change",()=>{ae(i.value,a,r),N()}),i.dataset.listenerAttached="true"),n&&!n.dataset.listenerAttached&&(n.addEventListener("click",()=>{const{searchInput:c,statusSelect:u,startInput:l,endInput:f,rangeSelect:y}=J();c&&(c.value=""),u&&(u.value=""),y&&(y.value=""),l&&(l._flatpickr&&l._flatpickr.clear(),l.value=""),f&&(f._flatpickr&&f._flatpickr.clear(),f.value=""),N()}),n.dataset.listenerAttached="true")}function Re(){const{container:t}=J();!t||t.dataset.projectModalListenerAttached==="true"||(t.addEventListener("click",$e),t.dataset.projectModalListenerAttached="true")}function $e(t){const e=t.target.closest(".project-focus-card");if(!e)return;const n=e.dataset.projectId?String(e.dataset.projectId):"";n&&re(n)}function Me(){se()}function se(){if(D.modal?.el&&D.modal?.body)return!0;const t=document.getElementById("projectDetailsModal"),e=document.getElementById("project-details-body");if(!t||!e){const r=document.createElement("div");r.innerHTML=`
      <div class="modal fade" id="projectDetailsModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">${m("projects.details.modalTitle","ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹")}</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="project-details-body"></div>
          </div>
        </div>
      </div>`,document.body.appendChild(r.firstElementChild)}const n=document.getElementById("projectDetailsModal"),a=document.getElementById("project-details-body");return!n||!a?!1:(D.modal={el:n,body:a},!0)}function N(){const{container:t,searchInput:e,statusSelect:n,startInput:a,endInput:r,rangeSelect:i}=J();if(!t||!D.currentId)return;const c=Dt(e?.value||""),u=n?.value||"";let l=S(a?.value||"").trim(),f=S(r?.value||"").trim(),y=i?.value||"";if(new Set(["","today","week","month"]).has(y)||(y="",i&&(i.value=""),a&&(a._flatpickr&&a._flatpickr.clear(),a.value=""),r&&(r._flatpickr&&r._flatpickr.clear(),r.value=""),l="",f=""),!l&&!f&&y){const{startDate:s,endDate:o}=Bt(y);l=s,f=o}const h=Ut(l),v=Ut(f,{endOfDay:!0}),{projects:b=[],technicians:j=[],reservations:k=[],customers:I=[]}=z(),B=new Map(j.map(s=>[String(s.id),s])),_=Fe(k),E=I.find(s=>String(s.id)===String(D.currentId))||null,O=b.filter(s=>String(s.clientId)===String(D.currentId)).filter(s=>{if(c){const o=[s.id,s.projectId,s.project_id,s.projectCode,s.project_code].map(L=>L==null?"":S(String(L)));if(!Dt([s.title,s.description,s.notes,...o].filter(Boolean).join(" ")).includes(c))return!1}if(u&&_e(s)!==u)return!1;if(h||v){const o=St(s);if(!o||h&&o<h||v&&o>v)return!1}return!0}).sort((s,o)=>{const p=St(s)?.getTime()||0;return(St(o)?.getTime()||0)-p});if(!O.length){const s=m("customerProjects.empty",t.dataset.empty||"Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„.");t.innerHTML=`<div class="project-card-grid__item project-card-grid__item--full"><div class="alert alert-info text-center mb-0">${s}</div></div>`;return}t.innerHTML=O.map(s=>{const o=be(s),p=o?_.get(o)||[]:[];return Ee(s,{customer:E,techniciansMap:B,reservations:p})}).join(""),t.querySelectorAll(".project-focus-card").forEach(s=>{s.dataset.customerModalListenerAttached!=="true"&&(s.addEventListener("click",o=>{const p=s.dataset.projectId?String(s.dataset.projectId):"";if(p){try{console.debug("[customer] project card click",p)}catch{}re(p)}}),s.dataset.customerModalListenerAttached="true")})}function Fe(t=[]){const e=new Map;return t.forEach(n=>{const a=n?.projectId??n?.project_id??n?.projectID;if(a==null)return;const r=String(a);e.has(r)||e.set(r,[]),e.get(r).push(n)}),e}function re(t){const e=String(t||"").trim();if(!e||!se())return;const{projects:n=[],reservations:a=[],customers:r=[]}=z(),i=D.modal;Ht.detailsModalEl=i.el,Ht.detailsBody=i.body;const c=ee(),u=ne(),l=Array.isArray(c)?c.some(f=>String(f?.id)===e):!1;Et.projects=Array.isArray(c)&&c.length&&l?c:n||[],Et.reservations=Array.isArray(u)&&u.length?u:a||[],Et.customers=r||[],ve(e);try{if(!(window.bootstrap&&window.bootstrap.Modal)&&D.modal?.el){const f=D.modal.el;f.classList.add("show"),f.style.display="block",f.removeAttribute("aria-hidden")}}catch{}}async function Vt(t,e){try{const n=await te(()=>import("./reservationsUI.DhTbOZvF.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]),import.meta.url);try{n.renderReservations?.(t,e)}catch(a){console.error("âŒ [customer-details] renderReservations failed",a)}}catch(n){console.error("âŒ [customer-details] Failed to load reservations UI module",n)}}me();fe();pe();Ce();ye();const rt=document.getElementById("logout-btn");rt&&!rt.dataset.listenerAttached&&(rt.addEventListener("click",()=>he()),rt.dataset.listenerAttached="true");const we=(()=>{let t=null,e=!1;return()=>(t||(t=te(()=>import("./reservationsUI.DhTbOZvF.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]),import.meta.url).then(n=>{if(!e&&typeof n.registerReservationGlobals=="function")try{n.registerReservationGlobals(),e=!0}catch(a){console.warn("âš ï¸ [customerPage] Failed to register reservation globals",a)}return n})),t)})();function W(t,...e){we().then(n=>{const a=n?.[t];typeof a=="function"?a(...e):console.warn(`âš ï¸ [customerPage] Reservation handler "${t}" is unavailable`)}).catch(n=>{console.error(`âŒ [customerPage] Failed to execute reservation handler "${t}"`,n)})}Ie({showReservationDetails(t){W("showReservationDetails",t)},openReservationEditor(t,e={}){W("openReservationEditor",t,e?.reservation??null)},confirmReservation(t,e){W("confirmReservation",t,e)},deleteReservation(t){W("deleteReservation",t)},reopenReservation(t){W("reopenReservation",t)}});const qe=new URLSearchParams(window.location.search),A=qe.get("id"),q=document.getElementById("customer-details"),Ot=document.getElementById("customer-hero-name"),ze=document.getElementById("customer-hero-phone"),He=document.getElementById("customer-hero-company"),Ue=document.getElementById("customer-hero-email"),Ve=document.getElementById("customer-hero-tax"),Yt=document.getElementById("customer-hero-summary"),Wt=document.getElementById("dashboard-greeting-customer-name"),Gt=document.getElementById("dashboard-greeting-customer-company"),it=document.getElementById("customer-stat-projects"),ot=document.getElementById("customer-stat-projects-desc"),ct=document.getElementById("customer-stat-payment"),lt=document.getElementById("customer-stat-payment-desc"),dt=document.getElementById("customer-stat-upcoming"),ut=document.getElementById("customer-stat-upcoming-desc"),G=document.getElementById("customer-stat-activity"),mt=document.getElementById("customer-stat-activity-desc"),ft=document.getElementById("customer-stat-compliance"),K=document.getElementById("customer-stat-compliance-desc"),Oe=document.getElementById("sidebar-stat-projects"),Ye=document.getElementById("sidebar-stat-reservations"),We=document.getElementById("sidebar-stat-equipment"),Ge=document.getElementById("sidebar-stat-technicians"),Tt=[document.getElementById("customer-edit-btn"),document.getElementById("customer-edit-btn-secondary")].filter(Boolean),_t=Array.from(document.querySelectorAll("[data-customer-tab]")),Ke=new Map(Array.from(document.querySelectorAll("[data-customer-tab-panel]")).map(t=>[t.getAttribute("data-customer-tab-panel"),t])),F=document.getElementById("edit-document-file"),U=document.getElementById("edit-document-preview"),Kt=document.getElementById("edit-document-file-name"),X=document.getElementById("edit-document-url"),Z=document.getElementById("edit-document-name");let x=null,C="idle",R=null;Tt.forEach(t=>{t.disabled=!0});let d=null,Q=!1,$="",Nt="reservations",tt=null,et=null;function T(t=""){const e=document.createElement("div");return e.textContent=t==null?"":String(t),e.innerHTML}function Qe(t=""){const e=T(t).replace(/\r/g,""),n=`
`;return e.includes(n)?e.split(n).join("<br>"):e}function Je(t=null){R=t&&typeof t=="object"?{...t}:null,x=null,C="idle",F&&(F.value=""),H()}function H(){if(!Kt||!U)return;const t=C==="uploading",e=!!x?.dataUrl;let n=m("customers.form.document.empty","Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø¨Ø¹Ø¯");t?n=m("customers.form.document.uploading","ğŸ“¤ Ø¬Ø§Ø±Ù Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù..."):C==="error"?n=m("customers.form.document.uploadFailed","âš ï¸ ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù"):e?n=x?.fileName||m("customers.form.document.selected","ØªÙ… Ø¥Ø±ÙØ§Ù‚ Ù…Ù„Ù."):R&&(R.fileName||R.url)&&(n=R.fileName||R.url),Kt.textContent=n;const a=e||!!R?.url;U.disabled=t||!a}function Xe(){if(!F)return;const[t]=F.files||[];if(!t){C="idle",x=null,H();return}C="uploading",H();const e=new FileReader;e.onload=()=>{if(typeof e.result!="string"){C="error",x=null,H();return}x={dataUrl:e.result,fileName:t.name,mimeType:t.type,size:t.size},X&&(X.value=e.result),Z&&(Z.value=t.name),C="success",H()},e.onerror=()=>{C="error",x=null,H()},e.readAsDataURL(t)}F&&!F.dataset.listenerAttached&&(F.addEventListener("change",Xe),F.dataset.listenerAttached="true");U&&!U.dataset.listenerAttached&&(U.addEventListener("click",()=>{if(C==="uploading")return;const t=x?.dataUrl||R?.url;t&&window.open(t,"_blank","noopener,noreferrer")}),U.dataset.listenerAttached="true");function pt(t,e,n,{hideWhenEmpty:a=!1}={}){if(!t)return;const r=n==null?"":String(n).trim(),i=r.length>0,c=i?r:m("common.placeholder.empty","â€”");t.textContent=`${e} ${c}`,a?t.classList.toggle("hidden",!i):t.classList.remove("hidden")}function xt(t){const e=m("customerDetails.pageTitle","Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„"),n=m("common.placeholder.empty","â€”"),a=t?.customerName||n,r=t?.phone?S(t.phone):"",i=t?.companyName||"",c=t?.email||"",u=t?.tax_id??t?.taxId??"";if(Ot&&(Ot.textContent=a),Yt&&(Yt.textContent=a!==n?a:e),pt(ze,"ğŸ“",r,{hideWhenEmpty:!1}),pt(He,"ğŸ¢",i,{hideWhenEmpty:!0}),pt(Ue,"ğŸ“§",c,{hideWhenEmpty:!0}),pt(Ve,"ğŸ§¾",u,{hideWhenEmpty:!0}),Wt&&(Wt.textContent=a),Gt){const l=[];i&&l.push(i),r&&l.push(`ğŸ“ ${r}`);const f=typeof u=="string"?u.trim():String(u||"").trim();f&&l.push(`ğŸ§¾ ${f}`),Gt.textContent=l.length?l.join(" â€¢ "):"â€”"}}function Ze(t){if(t?.preventDefault?.(),!d)return;hn();const e=document.getElementById("editCustomerModal"),n=typeof bootstrap<"u"?bootstrap.Modal:null;if(!e||!n)return;(n.getInstance(e)||new n(e)).show()}function tn(){Tt.forEach(t=>{!t||t.dataset.listenerAttached||(t.addEventListener("click",Ze),t.dataset.listenerAttached="true")})}function jt(t){Tt.forEach(e=>{e&&(e.disabled=!!t)})}tn();function kt(t){t&&(Nt=t,_t.forEach(e=>{const n=e?.getAttribute("data-customer-tab")===t;e&&(e.classList.toggle("tab-active",n),e.classList.toggle("active",n),e.setAttribute("aria-selected",String(n)))}),Ke.forEach((e,n)=>{e&&e.classList.toggle("hidden",n!==t)}),t==="projects"&&A&&d&&st(A))}function en(){_t.length&&(_t.forEach(t=>{!t||t.dataset.listenerAttached||(t.addEventListener("click",()=>{const e=t.getAttribute("data-customer-tab");e&&kt(e)}),t.dataset.listenerAttached="true")}),kt(Nt))}en();function ie(t={}){if(!t||typeof t!="object")return null;const e=[t.document,t.attachment,t.file].find(_=>_&&typeof _=="object"),n=_=>{for(const E of _)if(typeof E=="string"&&E.trim()!=="")return E.trim();return""},a=_=>{for(const E of _){if(typeof E=="number"&&Number.isFinite(E))return Math.max(0,Math.trunc(E));if(typeof E=="string"&&E.trim()!==""&&/^\d+$/.test(E.trim()))return Math.max(0,parseInt(E.trim(),10))}return null},r=[t.document_url,t.documentUrl,t.url,t.href,t.link,e?.url,e?.href,e?.link],i=[t.document_path,t.documentPath,t.path,e?.path,e?.documentPath],c=[t.document_file_name,t.documentFileName,t.document_name,t.fileName,t.filename,t.name,e?.fileName,e?.filename,e?.name],u=[t.document_mime_type,t.documentMimeType,t.document_type,t.mimeType,t.contentType,t.type,e?.mimeType,e?.contentType,e?.type],l=[t.document_size,t.documentSize,t.size,e?.size,e?.length],f=[e?.data,e?.base64,e?.content,t.data,t.base64,t.content,t.document_data],y=n(r),g=n(c),h=n(u)||"application/octet-stream",v=n(i),b=n(f),j=a(l);if(!y&&!b)return null;let k=y,I=b;if(!k&&I&&I.startsWith("data:")){const _=I.indexOf(",");_!==-1&&(k=I,I=I.slice(_+1))}!k&&I&&(k=`${I.startsWith("data:")?"":`data:${h};base64,`}${I}`);const B={url:k,fileName:g,mimeType:h,path:v,data:I||null,size:j};return B.url&&/sirv\.com/i.test(B.url)&&(B.source="sirv"),B}function nn(){return document.documentElement.getAttribute("lang")||"ar"}function P(t){const e=Number(t)||0;try{return new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(e)}catch{return String(e)}}function Qt(t){if(!t)return"â€”";const e=t instanceof Date?t:new Date(t);if(Number.isNaN(e.getTime()))return"â€”";const a=nn()==="ar"?"ar-SA-u-ca-gregory-nu-latn":"en-US";try{return new Intl.DateTimeFormat(a,{dateStyle:"medium"}).format(e)}catch{const i=String(e.getMonth()+1).padStart(2,"0"),c=String(e.getDate()).padStart(2,"0"),u=e.getFullYear();return`${i}/${c}/${u}`}}function Jt(t){if(!t)return"";const e=t.trim().split(/\s+/),n=e.pop()||"";return`<span class="currency-amount">${e.join(" ")}</span> <span class="currency-unit currency-unit--sm">${n}</span>`}function Xt(t,e){const n=m("customerDetails.stats.paymentPaid","Ø§Ù„Ù…Ø¯ÙÙˆØ¹"),a=m("customerDetails.stats.paymentOutstandingLabel","Ø§Ù„Ù…Ø³ØªØ­Ù‚");return`
    <div class="payment-line payment-line--paid">
      <span class="payment-line-label">${n}</span>
      ${Jt(t)}
    </div>
    <div class="payment-line payment-line--outstanding">
      <span class="payment-line-label">${a}</span>
      ${Jt(e)}
    </div>
  `}const Zt={excellent:"Excellent commitment",good:"On-time payments",average:"Needs follow-up",poor:"Repeated delays"},an={reservation:"Reservation",project:"Project",customer:"Client record"};function It(t=[]){let e=null;return t.forEach(n=>{if(!n)return;const a=n instanceof Date?n:new Date(n);Number.isNaN(a.getTime())||(!e||a>e)&&(e=a)}),e}function sn(t=""){return String(t).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;")}function rn(t){if(!t||typeof t!="object")return null;const e=n=>{const a=Number.parseInt(String(n??"0"),10);return Number.isFinite(a)?a:0};return{projects:e(t?.projects?.total),reservations:e(t?.reservations?.total),equipment:e(t?.equipment?.total),technicians:e(t?.technicians?.total)}}function oe(){const t=z();return{projects:Array.isArray(t.projects)?t.projects.length:0,reservations:Array.isArray(t.reservations)?t.reservations.length:0,equipment:Array.isArray(t.equipment)?t.equipment.length:0,technicians:Array.isArray(t.technicians)?t.technicians.length:0}}function yt(t,e,n){let a=document.getElementById(t);if(a)return a;let r=document.getElementById("dashboard-sidebar");r||(r=document.createElement("aside"),r.id="dashboard-sidebar",r.className="sidebar-shell sidebar-drawer",(document.body||document.documentElement).prepend(r));let i=r.querySelector(".sidebar-panel--stats");i||(i=document.createElement("div"),i.className="sidebar-panel sidebar-panel--stats",i.innerHTML=`
      <h3 class="sidebar-heading">${m?.("dashboard.sidebar.statsHeading","Ù…Ù„Ø®Øµ Ø§Ù„ÙŠÙˆÙ…")}</h3>
      <div class="sidebar-stats" role="list"></div>
    `,r.prepend(i));let c=i.querySelector(".sidebar-stats");c||(c=document.createElement("div"),c.className="sidebar-stats",c.setAttribute("role","list"),i.appendChild(c));const u=document.createElement("div");u.className="sidebar-stats-row",u.setAttribute("role","listitem");const l=m?.(e,n)??n??"";return u.innerHTML=`<span>${l}</span><span id="${t}" class="badge-soft">0</span>`,c.appendChild(u),a=u.querySelector(`#${t}`),a}function V(t={}){const e=oe(),n={projects:t.projects??e.projects,reservations:t.reservations??e.reservations,equipment:t.equipment??e.equipment,technicians:t.technicians??e.technicians},a={projects:Oe||yt("sidebar-stat-projects","dashboard.metrics.projects.label","Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹"),reservations:Ye||yt("sidebar-stat-reservations","dashboard.metrics.reservations.label","Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª"),equipment:We||yt("sidebar-stat-equipment","dashboard.metrics.equipment.label","Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"),technicians:Ge||yt("sidebar-stat-technicians","dashboard.metrics.technicians.label","Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„")};a.projects&&(a.projects.textContent=P(n.projects)),a.reservations&&(a.reservations.textContent=P(n.reservations)),a.equipment&&(a.equipment.textContent=P(n.equipment)),a.technicians&&(a.technicians.textContent=P(n.technicians));try{window.__CUSTOMER_STATS__={...n}}catch{}}function Ct(){const t=A??d?.id;if(t==null)return[];const e=Array.isArray(tt)?tt:ne();return(Array.isArray(e)?e:[]).filter(a=>a?[a.customerId,a.customer_id,a.customer?.id].some(i=>i!=null&&String(i)===String(t)):!1)}function Pt(){const t=A??d?.id;if(t==null)return[];const e=Array.isArray(et)?et:ee();return(Array.isArray(e)?e:[]).filter(a=>a?[a.clientId,a.client_id,a.customer_id].some(i=>i!=null&&String(i)===String(t)):!1)}function on(){const t=Ct(),e=Pt(),n=t.reduce((r,i)=>Array.isArray(i?.items)?r+i.items.length:r,0),a=new Set;return t.forEach(r=>{Array.isArray(r?.technicians)&&r.technicians.forEach(i=>{i!=null&&a.add(String(i))}),Array.isArray(r?.techniciansDetails)&&r.techniciansDetails.forEach(i=>{const c=i?.id??i?.technician_id??i?.technicianId;c!=null&&a.add(String(c))})}),{projects:e.length,reservations:t.length,equipment:n,technicians:a.size}}function w(){if(!d||!A){const s=bt(0);if(it&&(it.textContent="0"),ot&&(ot.textContent=m("customerDetails.stats.projectsEmpty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„.")),ct&&(ct.innerHTML=Xt(s,s)),lt){const o=m("customerDetails.stats.paymentBreakdown","Ù…Ø¯ÙÙˆØ¹ / Ù…Ø³ØªØ­Ù‚"),p=m("customerDetails.stats.paymentOutstandingEmpty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨Ø§Ù„Øº Ù…Ø³ØªØ­Ù‚Ø©");lt.textContent=`${o} â€¢ ${p}`}dt&&(dt.textContent="0"),ut&&(ut.textContent=m("customerDetails.stats.upcomingEmpty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø¬ÙˆØ²Ø§Øª Ù‚Ø§Ø¯Ù…Ø©")),G&&(G.textContent="â€”"),mt&&(mt.textContent=m("customerDetails.stats.activityEmpty","Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Ø´Ø§Ø· Ø­Ø¯ÙŠØ«")),ft&&(ft.textContent="0%"),K&&(K.textContent=m("customerDetails.stats.complianceEmpty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¯ÙØ¹ ÙƒØ§ÙÙŠØ©")),V();return}const t=Ct(),e=t.length,n=Date.now(),a=t.filter(s=>{const o=s?.start??s?.startDatetime??s?.start_datetime??s?.start_date;if(!o)return!1;const p=new Date(o);return Number.isNaN(p.getTime())?!1:p.getTime()>=n}),r=a.map(s=>s?.start??s?.startDatetime??s?.start_datetime).map(s=>new Date(s)).filter(s=>!Number.isNaN(s.getTime())).sort((s,o)=>s-o)[0]||null,i=Pt(),c=i.length,u=t.filter(s=>{const o=String(s?.status||s?.reservationStatus||"").toLowerCase();return!(o==="cancelled"||o==="canceled"||o==="Ù…Ù„ØºÙŠ"||o==="Ù…Ù„ØºÙ‰"||o==="Ù…Ù„ØºÙŠØ©")}),l=new Map;u.forEach(s=>{const o=s?.projectId??s?.project_id??null;if(o==null)return;const p=String(o);l.has(p)||l.set(p,[]),l.get(p).push(s)});let f=0,y=0,g=0,h=0;i.forEach(s=>{const o=Ae(s)||{},p=s?.id??s?.projectId??s?.project_id??null,Y=(p!=null?l.get(String(p))||[]:[]).reduce((ue,wt)=>ue+(Number(wt?.totalAmount)||qt(wt)||0),0),le=o.applyTax?Number(((Number(o.subtotal||0)+Y)*Se).toFixed(2)):0,$t=Number((Number(o.subtotal||0)+Y+le).toFixed(2)),de=zt({totalAmount:$t,paidAmount:Number(s?.paidAmount)||null,paidPercent:Number(s?.paidPercent)||null}),Mt=Math.max(0,Number(de.paidAmount||0)),Ft=Math.max(0,Number(($t-Mt).toFixed(2)));f+=Mt,y+=Ft,h+=1,Ft<=.5&&(g+=1)}),u.filter(s=>s?.projectId==null&&s?.project_id==null).forEach(s=>{const o=Number(s?.totalAmount)||qt(s)||0,p=zt({totalAmount:o,paidAmount:Number(s?.paidAmount)||null,paidPercent:Number(s?.paidPercent)||null,progressType:s?.paymentProgressType??null,progressValue:s?.paymentProgressValue??null,history:Array.isArray(s?.paymentHistory)?s.paymentHistory:[]}),L=Math.max(0,Number(p.paidAmount||0)),Y=Math.max(0,Number((o-L).toFixed(2)));f+=L,y+=Y,h+=1,Y<=.5&&(g+=1)});const b=h>0?Math.round(g/h*100):0,j=[];if(t.forEach(s=>{const o=It([s?.updatedAt,s?.updated_at,s?.end,s?.endDatetime,s?.end_datetime,s?.start,s?.startDatetime,s?.start_datetime,s?.createdAt,s?.created_at]);o&&j.push({date:o,type:"reservation"})}),i.forEach(s=>{const o=It([s?.updatedAt,s?.updated_at,s?.end,s?.end_datetime,s?.start,s?.start_datetime,s?.createdAt,s?.created_at]);o&&j.push({date:o,type:"project"})}),!j.length){const s=It([d?.updated_at,d?.updatedAt,d?.created_at,d?.createdAt]);s&&j.push({date:s,type:"customer"})}const k=j.reduce((s,o)=>s?o.date>s.date?o:s:o,null),I=k?.date??null,B=k?.type??null,_=t.reduce((s,o)=>Array.isArray(o?.items)?s+o.items.length:s,0),E=new Set;t.forEach(s=>{Array.isArray(s?.technicians)&&s.technicians.forEach(o=>{const p=o!=null?String(o):"";p&&E.add(p)}),Array.isArray(s?.techniciansDetails)&&s.techniciansDetails.forEach(o=>{const p=o?.id??o?.technician_id??o?.technicianId;p!=null&&E.add(String(p))})}),it&&(it.textContent=P(c)),ot&&(ot.textContent=c>0?m("customerDetails.stats.projectsDesc","Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„Ø¹Ù…ÙŠÙ„"):m("customerDetails.stats.projectsEmpty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„."));const Rt=bt(f),O=bt(y);if(ct&&(ct.innerHTML=Xt(Rt,O)),lt){const s=m("customerDetails.stats.paymentBreakdown","Ù…Ø¯ÙÙˆØ¹ / Ù…Ø³ØªØ­Ù‚"),o=y>0?m("customerDetails.stats.paymentOutstanding","Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: {amount}").replace("{amount}",O):m("customerDetails.stats.paymentAllSet","Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨Ø§Ù„Øº Ù…Ø³ØªØ­Ù‚Ø©");lt.textContent=`${s} â€¢ ${o}`}if(dt&&(dt.textContent=P(a.length)),ut&&(ut.textContent=a.length>0&&r?m("customerDetails.stats.nextReservation","Ø£Ù‚Ø±Ø¨ Ø­Ø¬Ø²: {date}").replace("{date}",Qt(r)):m("customerDetails.stats.upcomingEmpty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø¬ÙˆØ²Ø§Øª Ù‚Ø§Ø¯Ù…Ø©")),G)if(B){const s=m(`customerDetails.stats.activityType.${B}`,an[B]||B);G.textContent=s}else G.textContent="â€”";if(mt&&(mt.textContent=I?m("customerDetails.stats.activityOn","Ø¨ØªØ§Ø±ÙŠØ® {date}").replace("{date}",Qt(I)):m("customerDetails.stats.activityEmpty","Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Ø´Ø§Ø· Ø­Ø¯ÙŠØ«")),ft&&(ft.textContent=`${P(b)}%`),K)if(h>0){const s=b>=90?"excellent":b>=70?"good":b>=40?"average":"poor",o=s?m(`customerDetails.stats.complianceLabel.${s}`,Zt[s]||Zt.poor):"",p=m("customerDetails.stats.complianceProjects","Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…Ø¯ÙÙˆØ¹Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„: {count} Ù…Ù† {total}").replace("{count}",P(g)).replace("{total}",P(h));K.textContent=o?`${o} â€¢ ${p}`:p}else K.textContent=m("customerDetails.stats.complianceEmpty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¯ÙØ¹ ÙƒØ§ÙÙŠØ©");V({projects:c,reservations:e,equipment:_,technicians:E.size})}function cn(t){const{customers:e}=z();if(!Array.isArray(e))return null;const n=e.find(c=>String(c.id)===String(t));if(!n)return null;const a=n.tax_id??n.taxId??"",r=typeof a=="string"?a.trim():String(a||"").trim(),i=n.document??ie(n);return{...n,tax_id:r,taxId:r,document:i}}function ln(t={}){if(!t||typeof t!="object")return null;const e=t.id??t.customerId??t.customer_id??null,n=t.full_name??t.customerName??t.name??"",a=t.tax_id??t.taxId??t.vat_number??t.vatNumber??t.taxNumber??"",r=typeof a=="string"?a.trim():String(a||"").trim(),i=ie(t);return e==null?null:{id:String(e),customerName:n,full_name:n,phone:t.phone??"",companyName:t.company??t.company_name??t.companyName??"",company:t.company??t.company_name??t.companyName??"",email:t.email??"",address:t.address??"",notes:t.notes??"",tax_id:r,taxId:r,document:i,created_at:t.created_at??t.createdAt??null,updated_at:t.updated_at??t.updatedAt??null}}function dn(t){if(!t)return;const e=z(),n=Array.isArray(e.customers)?[...e.customers]:[],a=n.findIndex(r=>String(r.id)===String(t.id));a>=0?n[a]={...n[a],...t}:n.push(t),at({customers:n})}async function un(){const{technicians:t}=z();if(!(Array.isArray(t)&&t.length>0))try{const e=await nt("/technicians/"),n=Array.isArray(e?.data)?e.data.map(je):[];n.length>0&&at({technicians:n})}catch(e){console.warn("âš ï¸ Failed to load technicians list",e)}}async function mn(t){if(!t)return[];try{const e=new URLSearchParams({customer_id:String(t),limit:"200"}),n=await nt(`/reservations/?${e.toString()}`),a=Array.isArray(n?.data)?n.data.map(Ne):[];return tt=a,at({reservations:a}),a}catch(e){return console.warn("âš ï¸ Failed to load customer reservations",e),[]}}async function fn(t){if(!t)return[];try{const e=new URLSearchParams({client_id:String(t),limit:"200"}),n=await nt(`/projects/?${e.toString()}`),a=Array.isArray(n?.data)?n.data.map(Be):[];return et=a,at({projects:a}),a}catch(e){return console.warn("âš ï¸ Failed to load customer projects",e),[]}}function Lt(t=null){const e=t||on();return V(e),e}async function pn(t,{showSpinner:e=!1}={}){if(t){tt=null,et=null,e?(Q=!0,$="",M()):(Q=!0,$="");try{const n=await nt(`/customers/?id=${encodeURIComponent(t)}`),a=n?.data??n,r=ln(a);if(!r)throw new Error("Invalid customer payload received from server");d=r,dn(r),Q=!1,$="",M(),await un();const[i,c]=await Promise.all([mn(r.id),fn(r.id)]);vt(r.id),st(r.id);try{const u=Array.isArray(i)?i:Ct(),l=Array.isArray(c)?c:Pt();tt=u,et=l,Lt()}catch{}w()}catch(n){if(Q=!1,n instanceof ge&&n.status===404){d=null,$="",M();return}console.error("âš ï¸ Failed to load customer details",n);const a=m("customerDetails.errors.loadFailed","âš ï¸ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„.");d?($="",gt(a),M()):($=`${a}${n?.message?` (${n.message})`:""}`,M())}}}async function yn(){try{const t=await nt("/summary/"),e=rn(t?.data??null);if(e){V(e);try{window.__CUSTOMER_STATS__={...e}}catch{}return}}catch{}try{await Promise.allSettled([ke(),Te(),xe(),De({showToastOnError:!1})])}catch{}V();try{window.__CUSTOMER_STATS__={...oe()}}catch{}}function M(){if(!q)return;if(kt(Nt),!d){if(xt(null),jt(!0),w(),Q){q.innerHTML=`
        <div class="skeleton h-24 w-full rounded-2xl"></div>
        <div class="skeleton h-24 w-full rounded-2xl"></div>
        <div class="skeleton h-24 w-full rounded-2xl"></div>
      `;return}if($){q.innerHTML=`
        <div class="col-span-full">
          <div class="alert alert-error">${T($)}</div>
        </div>
      `;return}const n=m("customerDetails.errors.notFound","âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„.");q.innerHTML=`
      <div class="col-span-full">
        <div class="alert alert-warning" data-i18n data-i18n-key="customerDetails.errors.notFound">${T(n)}</div>
      </div>
    `;return}xt(d),jt(!1);const e=[{key:"customerDetails.fields.name",fallback:"ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…:",value:d.customerName||"â€”"},{key:"customerDetails.fields.phone",fallback:"ğŸ“ Ø§Ù„Ø¬ÙˆØ§Ù„:",value:d.phone?S(d.phone):"â€”"},{key:"customerDetails.fields.company",fallback:"ğŸ¢ Ø§Ù„Ø´Ø±ÙƒØ©:",value:d.companyName||"â€”"},{key:"customerDetails.fields.email",fallback:"ğŸ“§ Ø§Ù„Ø¨Ø±ÙŠØ¯:",value:d.email||"â€”"},{key:"customerDetails.fields.address",fallback:"ğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:",value:d.address||"â€”"},{key:"customerDetails.fields.taxId",fallback:"ğŸ§¾ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ:",value:d.tax_id??d.taxId??"â€”"},{key:"customerDetails.fields.notes",fallback:"ğŸ“ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:",value:d.notes||"â€”",multiline:!0},{key:"customerDetails.fields.document",fallback:"ğŸ“ Ù…Ø³ØªÙ†Ø¯ Ø§Ù„Ø¹Ù…ÙŠÙ„",value:d.document??null,type:"document"}].map(n=>{const a=m(n.key,n.fallback);if(n.type==="document"){const l=n.value;let f='<span class="text-base-content/50">â€”</span>';if(l&&typeof l=="object"){const y=l.fileName?.trim()||l.path?.trim()||l.url||"";if(l.url){const g=T(y||m("customerDetails.document.defaultName","Ø§Ù„Ù…Ø³ØªÙ†Ø¯ Ø§Ù„Ù…Ø±ØªØ¨Ø·")),h=sn(l.url),v=T(m("customerDetails.document.open","Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³ØªÙ†Ø¯"));f=`<div class="flex flex-wrap items-center gap-3"><span class="text-base-content break-all">${g}</span><a class="btn btn-outline btn-sm" href="${h}" target="_blank" rel="noopener noreferrer">${v}</a></div>`}else y&&(f=`<span class="text-base-content break-all">${T(y)}</span>`)}return`
        <article class="rounded-2xl border border-base-200 bg-base-100/90 p-4 shadow-sm">
          <span class="text-sm font-medium text-base-content/70" data-i18n data-i18n-key="${n.key}">${T(a)}</span>
          <div class="mt-2">${f}</div>
        </article>
      `}const i=(n.value==null?"":String(n.value)).trim(),c=i.length>0?i:"â€”",u=n.multiline?Qe(c):T(c);return`
      <article class="rounded-2xl border border-base-200 bg-base-100/90 p-4 shadow-sm">
        <span class="text-sm font-medium text-base-content/70" data-i18n data-i18n-key="${n.key}">${T(a)}</span>
        <p class="mt-2 text-lg font-semibold text-base-content">${u}</p>
      </article>
    `}).join("");q.innerHTML=e,w()}function hn(){document.getElementById("edit-id").value=d?.id||"",document.getElementById("edit-name").value=d?.customerName||"",document.getElementById("edit-phone").value=S(d?.phone||""),document.getElementById("edit-company").value=d?.companyName||"",document.getElementById("edit-email").value=d?.email||"",document.getElementById("edit-address").value=d?.address||"",document.getElementById("edit-tax-id").value=S(d?.tax_id??d?.taxId??"");const t=d?.document??null;X&&(X.value=t?.url||""),Z&&(Z.value=t?.fileName||""),Je(t),document.getElementById("edit-notes").value=d?.notes||""}const ht=document.getElementById("save-edit-btn");ht&&!ht.dataset.listenerAttached&&(ht.addEventListener("click",()=>{if(!d)return;const t=document.getElementById("edit-id").value,e=document.getElementById("edit-name").value.trim(),n=S(document.getElementById("edit-phone").value.trim()),a=document.getElementById("edit-company").value.trim(),r=document.getElementById("edit-email").value.trim(),i=document.getElementById("edit-address").value.trim(),c=S(document.getElementById("edit-tax-id").value.trim()),u=(X?.value||"").trim(),l=(Z?.value||"").trim(),f=document.getElementById("edit-notes").value.trim();if(!e||!n){gt(m("customerDetails.toast.missingRequired","âš ï¸ Ø§Ù„Ø§Ø³Ù… ÙˆØ±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø¥Ù„Ø²Ø§Ù…ÙŠØ§Ù†"));return}const y=z(),g=Array.isArray(y.customers)?y.customers:[],h=g.findIndex(k=>String(k.id)===String(t));if(h===-1){gt(m("customerDetails.toast.notFound","âš ï¸ Ø§Ù„Ø¹Ù…ÙŠÙ„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯"));return}const v=g[h]?.document??null;let b=v;x?.dataUrl?b={...v||{},url:x.dataUrl,fileName:l||x.fileName||v?.fileName||"",mimeType:x.mimeType||v?.mimeType,size:x.size??v?.size}:u?b={...v||{},url:u,fileName:l||v?.fileName||""}:l&&v?b={...v,fileName:l}:!u&&!l&&(b=v),g[h]={...g[h],customerName:e,phone:n,companyName:a,email:r,address:i,notes:f,tax_id:c,taxId:c,document:b},at({customers:g}),d=g[h],M(),vt(A),st(A),w(),document.dispatchEvent(new CustomEvent("customers:changed")),gt(m("customerDetails.toast.updateSuccess","âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„")),bootstrap.Modal.getInstance(document.getElementById("editCustomerModal"))?.hide()}),ht.dataset.listenerAttached="true");async function gn(){if(q){if(!A){xt(null),jt(!0),w(),q.innerHTML=`<p class="text-danger" data-i18n data-i18n-key="customerDetails.errors.missingId">${m("customerDetails.errors.missingId","âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø¹Ø±Ù Ø¹Ù…ÙŠÙ„ ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø·.")}</p>`;return}d=cn(A),d&&(M(),vt(A),st(A),w(),Lt()),await pn(A,{showSpinner:!d})}}gn();const ce=()=>{!A||!d||w()};document.addEventListener("reservations:changed",ce);document.addEventListener("projects:changed",ce);const vn=()=>{A&&d?Lt():V()};document.addEventListener("language:changed",()=>{M(),A&&d&&(vt(A),st(A),w())});["projects:changed","reservations:changed","equipment:changed","technicians:changed"].forEach(t=>{document.addEventListener(t,vn,{passive:!0})});Pe();yn();
