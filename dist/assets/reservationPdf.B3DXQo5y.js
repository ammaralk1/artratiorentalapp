import{n as E,j as pt,t as r,d as dn,b as Ea,h as Na,p as oe,B as Ia,y as mt,C as zn}from"./auth.CkmvDrlI.js";import{n as Pa,v as At,t as Pt,a as Da,b as pn,d as Qn,H as Un,g as Vn,r as La,c as Fa,e as Ma,h as Ra}from"./reservationsService.C6jpAa2M.js";import{s as Oa,i as ft,j as Nn,I as Gn,O as Wn}from"./state.CkwYd5Vq.js";import{h as Ba}from"./view.aTfBqxDp.js";import{q as Ka}from"./quotePdf.WsMP2hr-.js";import{s as Yn,a as Xn,e as Jn,p as Ha}from"./canvasColorUtils.CviLtv6S.js";function Zn(e){const t=new Date;if(t.setHours(0,0,0,0),e==="today")return{startDate:at(t),endDate:at(t)};if(e==="week"){const n=new Date(t),a=n.getDay(),o=a===0?6:a-1;n.setDate(n.getDate()-o);const u=new Date(n);return u.setDate(n.getDate()+6),{startDate:at(n),endDate:at(u)}}if(e==="month"){const n=new Date(t.getFullYear(),t.getMonth(),1),a=new Date(t.getFullYear(),t.getMonth()+1,0);return{startDate:at(n),endDate:at(a)}}return e==="upcoming"?{startDate:at(t),endDate:""}:{startDate:"",endDate:""}}function hs(){const e=document.getElementById("search-reservation"),t=document.getElementById("filter-start-date"),n=document.getElementById("filter-end-date"),a=document.getElementById("reservation-date-range"),o=document.getElementById("reservation-status-filter");let u=E(t?.value||"").trim(),s=E(n?.value||"").trim(),c=a?.value||"";if(new Set(["","today","week","month"]).has(c)||(c="",a&&(a.value=""),Dt(t),Dt(n),u="",s=""),!u&&!s&&c){const y=Zn(c);u=y.startDate,s=y.endDate}return{searchTerm:Pa(e?.value||""),startDate:u,endDate:s,status:o?.value||"",quickRange:c}}function bs(e){const t=()=>{typeof e=="function"&&e()},n=document.getElementById("search-reservation");n&&!n.dataset.listenerAttached&&(n.addEventListener("input",()=>{n.value=E(n.value),t()}),n.dataset.listenerAttached="true");const a=document.getElementById("filter-start-date");a&&!a.dataset.listenerAttached&&(a.addEventListener("change",()=>{const d=document.getElementById("reservation-date-range");d&&(d.value=""),t()}),a.dataset.listenerAttached="true");const o=document.getElementById("filter-end-date");o&&!o.dataset.listenerAttached&&(o.addEventListener("change",()=>{const d=document.getElementById("reservation-date-range");d&&(d.value=""),t()}),o.dataset.listenerAttached="true");const u=document.getElementById("reservation-date-range");u&&!u.dataset.listenerAttached&&(u.addEventListener("change",()=>{za(u.value),t()}),u.dataset.listenerAttached="true");const s=document.getElementById("reservation-status-filter");s&&!s.dataset.listenerAttached&&(s.addEventListener("change",t),s.dataset.listenerAttached="true");const c=document.getElementById("clear-filters");c&&!c.dataset.listenerAttached&&(c.addEventListener("click",()=>{n&&(n.value=""),Dt(a),Dt(o),u&&(u.value=""),s&&(s.value=""),t()}),c.dataset.listenerAttached="true")}function za(e){const t=document.getElementById("filter-start-date"),n=document.getElementById("filter-end-date");if(!t||!n)return;const{startDate:a,endDate:o}=Zn(e);t._flatpickr?a?t._flatpickr.setDate(a,!1,"Y-m-d"):t._flatpickr.clear():t.value=a,n._flatpickr?o?n._flatpickr.setDate(o,!1,"Y-m-d"):n._flatpickr.clear():n.value=o}function at(e){if(!e)return"";const t=e.getTimezoneOffset()*6e4;return new Date(e.getTime()-t).toISOString().split("T")[0]}function Dt(e){e&&(e._flatpickr&&e._flatpickr.clear(),e.value="")}const Qa=""+new URL("Tajawal-400.ttf",import.meta.url).href,Ua=""+new URL("Tajawal-500.ttf",import.meta.url).href,In=""+new URL("Tajawal-700.ttf",import.meta.url).href,Va="reservations.quote.sequence",Pn={reservation:"reservations.quote.togglePrefs.v1",project:"projects.quote.togglePrefs.v1",reservationChecklist:"reservations.checklist.togglePrefs.v1"},ea="https://help.artratio.sa/guide/quote-preview",be={logoUrl:"https://art-ratio.sirv.com/AR-Logo-v3.5-curved.png",companyName:"Ø´Ø±ÙƒØ© ÙÙˆØ¯ Ø¢Ø±Øª Ù„Ù„Ø¯Ø¹Ø§ÙŠØ© ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù† (Ø´Ø±ÙƒØ© Ø´Ø®Øµ ÙˆØ§Ø­Ø¯)",commercialRegistry:"4030485240",beneficiaryName:"Ø´Ø±ÙƒØ© ÙÙˆØ¯ Ø¢Ø±Øª Ù„Ù„Ø¯Ø¹Ø§ÙŠØ© ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù† (Ø´Ø±ÙƒØ© Ø´Ø®Øµ ÙˆØ§Ø­Ø¯)",bankName:"Ù…ØµØ±Ù Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠ",accountNumber:"Ù£Ù¥Ù¨Ù Ù Ù Ù Ù¡Ù Ù Ù Ù¦Ù Ù¨Ù¦Ù Ù¦Ù¥Ù§Ù Ù¦",iban:"SA1680000358608016065706",approvalNote:"Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø±Ø¶ ØªØ¹ØªØ¨Ø± Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…."},Ga=["ÙŠÙˆÙ… Ø§Ù„Ø¹Ù…Ù„ Ù‡Ùˆ 12 Ø³Ø§Ø¹Ø©ØŒ ÙˆÙŠØªÙ… Ø§Ø­ØªØ³Ø§Ø¨ Ù†ØµÙ ÙŠÙˆÙ… Ø¥Ø¶Ø§ÙÙŠ Ø¨Ø¹Ø¯ 20 Ø³Ø§Ø¹Ø©ØŒ Ø«Ù… ÙŠÙˆÙ… ÙƒØ§Ù…Ù„ Ø¨Ø¹Ø¯ Ø°Ù„Ùƒ.","ÙŠÙ…Ù†Ø¹ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙÙŠ Ø£Ù†Ø´Ø·Ø© ØºÙŠØ± Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©.","ÙŠØªØ­Ù…Ù„ Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø± Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© Ø£ÙŠ ØªÙ„Ù Ø£Ùˆ ÙÙ‚Ø¯Ø§Ù†.","ÙŠØ¬Ø¨ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙÙŠ Ø­Ø§Ù„ØªÙ‡Ø§ Ø§Ù„Ø£ØµÙ„ÙŠØ©.","ÙŠØªÙ… ÙØ±Ø¶ Ø±Ø³ÙˆÙ… Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ù„ØºØ§Ø¡ Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ù‚Ø¨Ù„ 24 Ø³Ø§Ø¹Ø©."],Ee=[...Ga],Wa=["ÙŠØªÙ… Ø¯ÙØ¹ 50% Ù…Ù† Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø±ØŒ ÙˆÙŠØªÙ… Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø§Ù„Ù€ 50% Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ.","ÙŠØ­ØµÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¹Ù„Ù‰ Ø­Ù‚ÙˆÙ‚ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© ÙÙŠ Ø£ÙŠ Ù…ÙƒØ§Ù† ÙŠØ±Ø§Ù‡ Ù…Ù†Ø§Ø³Ø¨Ø§Ù‹ØŒ Ø¨ÙŠÙ†Ù…Ø§ ØªØ­ØªÙØ¸ Ø§Ù„Ø´Ø±ÙƒØ© Ø¨Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø®Ø§Ù… ÙˆÙ„Ø§ ØªØ³ØªØ®Ø¯Ù…Ù‡Ø§ Ø¥Ù„Ø§ Ø¨Ø¹Ø¯ Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ø§ Ù„Ù… ÙŠÙØªÙÙ‚ Ø¹Ù„Ù‰ ØºÙŠØ± Ø°Ù„Ùƒ.","ÙŠØªÙ… Ø§Ù„Ø§ØªÙØ§Ù‚ Ø¹Ù„Ù‰ Ø¬Ø¯ÙˆÙ„ Ø²Ù…Ù†ÙŠ Ù„Ù„ØªÙ†ÙÙŠØ°ØŒ ÙˆØ£ÙŠ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ø®Ø§Ø±Ø¬ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ù…ØªÙÙ‚ Ø¹Ù„ÙŠÙ‡ ØªØ®Ø¶Ø¹ Ù„Ø±Ø³ÙˆÙ… Ø¥Ø¶Ø§ÙÙŠØ©.","Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù† ØªÙˆÙÙŠØ± Ø§Ù„ØªØµØ§Ø±ÙŠØ­ Ø§Ù„Ù„Ø§Ø²Ù…Ø© Ù„Ù„ØªØµÙˆÙŠØ± ÙÙŠ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©ØŒ ÙˆØ£ÙŠ ØªØ£Ø®ÙŠØ± Ù†Ø§ØªØ¬ Ø¹Ù† Ø°Ù„Ùƒ Ù‚Ø¯ ÙŠØ¤Ø«Ø± Ø¹Ù„Ù‰ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„ØªØ³Ù„ÙŠÙ….","ØªÙØ­ÙÙØ¸ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ù„Ù„Ù…Ø´Ø±ÙˆØ¹ Ù„Ù…Ø¯Ø© 12 Ø´Ù‡Ø±Ø§Ù‹ ÙÙŠ Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ø´Ø±ÙƒØ©ØŒ ÙˆÙŠÙ…ÙƒÙ† Ù„Ù„Ø¹Ù…ÙŠÙ„ Ø·Ù„Ø¨ Ù†Ø³Ø® Ø¥Ø¶Ø§ÙÙŠØ© Ø®Ù„Ø§Ù„ ØªÙ„Ùƒ Ø§Ù„ÙØªØ±Ø©.","ÙŠØªØ­Ù…Ù‘Ù„ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© ØªÙˆÙÙŠØ± Ø¨ÙŠØ¦Ø© Ø¹Ù…Ù„ Ø¢Ù…Ù†Ø© Ù„Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ ÙˆØ§Ù„Ù…Ø¹Ø¯Ø§Øª ÙÙŠ Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªØµÙˆÙŠØ±ØŒ ÙˆÙŠØ¶Ù…Ù† Ø§ØªØ®Ø§Ø° ÙƒØ§ÙØ© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·Ø§Øª Ø§Ù„Ù„Ø§Ø²Ù…Ø© Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø³Ù„Ø§Ù…ØªÙ‡Ù…."];function tn(e){return e?e.split(/\r?\n/).map(t=>t.trim()).filter(t=>t.length>0):[...Ee]}function Ya(){const e=document.getElementById("reservation-terms");if(e&&e.value.trim().length>0){const a=tn(e.value);if(a.length)return a}const t=document.getElementById("edit-res-terms");if(t&&t.value.trim().length>0){const a=tn(t.value);if(a.length)return a}const n=Ee.join(`
`);return e&&e.value.trim().length===0&&(e.value=n),t&&t.value.trim().length===0&&(t.value=n),[...Ee]}const Xa=[{id:"customerInfo",labelKey:"reservations.quote.sections.customer",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„",defaultSelected:!0},{id:"reservationInfo",labelKey:"reservations.quote.sections.reservation",fallback:"ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²",defaultSelected:!0},{id:"projectInfo",labelKey:"reservations.quote.sections.project",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",defaultSelected:!0},{id:"financialSummary",labelKey:"reservations.quote.sections.financial",fallback:"Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ",defaultSelected:!0},{id:"items",labelKey:"reservations.quote.sections.items",fallback:"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",defaultSelected:!0},{id:"crew",labelKey:"reservations.quote.sections.crew",fallback:"Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„",defaultSelected:!0},{id:"notes",labelKey:"reservations.quote.sections.notes",fallback:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø­Ø¬Ø²",defaultSelected:!0},{id:"payment",labelKey:"reservations.quote.sections.payment",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹",defaultSelected:!1}],Kt=[{id:"rowNumber",labelKey:null,fallback:"#",render:(e,t)=>l(E(String(t+1)))},{id:"code",labelKey:"reservations.details.table.headers.code",fallback:"Ø§Ù„ÙƒÙˆØ¯",render:e=>{if(e?.isPackage){const t=e?.packageCodeResolved||e?.barcode||"";return l(t||"-")}return l(e?.barcode||"-")}},{id:"description",labelKey:"reservations.details.table.headers.description",fallback:"Ø§Ù„ÙˆØµÙ",render:e=>{const t=String(e?.desc||e?.description||"-");return`<div class="quote-cell quote-cell--desc">${l(t)}</div>`}},{id:"quantity",labelKey:"reservations.details.table.headers.quantity",fallback:"Ø§Ù„ÙƒÙ…ÙŠØ©",render:e=>l(E(String(e?.qty||1)))},{id:"unitPrice",labelKey:"reservations.quote.columns.unitPrice",fallback:"Ù„ÙƒÙ„ ÙŠÙˆÙ…",render:e=>l(E(Number(e?.unitPriceValue||0).toFixed(2)))},{id:"price",labelKey:"reservations.quote.columns.total",fallback:"Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹",render:e=>l(E(Number(e?.price||0).toFixed(2)))}],Ht=[{id:"rowNumber",labelKey:null,fallback:"#",render:(e,t)=>l(E(String(t+1)))},{id:"position",labelKey:"reservations.details.crew.position",fallback:"Ø§Ù„Ù…Ù†ØµØ¨",render:e=>{const t=typeof oe=="function"?oe():"ar",n=e?.positionLabelEn??e?.position_label_en??e?.position_name_en??e?.positionLabelAlt??e?.position_label_alt??e?.role,a=e?.positionLabel??e?.position_name??e?.role??r("reservations.crew.positionFallback","Ù…Ù†ØµØ¨ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…");return l(E(String(t==="en"&&n?n:a)))}},{id:"unitPrice",labelKey:"reservations.quote.columns.unitPrice",fallback:"Ù„ÙƒÙ„ ÙŠÙˆÙ…",render:e=>{const t=Number.isFinite(Number(e?.positionClientPrice))?Number(e.positionClientPrice):0;return l(`${E(t.toFixed(2))} ${r("reservations.create.summary.currency","SR")}`)}},{id:"price",labelKey:"reservations.quote.columns.total",fallback:"Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹",render:e=>{const t=Number.isFinite(Number(e?.positionClientPrice))?Number(e.positionClientPrice):0;return l(`${E(t.toFixed(2))} ${r("reservations.create.summary.currency","SR")}`)}}],Je={customerInfo:[{id:"customerName",labelKey:"reservations.details.labels.customer",fallback:"Ø§Ù„Ø¹Ù…ÙŠÙ„"},{id:"customerCompany",labelKey:"reservations.details.labels.company",fallback:"Ø§Ù„Ø´Ø±ÙƒØ©"},{id:"customerPhone",labelKey:"reservations.details.labels.phone",fallback:"Ø§Ù„Ù‡Ø§ØªÙ"},{id:"customerEmail",labelKey:"reservations.details.labels.email",fallback:"Ø§Ù„Ø¨Ø±ÙŠØ¯"}],reservationInfo:[{id:"reservationId",labelKey:"reservations.details.labels.reservationId",fallback:"Ø±Ù‚Ù… Ø§Ù„Ø­Ø¬Ø²"},{id:"reservationStart",labelKey:"reservations.details.labels.start",fallback:"Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø­Ø¬Ø²"},{id:"reservationEnd",labelKey:"reservations.details.labels.end",fallback:"Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø­Ø¬Ø²"},{id:"reservationDuration",labelKey:"reservations.details.labels.duration",fallback:"Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…"}],projectInfo:[{id:"projectTitle",labelKey:"reservations.details.labels.project",fallback:"Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectCode",labelKey:"reservations.details.labels.code",fallback:"Ø§Ù„Ø±Ù…Ø²"}],financialSummary:[{id:"discountAmount",labelKey:"reservations.details.labels.discount",fallback:"Ø§Ù„Ø®ØµÙ…"},{id:"subtotalBeforeTax",labelKey:"reservations.details.labels.subtotalBeforeTax",fallback:"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"},{id:"taxAmount",labelKey:"reservations.details.labels.tax",fallback:"Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"},{id:"finalTotal",labelKey:"reservations.details.labels.total",fallback:"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ"}],payment:[{id:"beneficiary",labelKey:"reservations.quote.labels.beneficiary",fallback:"Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙÙŠØ¯"},{id:"bank",labelKey:"reservations.quote.labels.bank",fallback:"Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ"},{id:"account",labelKey:"reservations.quote.labels.account",fallback:"Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨"},{id:"iban",labelKey:"reservations.quote.labels.iban",fallback:"Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ¨Ø§Ù†"}],items:[...Kt.map(({id:e,labelKey:t,fallback:n})=>({id:e,labelKey:t,fallback:n})),{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…"},{id:"equipmentSubtotal",labelKey:"reservations.details.labels.equipmentTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"}],crew:[...Ht.map(({id:e,labelKey:t,fallback:n})=>({id:e,labelKey:t,fallback:n})),{id:"quantity",labelKey:"reservations.details.table.headers.quantity",fallback:"Ø§Ù„ÙƒÙ…ÙŠØ©"},{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…"},{id:"crewSubtotal",labelKey:"reservations.details.labels.crewTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±ÙŠÙ‚"}]},ta=[{id:"rowNumber",labelKey:null,fallback:"#",render:(e,t)=>l(E(String(t+1)))},{id:"label",labelKey:null,fallback:"Ø§Ù„Ø¨Ù†Ø¯",render:e=>l(e?.label||"-")},{id:"amount",labelKey:null,fallback:"Ø§Ù„Ø³Ø¹Ø±",render:e=>{const t=Number.isFinite(Number(e?.salePrice??e?.sale_price))?Number(e?.salePrice??e?.sale_price):Number(e?.amount??0)||0;return l(Z(t,r("reservations.create.summary.currency","SR")))}},{id:"note",labelKey:null,fallback:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª",render:e=>l(e?.note||"-")}],Ja=[{id:"customerInfo",labelKey:"projects.quote.sections.customer",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„",defaultSelected:!0},{id:"projectInfo",labelKey:"projects.quote.sections.project",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",defaultSelected:!0},{id:"projectExpenses",labelKey:"projects.quote.sections.expenses",fallback:"Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©",defaultSelected:!0},{id:"projectCrew",labelKey:"projects.quote.sections.crew",fallback:"Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„",defaultSelected:!0},{id:"financialSummary",labelKey:"projects.quote.sections.financial",fallback:"Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ",defaultSelected:!0},{id:"projectEquipment",labelKey:"projects.quote.sections.equipment",fallback:"Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",defaultSelected:!0},{id:"projectNotes",labelKey:"projects.quote.sections.notes",fallback:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",defaultSelected:!0},{id:"payment",labelKey:"reservations.quote.sections.payment",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹",defaultSelected:!1}],Za={customerInfo:Je.customerInfo,projectInfo:[{id:"projectTitle",labelKey:"projects.details.overview.heading",fallback:"Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectCode",labelKey:"projects.details.labels.code",fallback:"Ø±Ù‚Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectType",labelKey:"projects.details.type",fallback:"Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectStart",labelKey:"projects.details.start",fallback:"Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectEnd",labelKey:"projects.details.end",fallback:"Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectDuration",labelKey:"projects.details.duration",fallback:"Ù…Ø¯Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectStatus",labelKey:"projects.details.status",fallback:"Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"}],financialSummary:[{id:"reservationsTotal",labelKey:"projects.details.reservationsTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª"},{id:"discountAmount",labelKey:"projects.details.summary.discount",fallback:"Ø§Ù„Ø®ØµÙ…"},{id:"taxAmount",labelKey:"projects.details.summary.combinedTax",fallback:"Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"},{id:"overallTotal",labelKey:"projects.details.summary.overallTotal",fallback:"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ"}],payment:Je.payment,projectExpenses:[...ta.map(({id:e,labelKey:t,fallback:n})=>({id:e,labelKey:t,fallback:n})),{id:"expensesSubtotal",labelKey:"projects.details.expensesTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©"}],projectCrew:[...Ht.map(({id:e,labelKey:t,fallback:n})=>({id:e,labelKey:t,fallback:n})),{id:"quantity",labelKey:"reservations.details.table.headers.quantity",fallback:"Ø§Ù„ÙƒÙ…ÙŠØ©"},{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…"},{id:"crewSubtotal",labelKey:"reservations.details.labels.crewTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±ÙŠÙ‚"}],projectEquipment:[...Kt.map(({id:e,labelKey:t,fallback:n})=>({id:e,labelKey:t,fallback:n})),{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…"},{id:"equipmentSubtotal",labelKey:"reservations.details.labels.equipmentTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"}],projectNotes:[]},Zt=new Map;function zt(e="reservation"){if(Zt.has(e))return Zt.get(e);const t=e==="project"?Ja:e==="reservationChecklist"?[{id:"customerInfo",labelKey:"reservations.quote.sections.customer",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„",defaultSelected:!0},{id:"reservationInfo",labelKey:"reservations.quote.sections.reservation",fallback:"ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²",defaultSelected:!0},{id:"projectInfo",labelKey:"reservations.quote.sections.project",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",defaultSelected:!0},{id:"notes",labelKey:"reservations.quote.sections.notes",fallback:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø­Ø¬Ø²",defaultSelected:!0},{id:"items",labelKey:"reservations.quote.sections.items",fallback:"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",defaultSelected:!0},{id:"crew",labelKey:"reservations.quote.sections.crew",fallback:"Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„",defaultSelected:!0}]:Xa,n=e==="project"?Za:e==="reservationChecklist"?{customerInfo:Je.customerInfo,reservationInfo:Je.reservationInfo,projectInfo:Je.projectInfo,notes:[],items:Je.items,crew:Je.crew}:Je,a=new Set(t.map(({id:s})=>s)),o=Object.fromEntries(Object.entries(n).map(([s,c=[]])=>[s,new Set(c.map(d=>d.id))])),u={sectionDefs:t,fieldDefs:n,sectionIdSet:a,fieldIdMap:o};return Zt.set(e,u),u}function Qt(e="reservation"){return zt(e).sectionDefs}function na(e="reservation"){return zt(e).fieldDefs}function aa(e="reservation"){return zt(e).sectionIdSet}function oa(e="reservation"){return zt(e).fieldIdMap}function sa(e){switch(e){case"export":return r("reservations.quote.status.exporting","Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ù…Ù„Ù PDF...");case"render":default:return r("reservations.quote.status.rendering","Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©...")}}const eo="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js",to="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js",no="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js",ra=Ka.trim(),ia=`
@font-face { font-family: 'Tajawal'; font-style: normal; font-weight: 400; font-display: swap; src: url(${JSON.stringify(Qa)}) format('truetype'); }
@font-face { font-family: 'Tajawal'; font-style: normal; font-weight: 500; font-display: swap; src: url(${JSON.stringify(Ua)}) format('truetype'); }
@font-face { font-family: 'Tajawal'; font-style: normal; font-weight: 600; font-display: swap; src: url(${JSON.stringify(In)}) format('truetype'); }
@font-face { font-family: 'Tajawal'; font-style: normal; font-weight: 700; font-display: swap; src: url(${JSON.stringify(In)}) format('truetype'); }
`,la=/^data:image\/svg\+xml/i,ao=/\.svg($|[?#])/i,vt=512,nn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/B8AAusB9YwpClgAAAAASUVORK5CYII=",ca=96,ua=25.4,an=210,Ct=297,jt=Math.round(an/ua*ca),Et=Math.round(Ct/ua*ca);function pe(e){const t=Number(e),n=Number.isFinite(t)?t:0;try{const a=Math.abs(n%1)>1e-9;return E(n.toLocaleString("en-US",{minimumFractionDigits:a?2:0,maximumFractionDigits:2}))}catch{return Number.isInteger(n)?E(String(n)):E(n.toFixed(2))}}let Lt=!1,Ft=null;function mn(){Lt||(Ft=async function(){try{if(!i||!q?.modal?.classList.contains("show")||(i.context||"reservation")!=="reservation")return;const n=i.reservation;if(!n)return;const a=[n.id,n.reservationId,n.reservation_id,n.reservationCode,n.reservation_code].map(g=>g==null?"":String(g)).filter(g=>g.length>0);if(!a.length)return;const o=Vn(),u=(Array.isArray(o)?o:[]).find(g=>[g?.id,g?.reservationId,g?.reservation_id,g?.reservationCode,g?.reservation_code].map(A=>A==null?"":String(A)).filter(A=>A.length>0).some(A=>a.includes(A)));if(!u)return;const s=Yt(u),{totalsDisplay:c,totals:d,rentalDays:y}=$n(u,s,i.project);i.reservation=u,i.crewAssignments=s,i.totals=d,i.totalsDisplay=c,i.rentalDays=y,It(),qe()}catch(t){console.warn("[reservationPdf] live update failed",t)}},document.addEventListener("reservations:changed",Ft),Lt=!0)}function da(){if(Lt){try{document.removeEventListener("reservations:changed",Ft)}catch{}Ft=null,Lt=!1}}const pa=2,ma=/safari/i,oo=/(iphone|ipad|ipod)/i,Dn=/(iphone|ipad|ipod)/i,so=/(crios|fxios|edgios|opios)/i,Mt="[reservations/pdf]";let q=null,i=null,Be=1,bt=null,gt=null,Ze=null,ut=null,wt=!1;const on="quoteBlockOffsets",Ln=1800,sn="quoteInfoAlignments",ro=["customer","reservation","project","projectCustomer","projectDetails"],fn={customer:"right",reservation:"right",project:"right",projectCustomer:"right",projectDetails:"right"};let yt=!1,yn=!1,kt=!1;function xt(e=i){return e?.context||"reservation"}function io(e="reservation"){try{const n=JSON.parse(localStorage.getItem(on)||"{}")?.[e];if(n&&typeof n=="object")return JSON.parse(JSON.stringify(n))}catch{}return{}}function fa(e,t={}){try{const n=JSON.parse(localStorage.getItem(on)||"{}");t&&Object.keys(t).length>0?n[e]=t:delete n[e],localStorage.setItem(on,JSON.stringify(n))}catch{}}function hn(e){if(!e)return;const t=xt(e);e.blockOffsets={...io(t)},yn=!1,yt=!1,Ut()}function lo(e,t={}){if(!e)return;e.querySelectorAll("[data-drag-key]").forEach(a=>{const o=a.dataset.dragKey,u=t?.[o],s=Number(u?.x)||0,c=Number(u?.y)||0;s||c?a.style.transform=`translate(${s}px, ${c}px)`:a.style.transform="",a.dataset.dragX=String(s),a.dataset.dragY=String(c)})}function bn(e){try{const t=e?.getElementById("quotation-pdf-root");if(!t)return;t.dataset.blockDragMode=yt?"on":"off"}catch{}}function Ut(){const e=q?.blockDragToggle;if(e){const n=yt?r("reservations.quote.drag.disable","ğŸ”’ Ø¥Ù†Ù‡Ø§Ø¡ ÙˆØ¶Ø¹ Ø§Ù„ØªØ­Ø±ÙŠÙƒ"):r("reservations.quote.drag.enable","ğŸ¯ ÙˆØ¶Ø¹ ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø¨Ù„ÙˆÙƒØ§Øª");e.textContent=n,e.classList.toggle("is-active",yt)}const t=q?.blockDragSave;t&&(t.disabled=!yn)}function co(e){yt=!!e,Ut();try{bn(q?.previewFrame?.contentDocument)}catch{}}function gn(e=!0){yn=!!e,Ut()}function uo(){if(!i)return;const e=xt(i),t=i.blockOffsets||{};fa(e,t),gn(!1),pt(r("reservations.quote.drag.saved","âœ… ØªÙ… Ø­ÙØ¸ Ù…ÙˆØ§Ø¶Ø¹ Ø§Ù„Ø¨Ù„ÙˆÙƒØ§Øª."))}function po(){if(!i)return;i.blockOffsets={};const e=xt(i);fa(e,{}),gn(!1),qe(),pt(r("reservations.quote.drag.reset","â†º ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© Ù…ÙˆØ§Ø¶Ø¹ Ø§Ù„Ø¨Ù„ÙˆÙƒØ§Øª Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ."))}function Fn(e){return Math.min(Math.max(e,-Ln),Ln)}function mo(e="reservation"){try{const n=JSON.parse(localStorage.getItem(sn)||"{}")?.[e];if(n&&typeof n=="object")return{...n}}catch{}return null}function fo(e,t={}){try{const n=JSON.parse(localStorage.getItem(sn)||"{}");n[e]=t,localStorage.setItem(sn,JSON.stringify(n))}catch{}}function vn(e){if(!e||kt)return;const t=xt(e),n=mo(t);e.infoAlignments={...fn,...n||{}},kt=!0}function ya(e,t){const n=fn[t]||"right";return e?.infoAlignments?.[t]||n}function qt(e,t){return`info-plain info-plain--align-${ya(e,t)}`}function yo(e,t){if(!i)return;const n=ro.includes(e)?e:"customer",a=["left","center","right"].includes(t)?t:"right";i.infoAlignments||(i.infoAlignments={...fn}),i.infoAlignments[n]=a;const o=xt(i);fo(o,i.infoAlignments),qe(),Vt()}function Vt(){if(!q?.alignTarget)return;const e=q.alignTarget.value||"customer",t=ya(i,e);(q.alignButtons||[]).forEach(n=>{const a=n.dataset.alignValue;a&&n.classList.toggle("is-active",a===t)})}function ho(e){try{const t=e?.getElementById("quotation-pdf-root");if(!t)return;Array.from(t.querySelectorAll("[data-drag-key]")).forEach(a=>{if(a.dataset.blockDragHandleAttached==="true")return;a.style.position=a.style.position||"relative",a.style.touchAction="none";const o=e.createElement("button");o.type="button",o.className="quote-block-drag-handle",o.setAttribute("data-block-handle",a.dataset.dragKey||""),o.setAttribute("aria-label",r("reservations.quote.drag.handle","Ø§Ø³Ø­Ø¨ Ù„ØªØ­Ø±ÙŠÙƒ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…")),o.innerHTML='<span aria-hidden="true">â ¿</span>';const u=s=>{t.dataset.blockDragMode==="on"&&bo(s,a)};o.addEventListener("pointerdown",u),a.prepend(o),a.dataset.blockDragHandleAttached="true"}),bn(e)}catch{}}function bo(e,t){if(!t||!i)return;e.preventDefault(),e.stopPropagation();const n=t.ownerDocument||document,a=e.pointerId;t.setPointerCapture?.(a);const o=e.clientX,u=e.clientY,s=Number(t.dataset.dragX||0),c=Number(t.dataset.dragY||0);let d=s,y=c;const g=t.dataset.dragKey,_=v=>{v.preventDefault();const h=v.clientX-o,M=v.clientY-u;d=Fn(s+h),y=Fn(c+M),t.style.transform=`translate(${d}px, ${y}px)`,t.dataset.dragTempX=String(d),t.dataset.dragTempY=String(y)},A=()=>{n.removeEventListener("pointermove",_),n.removeEventListener("pointerup",A),t.releasePointerCapture?.(a);const v=Number(t.dataset.dragTempX??s),h=Number(t.dataset.dragTempY??c);t.dataset.dragX=String(v),t.dataset.dragY=String(h),t.dataset.dragTempX="",t.dataset.dragTempY="",i.blockOffsets||(i.blockOffsets={}),Math.abs(v)<=.5&&Math.abs(h)<=.5?delete i.blockOffsets[g]:i.blockOffsets[g]={x:v,y:h},gn(!0)};n.addEventListener("pointermove",_),n.addEventListener("pointerup",A)}function ot(e="render",{message:t,actionLabel:n,onAction:a,showSpinner:o=e!=="error"}={}){if(!q?.statusIndicator||!q?.statusText)return;q.statusKind=e;const u=t||sa(e);q.statusText.textContent=u,q.statusSpinner&&(q.statusSpinner.hidden=!o),q.statusAction&&(q.statusAction.hidden=!0,q.statusAction.onclick=null,n&&typeof a=="function"&&(q.statusAction.textContent=n,q.statusAction.hidden=!1,q.statusAction.onclick=s=>{s.preventDefault(),a()})),q.statusIndicator.hidden=!1,requestAnimationFrame(()=>{q.statusIndicator.classList.add("is-visible")})}function dt(e){try{return String(e||"").toLowerCase().normalize("NFKD").replace(/[\u064B-\u065F\u0670\u06D6-\u06ED]/g,"").replace(/\s+/g," ").trim()}catch{return String(e||"").trim().toLowerCase()}}function St(e){!q?.statusIndicator||!q?.statusText||(q.statusKind=null,q.statusIndicator.classList.remove("is-visible"),setTimeout(()=>{q?.statusIndicator&&(q.statusIndicator.hidden=!0,q.statusAction&&(q.statusAction.hidden=!0,q.statusAction.onclick=null),q.statusSpinner&&(q.statusSpinner.hidden=!1))},220))}function rn(){return!!window?.bootstrap?.Modal}function go(e){if(e&&!e.classList.contains("show")){e.classList.add("show"),e.style.display="block",e.removeAttribute("aria-hidden"),e.setAttribute("aria-modal","true"),e.getAttribute("role")||e.setAttribute("role","dialog"),document.body.classList.add("modal-open"),Ze||(Ze=document.createElement("div"),Ze.className="modal-backdrop fade show",Ze.dataset.quotePdfFallbackBackdrop="true",document.body.appendChild(Ze)),ut||(ut=t=>{t.key==="Escape"&&ln(e)},document.addEventListener("keydown",ut));try{e.focus({preventScroll:!0})}catch{}}}function ln(e){if(!(!e||!e.classList.contains("show"))){try{const t=e.ownerDocument?.activeElement;if(t&&e.contains(t)){try{t.blur()}catch{}try{e.ownerDocument?.body?.focus({preventScroll:!0})}catch{}}}catch{}e.classList.remove("show"),e.style.display="none",e.setAttribute("aria-hidden","true"),e.removeAttribute("aria-modal"),document.body.classList.remove("modal-open"),Ze&&(Ze.remove(),Ze=null),ut&&(document.removeEventListener("keydown",ut),ut=null);try{da()}catch{}}}function vo(e){if(e){if(rn()){const t=window.bootstrap.Modal.getOrCreateInstance(e);try{const n=()=>{try{const a=document.activeElement;if(a&&e.contains(a)){try{a.blur()}catch{}try{document.body?.focus({preventScroll:!0})}catch{}}}catch{}try{da()}catch{}try{e.removeEventListener("hidden.bs.modal",n)}catch{}};e.addEventListener("hidden.bs.modal",n,{once:!0}),e.addEventListener("hide.bs.modal",()=>{try{const a=document.activeElement;if(a&&e.contains(a))try{a.blur()}catch{}}catch{}})}catch{}t.show();return}go(e)}}function wo(){if(wt)return;wt=!0;const e=r("reservations.quote.toast.viewGuide","ğŸ“˜ Ø¹Ø±Ø¶ Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø­Ù„ Ø§Ù„Ø³Ø±ÙŠØ¹"),t=r("reservations.quote.toast.retry","Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©"),n=r("reservations.quote.toast.assetsFailed","âš ï¸ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø¨Ø¹Ø¶ Ø§Ù„ØµÙˆØ± Ø¶Ù…Ù† Ø¹Ø±Ø¶ Ø³Ø¹Ø±."),a=!!q?.modal?.classList.contains("show"),o=()=>{q?.modal?.classList.contains("show")&&(ot("render"),wt=!1,qe())};zn({message:n,duration:9e3,actionLabel:a?t:void 0,onAction:a?o:void 0,linkLabel:e,linkHref:ea}),a&&ot("error",{message:n,actionLabel:t,onAction:o,showSpinner:!1})}function $t(e="reservation"){const t={},n=na(e);return Object.entries(n).forEach(([a,o=[]])=>{t[a]=new Set(o.filter(u=>u?.default!==!1).map(u=>u.id))}),t}function wn(e={}){const t={};return Object.entries(e).forEach(([n,a])=>{t[n]=new Set(Array.from(a||[]))}),t}function qo(e={},t){if(t)return e[t]||(e[t]=new Set),e[t]}function qn(e={},t,n){const a=e?.[t];return a?a instanceof Set?a.has(n):Array.isArray(a)?a.includes(n):!!a?.[n]:!0}function Gt(e="reservation"){return Object.fromEntries(Qt(e).map(({id:t})=>[t,!1]))}function Sn(e,t){return e.sectionExpansions||(e.sectionExpansions=Gt(e.context||"reservation")),t&&typeof e.sectionExpansions[t]!="boolean"&&(e.sectionExpansions[t]=!1),e.sectionExpansions}function So(e,t){return Sn(e,t)?.[t]!==!1}function An(){return typeof window>"u"||typeof window.matchMedia!="function"?!1:window.matchMedia("(max-width: 768px)").matches}function Ao(){if(typeof navigator>"u")return!1;const e=navigator.userAgent||navigator.platform||"";return oo.test(e)}function ko(){if(typeof navigator>"u")return!1;const e=navigator.userAgent||"",t=ma.test(e),n=e.includes("Chrome")||e.includes("CriOS")||e.includes("Chromium"),a=e.includes("Edg");return t&&!n&&!a}function ha(){return Ao()&&ko()}function Wt(){if(typeof navigator>"u")return!1;const e=navigator.userAgent||"",t=navigator.platform||"",n=Number.isFinite(navigator.maxTouchPoints)?navigator.maxTouchPoints:0,a=Dn.test(e)||Dn.test(t),o=/Macintosh/i.test(e)&&n>1;return ma.test(e)&&!so.test(e)&&(a||o)}function en(e,...t){try{console.log(`${Mt} ${e}`,...t)}catch{}}function Ge(e,...t){try{console.warn(`${Mt} ${e}`,...t)}catch{}}function _o(e,t,...n){try{t?console.error(`${Mt} ${e}`,t,...n):console.error(`${Mt} ${e}`,...n)}catch{}}function le(e,{blockType:t="section",extraAttributes:n=""}={}){if(!e)return"";const a=n?` ${n.trim()}`:"";return e.replace(/^(<\w+)/,`$1 data-quote-block data-block-type="${t}"${a}`)}function xo(e,t="Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¹Ø±Ø¶."){const n=l(r(e,t));return le(`<section class="quote-section quote-placeholder">${n}</section>`,{blockType:"placeholder"})}function Rt(e,t){return Array.isArray(e)&&e.length?e:[xo(t)]}const $o=/[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF]/;function ba(e=""){return $o.test(e)}function To(){const e=window.CanvasRenderingContext2D?.prototype;if(!e||e.__artRatioDirectionPatched)return;const t=n=>{const a=e[n];typeof a=="function"&&(e[n]=function(u,...s){if(typeof u!="string"||!ba(u))return a.call(this,u,...s);let c,d=!1;try{"direction"in this&&(c=this.direction,c!=="rtl"&&(this.direction="rtl"),d=!0)}catch{}try{if(!d){const y=this.canvas;y&&y.style?.direction!=="rtl"&&(y.__artRatioOriginalDirection=y.style.direction,y.style.direction="rtl")}return a.call(this,u,...s)}finally{if(d&&c!==void 0&&c!=="rtl")try{this.direction=c}catch{}else if(!d){const y=this.canvas;y&&y.__artRatioOriginalDirection!==void 0&&(y.style.direction=y.__artRatioOriginalDirection,delete y.__artRatioOriginalDirection)}}})};t("fillText"),t("strokeText"),e.__artRatioDirectionPatched=!0}function Mn(e,t=vt){if(typeof e!="string"&&typeof e!="number")return t;const n=parseFloat(String(e).replace(/[^0-9.+-]/g,""));return Number.isFinite(n)&&n>0?n:t}function Co(e){if(!e)return{width:vt,height:vt};const t=e.getAttribute?.("width"),n=e.getAttribute?.("height");let a=t?Mn(t,0):0,o=n?Mn(n,0):0;if(a>0&&o>0)return{width:a,height:o};const u=e.getAttribute?.("viewBox");if(u){const s=u.trim().split(/[\s,]+/).map(c=>parseFloat(c||"0"));if(s.length>=4){const[,,c,d]=s;a=a||(Number.isFinite(c)&&c>0?c:0),o=o||(Number.isFinite(d)&&d>0?d:0)}}return{width:a||vt,height:o||vt}}function ga(e=""){return typeof e!="string"?!1:la.test(e)||ao.test(e)}function jo(e=""){const t=e.indexOf(",");if(t===-1)return"";const n=e.slice(0,t),a=e.slice(t+1);try{return/;base64/i.test(n)?typeof atob=="function"?atob(a):"":decodeURIComponent(a)}catch(o){return console.warn("[reservations/pdf] failed to decode SVG data URI",o),""}}function Eo(e,{crossOrigin:t}={}){return new Promise((n,a)=>{const o=new Image;t&&(o.crossOrigin=t),o.onload=()=>n(o),o.onerror=u=>{const s=u?.message||`Unable to load image from ${e}`;a(new Error(s))},o.src=e})}async function va(e,t={}){if(!e)return null;const n=document,a=new Blob([e],{type:"image/svg+xml;charset=utf-8"}),o=URL.createObjectURL(a);try{const u=await Eo(o),s=n.createElement("canvas"),c=Math.max(t.width||u.naturalWidth||u.width||0,1),d=Math.max(t.height||u.naturalHeight||u.height||c,1);s.width=c,s.height=d;const y=s.getContext("2d");return y.clearRect(0,0,c,d),y.drawImage(u,0,0,c,d),s.toDataURL("image/png")}catch(u){return console.warn("[reservations/pdf] failed to rasterize SVG content",u),null}finally{URL.revokeObjectURL(o)}}async function No(e){if(!e)return null;if(la.test(e))return jo(e);try{const t=await fetch(e,{mode:"cors",credentials:"omit",cache:"default"});return t.ok?await t.text():(console.warn("[reservations/pdf] failed to fetch SVG image",e,t.status),null)}catch(t){return console.warn("[reservations/pdf] error fetching SVG image",e,t),null}}async function Io(e){if(!e)return!1;const t=e.getAttribute?.("src")||"";if(!ga(t))return!1;const n=await No(t);if(!n)return e.dataset.svgRasterization="failed",e.setAttribute("src",nn),!1;const a=await va(n);return a?(e.dataset.svgOriginalSrc=t,e.setAttribute("src",a),e.setAttribute("data-rasterized","true"),!0):(e.dataset.svgRasterization="failed",e.setAttribute("src",nn),!1)}async function Po(e){if(!e||e.tagName?.toLowerCase()!=="svg")return!1;const n=new XMLSerializer().serializeToString(e),a=Co(e),o=await va(n,a),s=(e.ownerDocument||document).createElement("img");s.setAttribute("src",o||nn),s.setAttribute("alt",e.getAttribute("aria-label")||e.getAttribute("title")||""),s.setAttribute("data-svg-replaced","true"),e.hasAttribute("class")&&s.setAttribute("class",e.getAttribute("class")),e.hasAttribute("style")&&s.setAttribute("style",e.getAttribute("style"));const c=e.getAttribute("width"),d=e.getAttribute("height");return c&&s.setAttribute("width",c),d&&s.setAttribute("height",d),e.parentNode?.replaceChild(s,e),!!o}async function wa(e){if(!e)return;const t=Array.from(e.querySelectorAll?.("img")||[]),n=Array.from(e.querySelectorAll?.("svg")||[]),a=[];t.forEach(o=>{ga(o.getAttribute?.("src"))&&a.push(Io(o))}),n.forEach(o=>{a.push(Po(o))}),a.length&&await Promise.allSettled(a)}function Do(e,{pixelRatio:t=1}={}){if(!e)return null;const n=e.ownerDocument||document,o=(n.defaultView||window).getComputedStyle?.(e);if(!o)return null;const u=(j,V=0)=>{const ce=parseFloat(j);return Number.isFinite(ce)?ce:V},s=u(o.paddingTop),c=u(o.paddingBottom),d=u(o.paddingRight),y=u(o.paddingLeft),g=u(o.borderRadius),_=u(o.fontSize,14),A=(()=>{const j=o.lineHeight;if(!j||j==="normal")return _*1.6;const V=u(j,_*1.6);return V>0?V:_*1.6})(),v=Math.max(e.clientWidth||0,e.scrollWidth||0,u(o.width,0));if(v<=0)return null;const h=Math.max(1,v-y-d),M=e.textContent||"",S=M.split(/\r?\n/),C=n.createElement("canvas"),k=C.getContext("2d");if(!k)return null;const R=o.fontStyle||"normal",H=o.fontVariant||"normal",ae=o.fontWeight||"400",f=o.fontFamily||"sans-serif",w=o.fontStretch||"normal",T=j=>j.join(" "),N=[],P=j=>k.measureText(j).width;k.font=`${R} ${H} ${ae} ${w} ${_}px ${f}`,S.forEach(j=>{const V=j.trim();if(V.length===0){N.push("");return}const ce=V.split(/\s+/);let ie=[];ce.forEach((xe,Ke)=>{const Se=xe.trim();if(!Se)return;const De=T(ie.concat(Se));if(P(De)<=h||ie.length===0){ie.push(Se);return}N.push(T(ie)),ie=[Se]}),ie.length&&N.push(T(ie))}),N.length||N.push("");const $=s+c+N.length*A,re=Math.ceil(Math.max(1,v)*t),O=Math.ceil(Math.max(1,$)*t);C.width=re,C.height=O,C.style.width=`${Math.max(1,v)}px`,C.style.height=`${Math.max(1,$)}px`,k.scale(t,t);const se=o.backgroundColor&&o.backgroundColor!=="rgba(0, 0, 0, 0)"?o.backgroundColor:"#ffffff";if(g>0){k.save(),k.beginPath();const j=Math.max(1,v),V=Math.max(1,$),ce=Math.min(g,j/2,V/2);k.moveTo(ce,0),k.lineTo(j-ce,0),k.quadraticCurveTo(j,0,j,ce),k.lineTo(j,V-ce),k.quadraticCurveTo(j,V,j-ce,V),k.lineTo(ce,V),k.quadraticCurveTo(0,V,0,V-ce),k.lineTo(0,ce),k.quadraticCurveTo(0,0,ce,0),k.closePath(),k.clip()}if(k.fillStyle=se,k.fillRect(0,0,Math.max(1,v),Math.max(1,$)),k.font=`${R} ${H} ${ae} ${w} ${_}px ${f}`,k.fillStyle=o.color||"#000000",k.textBaseline="top",k.textAlign="right","direction"in k)try{k.direction="rtl"}catch{}const ee=Math.max(0,v-d);let K=s;N.forEach(j=>{const V=j.length?j:" ";k.fillText(V,ee,K,h),K+=A});const te=n.createElement("img");let me;try{me=C.toDataURL("image/png")}catch(j){return Ge("note canvas toDataURL failed",j),null}return te.src=me,te.alt=M,te.style.width=`${Math.max(1,v)}px`,te.style.height=`${Math.max(1,$)}px`,te.style.display="block",te.setAttribute("data-quote-note-image","true"),{image:te,canvas:C,totalHeight:$,width:v}}function Lo(e,{pixelRatio:t=1}={}){if(!e||!Wt())return;Array.from(e.querySelectorAll?.(".quote-notes")||[]).forEach(a=>{if(!a||a.dataset.quoteNoteRasterized==="true"||!ba(a.textContent||""))return;let o;try{o=Do(a,{pixelRatio:t})}catch(u){Ge("failed to rasterize note content",u),o=null}o&&(a.dataset.quoteNoteRasterized="true",a.innerHTML="",a.appendChild(o.image))})}function cn(e,t="export",{toastMessage:n,suppressToast:a=!1}={}){_o(`${t} failed`,e);const o=!!(e&&e.__artRatioPdfNotified);if(!a&&!o){const u=r("reservations.quote.errors.exportFailed","âš ï¸ ØªØ¹Ø°Ø± Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù PDFØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰."),s=n||u,c=r("reservations.quote.toast.viewGuide","ğŸ“˜ Ø¹Ø±Ø¶ Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø­Ù„ Ø§Ù„Ø³Ø±ÙŠØ¹"),d=r("reservations.quote.toast.retry","Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©"),y=["exportQuoteAsPdf","renderQuotePreview","layoutQuoteDocument","pageCapture"].includes(t),g=()=>{t==="exportQuoteAsPdf"?(ot("export"),Ta()):(ot("render"),wt=!1,qe())};if(zn({message:s,duration:9e3,actionLabel:y?d:void 0,onAction:y?g:void 0,linkLabel:c,linkHref:ea}),q?.modal?.classList.contains("show")&&ot("error",{message:s,actionLabel:y?d:void 0,onAction:y?g:void 0,showSpinner:!1}),e&&typeof e=="object")try{Object.defineProperty(e,"__artRatioPdfNotified",{value:!0,writable:!1,enumerable:!1,configurable:!0})}catch{}}}function un({container:e,safariWindowRef:t,mobileWindowRef:n}={}){try{n&&!n.closed&&n.close()}catch(a){Ge("failed to close mobile window",a)}try{t&&!t.closed&&t.close()}catch(a){Ge("failed to close safari window",a)}e&&e.parentNode&&e.parentNode.removeChild(e)}function kn(e){return new Promise((t,n)=>{const a=document.querySelector(`script[src="${e}"]`);if(a){a.addEventListener("load",()=>t()),a.addEventListener("error",u=>n(u)),a.readyState==="complete"&&t();return}const o=document.createElement("script");o.src=e,o.async=!0,o.onload=()=>t(),o.onerror=u=>n(u),document.head.appendChild(o)})}function Rn(){const e=[window.jspdf?.jsPDF,typeof window.jspdf=="function"?window.jspdf:null,window.jsPDF?.jsPDF,typeof window.jsPDF=="function"?window.jsPDF:null].filter(t=>typeof t=="function");return e.length?e[0]:null}function On(){return typeof window.html2canvas=="function"?window.html2canvas:null}async function Fo(){const e=On();return e||(gt||(gt=kn(to).catch(t=>{throw gt=null,t}).then(()=>{const t=On();if(!t)throw gt=null,new Error("ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© html2canvas Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.");return t})),gt)}async function Mo(){const e=Rn();return e||(bt||(bt=kn(no).catch(t=>{throw bt=null,t}).then(()=>{const t=Rn();if(!t)throw bt=null,new Error("ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© jsPDF Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.");return t})),bt)}async function Ro(){if(window.html2pdf||await kn(eo),window.html2pdf&&!window.html2pdf.__artRatioConfigured){const e=window.html2pdf.defaultOptions||window.html2pdf.defaultOpt||{},t={...e.html2canvas||{}};t.useCORS=!0,t.allowTaint=!1,t.logging=!0;const n={unit:"mm",format:"a4",orientation:"portrait",compress:!0,...e.jsPDF||{}},a={image:{type:"jpeg",quality:.95,...e.image||{}},margin:e.margin??[0,0,0,0],filename:e.filename||"document.pdf",html2canvas:t,jsPDF:n};window.html2pdf.defaultOptions=a,window.html2pdf.defaultOpt=a,window.html2pdf.__artRatioConfigured=!0}Ha(),To()}function l(e=""){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function qa(e="reservation"){return Pn[e]||Pn.reservation}function Oo(){try{window.localStorage?.removeItem?.(Va)}catch{}}function Bo(e="reservation"){try{Oo();const t=qa(e),n=window.localStorage?.getItem?.(t);if(!n)return null;const a=JSON.parse(n);return a&&typeof a=="object"?a:null}catch(t){return console.warn("âš ï¸ [reservations/pdf] failed to read toggle preferences",t),null}}function Ko(e,t="reservation"){try{const n=qa(t);if(!e){window.localStorage?.removeItem?.(n);return}window.localStorage?.setItem?.(n,JSON.stringify(e))}catch(n){console.warn("âš ï¸ [reservations/pdf] failed to persist toggle preferences",n)}}function Ho(e){if(!e)return{ids:null,emptyExplicitly:!1};if(e instanceof Set)return{ids:Array.from(e),emptyExplicitly:e.size===0};if(Array.isArray(e))return{ids:e.slice(),emptyExplicitly:e.length===0};if(typeof e=="object"){const t=Object.entries(e).filter(([,n])=>!!n);return{ids:t.map(([n])=>n),emptyExplicitly:t.length===0}}return{ids:null,emptyExplicitly:!1}}function zo(e,t="reservation"){if(!e)return null;const n=aa(t),a=oa(t),o=Array.from(e.sections instanceof Set?e.sections:new Set(e.sections||[])).filter(c=>n.has(c)),u={},s=e.fields||{};return Object.entries(a).forEach(([c,d])=>{const y=s[c];if(y==null)return;const{ids:g,emptyExplicitly:_}=Ho(y);if(!g&&!_)return;const A=Array.isArray(g)?g.filter(v=>d.has(v)):[];(A.length>0||_)&&(u[c]=A)}),{version:1,sections:o,fields:u}}function Sa(e){if(!e)return;const t=e.context||"reservation",n=zo(e,t);n&&Ko(n,t)}function _n(e){if(!e)return;const t=e.context||"reservation",n=Bo(t);if(!n)return;const a=aa(t),o=Array.isArray(n.sections)?n.sections.filter(u=>a.has(u)):[];if(o.length&&(e.sections=new Set(o)),n.fields&&typeof n.fields=="object"){const u=wn(e.fields||$t(t)),s=oa(t);Object.entries(n.fields).forEach(([c,d])=>{const y=s[c];if(!y)return;const g=Array.isArray(d)?d.filter(_=>y.has(_)):[];u[c]=new Set(g)}),e.fields=u}}function xn(e=new Date){try{return e.toLocaleDateString("en-GB",{year:"numeric",month:"2-digit",day:"2-digit"})}catch{return e.toISOString().slice(0,10)}}function Yt(e){const t=Oa()||[],{technicians:n=[]}=dn(),a=[].concat(Array.isArray(t)?t:[]).concat(Array.isArray(n)?n:[]),o=new Map;return a.forEach(s=>{if(!s||s.id==null)return;const c=String(s.id),d=o.get(c)||{};o.set(c,{...d,...s})}),(Array.isArray(e.crewAssignments)&&e.crewAssignments.length?e.crewAssignments:Array.isArray(e.techniciansDetails)&&e.techniciansDetails.length?e.techniciansDetails:(e.technicians||[]).map(s=>({technicianId:s}))).map((s,c)=>{const d=s?.technicianId!=null?o.get(String(s.technicianId)):null;let y=s.positionLabel??s.position_name??s.position_label??s.role??s.position??d?.role??r("reservations.crew.positionFallback","Ù…Ù†ØµØ¨ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…");(!y||y.trim()==="")&&(y=s.positionLabelAr??s.position_label_ar??s.positionLabelEn??s.position_label_en??s.position_name_ar??s.position_name_en??d?.role??r("reservations.crew.positionFallback","Ù…Ù†ØµØ¨ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…"));try{const A=typeof ft=="function"?ft()||[]:[];let v=null;if(s?.positionId!=null&&(v=A.find(h=>String(h?.id)===String(s.positionId))||null),!v){const h=s.positionKey??s.position_key??s.positionName??s.position_name??s.position??"";if(h&&(v=typeof Nn=="function"&&Nn(h)||null,!v&&A.length)){const M=String(h).trim().toLowerCase();v=A.find(S=>[S.name,S.labelAr,S.labelEn].filter(Boolean).map(C=>String(C).toLowerCase()).includes(M))||null}}if(v){const h=v.labelAr||v.labelEn||v.name||"";h&&h.trim()&&(y=h)}}catch{}const g=At(Pt(s.positionCost??s.position_cost??s.cost??s.daily_wage??s.dailyWage??d?.dailyWage??d?.wage??0)),_=At(Pt(s.positionClientPrice??s.position_client_price??s.client_price??s.clientPrice??s.daily_total??s.dailyTotal??s.total??d?.dailyTotal??d?.total??d?.total_wage??0));return{assignmentId:s.assignmentId??s.assignment_id??`crew-${c}`,positionId:s.positionId??s.position_id??null,positionLabel:y,positionLabelAlt:s.positionLabelAlt??s.position_label_alt??"",positionCost:g,positionClientPrice:_,technicianId:s.technicianId!=null?String(s.technicianId):d?.id!=null?String(d.id):null,technicianName:s.technicianName??s.technician_name??d?.name??null,technicianRole:s.technicianRole??d?.role??null}})}function $n(e,t,n){const{projectLinked:a}=Da(e,n);pn(e.start,e.end);const o=e.discount??e.discountValue??0,u=Number(E(String(o)))||0,s=e.discountType??e.discount_type??"percent",c=String(s).toLowerCase()==="amount"?"amount":"percent",d=a?!1:!!(e.applyTax??e.apply_tax??e.taxApplied),y=e.companySharePercent??e.company_share_percent??e.companyShare??e.company_share??null,g=y!=null?Pt(y):Number.NaN,A=(e.companyShareEnabled??e.company_share_enabled??e.companyShareApplied??e.company_share_applied)===!0&&Number.isFinite(g)&&g>0?g:null,v=Array.isArray(t)?t.map(H=>H?.technicianId).filter(Boolean):[],h=Qn({items:Array.isArray(e.items)?e.items:[],technicianIds:v,crewAssignments:Array.isArray(t)?t:[],discount:u,discountType:c,applyTax:d,start:e.start,end:e.end,companySharePercent:A,groupingSource:e}),M=Pt(e.cost??e.total??e.finalTotal),S=Number.isFinite(M),C=a?h.finalTotal:S?At(M):h.finalTotal,k={equipmentTotal:h.equipmentTotal,equipmentCostTotal:h.equipmentCostTotal,crewTotal:h.crewTotal,crewCostTotal:h.crewCostTotal,discountAmount:h.discountAmount,subtotalAfterDiscount:h.subtotalAfterDiscount,taxableAmount:h.taxableAmount,taxAmount:h.taxAmount,finalTotal:C,companySharePercent:h.companySharePercent,companyShareAmount:h.companyShareAmount,netProfit:h.netProfit},R={equipmentTotal:pe(h.equipmentTotal),equipmentCostTotal:pe(h.equipmentCostTotal),crewTotal:pe(h.crewTotal),discountAmount:pe(h.discountAmount),subtotalAfterDiscount:pe(h.subtotalAfterDiscount),taxableAmount:pe(h.taxableAmount),taxAmount:pe(h.taxAmount),finalTotal:pe(C),companySharePercent:E((Number.isFinite(h.companySharePercent)?h.companySharePercent:0).toFixed(2)),companyShareAmount:pe(h.companyShareAmount),netProfit:E(h.netProfit.toFixed(2))};return{totals:k,totalsDisplay:R,rentalDays:h.rentalDays}}function ht(e){if(e==null||e==="")return null;const t=Number.parseFloat(E(String(e)));return Number.isFinite(t)?t:null}function Aa(e){if(!e)return new Date().toISOString();const t=new Date(e);return Number.isNaN(t.getTime())?new Date().toISOString():t.toISOString()}function Qo(e){if(!e||typeof e!="object")return null;const t=e.type??e.payment_type??e.paymentType??null;let n=typeof t=="string"?t.trim().toLowerCase():null;n!=="percent"&&(n="amount");const a=ht(e.amount??(n==="amount"?e.value:null)),o=ht(e.percentage??(n==="percent"?e.value:null)),u=n==="percent"?o??null:a??null,s=e.note??e.memo??null,c=Aa(e.recordedAt??e.recorded_at??e.date??e.created_at??null);return n==="amount"&&a==null||n==="percent"&&o==null?null:{type:n,amount:a??null,percentage:o??null,value:u,note:s,recordedAt:c}}function Uo(e={}){const n=(Array.isArray(e.paymentHistory)?e.paymentHistory:Array.isArray(e.payment_history)?e.payment_history:[]).map(Qo).filter(Boolean);if(n.length>0)return n;const a=ht(e.paidPercent??e.paid_percent),o=ht(e.paidAmount??e.paid_amount),u=e.updatedAt??e.updated_at??e.createdAt??e.created_at??null,s=Aa(u);return a!=null&&a>0?[{type:"percent",amount:o!=null&&o>0?o:null,percentage:a,value:a,note:null,recordedAt:s}]:o!=null&&o>0?[{type:"amount",amount:o,percentage:null,value:o,note:null,recordedAt:s}]:[]}function Vo(e){if(!e)return r("projects.form.types.unknown","Ù†ÙˆØ¹ ØºÙŠØ± Ù…Ø­Ø¯Ø¯");const t={commercial:"projects.form.types.commercial",coverage:"projects.form.types.coverage",photography:"projects.form.types.photography",social:"projects.form.types.social"}[e]||"projects.form.types.unknown";return r(t,e)}function Go(e){const t=new Date,n=e?.start?new Date(e.start):null,a=e?.end?new Date(e.end):null;return n&&!Number.isNaN(n.getTime())&&n>t?"upcoming":a&&!Number.isNaN(a.getTime())&&a<t?"completed":"ongoing"}function Wo(e){if(Array.isArray(e?.expenses)&&e.expenses.some(a=>Number.isFinite(Number(a?.salePrice??a?.sale_price))))return e.expenses.reduce((a,o)=>a+(Number(o?.salePrice??o?.sale_price)||0),0);const t=Number(e?.servicesClientPrice??e?.services_client_price);return Number.isFinite(t)&&t>=0?t:typeof e?.expensesTotal=="number"?e.expensesTotal:Array.isArray(e?.expenses)?e.expenses.reduce((n,a)=>n+(Number(a?.amount)||0),0):0}function Yo(e){if(!e)return 0;const t=Array.isArray(e.items)?e.items:[],n=e.discount??0,a=Number(E(String(n)))||0,o=e.discountType||"percent",u=Array.isArray(e.crewAssignments)?e.crewAssignments:[],s=u.length?u:Array.isArray(e.technicians)?e.technicians:[],c=Ra(t,a,o,!1,s,{start:e.start,end:e.end,companySharePercent:0});if(Number.isFinite(c))return c;const d=Number(E(String(e.cost??0)));return Number.isFinite(d)?Math.round(d):0}function Xo(e,t){if(!e)return"â€”";const n=mt(e);return t?`${n} - ${mt(t)}`:n}function Z(e,t="SR",n=2){const a=Number(e);return`${pe(a)} ${t}`}function Bn(e,t=2){if(!Number.isFinite(Number(e)))return"0%";const n=Number.isInteger(t)?t:2;return`${E(Number(e).toFixed(n))}%`}function Jo(e){if(!e?.start)return null;if(!e?.end)return 1;const t=pn(e.start,e.end);return Number.isFinite(t)?t:1}function Zo(e){return Number.isFinite(e)?e<=1?"ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯":`${E(String(Math.round(e)))} Ø£ÙŠØ§Ù…`:"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}function Kn(e){const t=r("reservations.create.summary.currency","SR"),n=dn()||{},a=Array.isArray(n.customers)?n.customers:[],o=Array.isArray(n.projects)?n.projects:[],u=Array.isArray(n.technicians)?n.technicians:[];let s=[];try{const m=Vn?.()||[];s=Array.isArray(m)&&m.length?m:n.reservations||[]}catch{s=n.reservations||[]}const c=e?.id!=null?o.find(m=>String(m.id)===String(e.id))||e:e||null,d={projectStatusLabel:r("projects.status.ongoing","Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°"),paymentStatusLabel:r("projects.paymentStatus.unpaid","ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹")};if(!c)return{project:null,customer:null,clientInfo:{name:"-",company:"-",phone:"-",email:"-"},projectInfo:{title:"-",code:"-",typeLabel:"-",startDisplay:"-",endDisplay:"-",durationLabel:"-",statusLabel:d.projectStatusLabel},expenses:[],equipment:[],reservations:[],totals:{equipmentEstimate:0,expensesTotal:0,baseSubtotal:0,discountAmount:0,subtotalAfterDiscount:0,companyShareAmount:0,subtotal:0,applyTax:!1,taxAmount:0,totalWithTax:0},totalsDisplay:{projectSubtotal:Z(0,t),expensesTotal:Z(0,t),reservationsTotal:Z(0,t),discountAmount:Z(0,t),taxAmount:Z(0,t),overallTotal:Z(0,t),paidAmount:Z(0,t),remainingAmount:Z(0,t)},projectTotals:{combinedTaxAmount:0,overallTotal:0,reservationsTotal:0,paidAmount:0,paidPercent:0,remainingAmount:0,paymentStatus:"unpaid"},paymentSummary:{status:"unpaid",statusLabel:d.paymentStatusLabel,paidAmount:0,paidPercent:0,remainingAmount:0,paidAmountDisplay:Z(0,t),remainingAmountDisplay:Z(0,t),paidPercentDisplay:Bn(0)},notes:"",currencyLabel:t,projectStatus:"ongoing",projectStatusLabel:d.projectStatusLabel,projectDurationDays:null,projectDurationLabel:"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",paymentHistory:[]};const y=c.clientId??c.customerId??c.client_id??c.customer_id??null,g=y!=null&&a.find(m=>String(m.id)===String(y))||null,_=g?.customerName??g?.name??c.clientName??c.customerName??r("projects.fallback.unknownClient","Ø¹Ù…ÙŠÙ„ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"),A=(c.clientCompany||g?.companyName||g?.company||"").trim(),v=g?.phone??g?.customerPhone??c.clientPhone??c.customerPhone??"",h=v?E(String(v).trim()):r("projects.details.client.noPhone","Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù‚Ù… Ù…ØªØ§Ø­"),M=g?.email??c.clientEmail??c.customerEmail??"",S=M?String(M).trim():r("projects.details.client.noEmail","Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨Ø±ÙŠØ¯ Ù…ØªØ§Ø­"),C=c.projectCode||`PRJ-${E(String(c.id??""))}`,k=E(String(C)),R=(c.title||"").trim()||r("projects.fallback.untitled","Ù…Ø´Ø±ÙˆØ¹ Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†"),H=Vo(c.type),ae=c.start?mt(c.start):"â€”",f=c.end?mt(c.end):"â€”",w=Jo(c),T=w!=null?Zo(w):"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",N=Go(c),P={upcoming:"Ù‚Ø§Ø¯Ù…",ongoing:"Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°",completed:"Ù…ÙƒØªÙ…Ù„"},$=r(`projects.status.${N}`,P[N]||N),re=c.id!=null?String(c.id):null,O=re?s.filter(m=>{const Y=m?.projectId??m?.project_id??null;return Y!=null&&String(Y)===re}):[];O.map(m=>{const Y=m.reservationId||m.id||"",x=m.status||m.state||"pending",X=String(x).toLowerCase(),G=r(`reservations.status.${X}`,X),ne=Yo(m),ke=m.start?new Date(m.start).getTime():0;return{reservationId:E(String(Y||"-")),status:X,statusLabel:G,total:ne,totalLabel:Z(ne,t),dateRange:Xo(m.start,m.end),startTimestamp:Number.isNaN(ke)?0:ke}}).sort((m,Y)=>Y.startTimestamp-m.startTimestamp).map(({startTimestamp:m,...Y})=>Y);let se=0,ee=0;try{O.forEach(m=>{const Y=Qn({items:Array.isArray(m.items)?m.items:[],technicianIds:Array.isArray(m.technicians)?m.technicians:[],crewAssignments:Array.isArray(m.crewAssignments)?m.crewAssignments:[],discount:Number(m.discount??0)||0,discountType:m.discountType||"percent",applyTax:!1,start:m.start,end:m.end,groupingSource:m,companySharePercent:0});se+=Number(Y.equipmentTotal||0),ee+=Number(Y.crewTotal||0)})}catch{}const K=Wo(c),te=Number(se+ee+K),me=[];try{O.forEach(m=>{const{groups:Y}=Un(m);Y.forEach(x=>{const X=Number(x?.count??x?.quantity??1)||1,G=Number(x?.unitPrice);let ne=Number.isFinite(G)?G:0;if(!ne||ne<=0){const he=Number(x?.totalPrice);Number.isFinite(he)&&X>0&&(ne=Number((he/X).toFixed(2)))}Number.isFinite(ne)||(ne=0);const ke=x?.type==="package"||Array.isArray(x?.items)&&x.items.some(he=>he?.type==="package"),Ie=Array.isArray(x?.barcodes)&&x.barcodes.length?x.barcodes[0]:Array.isArray(x?.items)&&x.items.length?x.items[0]?.barcode:null;let fe=x?.packageDisplayCode??x?.package_code??x?.code??x?.packageCode??(Array.isArray(x?.items)&&x.items.length?x.items[0]?.package_code??x.items[0]?.code??x.items[0]?.packageCode:null);const tt=he=>{const $e=(he==null?"":String(he)).trim();return!!(!$e||/^pkg-/i.test($e)||/^\d+$/.test($e)&&$e.length<=4)};if(!fe||tt(fe)){const he=x?.packageId??x?.package_id??(Array.isArray(x?.items)&&x.items.length?x.items[0]?.packageId??x.items[0]?.package_id:null);if(he)try{const $e=Gn(he);$e&&$e.package_code&&(fe=$e.package_code)}catch{}}if(!fe||tt(fe))try{const he=dt(x?.description||"");if(he){const $e=Wn();let nt=$e.find(Ve=>dt(Ve?.name||Ve?.title||Ve?.label||"")===he);nt||(nt=$e.find(Ve=>{const Jt=dt(Ve?.name||Ve?.title||Ve?.label||"");return Jt.includes(he)||he.includes(Jt)})),nt&&nt.package_code&&(fe=nt.package_code)}}catch{}const Ue=ke?fe??Ie??"":x?.barcode??Ie??"",ct=Ue!=null?String(Ue):"",Xt=Number.isFinite(Number(x?.totalPrice))?Number(x.totalPrice):Number((ne*X).toFixed(2));me.push({...x,isPackage:ke,desc:x?.description,barcode:ct,packageCodeResolved:fe||"",qty:X,price:ne,totalPrice:At(Xt),unitPriceValue:ne})})})}catch{}const j=new Map;O.forEach(m=>{const Y=Array.isArray(m.items)?m.items:[],x=pn(m.start,m.end),X=m.reservationId||m.id||"";Y.forEach((G,ne)=>{if(!G)return;const ke=G.barcode||G.code||G.id||G.desc||G.description||`item-${ne}`,Ie=String(ke||`item-${ne}`),fe=j.get(Ie)||{description:G.desc||G.description||G.name||G.barcode||`#${E(String(ne+1))}`,totalQuantity:0,reservationsCount:0,reservationIds:new Set,totalCost:0},tt=Number(G.qty)||1,Ue=Number(G.price)||0;fe.totalQuantity+=tt,fe.reservationIds.add(String(X));const ct=Ue*tt*Math.max(1,x);Number.isFinite(ct)&&(fe.totalCost+=ct),j.set(Ie,fe)})});const V=Array.from(j.values()).map(m=>({description:m.description,totalQuantity:m.totalQuantity,reservationsCount:m.reservationIds.size,displayCost:Z(m.totalCost,t)})),ce=new Map((u||[]).filter(Boolean).map(m=>[String(m.id),m])),ie=new Map,xe=m=>{if(!m)return;let Y=null;typeof m=="object"?Y=m.id??m.technicianId??m.technician_id??m.userId??m.user_id??null:(typeof m=="string"||typeof m=="number")&&(Y=m);const x=Y!=null?String(Y):null,X=x&&ce.has(x)?ce.get(x):typeof m=="object"?m:null,G=X?.name||X?.full_name||X?.fullName||X?.displayName||(typeof m=="string"?m:null),ne=X?.role||X?.title||null,ke=X?.phone||X?.mobile||X?.contact||null;if(!G&&!x)return;const Ie=x||G;ie.has(Ie)||ie.set(Ie,{id:x,name:G||"-",role:ne||null,phone:ke||null})};Array.isArray(c?.technicians)&&c.technicians.forEach(m=>xe(m)),O.forEach(m=>{(Array.isArray(m.crewAssignments)&&m.crewAssignments.length?m.crewAssignments:Array.isArray(m.technicians)?m.technicians.map(x=>({technicianId:x})):[]).forEach(x=>xe(x))});const Ke=Array.from(ie.values()),Se=Array.isArray(c.expenses)?c.expenses.map(m=>{const Y=Number(m?.salePrice??m?.sale_price??m?.amount)||0;return{label:m?.label||m?.name||"-",amount:Y,displayAmount:Z(Y,t),note:m?.note||m?.description||""}}):[],De=c?.applyTax===!0||c?.applyTax==="true",Me=Number.parseFloat(c?.discount??c?.discountValue??0)||0;let ge=(c?.discountType==="amount"?"amount":"percent")==="amount"?Me:te*(Me/100);(!Number.isFinite(ge)||ge<0)&&(ge=0),ge>te&&(ge=te);const ze=Math.max(0,te-ge),We=c?.companyShareEnabled===!0||c?.company_share_enabled===!0||c?.companyShareApplied===!0||c?.company_share_applied===!0,et=Number.parseFloat(c?.companySharePercent??c?.company_share_percent??c?.companyShare??c?.company_share??0)||0,Ne=We&&et>0?et:0,st=Ne>0?Number((ze*(Ne/100)).toFixed(2)):0,Le=Number((ze+st).toFixed(2)),Ye=De?Number((Le*Ba).toFixed(2)):0,Ae=Number((Le+Ye).toFixed(2)),Te=Uo(c),Xe=ht(c.paidAmount??c.paid_amount)||0,rt=ht(c.paidPercent??c.paid_percent)||0,Qe=Fa({totalAmount:Ae,paidAmount:Xe,paidPercent:rt,history:Te}),it=typeof c.paymentStatus=="string"?c.paymentStatus.toLowerCase():"",Re=Ma({manualStatus:it,paidAmount:Qe.paidAmount,paidPercent:Qe.paidPercent,totalAmount:Ae}),lt={paid:"Ù…Ø¯ÙÙˆØ¹",partial:"Ù…Ø¯ÙÙˆØ¹ Ø¬Ø²Ø¦ÙŠØ§Ù‹",unpaid:"ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹"},b=r(`projects.paymentStatus.${Re}`,lt[Re]||Re),D=Number(Qe.paidAmount||0),L=Number(Qe.paidPercent||0),W=Math.max(0,Number((Ae-D).toFixed(2))),U={projectSubtotal:Z(Le,t),expensesTotal:Z(K,t),reservationsTotal:Z(Le,t),discountAmount:Z(ge,t),taxAmount:Z(Ye,t),overallTotal:Z(Ae,t),paidAmount:Z(D,t),remainingAmount:Z(W,t)},Q={status:Re,statusLabel:b,paidAmount:D,paidPercent:L,remainingAmount:W,paidAmountDisplay:Z(D,t),remainingAmountDisplay:Z(W,t),paidPercentDisplay:Bn(L)},B=(c.description||"").trim();return{project:c,customer:g,clientInfo:{name:_,company:A||"â€”",phone:h,email:S},projectInfo:{title:R,code:k,typeLabel:H,startDisplay:ae,endDisplay:f,durationLabel:T,statusLabel:$},expenses:Se,equipment:V,crew:Ke,equipmentItems:me,crewAssignments:O.flatMap(m=>Yt(m)),totals:{equipmentEstimate:se,expensesTotal:K,baseSubtotal:te,discountAmount:ge,subtotalAfterDiscount:ze,companyShareAmount:st,subtotal:Le,applyTax:De,taxAmount:Ye,totalWithTax:Ae},totalsDisplay:U,projectTotals:{combinedTaxAmount:Ye,overallTotal:Ae,reservationsTotal:Le,paidAmount:D,paidPercent:L,remainingAmount:W,paymentStatus:Re},paymentSummary:Q,notes:B,currencyLabel:t,projectStatus:N,projectStatusLabel:$,projectDurationDays:w,projectDurationLabel:T,paymentHistory:Te}}function es({project:e,clientInfo:t={},projectInfo:n={},projectCrew:a=[],projectExpenses:o=[],projectEquipment:u=[],totalsDisplay:s={},projectTotals:c={},paymentSummary:d={},currencyLabel:y="SR",sections:g,fieldSelections:_={},quoteNumber:A,quoteDate:v,terms:h=Ee}){const M=wn(_),S=(b,D)=>qn(M,b,D),C=b=>g?.has?.(b),k=`<div class="quote-placeholder">${l(r("reservations.quote.placeholder.noFields","Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù„Ù„Ø¹Ø±Ø¶ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…."))}</div>`,R=(b,D)=>`<div class="info-plain__item">
      <span class="info-plain__label">${l(b)}</span>
      <span class="info-plain__separator">:</span>
      <span class="info-plain__value">${l(D)}</span>
    </div>`,H=(b,D,{variant:L="inline"}={})=>L==="final"?`<div class="totals-item totals-item--final">
        <span class="totals-item__label">${l(b)}</span>
        <span class="totals-item__slash">/</span>
        <span class="totals-item__value">${l(D)}</span>
      </div>`:`<span class="totals-inline__item">
      <span class="totals-inline__label">${l(b)}</span>
      <span class="totals-inline__slash">/</span>
      <span class="totals-inline__value">${l(D)}</span>
    </span>`,ae=(b,D)=>`<div class="payment-row">
      <span class="payment-row__label">${l(b)}</span>
      <span class="payment-row__slash">/</span>
      <span class="payment-row__value">${l(D)}</span>
    </div>`,f=(b,D,L)=>{const W=`${b}-title`,U=`${b}-content`;return`
      <div class="quote-section__head" data-drag-key="${l(W)}">
        ${D}
      </div>
      <div class="quote-section__body" data-drag-key="${l(U)}">
        ${L}
      </div>
    `},w=[];S("customerInfo","customerName")&&w.push(R(r("projects.details.client","Ø§Ù„Ø¹Ù…ÙŠÙ„"),t.name||"-")),S("customerInfo","customerCompany")&&w.push(R(r("projects.details.company","Ø´Ø±ÙƒØ© Ø§Ù„Ø¹Ù…ÙŠÙ„"),t.company||"â€”")),S("customerInfo","customerPhone")&&w.push(R(r("projects.details.labels.clientPhone","Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„"),t.phone||"-")),S("customerInfo","customerEmail")&&w.push(R(r("projects.details.labels.clientEmail","Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"),t.email||"-"));const T=qt(i,"projectCustomer"),N=C("customerInfo")?`<section class="quote-section quote-section--plain quote-section--customer">
        ${f("customer",`<h3 class="quote-section__title">${l(r("projects.quote.sections.customer","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„"))}</h3>`,w.length?`<div class="${T}">${w.join("")}</div>`:k)}
      </section>`:"",P=[];S("projectInfo","projectType")&&P.push(R(r("projects.details.type","Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.typeLabel||"-")),S("projectInfo","projectTitle")&&P.push(R(r("projects.details.projectTitle","Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.title||"-")),S("projectInfo","projectCode")&&P.push(R(r("projects.details.labels.code","Ø±Ù‚Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.code||"-")),S("projectInfo","projectStart")&&P.push(R(r("projects.details.start","Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.startDisplay||"-")),S("projectInfo","projectEnd")&&P.push(R(r("projects.details.end","Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.endDisplay||"-")),S("projectInfo","projectDuration")&&P.push(R(r("projects.details.duration","Ù…Ø¯Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.durationLabel||"-")),S("projectInfo","projectStatus")&&P.push(R(r("projects.details.status","Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.statusLabel||"-"));const $=qt(i,"projectDetails"),re=C("projectInfo")?`<section class="quote-section quote-section--plain quote-section--project">
        ${f("project",`<h3 class="quote-section__title">${l(r("projects.quote.sections.project","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"))}</h3>`,P.length?`<div class="${$}">${P.join("")}</div>`:k)}
      </section>`:"",O=Ht.filter(b=>S("projectCrew",b.id)),se=Array.isArray(i?.crewAssignments)?i.crewAssignments:[],ee=b=>{const D=b&&b.positionId!=null?`id:${String(b.positionId)}`:(()=>{const U=(b?.positionLabel||b?.position_name||b?.position||"").trim().toLowerCase();return U?`label:${U}`:""})(),L=Number.isFinite(Number(b?.positionClientPrice))?Number(b.positionClientPrice):0,W=L>0?`|p:${L.toFixed(2)}`:"";return`${D}${W}`};(()=>{const b=new Map;return se.forEach(D=>{const L=ee(D);L&&b.set(L,(b.get(L)||0)+1)}),b})();const K=(()=>{const b=[];if(O.forEach(Q=>{Q.id==="position"?(b.push({...Q,render:B=>{const ve=typeof oe=="function"?oe():"ar";let m=B?.positionLabelEn??B?.position_label_en??B?.position_name_en??B?.positionLabelAlt??B?.position_label_alt??B?.role;if(!m&&ve==="en")try{const X=typeof ft=="function"?ft():[];let G=null;if(B?.positionId!=null&&(G=X.find(ne=>String(ne.id)===String(B.positionId))||null),!G){const ne=B?.positionKey??B?.position_key??B?.positionName??B?.position_name??B?.position??"";if(ne){const ke=String(ne).toLowerCase();G=X.find(Ie=>String(Ie.name).toLowerCase()===ke)||null}}G&&(m=G.labelEn??G.label_en??G.name_en??m)}catch{}const Y=B?.positionLabel??B?.position_name??B?.role??r("reservations.crew.positionFallback","Ù…Ù†ØµØ¨ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…");return l(E(String(ve==="en"&&m?m:Y)))}}),S("projectCrew","quantity")&&b.push({id:"quantity",labelKey:"reservations.details.table.headers.quantity",fallback:"Ø§Ù„ÙƒÙ…ÙŠØ©",render:B=>l(E(String(Math.max(1,Number(B?.__count||1)))))})):Q.id==="price"?b.push({...Q,render:B=>{const ve=Number.isFinite(Number(B?.positionClientPrice))?Number(B.positionClientPrice):0,m=Math.max(1,Number(B?.__count||1)),Y=Math.max(1,Number(i?.rentalDays||1)),x=ve*m*Y;return l(`${pe(x)} ${r("reservations.create.summary.currency","SR")}`)}}):Q.id==="unitPrice"?b.push({...Q,render:B=>{const ve=Number.isFinite(Number(B?.positionClientPrice))?Number(B.positionClientPrice):0;return l(`${pe(ve)} ${r("reservations.create.summary.currency","SR")}`)}}):b.push(Q)}),S("projectCrew","days")){const Q=Math.max(1,Number(i?.rentalDays||1)),B=b.findIndex(m=>m.id==="price"),ve=Math.max(0,B);b.splice(ve,0,{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…",render:()=>l(E(String(Q)))})}const D=new Map(b.map(Q=>[Q.id,Q])),L=new Set,W=[],U=Q=>{const B=D.get(Q);B&&!L.has(Q)&&(W.push(B),L.add(Q))};return U("rowNumber"),U("position"),U("unitPrice"),U("quantity"),U("days"),U("price"),b.forEach(Q=>{L.has(Q.id)||(W.push(Q),L.add(Q.id))}),W})(),te=(()=>{const b=new Map;return se.forEach(D=>{const L=ee(D);if(!L)return;const W=b.get(L);W?W.__count+=1:b.set(L,{...D,__count:1})}),Array.from(b.values())})(),me=(()=>{try{const b=Math.max(1,Number(i?.rentalDays||1)),D=(te||[]).reduce((L,W)=>{const U=Number.isFinite(Number(W?.positionClientPrice))?Number(W.positionClientPrice):0,Q=Math.max(1,Number(W?.__count||1));return L+U*Q*b},0);return pe(D)}catch{return"0.00"}})(),j=C("projectCrew")?K.length?`<section class="quote-section quote-section--table">
            <h3>${l(r("projects.quote.sections.crew","Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„"))}</h3>
            <table class="quote-table">
              <thead>
                <tr>${K.map(b=>`<th>${l(b.labelKey?r(b.labelKey,b.fallback):b.fallback)}</th>`).join("")}</tr>
              </thead>
              <tbody>${te.length?te.map((b,D)=>`<tr>${K.map(L=>`<td><div class="quote-cell">${L.render(b,D)}</div></td>`).join("")}</tr>`).join(""):`<tr><td colspan="${Math.max(K.length,1)}" class="empty">${l(r("projects.details.crew.empty","Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ø§Ù‚Ù… ÙÙ†ÙŠ Ù…Ø±ØªØ¨Ø·."))}</td></tr>`}
              </tbody>
            </table>
            ${S("projectCrew","crewSubtotal")?`
              <div class="quote-table-subtotal">
                <span class="quote-table-subtotal__pill">
                  <span class="quote-table-subtotal__label">${l(r("reservations.details.labels.crewTotal","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±ÙŠÙ‚"))}</span>
                  <span class="quote-table-subtotal__value">${l(`${me} ${y}`)}</span>
                </span>
              </div>
            `:""}
          </section>`:`<section class="quote-section quote-section--table">
            <h3>${l(r("projects.quote.sections.crew","Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„"))}</h3>
            ${k}
          </section>`:"",V=[];S("financialSummary","discountAmount")&&V.push(H(r("reservations.details.labels.discount","Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ…"),s.discountAmount||Z(0,y)));const ce=r("projects.details.summary.preTaxTotal","Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©");S("financialSummary","reservationsTotal")&&V.push(H(ce,s.reservationsTotal||Z(0,y))),S("financialSummary","taxAmount")&&V.push(H(r("projects.details.summary.combinedTax","Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"),s.taxAmount||Z(0,y)));const ie=[];S("financialSummary","overallTotal")&&ie.push(H(r("projects.details.summary.overallTotal","Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ"),s.overallTotal||Z(0,y),{variant:"final"}));const xe=C("financialSummary")?!V.length&&!ie.length?`<section class="quote-section quote-section--financial">${k}</section>`:`<section class="quote-section quote-section--financial">
          ${f("projectFinancial",`<h3>${l(r("projects.quote.sections.financial","Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ"))}</h3>`,`<div class="totals-block">
              ${V.length?`<div class="totals-inline">${V.join("")}</div>`:""}
              ${ie.length?`<div class="totals-final">${ie.join("")}</div>`:""}
            </div>`)}
        </section>`:"",Ke=ta.filter(b=>S("projectExpenses",b.id)),Se=C("projectExpenses")?Ke.length?`<section class="quote-section quote-section--table">
            <h3>${l(r("projects.quote.sections.expenses","Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©"))}</h3>
            <table class="quote-table">
              <thead>
                <tr>${Ke.map(b=>`<th>${l(b.labelKey?r(b.labelKey,b.fallback):b.fallback)}</th>`).join("")}</tr>
              </thead>
              <tbody>${o.length?o.map((b,D)=>`<tr>${Ke.map(L=>`<td><div class="quote-cell">${L.render(b,D)}</div></td>`).join("")}</tr>`).join(""):`<tr><td colspan="${Math.max(Ke.length,1)}" class="empty">${l(r("projects.details.expenses.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ØªØ·Ù„Ø¨Ø§Øª Ù…Ø³Ø¬Ù„Ø©."))}</td></tr>`}
              </tbody>
            </table>
            ${S("projectExpenses","expensesSubtotal")?`
              <div class="quote-table-subtotal">
                <span class="quote-table-subtotal__pill">
                  <span class="quote-table-subtotal__label">${l(r("projects.details.expensesTotal","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©"))}</span>
                  <span class="quote-table-subtotal__value">${l(s.expensesTotal||Z(0,y))}</span>
                </span>
              </div>
            `:""}
          </section>`:`<section class="quote-section quote-section--table">
            <h3>${l(r("projects.quote.sections.expenses","Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©"))}</h3>
            ${k}
          </section>`:"",De=Kt.filter(b=>S("projectEquipment",b.id)),Me=(()=>{let b=[];if(De.forEach(U=>{U.id==="price"?b.push({...U,render:Q=>{const B=Number.isFinite(Number(Q?.unitPriceValue))?Number(Q.unitPriceValue):0,ve=Number.isFinite(Number(Q?.qty))?Math.max(1,Number(Q.qty)):1,m=Math.max(1,Number(i?.rentalDays||1)),Y=B*ve*m;return l(`${pe(Y)} ${r("reservations.create.summary.currency","SR")}`)}}):U.id==="unitPrice"?b.push({...U,render:Q=>{const B=Number.isFinite(Number(Q?.unitPriceValue))?Number(Q.unitPriceValue):0;return l(`${pe(B)} ${r("reservations.create.summary.currency","SR")}`)}}):b.push(U)}),S("projectEquipment","days")){const U=Math.max(1,Number(i?.rentalDays||1)),Q=b.findIndex(ve=>ve.id==="price"),B=Math.max(0,Q);b.splice(B,0,{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…",render:()=>l(E(String(U)))})}const D=new Map(b.map(U=>[U.id,U])),L=b.filter(U=>!["unitPrice","quantity","days","price"].includes(U.id)),W=["unitPrice","quantity","days","price"].map(U=>D.get(U)).filter(Boolean);return b=[...L,...W],b})(),He=Array.isArray(i?.equipmentItems)?i.equipmentItems:[],ge=(()=>{try{const b=Math.max(1,Number(i?.rentalDays||1)),D=(He||[]).reduce((L,W)=>{const U=Number.isFinite(Number(W?.unitPriceValue))?Number(W.unitPriceValue):0,Q=Number.isFinite(Number(W?.qty))?Math.max(1,Number(W.qty)):1;return L+U*Q*b},0);return pe(D)}catch{return"0.00"}})(),ze=C("projectEquipment")?Me.length?`<section class="quote-section quote-section--table">
            <h3>${l(r("projects.quote.sections.equipment","Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</h3>
            <table class="quote-table">
              <thead>
                <tr>${Me.map(b=>`<th>${l(b.labelKey?r(b.labelKey,b.fallback):b.fallback)}</th>`).join("")}</tr>
              </thead>
              <tbody>${He.length?He.map((b,D)=>`<tr>${Me.map(L=>`<td><div class="quote-cell">${L.render(b,D)}</div></td>`).join("")}</tr>`).join(""):`<tr><td colspan="${Math.max(Me.length,1)}" class="empty">${l(r("projects.details.equipment.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø¯Ø§Øª Ù…Ø±ØªØ¨Ø·Ø© Ø­Ø§Ù„ÙŠØ§Ù‹."))}</td></tr>`}
              </tbody>
            </table>
            ${S("projectEquipment","equipmentSubtotal")?`
              <div class="quote-table-subtotal">
                <span class="quote-table-subtotal__pill">
                  <span class="quote-table-subtotal__label">${l(r("reservations.details.labels.equipmentTotal","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</span>
                  <span class="quote-table-subtotal__value">${l(`${ge} ${y}`)}</span>
                </span>
              </div>
            `:""}
          </section>`:`<section class="quote-section quote-section--table">
            <h3>${l(r("projects.quote.sections.equipment","Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</h3>
            ${k}
          </section>`:"",We=(e?.description||"").trim()||"",et=C("projectNotes")?`<section class="quote-section">
        <h3>${l(r("projects.quote.sections.notes","Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"))}</h3>
        <div class="quote-notes">${l(We||r("projects.fallback.noDescription","Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ Ù„Ù„Ù…Ø´Ø±ÙˆØ¹."))}</div>
      </section>`:"",Ne=[];S("payment","beneficiary")&&Ne.push(ae(r("reservations.quote.labels.beneficiary","Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙÙŠØ¯"),be.beneficiaryName)),S("payment","bank")&&Ne.push(ae(r("reservations.quote.labels.bank","Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ"),be.bankName)),S("payment","account")&&Ne.push(ae(r("reservations.quote.labels.account","Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨"),E(be.accountNumber))),S("payment","iban")&&Ne.push(ae(r("reservations.quote.labels.iban","Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ¨Ø§Ù†"),E(be.iban)));const st=`<section class="quote-section">
      <div class="payment-block">
        <h3>${l(r("reservations.quote.sections.payment","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹"))}</h3>
        <div class="payment-rows">${Ne.length?Ne.join(""):k}</div>
      </div>
      <p class="quote-approval-note">${l(be.approvalNote)}</p>
    </section>`,Le=Array.isArray(h)&&h.length?h:Ee,Ye=`<footer class="quote-footer">
        <h4>${l(r("reservations.quote.labels.terms","Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø¹Ø§Ù…Ø©"))}</h4>
        <ul>${Le.map(b=>`<li>${l(b)}</li>`).join("")}</ul>
      </footer>`,Ae=[],Te=[];if(re&&Te.push({key:"project",html:re}),N&&Te.push({key:"customer",html:N}),Te.length>1){const b=Te.find(W=>W.key==="project"),D=Te.find(W=>W.key==="customer"),L=[];b?.html&&L.push(b.html),D?.html&&L.push(D.html),Ae.push(le(`<div class="quote-section-row quote-section-row--primary">${L.join("")}</div>`,{blockType:"group"}))}else Te.length===1&&Ae.push(le(Te[0].html));const Xe=[];j&&Xe.push(le(j,{blockType:"table",extraAttributes:'data-table-id="project-crew"'})),Se&&Xe.push(le(Se,{blockType:"table",extraAttributes:'data-table-id="project-expenses"'})),ze&&Xe.push(le(ze,{blockType:"table",extraAttributes:'data-table-id="project-equipment"'}));const rt=[];xe&&rt.push(le(xe,{blockType:"summary"})),et&&rt.push(le(et));let Qe=[];Qe=[...C("payment")?[le(st,{blockType:"payment"})]:[],le(Ye,{blockType:"footer"})];const it=[...Rt(Ae,"projects.quote.placeholder.primary"),...Xe,...Rt(rt,"projects.quote.placeholder.summary"),...Qe],Re=typeof oe=="function"?oe():"ar",lt=`
    <header class="quote-header" data-quote-header-template>
      <div class="quote-header__logo">
        <img class="quote-logo" src="${l(be.logoUrl)}" alt="${l(be.companyName)}" crossorigin="anonymous"/>
      </div>
      <div class="quote-header__title">
        <h1>${l(r("projects.quote.title","Ø¹Ø±Ø¶ Ø³Ø¹Ø±"))}</h1>
        <p class="quote-company-name">${l(r("quote.companyName",be.companyName))}</p>
        <p class="quote-company-cr">${l(r("reservations.quote.labels.cr","Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ"))}: ${l(be.commercialRegistry)}</p>
        <p class="quote-company-license">${l(r("reservations.quote.labels.mediaLicense","ØªØ±Ø®ÙŠØµ Ø¥Ø¹Ù„Ø§Ù…ÙŠ"))}: 159460</p>
      </div>
      <div class="quote-header__meta">
        <div class="quote-header__meta-item">
          <span>${l(r("reservations.details.labels.reservationId","Ø±Ù‚Ù… Ø§Ù„Ø¹Ø±Ø¶"))}</span>
          <strong>${l(A)}</strong>
        </div>
        <div class="quote-header__meta-item">
          <span>${l(r("projects.quote.labels.date","Ø§Ù„ØªØ§Ø±ÙŠØ®"))}</span>
          <strong>${l(v)}</strong>
        </div>
      </div>
    </header>
  `.trim();return`
    <div id="quotation-pdf-root" dir="rtl" data-lang="${l(Re)}">
      <style>${ia}${ra}</style>
      <div class="quote-document" data-quote-document>
        <div class="quote-preview-pages" data-quote-pages></div>
        <div class="quote-content-source" data-quote-source>
          ${lt}
          ${it.join("")}
        </div>
      </div>
    </div>
  `}function ka(e){if(e?.context==="project")return es(e);const{reservation:t,customer:n,project:a,crewAssignments:o,totals:u,totalsDisplay:s,rentalDays:c,currencyLabel:d,sections:y,fieldSelections:g={},quoteNumber:_,quoteDate:A,terms:v=Ee}=e,h=E(String(t?.reservationId??t?.id??"")),M=typeof oe=="function"?oe():"ar",S=t.start?E(mt(t.start)):"-",C=t.end?E(mt(t.end)):"-",k=n?.customerName||n?.full_name||n?.name||"-",R=n?.phone||"-",H=n?.email||"-",ae=n?.company||n?.company_name||"-",f=E(R),w=a?.title||a?.name||r("reservations.details.project.none","ØºÙŠØ± Ù…Ø±ØªØ¨Ø· Ø¨Ù…Ø´Ø±ÙˆØ¹"),T=a?.code||a?.projectCode||"",N=E(String(c)),P=t?.notes||"",$=Array.isArray(v)&&v.length?v:Ee,re=wn(g),O=(p,z)=>qn(re,p,z),se=p=>y?.has?.(p),ee=`<div class="quote-placeholder">${l(r("reservations.quote.placeholder.noFields","Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù„Ù„Ø¹Ø±Ø¶ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…."))}</div>`,K=(p,z)=>{const J=M==="en"?": ":" / ";return`<div class="info-plain__item">${l(p)}<span class="info-plain__slash">${J}</span><strong class="info-plain__value">${l(z)}</strong></div>`},te=(p,z,{variant:J="inline"}={})=>J==="final"?`<div class="totals-item totals-item--final">
        <span class="totals-item__label">${l(p)}</span>
        <span class="totals-item__slash">/</span>
        <span class="totals-item__value">${l(z)}</span>
      </div>`:`<span class="totals-inline__item">
      <span class="totals-inline__label">${l(p)}</span>
      <span class="totals-inline__slash">/</span>
      <span class="totals-inline__value">${l(z)}</span>
    </span>`,me=(p,z)=>`<div class="payment-row">
      <span class="payment-row__label">${l(p)}</span>
      <span class="payment-row__slash">/</span>
      <span class="payment-row__value">${l(z)}</span>
    </div>`,j=(p,z,J)=>{const ue=`${p}-title`,_e=`${p}-content`;return`
      <div class="quote-section__head" data-drag-key="${l(ue)}">
        ${z}
      </div>
      <div class="quote-section__body" data-drag-key="${l(_e)}">
        ${J}
      </div>
    `},V=[];O("customerInfo","customerName")&&V.push(K(r("reservations.details.labels.customer","Ø§Ù„Ø¹Ù…ÙŠÙ„"),k)),O("customerInfo","customerCompany")&&V.push(K(r("reservations.details.labels.company","Ø§Ù„Ø´Ø±ÙƒØ©"),ae)),O("customerInfo","customerPhone")&&V.push(K(r("reservations.details.labels.phone","Ø§Ù„Ù‡Ø§ØªÙ"),f)),O("customerInfo","customerEmail")&&V.push(K(r("reservations.details.labels.email","Ø§Ù„Ø¨Ø±ÙŠØ¯"),H));const ce=qt(i,"customer"),ie=se("customerInfo")&&V.length?`<section class="quote-section quote-section--plain quote-section--customer">
            ${j("customer",`<h3 class="quote-section__title">${l(r("reservations.quote.sections.customer","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„"))}</h3>`,`<div class="${ce}">${V.join("")}</div>`)}
          </section>`:"",xe=[];O("reservationInfo","reservationId")&&xe.push(K(r("reservations.details.labels.reservationId","Ø±Ù‚Ù… Ø§Ù„Ø­Ø¬Ø²"),h||"-")),O("reservationInfo","reservationStart")&&xe.push(K(r("reservations.details.labels.start","Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø­Ø¬Ø²"),S)),O("reservationInfo","reservationEnd")&&xe.push(K(r("reservations.details.labels.end","Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø­Ø¬Ø²"),C)),O("reservationInfo","reservationDuration")&&xe.push(K(r("reservations.details.labels.duration","Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…"),N));const Ke=qt(i,"reservation"),Se=se("reservationInfo")&&xe.length?`<section class="quote-section quote-section--plain quote-section--reservation">
            ${j("reservation",`<h3 class="quote-section__title">${l(r("reservations.quote.sections.reservation","ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²"))}</h3>`,`<div class="${Ke}">${xe.join("")}</div>`)}
          </section>`:"",De=[];O("projectInfo","projectTitle")&&De.push(K(r("reservations.details.labels.project","Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),w)),O("projectInfo","projectCode")&&De.push(K(r("reservations.details.labels.code","Ø§Ù„Ø±Ù…Ø²"),T||"-"));const Me=qt(i,"project"),He=se("projectInfo")&&De.length?`<section class="quote-section quote-section--plain quote-section--project">
            ${j("project",`<h3 class="quote-section__title">${l(r("reservations.quote.sections.project","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"))}</h3>`,`<div class="${Me}">${De.join("")}</div>`)}
          </section>`:"",ge=[];O("financialSummary","discountAmount")&&ge.push(te(r("reservations.details.labels.discount","Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ…"),`${s.discountAmount} ${d}`)),O("financialSummary","subtotalBeforeTax")&&ge.push(te(r("reservations.details.labels.subtotalBeforeTax","Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"),`${s.taxableAmount} ${d}`)),O("financialSummary","taxAmount")&&ge.push(te(r("reservations.details.labels.tax","Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"),`${s.taxAmount} ${d}`));const ze=O("financialSummary","finalTotal"),We=[];ze&&We.push(te(r("reservations.details.labels.total","Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ"),`${s.finalTotal} ${d}`,{variant:"final"}));const et=We.length?`<div class="totals-final">${We.join("")}</div>`:"",Ne=se("financialSummary")?!ge.length&&!ze?`<section class="quote-section quote-section--financial">${ee}</section>`:`<section class="quote-section quote-section--financial">
          ${j("financial",`<h3 class="quote-section__title">${l(r("reservations.details.labels.summary","Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ"))}</h3>`,`<div class="totals-block">
              ${ge.length?`<div class="totals-inline">${ge.join("")}</div>`:""}
              ${et}
            </div>`)}
        </section>`:"",{groups:st}=Un(t),Le=st.map(p=>{const z=Number(p?.count??p?.quantity??1)||1,J=Number(p?.unitPrice);let ue=Number.isFinite(J)?J:0;if(!ue||ue<=0){const de=Number(p?.totalPrice);Number.isFinite(de)&&z>0&&(ue=Number((de/z).toFixed(2)))}Number.isFinite(ue)||(ue=0);const _e=p?.type==="package"||Array.isArray(p?.items)&&p.items.some(de=>de?.type==="package"),Fe=Array.isArray(p?.barcodes)&&p.barcodes.length?p.barcodes[0]:Array.isArray(p?.items)&&p.items.length?p.items[0]?.barcode:null;let I=p?.packageDisplayCode??p?.package_code??p?.code??p?.packageCode??(Array.isArray(p?.items)&&p.items.length?p.items[0]?.package_code??p.items[0]?.code??p.items[0]?.packageCode:null);const F=de=>{const we=(de==null?"":String(de)).trim();return!!(!we||/^pkg-/i.test(we)||/^\d+$/.test(we)&&we.length<=4)};if(!I||F(I)){const de=p?.packageId??p?.package_id??(Array.isArray(p?.items)&&p.items.length?p.items[0]?.packageId??p.items[0]?.package_id:null);if(de)try{const we=Gn(de);we&&we.package_code&&(I=we.package_code)}catch{}}if(!I||F(I))try{const de=dt(p?.description||"");if(de){const we=Wn();let je=we.find(Pe=>dt(Pe?.name||Pe?.title||Pe?.label||"")===de);je||(je=we.find(Pe=>{const Tt=dt(Pe?.name||Pe?.title||Pe?.label||"");return Tt.includes(de)||de.includes(Tt)})),je&&je.package_code&&(I=je.package_code)}}catch{}const ye=_e?I??Fe??"":p?.barcode??Fe??"",Ce=ye!=null?String(ye):"";let Oe=Number.isFinite(Number(p?.totalPrice))?Number(p.totalPrice):Number((ue*z).toFixed(2));return Oe=At(Oe),{...p,isPackage:_e,desc:p?.description,barcode:Ce,packageCodeResolved:I||"",qty:z,price:Oe,totalPrice:Oe,unitPriceValue:ue}}),Ye=Kt.filter(p=>O("items",p.id)),Ae=(()=>{let p=[];Ye.forEach(I=>{I.id==="price"?p.push({...I,render:F=>{const ye=Number.isFinite(Number(F?.unitPriceValue))?Number(F.unitPriceValue):0,Ce=Number.isFinite(Number(F?.qty))?Math.max(1,Number(F.qty)):1,Oe=Math.max(1,Number(i?.rentalDays||1)),de=ye*Ce*Oe;return l(`${pe(de)} ${r("reservations.create.summary.currency","SR")}`)}}):I.id==="unitPrice"?p.push({...I,render:F=>{const ye=Number.isFinite(Number(F?.unitPriceValue))?Number(F.unitPriceValue):0;return l(`${pe(ye)} ${r("reservations.create.summary.currency","SR")}`)}}):p.push(I)});const z=Math.max(1,Number(i?.rentalDays||1));if(O("items","days")){const I=p.findIndex(ye=>ye.id==="price"),F=Math.max(0,I);p.splice(F,0,{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…",render:()=>l(E(String(z)))})}const J=new Map(p.map(I=>[I.id,I])),ue=p.filter(I=>!["unitPrice","quantity","days","price"].includes(I.id)),_e=["unitPrice","quantity"];J.has("days")&&_e.push("days"),_e.push("price");const Fe=_e.map(I=>J.get(I)).filter(Boolean);return p=[...ue,...Fe],p})(),Te=Ae.length>0,Xe=Te?Ae.map(p=>`<th>${l(p.labelKey?r(p.labelKey,p.fallback):p.fallback)}</th>`).join(""):"",Qe=Le.length>0?Le.map((p,z)=>`<tr>${Ae.map(J=>`<td><div class="quote-cell">${J.render(p,z)}</div></td>`).join("")}</tr>`).join(""):`<tr><td colspan="${Math.max(Ae.length,1)}" class="empty">${l(r("reservations.details.noItems","ğŸ“¦ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø¯Ø§Øª Ø¶Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø² Ø­Ø§Ù„ÙŠØ§Ù‹."))}</td></tr>`,it=se("items")?Te?`<section class="quote-section quote-section--table">
            <h3>${l(r("reservations.details.items.title","Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</h3>
            <table class="quote-table">
              <thead>
                <tr>${Xe}</tr>
              </thead>
              <tbody>${Qe}</tbody>
            </table>
            ${O("items","equipmentSubtotal")?`
              <div class="quote-table-subtotal">
                <span class="quote-table-subtotal__pill">
                  <span class="quote-table-subtotal__label">${l(r("reservations.details.labels.equipmentTotal","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</span>
                  <span class="quote-table-subtotal__value">${l(`${s.equipmentTotal} ${d}`)}</span>
                </span>
              </div>
            `:""}
          </section>`:`<section class="quote-section quote-section--table">
            <h3>${l(r("reservations.details.items.title","Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</h3>
            ${ee}
          </section>`:"",Re=Ht.filter(p=>O("crew",p.id)),lt=Re.length>0,b=Array.isArray(o)?o:[],D=p=>{const z=p&&p.positionId!=null?`id:${String(p.positionId)}`:(()=>{const _e=(p?.positionLabel||p?.position_name||p?.position||"").trim().toLowerCase();return _e?`label:${_e}`:""})(),J=Number.isFinite(Number(p?.positionClientPrice))?Number(p.positionClientPrice):0,ue=J>0?`|p:${J.toFixed(2)}`:"";return`${z}${ue}`};(()=>{const p=new Map;return b.forEach(z=>{const J=D(z);J&&p.set(J,(p.get(J)||0)+1)}),p})();const L=(()=>{let p=[],z=null;if(Re.forEach(I=>{I.id==="position"?(p.push({...I,render:F=>{const ye=typeof oe=="function"?oe():"ar";let Ce=F?.positionLabelEn??F?.position_label_en??F?.position_name_en??F?.positionLabelAlt??F?.position_label_alt??F?.role;if(!Ce&&ye==="en")try{const we=typeof ft=="function"?ft():[];let je=null;if(F?.positionId!=null&&(je=we.find(Pe=>String(Pe.id)===String(F.positionId))||null),!je){const Pe=F?.positionKey??F?.position_key??F?.positionName??F?.position_name??F?.position??"";if(Pe){const Tt=String(Pe).toLowerCase();je=we.find(ja=>String(ja.name).toLowerCase()===Tt)||null}}je&&(Ce=je.labelEn??je.label_en??je.name_en??Ce)}catch{}const Oe=F?.positionLabel??F?.position_name??F?.role??r("reservations.crew.positionFallback","Ù…Ù†ØµØ¨ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…");return l(E(String(ye==="en"&&Ce?Ce:Oe)))}}),O("crew","quantity")&&(z={id:"quantity",labelKey:"reservations.details.table.headers.quantity",fallback:"Ø§Ù„ÙƒÙ…ÙŠØ©",render:F=>{const ye=Number(F?.__count||1);return l(E(String(Math.max(1,ye))))}})):I.id==="price"?p.push({...I,render:F=>{const ye=Number.isFinite(Number(F?.positionClientPrice))?Number(F.positionClientPrice):0,Ce=Math.max(1,Number(F?.__count||1)),Oe=Math.max(1,Number(i?.rentalDays||1)),de=ye*Ce*Oe;return l(`${pe(de)} ${r("reservations.create.summary.currency","SR")}`)}}):I.id==="unitPrice"?p.push({...I,render:F=>{const ye=Number.isFinite(Number(F?.positionClientPrice))?Number(F.positionClientPrice):0;return l(`${pe(ye)} ${r("reservations.create.summary.currency","SR")}`)}}):p.push(I)}),z&&p.push(z),O("crew","days")){const I=Math.max(1,Number(i?.rentalDays||1)),F=p.findIndex(Ce=>Ce.id==="price"),ye=Math.max(0,F);p.splice(ye,0,{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…",render:()=>l(E(String(I)))})}const J=new Map(p.map(I=>[I.id,I])),ue=new Set,_e=[],Fe=I=>{const F=J.get(I);F&&!ue.has(I)&&(_e.push(F),ue.add(I))};return Fe("rowNumber"),Fe("position"),Fe("unitPrice"),Fe("quantity"),Fe("days"),Fe("price"),p.forEach(I=>{ue.has(I.id)||(_e.push(I),ue.add(I.id))}),p=_e,p})(),W=lt?L.map(p=>`<th>${l(p.labelKey?r(p.labelKey,p.fallback):p.fallback)}</th>`).join(""):"",U=(()=>{const p=new Map;return b.forEach(z=>{const J=D(z);if(!J)return;const ue=p.get(J);ue?ue.__count+=1:p.set(J,{...z,__count:1})}),Array.from(p.values())})(),Q=U.length?U.map((p,z)=>`<tr>${L.map(J=>`<td><div class="quote-cell">${J.render(p,z)}</div></td>`).join("")}</tr>`).join(""):`<tr><td colspan="${Math.max(L.length,1)}" class="empty">${l(r("reservations.details.noCrew","ğŸ˜ Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙØ±ÙŠÙ‚ Ù…Ø±ØªØ¨Ø· Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø²."))}</td></tr>`,B=se("crew")?lt?`<section class="quote-section quote-section--table">
            <h3>${l(r("reservations.details.technicians.title","Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„"))}</h3>
            <table class="quote-table">
              <thead>
                <tr>${W}</tr>
              </thead>
              <tbody>${Q}</tbody>
            </table>
            ${O("crew","crewSubtotal")?`
              <div class="quote-table-subtotal">
                <span class="quote-table-subtotal__pill">
                  <span class="quote-table-subtotal__label">${l(r("reservations.details.labels.crewTotal","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±ÙŠÙ‚"))}</span>
                  <span class="quote-table-subtotal__value">${l(`${s.crewTotal} ${d}`)}</span>
                </span>
              </div>
            `:""}
          </section>`:`<section class="quote-section quote-section--table">
            <h3>${l(r("reservations.details.technicians.title","Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„"))}</h3>
            ${ee}
          </section>`:"",ve=se("notes")?`<section class="quote-section">
        <h3>${l(r("reservations.details.labels.notes","Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø­Ø¬Ø²"))}</h3>
        <div class="quote-notes">${l(P||r("reservations.quote.emptyNotes","Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©."))}</div>
      </section>`:"",m=[];O("payment","beneficiary")&&m.push(me(r("reservations.quote.labels.beneficiary","Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙÙŠØ¯"),be.beneficiaryName)),O("payment","bank")&&m.push(me(r("reservations.quote.labels.bank","Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ"),be.bankName)),O("payment","account")&&m.push(me(r("reservations.quote.labels.account","Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨"),E(be.accountNumber))),O("payment","iban")&&m.push(me(r("reservations.quote.labels.iban","Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ¨Ø§Ù†"),E(be.iban)));const Y=`<section class="quote-section">
      <div class="payment-block">
        <h3>${l(r("reservations.quote.sections.payment","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹"))}</h3>
        <div class="payment-rows">${m.length?m.join(""):ee}</div>
      </div>
      <p class="quote-approval-note">${l(be.approvalNote)}</p>
    </section>`,x=`<footer class="quote-footer">
        <h4>${l(r("reservations.quote.labels.terms","Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø¹Ø§Ù…Ø©"))}</h4>
        <ul>${$.map(p=>`<li>${l(p)}</li>`).join("")}</ul>
      </footer>`,X=[];if(ie&&Se){const z=(typeof oe=="function"?oe():"ar")==="en"?`${Se}${ie}`:`${ie}${Se}`;X.push(le(`<div class="quote-section-row">${z}</div>`,{blockType:"group"}))}else Se&&X.push(le(Se)),ie&&X.push(le(ie));if(He)try{const p=typeof oe=="function"?oe():"ar",z='<section class="quote-section quote-section--empty"></section>',J=p==="en"?`<div class="quote-section-row">${z}${He}</div>`:`<div class="quote-section-row">${z}${He}</div>`;X.push(le(J,{blockType:"group"}))}catch{X.push(le(He))}const G=[];it&&G.push(le(it,{blockType:"table",extraAttributes:'data-table-id="items"'})),B&&G.push(le(B,{blockType:"table",extraAttributes:'data-table-id="crew"'}));const ne=[];Ne&&ne.push(le(Ne,{blockType:"summary"})),ve&&ne.push(le(ve));let ke=[];if((e?.context||"reservation")!=="reservationChecklist")ke=[...se("payment")?[le(Y,{blockType:"payment"})]:[],le(x,{blockType:"footer"})];else{const p=String(e?.checklistNotes||"").trim(),z=String(e?.checklistNotesTitle||"").trim()||r("reservations.checklist.controls.notes.sectionTitleDefault","Ù…Ù„Ø§Ø­Ø¸Ø§Øª");if(p.length>0){const J=`<section class="quote-section">
        <h3>${l(z)}</h3>
        <div class="quote-notes">${l(p)}</div>
      </section>`;ke=[le(J)]}}const Ie=[...e?.context==="reservationChecklist"?X:Rt(X,"reservations.quote.placeholder.page1"),...G,...e?.context==="reservationChecklist"?ne:Rt(ne,"reservations.quote.placeholder.page2"),...ke],fe=e?.context==="reservationChecklist",tt=e?.checklistType==="crew"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ":e?.checklistType==="both"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙˆØ§Ù„Ø·Ø§Ù‚Ù… Ø§Ù„ÙÙ†ÙŠ":"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",Ue=typeof oe=="function"?oe():"ar",ct=e?.checklistType==="crew"?"Crew List":e?.checklistType==="both"?"Equipment & Crew List":"Equipment List",Xt=fe?Ue==="en"?ct:tt:r("reservations.quote.title","Ø¹Ø±Ø¶ Ø³Ø¹Ø±"),he=fe?`<div class="quote-header__meta" ${Ue==="en"?'dir="ltr"':""}>
        <div class="quote-header__meta-item">
          <span>${l(r("reservations.quote.labels.date","Ø§Ù„ØªØ§Ø±ÙŠØ®"))}</span>
          <strong>${l(A)}</strong>
        </div>
      </div>`:`<div class="quote-header__meta">
        <div class="quote-header__meta-item">
          <span>Ø±Ù‚Ù… Ø§Ù„Ø¹Ø±Ø¶</span>
          <strong>${l(_)}</strong>
        </div>
        <div class="quote-header__meta-item">
          <span>Ø§Ù„ØªØ§Ø±ÙŠØ®</span>
          <strong>${l(A)}</strong>
        </div>
      </div>`,$e=!fe||!e?.hideLogo,nt=!fe||!e?.hideCompany,Ve=`
    <header class="quote-header" data-quote-header-template style="${Number.isFinite(Number(e?.headerOffset))?`margin-top:${Number(e.headerOffset)}px;`:""}">
      <div class="quote-header__logo">
        ${$e?`<img class="quote-logo" src="${l(be.logoUrl)}" alt="${l(be.companyName)}" crossorigin="anonymous"/>`:'<span class="quote-logo quote-logo--placeholder" aria-hidden="true"></span>'}
      </div>
      <div class="quote-header__title">
        <h1>${l(Xt)}</h1>
        ${nt?`
          <p class="quote-company-name">${l(r("quote.companyName",be.companyName))}</p>
          <p class="quote-company-cr">${l(r("reservations.quote.labels.cr","Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ"))}: ${l(be.commercialRegistry)}</p>
          <p class="quote-company-license">${l(r("reservations.quote.labels.mediaLicense","ØªØ±Ø®ÙŠØµ Ø¥Ø¹Ù„Ø§Ù…ÙŠ"))}: 159460</p>
        `:""}
      </div>
      ${he}
    </header>
  `.trim();return`
    <div id="quotation-pdf-root" dir="${l(fe&&Ue==="en"?"ltr":"rtl")}" data-lang="${l(Ue)}">
      <style>${ia}${ra}</style>
      <div class="quote-document" data-quote-document>
        <div class="quote-preview-pages" data-quote-pages></div>
        <div class="quote-content-source" data-quote-source>
          ${Ve}
          ${Ie.join("")}
        </div>
      </div>
    </div>
  `}async function Tn(){try{const e=dn();if((Array.isArray(e?.packages)?e.packages:[]).length>0)return;const n=await Ea("/packages/?all=1"),a=Array.isArray(n?.data)?n.data:Array.isArray(n)?n:[];a.length&&(Na({packages:a}),document.dispatchEvent?.(new CustomEvent("packages:changed",{detail:{packages:a}})))}catch{}}function ts(e){return e?e.complete?e.naturalHeight===0?Promise.reject(new Error(`image failed to load: ${e.src||"unknown"}`)):Promise.resolve():new Promise((t,n)=>{const a=()=>{u(),t()},o=()=>{u(),n(new Error(`image failed to load: ${e.src||"unknown"}`))},u=()=>{e.removeEventListener("load",a),e.removeEventListener("error",o)};e.addEventListener("load",a,{once:!0}),e.addEventListener("error",o,{once:!0})}):Promise.resolve()}async function _t(e){if(!e)return;const t=e.ownerDocument||document,n=t.defaultView||window,a=Array.from(e.querySelectorAll?.("img")||[]),o=t.fonts?.ready?t.fonts.ready:Promise.resolve(),u=a.map(c=>ts(c)),s=[o,...u].map(c=>c.catch(d=>(Ge("asset load failed",d),wo(),null)));await Promise.all(s),await new Promise(c=>n.requestAnimationFrame(()=>c()))}async function Ot(e,{context:t="preview"}={}){if(!e)return;const n=t==="preview",a=e.ownerDocument||document;e.setAttribute("data-quote-render-context",t);const o=e.querySelector("[data-quote-pages]"),u=e.querySelector("[data-quote-source]"),s=u?.querySelector("[data-quote-header-template]");if(!o||!u||!s)return;o.style.display="block",o.style.margin="0",o.style.padding="0",o.style.gap="0px",o.style.rowGap="0px",o.style.columnGap="0px",o.style.alignItems="stretch",o.style.justifyContent="flex-start",await wa(u),await _t(u),o.innerHTML="";const c=Array.from(u.querySelectorAll(":scope > [data-quote-block]"));let d=null,y=null;const g=f=>{f.style.margin="0 auto",f.style.breakInside="avoid",f.style.pageBreakInside="avoid",f.style.pageBreakAfter="auto",f.style.breakAfter="auto"},_=()=>{const f=a.createElement("div"),w=o.childElementCount===0;if(f.className="quote-page",f.dataset.pageIndex=String(o.childElementCount),w){f.classList.add("quote-page--primary");const N=s.cloneNode(!0);N.removeAttribute("data-quote-header-template"),f.appendChild(N)}else f.classList.add("quote-page--continuation");const T=a.createElement("main");T.className="quote-body",f.appendChild(T),o.appendChild(f),g(f),d=f,y=T},A=()=>{(!d||!y||!y.isConnected)&&_()},v=()=>{if(!d||!y||y.childElementCount>0)return;const f=d;d=null,y=null,f.parentNode&&f.parentNode.removeChild(f)},h=()=>{d=null,y=null},M=()=>d?d.scrollHeight-d.clientHeight>pa:!1,S=(f,{allowOverflow:w=!1}={})=>(A(),y.appendChild(f),M()&&!w?(y.removeChild(f),v(),!1):!0),C=f=>{const w=f.cloneNode(!0);w.removeAttribute?.("data-quote-block"),w.removeAttribute?.("data-block-type"),w.removeAttribute?.("data-table-id"),!S(w)&&(h(),!S(w)&&S(w,{allowOverflow:!0}))},k=f=>{const w=f.querySelector("table");if(!w){C(f);return}const T=f.querySelector("h3"),N=w.querySelector("thead"),P=Array.from(w.querySelectorAll("tbody tr"));if(!P.length){C(f);return}let $=null,re=0;const O=(ee=!1)=>{const K=f.cloneNode(!1);K.removeAttribute("data-quote-block"),K.removeAttribute("data-block-type"),K.removeAttribute("data-table-id"),K.classList.add("quote-section--table-fragment"),ee&&K.classList.add("quote-section--table-fragment--continued");const te=T?T.cloneNode(!0):null;te&&K.appendChild(te);const me=w.cloneNode(!1);me.classList.add("quote-table--fragment"),N&&me.appendChild(N.cloneNode(!0));const j=a.createElement("tbody");return me.appendChild(j),K.appendChild(me),{section:K,body:j}},se=(ee=!1)=>$||($=O(ee),S($.section)||(h(),S($.section)||S($.section,{allowOverflow:!0})),$);P.forEach(ee=>{se(re>0);const K=ee.cloneNode(!0);if($.body.appendChild(K),M()&&($.body.removeChild(K),$.body.childElementCount||(y.removeChild($.section),$=null,v()),h(),$=null,se(re>0),$.body.appendChild(K),M())){$.section.classList.add("quote-section--table-fragment--overflow"),re+=1;return}re+=1}),$=null;try{const ee=f.querySelector(":scope > .quote-table-subtotal");ee&&C(ee)}catch{}};if(!c.length)return;c.forEach(f=>{f.getAttribute("data-block-type")==="table"?k(f):C(f)});const R=Array.from(o.children),H=[];if(R.forEach((f,w)=>{const T=f.querySelector(".quote-body");if(w!==0&&(!T||T.childElementCount===0)){f.remove();return}H.push(f)}),!n){const f=a.defaultView||window,w=Math.min(3,Math.max(1,f.devicePixelRatio||1)),T=Wt()?Math.min(2,w):w;H.forEach(N=>Lo(N,{pixelRatio:T}))}H.forEach((f,w)=>{const T=w===0;f.style.pageBreakAfter="auto",f.style.breakAfter="auto",f.style.pageBreakBefore=T?"auto":"always",f.style.breakBefore=T?"auto":"page",n?f.style.boxShadow="":f.style.boxShadow="none"});const ae=H[H.length-1]||null;d=ae,y=ae?.querySelector(".quote-body")||null,await _t(o);try{lo(e,i?.blockOffsets)}catch{}n&&(o.style.display="flex",o.style.flexDirection="column",o.style.alignItems="center",o.style.justifyContent="flex-start",o.style.rowGap="18px",o.style.columnGap="0px",o.style.gap="18px")}function _a(e=0){return e<=0?new Promise(t=>requestAnimationFrame(()=>t())):new Promise(t=>setTimeout(t,e))}function xa(e){return e?Array.from(e.querySelectorAll(".quote-page")).some(n=>n.scrollHeight-n.clientHeight>pa):!1}function Cn(e,t="#000000"){if(!e)return;e.querySelectorAll('[style*="color"], [class*="text"], h1, h2, h3, h4, h5, h6, p, span, th, td, li, strong, em, label, dt, dd, caption, div').forEach(a=>{a instanceof HTMLElement&&a.style.setProperty("color",t,"important")})}async function ns(e,{filename:t,safariWindowRef:n=null,mobileWindowRef:a=null}){if(!e)return;const o=Array.from(e.querySelectorAll(".quote-page"));if(!o.length)throw new Error("Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙØ­Ø§Øª Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§.");const[u,s]=await Promise.all([Mo(),Fo()]),c=e.ownerDocument||document,d=c?.defaultView?.getComputedStyle?.(e)?.direction,g=[e.getAttribute?.("dir"),e.style?.direction,d,c?.documentElement?.getAttribute?.("dir")].some(f=>typeof f=="string"&&f.toLowerCase().startsWith("rtl")),_=typeof window<"u"&&window.devicePixelRatio||1,A=An(),v=ha(),h=Wt();let M;h?M=1.5:v?M=Math.min(1.7,Math.max(1.2,_*1.1)):A?M=Math.min(1.8,Math.max(1.25,_*1.2)):M=Math.min(2,Math.max(1.6,_*1.4));const S=h||v?.9:A?.92:.95,C=new u({unit:"mm",format:"a4",orientation:"portrait",compress:!0}),k={scale:M,useCORS:!0,allowTaint:!1,backgroundColor:"#ffffff",letterRendering:!g,removeContainer:!1,logging:!0};let R=0;const H=r("reservations.quote.errors.browserLimit","ØªØ¹Ø°Ø± Ø¥ØªÙ…Ø§Ù… Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ø³Ø¨Ø¨ Ù‚ÙŠÙˆØ¯ Ø§Ù„Ù…ØªØµÙØ­ØŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø£Ùˆ ØªÙ‚Ù„ÙŠÙ„ Ø­Ø¬Ù… Ø§Ù„Ù…Ø­ØªÙˆÙ‰.");try{for(let f=0;f<o.length;f+=1){const w=o[f];await wa(w),await _t(w);const T=w.ownerDocument||document,N=T.createElement("div");Object.assign(N.style,{position:"fixed",top:"0",left:"-12000px",pointerEvents:"none",zIndex:"-1",backgroundColor:"#ffffff"});const P=w.cloneNode(!0);P.style.width=`${jt}px`,P.style.maxWidth=`${jt}px`,P.style.minWidth=`${jt}px`,P.style.height=`${Et}px`,P.style.maxHeight=`${Et}px`,P.style.minHeight=`${Et}px`,P.style.position="relative",P.style.background="#ffffff",Cn(P),N.appendChild(P),T.body.appendChild(N);let $;try{await _t(P),$=await s(P,{...k,scale:M,backgroundColor:"#ffffff",scrollX:0,scrollY:0})}catch(j){throw cn(j,"pageCapture",{toastMessage:H}),j}finally{N.parentNode?.removeChild(N)}if(!$)continue;const re=$.width||1,se=($.height||1)/re;let ee=an,K=ee*se,te=0;if(K>Ct){const j=Ct/K;K=Ct,ee=ee*j,te=Math.max(0,(an-ee)/2)}const me=$.toDataURL("image/jpeg",S);R>0&&C.addPage(),C.addImage(me,"JPEG",te,0,ee,K,`page-${R+1}`,"FAST"),R+=1,await new Promise(j=>window.requestAnimationFrame(j))}}catch(f){throw un({safariWindowRef:n,mobileWindowRef:a}),f}if(R===0)throw un({safariWindowRef:n,mobileWindowRef:a}),new Error("PDF generation produced no pages.");if(v||h){const f=C.output("blob");if(h){const w=URL.createObjectURL(f);St();try{window.location.assign(w)}catch(T){Ge("mobile safari blob navigation failed",T)}finally{setTimeout(()=>URL.revokeObjectURL(w),6e4)}}else{const w=URL.createObjectURL(f),T=()=>v&&n&&!n.closed?n:a&&!a.closed?a:null,N=($,re)=>{if(St(),!$){window.location.assign(re);return}try{$.location.replace(re),$.focus?.()}catch(O){Ge("direct blob navigation failed",O);try{$.document.open(),$.document.write(`<!DOCTYPE html><html lang="ar" dir="rtl"><head><meta charset="utf-8"><title>${l(r("reservations.quote.actions.export","ØªÙ†Ø²ÙŠÙ„ PDF"))}</title><style>html,body{margin:0;height:100%;background:#0f172a;color:#f8fafc;font-family:'Tajawal',sans-serif;} iframe{border:none;width:100%;height:100%;display:block;}</style></head><body><iframe src="${re}" title="PDF preview"></iframe></body></html>`),$.document.close()}catch(se){Ge("iframe blob delivery failed",se),window.location.assign(re)}}},P=T();N(P,w),setTimeout(()=>URL.revokeObjectURL(w),6e4)}}else{St();const f=C.output("bloburl"),w=document.createElement("a");w.href=f,w.download=t,w.rel="noopener",w.style.display="none",document.body.appendChild(w),w.click(),setTimeout(()=>{URL.revokeObjectURL(f),w.remove()},2e3)}}function qe(){if(!i||!q)return;const{previewFrame:e}=q;if(!e)return;Ca();const t=i.context||"reservation",n=ka({context:t,reservation:i.reservation,customer:i.customer,project:i.project,crewAssignments:i.crewAssignments,totals:i.totals,totalsDisplay:i.totalsDisplay,rentalDays:i.rentalDays,currencyLabel:i.currencyLabel,sections:i.sections,fieldSelections:i.fields,quoteNumber:i.quoteNumber,quoteDate:i.quoteDateLabel,terms:i.terms,checklistType:i.checklistType,checklistNotes:i.checklistNotes,checklistNotesTitle:i.checklistNotesTitle,hideLogo:!!i.hideLogo,hideCompany:!!i.hideCompany,headerOffset:Number(i.headerOffset||0),projectCrew:i.projectCrew,projectExpenses:i.projectExpenses,projectEquipment:i.projectEquipment,projectInfo:i.projectInfo,clientInfo:i.clientInfo,paymentSummary:i.paymentSummary,projectTotals:i.projectTotals});ot("render"),e.srcdoc=`<!DOCTYPE html>${n}`,e.addEventListener("load",async()=>{try{const a=e.contentDocument,o=a?.defaultView||window,u=a?.documentElement||a;u&&(Yn(u),Xn(u,o),Jn(u,o));const s=a?.getElementById("quotation-pdf-root");try{s&&(await Ot(s,{context:"preview"}),await _a(120),xa(s)&&await Ot(s,{context:"preview"}),Cn(s))}catch(v){console.error("[reservations/pdf] failed to layout preview document",v)}const c=Array.from(a?.querySelectorAll?.(".quote-page")||[]);try{if(i?.context==="reservationChecklist"&&i?.hideCompany){const h=a.querySelector(".quote-header");if(h&&!h.dataset.dragReady){h.style.cursor="grab";let M=!1,S=0,C=Number(i.headerOffset||0);const k=ae=>{M=!0,S=ae.clientY||ae.touches?.[0]?.clientY||0,C=Number(i.headerOffset||0),h.style.cursor="grabbing",a.addEventListener("mousemove",R),a.addEventListener("mouseup",H,{once:!0}),a.addEventListener("touchmove",R,{passive:!1}),a.addEventListener("touchend",H,{once:!0})},R=ae=>{if(!M)return;const w=(ae.clientY||ae.touches?.[0]?.clientY||0)-S,T=Math.max(0,Math.min(240,C+w));h.style.marginTop=`${T}px`,i.headerOffset=T,ae.preventDefault?.()},H=()=>{M=!1,h.style.cursor="grab",a.removeEventListener("mousemove",R),a.removeEventListener("touchmove",R)};h.addEventListener("mousedown",k),h.addEventListener("touchstart",k,{passive:!0}),h.dataset.dragReady="true"}}}catch{}ho(a),bn(a),Vt();const d=a?.querySelector(".quote-preview-pages"),y=jt;let g=18;if(d&&a?.defaultView){const v=a.defaultView.getComputedStyle(d),h=parseFloat(v.rowGap||v.gap||`${g}`);Number.isFinite(h)&&h>=0&&(g=h)}const _=Et,A=c.length?c.length*_+Math.max(0,(c.length-1)*g):_;if(e.dataset.baseWidth=String(y),e.dataset.baseHeight=String(A),e.style.width=`${y}px`,e.style.minWidth=`${y}px`,e.style.height=`${A}px`,e.style.minHeight=`${A}px`,q?.previewFrameWrapper&&!q?.userAdjustedZoom){const v=q.previewFrameWrapper.clientWidth-24;v>0&&v<y?Be=Math.max(v/y,.3):Be=1}$a(Be)}finally{St()}},{once:!0})}function as(e){if(!i)return;const t=e.currentTarget,n=t?.dataset?.sectionId;n&&(t.checked?i.sections.add(n):i.sections.delete(n),Sa(i),Nt(),qe())}function os(e){if(!i)return;const t=e.currentTarget,n=t?.dataset?.sectionId,a=t?.dataset?.fieldId;if(!n||!a)return;const o=i.context||"reservation",u=i.fields||(i.fields=$t(o)),s=qo(u,n);t.checked?s.add(a):s.delete(a),Sa(i),qe()}function ss(e){if(!i)return;const t=e.currentTarget,n=t?.dataset?.sectionId;n&&(Sn(i,n),i.sectionExpansions[n]=t.open)}function Nt(){if(!q?.toggles||!i)return;const{toggles:e}=q,t=i.fields||{},n=i.context||"reservation";Sn(i);const a=Qt(n),o=na(n),u=a.map(({id:s,labelKey:c,fallback:d})=>{const y=r(c,d),g=i.sections.has(s),_=o[s]||[],A=So(i,s),v=_.length?`<div class="quote-toggle-sublist">
          ${_.map(h=>{const M=qn(t,s,h.id),S=g?"":"disabled",C=h.labelKey?r(h.labelKey,h.fallback):h.fallback;return`
              <label class="quote-toggle quote-toggle--field">
                <input type="checkbox" data-field-toggle data-section-id="${s}" data-field-id="${h.id}" ${M?"checked":""} ${S}>
                <span>${l(C)}</span>
              </label>
            `}).join("")}
        </div>`:"";return`
      <details class="quote-toggle-group" data-section-group data-section-id="${s}" ${A?"open":""}>
        <summary class="quote-toggle-summary">
          <label class="quote-toggle quote-toggle--section">
            <input type="checkbox" data-section-toggle data-section-id="${s}" ${g?"checked":""}>
            <span>${l(y)}</span>
          </label>
          ${_.length?'<span class="quote-toggle-caret" aria-hidden="true"></span>':""}
        </summary>
        ${v}
      </details>
    `}).join("");e.innerHTML=u,e.querySelectorAll("input[data-section-toggle]").forEach(s=>{s.addEventListener("change",as)}),e.querySelectorAll("input[data-field-toggle]").forEach(s=>{s.addEventListener("change",os)}),e.querySelectorAll("details[data-section-group]").forEach(s=>{s.addEventListener("toggle",ss)})}function rs(){if(q?.modal)return q;const e=document.createElement("div");e.id="reservationQuoteModal",e.className="modal fade quote-preview-modal",e.tabIndex=-1,e.setAttribute("aria-labelledby","reservationQuoteModalLabel"),e.setAttribute("aria-hidden","true"),e.style.display="none",e.innerHTML=`
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="reservationQuoteModalLabel">${l(r("reservations.quote.previewTitle","Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¹Ø±Ø¶ Ø³Ø¹Ø±"))}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="quote-preview-layout">
            <aside class="quote-preview-sidebar">
              <h6>${l(r("reservations.quote.toggleHeading","Ø­Ø¯Ø¯ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø¯ ØªØµØ¯ÙŠØ±Ù‡Ø§"))}</h6>
              <div class="quote-toggle-list" data-quote-toggles></div>
              <div class="quote-meta-info" data-quote-meta></div>
              <div class="quote-terms-editor" data-quote-terms-editor>
                <label class="quote-terms-editor__label" for="quote-terms-input">${l(r("reservations.quote.termsEditor.title","Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø¹Ø§Ù…Ø© (Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„)"))}</label>
                <textarea id="quote-terms-input" class="quote-terms-editor__textarea" rows="6" data-quote-terms-input placeholder="${l(r("reservations.quote.termsEditor.placeholder","Ø§ÙƒØªØ¨ ÙƒÙ„ Ø´Ø±Ø· ÙÙŠ Ø³Ø·Ø± Ù…Ø³ØªÙ‚Ù„"))}"></textarea>
                <button type="button" class="quote-terms-reset" data-quote-terms-reset>${l(r("reservations.quote.termsEditor.reset","Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©"))}</button>
              </div>
            </aside>
            <section class="quote-preview-panel">
              <div class="quote-preview" data-quote-preview></div>
            </section>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-light" data-bs-dismiss="modal">${l(r("reservations.quote.actions.close","Ø¥ØºÙ„Ø§Ù‚"))}</button>
          <button type="button" class="btn btn-primary" data-quote-download>
            ${l(r("reservations.quote.actions.export","ğŸ“„ ØªÙ†Ø²ÙŠÙ„ PDF"))}
          </button>
        </div>
      </div>
    </div>
  `,document.body.appendChild(e);const t=e.querySelector("[data-quote-toggles]"),n=e.querySelector("[data-quote-preview]"),a=e.querySelector("[data-quote-meta]"),o=e.querySelector("[data-quote-terms-input]"),u=e.querySelector("[data-quote-terms-reset]"),s=e.querySelector("[data-quote-download]"),c=e.querySelector(".modal-header"),d=c?.querySelector(".btn-close"),y=Array.from(e.querySelectorAll('[data-bs-dismiss="modal"]')),g=document.createElement("div");g.className="quote-preview-header-actions",c&&c.insertBefore(g,d||null);const _=document.createElement("iframe");_.className="quote-preview-frame",_.setAttribute("title",r("reservations.quote.previewTitle","Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¹Ø±Ø¶ Ø³Ø¹Ø±")),_.setAttribute("loading","lazy"),_.setAttribute("frameborder","0");const A=document.createElement("div");A.className="quote-preview-zoom-controls",A.innerHTML=`
    <button type="button" class="quote-preview-zoom-btn" data-zoom-out title="${l(r("reservations.quote.zoom.out","ØªØµØºÙŠØ±"))}">âˆ’</button>
    <span class="quote-preview-zoom-value" data-zoom-value>100%</span>
    <button type="button" class="quote-preview-zoom-btn" data-zoom-in title="${l(r("reservations.quote.zoom.in","ØªÙƒØ¨ÙŠØ±"))}">+</button>
    <button type="button" class="quote-preview-zoom-btn" data-zoom-reset title="${l(r("reservations.quote.zoom.reset","Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¶Ø¨Ø·"))}">1:1</button>
  `;const v=document.createElement("div");v.className="quote-preview-zoom-controls quote-preview-drag-controls",v.innerHTML=`
    <button type="button" class="quote-preview-zoom-btn" data-block-drag-toggle>${l(r("reservations.quote.drag.enable","ğŸ¯ ÙˆØ¶Ø¹ ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø¨Ù„ÙˆÙƒØ§Øª"))}</button>
    <button type="button" class="quote-preview-zoom-btn" data-block-drag-save disabled>${l(r("reservations.quote.drag.save","ğŸ’¾ ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ÙˆØ§Ø¶Ø¹"))}</button>
    <button type="button" class="quote-preview-zoom-btn" data-block-drag-reset>${l(r("reservations.quote.drag.resetBtn","â†º ØªØµÙÙŠØ± Ø§Ù„Ù…ÙˆØ§Ø¶Ø¹"))}</button>
  `;const h=document.createElement("div");h.className="quote-preview-zoom-controls quote-preview-align-controls";const M=l(r("reservations.quote.align.customer","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„")),S=l(r("reservations.quote.align.reservation","ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²")),C=l(r("reservations.quote.align.project","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"));h.innerHTML=`
    <select class="quote-preview-align-select" data-align-target>
      <option value="customer">${M}</option>
      <option value="reservation">${S}</option>
      <option value="project">${C}</option>
    </select>
    <div class="quote-preview-align-buttons">
      <button type="button" class="quote-preview-zoom-btn" data-align-value="left" title="${l(r("reservations.quote.align.left","Ù…Ø­Ø§Ø°Ø§Ø© ÙŠØ³Ø§Ø±"))}">â¬…ï¸</button>
      <button type="button" class="quote-preview-zoom-btn" data-align-value="center" title="${l(r("reservations.quote.align.center","Ù…Ø­Ø§Ø°Ø§Ø© ÙˆØ³Ø·"))}">â†”ï¸</button>
      <button type="button" class="quote-preview-zoom-btn" data-align-value="right" title="${l(r("reservations.quote.align.right","Ù…Ø­Ø§Ø°Ø§Ø© ÙŠÙ…ÙŠÙ†"))}">â¡ï¸</button>
    </div>
  `;const k=document.createElement("div");k.className="quote-preview-frame-wrapper",k.appendChild(_),n.innerHTML="";const R=document.createElement("div");R.className="quote-preview-scroll",R.appendChild(k),n.appendChild(R);const H=document.createElement("div");H.className="quote-preview-status",H.setAttribute("role","status"),H.setAttribute("aria-live","polite"),H.hidden=!0,H.innerHTML=`
    <span class="quote-preview-spinner" data-quote-status-spinner aria-hidden="true"></span>
    <span data-quote-status-text>${l(sa("render"))}</span>
    <button type="button" class="quote-preview-status-action" data-quote-status-action hidden></button>
  `,n.appendChild(H),g.appendChild(A),g.appendChild(v),g.appendChild(h),s?.addEventListener("click",async()=>{if(i){s.disabled=!0;try{await Ta()}finally{s.disabled=!1}}});const ae=()=>{rn()||ln(e)};y.forEach(N=>{N?.addEventListener("click",ae)}),d&&!y.includes(d)&&d.addEventListener("click",ae),e.addEventListener("click",N=>{rn()||N.target===e&&ln(e)}),q={modal:e,toggles:t,preview:n,previewScroll:R,previewFrameWrapper:k,zoomControls:A,zoomValue:A.querySelector("[data-zoom-value]"),previewFrame:_,meta:a,downloadBtn:s,statusIndicator:H,statusText:H.querySelector("[data-quote-status-text]"),statusSpinner:H.querySelector("[data-quote-status-spinner]"),statusAction:H.querySelector("[data-quote-status-action]"),termsInput:o,termsReset:u,statusKind:null,userAdjustedZoom:!1,blockDragToggle:v.querySelector("[data-block-drag-toggle]"),blockDragSave:v.querySelector("[data-block-drag-save]"),blockDragReset:v.querySelector("[data-block-drag-reset]"),alignTarget:h.querySelector("[data-align-target]"),alignButtons:Array.from(h.querySelectorAll("[data-align-value]"))};const f=A.querySelector("[data-zoom-out]"),w=A.querySelector("[data-zoom-in]"),T=A.querySelector("[data-zoom-reset]");return f?.addEventListener("click",()=>Hn(-.1)),w?.addEventListener("click",()=>Hn(.1)),T?.addEventListener("click",()=>Bt(1,{markManual:!0})),q.blockDragToggle?.addEventListener("click",()=>co(!yt)),q.blockDragSave?.addEventListener("click",uo),q.blockDragReset?.addEventListener("click",po),q.alignTarget?.addEventListener("change",()=>Vt()),(q.alignButtons||[]).forEach(N=>{N.addEventListener("click",()=>{const P=q.alignTarget?.value||"customer",$=N.dataset.alignValue||"right";yo(P,$)})}),Ut(),Ca(),o&&o.addEventListener("input",is),u&&u.addEventListener("click",ls),Bt(Be),q}function Bt(e,{silent:t=!1,markManual:n=!1}={}){Be=Math.min(Math.max(e,.25),2.2),n&&q&&(q.userAdjustedZoom=!0),$a(Be),!t&&q?.zoomValue&&(q.zoomValue.textContent=`${Math.round(Be*100)}%`)}function Hn(e){Bt(Be+e,{markManual:!0})}function $a(e){if(!q?.previewFrame||!q.previewFrameWrapper)return;const t=q.previewFrame,n=q.previewFrameWrapper,a=Number(t.dataset.baseWidth)||794,o=Number(t.dataset.baseHeight)||t.contentDocument?.body?.scrollHeight||1123;t.style.transform=`scale(${e})`,t.style.transformOrigin="top center",An()?(n.style.width="100%",n.style.maxWidth="100%",n.style.minWidth="0"):(n.style.width=`${a}px`,n.style.maxWidth=`${a}px`,n.style.minWidth=`${a}px`),n.style.minHeight=`${o}px`,n.style.height=`${o}px`}function It(){if(!q?.meta||!i)return;const{meta:e}=q;(i.context||"reservation")==="reservationChecklist"?e.innerHTML=`
      <div class="quote-meta-card">
        <div><span>${l(r("reservations.quote.labels.dateGregorian","Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ"))}</span><strong>${l(i.quoteDateLabel)}</strong></div>
      </div>
    `:e.innerHTML=`
      <div class="quote-meta-card">
        <div><span>${l(r("reservations.quote.labels.number","Ø±Ù‚Ù… Ø¹Ø±Ø¶ Ø³Ø¹Ø±"))}</span><strong>${l(i.quoteNumber)}</strong></div>
        <div><span>${l(r("reservations.quote.labels.dateGregorian","Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ"))}</span><strong>${l(i.quoteDateLabel)}</strong></div>
      </div>
    `}function jn(){if(!q?.termsInput)return;const e=(i?.terms&&i.terms.length?i.terms:Ee).join(`
`);q.termsInput.value!==e&&(q.termsInput.value=e)}function is(e){if(!i)return;const t=tn(e?.target?.value??"");if(t.length){i.terms=t;const n=document.getElementById("reservation-terms");n&&(n.value=e.target.value);const a=document.getElementById("edit-res-terms");a&&(a.value=e.target.value)}else{i.terms=[...Ee],jn();const n=Ee.join(`
`),a=document.getElementById("reservation-terms");a&&(a.value=n);const o=document.getElementById("edit-res-terms");o&&(o.value=n)}qe()}function ls(e){if(e?.preventDefault?.(),!i)return;i.terms=[...Ee];const t=document.getElementById("reservation-terms");t&&(t.value=Ee.join(`
`));const n=document.getElementById("edit-res-terms");n&&(n.value=Ee.join(`
`)),jn(),qe()}async function Ta(){if(!i)return;ot("export");const t=!An()&&ha(),n=Wt(),a=null,o=!n&&t?window.open("","_blank"):null;(d=>{if(d)try{d.document.open(),d.document.write(`<!DOCTYPE html><html lang="ar" dir="rtl"><head><meta charset="utf-8"><title>${l(r("reservations.quote.status.exporting","Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ù…Ù„Ù PDF..."))}</title><style>body{font-family:'Tajawal',sans-serif;margin:0;height:100vh;display:flex;align-items:center;justify-content:center;background:#0f172a;color:#f8fafc;text-align:center;padding:24px;} .loader{width:42px;height:42px;border-radius:50%;border:4px solid rgba(248,250,252,0.35);border-top-color:#38bdf8;animation:spin 1s linear infinite;margin:0 auto 18px;}@keyframes spin{to{transform:rotate(360deg);}} h1{margin:0 0 6px;font-size:1.05rem;} p{margin:0;font-size:0.9rem;opacity:0.8;}</style></head><body><div><div class="loader" aria-hidden="true"></div><h1>${l(r("reservations.quote.status.exporting","Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ù…Ù„Ù PDF..."))}</h1><p>${l(r("reservations.quote.status.exportingHint","Ù‚Ø¯ ÙŠØ³ØªØºØ±Ù‚ Ø°Ù„Ùƒ Ø¨Ø¶Ø¹ Ø«ÙˆØ§Ù†ÙØŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±..."))}</p></div></body></html>`),d.document.close()}catch(y){Ge("failed to prime download window",y)}})(o);let s=null;const c=r("reservations.quote.errors.browserLimit","ØªØ¹Ø°Ø± Ø¥ØªÙ…Ø§Ù… Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ø³Ø¨Ø¨ Ù‚ÙŠÙˆØ¯ Ø§Ù„Ù…ØªØµÙØ­ØŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø£Ùˆ ØªÙ‚Ù„ÙŠÙ„ Ø­Ø¬Ù… Ø§Ù„Ù…Ø­ØªÙˆÙ‰.");try{await Ro(),en("html2pdf ensured");const d=i.context||"reservation",y=ka({context:d,reservation:i.reservation,customer:i.customer,project:i.project,crewAssignments:i.crewAssignments,totals:i.totals,totalsDisplay:i.totalsDisplay,rentalDays:i.rentalDays,currencyLabel:i.currencyLabel,sections:i.sections,fieldSelections:i.fields,quoteNumber:i.quoteNumber,quoteDate:i.quoteDateLabel,terms:i.terms,checklistType:i.checklistType,checklistNotes:i.checklistNotes,checklistNotesTitle:i.checklistNotesTitle,hideLogo:!!i.hideLogo,hideCompany:!!i.hideCompany,headerOffset:Number(i.headerOffset||0),projectCrew:i.projectCrew,projectExpenses:i.projectExpenses,projectEquipment:i.projectEquipment,projectInfo:i.projectInfo,clientInfo:i.clientInfo,paymentSummary:i.paymentSummary,projectTotals:i.projectTotals});s=document.createElement("div"),s.innerHTML=y,Object.assign(s.style,{position:"fixed",top:"0",left:"0",pointerEvents:"none",zIndex:"-1"}),document.body.appendChild(s),Yn(s),Xn(s),Jn(s),en("export container prepared");const g=s.firstElementChild;if(g){try{const A=typeof oe=="function"?oe():g.getAttribute("data-lang")||"ar",h=i?.context==="reservationChecklist"&&A==="en"?"ltr":"rtl";g.setAttribute("dir",h),g.style.direction=h,g.setAttribute("data-lang",A),g.style.textAlign=""}catch{}g.setAttribute("data-theme","light"),g.classList.remove("dark","dark-mode"),g.style.margin="0",g.style.padding="0",g.style.width="210mm",g.style.maxWidth="210mm",g.style.marginLeft="auto",g.style.marginRight="auto",g.scrollTop=0,g.scrollLeft=0;try{await Ot(g,{context:"export"}),await _a(120),xa(g)&&await Ot(g,{context:"export"}),await _t(g),Cn(g),en("layout complete for export document")}catch(A){cn(A,"layoutQuoteDocument",{suppressToast:!0})}}const _=d==="reservationChecklist"?(()=>{const A=i?.reservation?.reservationCode||i?.reservation?.reservationId||i?.reservation?.id||"res",v=i?.checklistType==="crew"?"crew":i?.checklistType==="both"?"equipment-crew":"equipment";return`checklist-${String(A)}-${v}.pdf`})():`quotation-${i.quoteNumber}.pdf`;await ns(g,{filename:_,safariWindowRef:o,mobileWindowRef:a})}catch(d){un({container:s,safariWindowRef:o,mobileWindowRef:a}),s=null,cn(d,"exportQuoteAsPdf",{toastMessage:c})}finally{s&&s.parentNode&&s.parentNode.removeChild(s),St()}}function En(){const e=rs();if(e?.modal){if(wt=!1,Be=1,q&&(q.userAdjustedZoom=!1),Bt(Be,{silent:!0}),i?.context==="reservationChecklist")try{const t=e.modal.querySelector("#reservationQuoteModalLabel"),n=e.modal.querySelector(".quote-preview-sidebar"),a=e.modal.querySelector("[data-quote-terms-editor]");a&&(a.style.display="none");let o=n.querySelector("[data-checklist-controls]");if(!o){o=document.createElement("div"),o.setAttribute("data-checklist-controls","");const u=l(r("reservations.checklist.controls.items","Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª")),s=l(r("reservations.checklist.controls.crew","Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ")),c=l(r("reservations.checklist.controls.both","Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙˆØ§Ù„Ø·Ø§Ù‚Ù… Ø§Ù„ÙÙ†ÙŠ")),d=l(r("reservations.checklist.controls.hideLogo","Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø´Ø¹Ø§Ø±")),y=l(r("reservations.checklist.controls.hideCompany","Ø¥Ø®ÙØ§Ø¡ Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©")),g=l(r("reservations.checklist.controls.notes.title","Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù„Ø³ØªØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)")),_=l(r("reservations.checklist.controls.notes.placeholder","Ø§ÙƒØªØ¨ Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø®Ø§ØµØ© Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ù„Ø³ØªØ©")),A=typeof oe=="function"?oe():"ar",v=l(A==="en"?r("language.toggle.labelAr","ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"):r("language.toggle.labelEn","ğŸ‡¬ğŸ‡§ English"));o.innerHTML=`
          <div class="quote-meta-card" style="margin-bottom:10px">
            <div style="display:flex;gap:10px;flex-wrap:wrap">
              <label style="display:flex;align-items:center;gap:6px">
                <input type="radio" name="checklist-type" value="items" checked>
                <span data-i18n data-i18n-key="reservations.checklist.controls.items">${u}</span>
              </label>
              <label style="display:flex;align-items:center;gap:6px">
                <input type="radio" name="checklist-type" value="crew">
                <span data-i18n data-i18n-key="reservations.checklist.controls.crew">${s}</span>
              </label>
              <label style="display:flex;align-items:center;gap:6px">
                <input type="radio" name="checklist-type" value="both">
                <span data-i18n data-i18n-key="reservations.checklist.controls.both">${c}</span>
              </label>
            </div>
          </div>
          <div class="quote-meta-card" style="margin-bottom:10px">
            <div style="display:flex;gap:8px;flex-wrap:wrap">
              <button type="button" class="btn btn-sm btn-light" data-checklist-lang>${v}</button>
              <label style="display:flex;align-items:center;gap:6px">
                <input type="checkbox" data-checklist-hide-logo>
                <span data-i18n data-i18n-key="reservations.checklist.controls.hideLogo">${d}</span>
              </label>
              <label style="display:flex;align-items:center;gap:6px">
                <input type="checkbox" data-checklist-hide-company>
                <span data-i18n data-i18n-key="reservations.checklist.controls.hideCompany">${y}</span>
              </label>
            </div>
          </div>
          <div class="quote-terms-editor" data-checklist-notes>
            <label class="quote-terms-editor__label" for="checklist-notes-title-input" data-i18n data-i18n-key="reservations.checklist.controls.notes.titleLabel">${l(r("reservations.checklist.controls.notes.titleLabel","Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª"))}</label>
            <input id="checklist-notes-title-input" class="quote-terms-editor__input" type="text" value="${l(r("reservations.checklist.controls.notes.sectionTitleDefault","Ù…Ù„Ø§Ø­Ø¸Ø§Øª"))}" data-i18n-value-key="reservations.checklist.controls.notes.sectionTitleDefault">
            <label class="quote-terms-editor__label" for="checklist-notes-input" data-i18n data-i18n-key="reservations.checklist.controls.notes.title">${g}</label>
            <textarea id="checklist-notes-input" class="quote-terms-editor__textarea" rows="4" data-i18n-placeholder-key="reservations.checklist.controls.notes.placeholder" placeholder="${_}"></textarea>
          </div>
        `,n.prepend(o),o.querySelectorAll('input[name="checklist-type"]').forEach(f=>{f.addEventListener("change",()=>{const w=o.querySelector('input[name="checklist-type"]:checked')?.value||"items";i.checklistType=w==="crew"||w==="both"?w:"items";const T=new Set(["customerInfo","reservationInfo","projectInfo","notes"]);if(i.checklistType==="crew"?T.add("crew"):i.checklistType==="both"?(T.add("items"),T.add("crew")):T.add("items"),i.sections=T,t){const N=oe?.()||"ar",P=i.checklistType==="crew"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ":i.checklistType==="both"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙˆØ§Ù„Ø·Ø§Ù‚Ù… Ø§Ù„ÙÙ†ÙŠ":"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",$=i.checklistType==="crew"?"Crew List":i.checklistType==="both"?"Equipment & Crew List":"Equipment List";t.textContent=N==="en"?$:P}Nt(),It(),qe()})});const M=o.querySelector("#checklist-notes-input"),S=o.querySelector("#checklist-notes-title-input"),C=()=>{try{const f=oe?.()||"ar",w=f==="en"?"ltr":"rtl",T=f==="en"?"left":"right";M&&(M.setAttribute("dir",w),M.style.textAlign=T),S&&(S.setAttribute("dir",w),S.style.textAlign=T)}catch{}};C();try{const f=()=>C();document.addEventListener("language:changed",f),o._onLangChanged=f}catch{}M.addEventListener("input",f=>{i.checklistNotes=String(f.target.value||""),qe()}),S.addEventListener("input",f=>{i.checklistNotesTitle=String(f.target.value||""),qe()});const k=o.querySelector("[data-checklist-lang]");if(k){const f=()=>{const w=oe?.()||"ar";k.textContent=w==="ar"?"ğŸ‡¬ğŸ‡§ English":"ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"};f(),k.addEventListener("click",()=>{const T=(oe?.()||"ar")==="ar"?"en":"ar";try{Ia?.(T)}catch{}if(f(),C(),t){const N=oe?.()||"ar",P=i.checklistType,$=P==="crew"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ":P==="both"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙˆØ§Ù„Ø·Ø§Ù‚Ù… Ø§Ù„ÙÙ†ÙŠ":"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",re=P==="crew"?"Crew List":P==="both"?"Equipment & Crew List":"Equipment List";t.textContent=N==="en"?re:$}Nt(),It(),qe()})}const R=o.querySelector("[data-checklist-hide-logo]"),H=o.querySelector("[data-checklist-hide-company]");(()=>{R&&(R.checked=!!i.hideLogo),H&&(H.checked=!!i.hideCompany)})(),R?.addEventListener("change",f=>{i.hideLogo=!!f.target.checked,qe()}),H?.addEventListener("change",f=>{i.hideCompany=!!f.target.checked,qe()})}t&&(t.textContent=i.checklistType==="crew"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ":"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª");try{e.previewFrame?.setAttribute("title","Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù„Ø³ØªØ©")}catch{}}catch{}Nt(),It(),jn(),qe(),vo(e.modal)}}async function gs({reservation:e,customer:t,project:n}){if(!e){pt(r("reservations.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø²"));return}await Tn();const a=Yt(e),{totalsDisplay:o,totals:u,rentalDays:s}=$n(e,a,n),c=r("reservations.create.summary.currency","SR"),y=(v=>{if(!v)return"1";const M=[v.reservationCode,v.reservation_code,v.reservationId,v.reservation_id,v.id].find(k=>k!=null&&String(k).trim()!==""),S=E(String(M??"1"));return S.replace(/\D+/g,"")||S||"1"})(e),g=Number.parseInt(y,10)||1,_=new Date,A=Ya();i={context:"reservation",reservation:e,customer:t,project:n,crewAssignments:a,totals:u,totalsDisplay:o,rentalDays:s,currencyLabel:c,projectCrew:[],projectExpenses:[],projectEquipment:[],sections:new Set(Qt("reservation").filter(v=>v.defaultSelected).map(v=>v.id)),sectionExpansions:Gt("reservation"),fields:$t("reservation"),terms:A,quoteSequence:g,quoteNumber:y,quoteDate:_,quoteDateLabel:xn(_),sequenceCommitted:!1},kt=!1,_n(i),hn(i),vn(i),En();try{mn()}catch{}}async function vs({reservation:e,customer:t,project:n}){if(!e){pt(r("reservations.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø²"));return}await Tn();const a=Yt(e),{totalsDisplay:o,totals:u,rentalDays:s}=$n(e,a,n),c=r("reservations.create.summary.currency","SR"),d=new Date;i={context:"reservationChecklist",reservation:e,customer:t,project:n,crewAssignments:a,totals:u,totalsDisplay:o,rentalDays:s,currencyLabel:c,checklistType:"items",checklistNotes:"",projectCrew:[],projectExpenses:[],projectEquipment:[],sections:new Set(["customerInfo","reservationInfo","projectInfo","notes","items"]),sectionExpansions:Gt("reservationChecklist"),fields:$t("reservationChecklist"),terms:[],quoteDate:d,quoteDateLabel:xn(d),sequenceCommitted:!1},kt=!1,_n(i),hn(i),vn(i),En();try{mn()}catch{}}async function ws({project:e}){if(!e){pt(r("projects.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"));return}await Tn();let t=Kn(e);const{project:n}=t;if(!n){pt(r("projects.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"));return}try{(!Array.isArray(t.equipmentItems)||t.equipmentItems.length===0)&&n?.id!=null&&(await La({project_id:n.id}),t=Kn(n))}catch(d){console.warn("[reservationPdf] refreshReservationsForProject failed, proceeding with snapshot/state",d)}const o=(d=>{if(!d)return"1";const g=[d.projectCode,d.project_code,d.code,d.id].find(v=>v!=null&&String(v).trim()!==""),_=E(String(g??"1"));return _.replace(/\D+/g,"")||_||"1"})(n),u=Number.parseInt(o,10)||1,s=new Date,c=[...Wa];i={context:"project",reservation:null,customer:t.customer,project:n,technicians:t.crew||[],clientInfo:t.clientInfo,projectInfo:t.projectInfo,projectCrew:t.crew,projectExpenses:t.expenses,projectEquipment:t.equipment,equipmentItems:t.equipmentItems||[],crewAssignments:t.crewAssignments||[],totals:t.totals,projectTotals:t.projectTotals,totalsDisplay:t.totalsDisplay,rentalDays:t.projectDurationDays,currencyLabel:t.currencyLabel,sections:new Set(Qt("project").filter(d=>d.defaultSelected).map(d=>d.id)),sectionExpansions:Gt("project"),fields:$t("project"),terms:c,quoteSequence:u,quoteNumber:o,quoteDate:s,quoteDateLabel:xn(s),sequenceCommitted:!1,paymentSummary:t.paymentSummary,projectNotes:t.notes,paymentHistory:t.paymentHistory},kt=!1,_n(i),hn(i),vn(i),En();try{mn()}catch{}}function cs(e="reservation"){return e==="project"?[{value:"projectCustomer",label:r("projects.quote.sections.customer","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„")},{value:"projectDetails",label:r("projects.quote.sections.project","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹")}]:[{value:"customer",label:r("reservations.quote.sections.customer","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„")},{value:"reservation",label:r("reservations.quote.sections.reservation","ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²")},{value:"project",label:r("reservations.quote.sections.project","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹")}]}function Ca(){if(!q?.alignTarget)return;const e=i?.context||"reservation",t=cs(e),n=q.alignTarget,a=n.value;n.innerHTML=t.map(o=>`<option value="${l(o.value)}">${l(o.label)}</option>`).join(""),t.some(o=>o.value===a)?n.value=a:n.value=t[0]?.value||"",Vt()}export{gs as a,vs as b,ws as e,hs as g,Zn as r,bs as s};
