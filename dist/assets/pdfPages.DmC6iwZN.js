import{t as i,f as P,a as R,b as h,r as _}from"./calculations.xs5ZU-uw.js";import{e as N}from"./reports.xmqy1JdC.js";import{s as q,c as S,d as M,q as z}from"./controller.CwK47G-r.js";import"./reservationsService.BtJ4Aekt.js";import"./auth.BcQOd76e.js";import"./dashboard.C-zvUcYR.js";/* empty css              */import"./dashboardShell.deT9qe6E.js";import"./customers.Bfn9j-AP.js";import"./maintenanceService.Cf3sMnbW.js";const E=96,w=25.4,A=210,H=297,k=Math.round(A/w*E),T=Math.round(H/w*E);function I(r="preview"){const e=document.createElement("div");e.id="quotation-pdf-root",e.setAttribute("dir",document.documentElement.getAttribute("dir")||"rtl"),e.setAttribute("data-quote-render-context",r);const s=document.createElement("style");s.textContent=String(z).trim(),e.appendChild(s);const a=document.createElement("div");a.className="quote-preview-pages",a.setAttribute("data-quote-pages",""),e.appendChild(a);const n=document.createElement("style");return n.textContent=`
    .rpt-header { display:flex; flex-direction:column; gap:6px; }
    .rpt-header h1 { margin:0; font-weight:800; font-size:18px; text-align:right; }
    .rpt-subtitle { margin:0; font-size:12px; opacity:.8; text-align:right; }
    .rpt-kpis { display:grid; grid-template-columns: repeat(3, 1fr); gap:8px; margin:8px 0 4px; }
    .rpt-kpi { border:1px solid #e5e7eb; border-radius:10px; padding:8px 10px; background:#fff; }
    .rpt-kpi .label { font-size:11px; opacity:.8; }
    .rpt-kpi .value { font-weight:700; font-size:14px; }
    .rpt-table { width:100%; border-collapse:collapse; font-size:12px; }
    .rpt-table th { background:#f3f4f6; border:1px solid #e5e7eb; padding:6px 8px; text-align:right; font-weight:800; }
    .rpt-table td { border:1px solid #e5e7eb; padding:6px 8px; text-align:right; }
  `,e.appendChild(n),e}function C({primary:r=!1}={}){const e=document.createElement("div");return e.className="quote-page",r&&e.classList.add("quote-page--primary"),e}function j(r){const e=document.createElement("div");e.className="rpt-header";const s=document.createElement("h1");s.textContent=i("reservations.reports.print.title","تقرير الحجوزات","Reservations report");const a=document.createElement("p");a.className="rpt-subtitle",a.textContent=`${P(new Date)} • ${i("reservations.reports.print.generated","تاريخ التوليد","Generated on")}`,e.appendChild(s),e.appendChild(a);const n=document.createElement("div");n.className="rpt-kpis";const t=(o,d)=>{const m=document.createElement("div");return m.className="rpt-kpi",m.innerHTML=`<div class="label">${o}</div><div class="value">${d}</div>`,m};return n.appendChild(t(i("reservations.reports.kpi.total.label","الحجوزات","Reservations"),R(r.total||0))),n.appendChild(t(i("reservations.reports.kpi.revenue.label","الإيرادات","Revenue"),h(r.revenue||0))),n.appendChild(t(i("reservations.reports.kpi.net.label","صافي الربح","Net profit"),h(r.netProfit||0))),n.appendChild(t(i("reservations.reports.kpi.share.label","نسبة الشركة","Company share"),h(r.companyShareTotal||0))),n.appendChild(t(i("reservations.reports.kpi.tax.label","الضريبة","Tax"),h(r.taxTotal||0))),n.appendChild(t(i("reservations.reports.kpi.maintenance.label","مصاريف الصيانة","Maintenance"),h(r.maintenanceExpense||0))),e.appendChild(n),e}function y(r){const e=document.createElement("table");e.className="rpt-table";const s=document.createElement("thead"),a=document.createElement("tr");r.forEach(t=>{const o=document.createElement("th");o.textContent=t,a.appendChild(o)}),s.appendChild(a);const n=document.createElement("tbody");return e.appendChild(s),e.appendChild(n),{table:e,tbody:n}}function D(r,e,s,a){const n=r.querySelector("[data-quote-pages]"),t=C({primary:!0});n.appendChild(t);const o=j(a);t.appendChild(o);let{table:d,tbody:m}=y(s);t.appendChild(d);const b=18,g=28,l=[];for(let p=0;p<e.length;p+=g)l.push(e.slice(p,p+g));if(l.length){const p=l[0];if(p.length>b){const c=p.splice(b);l.length>1?l[1]=c.concat(l[1]):l.push(c)}}const x=(p,c)=>{const u=document.createElement("tr");s.forEach(f=>{const v=document.createElement("td");v.textContent=c[f]!=null?String(c[f]):"",u.appendChild(v)}),p.appendChild(u)};(l.shift()||e).forEach(p=>x(m,p)),l.forEach(p=>{const c=C({primary:!1});n.appendChild(c);const u=y(s);c.appendChild(u.table),p.forEach(f=>x(u.tbody,f))})}function F(r=[],{context:e="preview"}={}){const a=(_.lastSnapshot||{}).metrics||{},n=r&&r.length?Object.keys(r[0]):[i("reservations.reports.results.headers.id","الحجز","Reservation"),i("reservations.reports.results.headers.customer","العميل","Customer"),i("reservations.reports.results.headers.date","التاريخ","Date"),i("reservations.reports.results.headers.status","الحالة","Status"),i("reservations.reports.results.headers.payment","الدفع","Payment"),i("reservations.reports.results.headers.total","الإجمالي","Total"),i("reservations.reports.results.headers.share","نسبة الشركة","Company share"),i("reservations.reports.results.headers.net","صافي الربح","Net profit")],t=I(e),o=document.createElement("div");o.style.position="fixed",o.style.left="-10000px",o.style.top="0",o.style.width=`${k}px`,o.style.zIndex="-1",document.body.appendChild(o),o.appendChild(t);try{q(t),S(t),M(t)}catch{}return D(t,r||[],n,a),t.parentElement?.removeChild(t),o.parentElement?.removeChild(o),t}async function Q(r=[],{action:e="save"}={}){const s=F(r,{context:"export"}),a=document.createElement("div");Object.assign(a.style,{position:"fixed",top:"0",left:"0",pointerEvents:"none",zIndex:"-1"}),a.appendChild(s),document.body.appendChild(a);try{await N();const n=window.html2pdf().set({margin:10,html2canvas:{scale:2,useCORS:!0,allowTaint:!1,backgroundColor:"#ffffff",scrollX:0,scrollY:0,windowWidth:k,windowHeight:T},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"},pagebreak:{mode:["css","legacy"]},image:{type:"jpeg",quality:.98}}).from(s).toPdf();if(e==="print"){const t=await n.get("pdf").then(o=>o.output("bloburl"));await new Promise(o=>{const d=document.createElement("iframe");Object.assign(d.style,{position:"fixed",right:"0",bottom:"0",width:"1px",height:"1px",border:"0"}),d.onload=()=>{try{d.contentWindow?.focus(),d.contentWindow?.print()}catch{}setTimeout(()=>{d.remove(),o()},1e3)},d.src=t,document.body.appendChild(d)})}else await n.save("reservations-report.pdf")}finally{a.remove()}}export{F as buildReportsPdfPages,Q as exportReportsPdf};
