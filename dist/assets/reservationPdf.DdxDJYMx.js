import{n as N,j as ct,t as i,d as Jt,b as oa,h as aa,p as ue,B as sa,y as vt,C as so}from"./auth.DScPmgUz.js";import{n as ra,v as Lt,t as Bt,a as ia,b as vn,d as ro,H as io,D as ca,g as co,r as la,c as ua,e as da,h as pa}from"./reservationsService.Drl7r91N.js";import{s as ma,i as wt,j as zn,I as lo,O as uo}from"./state.CBItNXQ3.js";import{h as fa}from"./view.9cm-cobB.js";import{q as ha}from"./quotePdf.WC1ebubv.js";import{s as wn,a as qn,e as Sn,p as ya}from"./canvasColorUtils.CviLtv6S.js";function po(e){const t=new Date;if(t.setHours(0,0,0,0),e==="today")return{startDate:dt(t),endDate:dt(t)};if(e==="week"){const n=new Date(t),o=n.getDay(),a=o===0?6:o-1;n.setDate(n.getDate()-a);const l=new Date(n);return l.setDate(n.getDate()+6),{startDate:dt(n),endDate:dt(l)}}if(e==="month"){const n=new Date(t.getFullYear(),t.getMonth(),1),o=new Date(t.getFullYear(),t.getMonth()+1,0);return{startDate:dt(n),endDate:dt(o)}}return e==="upcoming"?{startDate:dt(t),endDate:""}:{startDate:"",endDate:""}}function Zs(){const e=document.getElementById("search-reservation"),t=document.getElementById("filter-start-date"),n=document.getElementById("filter-end-date"),o=document.getElementById("reservation-date-range"),a=document.getElementById("reservation-status-filter");let l=N(t?.value||"").trim(),r=N(n?.value||"").trim(),u=o?.value||"";if(new Set(["","today","week","month"]).has(u)||(u="",o&&(o.value=""),Kt(t),Kt(n),l="",r=""),!l&&!r&&u){const y=po(u);l=y.startDate,r=y.endDate}return{searchTerm:ra(e?.value||""),startDate:l,endDate:r,status:a?.value||"",quickRange:u}}function er(e){const t=()=>{typeof e=="function"&&e()},n=document.getElementById("search-reservation");n&&!n.dataset.listenerAttached&&(n.addEventListener("input",()=>{n.value=N(n.value),t()}),n.dataset.listenerAttached="true");const o=document.getElementById("filter-start-date");o&&!o.dataset.listenerAttached&&(o.addEventListener("change",()=>{const m=document.getElementById("reservation-date-range");m&&(m.value=""),t()}),o.dataset.listenerAttached="true");const a=document.getElementById("filter-end-date");a&&!a.dataset.listenerAttached&&(a.addEventListener("change",()=>{const m=document.getElementById("reservation-date-range");m&&(m.value=""),t()}),a.dataset.listenerAttached="true");const l=document.getElementById("reservation-date-range");l&&!l.dataset.listenerAttached&&(l.addEventListener("change",()=>{ba(l.value),t()}),l.dataset.listenerAttached="true");const r=document.getElementById("reservation-status-filter");r&&!r.dataset.listenerAttached&&(r.addEventListener("change",t),r.dataset.listenerAttached="true");const u=document.getElementById("clear-filters");u&&!u.dataset.listenerAttached&&(u.addEventListener("click",()=>{n&&(n.value=""),Kt(o),Kt(a),l&&(l.value=""),r&&(r.value=""),t()}),u.dataset.listenerAttached="true")}function ba(e){const t=document.getElementById("filter-start-date"),n=document.getElementById("filter-end-date");if(!t||!n)return;const{startDate:o,endDate:a}=po(e);t._flatpickr?o?t._flatpickr.setDate(o,!1,"Y-m-d"):t._flatpickr.clear():t.value=o,n._flatpickr?a?n._flatpickr.setDate(a,!1,"Y-m-d"):n._flatpickr.clear():n.value=a}function dt(e){if(!e)return"";const t=e.getTimezoneOffset()*6e4;return new Date(e.getTime()-t).toISOString().split("T")[0]}function Kt(e){e&&(e._flatpickr&&e._flatpickr.clear(),e.value="")}const ga=""+new URL("Tajawal-400.ttf",import.meta.url).href,va=""+new URL("Tajawal-500.ttf",import.meta.url).href,Qn=""+new URL("Tajawal-700.ttf",import.meta.url).href,wa="reservations.quote.sequence",Vn={reservation:"reservations.quote.togglePrefs.v1",project:"projects.quote.togglePrefs.v1",reservationChecklist:"reservations.checklist.togglePrefs.v1"},mo="https://help.artratio.sa/guide/quote-preview",ke={logoUrl:"https://art-ratio.sirv.com/AR-Logo-v3.5-curved.png",companyName:"Ø´Ø±ÙƒØ© ÙÙˆØ¯ Ø¢Ø±Øª Ù„Ù„Ø¯Ø¹Ø§ÙŠØ© ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù† (Ø´Ø±ÙƒØ© Ø´Ø®Øµ ÙˆØ§Ø­Ø¯)",commercialRegistry:"4030485240",beneficiaryName:"Ø´Ø±ÙƒØ© ÙÙˆØ¯ Ø¢Ø±Øª Ù„Ù„Ø¯Ø¹Ø§ÙŠØ© ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù† (Ø´Ø±ÙƒØ© Ø´Ø®Øµ ÙˆØ§Ø­Ø¯)",bankName:"Ù…ØµØ±Ù Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠ",accountNumber:"Ù£Ù¥Ù¨Ù Ù Ù Ù Ù¡Ù Ù Ù Ù¦Ù Ù¨Ù¦Ù Ù¦Ù¥Ù§Ù Ù¦",iban:"SA1680000358608016065706",approvalNote:"Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø±Ø¶ ØªØ¹ØªØ¨Ø± Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…."},qa=["ÙŠÙˆÙ… Ø§Ù„Ø¹Ù…Ù„ Ù‡Ùˆ 12 Ø³Ø§Ø¹Ø©ØŒ ÙˆÙŠØªÙ… Ø§Ø­ØªØ³Ø§Ø¨ Ù†ØµÙ ÙŠÙˆÙ… Ø¥Ø¶Ø§ÙÙŠ Ø¨Ø¹Ø¯ 20 Ø³Ø§Ø¹Ø©ØŒ Ø«Ù… ÙŠÙˆÙ… ÙƒØ§Ù…Ù„ Ø¨Ø¹Ø¯ Ø°Ù„Ùƒ.","ÙŠÙ…Ù†Ø¹ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙÙŠ Ø£Ù†Ø´Ø·Ø© ØºÙŠØ± Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©.","ÙŠØªØ­Ù…Ù„ Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø± Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© Ø£ÙŠ ØªÙ„Ù Ø£Ùˆ ÙÙ‚Ø¯Ø§Ù†.","ÙŠØ¬Ø¨ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙÙŠ Ø­Ø§Ù„ØªÙ‡Ø§ Ø§Ù„Ø£ØµÙ„ÙŠØ©.","ÙŠØªÙ… ÙØ±Ø¶ Ø±Ø³ÙˆÙ… Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ù„ØºØ§Ø¡ Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ù‚Ø¨Ù„ 24 Ø³Ø§Ø¹Ø©."],Ie=[...qa],Sa=["ÙŠØªÙ… Ø¯ÙØ¹ 50% Ù…Ù† Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø±ØŒ ÙˆÙŠØªÙ… Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø§Ù„Ù€ 50% Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ.","ÙŠØ­ØµÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¹Ù„Ù‰ Ø­Ù‚ÙˆÙ‚ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© ÙÙŠ Ø£ÙŠ Ù…ÙƒØ§Ù† ÙŠØ±Ø§Ù‡ Ù…Ù†Ø§Ø³Ø¨Ø§Ù‹ØŒ Ø¨ÙŠÙ†Ù…Ø§ ØªØ­ØªÙØ¸ Ø§Ù„Ø´Ø±ÙƒØ© Ø¨Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø®Ø§Ù… ÙˆÙ„Ø§ ØªØ³ØªØ®Ø¯Ù…Ù‡Ø§ Ø¥Ù„Ø§ Ø¨Ø¹Ø¯ Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ø§ Ù„Ù… ÙŠÙØªÙÙ‚ Ø¹Ù„Ù‰ ØºÙŠØ± Ø°Ù„Ùƒ.","ÙŠØªÙ… Ø§Ù„Ø§ØªÙØ§Ù‚ Ø¹Ù„Ù‰ Ø¬Ø¯ÙˆÙ„ Ø²Ù…Ù†ÙŠ Ù„Ù„ØªÙ†ÙÙŠØ°ØŒ ÙˆØ£ÙŠ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ø®Ø§Ø±Ø¬ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ù…ØªÙÙ‚ Ø¹Ù„ÙŠÙ‡ ØªØ®Ø¶Ø¹ Ù„Ø±Ø³ÙˆÙ… Ø¥Ø¶Ø§ÙÙŠØ©.","Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù† ØªÙˆÙÙŠØ± Ø§Ù„ØªØµØ§Ø±ÙŠØ­ Ø§Ù„Ù„Ø§Ø²Ù…Ø© Ù„Ù„ØªØµÙˆÙŠØ± ÙÙŠ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©ØŒ ÙˆØ£ÙŠ ØªØ£Ø®ÙŠØ± Ù†Ø§ØªØ¬ Ø¹Ù† Ø°Ù„Ùƒ Ù‚Ø¯ ÙŠØ¤Ø«Ø± Ø¹Ù„Ù‰ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„ØªØ³Ù„ÙŠÙ….","ØªÙØ­ÙÙŽØ¸ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ù„Ù„Ù…Ø´Ø±ÙˆØ¹ Ù„Ù…Ø¯Ø© 12 Ø´Ù‡Ø±Ø§Ù‹ ÙÙŠ Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ø´Ø±ÙƒØ©ØŒ ÙˆÙŠÙ…ÙƒÙ† Ù„Ù„Ø¹Ù…ÙŠÙ„ Ø·Ù„Ø¨ Ù†Ø³Ø® Ø¥Ø¶Ø§ÙÙŠØ© Ø®Ù„Ø§Ù„ ØªÙ„Ùƒ Ø§Ù„ÙØªØ±Ø©.","ÙŠØªØ­Ù…Ù‘Ù„ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© ØªÙˆÙÙŠØ± Ø¨ÙŠØ¦Ø© Ø¹Ù…Ù„ Ø¢Ù…Ù†Ø© Ù„Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ ÙˆØ§Ù„Ù…Ø¹Ø¯Ø§Øª ÙÙŠ Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªØµÙˆÙŠØ±ØŒ ÙˆÙŠØ¶Ù…Ù† Ø§ØªØ®Ø§Ø° ÙƒØ§ÙØ© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·Ø§Øª Ø§Ù„Ù„Ø§Ø²Ù…Ø© Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø³Ù„Ø§Ù…ØªÙ‡Ù…."];function dn(e){return e?e.split(/\r?\n/).map(t=>t.trim()).filter(t=>t.length>0):[...Ie]}function ka(){const e=document.getElementById("reservation-terms");if(e&&e.value.trim().length>0){const o=dn(e.value);if(o.length)return o}const t=document.getElementById("edit-res-terms");if(t&&t.value.trim().length>0){const o=dn(t.value);if(o.length)return o}const n=Ie.join(`
`);return e&&e.value.trim().length===0&&(e.value=n),t&&t.value.trim().length===0&&(t.value=n),[...Ie]}const Aa=[{id:"customerInfo",labelKey:"reservations.quote.sections.customer",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„",defaultSelected:!0},{id:"reservationInfo",labelKey:"reservations.quote.sections.reservation",fallback:"ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²",defaultSelected:!0},{id:"projectInfo",labelKey:"reservations.quote.sections.project",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",defaultSelected:!0},{id:"financialSummary",labelKey:"reservations.quote.sections.financial",fallback:"Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ",defaultSelected:!0},{id:"items",labelKey:"reservations.quote.sections.items",fallback:"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",defaultSelected:!0},{id:"crew",labelKey:"reservations.quote.sections.crew",fallback:"Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„",defaultSelected:!0},{id:"notes",labelKey:"reservations.quote.sections.notes",fallback:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø­Ø¬Ø²",defaultSelected:!0},{id:"payment",labelKey:"reservations.quote.sections.payment",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹",defaultSelected:!1}],Zt=[{id:"rowNumber",labelKey:null,fallback:"#",render:(e,t)=>c(N(String(t+1)))},{id:"code",labelKey:"reservations.details.table.headers.code",fallback:"Ø§Ù„ÙƒÙˆØ¯",render:e=>{if(e?.isPackage){const t=e?.packageCodeResolved||e?.barcode||"";return c(t||"-")}return c(e?.barcode||"-")}},{id:"description",labelKey:"reservations.details.table.headers.description",fallback:"Ø§Ù„ÙˆØµÙ",render:e=>{const t=String(e?.desc||e?.description||"-");return`<div class="quote-cell quote-cell--desc">${c(t)}</div>`}},{id:"quantity",labelKey:"reservations.details.table.headers.quantity",fallback:"Ø§Ù„ÙƒÙ…ÙŠØ©",render:e=>c(N(String(e?.qty||1)))},{id:"unitPrice",labelKey:"reservations.quote.columns.unitPrice",fallback:"Ù„ÙƒÙ„ ÙŠÙˆÙ…",render:e=>c(N(Number(e?.unitPriceValue||0).toFixed(2)))},{id:"price",labelKey:"reservations.quote.columns.total",fallback:"Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹",render:e=>c(N(Number(e?.price||0).toFixed(2)))}],en=[{id:"rowNumber",labelKey:null,fallback:"#",render:(e,t)=>c(N(String(t+1)))},{id:"position",labelKey:"reservations.details.crew.position",fallback:"Ø§Ù„Ù…Ù†ØµØ¨",render:e=>{const t=typeof ue=="function"?ue():"ar",n=e?.positionLabelEn??e?.position_label_en??e?.position_name_en??e?.positionLabelAlt??e?.position_label_alt??e?.role,o=e?.positionLabel??e?.position_name??e?.role??i("reservations.crew.positionFallback","Ù…Ù†ØµØ¨ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…");return c(N(String(t==="en"&&n?n:o)))}},{id:"unitPrice",labelKey:"reservations.quote.columns.unitPrice",fallback:"Ù„ÙƒÙ„ ÙŠÙˆÙ…",render:e=>{const t=Number.isFinite(Number(e?.positionClientPrice))?Number(e.positionClientPrice):0;return c(`${N(t.toFixed(2))} ${i("reservations.create.summary.currency","SR")}`)}},{id:"price",labelKey:"reservations.quote.columns.total",fallback:"Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹",render:e=>{const t=Number.isFinite(Number(e?.positionClientPrice))?Number(e.positionClientPrice):0;return c(`${N(t.toFixed(2))} ${i("reservations.create.summary.currency","SR")}`)}}],st={customerInfo:[{id:"customerName",labelKey:"reservations.details.labels.customer",fallback:"Ø§Ù„Ø¹Ù…ÙŠÙ„"},{id:"customerCompany",labelKey:"reservations.details.labels.company",fallback:"Ø§Ù„Ø´Ø±ÙƒØ©"},{id:"customerPhone",labelKey:"reservations.details.labels.phone",fallback:"Ø§Ù„Ù‡Ø§ØªÙ"},{id:"customerEmail",labelKey:"reservations.details.labels.email",fallback:"Ø§Ù„Ø¨Ø±ÙŠØ¯"}],reservationInfo:[{id:"reservationId",labelKey:"reservations.details.labels.reservationId",fallback:"Ø±Ù‚Ù… Ø§Ù„Ø­Ø¬Ø²"},{id:"reservationStart",labelKey:"reservations.details.labels.start",fallback:"Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø­Ø¬Ø²"},{id:"reservationEnd",labelKey:"reservations.details.labels.end",fallback:"Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø­Ø¬Ø²"},{id:"reservationDuration",labelKey:"reservations.details.labels.duration",fallback:"Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…"}],projectInfo:[{id:"projectTitle",labelKey:"reservations.details.labels.project",fallback:"Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectCode",labelKey:"reservations.details.labels.code",fallback:"Ø§Ù„Ø±Ù…Ø²"}],financialSummary:[{id:"discountAmount",labelKey:"reservations.details.labels.discount",fallback:"Ø§Ù„Ø®ØµÙ…"},{id:"subtotalBeforeTax",labelKey:"reservations.details.labels.subtotalBeforeTax",fallback:"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"},{id:"taxAmount",labelKey:"reservations.details.labels.tax",fallback:"Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"},{id:"finalTotal",labelKey:"reservations.details.labels.total",fallback:"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ"}],payment:[{id:"beneficiary",labelKey:"reservations.quote.labels.beneficiary",fallback:"Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙÙŠØ¯"},{id:"bank",labelKey:"reservations.quote.labels.bank",fallback:"Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ"},{id:"account",labelKey:"reservations.quote.labels.account",fallback:"Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨"},{id:"iban",labelKey:"reservations.quote.labels.iban",fallback:"Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ¨Ø§Ù†"}],items:[...Zt.map(({id:e,labelKey:t,fallback:n})=>({id:e,labelKey:t,fallback:n})),{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…"},{id:"equipmentSubtotal",labelKey:"reservations.details.labels.equipmentTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"}],crew:[...en.map(({id:e,labelKey:t,fallback:n})=>({id:e,labelKey:t,fallback:n})),{id:"quantity",labelKey:"reservations.details.table.headers.quantity",fallback:"Ø§Ù„ÙƒÙ…ÙŠØ©"},{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…"},{id:"crewSubtotal",labelKey:"reservations.details.labels.crewTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±ÙŠÙ‚"}]},fo=[{id:"rowNumber",labelKey:null,fallback:"#",render:(e,t)=>c(N(String(t+1)))},{id:"label",labelKey:null,fallback:"Ø§Ù„Ø¨Ù†Ø¯",render:e=>c(e?.label||"-")},{id:"amount",labelKey:null,fallback:"Ø§Ù„Ø³Ø¹Ø±",render:e=>{const t=Number.isFinite(Number(e?.salePrice??e?.sale_price))?Number(e?.salePrice??e?.sale_price):Number(e?.amount??0)||0;return c(ae(t,i("reservations.create.summary.currency","SR")))}},{id:"note",labelKey:null,fallback:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª",render:e=>c(e?.note||"-")}],_a=[{id:"customerInfo",labelKey:"projects.quote.sections.customer",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„",defaultSelected:!0},{id:"projectInfo",labelKey:"projects.quote.sections.project",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",defaultSelected:!0},{id:"projectExpenses",labelKey:"projects.quote.sections.expenses",fallback:"Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©",defaultSelected:!0},{id:"projectCrew",labelKey:"projects.quote.sections.crew",fallback:"Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„",defaultSelected:!0},{id:"financialSummary",labelKey:"projects.quote.sections.financial",fallback:"Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ",defaultSelected:!0},{id:"projectEquipment",labelKey:"projects.quote.sections.equipment",fallback:"Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",defaultSelected:!0},{id:"projectNotes",labelKey:"projects.quote.sections.notes",fallback:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",defaultSelected:!0},{id:"payment",labelKey:"reservations.quote.sections.payment",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹",defaultSelected:!1}],xa={customerInfo:st.customerInfo,projectInfo:[{id:"projectTitle",labelKey:"projects.details.overview.heading",fallback:"Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectCode",labelKey:"projects.details.labels.code",fallback:"Ø±Ù‚Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectType",labelKey:"projects.details.type",fallback:"Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectStart",labelKey:"projects.details.start",fallback:"Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectEnd",labelKey:"projects.details.end",fallback:"Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectDuration",labelKey:"projects.details.duration",fallback:"Ù…Ø¯Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"},{id:"projectStatus",labelKey:"projects.details.status",fallback:"Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"}],financialSummary:[{id:"reservationsTotal",labelKey:"projects.details.reservationsTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª"},{id:"discountAmount",labelKey:"projects.details.summary.discount",fallback:"Ø§Ù„Ø®ØµÙ…"},{id:"taxAmount",labelKey:"projects.details.summary.combinedTax",fallback:"Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"},{id:"overallTotal",labelKey:"projects.details.summary.overallTotal",fallback:"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ"}],payment:st.payment,projectExpenses:[...fo.map(({id:e,labelKey:t,fallback:n})=>({id:e,labelKey:t,fallback:n})),{id:"expensesSubtotal",labelKey:"projects.details.expensesTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©"}],projectCrew:[...en.map(({id:e,labelKey:t,fallback:n})=>({id:e,labelKey:t,fallback:n})),{id:"quantity",labelKey:"reservations.details.table.headers.quantity",fallback:"Ø§Ù„ÙƒÙ…ÙŠØ©"},{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…"},{id:"crewSubtotal",labelKey:"reservations.details.labels.crewTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±ÙŠÙ‚"}],projectEquipment:[...Zt.map(({id:e,labelKey:t,fallback:n})=>({id:e,labelKey:t,fallback:n})),{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…"},{id:"equipmentSubtotal",labelKey:"reservations.details.labels.equipmentTotal",fallback:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"}],projectNotes:[]},ln=new Map;function tn(e="reservation"){if(ln.has(e))return ln.get(e);const t=e==="project"?_a:e==="reservationChecklist"?[{id:"customerInfo",labelKey:"reservations.quote.sections.customer",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„",defaultSelected:!0},{id:"reservationInfo",labelKey:"reservations.quote.sections.reservation",fallback:"ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²",defaultSelected:!0},{id:"projectInfo",labelKey:"reservations.quote.sections.project",fallback:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",defaultSelected:!0},{id:"notes",labelKey:"reservations.quote.sections.notes",fallback:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø­Ø¬Ø²",defaultSelected:!0},{id:"items",labelKey:"reservations.quote.sections.items",fallback:"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",defaultSelected:!0},{id:"crew",labelKey:"reservations.quote.sections.crew",fallback:"Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„",defaultSelected:!0}]:Aa,n=e==="project"?xa:e==="reservationChecklist"?{customerInfo:st.customerInfo,reservationInfo:st.reservationInfo,projectInfo:st.projectInfo,notes:[],items:st.items,crew:st.crew}:st,o=new Set(t.map(({id:r})=>r)),a=Object.fromEntries(Object.entries(n).map(([r,u=[]])=>[r,new Set(u.map(m=>m.id))])),l={sectionDefs:t,fieldDefs:n,sectionIdSet:o,fieldIdMap:a};return ln.set(e,l),l}function nn(e="reservation"){return tn(e).sectionDefs}function ho(e="reservation"){return tn(e).fieldDefs}function yo(e="reservation"){return tn(e).sectionIdSet}function bo(e="reservation"){return tn(e).fieldIdMap}function go(e){switch(e){case"export":return i("reservations.quote.status.exporting","Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ù…Ù„Ù PDF...");case"render":default:return i("reservations.quote.status.rendering","Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©...")}}const Ca="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js",$a="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js",Ea="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js",vo=ha.trim(),wo=`
@font-face { font-family: 'Tajawal'; font-style: normal; font-weight: 400; font-display: swap; src: url(${JSON.stringify(ga)}) format('truetype'); }
@font-face { font-family: 'Tajawal'; font-style: normal; font-weight: 500; font-display: swap; src: url(${JSON.stringify(va)}) format('truetype'); }
@font-face { font-family: 'Tajawal'; font-style: normal; font-weight: 600; font-display: swap; src: url(${JSON.stringify(Qn)}) format('truetype'); }
@font-face { font-family: 'Tajawal'; font-style: normal; font-weight: 700; font-display: swap; src: url(${JSON.stringify(Qn)}) format('truetype'); }
`,qo=/^data:image\/svg\+xml/i,Na=/\.svg($|[?#])/i,Ct=512,pn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/B8AAusB9YwpClgAAAAASUVORK5CYII=",So=96,ko=25.4,mn=210,Ot=297,$t=Math.round(mn/ko*So),Et=Math.round(Ot/ko*So);function ce(e){const t=Number(e),n=Number.isFinite(t)?t:0;try{const o=Math.abs(n%1)>1e-9;return N(n.toLocaleString("en-US",{minimumFractionDigits:o?2:0,maximumFractionDigits:2}))}catch{return Number.isInteger(n)?N(String(n)):N(n.toFixed(2))}}let Ht=!1,Ut=null;function kn(){Ht||(Ut=async function(){try{if(!s||!w?.modal?.classList.contains("show")||(s.context||"reservation")!=="reservation")return;const n=s.reservation;if(!n)return;const o=[n.id,n.reservationId,n.reservation_id,n.reservationCode,n.reservation_code].map(q=>q==null?"":String(q)).filter(q=>q.length>0);if(!o.length)return;const a=co(),l=(Array.isArray(a)?a:[]).find(q=>[q?.id,q?.reservationId,q?.reservation_id,q?.reservationCode,q?.reservation_code].map(T=>T==null?"":String(T)).filter(T=>T.length>0).some(T=>o.includes(T)));if(!l)return;const r=cn(l),{totalsDisplay:u,totals:m,rentalDays:y}=Rn(l,r,s.project);s.reservation=l,s.crewAssignments=r,s.totals=m,s.totalsDisplay=u,s.rentalDays=y,s.context==="reservationChecklist"&&Eo(),Rt(),Ae()}catch(t){console.warn("[reservationPdf] live update failed",t)}},document.addEventListener("reservations:changed",Ut),Ht=!0)}function Ao(){if(Ht){try{document.removeEventListener("reservations:changed",Ut)}catch{}Ut=null,Ht=!1}}const _o=2,xo=/safari/i,ja=/(iphone|ipad|ipod)/i,Gn=/(iphone|ipad|ipod)/i,Ta=/(crios|fxios|edgios|opios)/i,zt="[reservations/pdf]";let w=null,s=null,ze=1,_t=null,xt=null,rt=null,yt=null,Nt=!1;const Qt="quoteBlockOffsets",Wn=1800,Vt="quoteInfoAlignments",La=["customer","reservation","project","projectCustomer","projectDetails"],An={customer:"left",reservation:"left",project:"left",projectCustomer:"left",projectDetails:"left"},fn={project:{customer:"left",reservation:"left",project:"left",projectCustomer:"left",projectDetails:"left"},reservationChecklist:{customer:"left",reservation:"left",project:"left",projectCustomer:"left",projectDetails:"left"}};let qt=!1,_n=!1,It=!1;const xn={project:{"project-title":{x:-182.78680419921875,y:-5.0181427001953125},"project-content":{x:-140.1977996826172,y:-4.7384796142578125}}},bt={blockOffsets:"data-block-offsets",infoAlignments:"data-info-alignments",context:"data-quote-source-context"};function Co(e){return N(String(e??"")).trim().toLowerCase()}function $o(e){return e==null?"":N(String(e)).trim().toLowerCase()}function Cn(){const e=Jt()||{},t=Array.isArray(e.equipment)?e.equipment:[],n=new Map,o=new Map;return t.forEach(a=>{if(!a||typeof a!="object")return;[a.id,a.equipment_id,a.equipmentId,a.item_id,a.itemId].forEach(r=>{r==null||r===""||n.set(String(r),a)});const l=$o(a.barcode);l&&o.set(l,a)}),{byId:n,byBarcode:o}}function Ia(e={},t){if(!t)return null;const n=[e.equipmentId,e.equipment_id,e.id,e.itemId,e.item_id];for(const a of n){if(a==null||a==="")continue;const l=String(a);if(t.byId.has(l))return t.byId.get(l)}const o=[e.barcode,e.normalizedBarcode,e.code];for(const a of o){const l=$o(a);if(l&&t.byBarcode.has(l))return t.byBarcode.get(l)}return null}function $n(e,t,n=new Set){const o=new Set;if(!e||typeof e!="object")return o;const a=r=>{const u=typeof r=="string"?r.trim():"";u&&o.add(u)};if(a(e.lessor??e.owner??e.lessor_name??e.lessorName),Array.isArray(e.packageItems)&&e.packageItems.length>0&&!n.has(e)&&(n.add(e),e.packageItems.forEach(r=>{$n(r,t,n).forEach(u=>o.add(u))}),n.delete(e)),!o.size){const r=Ia(e,t);r&&a(r.lessor??r.owner??r.lessor_name??r.lessorName)}return o}function Da(e,t,n){if(!(t instanceof Set)||t.size===0)return!0;const o=$n(e,n);if(!o.size)return!1;for(const a of o){const l=Co(a);if(l&&t.has(l))return!0}return!1}function Pa(e,t){const n=Array.isArray(e?.items)?e.items:[],o=new Map;n.forEach(l=>{$n(l,t).forEach(r=>{const u=Co(r);u&&(o.has(u)||o.set(u,{key:u,label:r,count:0}),o.get(u).count+=1)})});const a=new Intl.Collator("ar",{sensitivity:"base"});return Array.from(o.values()).sort((l,r)=>a.compare(l.label,r.label))}function Eo(){if(!s||s.context!=="reservationChecklist")return;const e=Cn();s.checklistEquipmentLookup=e;const t=Pa(s.reservation,e),n=new Set(t.map(a=>a.key)),o=s.checklistLessorFilter instanceof Set?s.checklistLessorFilter:new Set;Array.from(o).forEach(a=>{n.has(a)||o.delete(a)}),s.checklistLessorOptions=t,s.checklistLessorFilter=o,Gt()}function Gt(){if(!w?.checklistLessorContainer)return;const e=w.checklistLessorContainer,t=w.checklistLessorOptionsHost;if(!s||s.context!=="reservationChecklist"){e.hidden=!0;return}const n=Array.isArray(s.checklistLessorOptions)?s.checklistLessorOptions:[],o=s.checklistLessorFilter instanceof Set?s.checklistLessorFilter:new Set;if(!t){e.hidden=!0;return}if(!n.length){e.hidden=!0,t.innerHTML=`<p class="text-muted" data-lessor-empty>${c(i("reservations.checklist.controls.lessors.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ø¤Ø¬Ø± Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„Ù…Ø¹Ø¯Ø§Øª."))}</p>`;const l=e.querySelector("[data-lessor-clear]");l&&(l.disabled=!0);return}e.hidden=!1,t.innerHTML=n.map(l=>{const r=`checklist-lessor-${l.key}`,u=l.count?` <small>(${c(N(String(l.count)))})</small>`:"";return`
      <label for="${r}" style="display:flex;align-items:center;gap:6px;">
        <input type="checkbox" id="${r}" value="${l.key}" ${o.has(l.key)?"checked":""}>
        <span>${c(l.label)}${u}</span>
      </label>
    `}).join(""),t.querySelectorAll('input[type="checkbox"]').forEach(l=>{l.addEventListener("change",()=>{s.checklistLessorFilter instanceof Set||(s.checklistLessorFilter=new Set),l.checked?s.checklistLessorFilter.add(l.value):s.checklistLessorFilter.delete(l.value),Gt(),Ae()})});const a=e.querySelector("[data-lessor-clear]");a&&(a.disabled=o.size===0,a.onclick=()=>{s.checklistLessorFilter instanceof Set&&(s.checklistLessorFilter.clear(),Gt(),Ae())})}function No(){if(!s?.reservation||s.context!=="reservationChecklist")return s?.reservation||null;const e=s.checklistLessorFilter;if(!(e instanceof Set)||e.size===0)return s.reservation;const t=s.checklistEquipmentLookup||Cn();s.checklistEquipmentLookup=t;const n=Array.isArray(s.reservation.items)?s.reservation.items:[],o=n.filter(a=>Da(a,e,t));return o.length===n.length?s.reservation:{...s.reservation,items:o}}function Yn(e){try{return encodeURIComponent(JSON.stringify(e))}catch{return""}}function Xn(e,t){if(!e)return null;const n=e.getAttribute(t);if(!n)return null;try{return JSON.parse(decodeURIComponent(n))}catch{return null}}function Fa(e={}){const t=[],n=e.context||Qe(e);if(t.push(`${bt.context}="${c(String(n))}"`),e.blockOffsets&&Object.keys(e.blockOffsets).length){const o=Yn(e.blockOffsets);o&&t.push(`${bt.blockOffsets}="${o}"`)}if(e.infoAlignments&&Object.keys(e.infoAlignments).length){const o=Yn(e.infoAlignments);o&&t.push(`${bt.infoAlignments}="${o}"`)}return t.length?` ${t.join(" ")}`:""}let it=null;function jo(e){return e&&typeof e=="object"?e:it||s||null}function Qe(e=null){return jo(e)?.context||"reservation"}function Oa(e="reservation"){try{const n=JSON.parse(localStorage.getItem(Qt)||"{}")?.[e];if(n&&typeof n=="object")return JSON.parse(JSON.stringify(n))}catch{}return{}}function To(e,t={}){try{const n=JSON.parse(localStorage.getItem(Qt)||"{}");t&&Object.keys(t).length>0?n[e]=t:delete n[e],localStorage.setItem(Qt,JSON.stringify(n))}catch{}}function En(e){if(!e)return;const t=Qe(e),n=Oa(t);e.blockOffsets={...xn[t]||{},...n},_n=!1,qt=!1,on()}function Ma(e,t={}){if(!e)return;e.querySelectorAll("[data-drag-key]").forEach(o=>{const a=o.dataset.dragKey,l=t?.[a],r=Number(l?.x)||0,u=Number(l?.y)||0;r||u?o.style.transform=`translate(${r}px, ${u}px)`:o.style.transform="",o.dataset.dragX=String(r),o.dataset.dragY=String(u)})}function Nn(e){try{const t=e?.getElementById("quotation-pdf-root");if(!t)return;t.dataset.blockDragMode=qt?"on":"off"}catch{}}function on(){const e=w?.blockDragToggle;if(e){const n=qt?i("reservations.quote.drag.disable","ðŸ”’ Ø¥Ù†Ù‡Ø§Ø¡ ÙˆØ¶Ø¹ Ø§Ù„ØªØ­Ø±ÙŠÙƒ"):i("reservations.quote.drag.enable","ðŸŽ¯ ÙˆØ¶Ø¹ ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø¨Ù„ÙˆÙƒØ§Øª");e.setAttribute("aria-label",n),e.setAttribute("title",n),e.classList.toggle("is-active",qt)}const t=w?.blockDragSave;t&&(t.disabled=!_n)}function Ra(e){qt=!!e,on();try{Nn(w?.previewFrame?.contentDocument)}catch{}}function jn(e=!0){_n=!!e,on()}function Ba(){if(!s)return;const e=Qe(s),t=s.blockOffsets||{};To(e,t),jn(!1),ct(i("reservations.quote.drag.saved","âœ… ØªÙ… Ø­ÙØ¸ Ù…ÙˆØ§Ø¶Ø¹ Ø§Ù„Ø¨Ù„ÙˆÙƒØ§Øª."))}function Ka(){if(!s)return;const e=Qe(s);s.blockOffsets={...xn[e]||{}},To(e,s.blockOffsets),jn(!1),Ae(),ct(i("reservations.quote.drag.reset","â†º ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© Ù…ÙˆØ§Ø¶Ø¹ Ø§Ù„Ø¨Ù„ÙˆÙƒØ§Øª Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ."))}function Jn(e){return Math.min(Math.max(e,-Wn),Wn)}function Ha(e="reservation"){try{const n=JSON.parse(localStorage.getItem(Vt)||"{}")?.[e];if(n&&typeof n=="object")return{...n}}catch{}return null}function Ua(e,t={}){try{const n=JSON.parse(localStorage.getItem(Vt)||"{}");n[e]=t,localStorage.setItem(Vt,JSON.stringify(n))}catch{}}function Tn(e){if(!e||It)return;const t=Qe(e),n=Ha(t);e.infoAlignments={...An,...fn[t]||{},...n||{}},It=!0}function Lo(e,t){const n=jo(e),o=n?.infoAlignments;if(o&&Object.prototype.hasOwnProperty.call(o,t))return o[t];const a=Qe(n);return fn[a]?.[t]?fn[a][t]:An[t]||"right"}function jt(e,t){return`info-plain info-plain--align-${Lo(e,t)}`}function za(e,t){if(!s)return;const n=La.includes(e)?e:"customer",o=["left","center","right"].includes(t)?t:"right";s.infoAlignments||(s.infoAlignments={...An}),s.infoAlignments[n]=o;const a=Qe(s);Ua(a,s.infoAlignments),Ae(),an()}function an(){if(!w?.alignTarget)return;const e=w.alignTarget.value||"customer",t=Lo(s,e);(w.alignButtons||[]).forEach(n=>{const o=n.dataset.alignValue;o&&n.classList.toggle("is-active",o===t)})}async function Qa(){try{if(!s)return;const e=Qe(s),t=JSON.parse(localStorage.getItem(Qt)||"{}"),n=JSON.parse(localStorage.getItem(Vt)||"{}"),o={context:e,blockOffsets:s.blockOffsets||t[e]||{},infoAlignments:s.infoAlignments||n[e]||{}},a=JSON.stringify(o,null,2);let l=!1;if(navigator?.clipboard?.writeText)try{await navigator.clipboard.writeText(a),l=!0}catch{l=!1}l?ct(i("reservations.quote.align.copied","âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©")):window.prompt(i("reservations.quote.align.copyPrompt","Ø§Ù†Ø³Ø® Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©"),a)}catch(e){console.error("[quote align export] failed",e),ct(i("reservations.quote.align.copyFailed","âš ï¸ ØªØ¹Ø°Ø± Ù†Ø³Ø® Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªØŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹"),"error")}}function Va(e){try{const t=e?.getElementById("quotation-pdf-root");if(!t)return;Array.from(t.querySelectorAll("[data-drag-key]")).forEach(o=>{if(o.dataset.blockDragHandleAttached==="true")return;o.style.position=o.style.position||"relative",o.style.touchAction="none";const a=e.createElement("button");a.type="button",a.className="quote-block-drag-handle",a.setAttribute("data-block-handle",o.dataset.dragKey||""),a.setAttribute("aria-label",i("reservations.quote.drag.handle","Ø§Ø³Ø­Ø¨ Ù„ØªØ­Ø±ÙŠÙƒ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…")),a.innerHTML='<span aria-hidden="true">â ¿</span>';const l=r=>{t.dataset.blockDragMode==="on"&&Ga(r,o)};a.addEventListener("pointerdown",l),o.prepend(a),o.dataset.blockDragHandleAttached="true"}),Nn(e)}catch{}}function Ga(e,t){if(!t||!s)return;e.preventDefault(),e.stopPropagation();const n=t.ownerDocument||document,o=e.pointerId;t.setPointerCapture?.(o);const a=e.clientX,l=e.clientY,r=Number(t.dataset.dragX||0),u=Number(t.dataset.dragY||0);let m=r,y=u;const q=t.dataset.dragKey,v=b=>{b.preventDefault();const h=b.clientX-a,E=b.clientY-l;m=Jn(r+h),y=Jn(u+E),t.style.transform=`translate(${m}px, ${y}px)`,t.dataset.dragTempX=String(m),t.dataset.dragTempY=String(y)},T=()=>{n.removeEventListener("pointermove",v),n.removeEventListener("pointerup",T),t.releasePointerCapture?.(o);const b=Number(t.dataset.dragTempX??r),h=Number(t.dataset.dragTempY??u);t.dataset.dragX=String(b),t.dataset.dragY=String(h),t.dataset.dragTempX="",t.dataset.dragTempY="",s.blockOffsets||(s.blockOffsets={}),Math.abs(b)<=.5&&Math.abs(h)<=.5?delete s.blockOffsets[q]:s.blockOffsets[q]={x:b,y:h},jn(!0)};n.addEventListener("pointermove",v),n.addEventListener("pointerup",T)}function pt(e="render",{message:t,actionLabel:n,onAction:o,showSpinner:a=e!=="error"}={}){if(!w?.statusIndicator||!w?.statusText)return;w.statusKind=e;const l=t||go(e);w.statusText.textContent=l,w.statusSpinner&&(w.statusSpinner.hidden=!a),w.statusAction&&(w.statusAction.hidden=!0,w.statusAction.onclick=null,n&&typeof o=="function"&&(w.statusAction.textContent=n,w.statusAction.hidden=!1,w.statusAction.onclick=r=>{r.preventDefault(),o()})),w.statusIndicator.hidden=!1,requestAnimationFrame(()=>{w.statusIndicator.classList.add("is-visible")})}function gt(e){try{return String(e||"").toLowerCase().normalize("NFKD").replace(/[\u064B-\u065F\u0670\u06D6-\u06ED]/g,"").replace(/\s+/g," ").trim()}catch{return String(e||"").trim().toLowerCase()}}function Tt(e){!w?.statusIndicator||!w?.statusText||(w.statusKind=null,w.statusIndicator.classList.remove("is-visible"),setTimeout(()=>{w?.statusIndicator&&(w.statusIndicator.hidden=!0,w.statusAction&&(w.statusAction.hidden=!0,w.statusAction.onclick=null),w.statusSpinner&&(w.statusSpinner.hidden=!1))},220))}function hn(){return!!window?.bootstrap?.Modal}function Wa(e){if(e&&!e.classList.contains("show")){e.classList.add("show"),e.style.display="block",e.removeAttribute("aria-hidden"),e.setAttribute("aria-modal","true"),e.getAttribute("role")||e.setAttribute("role","dialog"),document.body.classList.add("modal-open"),rt||(rt=document.createElement("div"),rt.className="modal-backdrop fade show",rt.dataset.quotePdfFallbackBackdrop="true",document.body.appendChild(rt)),yt||(yt=t=>{t.key==="Escape"&&yn(e)},document.addEventListener("keydown",yt));try{e.focus({preventScroll:!0})}catch{}}}function yn(e){if(!(!e||!e.classList.contains("show"))){try{const t=e.ownerDocument?.activeElement;if(t&&e.contains(t)){try{t.blur()}catch{}try{e.ownerDocument?.body?.focus({preventScroll:!0})}catch{}}}catch{}e.classList.remove("show"),e.style.display="none",e.setAttribute("aria-hidden","true"),e.removeAttribute("aria-modal"),document.body.classList.remove("modal-open"),rt&&(rt.remove(),rt=null),yt&&(document.removeEventListener("keydown",yt),yt=null);try{Ao()}catch{}}}function Ya(e){if(e){if(hn()){const t=window.bootstrap.Modal.getOrCreateInstance(e);try{const n=()=>{try{const o=document.activeElement;if(o&&e.contains(o)){try{o.blur()}catch{}try{document.body?.focus({preventScroll:!0})}catch{}}}catch{}try{Ao()}catch{}try{e.removeEventListener("hidden.bs.modal",n)}catch{}};e.addEventListener("hidden.bs.modal",n,{once:!0}),e.addEventListener("hide.bs.modal",()=>{try{const o=document.activeElement;if(o&&e.contains(o))try{o.blur()}catch{}}catch{}})}catch{}t.show();return}Wa(e)}}function Xa(){if(Nt)return;Nt=!0;const e=i("reservations.quote.toast.viewGuide","ðŸ“˜ Ø¹Ø±Ø¶ Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø­Ù„ Ø§Ù„Ø³Ø±ÙŠØ¹"),t=i("reservations.quote.toast.retry","Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©"),n=i("reservations.quote.toast.assetsFailed","âš ï¸ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø¨Ø¹Ø¶ Ø§Ù„ØµÙˆØ± Ø¶Ù…Ù† Ø¹Ø±Ø¶ Ø³Ø¹Ø±."),o=!!w?.modal?.classList.contains("show"),a=()=>{w?.modal?.classList.contains("show")&&(pt("render"),Nt=!1,Ae())};so({message:n,duration:9e3,actionLabel:o?t:void 0,onAction:o?a:void 0,linkLabel:e,linkHref:mo}),o&&pt("error",{message:n,actionLabel:t,onAction:a,showSpinner:!1})}function Pt(e="reservation"){const t={},n=ho(e);return Object.entries(n).forEach(([o,a=[]])=>{t[o]=new Set(a.filter(l=>l?.default!==!1).map(l=>l.id))}),t}function Ln(e={}){const t={};return Object.entries(e).forEach(([n,o])=>{t[n]=new Set(Array.from(o||[]))}),t}function Ja(e={},t){if(t)return e[t]||(e[t]=new Set),e[t]}function In(e={},t,n){const o=e?.[t];return o?o instanceof Set?o.has(n):Array.isArray(o)?o.includes(n):!!o?.[n]:!0}function sn(e="reservation"){return Object.fromEntries(nn(e).map(({id:t})=>[t,!1]))}function Dn(e,t){return e.sectionExpansions||(e.sectionExpansions=sn(e.context||"reservation")),t&&typeof e.sectionExpansions[t]!="boolean"&&(e.sectionExpansions[t]=!1),e.sectionExpansions}function Za(e,t){return Dn(e,t)?.[t]!==!1}function Pn(){return typeof window>"u"||typeof window.matchMedia!="function"?!1:window.matchMedia("(max-width: 768px)").matches}function es(){if(typeof navigator>"u")return!1;const e=navigator.userAgent||navigator.platform||"";return ja.test(e)}function ts(){if(typeof navigator>"u")return!1;const e=navigator.userAgent||"",t=xo.test(e),n=e.includes("Chrome")||e.includes("CriOS")||e.includes("Chromium"),o=e.includes("Edg");return t&&!n&&!o}function Io(){return es()&&ts()}function rn(){if(typeof navigator>"u")return!1;const e=navigator.userAgent||"",t=navigator.platform||"",n=Number.isFinite(navigator.maxTouchPoints)?navigator.maxTouchPoints:0,o=Gn.test(e)||Gn.test(t),a=/Macintosh/i.test(e)&&n>1;return xo.test(e)&&!Ta.test(e)&&(o||a)}function un(e,...t){try{console.log(`${zt} ${e}`,...t)}catch{}}function Je(e,...t){try{console.warn(`${zt} ${e}`,...t)}catch{}}function ns(e,t,...n){try{t?console.error(`${zt} ${e}`,t,...n):console.error(`${zt} ${e}`,...n)}catch{}}function me(e,{blockType:t="section",extraAttributes:n=""}={}){if(!e)return"";const o=n?` ${n.trim()}`:"";return e.replace(/^(<\w+)/,`$1 data-quote-block data-block-type="${t}"${o}`)}function os(e,t="Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¹Ø±Ø¶."){const n=c(i(e,t));return me(`<section class="quote-section quote-placeholder">${n}</section>`,{blockType:"placeholder"})}function Wt(e,t){return Array.isArray(e)&&e.length?e:[os(t)]}const as=/[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF]/;function Do(e=""){return as.test(e)}function ss(){const e=window.CanvasRenderingContext2D?.prototype;if(!e||e.__artRatioDirectionPatched)return;const t=n=>{const o=e[n];typeof o=="function"&&(e[n]=function(l,...r){if(typeof l!="string"||!Do(l))return o.call(this,l,...r);let u,m=!1;try{"direction"in this&&(u=this.direction,u!=="rtl"&&(this.direction="rtl"),m=!0)}catch{}try{if(!m){const y=this.canvas;y&&y.style?.direction!=="rtl"&&(y.__artRatioOriginalDirection=y.style.direction,y.style.direction="rtl")}return o.call(this,l,...r)}finally{if(m&&u!==void 0&&u!=="rtl")try{this.direction=u}catch{}else if(!m){const y=this.canvas;y&&y.__artRatioOriginalDirection!==void 0&&(y.style.direction=y.__artRatioOriginalDirection,delete y.__artRatioOriginalDirection)}}})};t("fillText"),t("strokeText"),e.__artRatioDirectionPatched=!0}function Zn(e,t=Ct){if(typeof e!="string"&&typeof e!="number")return t;const n=parseFloat(String(e).replace(/[^0-9.+-]/g,""));return Number.isFinite(n)&&n>0?n:t}function rs(e){if(!e)return{width:Ct,height:Ct};const t=e.getAttribute?.("width"),n=e.getAttribute?.("height");let o=t?Zn(t,0):0,a=n?Zn(n,0):0;if(o>0&&a>0)return{width:o,height:a};const l=e.getAttribute?.("viewBox");if(l){const r=l.trim().split(/[\s,]+/).map(u=>parseFloat(u||"0"));if(r.length>=4){const[,,u,m]=r;o=o||(Number.isFinite(u)&&u>0?u:0),a=a||(Number.isFinite(m)&&m>0?m:0)}}return{width:o||Ct,height:a||Ct}}function Po(e=""){return typeof e!="string"?!1:qo.test(e)||Na.test(e)}function is(e=""){const t=e.indexOf(",");if(t===-1)return"";const n=e.slice(0,t),o=e.slice(t+1);try{return/;base64/i.test(n)?typeof atob=="function"?atob(o):"":decodeURIComponent(o)}catch(a){return console.warn("[reservations/pdf] failed to decode SVG data URI",a),""}}function cs(e,{crossOrigin:t}={}){return new Promise((n,o)=>{const a=new Image;t&&(a.crossOrigin=t),a.onload=()=>n(a),a.onerror=l=>{const r=l?.message||`Unable to load image from ${e}`;o(new Error(r))},a.src=e})}async function Fo(e,t={}){if(!e)return null;const n=document,o=new Blob([e],{type:"image/svg+xml;charset=utf-8"}),a=URL.createObjectURL(o);try{const l=await cs(a),r=n.createElement("canvas"),u=Math.max(t.width||l.naturalWidth||l.width||0,1),m=Math.max(t.height||l.naturalHeight||l.height||u,1);r.width=u,r.height=m;const y=r.getContext("2d");return y.clearRect(0,0,u,m),y.drawImage(l,0,0,u,m),r.toDataURL("image/png")}catch(l){return console.warn("[reservations/pdf] failed to rasterize SVG content",l),null}finally{URL.revokeObjectURL(a)}}async function ls(e){if(!e)return null;if(qo.test(e))return is(e);try{const t=await fetch(e,{mode:"cors",credentials:"omit",cache:"default"});return t.ok?await t.text():(console.warn("[reservations/pdf] failed to fetch SVG image",e,t.status),null)}catch(t){return console.warn("[reservations/pdf] error fetching SVG image",e,t),null}}async function us(e){if(!e)return!1;const t=e.getAttribute?.("src")||"";if(!Po(t))return!1;const n=await ls(t);if(!n)return e.dataset.svgRasterization="failed",e.setAttribute("src",pn),!1;const o=await Fo(n);return o?(e.dataset.svgOriginalSrc=t,e.setAttribute("src",o),e.setAttribute("data-rasterized","true"),!0):(e.dataset.svgRasterization="failed",e.setAttribute("src",pn),!1)}async function ds(e){if(!e||e.tagName?.toLowerCase()!=="svg")return!1;const n=new XMLSerializer().serializeToString(e),o=rs(e),a=await Fo(n,o),r=(e.ownerDocument||document).createElement("img");r.setAttribute("src",a||pn),r.setAttribute("alt",e.getAttribute("aria-label")||e.getAttribute("title")||""),r.setAttribute("data-svg-replaced","true"),e.hasAttribute("class")&&r.setAttribute("class",e.getAttribute("class")),e.hasAttribute("style")&&r.setAttribute("style",e.getAttribute("style"));const u=e.getAttribute("width"),m=e.getAttribute("height");return u&&r.setAttribute("width",u),m&&r.setAttribute("height",m),e.parentNode?.replaceChild(r,e),!!a}async function Oo(e){if(!e)return;const t=Array.from(e.querySelectorAll?.("img")||[]),n=Array.from(e.querySelectorAll?.("svg")||[]),o=[];t.forEach(a=>{Po(a.getAttribute?.("src"))&&o.push(us(a))}),n.forEach(a=>{o.push(ds(a))}),o.length&&await Promise.allSettled(o)}function ps(e,{pixelRatio:t=1}={}){if(!e)return null;const n=e.ownerDocument||document,a=(n.defaultView||window).getComputedStyle?.(e);if(!a)return null;const l=(C,O=0)=>{const B=parseFloat(C);return Number.isFinite(B)?B:O},r=l(a.paddingTop),u=l(a.paddingBottom),m=l(a.paddingRight),y=l(a.paddingLeft),q=l(a.borderRadius),v=l(a.fontSize,14),T=(()=>{const C=a.lineHeight;if(!C||C==="normal")return v*1.6;const O=l(C,v*1.6);return O>0?O:v*1.6})(),b=Math.max(e.clientWidth||0,e.scrollWidth||0,l(a.width,0));if(b<=0)return null;const h=Math.max(1,b-y-m),E=e.textContent||"",X=E.split(/\r?\n/),S=n.createElement("canvas"),x=S.getContext("2d");if(!x)return null;const V=a.fontStyle||"normal",G=a.fontVariant||"normal",se=a.fontWeight||"400",M=a.fontFamily||"sans-serif",Q=a.fontStretch||"normal",g=C=>C.join(" "),A=[],R=C=>x.measureText(C).width;x.font=`${V} ${G} ${se} ${Q} ${v}px ${M}`,X.forEach(C=>{const O=C.trim();if(O.length===0){A.push("");return}const B=O.split(/\s+/);let oe=[];B.forEach((le,xe)=>{const fe=le.trim();if(!fe)return;const ge=g(oe.concat(fe));if(R(ge)<=h||oe.length===0){oe.push(fe);return}A.push(g(oe)),oe=[fe]}),oe.length&&A.push(g(oe))}),A.length||A.push("");const $=r+u+A.length*T,re=Math.ceil(Math.max(1,b)*t),U=Math.ceil(Math.max(1,$)*t);S.width=re,S.height=U,S.style.width=`${Math.max(1,b)}px`,S.style.height=`${Math.max(1,$)}px`,x.scale(t,t);const ee=a.backgroundColor&&a.backgroundColor!=="rgba(0, 0, 0, 0)"?a.backgroundColor:"#ffffff";if(q>0){x.save(),x.beginPath();const C=Math.max(1,b),O=Math.max(1,$),B=Math.min(q,C/2,O/2);x.moveTo(B,0),x.lineTo(C-B,0),x.quadraticCurveTo(C,0,C,B),x.lineTo(C,O-B),x.quadraticCurveTo(C,O,C-B,O),x.lineTo(B,O),x.quadraticCurveTo(0,O,0,O-B),x.lineTo(0,B),x.quadraticCurveTo(0,0,B,0),x.closePath(),x.clip()}if(x.fillStyle=ee,x.fillRect(0,0,Math.max(1,b),Math.max(1,$)),x.font=`${V} ${G} ${se} ${Q} ${v}px ${M}`,x.fillStyle=a.color||"#000000",x.textBaseline="top",x.textAlign="right","direction"in x)try{x.direction="rtl"}catch{}const F=Math.max(0,b-m);let L=r;A.forEach(C=>{const O=C.length?C:" ";x.fillText(O,F,L,h),L+=T});const I=n.createElement("img");let j;try{j=S.toDataURL("image/png")}catch(C){return Je("note canvas toDataURL failed",C),null}return I.src=j,I.alt=E,I.style.width=`${Math.max(1,b)}px`,I.style.height=`${Math.max(1,$)}px`,I.style.display="block",I.setAttribute("data-quote-note-image","true"),{image:I,canvas:S,totalHeight:$,width:b}}function ms(e,{pixelRatio:t=1}={}){if(!e||!rn())return;Array.from(e.querySelectorAll?.(".quote-notes")||[]).forEach(o=>{if(!o||o.dataset.quoteNoteRasterized==="true"||!Do(o.textContent||""))return;let a;try{a=ps(o,{pixelRatio:t})}catch(l){Je("failed to rasterize note content",l),a=null}a&&(o.dataset.quoteNoteRasterized="true",o.innerHTML="",o.appendChild(a.image))})}function bn(e,t="export",{toastMessage:n,suppressToast:o=!1}={}){ns(`${t} failed`,e);const a=!!(e&&e.__artRatioPdfNotified);if(!o&&!a){const l=i("reservations.quote.errors.exportFailed","âš ï¸ ØªØ¹Ø°Ø± Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù PDFØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰."),r=n||l,u=i("reservations.quote.toast.viewGuide","ðŸ“˜ Ø¹Ø±Ø¶ Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø­Ù„ Ø§Ù„Ø³Ø±ÙŠØ¹"),m=i("reservations.quote.toast.retry","Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©"),y=["exportQuoteAsPdf","renderQuotePreview","layoutQuoteDocument","pageCapture"].includes(t),q=()=>{t==="exportQuoteAsPdf"?(pt("export"),Vo()):(pt("render"),Nt=!1,Ae())};if(so({message:r,duration:9e3,actionLabel:y?m:void 0,onAction:y?q:void 0,linkLabel:u,linkHref:mo}),w?.modal?.classList.contains("show")&&pt("error",{message:r,actionLabel:y?m:void 0,onAction:y?q:void 0,showSpinner:!1}),e&&typeof e=="object")try{Object.defineProperty(e,"__artRatioPdfNotified",{value:!0,writable:!1,enumerable:!1,configurable:!0})}catch{}}}function gn({container:e,safariWindowRef:t,mobileWindowRef:n}={}){try{n&&!n.closed&&n.close()}catch(o){Je("failed to close mobile window",o)}try{t&&!t.closed&&t.close()}catch(o){Je("failed to close safari window",o)}e&&e.parentNode&&e.parentNode.removeChild(e)}function Fn(e){return new Promise((t,n)=>{const o=document.querySelector(`script[src="${e}"]`);if(o){o.addEventListener("load",()=>t()),o.addEventListener("error",l=>n(l)),o.readyState==="complete"&&t();return}const a=document.createElement("script");a.src=e,a.async=!0,a.onload=()=>t(),a.onerror=l=>n(l),document.head.appendChild(a)})}function eo(){const e=[window.jspdf?.jsPDF,typeof window.jspdf=="function"?window.jspdf:null,window.jsPDF?.jsPDF,typeof window.jsPDF=="function"?window.jsPDF:null].filter(t=>typeof t=="function");return e.length?e[0]:null}function to(){return typeof window.html2canvas=="function"?window.html2canvas:null}async function fs(){const e=to();return e||(xt||(xt=Fn($a).catch(t=>{throw xt=null,t}).then(()=>{const t=to();if(!t)throw xt=null,new Error("ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© html2canvas Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.");return t})),xt)}async function hs(){const e=eo();return e||(_t||(_t=Fn(Ea).catch(t=>{throw _t=null,t}).then(()=>{const t=eo();if(!t)throw _t=null,new Error("ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© jsPDF Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.");return t})),_t)}async function ys(){if(window.html2pdf||await Fn(Ca),window.html2pdf&&!window.html2pdf.__artRatioConfigured){const e=window.html2pdf.defaultOptions||window.html2pdf.defaultOpt||{},t={...e.html2canvas||{}};t.useCORS=!0,t.allowTaint=!1,t.logging=!0;const n={unit:"mm",format:"a4",orientation:"portrait",compress:!0,...e.jsPDF||{}},o={image:{type:"jpeg",quality:.95,...e.image||{}},margin:e.margin??[0,0,0,0],filename:e.filename||"document.pdf",html2canvas:t,jsPDF:n};window.html2pdf.defaultOptions=o,window.html2pdf.defaultOpt=o,window.html2pdf.__artRatioConfigured=!0}ya(),ss()}function c(e=""){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function Mo(e="reservation"){return Vn[e]||Vn.reservation}function bs(){try{window.localStorage?.removeItem?.(wa)}catch{}}function gs(e="reservation"){try{bs();const t=Mo(e),n=window.localStorage?.getItem?.(t);if(!n)return null;const o=JSON.parse(n);return o&&typeof o=="object"?o:null}catch(t){return console.warn("âš ï¸ [reservations/pdf] failed to read toggle preferences",t),null}}function vs(e,t="reservation"){try{const n=Mo(t);if(!e){window.localStorage?.removeItem?.(n);return}window.localStorage?.setItem?.(n,JSON.stringify(e))}catch(n){console.warn("âš ï¸ [reservations/pdf] failed to persist toggle preferences",n)}}function ws(e){if(!e)return{ids:null,emptyExplicitly:!1};if(e instanceof Set)return{ids:Array.from(e),emptyExplicitly:e.size===0};if(Array.isArray(e))return{ids:e.slice(),emptyExplicitly:e.length===0};if(typeof e=="object"){const t=Object.entries(e).filter(([,n])=>!!n);return{ids:t.map(([n])=>n),emptyExplicitly:t.length===0}}return{ids:null,emptyExplicitly:!1}}function qs(e,t="reservation"){if(!e)return null;const n=yo(t),o=bo(t),a=Array.from(e.sections instanceof Set?e.sections:new Set(e.sections||[])).filter(u=>n.has(u)),l={},r=e.fields||{};return Object.entries(o).forEach(([u,m])=>{const y=r[u];if(y==null)return;const{ids:q,emptyExplicitly:v}=ws(y);if(!q&&!v)return;const T=Array.isArray(q)?q.filter(b=>m.has(b)):[];(T.length>0||v)&&(l[u]=T)}),{version:1,sections:a,fields:l}}function Ro(e){if(!e)return;const t=e.context||"reservation",n=qs(e,t);n&&vs(n,t)}function On(e){if(!e)return;const t=e.context||"reservation",n=gs(t);if(!n)return;const o=yo(t),a=Array.isArray(n.sections)?n.sections.filter(l=>o.has(l)):[];if(a.length&&(e.sections=new Set(a)),n.fields&&typeof n.fields=="object"){const l=Ln(e.fields||Pt(t)),r=bo(t);Object.entries(n.fields).forEach(([u,m])=>{const y=r[u];if(!y)return;const q=Array.isArray(m)?m.filter(v=>y.has(v)):[];l[u]=new Set(q)}),e.fields=l}}function Mn(e=new Date){try{return e.toLocaleDateString("en-GB",{year:"numeric",month:"2-digit",day:"2-digit"})}catch{return e.toISOString().slice(0,10)}}function cn(e){const t=ma()||[],{technicians:n=[]}=Jt(),o=[].concat(Array.isArray(t)?t:[]).concat(Array.isArray(n)?n:[]),a=new Map;return o.forEach(r=>{if(!r||r.id==null)return;const u=String(r.id),m=a.get(u)||{};a.set(u,{...m,...r})}),(Array.isArray(e.crewAssignments)&&e.crewAssignments.length?e.crewAssignments:Array.isArray(e.techniciansDetails)&&e.techniciansDetails.length?e.techniciansDetails:(e.technicians||[]).map(r=>({technicianId:r}))).map((r,u)=>{const m=r?.technicianId!=null?a.get(String(r.technicianId)):null;let y=r.positionLabel??r.position_name??r.position_label??r.role??r.position??m?.role??i("reservations.crew.positionFallback","Ù…Ù†ØµØ¨ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…");(!y||y.trim()==="")&&(y=r.positionLabelAr??r.position_label_ar??r.positionLabelEn??r.position_label_en??r.position_name_ar??r.position_name_en??m?.role??i("reservations.crew.positionFallback","Ù…Ù†ØµØ¨ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…"));try{const T=typeof wt=="function"?wt()||[]:[];let b=null;if(r?.positionId!=null&&(b=T.find(h=>String(h?.id)===String(r.positionId))||null),!b){const h=r.positionKey??r.position_key??r.positionName??r.position_name??r.position??"";if(h&&(b=typeof zn=="function"&&zn(h)||null,!b&&T.length)){const E=String(h).trim().toLowerCase();b=T.find(X=>[X.name,X.labelAr,X.labelEn].filter(Boolean).map(S=>String(S).toLowerCase()).includes(E))||null}}if(b){const h=b.labelAr||b.labelEn||b.name||"";h&&h.trim()&&(y=h)}}catch{}const q=Lt(Bt(r.positionCost??r.position_cost??r.cost??r.daily_wage??r.dailyWage??m?.dailyWage??m?.wage??0)),v=Lt(Bt(r.positionClientPrice??r.position_client_price??r.client_price??r.clientPrice??r.daily_total??r.dailyTotal??r.total??m?.dailyTotal??m?.total??m?.total_wage??0));return{assignmentId:r.assignmentId??r.assignment_id??`crew-${u}`,positionId:r.positionId??r.position_id??null,positionLabel:y,positionLabelAlt:r.positionLabelAlt??r.position_label_alt??"",positionCost:q,positionClientPrice:v,technicianId:r.technicianId!=null?String(r.technicianId):m?.id!=null?String(m.id):null,technicianName:r.technicianName??r.technician_name??m?.name??null,technicianRole:r.technicianRole??m?.role??null}})}function Rn(e,t,n){const{projectLinked:o}=ia(e,n);vn(e.start,e.end);const a=e.discount??e.discountValue??0,l=Number(N(String(a)))||0,r=e.discountType??e.discount_type??"percent",u=String(r).toLowerCase()==="amount"?"amount":"percent",m=o?!1:!!(e.applyTax??e.apply_tax??e.taxApplied),y=e.companySharePercent??e.company_share_percent??e.companyShare??e.company_share??null,q=y!=null?Bt(y):Number.NaN,T=(e.companyShareEnabled??e.company_share_enabled??e.companyShareApplied??e.company_share_applied)===!0&&Number.isFinite(q)&&q>0?q:null,b=Array.isArray(t)?t.map(G=>G?.technicianId).filter(Boolean):[],h=ro({items:Array.isArray(e.items)?e.items:[],technicianIds:b,crewAssignments:Array.isArray(t)?t:[],discount:l,discountType:u,applyTax:m,start:e.start,end:e.end,companySharePercent:T,groupingSource:e}),E=Bt(e.cost??e.total??e.finalTotal),X=Number.isFinite(E),S=o?h.finalTotal:X?Lt(E):h.finalTotal,x={equipmentTotal:h.equipmentTotal,equipmentCostTotal:h.equipmentCostTotal,crewTotal:h.crewTotal,crewCostTotal:h.crewCostTotal,discountAmount:h.discountAmount,subtotalAfterDiscount:h.subtotalAfterDiscount,taxableAmount:h.taxableAmount,taxAmount:h.taxAmount,finalTotal:S,companySharePercent:h.companySharePercent,companyShareAmount:h.companyShareAmount,netProfit:h.netProfit},V={equipmentTotal:ce(h.equipmentTotal),equipmentCostTotal:ce(h.equipmentCostTotal),crewTotal:ce(h.crewTotal),discountAmount:ce(h.discountAmount),subtotalAfterDiscount:ce(h.subtotalAfterDiscount),taxableAmount:ce(h.taxableAmount),taxAmount:ce(h.taxAmount),finalTotal:ce(S),companySharePercent:N((Number.isFinite(h.companySharePercent)?h.companySharePercent:0).toFixed(2)),companyShareAmount:ce(h.companyShareAmount),netProfit:N(h.netProfit.toFixed(2))};return{totals:x,totalsDisplay:V,rentalDays:h.rentalDays}}function St(e){if(e==null||e==="")return null;const t=Number.parseFloat(N(String(e)));return Number.isFinite(t)?t:null}function Bo(e){if(!e)return new Date().toISOString();const t=new Date(e);return Number.isNaN(t.getTime())?new Date().toISOString():t.toISOString()}function Ss(e){if(!e||typeof e!="object")return null;const t=e.type??e.payment_type??e.paymentType??null;let n=typeof t=="string"?t.trim().toLowerCase():null;n!=="percent"&&(n="amount");const o=St(e.amount??(n==="amount"?e.value:null)),a=St(e.percentage??(n==="percent"?e.value:null)),l=n==="percent"?a??null:o??null,r=e.note??e.memo??null,u=Bo(e.recordedAt??e.recorded_at??e.date??e.created_at??null);return n==="amount"&&o==null||n==="percent"&&a==null?null:{type:n,amount:o??null,percentage:a??null,value:l,note:r,recordedAt:u}}function ks(e={}){const n=(Array.isArray(e.paymentHistory)?e.paymentHistory:Array.isArray(e.payment_history)?e.payment_history:[]).map(Ss).filter(Boolean);if(n.length>0)return n;const o=St(e.paidPercent??e.paid_percent),a=St(e.paidAmount??e.paid_amount),l=e.updatedAt??e.updated_at??e.createdAt??e.created_at??null,r=Bo(l);return o!=null&&o>0?[{type:"percent",amount:a!=null&&a>0?a:null,percentage:o,value:o,note:null,recordedAt:r}]:a!=null&&a>0?[{type:"amount",amount:a,percentage:null,value:a,note:null,recordedAt:r}]:[]}function As(e){if(!e)return i("projects.form.types.unknown","Ù†ÙˆØ¹ ØºÙŠØ± Ù…Ø­Ø¯Ø¯");const t={commercial:"projects.form.types.commercial",coverage:"projects.form.types.coverage",photography:"projects.form.types.photography",social:"projects.form.types.social"}[e]||"projects.form.types.unknown";return i(t,e)}function _s(e){const t=new Date,n=e?.start?new Date(e.start):null,o=e?.end?new Date(e.end):null;return n&&!Number.isNaN(n.getTime())&&n>t?"upcoming":o&&!Number.isNaN(o.getTime())&&o<t?"completed":"ongoing"}function xs(e){if(Array.isArray(e?.expenses)&&e.expenses.some(o=>Number.isFinite(Number(o?.salePrice??o?.sale_price))))return e.expenses.reduce((o,a)=>o+(Number(a?.salePrice??a?.sale_price)||0),0);const t=Number(e?.servicesClientPrice??e?.services_client_price);return Number.isFinite(t)&&t>=0?t:typeof e?.expensesTotal=="number"?e.expensesTotal:Array.isArray(e?.expenses)?e.expenses.reduce((n,o)=>n+(Number(o?.amount)||0),0):0}function Cs(e){if(!e)return 0;const t=Array.isArray(e.items)?e.items:[],n=e.discount??0,o=Number(N(String(n)))||0,a=e.discountType||"percent",l=Array.isArray(e.crewAssignments)?e.crewAssignments:[],r=l.length?l:Array.isArray(e.technicians)?e.technicians:[],u=pa(t,o,a,!1,r,{start:e.start,end:e.end,companySharePercent:0});if(Number.isFinite(u))return u;const m=Number(N(String(e.cost??0)));return Number.isFinite(m)?Math.round(m):0}function $s(e,t){if(!e)return"â€”";const n=vt(e);return t?`${n} - ${vt(t)}`:n}function ae(e,t="SR",n=2){const o=Number(e);return`${ce(o)} ${t}`}function no(e,t=2){if(!Number.isFinite(Number(e)))return"0%";const n=Number.isInteger(t)?t:2;return`${N(Number(e).toFixed(n))}%`}function Ko(){if(!s)return!1;if((s.context||"reservation")==="project"){const o=s.project||{};if([o.companyShareEnabled,o.company_share_enabled,o.companyShareApplied,o.company_share_applied].some(l=>l===!0||l==="true"))return!0;const a=s.projectTotals||{};return!!(Number.isFinite(Number(a.companyShareAmount))&&Number(a.companyShareAmount)>0)}const t=s.reservation||{};if([t.companyShareEnabled,t.company_share_enabled,t.companyShareApplied,t.company_share_applied].some(o=>o===!0||o==="true"))return!0;const n=s.totals||{};return Number.isFinite(Number(n.companyShareAmount))&&Number(n.companyShareAmount)>0}function Es(){if(!s)return!1;if((s.context||"reservation")==="project"){const o=s.project||{};if([o.applyTax,o.apply_tax].some(l=>l===!0||l==="true"))return!0;const a=s.projectTotals||{};return[a.applyTax].some(l=>l===!0||l==="true")?!0:Number.isFinite(Number(a.taxAmount))&&Number(a.taxAmount)>0}const t=s.reservation||{};if([t.applyTax,t.apply_tax,t.taxApplied,t.tax_applied].some(o=>o===!0||o==="true"))return!0;const n=s.totals||{};return Number.isFinite(Number(n.taxAmount))&&Number(n.taxAmount)>0}function Ns(){return Ko()&&Es()}function js(){if(!s)return null;const t=(s.context||"reservation")==="project"?[s.project?.companySharePercent,s.project?.company_share_percent,s.project?.companyShare,s.project?.company_share,s.projectTotals?.companySharePercent,s.projectTotals?.projectSharePercent]:[s.reservation?.companySharePercent,s.reservation?.company_share_percent,s.reservation?.companyShare,s.reservation?.company_share,s.totals?.companySharePercent];for(let n=0;n<t.length;n+=1){const o=t[n],a=Number(o);if(Number.isFinite(a)&&a>0)return a}return null}function Ts(){if(!Ko())return 0;const e=js();return Number.isFinite(e)&&e>0?e:ca}function Ls(){if(!Ns())return 1;const e=Ts();return e>0?1+e/100:1}function Le(e){const t=Number(e);if(!Number.isFinite(t)||t<=0)return t;const n=Ls();return n===1?t:Number((t*n).toFixed(2))}function Is(e){if(!e?.start)return null;if(!e?.end)return 1;const t=vn(e.start,e.end);return Number.isFinite(t)?t:1}function Ds(e){return Number.isFinite(e)?e<=1?"ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯":`${N(String(Math.round(e)))} Ø£ÙŠØ§Ù…`:"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}function oo(e){const t=i("reservations.create.summary.currency","SR"),n=Jt()||{},o=Array.isArray(n.customers)?n.customers:[],a=Array.isArray(n.projects)?n.projects:[],l=Array.isArray(n.technicians)?n.technicians:[];let r=[];try{const d=co?.()||[];r=Array.isArray(d)&&d.length?d:n.reservations||[]}catch{r=n.reservations||[]}const u=e?.id!=null?a.find(d=>String(d.id)===String(e.id))||e:e||null,m={projectStatusLabel:i("projects.status.ongoing","Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°"),paymentStatusLabel:i("projects.paymentStatus.unpaid","ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹")};if(!u)return{project:null,customer:null,clientInfo:{name:"-",company:"-",phone:"-",email:"-"},projectInfo:{title:"-",code:"-",typeLabel:"-",startDisplay:"-",endDisplay:"-",durationLabel:"-",statusLabel:m.projectStatusLabel},expenses:[],equipment:[],reservations:[],totals:{equipmentEstimate:0,expensesTotal:0,baseSubtotal:0,discountAmount:0,subtotalAfterDiscount:0,companyShareAmount:0,subtotal:0,applyTax:!1,taxAmount:0,totalWithTax:0},totalsDisplay:{projectSubtotal:ae(0,t),expensesTotal:ae(0,t),reservationsTotal:ae(0,t),discountAmount:ae(0,t),taxAmount:ae(0,t),overallTotal:ae(0,t),paidAmount:ae(0,t),remainingAmount:ae(0,t)},projectTotals:{combinedTaxAmount:0,overallTotal:0,reservationsTotal:0,paidAmount:0,paidPercent:0,remainingAmount:0,paymentStatus:"unpaid"},paymentSummary:{status:"unpaid",statusLabel:m.paymentStatusLabel,paidAmount:0,paidPercent:0,remainingAmount:0,paidAmountDisplay:ae(0,t),remainingAmountDisplay:ae(0,t),paidPercentDisplay:no(0)},notes:"",currencyLabel:t,projectStatus:"ongoing",projectStatusLabel:m.projectStatusLabel,projectDurationDays:null,projectDurationLabel:"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",paymentHistory:[]};const y=u.clientId??u.customerId??u.client_id??u.customer_id??null,q=y!=null&&o.find(d=>String(d.id)===String(y))||null,v=q?.customerName??q?.name??u.clientName??u.customerName??i("projects.fallback.unknownClient","Ø¹Ù…ÙŠÙ„ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"),T=(u.clientCompany||q?.companyName||q?.company||"").trim(),b=q?.phone??q?.customerPhone??u.clientPhone??u.customerPhone??"",h=b?N(String(b).trim()):i("projects.details.client.noPhone","Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù‚Ù… Ù…ØªØ§Ø­"),E=q?.email??u.clientEmail??u.customerEmail??"",X=E?String(E).trim():i("projects.details.client.noEmail","Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨Ø±ÙŠØ¯ Ù…ØªØ§Ø­"),S=u.projectCode||`PRJ-${N(String(u.id??""))}`,x=N(String(S)),V=(u.title||"").trim()||i("projects.fallback.untitled","Ù…Ø´Ø±ÙˆØ¹ Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†"),G=As(u.type),se=u.start?vt(u.start):"â€”",M=u.end?vt(u.end):"â€”",Q=Is(u),g=Q!=null?Ds(Q):"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",A=_s(u),R={upcoming:"Ù‚Ø§Ø¯Ù…",ongoing:"Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°",completed:"Ù…ÙƒØªÙ…Ù„"},$=i(`projects.status.${A}`,R[A]||A),re=u.id!=null?String(u.id):null,U=re?r.filter(d=>{const k=d?.projectId??d?.project_id??null;return k!=null&&String(k)===re}):[];U.map(d=>{const k=d.reservationId||d.id||"",_=d.status||d.state||"pending",J=String(_).toLowerCase(),ie=i(`reservations.status.${J}`,J),de=Cs(d),Se=d.start?new Date(d.start).getTime():0;return{reservationId:N(String(k||"-")),status:J,statusLabel:ie,total:de,totalLabel:ae(de,t),dateRange:$s(d.start,d.end),startTimestamp:Number.isNaN(Se)?0:Se}}).sort((d,k)=>k.startTimestamp-d.startTimestamp).map(({startTimestamp:d,...k})=>k);let ee=0,F=0;try{U.forEach(d=>{const k=ro({items:Array.isArray(d.items)?d.items:[],technicianIds:Array.isArray(d.technicians)?d.technicians:[],crewAssignments:Array.isArray(d.crewAssignments)?d.crewAssignments:[],discount:Number(d.discount??0)||0,discountType:d.discountType||"percent",applyTax:!1,start:d.start,end:d.end,groupingSource:d,companySharePercent:0});ee+=Number(k.equipmentTotal||0),F+=Number(k.crewTotal||0)})}catch{}const L=xs(u),I=Number(ee+F+L),j=[];try{U.forEach(d=>{const{groups:k}=io(d);k.forEach(_=>{const J=Number(_?.count??_?.quantity??1)||1,ie=Number(_?.unitPrice);let de=Number.isFinite(ie)?ie:0;if(!de||de<=0){const be=Number(_?.totalPrice);Number.isFinite(be)&&J>0&&(de=Number((be/J).toFixed(2)))}Number.isFinite(de)||(de=0);const Se=_?.type==="package"||Array.isArray(_?.items)&&_.items.some(be=>be?.type==="package"),pe=Array.isArray(_?.barcodes)&&_.barcodes.length?_.barcodes[0]:Array.isArray(_?.items)&&_.items.length?_.items[0]?.barcode:null;let ye=_?.packageDisplayCode??_?.package_code??_?.code??_?.packageCode??(Array.isArray(_?.items)&&_.items.length?_.items[0]?.package_code??_.items[0]?.code??_.items[0]?.packageCode:null);const We=be=>{const Te=(be==null?"":String(be)).trim();return!!(!Te||/^pkg-/i.test(Te)||/^\d+$/.test(Te)&&Te.length<=4)};if(!ye||We(ye)){const be=_?.packageId??_?.package_id??(Array.isArray(_?.items)&&_.items.length?_.items[0]?.packageId??_.items[0]?.package_id:null);if(be)try{const Te=lo(be);Te&&Te.package_code&&(ye=Te.package_code)}catch{}}if(!ye||We(ye))try{const be=gt(_?.description||"");if(be){const Te=uo();let Fe=Te.find(Ye=>gt(Ye?.name||Ye?.title||Ye?.label||"")===be);Fe||(Fe=Te.find(Ye=>{const lt=gt(Ye?.name||Ye?.title||Ye?.label||"");return lt.includes(be)||be.includes(lt)})),Fe&&Fe.package_code&&(ye=Fe.package_code)}}catch{}const je=Se?ye??pe??"":_?.barcode??pe??"",ot=je!=null?String(je):"",ft=Number.isFinite(Number(_?.totalPrice))?Number(_.totalPrice):Number((de*J).toFixed(2));j.push({..._,isPackage:Se,desc:_?.description,barcode:ot,packageCodeResolved:ye||"",qty:J,price:de,totalPrice:Lt(ft),unitPriceValue:de})})})}catch{}const C=new Map;U.forEach(d=>{const k=Array.isArray(d.items)?d.items:[],_=vn(d.start,d.end),J=d.reservationId||d.id||"";k.forEach((ie,de)=>{if(!ie)return;const Se=ie.barcode||ie.code||ie.id||ie.desc||ie.description||`item-${de}`,pe=String(Se||`item-${de}`),ye=C.get(pe)||{description:ie.desc||ie.description||ie.name||ie.barcode||`#${N(String(de+1))}`,totalQuantity:0,reservationsCount:0,reservationIds:new Set,totalCost:0},We=Number(ie.qty)||1,je=Number(ie.price)||0;ye.totalQuantity+=We,ye.reservationIds.add(String(J));const ot=je*We*Math.max(1,_);Number.isFinite(ot)&&(ye.totalCost+=ot),C.set(pe,ye)})});const O=Array.from(C.values()).map(d=>({description:d.description,totalQuantity:d.totalQuantity,reservationsCount:d.reservationIds.size,displayCost:ae(d.totalCost,t)})),B=new Map((l||[]).filter(Boolean).map(d=>[String(d.id),d])),oe=new Map,le=d=>{if(!d)return;let k=null;typeof d=="object"?k=d.id??d.technicianId??d.technician_id??d.userId??d.user_id??null:(typeof d=="string"||typeof d=="number")&&(k=d);const _=k!=null?String(k):null,J=_&&B.has(_)?B.get(_):typeof d=="object"?d:null,ie=J?.name||J?.full_name||J?.fullName||J?.displayName||(typeof d=="string"?d:null),de=J?.role||J?.title||null,Se=J?.phone||J?.mobile||J?.contact||null;if(!ie&&!_)return;const pe=_||ie;oe.has(pe)||oe.set(pe,{id:_,name:ie||"-",role:de||null,phone:Se||null})};Array.isArray(u?.technicians)&&u.technicians.forEach(d=>le(d)),U.forEach(d=>{(Array.isArray(d.crewAssignments)&&d.crewAssignments.length?d.crewAssignments:Array.isArray(d.technicians)?d.technicians.map(_=>({technicianId:_})):[]).forEach(_=>le(_))});const xe=Array.from(oe.values()),fe=Array.isArray(u.expenses)?u.expenses.map(d=>{const k=Number(d?.salePrice??d?.sale_price??d?.amount)||0;return{label:d?.label||d?.name||"-",amount:k,displayAmount:ae(k,t),note:d?.note||d?.description||""}}):[],ge=u?.applyTax===!0||u?.applyTax==="true",Ve=Number.parseFloat(u?.discount??u?.discountValue??0)||0;let Ce=(u?.discountType==="amount"?"amount":"percent")==="amount"?Ve:I*(Ve/100);(!Number.isFinite(Ce)||Ce<0)&&(Ce=0),Ce>I&&(Ce=I);const Oe=Math.max(0,I-Ce),Me=u?.companyShareEnabled===!0||u?.company_share_enabled===!0||u?.companyShareApplied===!0||u?.company_share_applied===!0,De=Number.parseFloat(u?.companySharePercent??u?.company_share_percent??u?.companyShare??u?.company_share??0)||0,Ze=Me&&De>0?De:0,Ge=Ze>0?Number((Oe*(Ze/100)).toFixed(2)):0,Pe=Number((Oe+Ge).toFixed(2)),Ne=ge?Number((Pe*fa).toFixed(2)):0,Re=Number((Pe+Ne).toFixed(2)),et=ks(u),kt=St(u.paidAmount??u.paid_amount)||0,Be=St(u.paidPercent??u.paid_percent)||0,$e=ua({totalAmount:Re,paidAmount:kt,paidPercent:Be,history:et}),tt=typeof u.paymentStatus=="string"?u.paymentStatus.toLowerCase():"",Ke=da({manualStatus:tt,paidAmount:$e.paidAmount,paidPercent:$e.paidPercent,totalAmount:Re}),mt={paid:"Ù…Ø¯ÙÙˆØ¹",partial:"Ù…Ø¯ÙÙˆØ¹ Ø¬Ø²Ø¦ÙŠØ§Ù‹",unpaid:"ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹"},At=i(`projects.paymentStatus.${Ke}`,mt[Ke]||Ke),He=Number($e.paidAmount||0),nt=Number($e.paidPercent||0),f=Math.max(0,Number((Re-He).toFixed(2))),K={projectSubtotal:ae(Pe,t),expensesTotal:ae(L,t),reservationsTotal:ae(Pe,t),discountAmount:ae(Ce,t),taxAmount:ae(Ne,t),overallTotal:ae(Re,t),paidAmount:ae(He,t),remainingAmount:ae(f,t)},D={status:Ke,statusLabel:At,paidAmount:He,paidPercent:nt,remainingAmount:f,paidAmountDisplay:ae(He,t),remainingAmountDisplay:ae(f,t),paidPercentDisplay:no(nt)},W=(u.description||"").trim();return{project:u,customer:q,clientInfo:{name:v,company:T||"â€”",phone:h,email:X},projectInfo:{title:V,code:x,typeLabel:G,startDisplay:se,endDisplay:M,durationLabel:g,statusLabel:$},expenses:fe,equipment:O,crew:xe,equipmentItems:j,crewAssignments:U.flatMap(d=>cn(d)),totals:{equipmentEstimate:ee,expensesTotal:L,baseSubtotal:I,discountAmount:Ce,subtotalAfterDiscount:Oe,companyShareAmount:Ge,subtotal:Pe,applyTax:ge,taxAmount:Ne,totalWithTax:Re},totalsDisplay:K,projectTotals:{combinedTaxAmount:Ne,overallTotal:Re,reservationsTotal:Pe,paidAmount:He,paidPercent:nt,remainingAmount:f,paymentStatus:Ke},paymentSummary:D,notes:W,currencyLabel:t,projectStatus:A,projectStatusLabel:$,projectDurationDays:Q,projectDurationLabel:g,paymentHistory:et}}function Ps({project:e,clientInfo:t={},projectInfo:n={},projectCrew:o=[],projectExpenses:a=[],projectEquipment:l=[],totalsDisplay:r={},projectTotals:u={},paymentSummary:m={},currencyLabel:y="SR",sections:q,fieldSelections:v={},quoteNumber:T,quoteDate:b,terms:h=Ie,rootAttributes:E=""}){const X=Ln(v),S=(f,K)=>In(X,f,K),x=f=>q?.has?.(f),V=`<div class="quote-placeholder">${c(i("reservations.quote.placeholder.noFields","Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù„Ù„Ø¹Ø±Ø¶ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…."))}</div>`,G=(f,K)=>`<div class="info-plain__item">
      <span class="info-plain__label">${c(f)}</span>
      <span class="info-plain__separator">:</span>
      <span class="info-plain__value">${c(K)}</span>
    </div>`,se=(f,K,{variant:D="inline"}={})=>D==="final"?`<div class="totals-item totals-item--final">
        <span class="totals-item__label">${c(f)}</span>
        <span class="totals-item__slash">/</span>
        <span class="totals-item__value">${c(K)}</span>
      </div>`:`<span class="totals-inline__item">
      <span class="totals-inline__label">${c(f)}</span>
      <span class="totals-inline__slash">/</span>
      <span class="totals-inline__value">${c(K)}</span>
    </span>`,M=(f,K)=>`<div class="payment-row">
      <span class="payment-row__label">${c(f)}</span>
      <span class="payment-row__slash">/</span>
      <span class="payment-row__value">${c(K)}</span>
    </div>`,Q=(f,K,D)=>{const W=`${f}-title`,Y=`${f}-content`;return`
      <div class="quote-section__head" data-drag-key="${c(W)}">
        ${K}
      </div>
      <div class="quote-section__body" data-drag-key="${c(Y)}">
        ${D}
      </div>
    `},g=[];S("customerInfo","customerName")&&g.push(G(i("projects.details.client","Ø§Ù„Ø¹Ù…ÙŠÙ„"),t.name||"-")),S("customerInfo","customerCompany")&&g.push(G(i("projects.details.company","Ø´Ø±ÙƒØ© Ø§Ù„Ø¹Ù…ÙŠÙ„"),t.company||"â€”")),S("customerInfo","customerPhone")&&g.push(G(i("projects.details.labels.clientPhone","Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„"),t.phone||"-")),S("customerInfo","customerEmail")&&g.push(G(i("projects.details.labels.clientEmail","Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"),t.email||"-"));const A=jt(s,"projectCustomer"),R=x("customerInfo")?`<section class="quote-section quote-section--plain quote-section--customer">
        ${Q("customer",`<h3 class="quote-section__title">${c(i("projects.quote.sections.customer","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„"))}</h3>`,g.length?`<div class="${A}">${g.join("")}</div>`:V)}
      </section>`:"",$=[];S("projectInfo","projectType")&&$.push(G(i("projects.details.type","Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.typeLabel||"-")),S("projectInfo","projectTitle")&&$.push(G(i("projects.details.projectTitle","Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.title||"-")),S("projectInfo","projectCode")&&$.push(G(i("projects.details.labels.code","Ø±Ù‚Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.code||"-")),S("projectInfo","projectStart")&&$.push(G(i("projects.details.start","Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.startDisplay||"-")),S("projectInfo","projectEnd")&&$.push(G(i("projects.details.end","Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.endDisplay||"-")),S("projectInfo","projectDuration")&&$.push(G(i("projects.details.duration","Ù…Ø¯Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.durationLabel||"-")),S("projectInfo","projectStatus")&&$.push(G(i("projects.details.status","Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),n.statusLabel||"-"));const re=jt(s,"projectDetails"),U=x("projectInfo")?`<section class="quote-section quote-section--plain quote-section--project">
        ${Q("project",`<h3 class="quote-section__title">${c(i("projects.quote.sections.project","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"))}</h3>`,$.length?`<div class="${re}">${$.join("")}</div>`:V)}
      </section>`:"",ee=en.filter(f=>S("projectCrew",f.id)),F=Array.isArray(s?.crewAssignments)?s.crewAssignments:[],L=f=>{const K=f&&f.positionId!=null?`id:${String(f.positionId)}`:(()=>{const Y=(f?.positionLabel||f?.position_name||f?.position||"").trim().toLowerCase();return Y?`label:${Y}`:""})(),D=Number.isFinite(Number(f?.positionClientPrice))?Number(f.positionClientPrice):0,W=D>0?`|p:${D.toFixed(2)}`:"";return`${K}${W}`};(()=>{const f=new Map;return F.forEach(K=>{const D=L(K);D&&f.set(D,(f.get(D)||0)+1)}),f})();const I=(()=>{const f=[];if(ee.forEach(d=>{d.id==="position"?(f.push({...d,render:k=>{const _=typeof ue=="function"?ue():"ar";let J=k?.positionLabelEn??k?.position_label_en??k?.position_name_en??k?.positionLabelAlt??k?.position_label_alt??k?.role;if(!J&&_==="en")try{const Se=typeof wt=="function"?wt():[];let pe=null;if(k?.positionId!=null&&(pe=Se.find(ye=>String(ye.id)===String(k.positionId))||null),!pe){const ye=k?.positionKey??k?.position_key??k?.positionName??k?.position_name??k?.position??"";if(ye){const We=String(ye).toLowerCase();pe=Se.find(je=>String(je.name).toLowerCase()===We)||null}}pe&&(J=pe.labelEn??pe.label_en??pe.name_en??J)}catch{}const ie=k?.positionLabel??k?.position_name??k?.role??i("reservations.crew.positionFallback","Ù…Ù†ØµØ¨ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…");return c(N(String(_==="en"&&J?J:ie)))}}),S("projectCrew","quantity")&&f.push({id:"quantity",labelKey:"reservations.details.table.headers.quantity",fallback:"Ø§Ù„ÙƒÙ…ÙŠØ©",render:k=>c(N(String(Math.max(1,Number(k?.__count||1)))))})):d.id==="price"?f.push({...d,render:k=>{const _=Number.isFinite(Number(k?.positionClientPrice))?Number(k.positionClientPrice):0,J=Math.max(1,Number(k?.__count||1)),ie=Math.max(1,Number(s?.rentalDays||1)),Se=Le(_)*J*ie;return c(`${ce(Se)} ${i("reservations.create.summary.currency","SR")}`)}}):d.id==="unitPrice"?f.push({...d,render:k=>{const _=Number.isFinite(Number(k?.positionClientPrice))?Number(k.positionClientPrice):0,J=Le(_);return c(`${ce(J)} ${i("reservations.create.summary.currency","SR")}`)}}):f.push(d)}),S("projectCrew","days")){const d=Math.max(1,Number(s?.rentalDays||1)),k=f.findIndex(J=>J.id==="price"),_=Math.max(0,k);f.splice(_,0,{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…",render:()=>c(N(String(d)))})}const K=new Map(f.map(d=>[d.id,d])),D=new Set,W=[],Y=d=>{const k=K.get(d);k&&!D.has(d)&&(W.push(k),D.add(d))};return Y("rowNumber"),Y("position"),Y("unitPrice"),Y("quantity"),Y("days"),Y("price"),f.forEach(d=>{D.has(d.id)||(W.push(d),D.add(d.id))}),W})(),j=(()=>{const f=new Map;return F.forEach(K=>{const D=L(K);if(!D)return;const W=f.get(D);W?W.__count+=1:f.set(D,{...K,__count:1})}),Array.from(f.values())})(),C=(()=>{try{const f=Math.max(1,Number(s?.rentalDays||1)),K=(j||[]).reduce((D,W)=>{const Y=Number.isFinite(Number(W?.positionClientPrice))?Number(W.positionClientPrice):0,d=Math.max(1,Number(W?.__count||1)),k=Le(Y);return D+k*d*f},0);return ce(K)}catch{return"0.00"}})(),O=x("projectCrew")?I.length?`<section class="quote-section quote-section--table">
            <h3>${c(i("projects.quote.sections.crew","Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„"))}</h3>
            <table class="quote-table">
              <thead>
                <tr>${I.map(f=>`<th>${c(f.labelKey?i(f.labelKey,f.fallback):f.fallback)}</th>`).join("")}</tr>
              </thead>
              <tbody>${j.length?j.map((f,K)=>`<tr>${I.map(D=>`<td><div class="quote-cell">${D.render(f,K)}</div></td>`).join("")}</tr>`).join(""):`<tr><td colspan="${Math.max(I.length,1)}" class="empty">${c(i("projects.details.crew.empty","Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ø§Ù‚Ù… ÙÙ†ÙŠ Ù…Ø±ØªØ¨Ø·."))}</td></tr>`}
              </tbody>
            </table>
            ${S("projectCrew","crewSubtotal")?`
              <div class="quote-table-subtotal">
                <span class="quote-table-subtotal__pill">
                  <span class="quote-table-subtotal__label">${c(i("reservations.details.labels.crewTotal","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±ÙŠÙ‚"))}</span>
                  <span class="quote-table-subtotal__value">${c(`${C} ${y}`)}</span>
                </span>
              </div>
            `:""}
          </section>`:`<section class="quote-section quote-section--table">
            <h3>${c(i("projects.quote.sections.crew","Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„"))}</h3>
            ${V}
          </section>`:"",B=[];S("financialSummary","discountAmount")&&B.push(se(i("reservations.details.labels.discount","Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ…"),r.discountAmount||ae(0,y)));const oe=i("projects.details.summary.preTaxTotal","Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©");S("financialSummary","reservationsTotal")&&B.push(se(oe,r.reservationsTotal||ae(0,y))),S("financialSummary","taxAmount")&&B.push(se(i("projects.details.summary.combinedTax","Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"),r.taxAmount||ae(0,y)));const le=[];S("financialSummary","overallTotal")&&le.push(se(i("projects.details.summary.overallTotal","Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ"),r.overallTotal||ae(0,y),{variant:"final"}));const xe=x("financialSummary")?!B.length&&!le.length?`<section class="quote-section quote-section--financial">${V}</section>`:`<section class="quote-section quote-section--financial">
          ${Q("projectFinancial",`<h3>${c(i("projects.quote.sections.financial","Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ"))}</h3>`,`<div class="totals-block">
              ${B.length?`<div class="totals-inline">${B.join("")}</div>`:""}
              ${le.length?`<div class="totals-final">${le.join("")}</div>`:""}
            </div>`)}
        </section>`:"",fe=fo.filter(f=>S("projectExpenses",f.id)),ge=(()=>{const f=[...fe];return f.forEach(K=>{K.id==="amount"&&(K.render=D=>{const W=D?.salePrice??D?.sale_price,Y=W??D?.amount,d=Number(Y),k=Le(Number.isFinite(d)?d:0);return c(ae(k,y))})}),f})(),Ve=(()=>{try{const f=a.reduce((K,D)=>{const W=D?.salePrice??D?.sale_price,Y=W??D?.amount,d=Number(Y),k=Le(Number.isFinite(d)?d:0);return K+k},0);return ce(f)}catch{return ce(0)}})(),te=x("projectExpenses")?ge.length?`<section class="quote-section quote-section--table">
            <h3>${c(i("projects.quote.sections.expenses","Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©"))}</h3>
            <table class="quote-table">
              <thead>
                <tr>${ge.map(f=>`<th>${c(f.labelKey?i(f.labelKey,f.fallback):f.fallback)}</th>`).join("")}</tr>
              </thead>
              <tbody>${a.length?a.map((f,K)=>`<tr>${ge.map(D=>`<td><div class="quote-cell">${D.render(f,K)}</div></td>`).join("")}</tr>`).join(""):`<tr><td colspan="${Math.max(ge.length,1)}" class="empty">${c(i("projects.details.expenses.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ØªØ·Ù„Ø¨Ø§Øª Ù…Ø³Ø¬Ù„Ø©."))}</td></tr>`}
              </tbody>
            </table>
            ${S("projectExpenses","expensesSubtotal")?`
              <div class="quote-table-subtotal">
                <span class="quote-table-subtotal__pill">
                  <span class="quote-table-subtotal__label">${c(i("projects.details.expensesTotal","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©"))}</span>
                  <span class="quote-table-subtotal__value">${c(`${Ve} ${y}`)}</span>
                </span>
              </div>
            `:""}
          </section>`:`<section class="quote-section quote-section--table">
            <h3>${c(i("projects.quote.sections.expenses","Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©"))}</h3>
            ${V}
          </section>`:"",Ce=Zt.filter(f=>S("projectEquipment",f.id)),Oe=(()=>{let f=[];if(Ce.forEach(Y=>{Y.id==="price"?f.push({...Y,render:d=>{const k=Number.isFinite(Number(d?.unitPriceValue))?Number(d.unitPriceValue):0,_=Number.isFinite(Number(d?.qty))?Math.max(1,Number(d.qty)):1,J=Math.max(1,Number(s?.rentalDays||1)),de=Le(k)*_*J;return c(`${ce(de)} ${i("reservations.create.summary.currency","SR")}`)}}):Y.id==="unitPrice"?f.push({...Y,render:d=>{const k=Number.isFinite(Number(d?.unitPriceValue))?Number(d.unitPriceValue):0,_=Le(k);return c(`${ce(_)} ${i("reservations.create.summary.currency","SR")}`)}}):f.push(Y)}),S("projectEquipment","days")){const Y=Math.max(1,Number(s?.rentalDays||1)),d=f.findIndex(_=>_.id==="price"),k=Math.max(0,d);f.splice(k,0,{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…",render:()=>c(N(String(Y)))})}const K=new Map(f.map(Y=>[Y.id,Y])),D=f.filter(Y=>!["unitPrice","quantity","days","price"].includes(Y.id)),W=["unitPrice","quantity","days","price"].map(Y=>K.get(Y)).filter(Boolean);return f=[...D,...W],f})(),Me=Array.isArray(s?.equipmentItems)?s.equipmentItems:[],De=(()=>{try{const f=Math.max(1,Number(s?.rentalDays||1)),K=(Me||[]).reduce((D,W)=>{const Y=Number.isFinite(Number(W?.unitPriceValue))?Number(W.unitPriceValue):0,d=Number.isFinite(Number(W?.qty))?Math.max(1,Number(W.qty)):1,k=Le(Y);return D+k*d*f},0);return ce(K)}catch{return"0.00"}})(),Ze=x("projectEquipment")?Oe.length?`<section class="quote-section quote-section--table">
            <h3>${c(i("projects.quote.sections.equipment","Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</h3>
            <table class="quote-table">
              <thead>
                <tr>${Oe.map(f=>`<th>${c(f.labelKey?i(f.labelKey,f.fallback):f.fallback)}</th>`).join("")}</tr>
              </thead>
              <tbody>${Me.length?Me.map((f,K)=>`<tr>${Oe.map(D=>`<td><div class="quote-cell">${D.render(f,K)}</div></td>`).join("")}</tr>`).join(""):`<tr><td colspan="${Math.max(Oe.length,1)}" class="empty">${c(i("projects.details.equipment.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø¯Ø§Øª Ù…Ø±ØªØ¨Ø·Ø© Ø­Ø§Ù„ÙŠØ§Ù‹."))}</td></tr>`}
              </tbody>
            </table>
            ${S("projectEquipment","equipmentSubtotal")?`
              <div class="quote-table-subtotal">
                <span class="quote-table-subtotal__pill">
                  <span class="quote-table-subtotal__label">${c(i("reservations.details.labels.equipmentTotal","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</span>
                  <span class="quote-table-subtotal__value">${c(`${De} ${y}`)}</span>
                </span>
              </div>
            `:""}
          </section>`:`<section class="quote-section quote-section--table">
            <h3>${c(i("projects.quote.sections.equipment","Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</h3>
            ${V}
          </section>`:"",Ge=(e?.description||"").trim()||"",Pe=x("projectNotes")?`<section class="quote-section">
        <h3>${c(i("projects.quote.sections.notes","Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"))}</h3>
        <div class="quote-notes">${c(Ge||i("projects.fallback.noDescription","Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ Ù„Ù„Ù…Ø´Ø±ÙˆØ¹."))}</div>
      </section>`:"",Ne=[];S("payment","beneficiary")&&Ne.push(M(i("reservations.quote.labels.beneficiary","Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙÙŠØ¯"),ke.beneficiaryName)),S("payment","bank")&&Ne.push(M(i("reservations.quote.labels.bank","Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ"),ke.bankName)),S("payment","account")&&Ne.push(M(i("reservations.quote.labels.account","Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨"),N(ke.accountNumber))),S("payment","iban")&&Ne.push(M(i("reservations.quote.labels.iban","Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ¨Ø§Ù†"),N(ke.iban)));const Re=`<section class="quote-section">
      <div class="payment-block">
        <h3>${c(i("reservations.quote.sections.payment","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹"))}</h3>
        <div class="payment-rows">${Ne.length?Ne.join(""):V}</div>
      </div>
      <p class="quote-approval-note">${c(ke.approvalNote)}</p>
    </section>`,et=Array.isArray(h)&&h.length?h:Ie,kt=`<footer class="quote-footer">
        <h4>${c(i("reservations.quote.labels.terms","Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø¹Ø§Ù…Ø©"))}</h4>
        <ul>${et.map(f=>`<li>${c(f)}</li>`).join("")}</ul>
      </footer>`,Be=[],$e=[];if(U&&$e.push({key:"project",html:U}),R&&$e.push({key:"customer",html:R}),$e.length>1){const f=$e.find(W=>W.key==="project"),K=$e.find(W=>W.key==="customer"),D=[];f?.html&&D.push(f.html),K?.html&&D.push(K.html),Be.push(me(`<div class="quote-section-row quote-section-row--primary">${D.join("")}</div>`,{blockType:"group"}))}else $e.length===1&&Be.push(me($e[0].html));const tt=[];O&&tt.push(me(O,{blockType:"table",extraAttributes:'data-table-id="project-crew"'})),te&&tt.push(me(te,{blockType:"table",extraAttributes:'data-table-id="project-expenses"'})),Ze&&tt.push(me(Ze,{blockType:"table",extraAttributes:'data-table-id="project-equipment"'}));const Ke=[];xe&&Ke.push(me(xe,{blockType:"summary"})),Pe&&Ke.push(me(Pe));let mt=[];mt=[...x("payment")?[me(Re,{blockType:"payment"})]:[],me(kt,{blockType:"footer"})];const At=[...Wt(Be,"projects.quote.placeholder.primary"),...tt,...Wt(Ke,"projects.quote.placeholder.summary"),...mt],He=typeof ue=="function"?ue():"ar",nt=`
    <header class="quote-header" data-quote-header-template>
      <div class="quote-header__logo">
        <img class="quote-logo" src="${c(ke.logoUrl)}" alt="${c(ke.companyName)}" crossorigin="anonymous"/>
      </div>
      <div class="quote-header__title">
        <h1>${c(i("projects.quote.title","Ø¹Ø±Ø¶ Ø³Ø¹Ø±"))}</h1>
        <p class="quote-company-name">${c(i("quote.companyName",ke.companyName))}</p>
        <p class="quote-company-cr">${c(i("reservations.quote.labels.cr","Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ"))}: ${c(ke.commercialRegistry)}</p>
        <p class="quote-company-license">${c(i("reservations.quote.labels.mediaLicense","ØªØ±Ø®ÙŠØµ Ø¥Ø¹Ù„Ø§Ù…ÙŠ"))}: 159460</p>
      </div>
      <div class="quote-header__meta">
        <div class="quote-header__meta-item">
          <span>${c(i("reservations.details.labels.reservationId","Ø±Ù‚Ù… Ø§Ù„Ø¹Ø±Ø¶"))}</span>
          <strong>${c(T)}</strong>
        </div>
        <div class="quote-header__meta-item">
          <span>${c(i("projects.quote.labels.date","Ø§Ù„ØªØ§Ø±ÙŠØ®"))}</span>
          <strong>${c(b)}</strong>
        </div>
      </div>
    </header>
  `.trim();return`
    <div id="quotation-pdf-root" dir="rtl" data-lang="${c(He)}"${E}>
      <style>${wo}${vo}</style>
      <div class="quote-document" data-quote-document>
        <div class="quote-preview-pages" data-quote-pages></div>
        <div class="quote-content-source" data-quote-source>
          ${nt}
          ${At.join("")}
        </div>
      </div>
    </div>
  `}function Ho(e={}){const t={context:e?.context||Qe(),blockOffsets:e?.blockOffsets||s?.blockOffsets||null,infoAlignments:e?.infoAlignments||s?.infoAlignments||null},n=Fa(t),o=it;it=t;try{if(e?.context==="project")return Ps({...e,rootAttributes:n});const{reservation:a,customer:l,project:r,crewAssignments:u,totals:m,totalsDisplay:y,rentalDays:q,currencyLabel:v,sections:T,fieldSelections:b={},quoteNumber:h,quoteDate:E,terms:X=Ie}=e,S=N(String(a?.reservationId??a?.id??"")),x=typeof ue=="function"?ue():"ar",V=a.start?N(vt(a.start)):"-",G=a.end?N(vt(a.end)):"-",se=l?.customerName||l?.full_name||l?.name||"-",M=l?.phone||"-",Q=l?.email||"-",g=l?.company||l?.company_name||"-",A=N(M),R=r?.title||r?.name||i("reservations.details.project.none","ØºÙŠØ± Ù…Ø±ØªØ¨Ø· Ø¨Ù…Ø´Ø±ÙˆØ¹"),$=r?.code||r?.projectCode||"",re=N(String(q)),U=a?.notes||"",ee=Array.isArray(X)&&X.length?X:Ie,F=Ln(b),L=(p,z)=>In(F,p,z),I=p=>T?.has?.(p),j=`<div class="quote-placeholder">${c(i("reservations.quote.placeholder.noFields","Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù„Ù„Ø¹Ø±Ø¶ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…."))}</div>`,C=(p,z)=>{const Z=x==="en"?": ":" / ";return`<div class="info-plain__item">${c(p)}<span class="info-plain__slash">${Z}</span><strong class="info-plain__value">${c(z)}</strong></div>`},O=(p,z,{variant:Z="inline"}={})=>Z==="final"?`<div class="totals-item totals-item--final">
        <span class="totals-item__label">${c(p)}</span>
        <span class="totals-item__slash">/</span>
        <span class="totals-item__value">${c(z)}</span>
      </div>`:`<span class="totals-inline__item">
      <span class="totals-inline__label">${c(p)}</span>
      <span class="totals-inline__slash">/</span>
      <span class="totals-inline__value">${c(z)}</span>
    </span>`,B=(p,z)=>`<div class="payment-row">
      <span class="payment-row__label">${c(p)}</span>
      <span class="payment-row__slash">/</span>
      <span class="payment-row__value">${c(z)}</span>
    </div>`,oe=(p,z,Z)=>{const ne=`${p}-title`,ve=`${p}-content`;return`
      <div class="quote-section__head" data-drag-key="${c(ne)}">
        ${z}
      </div>
      <div class="quote-section__body" data-drag-key="${c(ve)}">
        ${Z}
      </div>
    `},le=[];L("customerInfo","customerName")&&le.push(C(i("reservations.details.labels.customer","Ø§Ù„Ø¹Ù…ÙŠÙ„"),se)),L("customerInfo","customerCompany")&&le.push(C(i("reservations.details.labels.company","Ø§Ù„Ø´Ø±ÙƒØ©"),g)),L("customerInfo","customerPhone")&&le.push(C(i("reservations.details.labels.phone","Ø§Ù„Ù‡Ø§ØªÙ"),A)),L("customerInfo","customerEmail")&&le.push(C(i("reservations.details.labels.email","Ø§Ù„Ø¨Ø±ÙŠØ¯"),Q));const xe=jt(s,"customer"),fe=I("customerInfo")&&le.length?`<section class="quote-section quote-section--plain quote-section--customer">
            ${oe("customer",`<h3 class="quote-section__title">${c(i("reservations.quote.sections.customer","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„"))}</h3>`,`<div class="${xe}">${le.join("")}</div>`)}
          </section>`:"",ge=[];L("reservationInfo","reservationId")&&ge.push(C(i("reservations.details.labels.reservationId","Ø±Ù‚Ù… Ø§Ù„Ø­Ø¬Ø²"),S||"-")),L("reservationInfo","reservationStart")&&ge.push(C(i("reservations.details.labels.start","Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø­Ø¬Ø²"),V)),L("reservationInfo","reservationEnd")&&ge.push(C(i("reservations.details.labels.end","Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø­Ø¬Ø²"),G)),L("reservationInfo","reservationDuration")&&ge.push(C(i("reservations.details.labels.duration","Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…"),re));const Ve=jt(s,"reservation"),te=I("reservationInfo")&&ge.length?`<section class="quote-section quote-section--plain quote-section--reservation">
            ${oe("reservation",`<h3 class="quote-section__title">${c(i("reservations.quote.sections.reservation","ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²"))}</h3>`,`<div class="${Ve}">${ge.join("")}</div>`)}
          </section>`:"",Ce=[];L("projectInfo","projectTitle")&&Ce.push(C(i("reservations.details.labels.project","Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"),R)),L("projectInfo","projectCode")&&Ce.push(C(i("reservations.details.labels.code","Ø§Ù„Ø±Ù…Ø²"),$||"-"));const Oe=jt(s,"project"),Me=I("projectInfo")&&Ce.length?`<section class="quote-section quote-section--plain quote-section--project">
            ${oe("project",`<h3 class="quote-section__title">${c(i("reservations.quote.sections.project","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"))}</h3>`,`<div class="${Oe}">${Ce.join("")}</div>`)}
          </section>`:"",De=[];L("financialSummary","discountAmount")&&De.push(O(i("reservations.details.labels.discount","Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ…"),`${y.discountAmount} ${v}`)),L("financialSummary","subtotalBeforeTax")&&De.push(O(i("reservations.details.labels.subtotalBeforeTax","Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"),`${y.taxableAmount} ${v}`)),L("financialSummary","taxAmount")&&De.push(O(i("reservations.details.labels.tax","Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"),`${y.taxAmount} ${v}`));const Ze=L("financialSummary","finalTotal"),Ge=[];Ze&&Ge.push(O(i("reservations.details.labels.total","Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ"),`${y.finalTotal} ${v}`,{variant:"final"}));const Pe=Ge.length?`<div class="totals-final">${Ge.join("")}</div>`:"",Ne=I("financialSummary")?!De.length&&!Ze?`<section class="quote-section quote-section--financial">${j}</section>`:`<section class="quote-section quote-section--financial">
          ${oe("financial",`<h3 class="quote-section__title">${c(i("reservations.details.labels.summary","Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ"))}</h3>`,`<div class="totals-block">
              ${De.length?`<div class="totals-inline">${De.join("")}</div>`:""}
              ${Pe}
            </div>`)}
        </section>`:"",{groups:Re}=io(a),et=Re.map(p=>{const z=Number(p?.count??p?.quantity??1)||1,Z=Number(p?.unitPrice);let ne=Number.isFinite(Z)?Z:0;if(!ne||ne<=0){const he=Number(p?.totalPrice);Number.isFinite(he)&&z>0&&(ne=Number((he/z).toFixed(2)))}Number.isFinite(ne)||(ne=0);const ve=p?.type==="package"||Array.isArray(p?.items)&&p.items.some(he=>he?.type==="package"),Ee=Array.isArray(p?.barcodes)&&p.barcodes.length?p.barcodes[0]:Array.isArray(p?.items)&&p.items.length?p.items[0]?.barcode:null;let P=p?.packageDisplayCode??p?.package_code??p?.code??p?.packageCode??(Array.isArray(p?.items)&&p.items.length?p.items[0]?.package_code??p.items[0]?.code??p.items[0]?.packageCode:null);const H=he=>{const qe=(he==null?"":String(he)).trim();return!!(!qe||/^pkg-/i.test(qe)||/^\d+$/.test(qe)&&qe.length<=4)};if(!P||H(P)){const he=p?.packageId??p?.package_id??(Array.isArray(p?.items)&&p.items.length?p.items[0]?.packageId??p.items[0]?.package_id:null);if(he)try{const qe=lo(he);qe&&qe.package_code&&(P=qe.package_code)}catch{}}if(!P||H(P))try{const he=gt(p?.description||"");if(he){const qe=uo();let at=qe.find(Xe=>gt(Xe?.name||Xe?.title||Xe?.label||"")===he);at||(at=qe.find(Xe=>{const ht=gt(Xe?.name||Xe?.title||Xe?.label||"");return ht.includes(he)||he.includes(ht)})),at&&at.package_code&&(P=at.package_code)}}catch{}const we=ve?P??Ee??"":p?.barcode??Ee??"",_e=we!=null?String(we):"";let Ue=Number.isFinite(Number(p?.totalPrice))?Number(p.totalPrice):Number((ne*z).toFixed(2));return Ue=Lt(Ue),{...p,isPackage:ve,desc:p?.description,barcode:_e,packageCodeResolved:P||"",qty:z,price:Ue,totalPrice:Ue,unitPriceValue:ne}}),kt=Zt.filter(p=>L("items",p.id)),Be=(()=>{let p=[];kt.forEach(P=>{P.id==="price"?p.push({...P,render:H=>{const we=Number.isFinite(Number(H?.unitPriceValue))?Number(H.unitPriceValue):0,_e=Number.isFinite(Number(H?.qty))?Math.max(1,Number(H.qty)):1,Ue=Math.max(1,Number(s?.rentalDays||1)),qe=Le(we)*_e*Ue;return c(`${ce(qe)} ${i("reservations.create.summary.currency","SR")}`)}}):P.id==="unitPrice"?p.push({...P,render:H=>{const we=Number.isFinite(Number(H?.unitPriceValue))?Number(H.unitPriceValue):0,_e=Le(we);return c(`${ce(_e)} ${i("reservations.create.summary.currency","SR")}`)}}):p.push(P)});const z=Math.max(1,Number(s?.rentalDays||1));if(L("items","days")){const P=p.findIndex(we=>we.id==="price"),H=Math.max(0,P);p.splice(H,0,{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…",render:()=>c(N(String(z)))})}const Z=new Map(p.map(P=>[P.id,P])),ne=p.filter(P=>!["unitPrice","quantity","days","price"].includes(P.id)),ve=["unitPrice","quantity"];Z.has("days")&&ve.push("days"),ve.push("price");const Ee=ve.map(P=>Z.get(P)).filter(Boolean);return p=[...ne,...Ee],p})(),$e=Be.length>0,tt=$e?Be.map(p=>`<th>${c(p.labelKey?i(p.labelKey,p.fallback):p.fallback)}</th>`).join(""):"",mt=et.length>0?et.map((p,z)=>`<tr>${Be.map(Z=>`<td><div class="quote-cell">${Z.render(p,z)}</div></td>`).join("")}</tr>`).join(""):`<tr><td colspan="${Math.max(Be.length,1)}" class="empty">${c(i("reservations.details.noItems","ðŸ“¦ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø¯Ø§Øª Ø¶Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø² Ø­Ø§Ù„ÙŠØ§Ù‹."))}</td></tr>`,At=(()=>{try{const p=Math.max(1,Number(s?.rentalDays||1)),z=et.reduce((Z,ne)=>{const ve=Number.isFinite(Number(ne?.unitPriceValue))?Number(ne.unitPriceValue):0,Ee=Number.isFinite(Number(ne?.qty))?Math.max(1,Number(ne.qty)):1,P=Le(ve);return Z+P*Ee*p},0);return ce(z)}catch{return ce(0)}})(),He=I("items")?$e?`<section class="quote-section quote-section--table">
            <h3>${c(i("reservations.details.items.title","Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</h3>
            <table class="quote-table">
              <thead>
                <tr>${tt}</tr>
              </thead>
              <tbody>${mt}</tbody>
            </table>
            ${L("items","equipmentSubtotal")?`
              <div class="quote-table-subtotal">
                <span class="quote-table-subtotal__pill">
                  <span class="quote-table-subtotal__label">${c(i("reservations.details.labels.equipmentTotal","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</span>
                  <span class="quote-table-subtotal__value">${c(`${At} ${v}`)}</span>
                </span>
              </div>
            `:""}
          </section>`:`<section class="quote-section quote-section--table">
            <h3>${c(i("reservations.details.items.title","Ø§Ù„Ù…Ø¹Ø¯Ø§Øª"))}</h3>
            ${j}
          </section>`:"",nt=en.filter(p=>L("crew",p.id)),f=!0,K=nt.length>0,D=Array.isArray(u)?u:[],W=p=>{const z=p&&p.positionId!=null?`id:${String(p.positionId)}`:(()=>{const ve=(p?.positionLabel||p?.position_name||p?.position||"").trim().toLowerCase();return ve?`label:${ve}`:""})(),Z=Number.isFinite(Number(p?.positionClientPrice))?Number(p.positionClientPrice):0,ne=Z>0?`|p:${Z.toFixed(2)}`:"";return`${z}${ne}`},Y=(()=>{const p=new Map;return D.forEach(z=>{const Z=W(z);Z&&p.set(Z,(p.get(Z)||0)+1)}),p})(),d=(()=>{let p=[],z=null;if(nt.forEach(P=>{P.id==="position"?(p.push({...P,render:H=>{const we=typeof ue=="function"?ue():"ar";let _e=H?.positionLabelEn??H?.position_label_en??H?.position_name_en??H?.positionLabelAlt??H?.position_label_alt??H?.role;if(!_e&&we==="en")try{const ht=typeof wt=="function"?wt():[];let ut=null;if(H?.positionId!=null&&(ut=ht.find(Ft=>String(Ft.id)===String(H.positionId))||null),!ut){const Ft=H?.positionKey??H?.position_key??H?.positionName??H?.position_name??H?.position??"";if(Ft){const ta=String(Ft).toLowerCase();ut=ht.find(na=>String(na.name).toLowerCase()===ta)||null}}ut&&(_e=ut.labelEn??ut.label_en??ut.name_en??_e)}catch{}const Ue=H?.positionLabel??H?.position_name??H?.role??i("reservations.crew.positionFallback","Ù…Ù†ØµØ¨ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…"),he=we==="en"&&_e?_e:Ue;if(f)return c(N(String(he)));const qe=W(H),at=qe&&Y.get(qe)||0,Xe=at>1?` Ã— ${N(String(at))}`:"";return c(N(String(he))+Xe)}}),L("crew","quantity")&&(z={id:"quantity",labelKey:"reservations.details.table.headers.quantity",fallback:"Ø§Ù„ÙƒÙ…ÙŠØ©",render:H=>{const we=Number(H?.__count||1);return c(N(String(Math.max(1,we))))}})):P.id==="price"?f&&p.push({...P,render:H=>{const we=Number.isFinite(Number(H?.positionClientPrice))?Number(H.positionClientPrice):0,_e=Math.max(1,Number(H?.__count||1)),Ue=Math.max(1,Number(s?.rentalDays||1)),qe=Le(we)*_e*Ue;return c(`${ce(qe)} ${i("reservations.create.summary.currency","SR")}`)}}):P.id==="unitPrice"?p.push({...P,render:H=>{const we=Number.isFinite(Number(H?.positionClientPrice))?Number(H.positionClientPrice):0,_e=Le(we);return c(`${ce(_e)} ${i("reservations.create.summary.currency","SR")}`)}}):p.push(P)}),z&&p.push(z),L("crew","days")){const P=Math.max(1,Number(s?.rentalDays||1)),H=p.findIndex(_e=>_e.id==="price"),we=Math.max(0,H);p.splice(we,0,{id:"days",labelKey:"reservations.details.table.headers.days",fallback:"Ø§Ù„Ø£ÙŠØ§Ù…",render:()=>c(N(String(P)))})}const Z=new Map(p.map(P=>[P.id,P])),ne=new Set,ve=[],Ee=P=>{const H=Z.get(P);H&&!ne.has(P)&&(ve.push(H),ne.add(P))};return Ee("rowNumber"),Ee("position"),Ee("unitPrice"),Ee("quantity"),Ee("days"),Ee("price"),p.forEach(P=>{ne.has(P.id)||(ve.push(P),ne.add(P.id))}),p=ve,p})(),k=K?d.map(p=>`<th>${c(p.labelKey?i(p.labelKey,p.fallback):p.fallback)}</th>`).join(""):"",_=f?(()=>{const p=new Map;return D.forEach(z=>{const Z=W(z);if(!Z)return;const ne=p.get(Z);ne?ne.__count+=1:p.set(Z,{...z,__count:1})}),Array.from(p.values())})():D,J=_.length?_.map((p,z)=>`<tr>${d.map(Z=>`<td><div class="quote-cell">${Z.render(p,z)}</div></td>`).join("")}</tr>`).join(""):`<tr><td colspan="${Math.max(d.length,1)}" class="empty">${c(i("reservations.details.noCrew","ðŸ˜Ž Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙØ±ÙŠÙ‚ Ù…Ø±ØªØ¨Ø· Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø²."))}</td></tr>`,ie=(()=>{try{const p=Math.max(1,Number(s?.rentalDays||1)),z=_.reduce((Z,ne)=>{const ve=Number.isFinite(Number(ne?.positionClientPrice))?Number(ne.positionClientPrice):0,Ee=Math.max(1,Number(ne?.__count||1)),P=Le(ve);return Z+P*Ee*p},0);return ce(z)}catch{return ce(0)}})(),de=I("crew")?K?`<section class="quote-section quote-section--table">
            <h3>${c(i("reservations.details.technicians.title","Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„"))}</h3>
            <table class="quote-table">
              <thead>
                <tr>${k}</tr>
              </thead>
              <tbody>${J}</tbody>
            </table>
            ${L("crew","crewSubtotal")?`
              <div class="quote-table-subtotal">
                <span class="quote-table-subtotal__pill">
                  <span class="quote-table-subtotal__label">${c(i("reservations.details.labels.crewTotal","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±ÙŠÙ‚"))}</span>
                  <span class="quote-table-subtotal__value">${c(`${ie} ${v}`)}</span>
                </span>
              </div>
            `:""}
          </section>`:`<section class="quote-section quote-section--table">
            <h3>${c(i("reservations.details.technicians.title","Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„"))}</h3>
            ${j}
          </section>`:"",Se=I("notes")?`<section class="quote-section">
        <h3>${c(i("reservations.details.labels.notes","Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø­Ø¬Ø²"))}</h3>
        <div class="quote-notes">${c(U||i("reservations.quote.emptyNotes","Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©."))}</div>
      </section>`:"",pe=[];L("payment","beneficiary")&&pe.push(B(i("reservations.quote.labels.beneficiary","Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙÙŠØ¯"),ke.beneficiaryName)),L("payment","bank")&&pe.push(B(i("reservations.quote.labels.bank","Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ"),ke.bankName)),L("payment","account")&&pe.push(B(i("reservations.quote.labels.account","Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨"),N(ke.accountNumber))),L("payment","iban")&&pe.push(B(i("reservations.quote.labels.iban","Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ¨Ø§Ù†"),N(ke.iban)));const ye=`<section class="quote-section">
      <div class="payment-block">
        <h3>${c(i("reservations.quote.sections.payment","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹"))}</h3>
        <div class="payment-rows">${pe.length?pe.join(""):j}</div>
      </div>
      <p class="quote-approval-note">${c(ke.approvalNote)}</p>
    </section>`,We=`<footer class="quote-footer">
        <h4>${c(i("reservations.quote.labels.terms","Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø¹Ø§Ù…Ø©"))}</h4>
        <ul>${ee.map(p=>`<li>${c(p)}</li>`).join("")}</ul>
      </footer>`,je=[];if(fe&&te){const z=(typeof ue=="function"?ue():"ar")==="en"?`${te}${fe}`:`${fe}${te}`;je.push(me(`<div class="quote-section-row">${z}</div>`,{blockType:"group"}))}else te&&je.push(me(te)),fe&&je.push(me(fe));if(Me)try{const p=typeof ue=="function"?ue():"ar",z='<section class="quote-section quote-section--empty"></section>',Z=p==="en"?`<div class="quote-section-row">${z}${Me}</div>`:`<div class="quote-section-row">${z}${Me}</div>`;je.push(me(Z,{blockType:"group"}))}catch{je.push(me(Me))}const ot=[];He&&ot.push(me(He,{blockType:"table",extraAttributes:'data-table-id="items"'})),de&&ot.push(me(de,{blockType:"table",extraAttributes:'data-table-id="crew"'}));const ft=[];Ne&&ft.push(me(Ne,{blockType:"summary"})),Se&&ft.push(me(Se));let be=[];if((e?.context||"reservation")!=="reservationChecklist")be=[...I("payment")?[me(ye,{blockType:"payment"})]:[],me(We,{blockType:"footer"})];else{const p=String(e?.checklistNotes||"").trim(),z=String(e?.checklistNotesTitle||"").trim()||i("reservations.checklist.controls.notes.sectionTitleDefault","Ù…Ù„Ø§Ø­Ø¸Ø§Øª");if(p.length>0){const Z=`<section class="quote-section">
        <h3>${c(z)}</h3>
        <div class="quote-notes">${c(p)}</div>
      </section>`;be=[me(Z)]}}const Te=[...e?.context==="reservationChecklist"?je:Wt(je,"reservations.quote.placeholder.page1"),...ot,...e?.context==="reservationChecklist"?ft:Wt(ft,"reservations.quote.placeholder.page2"),...be],Fe=e?.context==="reservationChecklist",Ye=e?.checklistType==="crew"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ":e?.checklistType==="both"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙˆØ§Ù„Ø·Ø§Ù‚Ù… Ø§Ù„ÙÙ†ÙŠ":"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",lt=typeof ue=="function"?ue():"ar",Wo=e?.checklistType==="crew"?"Crew List":e?.checklistType==="both"?"Equipment & Crew List":"Equipment List",Yo=Fe?lt==="en"?Wo:Ye:i("reservations.quote.title","Ø¹Ø±Ø¶ Ø³Ø¹Ø±"),Xo=Fe?`<div class="quote-header__meta" ${lt==="en"?'dir="ltr"':""}>
        <div class="quote-header__meta-item">
          <span>${c(i("reservations.quote.labels.date","Ø§Ù„ØªØ§Ø±ÙŠØ®"))}</span>
          <strong>${c(E)}</strong>
        </div>
      </div>`:`<div class="quote-header__meta">
        <div class="quote-header__meta-item">
          <span>Ø±Ù‚Ù… Ø§Ù„Ø¹Ø±Ø¶</span>
          <strong>${c(h)}</strong>
        </div>
        <div class="quote-header__meta-item">
          <span>Ø§Ù„ØªØ§Ø±ÙŠØ®</span>
          <strong>${c(E)}</strong>
        </div>
      </div>`,Jo=!Fe||!e?.hideLogo,Zo=!Fe||!e?.hideCompany,ea=`
    <header class="quote-header" data-quote-header-template style="${Number.isFinite(Number(e?.headerOffset))?`margin-top:${Number(e.headerOffset)}px;`:""}">
      <div class="quote-header__logo">
        ${Jo?`<img class="quote-logo" src="${c(ke.logoUrl)}" alt="${c(ke.companyName)}" crossorigin="anonymous"/>`:'<span class="quote-logo quote-logo--placeholder" aria-hidden="true"></span>'}
      </div>
      <div class="quote-header__title">
        <h1>${c(Yo)}</h1>
        ${Zo?`
          <p class="quote-company-name">${c(i("quote.companyName",ke.companyName))}</p>
          <p class="quote-company-cr">${c(i("reservations.quote.labels.cr","Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ"))}: ${c(ke.commercialRegistry)}</p>
          <p class="quote-company-license">${c(i("reservations.quote.labels.mediaLicense","ØªØ±Ø®ÙŠØµ Ø¥Ø¹Ù„Ø§Ù…ÙŠ"))}: 159460</p>
        `:""}
      </div>
      ${Xo}
    </header>
  `.trim();return`
      <div id="quotation-pdf-root" dir="${c(Fe&&lt==="en"?"ltr":"rtl")}" data-lang="${c(lt)}"${n}>
        <style>${wo}${vo}</style>
        <div class="quote-document" data-quote-document>
          <div class="quote-preview-pages" data-quote-pages></div>
          <div class="quote-content-source" data-quote-source>
            ${ea}
            ${Te.join("")}
          </div>
        </div>
      </div>
    `}finally{it=o}}async function Bn(){try{const e=Jt();if((Array.isArray(e?.packages)?e.packages:[]).length>0)return;const n=await oa("/packages/?all=1"),o=Array.isArray(n?.data)?n.data:Array.isArray(n)?n:[];o.length&&(aa({packages:o}),document.dispatchEvent?.(new CustomEvent("packages:changed",{detail:{packages:o}})))}catch{}}function Fs(e){return e?e.complete?e.naturalHeight===0?Promise.reject(new Error(`image failed to load: ${e.src||"unknown"}`)):Promise.resolve():new Promise((t,n)=>{const o=()=>{l(),t()},a=()=>{l(),n(new Error(`image failed to load: ${e.src||"unknown"}`))},l=()=>{e.removeEventListener("load",o),e.removeEventListener("error",a)};e.addEventListener("load",o,{once:!0}),e.addEventListener("error",a,{once:!0})}):Promise.resolve()}async function Dt(e){if(!e)return;const t=e.ownerDocument||document,n=t.defaultView||window,o=Array.from(e.querySelectorAll?.("img")||[]),a=t.fonts?.ready?t.fonts.ready:Promise.resolve(),l=o.map(u=>Fs(u)),r=[a,...l].map(u=>u.catch(m=>(Je("asset load failed",m),Xa(),null)));await Promise.all(r),await new Promise(u=>n.requestAnimationFrame(()=>u()))}async function Yt(e,{context:t="preview"}={}){if(!e)return;const n=t==="preview",o=e.ownerDocument||document;e.setAttribute("data-quote-render-context",t);const a=e.querySelector("[data-quote-pages]"),l=e.querySelector("[data-quote-source]"),r=l?.querySelector("[data-quote-header-template]");if(!a||!l||!r)return;a.style.display="block",a.style.margin="0",a.style.padding="0",a.style.gap="0px",a.style.rowGap="0px",a.style.columnGap="0px",a.style.alignItems="stretch",a.style.justifyContent="flex-start",await Oo(l),await Dt(l),a.innerHTML="";const u=Array.from(l.querySelectorAll(":scope > [data-quote-block]")),m=e.getAttribute(bt.context)||null,y=Xn(e,bt.blockOffsets),q=Xn(e,bt.infoAlignments),v=it,T=m||y||q;T&&(it={context:m||null,blockOffsets:y||null,infoAlignments:q||null});let b=null,h=null;const E=g=>{g.style.margin="0 auto",g.style.breakInside="avoid",g.style.pageBreakInside="avoid",g.style.pageBreakAfter="auto",g.style.breakAfter="auto"},X=()=>{const g=o.createElement("div"),A=a.childElementCount===0;if(g.className="quote-page",g.dataset.pageIndex=String(a.childElementCount),A){g.classList.add("quote-page--primary");const $=r.cloneNode(!0);$.removeAttribute("data-quote-header-template"),g.appendChild($)}else g.classList.add("quote-page--continuation");const R=o.createElement("main");R.className="quote-body",g.appendChild(R),a.appendChild(g),E(g),b=g,h=R},S=()=>{(!b||!h||!h.isConnected)&&X()},x=()=>{if(!b||!h||h.childElementCount>0)return;const g=b;b=null,h=null,g.parentNode&&g.parentNode.removeChild(g)},V=()=>{b=null,h=null},G=()=>b?b.scrollHeight-b.clientHeight>_o:!1,se=(g,{allowOverflow:A=!1}={})=>(S(),h.appendChild(g),G()&&!A?(h.removeChild(g),x(),!1):!0),M=g=>{const A=g.cloneNode(!0);A.removeAttribute?.("data-quote-block"),A.removeAttribute?.("data-block-type"),A.removeAttribute?.("data-table-id"),!se(A)&&(V(),!se(A)&&se(A,{allowOverflow:!0}))},Q=g=>{const A=g.querySelector("table");if(!A){M(g);return}const R=g.querySelector("h3"),$=A.querySelector("thead"),re=Array.from(A.querySelectorAll("tbody tr"));if(!re.length){M(g);return}let U=null,ee=0;const F=(I=!1)=>{const j=g.cloneNode(!1);j.removeAttribute("data-quote-block"),j.removeAttribute("data-block-type"),j.removeAttribute("data-table-id"),j.classList.add("quote-section--table-fragment"),I&&j.classList.add("quote-section--table-fragment--continued");const C=R?R.cloneNode(!0):null;C&&j.appendChild(C);const O=A.cloneNode(!1);O.classList.add("quote-table--fragment"),$&&O.appendChild($.cloneNode(!0));const B=o.createElement("tbody");return O.appendChild(B),j.appendChild(O),{section:j,body:B}},L=(I=!1)=>U||(U=F(I),se(U.section)||(V(),se(U.section)||se(U.section,{allowOverflow:!0})),U);re.forEach(I=>{L(ee>0);const j=I.cloneNode(!0);if(U.body.appendChild(j),G()&&(U.body.removeChild(j),U.body.childElementCount||(h.removeChild(U.section),U=null,x()),V(),U=null,L(ee>0),U.body.appendChild(j),G())){U.section.classList.add("quote-section--table-fragment--overflow"),ee+=1;return}ee+=1}),U=null;try{const I=g.querySelector(":scope > .quote-table-subtotal");I&&M(I)}catch{}};try{if(!u.length)return;u.forEach(F=>{F.getAttribute("data-block-type")==="table"?Q(F):M(F)});const g=Array.from(a.children),A=[];if(g.forEach((F,L)=>{const I=F.querySelector(".quote-body");if(L!==0&&(!I||I.childElementCount===0)){F.remove();return}A.push(F)}),!n){const F=o.defaultView||window,L=Math.min(3,Math.max(1,F.devicePixelRatio||1)),I=rn()?Math.min(2,L):L;A.forEach(j=>ms(j,{pixelRatio:I}))}A.forEach((F,L)=>{const I=L===0;F.style.pageBreakAfter="auto",F.style.breakAfter="auto",F.style.pageBreakBefore=I?"auto":"always",F.style.breakBefore=I?"auto":"page",n?F.style.boxShadow="":F.style.boxShadow="none"});const R=A[A.length-1]||null;b=R,h=R?.querySelector(".quote-body")||null,await Dt(a);const $=F=>F&&typeof F=="object"&&Object.keys(F).length>0,U=xn[Qe(s||(m?{context:m}:null))]||{},ee=$(y)?y:$(s?.blockOffsets)?s.blockOffsets:U;try{Ma(e,ee)}catch{}}finally{T&&(it=v)}n&&(a.style.display="flex",a.style.flexDirection="column",a.style.alignItems="center",a.style.justifyContent="flex-start",a.style.rowGap="18px",a.style.columnGap="0px",a.style.gap="18px")}function Uo(e=0){return e<=0?new Promise(t=>requestAnimationFrame(()=>t())):new Promise(t=>setTimeout(t,e))}function zo(e){return e?Array.from(e.querySelectorAll(".quote-page")).some(n=>n.scrollHeight-n.clientHeight>_o):!1}function Kn(e,t="#000000"){if(!e)return;e.querySelectorAll('[style*="color"], [class*="text"], h1, h2, h3, h4, h5, h6, p, span, th, td, li, strong, em, label, dt, dd, caption, div').forEach(o=>{o instanceof HTMLElement&&o.style.setProperty("color",t,"important")})}async function Os(e,{filename:t,safariWindowRef:n=null,mobileWindowRef:o=null}){if(!e)return;const a=Array.from(e.querySelectorAll(".quote-page"));if(!a.length)throw new Error("Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙØ­Ø§Øª Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§.");const[l,r]=await Promise.all([hs(),fs()]),u=e.ownerDocument||document,m=u?.defaultView?.getComputedStyle?.(e)?.direction,q=[e.getAttribute?.("dir"),e.style?.direction,m,u?.documentElement?.getAttribute?.("dir")].some(M=>typeof M=="string"&&M.toLowerCase().startsWith("rtl")),v=typeof window<"u"&&window.devicePixelRatio||1,T=Pn(),b=Io(),h=rn();let E;h?E=1.5:b?E=Math.min(1.7,Math.max(1.2,v*1.1)):T?E=Math.min(1.8,Math.max(1.25,v*1.2)):E=Math.min(2,Math.max(1.6,v*1.4));const X=h||b?.9:T?.92:.95,S=new l({unit:"mm",format:"a4",orientation:"portrait",compress:!0}),x={scale:E,useCORS:!0,allowTaint:!1,backgroundColor:"#ffffff",letterRendering:!q,removeContainer:!1,logging:!0};let V=0;const G=i("reservations.quote.errors.browserLimit","ØªØ¹Ø°Ø± Ø¥ØªÙ…Ø§Ù… Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ø³Ø¨Ø¨ Ù‚ÙŠÙˆØ¯ Ø§Ù„Ù…ØªØµÙØ­ØŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø£Ùˆ ØªÙ‚Ù„ÙŠÙ„ Ø­Ø¬Ù… Ø§Ù„Ù…Ø­ØªÙˆÙ‰.");try{for(let M=0;M<a.length;M+=1){const Q=a[M];await Oo(Q),await Dt(Q);const g=Q.ownerDocument||document,A=g.createElement("div");Object.assign(A.style,{position:"fixed",top:"0",left:"-12000px",pointerEvents:"none",zIndex:"-1",backgroundColor:"#ffffff"});const R=Q.cloneNode(!0);R.style.width=`${$t}px`,R.style.maxWidth=`${$t}px`,R.style.minWidth=`${$t}px`,R.style.height=`${Et}px`,R.style.maxHeight=`${Et}px`,R.style.minHeight=`${Et}px`,R.style.position="relative",R.style.background="#ffffff",Kn(R);const $=g.createElement("div"),re=Array.from(e?.attributes||[]),U=e?.id&&typeof e.id=="string"&&e.id.trim().length?e.id:"quotation-pdf-root";if($.id=U,re.forEach(te=>{!te?.name||te.name==="id"||$.setAttribute(te.name,te.value)}),!$.hasAttribute("dir")){const te=e?.getAttribute("dir")||g.documentElement?.getAttribute("dir")||"rtl";$.setAttribute("dir",te)}const ee=g.createElement("iframe");ee.setAttribute("title","quote-pdf-capture"),Object.assign(ee.style,{position:"absolute",width:`${$t}px`,height:`${Et}px`,border:"0",top:"0",left:"0",opacity:"0",pointerEvents:"none"}),A.appendChild(ee),g.body.appendChild(A);const F=ee.contentDocument||ee.contentWindow?.document;F.open(),F.write("<!DOCTYPE html><html><head></head><body></body></html>"),F.close(),F.documentElement.setAttribute("dir",$.getAttribute("dir")||"rtl");const L=F.head,I=F.body;Array.from(e.children||[]).forEach(te=>{te&&te.tagName==="STYLE"&&L.appendChild(te.cloneNode(!0))});const j=F.createElement("div");j.className="quote-document",j.setAttribute("data-quote-document","");const C=F.createElement("div");C.className="quote-preview-pages",C.setAttribute("data-quote-pages",""),C.appendChild(R),j.appendChild(C),$.appendChild(j),I.appendChild($);let O;try{await Dt($);const te=F.defaultView||ee.contentWindow||window;qn($,te),Sn($,te),wn($),O=await r($,{...x,scale:E,backgroundColor:"#ffffff",scrollX:0,scrollY:0})}catch(te){throw bn(te,"pageCapture",{toastMessage:G}),te}finally{A.parentNode?.removeChild(A)}if(!O)continue;const B=O.width||1,le=(O.height||1)/B;let xe=mn,fe=xe*le,ge=0;if(fe>Ot){const te=Ot/fe;fe=Ot,xe=xe*te,ge=Math.max(0,(mn-xe)/2)}const Ve=O.toDataURL("image/jpeg",X);V>0&&S.addPage(),S.addImage(Ve,"JPEG",ge,0,xe,fe,`page-${V+1}`,"FAST"),V+=1,await new Promise(te=>window.requestAnimationFrame(te))}}catch(M){throw gn({safariWindowRef:n,mobileWindowRef:o}),M}if(V===0)throw gn({safariWindowRef:n,mobileWindowRef:o}),new Error("PDF generation produced no pages.");if(b||h){const M=S.output("blob");if(h){const Q=URL.createObjectURL(M);Tt();try{window.location.assign(Q)}catch(g){Je("mobile safari blob navigation failed",g)}finally{setTimeout(()=>URL.revokeObjectURL(Q),6e4)}}else{const Q=URL.createObjectURL(M),g=()=>b&&n&&!n.closed?n:o&&!o.closed?o:null,A=($,re)=>{if(Tt(),!$){window.location.assign(re);return}try{$.location.replace(re),$.focus?.()}catch(U){Je("direct blob navigation failed",U);try{$.document.open(),$.document.write(`<!DOCTYPE html><html lang="ar" dir="rtl"><head><meta charset="utf-8"><title>${c(i("reservations.quote.actions.export","ØªÙ†Ø²ÙŠÙ„ PDF"))}</title><style>html,body{margin:0;height:100%;background:#0f172a;color:#f8fafc;font-family:'Tajawal',sans-serif;} iframe{border:none;width:100%;height:100%;display:block;}</style></head><body><iframe src="${re}" title="PDF preview"></iframe></body></html>`),$.document.close()}catch(ee){Je("iframe blob delivery failed",ee),window.location.assign(re)}}},R=g();A(R,Q),setTimeout(()=>URL.revokeObjectURL(Q),6e4)}}else{Tt();const M=S.output("bloburl"),Q=document.createElement("a");Q.href=M,Q.download=t,Q.rel="noopener",Q.style.display="none",document.body.appendChild(Q),Q.click(),setTimeout(()=>{URL.revokeObjectURL(M),Q.remove()},2e3)}}function Ae(){if(!s||!w)return;const{previewFrame:e}=w;if(!e)return;Go();const t=s.context||"reservation",n=t==="reservationChecklist"?No():s.reservation,o=Ho({context:t,reservation:n||s.reservation,customer:s.customer,project:s.project,crewAssignments:s.crewAssignments,totals:s.totals,totalsDisplay:s.totalsDisplay,rentalDays:s.rentalDays,currencyLabel:s.currencyLabel,sections:s.sections,fieldSelections:s.fields,quoteNumber:s.quoteNumber,quoteDate:s.quoteDateLabel,terms:s.terms,checklistType:s.checklistType,checklistNotes:s.checklistNotes,checklistNotesTitle:s.checklistNotesTitle,hideLogo:!!s.hideLogo,hideCompany:!!s.hideCompany,headerOffset:Number(s.headerOffset||0),projectCrew:s.projectCrew,projectExpenses:s.projectExpenses,projectEquipment:s.projectEquipment,projectInfo:s.projectInfo,clientInfo:s.clientInfo,paymentSummary:s.paymentSummary,projectTotals:s.projectTotals,blockOffsets:s.blockOffsets,infoAlignments:s.infoAlignments});pt("render"),e.srcdoc=`<!DOCTYPE html>${o}`,e.addEventListener("load",async()=>{try{const a=e.contentDocument,l=a?.defaultView||window,r=a?.documentElement||a;r&&(wn(r),qn(r,l),Sn(r,l));const u=a?.getElementById("quotation-pdf-root");try{u&&(await Yt(u,{context:"preview"}),await Uo(120),zo(u)&&await Yt(u,{context:"preview"}),Kn(u))}catch(h){console.error("[reservations/pdf] failed to layout preview document",h)}const m=Array.from(a?.querySelectorAll?.(".quote-page")||[]);try{if(s?.context==="reservationChecklist"&&s?.hideCompany){const E=a.querySelector(".quote-header");if(E&&!E.dataset.dragReady){E.style.cursor="grab";let X=!1,S=0,x=Number(s.headerOffset||0);const V=M=>{X=!0,S=M.clientY||M.touches?.[0]?.clientY||0,x=Number(s.headerOffset||0),E.style.cursor="grabbing",a.addEventListener("mousemove",G),a.addEventListener("mouseup",se,{once:!0}),a.addEventListener("touchmove",G,{passive:!1}),a.addEventListener("touchend",se,{once:!0})},G=M=>{if(!X)return;const g=(M.clientY||M.touches?.[0]?.clientY||0)-S,A=Math.max(0,Math.min(240,x+g));E.style.marginTop=`${A}px`,s.headerOffset=A,M.preventDefault?.()},se=()=>{X=!1,E.style.cursor="grab",a.removeEventListener("mousemove",G),a.removeEventListener("touchmove",G)};E.addEventListener("mousedown",V),E.addEventListener("touchstart",V,{passive:!0}),E.dataset.dragReady="true"}}}catch{}Va(a),Nn(a),an();const y=a?.querySelector(".quote-preview-pages"),q=$t;let v=18;if(y&&a?.defaultView){const h=a.defaultView.getComputedStyle(y),E=parseFloat(h.rowGap||h.gap||`${v}`);Number.isFinite(E)&&E>=0&&(v=E)}const T=Et,b=m.length?m.length*T+Math.max(0,(m.length-1)*v):T;if(e.dataset.baseWidth=String(q),e.dataset.baseHeight=String(b),e.style.width=`${q}px`,e.style.minWidth=`${q}px`,e.style.height=`${b}px`,e.style.minHeight=`${b}px`,w?.previewFrameWrapper&&!w?.userAdjustedZoom){const h=w.previewFrameWrapper.clientWidth-24;h>0&&h<q?ze=Math.max(h/q,.3):ze=1}Qo(ze)}finally{Tt()}},{once:!0})}function Ms(e){if(!s)return;const t=e.currentTarget,n=t?.dataset?.sectionId;n&&(t.checked?s.sections.add(n):s.sections.delete(n),Ro(s),Mt(),Ae())}function Rs(e){if(!s)return;const t=e.currentTarget,n=t?.dataset?.sectionId,o=t?.dataset?.fieldId;if(!n||!o)return;const a=s.context||"reservation",l=s.fields||(s.fields=Pt(a)),r=Ja(l,n);t.checked?r.add(o):r.delete(o),Ro(s),Ae()}function Bs(e){if(!s)return;const t=e.currentTarget,n=t?.dataset?.sectionId;n&&(Dn(s,n),s.sectionExpansions[n]=t.open)}function Mt(){if(!w?.toggles||!s)return;const{toggles:e}=w,t=s.fields||{},n=s.context||"reservation";Dn(s);const o=nn(n),a=ho(n),l=o.map(({id:r,labelKey:u,fallback:m})=>{const y=i(u,m),q=s.sections.has(r),v=a[r]||[],T=Za(s,r),b=v.length?`<div class="quote-toggle-sublist">
          ${v.map(h=>{const E=In(t,r,h.id),X=q?"":"disabled",S=h.labelKey?i(h.labelKey,h.fallback):h.fallback;return`
              <label class="quote-toggle quote-toggle--field">
                <input type="checkbox" data-field-toggle data-section-id="${r}" data-field-id="${h.id}" ${E?"checked":""} ${X}>
                <span>${c(S)}</span>
              </label>
            `}).join("")}
        </div>`:"";return`
      <details class="quote-toggle-group" data-section-group data-section-id="${r}" ${T?"open":""}>
        <summary class="quote-toggle-summary">
          <label class="quote-toggle quote-toggle--section">
            <input type="checkbox" data-section-toggle data-section-id="${r}" ${q?"checked":""}>
            <span>${c(y)}</span>
          </label>
          ${v.length?'<span class="quote-toggle-caret" aria-hidden="true"></span>':""}
        </summary>
        ${b}
      </details>
    `}).join("");e.innerHTML=l,e.querySelectorAll("input[data-section-toggle]").forEach(r=>{r.addEventListener("change",Ms)}),e.querySelectorAll("input[data-field-toggle]").forEach(r=>{r.addEventListener("change",Rs)}),e.querySelectorAll("details[data-section-group]").forEach(r=>{r.addEventListener("toggle",Bs)})}function Ks(){if(w?.modal)return w;const e=document.createElement("div");e.id="reservationQuoteModal",e.className="modal fade quote-preview-modal",e.tabIndex=-1,e.setAttribute("aria-labelledby","reservationQuoteModalLabel"),e.setAttribute("aria-hidden","true"),e.style.display="none",e.innerHTML=`
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="reservationQuoteModalLabel">${c(i("reservations.quote.previewTitle","Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¹Ø±Ø¶ Ø³Ø¹Ø±"))}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="quote-preview-layout">
            <aside class="quote-preview-sidebar">
              <h6>${c(i("reservations.quote.toggleHeading","Ø­Ø¯Ø¯ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø¯ ØªØµØ¯ÙŠØ±Ù‡Ø§"))}</h6>
              <div class="quote-toggle-list" data-quote-toggles></div>
              <div class="quote-meta-info" data-quote-meta></div>
              <div class="quote-terms-editor" data-quote-terms-editor>
                <label class="quote-terms-editor__label" for="quote-terms-input">${c(i("reservations.quote.termsEditor.title","Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø¹Ø§Ù…Ø© (Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„)"))}</label>
                <textarea id="quote-terms-input" class="quote-terms-editor__textarea" rows="6" data-quote-terms-input placeholder="${c(i("reservations.quote.termsEditor.placeholder","Ø§ÙƒØªØ¨ ÙƒÙ„ Ø´Ø±Ø· ÙÙŠ Ø³Ø·Ø± Ù…Ø³ØªÙ‚Ù„"))}"></textarea>
                <button type="button" class="quote-terms-reset" data-quote-terms-reset>${c(i("reservations.quote.termsEditor.reset","Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©"))}</button>
              </div>
            </aside>
            <section class="quote-preview-panel">
              <div class="quote-preview" data-quote-preview></div>
            </section>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-light" data-bs-dismiss="modal">${c(i("reservations.quote.actions.close","Ø¥ØºÙ„Ø§Ù‚"))}</button>
          <button type="button" class="btn btn-primary" data-quote-download>
            ${c(i("reservations.quote.actions.export","ðŸ“„ ØªÙ†Ø²ÙŠÙ„ PDF"))}
          </button>
        </div>
      </div>
    </div>
  `,document.body.appendChild(e);const t=e.querySelector("[data-quote-toggles]"),n=e.querySelector("[data-quote-preview]"),o=e.querySelector("[data-quote-meta]"),a=e.querySelector("[data-quote-terms-input]"),l=e.querySelector("[data-quote-terms-reset]"),r=e.querySelector("[data-quote-download]"),u=e.querySelector(".modal-header"),m=u?.querySelector(".btn-close"),y=Array.from(e.querySelectorAll('[data-bs-dismiss="modal"]')),q=document.createElement("div");q.className="quote-preview-header-actions",u&&u.insertBefore(q,m||null);const v=[],T=(j=null)=>{v.forEach(C=>{C!==j&&(C.menu.hidden=!0,C.toggle.setAttribute("aria-expanded","false"),C.wrapper.classList.remove("is-open"))})},b=(j,C,O)=>{v.push({wrapper:j,toggle:C,menu:O})},h=j=>{if(!v.length)return;const C=j.target;v.some(B=>B.wrapper.contains(C))||T()};document.addEventListener("click",h),document.addEventListener("keydown",j=>{j.key==="Escape"&&T()});const E=({label:j,icon:C,content:O})=>{const B=document.createElement("div");B.className="quote-controls-dropdown";const oe=document.createElement("button");oe.type="button",oe.className="quote-controls-dropdown__toggle",oe.setAttribute("aria-haspopup","true"),oe.setAttribute("aria-expanded","false"),oe.innerHTML=`
      ${C?`<span class="quote-controls-dropdown__icon" aria-hidden="true">${c(C)}</span>`:""}
      <span class="quote-controls-dropdown__label">${c(j)}</span>
      <span class="quote-controls-dropdown__caret" aria-hidden="true">â–¾</span>
    `;const le=document.createElement("div");return le.className="quote-controls-dropdown__menu",le.hidden=!0,le.appendChild(O),B.appendChild(oe),B.appendChild(le),oe.addEventListener("click",xe=>{xe.stopPropagation();const fe=B.classList.contains("is-open");T(),fe||(B.classList.add("is-open"),le.hidden=!1,oe.setAttribute("aria-expanded","true"))}),b(B,oe,le),B},X=document.createElement("iframe");X.className="quote-preview-frame",X.setAttribute("title",i("reservations.quote.previewTitle","Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¹Ø±Ø¶ Ø³Ø¹Ø±")),X.setAttribute("loading","lazy"),X.setAttribute("frameborder","0");const S=document.createElement("div");S.className="quote-preview-zoom-controls",S.innerHTML=`
    <button type="button" class="quote-preview-zoom-btn" data-zoom-out title="${c(i("reservations.quote.zoom.out","ØªØµØºÙŠØ±"))}">âˆ’</button>
    <span class="quote-preview-zoom-value" data-zoom-value>100%</span>
    <button type="button" class="quote-preview-zoom-btn" data-zoom-in title="${c(i("reservations.quote.zoom.in","ØªÙƒØ¨ÙŠØ±"))}">+</button>
    <button type="button" class="quote-preview-zoom-btn" data-zoom-reset title="${c(i("reservations.quote.zoom.reset","Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¶Ø¨Ø·"))}">1:1</button>
  `;const x=document.createElement("div");x.className="quote-preview-zoom-controls quote-preview-drag-controls",x.innerHTML=`
    <button type="button" class="quote-preview-zoom-btn" data-block-drag-toggle title="${c(i("reservations.quote.drag.enable","ÙˆØ¶Ø¹ ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø¨Ù„ÙˆÙƒØ§Øª"))}" aria-label="${c(i("reservations.quote.drag.enable","ÙˆØ¶Ø¹ ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø¨Ù„ÙˆÙƒØ§Øª"))}">
      <span aria-hidden="true">â†•ï¸</span>
    </button>
    <button type="button" class="quote-preview-zoom-btn" data-block-drag-save disabled title="${c(i("reservations.quote.drag.save","ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ÙˆØ§Ø¶Ø¹"))}" aria-label="${c(i("reservations.quote.drag.save","ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ÙˆØ§Ø¶Ø¹"))}">
      <span aria-hidden="true">ðŸ’¾</span>
    </button>
    <button type="button" class="quote-preview-zoom-btn" data-block-drag-reset title="${c(i("reservations.quote.drag.resetBtn","ØªØµÙÙŠØ± Ø§Ù„Ù…ÙˆØ§Ø¶Ø¹"))}" aria-label="${c(i("reservations.quote.drag.resetBtn","ØªØµÙÙŠØ± Ø§Ù„Ù…ÙˆØ§Ø¶Ø¹"))}">
      <span aria-hidden="true">âŸ²</span>
    </button>
  `;const V=document.createElement("div");V.className="quote-preview-zoom-controls quote-preview-align-controls";const G=c(i("reservations.quote.align.customer","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„")),se=c(i("reservations.quote.align.reservation","ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²")),M=c(i("reservations.quote.align.project","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"));V.innerHTML=`
    <select class="quote-preview-align-select" data-align-target>
      <option value="customer">${G}</option>
      <option value="reservation">${se}</option>
      <option value="project">${M}</option>
    </select>
    <div class="quote-preview-align-buttons">
      <button type="button" class="quote-preview-zoom-btn" data-align-value="left" title="${c(i("reservations.quote.align.left","Ù…Ø­Ø§Ø°Ø§Ø© ÙŠØ³Ø§Ø±"))}">â¬…ï¸</button>
      <button type="button" class="quote-preview-zoom-btn" data-align-value="center" title="${c(i("reservations.quote.align.center","Ù…Ø­Ø§Ø°Ø§Ø© ÙˆØ³Ø·"))}">â†”ï¸</button>
      <button type="button" class="quote-preview-zoom-btn" data-align-value="right" title="${c(i("reservations.quote.align.right","Ù…Ø­Ø§Ø°Ø§Ø© ÙŠÙ…ÙŠÙ†"))}">âž¡ï¸</button>
    </div>
    <button type="button" class="quote-preview-zoom-btn" data-layout-export title="${c(i("reservations.quote.align.export","Ù†Ø³Ø® Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©"))}">ðŸ“‹</button>
  `;const Q=document.createElement("div");Q.className="quote-preview-frame-wrapper",Q.appendChild(X),n.innerHTML="";const g=document.createElement("div");g.className="quote-preview-scroll",g.appendChild(Q),n.appendChild(g);const A=document.createElement("div");A.className="quote-preview-status",A.setAttribute("role","status"),A.setAttribute("aria-live","polite"),A.hidden=!0,A.innerHTML=`
    <span class="quote-preview-spinner" data-quote-status-spinner aria-hidden="true"></span>
    <span data-quote-status-text>${c(go("render"))}</span>
    <button type="button" class="quote-preview-status-action" data-quote-status-action hidden></button>
  `,n.appendChild(A);const R=i("reservations.quote.dropdown.drag","Ø§Ù„ØªØ­Ø±ÙŠÙƒ"),$=i("reservations.quote.dropdown.align","Ø§Ù„Ù…Ø­Ø§Ø°Ø§Ø©"),re=E({label:R,icon:"ðŸŽšï¸",content:x}),U=E({label:$,icon:"ðŸ“",content:V});q.appendChild(S),q.appendChild(re),q.appendChild(U),r?.addEventListener("click",async()=>{if(s){r.disabled=!0;try{await Vo()}finally{r.disabled=!1}}});const ee=()=>{hn()||yn(e)};y.forEach(j=>{j?.addEventListener("click",ee)}),m&&!y.includes(m)&&m.addEventListener("click",ee),e.addEventListener("click",j=>{hn()||j.target===e&&yn(e)}),w={modal:e,toggles:t,preview:n,previewScroll:g,previewFrameWrapper:Q,zoomControls:S,zoomValue:S.querySelector("[data-zoom-value]"),previewFrame:X,meta:o,downloadBtn:r,statusIndicator:A,statusText:A.querySelector("[data-quote-status-text]"),statusSpinner:A.querySelector("[data-quote-status-spinner]"),statusAction:A.querySelector("[data-quote-status-action]"),termsInput:a,termsReset:l,statusKind:null,userAdjustedZoom:!1,blockDragToggle:x.querySelector("[data-block-drag-toggle]"),blockDragSave:x.querySelector("[data-block-drag-save]"),blockDragReset:x.querySelector("[data-block-drag-reset]"),alignTarget:V.querySelector("[data-align-target]"),alignButtons:Array.from(V.querySelectorAll("[data-align-value]")),layoutExportBtn:V.querySelector("[data-layout-export]")};const F=S.querySelector("[data-zoom-out]"),L=S.querySelector("[data-zoom-in]"),I=S.querySelector("[data-zoom-reset]");return F?.addEventListener("click",()=>ao(-.1)),L?.addEventListener("click",()=>ao(.1)),I?.addEventListener("click",()=>Xt(1,{markManual:!0})),w.blockDragToggle?.addEventListener("click",()=>Ra(!qt)),w.blockDragSave?.addEventListener("click",Ba),w.blockDragReset?.addEventListener("click",Ka),w.alignTarget?.addEventListener("change",()=>an()),(w.alignButtons||[]).forEach(j=>{j.addEventListener("click",()=>{const C=w.alignTarget?.value||"customer",O=j.dataset.alignValue||"right";za(C,O)})}),w.layoutExportBtn?.addEventListener("click",Qa),on(),Go(),a&&a.addEventListener("input",Hs),l&&l.addEventListener("click",Us),Xt(ze),w}function Xt(e,{silent:t=!1,markManual:n=!1}={}){ze=Math.min(Math.max(e,.25),2.2),n&&w&&(w.userAdjustedZoom=!0),Qo(ze),!t&&w?.zoomValue&&(w.zoomValue.textContent=`${Math.round(ze*100)}%`)}function ao(e){Xt(ze+e,{markManual:!0})}function Qo(e){if(!w?.previewFrame||!w.previewFrameWrapper)return;const t=w.previewFrame,n=w.previewFrameWrapper,o=Number(t.dataset.baseWidth)||794,a=Number(t.dataset.baseHeight)||t.contentDocument?.body?.scrollHeight||1123;t.style.transform=`scale(${e})`,t.style.transformOrigin="top center",Pn()?(n.style.width="100%",n.style.maxWidth="100%",n.style.minWidth="0"):(n.style.width=`${o}px`,n.style.maxWidth=`${o}px`,n.style.minWidth=`${o}px`),n.style.minHeight=`${a}px`,n.style.height=`${a}px`}function Rt(){if(!w?.meta||!s)return;const{meta:e}=w;(s.context||"reservation")==="reservationChecklist"?e.innerHTML=`
      <div class="quote-meta-card">
        <div><span>${c(i("reservations.quote.labels.dateGregorian","Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ"))}</span><strong>${c(s.quoteDateLabel)}</strong></div>
      </div>
    `:e.innerHTML=`
      <div class="quote-meta-card">
        <div><span>${c(i("reservations.quote.labels.number","Ø±Ù‚Ù… Ø¹Ø±Ø¶ Ø³Ø¹Ø±"))}</span><strong>${c(s.quoteNumber)}</strong></div>
        <div><span>${c(i("reservations.quote.labels.dateGregorian","Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ"))}</span><strong>${c(s.quoteDateLabel)}</strong></div>
      </div>
    `}function Hn(){if(!w?.termsInput)return;const e=(s?.terms&&s.terms.length?s.terms:Ie).join(`
`);w.termsInput.value!==e&&(w.termsInput.value=e)}function Hs(e){if(!s)return;const t=dn(e?.target?.value??"");if(t.length){s.terms=t;const n=document.getElementById("reservation-terms");n&&(n.value=e.target.value);const o=document.getElementById("edit-res-terms");o&&(o.value=e.target.value)}else{s.terms=[...Ie],Hn();const n=Ie.join(`
`),o=document.getElementById("reservation-terms");o&&(o.value=n);const a=document.getElementById("edit-res-terms");a&&(a.value=n)}Ae()}function Us(e){if(e?.preventDefault?.(),!s)return;s.terms=[...Ie];const t=document.getElementById("reservation-terms");t&&(t.value=Ie.join(`
`));const n=document.getElementById("edit-res-terms");n&&(n.value=Ie.join(`
`)),Hn(),Ae()}async function Vo(){if(!s)return;pt("export");const t=!Pn()&&Io(),n=rn(),o=null,a=!n&&t?window.open("","_blank"):null;(m=>{if(m)try{m.document.open(),m.document.write(`<!DOCTYPE html><html lang="ar" dir="rtl"><head><meta charset="utf-8"><title>${c(i("reservations.quote.status.exporting","Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ù…Ù„Ù PDF..."))}</title><style>body{font-family:'Tajawal',sans-serif;margin:0;height:100vh;display:flex;align-items:center;justify-content:center;background:#0f172a;color:#f8fafc;text-align:center;padding:24px;} .loader{width:42px;height:42px;border-radius:50%;border:4px solid rgba(248,250,252,0.35);border-top-color:#38bdf8;animation:spin 1s linear infinite;margin:0 auto 18px;}@keyframes spin{to{transform:rotate(360deg);}} h1{margin:0 0 6px;font-size:1.05rem;} p{margin:0;font-size:0.9rem;opacity:0.8;}</style></head><body><div><div class="loader" aria-hidden="true"></div><h1>${c(i("reservations.quote.status.exporting","Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ù…Ù„Ù PDF..."))}</h1><p>${c(i("reservations.quote.status.exportingHint","Ù‚Ø¯ ÙŠØ³ØªØºØ±Ù‚ Ø°Ù„Ùƒ Ø¨Ø¶Ø¹ Ø«ÙˆØ§Ù†ÙØŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±..."))}</p></div></body></html>`),m.document.close()}catch(y){Je("failed to prime download window",y)}})(a);let r=null;const u=i("reservations.quote.errors.browserLimit","ØªØ¹Ø°Ø± Ø¥ØªÙ…Ø§Ù… Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ø³Ø¨Ø¨ Ù‚ÙŠÙˆØ¯ Ø§Ù„Ù…ØªØµÙØ­ØŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø£Ùˆ ØªÙ‚Ù„ÙŠÙ„ Ø­Ø¬Ù… Ø§Ù„Ù…Ø­ØªÙˆÙ‰.");try{await ys(),un("html2pdf ensured");const m=s.context||"reservation",y=m==="reservationChecklist"?No():s.reservation,q=Ho({context:m,reservation:y||s.reservation,customer:s.customer,project:s.project,crewAssignments:s.crewAssignments,totals:s.totals,totalsDisplay:s.totalsDisplay,rentalDays:s.rentalDays,currencyLabel:s.currencyLabel,sections:s.sections,fieldSelections:s.fields,quoteNumber:s.quoteNumber,quoteDate:s.quoteDateLabel,terms:s.terms,checklistType:s.checklistType,checklistNotes:s.checklistNotes,checklistNotesTitle:s.checklistNotesTitle,hideLogo:!!s.hideLogo,hideCompany:!!s.hideCompany,headerOffset:Number(s.headerOffset||0),projectCrew:s.projectCrew,projectExpenses:s.projectExpenses,projectEquipment:s.projectEquipment,projectInfo:s.projectInfo,clientInfo:s.clientInfo,paymentSummary:s.paymentSummary,projectTotals:s.projectTotals,blockOffsets:s.blockOffsets,infoAlignments:s.infoAlignments});r=document.createElement("div"),r.innerHTML=q,Object.assign(r.style,{position:"fixed",top:"0",left:"0",pointerEvents:"none",zIndex:"-1"}),document.body.appendChild(r),wn(r),qn(r),Sn(r),un("export container prepared");const v=r.firstElementChild;if(v){try{const b=typeof ue=="function"?ue():v.getAttribute("data-lang")||"ar",E=s?.context==="reservationChecklist"&&b==="en"?"ltr":"rtl";v.setAttribute("dir",E),v.style.direction=E,v.setAttribute("data-lang",b),v.style.textAlign=""}catch{}v.setAttribute("data-theme","light"),v.classList.remove("dark","dark-mode"),v.style.margin="0",v.style.padding="0",v.style.width="210mm",v.style.maxWidth="210mm",v.style.marginLeft="auto",v.style.marginRight="auto",v.scrollTop=0,v.scrollLeft=0;try{await Yt(v,{context:"export"}),await Uo(120),zo(v)&&await Yt(v,{context:"export"}),await Dt(v),Kn(v),un("layout complete for export document")}catch(b){bn(b,"layoutQuoteDocument",{suppressToast:!0})}}const T=m==="reservationChecklist"?(()=>{const b=s?.reservation?.reservationCode||s?.reservation?.reservationId||s?.reservation?.id||"res",h=s?.checklistType==="crew"?"crew":s?.checklistType==="both"?"equipment-crew":"equipment";return`checklist-${String(b)}-${h}.pdf`})():`quotation-${s.quoteNumber}.pdf`;await Os(v,{filename:T,safariWindowRef:a,mobileWindowRef:o})}catch(m){gn({container:r,safariWindowRef:a,mobileWindowRef:o}),r=null,bn(m,"exportQuoteAsPdf",{toastMessage:u})}finally{r&&r.parentNode&&r.parentNode.removeChild(r),Tt()}}function Un(){const e=Ks();if(e?.modal){if(Nt=!1,ze=1,w&&(w.userAdjustedZoom=!1),Xt(ze,{silent:!0}),s?.context==="reservationChecklist")try{const t=e.modal.querySelector("#reservationQuoteModalLabel"),n=e.modal.querySelector(".quote-preview-sidebar"),o=e.modal.querySelector("[data-quote-terms-editor]");o&&(o.style.display="none");let a=n.querySelector("[data-checklist-controls]");if(!a){a=document.createElement("div"),a.setAttribute("data-checklist-controls","");const l=c(i("reservations.checklist.controls.items","Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª")),r=c(i("reservations.checklist.controls.crew","Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ")),u=c(i("reservations.checklist.controls.both","Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙˆØ§Ù„Ø·Ø§Ù‚Ù… Ø§Ù„ÙÙ†ÙŠ")),m=c(i("reservations.checklist.controls.hideLogo","Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø´Ø¹Ø§Ø±")),y=c(i("reservations.checklist.controls.hideCompany","Ø¥Ø®ÙØ§Ø¡ Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©")),q=c(i("reservations.checklist.controls.notes.title","Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù„Ø³ØªØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)")),v=c(i("reservations.checklist.controls.notes.placeholder","Ø§ÙƒØªØ¨ Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø®Ø§ØµØ© Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ù„Ø³ØªØ©")),T=typeof ue=="function"?ue():"ar",b=c(T==="en"?i("language.toggle.labelAr","ðŸ‡¸ðŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"):i("language.toggle.labelEn","ðŸ‡¬ðŸ‡§ English")),h=c(i("reservations.checklist.controls.lessors.title","ðŸ¢ ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¤Ø¬Ø±")),E=c(i("reservations.checklist.controls.lessors.clear","Ø¥Ø¸Ù‡Ø§Ø± ÙƒÙ„ Ø§Ù„Ù…Ø¤Ø¬Ø±ÙŠÙ†"));a.innerHTML=`
          <div class="quote-meta-card" style="margin-bottom:10px">
            <div style="display:flex;gap:10px;flex-wrap:wrap">
              <label style="display:flex;align-items:center;gap:6px">
                <input type="radio" name="checklist-type" value="items" checked>
                <span data-i18n data-i18n-key="reservations.checklist.controls.items">${l}</span>
              </label>
              <label style="display:flex;align-items:center;gap:6px">
                <input type="radio" name="checklist-type" value="crew">
                <span data-i18n data-i18n-key="reservations.checklist.controls.crew">${r}</span>
              </label>
              <label style="display:flex;align-items:center;gap:6px">
                <input type="radio" name="checklist-type" value="both">
                <span data-i18n data-i18n-key="reservations.checklist.controls.both">${u}</span>
              </label>
            </div>
          </div>
          <div class="quote-meta-card" style="margin-bottom:10px">
            <div style="display:flex;gap:8px;flex-wrap:wrap">
              <button type="button" class="btn btn-sm btn-light" data-checklist-lang>${b}</button>
              <label style="display:flex;align-items:center;gap:6px">
                <input type="checkbox" data-checklist-hide-logo>
                <span data-i18n data-i18n-key="reservations.checklist.controls.hideLogo">${m}</span>
              </label>
              <label style="display:flex;align-items:center;gap:6px">
                <input type="checkbox" data-checklist-hide-company>
                <span data-i18n data-i18n-key="reservations.checklist.controls.hideCompany">${y}</span>
              </label>
            </div>
          </div>
          <div class="quote-terms-editor" data-checklist-notes>
            <label class="quote-terms-editor__label" for="checklist-notes-title-input" data-i18n data-i18n-key="reservations.checklist.controls.notes.titleLabel">${c(i("reservations.checklist.controls.notes.titleLabel","Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª"))}</label>
            <input id="checklist-notes-title-input" class="quote-terms-editor__input" type="text" value="${c(i("reservations.checklist.controls.notes.sectionTitleDefault","Ù…Ù„Ø§Ø­Ø¸Ø§Øª"))}" data-i18n-value-key="reservations.checklist.controls.notes.sectionTitleDefault">
            <label class="quote-terms-editor__label" for="checklist-notes-input" data-i18n data-i18n-key="reservations.checklist.controls.notes.title">${q}</label>
            <textarea id="checklist-notes-input" class="quote-terms-editor__textarea" rows="4" data-i18n-placeholder-key="reservations.checklist.controls.notes.placeholder" placeholder="${v}"></textarea>
          </div>
          <div class="quote-meta-card" data-checklist-lessors hidden>
            <div style="display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:6px;">
              <span data-i18n data-i18n-key="reservations.checklist.controls.lessors.title">${h}</span>
              <button type="button" class="btn btn-sm btn-outline-secondary" data-lessor-clear>${E}</button>
            </div>
            <div data-lessor-options style="display:flex;flex-direction:column;gap:6px;"></div>
          </div>
        `,n.prepend(a),a.querySelectorAll('input[name="checklist-type"]').forEach(g=>{g.addEventListener("change",()=>{const A=a.querySelector('input[name="checklist-type"]:checked')?.value||"items";s.checklistType=A==="crew"||A==="both"?A:"items";const R=new Set(["customerInfo","reservationInfo","projectInfo","notes"]);if(s.checklistType==="crew"?R.add("crew"):s.checklistType==="both"?(R.add("items"),R.add("crew")):R.add("items"),s.sections=R,t){const $=ue?.()||"ar",re=s.checklistType==="crew"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ":s.checklistType==="both"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙˆØ§Ù„Ø·Ø§Ù‚Ù… Ø§Ù„ÙÙ†ÙŠ":"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",U=s.checklistType==="crew"?"Crew List":s.checklistType==="both"?"Equipment & Crew List":"Equipment List";t.textContent=$==="en"?U:re}Mt(),Rt(),Ae()})});const S=a.querySelector("#checklist-notes-input"),x=a.querySelector("#checklist-notes-title-input"),V=()=>{try{const g=ue?.()||"ar",A=g==="en"?"ltr":"rtl",R=g==="en"?"left":"right";S&&(S.setAttribute("dir",A),S.style.textAlign=R),x&&(x.setAttribute("dir",A),x.style.textAlign=R)}catch{}};V();try{const g=()=>V();document.addEventListener("language:changed",g),a._onLangChanged=g}catch{}S.addEventListener("input",g=>{s.checklistNotes=String(g.target.value||""),Ae()}),x.addEventListener("input",g=>{s.checklistNotesTitle=String(g.target.value||""),Ae()});const G=a.querySelector("[data-checklist-lang]");if(G){const g=()=>{const A=ue?.()||"ar";G.textContent=A==="ar"?"ðŸ‡¬ðŸ‡§ English":"ðŸ‡¸ðŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"};g(),G.addEventListener("click",()=>{const R=(ue?.()||"ar")==="ar"?"en":"ar";try{sa?.(R)}catch{}if(g(),V(),t){const $=ue?.()||"ar",re=s.checklistType,U=re==="crew"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ":re==="both"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙˆØ§Ù„Ø·Ø§Ù‚Ù… Ø§Ù„ÙÙ†ÙŠ":"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",ee=re==="crew"?"Crew List":re==="both"?"Equipment & Crew List":"Equipment List";t.textContent=$==="en"?ee:U}Mt(),Rt(),Ae()})}const se=a.querySelector("[data-checklist-hide-logo]"),M=a.querySelector("[data-checklist-hide-company]");(()=>{se&&(se.checked=!!s.hideLogo),M&&(M.checked=!!s.hideCompany)})(),se?.addEventListener("change",g=>{s.hideLogo=!!g.target.checked,Ae()}),M?.addEventListener("change",g=>{s.hideCompany=!!g.target.checked,Ae()})}e.checklistControls=a,e.checklistLessorContainer=a.querySelector("[data-checklist-lessors]"),e.checklistLessorOptionsHost=a.querySelector("[data-lessor-options]"),Gt(),t&&(t.textContent=s.checklistType==="crew"?"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ":"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª");try{e.previewFrame?.setAttribute("title","Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù„Ø³ØªØ©")}catch{}}catch{}Mt(),Rt(),Hn(),Ae(),Ya(e.modal)}}async function tr({reservation:e,customer:t,project:n}){if(!e){ct(i("reservations.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø²"));return}await Bn();const o=cn(e),{totalsDisplay:a,totals:l,rentalDays:r}=Rn(e,o,n),u=i("reservations.create.summary.currency","SR"),y=(b=>{if(!b)return"1";const E=[b.reservationCode,b.reservation_code,b.reservationId,b.reservation_id,b.id].find(x=>x!=null&&String(x).trim()!==""),X=N(String(E??"1"));return X.replace(/\D+/g,"")||X||"1"})(e),q=Number.parseInt(y,10)||1,v=new Date,T=ka();s={context:"reservation",reservation:e,customer:t,project:n,crewAssignments:o,totals:l,totalsDisplay:a,rentalDays:r,currencyLabel:u,projectCrew:[],projectExpenses:[],projectEquipment:[],sections:new Set(nn("reservation").filter(b=>b.defaultSelected).map(b=>b.id)),sectionExpansions:sn("reservation"),fields:Pt("reservation"),terms:T,quoteSequence:q,quoteNumber:y,quoteDate:v,quoteDateLabel:Mn(v),sequenceCommitted:!1},It=!1,On(s),En(s),Tn(s),Un();try{kn()}catch{}}async function nr({reservation:e,customer:t,project:n}){if(!e){ct(i("reservations.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø²"));return}await Bn();const o=cn(e),{totalsDisplay:a,totals:l,rentalDays:r}=Rn(e,o,n),u=i("reservations.create.summary.currency","SR"),m=new Date;s={context:"reservationChecklist",reservation:e,customer:t,project:n,crewAssignments:o,totals:l,totalsDisplay:a,rentalDays:r,currencyLabel:u,checklistType:"items",checklistNotes:"",projectCrew:[],projectExpenses:[],projectEquipment:[],sections:new Set(["customerInfo","reservationInfo","projectInfo","notes","items"]),sectionExpansions:sn("reservationChecklist"),fields:Pt("reservationChecklist"),terms:[],quoteDate:m,quoteDateLabel:Mn(m),sequenceCommitted:!1},s.checklistLessorFilter=new Set,s.checklistLessorOptions=[],s.checklistEquipmentLookup=Cn(),It=!1,Eo(),On(s),En(s),Tn(s),Un();try{kn()}catch{}}async function or({project:e}){if(!e){ct(i("projects.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"));return}await Bn();let t=oo(e);const{project:n}=t;if(!n){ct(i("projects.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"));return}try{(!Array.isArray(t.equipmentItems)||t.equipmentItems.length===0)&&n?.id!=null&&(await la({project_id:n.id}),t=oo(n))}catch(m){console.warn("[reservationPdf] refreshReservationsForProject failed, proceeding with snapshot/state",m)}const a=(m=>{if(!m)return"1";const q=[m.projectCode,m.project_code,m.code,m.id].find(b=>b!=null&&String(b).trim()!==""),v=N(String(q??"1"));return v.replace(/\D+/g,"")||v||"1"})(n),l=Number.parseInt(a,10)||1,r=new Date,u=[...Sa];s={context:"project",reservation:null,customer:t.customer,project:n,technicians:t.crew||[],clientInfo:t.clientInfo,projectInfo:t.projectInfo,projectCrew:t.crew,projectExpenses:t.expenses,projectEquipment:t.equipment,equipmentItems:t.equipmentItems||[],crewAssignments:t.crewAssignments||[],totals:t.totals,projectTotals:t.projectTotals,totalsDisplay:t.totalsDisplay,rentalDays:t.projectDurationDays,currencyLabel:t.currencyLabel,sections:new Set(nn("project").filter(m=>m.defaultSelected).map(m=>m.id)),sectionExpansions:sn("project"),fields:Pt("project"),terms:u,quoteSequence:l,quoteNumber:a,quoteDate:r,quoteDateLabel:Mn(r),sequenceCommitted:!1,paymentSummary:t.paymentSummary,projectNotes:t.notes,paymentHistory:t.paymentHistory},It=!1,On(s),En(s),Tn(s),Un();try{kn()}catch{}}function zs(e="reservation"){return e==="project"?[{value:"projectCustomer",label:i("projects.quote.sections.customer","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„")},{value:"projectDetails",label:i("projects.quote.sections.project","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹")}]:[{value:"customer",label:i("reservations.quote.sections.customer","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„")},{value:"reservation",label:i("reservations.quote.sections.reservation","ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²")},{value:"project",label:i("reservations.quote.sections.project","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹")}]}function Go(){if(!w?.alignTarget)return;const e=s?.context||"reservation",t=zs(e),n=w.alignTarget,o=n.value;n.innerHTML=t.map(a=>`<option value="${c(a.value)}">${c(a.label)}</option>`).join(""),t.some(a=>a.value===o)?n.value=o:n.value=t[0]?.value||"",an()}export{tr as a,nr as b,or as e,Zs as g,po as r,er as s};
