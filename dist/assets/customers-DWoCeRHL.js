import{e as N,h as H,t as i,k as D,n as L,b,A as B,j as l,o as U,s as k}from"./auth-1jMV0rNp.js";let u=null,E=!1,g="";const R=N()||{};let v=(R.customers||[]).map(y);function y(t={}){if(!t||typeof t!="object")return{id:"",full_name:"",customerName:"",name:"",phone:"",email:"",address:"",company:"",notes:"",created_at:null,updated_at:null};const e=t.id??t.customerId??t.reservationId??t.customerID,n=t.full_name??t.customerName??t.name??"",s=typeof n=="string"?n.trim():String(n||"").trim();return{id:e!=null?String(e):"",full_name:s,customerName:s,name:s,phone:t.phone??t.phoneNumber??"",email:t.email??"",address:t.address??"",company:t.company??t.companyName??"",notes:t.notes??"",created_at:t.created_at??null,updated_at:t.updated_at??null}}function M(){document.dispatchEvent(new CustomEvent("customers:changed"))}function p(){return v}function I(t){v=Array.isArray(t)?t.map(y):[],k({customers:v})}function f(){return{form:document.getElementById("customer-form"),idInput:document.getElementById("customer-id"),nameInput:document.getElementById("customer-name"),phoneInput:document.getElementById("customer-phone"),emailInput:document.getElementById("customer-email"),addressInput:document.getElementById("customer-address"),companyInput:document.getElementById("customer-company"),notesInput:document.getElementById("customer-notes"),submitBtn:document.getElementById("submit-btn"),cancelBtn:document.getElementById("customer-cancel-btn")}}function S(t="add"){const{submitBtn:e}=f();if(!e)return;const n=t==="update"?"customers.form.actions.update":"customers.form.actions.submit",s=t==="update"?"ðŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„":"âž• Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„";e.textContent=i(n,s)}function C(t){const{cancelBtn:e}=f();e&&(t?e.classList.remove("d-none"):e.classList.add("d-none"),e.textContent=i("customers.form.actions.cancel","Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„"))}function T(){const t=!!u;S(t?"update":"add"),C(t)}function _(){const{form:t,idInput:e,phoneInput:n}=f();t?.reset(),e&&(e.value=""),n&&(n.value=n.value.trim()),u=null,S("add"),C(!1)}function x(t){const{idInput:e,nameInput:n,phoneInput:s,emailInput:o,addressInput:r,companyInput:c,notesInput:d}=f();!t||!n||!s||(e&&(e.value=t.id),n.value=t.full_name||"",s.value=L(t.phone||""),o&&(o.value=t.email||""),r&&(r.value=t.address||""),c&&(c.value=t.company||""),d&&(d.value=t.notes||""),u=t.id,S("update"),C(!0))}function P(){const{idInput:t,nameInput:e,phoneInput:n,emailInput:s,addressInput:o,companyInput:r,notesInput:c}=f();if(!e||!n)return null;const d=e.value.trim(),a=L(n.value.trim());return n.value=a,!d||!a?(l(i("customers.toast.missingFields","ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø§Ø³Ù… ÙˆØ±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ"),"error"),null):{payload:{full_name:d,phone:a,email:s?.value.trim()||"",address:o?.value.trim()||"",company:r?.value.trim()||"",notes:c?.value.trim()||""},id:t?.value||u||""}}async function F({showToastOnError:t=!0}={}){E=!0,g="",m();try{const e=await b("/customers/"),n=Array.isArray(e?.data)?e.data.map(y):[];I(n)}catch(e){g=e instanceof B?e.message:i("customers.toast.fetchFailed","ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡"),t&&l(g,"error")}finally{E=!1,m()}}async function V(t){t.preventDefault();const e=P();if(!e)return;const{payload:n}=e,s=!!u;try{if(s){const o=u,r=await b(`/customers/?id=${encodeURIComponent(o)}`,{method:"PATCH",body:n}),c=y(r?.data),d=p().map(a=>String(a.id)===String(o)?c:a);I(d),l(i("customers.toast.updateSuccess","ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­"))}else{const o=await b("/customers/",{method:"POST",body:n}),r=y(o?.data),c=[...p(),r];I(c),l(i("customers.toast.createSuccess","ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­"))}m(),_(),M()}catch(o){const r=o instanceof B?o.message:i("customers.toast.submitFailed","Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„");l(r,"error")}}async function j(t){const e=t.target;if(e instanceof HTMLElement){if(e.classList.contains("customer-delete-btn")){if(!D()){U();return}const n=e.dataset.id;if(!confirm(i("customers.toast.deleteConfirm","âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„ØŸ")))return;try{await b(`/customers/?id=${encodeURIComponent(n)}`,{method:"DELETE"});const s=p().filter(o=>String(o.id)!==String(n));I(s),m(),String(u)===String(n)&&_(),l(i("customers.toast.deleteSuccess","ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ù…ÙŠÙ„")),M()}catch(s){const o=s instanceof B?s.message:i("customers.toast.deleteFailed","ØªØ¹Ø°Ø± Ø­Ø°Ù Ø§Ù„Ø¹Ù…ÙŠÙ„ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø¬Ø¯Ø¯Ø§Ù‹");l(o,"error")}return}if(e.classList.contains("customer-edit-btn")){const n=e.dataset.id,s=p().find(o=>String(o.id)===String(n));if(!s)return;x(s)}}}function O(t){const e=t.target.value.trim().toLowerCase(),s=p().filter(r=>{const c=r.full_name?.toLowerCase()||"",d=r.phone?.toLowerCase()||"",a=r.company?.toLowerCase()||"";return c.includes(e)||d.includes(e)||a.includes(e)}),o=e?i("customers.table.noResults","Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø©"):void 0;m(s,{emptyMessage:o})}function q(){const{form:t,cancelBtn:e}=f();t&&t.addEventListener("submit",V),e&&e.addEventListener("click",()=>{_()});const n=document.getElementById("customers-table");n&&n.addEventListener("click",j);const s=document.getElementById("search-customer-input");s&&s.addEventListener("input",O)}document.addEventListener("DOMContentLoaded",()=>{q(),m(),T(),F()});document.addEventListener("language:changed",()=>{T(),m()});document.addEventListener("customers:refreshRequested",()=>{F({showToastOnError:!1}),T()});document.addEventListener(H.USER_UPDATED,()=>{m()});function m(t,e={}){const n=Array.isArray(t),s=n?t:p(),o=document.getElementById("customers-table");if(!o)return;if(o.innerHTML="",!n){if(E){o.innerHTML=`<tr><td colspan='5'>${i("customers.table.loading","Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...")}</td></tr>`;return}if(g){o.innerHTML=`<tr><td colspan='5' class='text-danger'>${g}</td></tr>`;return}}if(s.length===0){const a=e.emptyMessage||i("customers.table.empty","Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù…Ù„Ø§Ø¡");o.innerHTML=`<tr><td colspan='5'>${a}</td></tr>`;return}const r=i("customers.actions.edit","âœï¸ ØªØ¹Ø¯ÙŠÙ„"),c=i("customers.actions.delete","ðŸ—‘ï¸ Ø­Ø°Ù"),d=D();s.forEach(a=>{const $=u&&String(u)===String(a.id),h=document.createElement("tr");$&&h.classList.add("table-info");const A=[`<button class="btn btn-sm btn-warning customer-edit-btn" data-id="${a.id}">${r}</button>`];d&&A.push(`<button class="btn btn-sm btn-danger customer-delete-btn" data-id="${a.id}">${c}</button>`),h.innerHTML=`
      <td><a href="customer.html?id=${a.id}" class="text-decoration-none">${a.full_name}</a></td>
      <td>${L(a.phone)}</td>
      <td>${a.company||""}</td>
      <td class="table-notes-cell">${a.notes||"â€”"}</td>
      <td class="table-actions-cell">
        <div class="table-action-buttons">
          ${A.join("")}
        </div>
      </td>
    `,o.appendChild(h)})}export{m as r};
