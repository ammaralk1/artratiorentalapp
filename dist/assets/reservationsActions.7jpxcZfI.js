import{v as w,w as h,j as o,t as s}from"./auth.BqwfmscP.js";import{s as F,r as R}from"./equipment.rqy6sxA-.js";import{s as A}from"./state.BUFhj3Lf.js";import{g as u,f as S,w as d,a as I,M as j,N as q,r as C}from"./reservationsService.DC1_tqLc.js";function v(){const t=()=>{F(),R(),A()};if(typeof window<"u"){if(typeof window.requestIdleCallback=="function"){window.requestIdleCallback(t,{timeout:200});return}if(typeof window.requestAnimationFrame=="function"){window.requestAnimationFrame(t);return}}t()}let m=!1,p=null;function P(t){if(!t||typeof t!="object")return"";const c=Object.entries(t).filter(([i,e])=>e!=null).map(([i,e])=>[i,String(e)]);return c.length===0?"":JSON.stringify(c.sort(([i],[e])=>i.localeCompare(e)))}async function N(t={}){const{suppressError:c=!0,params:i=null,force:e=!1}=t??{},r=P(i);if(!e&&m&&u().length>0&&r===p)return u();try{const n=await C(i||{});return m=!0,p=r,n}catch(n){if(console.error("âŒ [reservationsActions] Failed to load reservations from API",n),!c)throw n;return u()}}async function L(t,{onAfterChange:c}={}){if(!w())return h(),!1;const e=u()[t];if(!e)return o(s("reservations.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø²")),!1;const r=e.id||e.reservationId;if(!r)return o(s("reservations.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø²")),!1;try{return await S(r),v(),c?.({type:"deleted",reservation:e}),o(s("reservations.toast.deleted","ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ø­Ø¬Ø²")),!0}catch(n){console.error("âŒ [reservationsActions] deleteReservation failed",n);const f=d(n)?n.message:s("reservations.toast.deleteFailed","ØªØ¹Ø°Ø± Ø­Ø°Ù Ø§Ù„Ø­Ø¬Ø²ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰");return o(f,"error"),!1}}async function M(t,{onAfterChange:c}={}){const e=u()[t];if(!e)return o(s("reservations.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø²")),!1;const r=e.id||e.reservationId;if(!r)return o(s("reservations.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø²")),!1;const{projectLinked:n}=I(e);if(n)return o(s("reservations.toast.confirmBlockedByProject","âš ï¸ Ø­Ø§Ù„Ø© Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø² ØªØªØ­ÙƒÙ… Ø¨Ù‡Ø§ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ù…Ø±ØªØ¨Ø· ÙˆÙ„Ø§ ÙŠÙ…ÙƒÙ† ØªØ£ÙƒÙŠØ¯Ù‡ Ù…Ù† Ù‡Ù†Ø§"),"info"),!1;try{const f=await j(r);return v(),c?.({type:"confirmed",reservation:f}),o(s("reservations.toast.confirmed","âœ… ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø²")),!0}catch(f){console.error("âŒ [reservationsActions] confirmReservation failed",f);const a=d(f)?f.message:s("reservations.toast.confirmFailed","ØªØ¹Ø°Ø± ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø²ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰");return o(a,"error"),!1}}async function $(t,c="",{onAfterChange:i}={}){const r=u()[t];if(!r)return o(s("reservations.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø²")),!1;const n=r.id||r.reservationId;if(!n)return o(s("reservations.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø²")),!1;if(String(r.status||"").toLowerCase()==="completed")return o(s("reservations.toast.alreadyClosed","âœ… Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø² Ù…ØºÙ„Ù‚ Ù…Ø³Ø¨Ù‚Ø§Ù‹")),!1;try{let a=c||"";const l=r.notes?String(r.notes).trim():"";if(l&&a){const g=s("reservations.closeModal.notePrefix","Ù…Ù„Ø§Ø­Ø¸Ø© Ø¥ØºÙ„Ø§Ù‚");a=`${l}
${g}: ${a}`}else!l&&a||(a=l);const y=await q(n,a);return v(),i?.({type:"closed",reservation:y}),o(s("reservations.toast.closed","âœ… ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø­Ø¬Ø²")),!0}catch(a){console.error("âŒ [reservationsActions] closeReservation failed",a);const l=d(a)?a.message:s("reservations.toast.closeFailed","ØªØ¹Ø°Ø± Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø­Ø¬Ø²ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰");return o(l,"error"),!1}}export{M as a,$ as c,L as d,N as e};
