import{d as w,n as B,h as st,b as P,A as ce,t as m,a as ot,m as rt,c as ct,i as lt,l as dt,p as ne,q as ut,v as Fe,j as g,w as ft}from"./auth.CS33KJXJ.js";const mt="modulepreload",pt=function(e,t){return new URL(e,t).href},Ce={},fn=function(t,n,a){let s=Promise.resolve();if(n&&n.length>0){let c=function(l){return Promise.all(l.map(f=>Promise.resolve(f).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};const r=document.getElementsByTagName("link"),i=document.querySelector("meta[property=csp-nonce]"),d=i?.nonce||i?.getAttribute("nonce");s=c(n.map(l=>{if(l=pt(l,a),l in Ce)return;Ce[l]=!0;const f=l.endsWith(".css"),p=f?'[rel="stylesheet"]':"";if(a)for(let h=r.length-1;h>=0;h--){const b=r[h];if(b.href===l&&(!f||b.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${p}`))return;const u=document.createElement("link");if(u.rel=f?"stylesheet":mt,f||(u.as="script"),u.crossOrigin="",u.href=l,d&&u.setAttribute("nonce",d),document.head.appendChild(u),f)return new Promise((h,b)=>{u.addEventListener("load",h),u.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${l}`)))})}))}function o(r){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=r,window.dispatchEvent(i),!i.defaultPrevented)throw r}return s.then(r=>{for(const i of r||[])i.status==="rejected"&&o(i.reason);return t().catch(o)})},ht=w()||{};let $=(ht.technicians||[]).map(he);function G(){return $}function k(e){return $=Array.isArray(e)?e.map(he):[],st({technicians:$}),typeof window<"u"&&typeof window.dispatchEvent=="function"?(window.dispatchEvent(new CustomEvent("technicians:updated")),typeof document<"u"&&typeof document.dispatchEvent=="function"&&document.dispatchEvent(new CustomEvent("technicians:updated"))):typeof dispatchEvent=="function"&&dispatchEvent(new CustomEvent("technicians:updated")),$}async function ze(e={}){const t=new URLSearchParams;Object.entries(e).forEach(([i,d])=>{d!=null&&d!==""&&t.set(i,String(d))});const n=t.toString(),a=await P(`/technicians/${n?`?${n}`:""}`),s=a?.data??a;let o=[];Array.isArray(s)?o=s:s&&typeof s=="object"&&(Array.isArray(s.items)?o=s.items:Array.isArray(s.results)?o=s.results:Array.isArray(s.data)?o=s.data:Array.isArray(s.records)&&(o=s.records));const r=o.map(ie);return k(r)}async function De(e){const t=await P("/technicians/",{method:"POST",body:e}),n=ie(t?.data??{});return k([...$,n]),n}async function me(e,t){const n=await P(`/technicians/?id=${encodeURIComponent(e)}`,{method:"PATCH",body:t}),a=ie(n?.data??{}),s=$.map(o=>String(o.id)===String(e)?a:o);return k(s),a}async function $e(e){await P(`/technicians/?id=${encodeURIComponent(e)}`,{method:"DELETE"}),k($.filter(t=>String(t.id)!==String(e)))}function pe({name:e,phone:t,email:n,role:a,department:s,dailyWage:o,dailyTotal:r,status:i,notes:d,active:c=!0}){return{full_name:e??"",phone:t??"",email:n??null,specialization:a??"",department:s??null,daily_wage:o??0,daily_total:r??null,status:i??"available",notes:d??null,active:c?1:0}}function ie(e={}){return Me({id:e.id,full_name:e.full_name,phone:e.phone,email:e.email,specialization:e.specialization,department:e.department,daily_wage:e.daily_wage,daily_total:e.daily_total,status:e.status,notes:e.notes,active:e.active})}function he(e={}){return Me(e)}function Me(e={}){const t=e.id??e.technicianId??e.technician_id??e.ID??e.uuid??e._id??null,n=e.full_name??e.name??e.fullName??"",a=e.phone??"",s=e.email??null,o=e.specialization??e.role??e.position??"",r=e.department??e.team??"",i=we(e.daily_wage??e.dailyWage??e.wage??e.rate??0),d=we(e.daily_total??e.dailyTotal??e.total??e.total_wage??i),c=Ne(e.baseStatus??e.status??"available"),l=Ne(e.status??e.baseStatus??"available"),f=e.notes??"",p=e.active!=null?!!e.active:!0;return{id:t!=null?String(t):"",name:n,phone:a,email:s,role:o,department:r,dailyWage:i,dailyTotal:d,status:l,baseStatus:c,notes:f,active:p}}function we(e){const t=Number.parseFloat(B(String(e??"0")));return Number.isFinite(t)?Number(t.toFixed(2)):0}function Ne(e){switch(String(e??"").trim().toLowerCase()){case"available":case"Ù…ØªØ§Ø­":return"available";case"busy":case"Ù…Ø´ØºÙˆÙ„":case"Ù‚ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„":return"busy";case"leave":case"Ø¥Ø¬Ø§Ø²Ø©":case"Ø®Ø§Ø±Ø¬ Ø§Ù„Ø®Ø¯Ù…Ø©":return"leave";case"inactive":case"Ù…ØªÙˆÙ‚Ù":return"inactive";default:return"available"}}function Q(e){return e instanceof ce}const mn=Object.freeze(Object.defineProperty({__proto__:null,buildTechnicianPayload:pe,createTechnicianApi:De,deleteTechnicianApi:$e,getTechniciansState:G,isApiError:Q,mapLegacyTechnician:he,mapTechnicianFromApi:ie,refreshTechniciansFromApi:ze,setTechniciansState:k,updateTechnicianApi:me},Symbol.toStringTag,{value:"Module"}));function W(e){return B(String(e||"")).trim().toLowerCase()}function gt(e){const t=Number.parseFloat(B(String(e??"1")));return!Number.isFinite(t)||t<=0||t>50?1:Math.max(1,Math.round(t))}function N(e){const t=String(e??"").trim().toLowerCase();return t||""}function xe(){const{packages:e=[]}=w();return Array.isArray(e)?e.filter(t=>t&&typeof t=="object"):[]}function bt(e){const t=N(e);return t&&xe().find(a=>{const s=N(a?.id??a?.packageId??a?.package_id)===t,o=N(a?.package_code??a?.code)===t;return s||o})||null}function ge(e){if(!e||typeof e!="object")return[];const t=[],n=[];Array.isArray(e.items)&&n.push(...e.items),Array.isArray(e.packageItems)&&n.push(...e.packageItems),Array.isArray(e.bundleItems)&&n.push(...e.bundleItems),Array.isArray(e.barcodes)&&n.push(...e.barcodes.map(i=>({barcode:i}))),n.forEach(i=>{if(!i)return;if(typeof i=="string"||typeof i=="number"){const u=W(i);if(!u)return;t.push({equipmentId:null,barcode:u,normalizedBarcode:u,qty:1,price:0,cost:0,desc:""});return}if(typeof i!="object")return;const d=W(i.barcode??i.equipmentBarcode??i.code??i.serial??i.serialNumber??i.serial_number),c=[i.equipmentId,i.equipment_id,i.itemId,i.item_id,i.id].find(u=>u!=null&&u!==""),l=[i.unit_price,i.unitPrice,i.price,i.daily_rate].find(u=>Number.isFinite(Number(u))),f=[i.unit_cost,i.unitCost,i.cost,i.rental_cost,i.rentalCost,i.purchase_price,i.purchasePrice].find(u=>Number.isFinite(Number(u))),p=[i.quantity,i.qty,i.count].find(u=>u!=null&&String(u).trim()!=="");t.push({equipmentId:c!=null?String(c):null,barcode:i.barcode??i.equipmentBarcode??i.code??i.serial??i.serialNumber??"",normalizedBarcode:d,qty:gt(p),price:l!=null?Number(l):0,cost:f!=null?Number(f):0,desc:i.description??i.desc??i.name??"",image:i.image??i.imageUrl??i.img??null})});const a=new Map,{equipment:s=[]}=w()||{},o=new Map,r=new Map;return(Array.isArray(s)?s:[]).forEach(i=>{if(!i||typeof i!="object")return;[i.id,i.equipment_id,i.equipmentId,i.item_id,i.itemId].map(l=>l!=null?String(l):"").filter(Boolean).forEach(l=>{o.has(l)||o.set(l,i)});const c=W(i.barcode);c&&!r.has(c)&&r.set(c,i)}),t.forEach(i=>{if(i.equipmentId&&o.has(i.equipmentId)){const d=o.get(i.equipmentId);if(d){if(i.desc||(i.desc=d.desc||d.description||d.name||""),i.barcode||(i.barcode=d.barcode||""),i.price==null||i.price===0){const c=d.price??d.unit_price,l=Number(c);Number.isFinite(l)&&l>=0&&l<1e6&&(i.price=l)}if(i.cost==null||i.cost===0){const c=d.cost??d.unit_cost??d.unitCost??d.rental_cost??d.purchase_price,l=Number(c);Number.isFinite(l)&&l>=0&&l<1e6&&(i.cost=l)}i.image||(i.image=d.image||d.imageUrl||d.img||null)}}else if(i.normalizedBarcode&&r.has(i.normalizedBarcode)){const d=r.get(i.normalizedBarcode);if(d){if(i.desc||(i.desc=d.desc||d.description||d.name||""),i.barcode||(i.barcode=d.barcode||""),i.price==null||i.price===0){const c=d.price??d.unit_price,l=Number(c);Number.isFinite(l)&&l>=0&&l<1e6&&(i.price=l)}if(i.cost==null||i.cost===0){const c=d.cost??d.unit_cost??d.unitCost??d.rental_cost??d.purchase_price,l=Number(c);Number.isFinite(l)&&l>=0&&l<1e6&&(i.cost=l)}i.image||(i.image=d.image||d.imageUrl||d.img||null)}}}),t.forEach(i=>{const d=i.normalizedBarcode||(i.barcode?W(i.barcode):""),c=d||(i.equipmentId?`id:${i.equipmentId}`:null);if(!c)return;if(!a.has(c)){a.set(c,{...i,normalizedBarcode:d});return}const l=a.get(c);l.qty+=i.qty,!l.price&&i.price&&(l.price=i.price),!l.cost&&i.cost&&(l.cost=i.cost),!l.desc&&i.desc&&(l.desc=i.desc),!l.image&&i.image&&(l.image=i.image)}),Array.from(a.values())}function yt(e){if(!e||typeof e!="object")return 0;const t=[e.price,e.totalPrice,e.total_price,e.packagePrice,e.package_price];for(const a of t){const s=Number(a);if(Number.isFinite(s))return s}return ge(e).reduce((a,s)=>a+(s.price||0)*(s.qty||1),0)}function It(e){if(!e||typeof e!="object")return"";const n=[e.displayName,e.display_name,e.name,e.title,e.label,e.package_name,e.packageName,e.package_name_ar,e.packageNameAr,e.package_name_en,e.packageNameEn,e.name_ar,e.nameAr,e.name_en,e.nameEn,e.label_ar,e.labelAr,e.label_en,e.labelEn].find(a=>a!=null&&String(a).trim()!=="");return n?String(n):""}function St(){return xe().map(t=>{const n=N(t?.id??t?.packageId??t?.package_id??t?.code),a=It(t)||n||"package",s=yt(t);return{id:n,name:a,price:s,code:t?.package_code??t?.code??n,items:ge(t),raw:t}}).filter(t=>t.id)}function vt(e){const t=W(e);return t?St().filter(n=>n.items.some(a=>a.normalizedBarcode===t)):[]}function _t(e){return ge(e).map(n=>({equipmentId:n.equipmentId,barcode:n.barcode,normalizedBarcode:n.normalizedBarcode,qty:n.qty,price:n.price,cost:n.cost??0,desc:n.desc,image:n.image??null}))}let j=[],Re=[],je=[],Ue="single";function pn(){return j}function hn(e){j=Array.isArray(e)?e:[]}function gn(e){j=[...j,e]}function bn(e){Number.isInteger(e)&&e>=0&&(j=j.filter((t,n)=>n!==e))}function yn(){return Re}function In(e){Re=Array.isArray(e)?e:[]}function Sn(){return je}function vn(e){je=Array.isArray(e)?e:[]}function _n(e){}function An(){return Ue==="package"?"package":"single"}function En(e){Ue=e==="package"?"package":"single"}function Tn(e){if(!e)return{date:"",time:""};const t=String(e).trim();if(!t)return{date:"",time:""};let n=t;n.includes(" ")&&!n.includes("T")&&(n=n.replace(" ","T"));const[a="",s=""]=n.split("T"),o=a?a.slice(0,10):"",r=s.match(/(\d{1,2}:\d{2})/);let i="";if(r){const[d="00",c="00"]=r[0].split(":");i=`${d.padStart(2,"0")}:${c.padStart(2,"0")}`}return{date:o,time:i}}function Bn(e,t){if(!e)return"";const n=t&&t.length?t:"00:00";return`${e}T${n}`}function A(e){return B(String(e||"")).trim().toLowerCase()}const At=864e13;function I(e){if(!e&&e!==0)return null;if(e instanceof Date){const a=e.getTime();return Number.isNaN(a)?null:new Date(a)}if(typeof e=="number"){if(!Number.isFinite(e))return null;const a=new Date(e);return Number.isNaN(a.getTime())?null:a}let t=String(e??"").trim();if(!t)return null;if(/^\d+$/.test(t)){const a=Number(t);if(Number.isFinite(a)){const s=new Date(a);if(!Number.isNaN(s.getTime()))return s}}if(!t.includes("T")&&t.includes(" ")){const a=t.indexOf(" ");t=`${t.slice(0,a)}T${t.slice(a+1).trimStart()}`}else t.includes(" ")&&(t=t.replace(" ","T"));const n=new Date(t);if(!Number.isNaN(n.getTime()))return n;if(!t.endsWith("Z")&&/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}(:\d{2})?$/.test(t)){const a=new Date(`${t}Z`);if(!Number.isNaN(a.getTime()))return a}return null}function Cn(e,t,n,a=null){if(!e||!t||!n)return!1;const s=I(t),o=I(n);if(!s||!o||s>=o)return!1;const r=A(e);if(!r)return!1;const i=w()||{},d=Array.isArray(i.reservations)?i.reservations:[],c=Array.isArray(i.maintenance)?i.maintenance:[],l=Array.isArray(i.equipment)?i.equipment:[],f=qt(l),p=Z(a);return d.some(h=>{if(!h||J(h,p)||!h.start||!h.end)return!1;const b=String(h?.status||h?.reservationStatus||"").toLowerCase();if(b==="cancelled"||b==="canceled")return!1;const y=I(h.start),S=I(h.end);return!y||!S||!(y<o&&S>s)?!1:Oe(h,r)})?!0:c.some(h=>{if(!Ct(h)||!Nt(h,f).has(r))return!1;const{start:y,end:S}=Lt(h);if(!y&&!S)return!0;const F=y??new Date(0),z=S??new Date(At);return F<o&&z>s})}function Et(e,t,n,a=null){const s=N(e);if(!s||!t||!n)return!1;const o=I(t),r=I(n);if(!o||!r||o>=r)return!1;const i=w()||{},d=Array.isArray(i.reservations)?i.reservations:[],c=Z(a);return d.some(l=>{if(!l?.start||!l?.end||J(l,c))return!1;const f=String(l?.status||l?.reservationStatus||"").toLowerCase();if(f==="cancelled"||f==="canceled")return!1;const p=I(l.start),u=I(l.end);return!p||!u||!(p<r&&u>o)?!1:Tt(l,s)})}function wn(e,t,n,a=null){const s=A(e);if(!s||!t||!n)return[];const o=vt(s);return o.length?o.filter(r=>Et(r.id,t,n,a)):[]}function Ve(e){const t=[];return!e||typeof e!="object"||["items","equipment","packages","packageItems","package_items","reservedItems","reserved_items"].forEach(a=>{const s=e[a];Array.isArray(s)&&s.length&&t.push(s)}),t}function Oe(e,t){if(!t||!e||typeof e!="object")return!1;const n=A(e?.barcode);if(n&&n===t)return!0;const a=Ve(e);for(const s of a)for(const o of s)if(Bt(o).has(t))return!0;return!1}function Tt(e,t){if(!t||!e||typeof e!="object")return!1;const n=[e.packageId,e.package_id,e.bundleId,e.bundle_id,e.packageCode,e.package_code];for(const o of n){if(!o&&o!==0)continue;const r=N(o);if(r&&r===t)return!0}const a=e.packages;if(Array.isArray(a))for(const o of a){const r=N(o);if(r&&r===t)return!0}const s=Ve(e);for(const o of s)for(const r of o)if(be(r).has(t))return!0;return!1}function Bt(e){const t=new Set;if(!e&&e!==0)return t;if(typeof e=="string"||typeof e=="number"){const o=A(e);return o&&t.add(o),t}if(typeof e!="object")return t;const n=A(e.barcode??e.equipmentBarcode??e.code??e.serial??e.serialNumber??e.serial_number);n&&t.add(n),["packageItems","package_items","items","equipment","bundleItems","bundle_items"].forEach(o=>{const r=e[o];Array.isArray(r)&&r.forEach(i=>{if(i!=null){if(typeof i=="string"||typeof i=="number"){const d=A(i);d&&t.add(d);return}if(typeof i=="object"){const d=A(i.barcode??i.equipmentBarcode??i.code??i.serial??i.serialNumber??i.serial_number);d&&t.add(d)}}})});const s=be(e);return s.size&&s.forEach(o=>{const r=bt(o);if(!r)return;_t(r).forEach(d=>{const c=d.normalizedBarcode??A(d.barcode);c&&t.add(c)})}),t}function be(e){const t=new Set;if(!e&&e!==0||typeof e=="string"||typeof e=="number"||typeof e!="object")return t;const n=[e.packageId,e.package_id,e.packageCode,e.package_code,e.bundleId,e.bundle_id];return(e.type==="package"||e.kind==="package"||e.category==="package")&&n.push(e.id,e.code,e.uuid),n.forEach(a=>{const s=N(a);s&&t.add(s)}),e.package&&typeof e.package=="object"&&be(e.package).forEach(s=>t.add(s)),Array.isArray(e.packages)&&e.packages.forEach(a=>{const s=N(a);s&&t.add(s)}),t}function Ct(e){const t=[e?.statusRaw,e?.status_raw,e?.status,e?.statusLabel,e?.status_label];if(Pt(e))return!1;for(const n of t){const a=wt(n);if(a){if(a==="completed"||a==="cancelled"||a==="closed")return!1;if(a==="open"||a==="in_progress")return!0}}return!0}function wt(e){const t=String(e??"").trim().toLowerCase().replace(/\s+/g,"_");return t?t==="completed"||t==="done"||t==="finished"||t==="resolved"||t==="closed"||t==="Ù…ÙƒØªÙ…Ù„"||t==="Ù…ØºÙ„Ù‚"?"completed":t==="cancelled"||t==="canceled"||t==="Ù…Ù„ØºÙŠ"?"cancelled":t==="in_progress"||t==="in-progress"||t==="Ù‚ÙŠØ¯_Ø§Ù„ØªÙ†ÙÙŠØ°"||t==="Ø¬Ø§Ø±ÙŠ_Ø§Ù„Ø¹Ù…Ù„"||t==="inprogress"?"in_progress":t==="open"||t==="Ù‚ÙŠØ¯_Ø§Ù„ØµÙŠØ§Ù†Ø©"||t==="Ù‚ÙŠØ¯_Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±"||t==="pending"||t==="scheduled"||t==="active"?"open":t.includes("progress")||t.includes("ongoing")||t.includes("ØªÙ†ÙÙŠØ°")?"in_progress":t.includes("close")||t.includes("complete")||t.includes("finish")||t.includes("resolve")?"completed":t.includes("cancel")?"cancelled":"open":""}function Nt(e,t){const n=new Set;[e?.equipmentBarcode,e?.equipment_barcode,e?.barcode].forEach(r=>{const i=A(r);i&&n.add(i)});const s=e?.equipment&&typeof e.equipment=="object"?e.equipment:null;if(s){const r=A(s.barcode??s.equipmentBarcode??s.code??s.serial??s.serialNumber??s.serial_number);r&&n.add(r)}return[e?.equipmentId,e?.equipment_id,s?.id,s?.equipmentId,s?.equipment_id].map(r=>r!=null?String(r):"").filter(Boolean).forEach(r=>{const i=t.get(r);if(!i)return;const d=A(i?.barcode??i?.equipmentBarcode??i?.code??i?.serial??i?.serialNumber??i?.serial_number);d&&n.add(d)}),n}function Lt(e){const t=le([e?.scheduledAt,e?.scheduled_at,e?.startAt,e?.start_at,e?.startDate,e?.start_date,e?.reportedAt,e?.reported_at,e?.createdAt,e?.created_at]),n=le([e?.resolvedAt,e?.resolved_at,e?.closedAt,e?.closed_at,e?.completedAt,e?.completed_at,e?.finishedAt,e?.finished_at,e?.endAt,e?.end_at,e?.endDate,e?.end_date,e?.expectedCompletionAt,e?.expected_completion_at,e?.dueAt,e?.due_at]);return{start:t,end:n}}function Pt(e){return!!le([e?.resolvedAt,e?.resolved_at,e?.closedAt,e?.closed_at,e?.completedAt,e?.completed_at,e?.finishedAt,e?.finished_at,e?.endAt,e?.end_at,e?.endDate,e?.end_date,e?.expectedCompletionAt,e?.expected_completion_at,e?.dueAt,e?.due_at])}function le(e=[]){for(const t of e){const n=I(t);if(n)return n}return null}function qt(e){const t=new Map;return Array.isArray(e)&&e.forEach(n=>{if(!n||typeof n!="object")return;[n?.id,n?.ID,n?.equipment_id,n?.equipmentId,n?.item_id,n?.itemId,n?.uuid,n?.UUID].map(s=>s!=null?String(s):"").filter(Boolean).forEach(s=>{t.has(s)||t.set(s,n)})}),t}function Nn(e,t,n,a=null){if(!e||!t||!n)return!1;const s=new Date(t),o=new Date(n);if(Number.isNaN(s.getTime())||Number.isNaN(o.getTime()))return!1;const{reservations:r=[]}=w(),i=String(e),d=Z(a);return r.some(c=>{if(!c?.start||!c?.end||J(c,d))return!1;const l=String(c?.status||c?.reservationStatus||"").toLowerCase();if(l==="cancelled"||l==="canceled")return!1;const f=new Date(c.start),p=new Date(c.end);return Number.isNaN(f.getTime())||Number.isNaN(p.getTime())||!(f<o&&p>s)?!1:(Array.isArray(c.technicians)?c.technicians:[]).some(b=>String(b)===i)})}function Ln(e,t,n,a=null){if(!e||!t||!n)return[];const s=I(t),o=I(n);if(!s||!o||s>=o)return[];const{reservations:r=[]}=w(),i=String(e),d=Z(a),c=[];return r.forEach(l=>{if(!l?.start||!l?.end||J(l,d))return;const f=String(l?.status||l?.reservationStatus||"").toLowerCase();if(f==="cancelled"||f==="canceled")return;const p=I(l.start),u=I(l.end);if(!p||!u||!(p<o&&u>s)||!(Array.isArray(l.technicians)?l.technicians:[]).some(y=>String(y)===i))return;const b=l.reservationCode||l.reservation_code||null;if(b)c.push(String(b));else if(l.id!=null||l.reservationId!=null){const y=l.id??l.reservationId;c.push(`#${String(y)}`)}}),Array.from(new Set(c))}function Pn(e=[],t,n,a=null){const o=(Array.isArray(e)?e:[e]).map(f=>A(f)).filter(Boolean);if(!o.length||!t||!n)return[];const r=I(t),i=I(n);if(!r||!i||r>=i)return[];const{reservations:d=[]}=w(),c=Z(a),l=[];return d.forEach(f=>{if(!f?.start||!f?.end||J(f,c))return;const p=String(f?.status||f?.reservationStatus||"").toLowerCase();if(p==="cancelled"||p==="canceled")return;const u=I(f.start),h=I(f.end);if(!(!u||!h)&&u<i&&h>r){for(const b of o)if(Oe(f,b)){const y=f.reservationCode||f.reservation_code||null;if(y)l.push(String(y));else if(f.id!=null||f.reservationId!=null){const S=f.id??f.reservationId;l.push(`#${String(S)}`)}break}}}),Array.from(new Set(l))}function Z(e){return x(e,new Set)}function J(e,t){if(!t||t.size===0)return!1;const n=x([e?.id,e?.reservationId,e?.reservation_id,e?.reservationCode,e?.reservation_code,e?.uuid,e?.UUID,e?._id],new Set);for(const a of n)if(t.has(a))return!0;return!1}function x(e,t){if(e==null)return t;if(e instanceof Set)return e.forEach(o=>x(o,t)),t;if(Array.isArray(e))return e.forEach(o=>x(o,t)),t;if(typeof e=="object"){const o=["id","reservationId","reservation_id","reservationCode","reservation_code","uuid","UUID","_id"];let r=!1;return o.forEach(i=>{Object.prototype.hasOwnProperty.call(e,i)&&(r=!0,x(e[i],t))}),r||Object.values(e).forEach(i=>x(i,t)),t}const n=B(String(e??"")).trim();if(!n)return t;const a=[n,n.toLowerCase(),n.toUpperCase()],s=n.replace(/\D+/g,"");if(s){a.push(s);const o=Number.parseInt(s,10);Number.isNaN(o)||a.push(String(o))}return a.forEach(o=>{o&&t.add(o)}),t}function ke(e){return String(e||"").toLowerCase().replace(/[\u064B-\u0652]/g,"").replace(/[\.\-_/]+/g," ").replace(/\s+/g," ").trim()}const Ft={producer:["producer","prod","line producer","executive producer","associate producer","Ù…Ù†ØªØ¬","Ø§Ù„Ù…Ù†ØªØ¬","Ù…Ù†ØªØ¬ Ù…Ù†ÙØ°","Ù…Ù†ØªØ¬ Ù…Ø´Ø§Ø±Ùƒ","Ù…Ù†ØªØ¬ Ø®Ø·ÙŠ"],director:["director","film director","Ù…Ø®Ø±Ø¬","Ø§Ù„Ù…Ø®Ø±Ø¬"],dop:["dop","d o p","director of photography","cinematographer","Ù…Ø¯ÙŠØ± ØªØµÙˆÙŠØ±","Ù…Ø¯ÙŠØ± Ø§Ù„ØªØµÙˆÙŠØ±","Ù…Ø¯ÙŠØ± ØªØµÙˆÙŠØ± Ø³ÙŠÙ†Ù…Ø§Ø¦ÙŠ"],camera_operator:["camera operator","camera-op","cameraman","videographer","Ù…Ø´ØºÙ„ ÙƒØ§Ù…ÙŠØ±Ø§","Ø§Ù„Ù…ØµÙˆØ±","Ù…ØµÙˆØ± ÙÙŠØ¯ÙŠÙˆ"],first_ac:["1st ac","first ac","first assistant camera","focus puller","fo puller","focus-puller","Ù…Ø³Ø§Ø¹Ø¯ Ù…ØµÙˆØ± Ø§ÙˆÙ„","Ù…Ø³Ø§Ø¹Ø¯ Ù…ØµÙˆØ± Ø£ÙˆÙ„","Ø³Ø§Ø­Ø¨ ÙÙˆÙƒØ³"],second_ac:["2nd ac","second ac","second assistant camera","clapper loader","loader","Ù…Ø³Ø§Ø¹Ø¯ Ù…ØµÙˆØ± Ø«Ø§Ù†ÙŠ","Ø§Ù„ÙƒÙ„Ø§Ù¾Ø±","Ù„ÙˆÙˆØ¯Ø±","Ù„ÙˆØ¯Ø±"],gaffer:["gaffer","chief lighting technician","Ù…Ø¯ÙŠØ± Ø§Ø¶Ø§Ø¡Ø©","Ù…Ø¯ÙŠØ± Ø¥Ø¶Ø§Ø¡Ø©","ÙƒØ¨ÙŠØ± ÙÙ†ÙŠÙŠ Ø§Ù„Ø§Ø¶Ø§Ø¡Ø©","ÙƒØ¨ÙŠØ± ÙÙ†ÙŠÙŠ Ø§Ù„Ø¥Ø¶Ø§Ø¡Ø©"],best_boy_electric:["best boy electric","assistant gaffer","best boy","Ù…Ø³Ø§Ø¹Ø¯ Ø¬Ø§ÙØ±","Ù†Ø§Ø¦Ø¨ Ù…Ø¯ÙŠØ± Ø§Ù„Ø§Ø¶Ø§Ø¡Ø©","Ù†Ø§Ø¦Ø¨ Ù…Ø¯ÙŠØ± Ø§Ù„Ø¥Ø¶Ø§Ø¡Ø©"],electrician:["electrician","spark","sparks","ÙÙ†ÙŠ ÙƒÙ‡Ø±Ø¨Ø§Ø¡","Ø³Ø¨Ø§Ø±Ùƒ"],key_grip:["key grip","chief grip","Ø±Ø¦ÙŠØ³ Ø¬Ø±Ø¨","Ø±Ø¦ÙŠØ³ Ø§Ù„Ø¬Ø±Ø¨","ÙƒØ¨ÙŠØ± Ø§Ù„ÙÙ†ÙŠÙŠÙ† Ø§Ù„Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠÙŠÙ†"],best_boy_grip:["best boy grip","assistant key grip","Ù†Ø§Ø¦Ø¨ Ø±Ø¦ÙŠØ³ Ø§Ù„Ø¬Ø±Ø¨","Ù…Ø³Ø§Ø¹Ø¯ ÙƒØ§ÙŠ Ø¬Ø±Ø¨"],grip:["grip","grips","rigger","rigging","Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠ","Ø±ÙŠØ¬Ø±"],sound_mixer:["production sound mixer","sound mixer","mixer","Ù…Ù‡Ù†Ø¯Ø³ ØµÙˆØª","Ù…ÙŠÙƒØ³Ø± ØµÙˆØª"],boom_operator:["boom operator","boom op","boom","Ø­Ø§Ù…Ù„ Ø§Ù„Ø¨ÙˆÙ…","ÙÙ†ÙŠ Ù…Ø§ÙŠÙƒ","Ø¨ÙˆÙˆÙ…"],sound_assistant:["sound assistant","assistant sound","ÙÙ†ÙŠ ØµÙˆØª Ù…Ø³Ø§Ø¹Ø¯"],script_supervisor:["script supervisor","continuity","script","Ø³ÙƒØ±Ø¨Øª","Ù…Ø³Ø¬Ù„ Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ","ÙƒÙˆÙ†ØªÙŠÙ†ÙˆÙŠØªÙŠ"],location_manager:["location manager","Ù„ÙˆÙƒÙŠØ´Ù† Ù…Ø§Ù†Ø¬Ø±","Ù…Ø¯ÙŠØ± Ù…ÙˆØ§Ù‚Ø¹","Ù…Ø³Ø¤ÙˆÙ„ Ù…ÙˆØ§Ù‚Ø¹","Ù…Ø¯ÙŠØ± Ø§Ù„Ù„ÙˆÙƒÙŠØ´Ù†"],first_ad:["1st assistant director","first assistant director","1st ad","1 ad","first ad","assistant director","Ù…Ø³Ø§Ø¹Ø¯ Ù…Ø®Ø±Ø¬","Ù…Ø³Ø§Ø¹Ø¯ Ù…Ø®Ø±Ø¬ Ø§ÙˆÙ„","Ù…Ø³Ø§Ø¹Ø¯ Ù…Ø®Ø±Ø¬ Ø£ÙˆÙ„"],second_ad:["2nd assistant director","second assistant director","2nd ad","second ad","2 ad","Ù…Ø³Ø§Ø¹Ø¯ Ù…Ø®Ø±Ø¬ Ø«Ø§Ù†ÙŠ"],production_manager:["production manager","pm","Ù…Ø¯ÙŠØ± Ø§Ù†ØªØ§Ø¬","Ù…Ø¯ÙŠØ± Ø¥Ù†ØªØ§Ø¬"],production_coordinator:["production coordinator","pc","Ù…Ù†Ø³Ù‚ Ø§Ù†ØªØ§Ø¬","Ù…Ù†Ø³Ù‚ Ø¥Ù†ØªØ§Ø¬"],production_assistant:["production assistant","pa","runner","production runner","Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù†ØªØ§Ø¬","Ù…Ø³Ø§Ø¹Ø¯ Ø¥Ù†ØªØ§Ø¬","Ø¹Ø¯Ø§Ø¡"],art_director:["art director","Ù…Ø¯ÙŠØ± ÙÙ†ÙŠ","Ø¢Ø±Øª Ø¯Ø§ÙŠØ±ÙƒØªÙˆØ±"],production_designer:["production designer","Ù…ØµÙ…Ù… Ø§Ù„Ø§Ù†ØªØ§Ø¬","Ù…ØµÙ…Ù… Ø§Ù„Ø¥Ù†ØªØ§Ø¬","Ù…ØµÙ…Ù… Ø§Ù„Ø¯ÙŠÙƒÙˆØ±"],props_master:["props master","property master","Ø±Ø¦ÙŠØ³ Ø§Ù„Ø§ÙƒØ³Ø³ÙˆØ§Ø±","Ø±Ø¦ÙŠØ³ Ø§Ù„Ø¥ÙƒØ³Ø³ÙˆØ§Ø±","Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø§ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª","Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª"],set_dresser:["set dresser","dressing","Ù…Ø¬Ù‡Ø² Ø¯ÙŠÙƒÙˆØ±","ÙÙ†ÙŠ Ø¯ÙŠÙƒÙˆØ±"],wardrobe:["wardrobe","costume designer","Ù…ØµÙ…Ù… Ø§Ø²ÙŠØ§Ø¡","Ù…ØµÙ…Ù… Ø£Ø²ÙŠØ§Ø¡","Ù…Ø³Ø¤ÙˆÙ„ Ù…Ù„Ø§Ø¨Ø³"],makeup_artist:["makeup artist","makeup","mua","Ø®Ø¨ÙŠØ± ØªØ¬Ù…ÙŠÙ„","Ù…Ø§ÙƒÙŠÙŠØ±","Ù…ÙƒÙŠØ§Ø¬"],hair_stylist:["hair stylist","hair","Ù…ØµÙÙ Ø´Ø¹Ø±"],colorist:["colorist","grading","grader","ØªÙ„ÙˆÙŠÙ†","Ù…ØµØ­Ø­ Ø§Ù„ÙˆØ§Ù†","Ù…ØµØ­Ø­ Ø£Ù„ÙˆØ§Ù†","Ø¬Ø±ÙŠØ¯ÙŠÙ†Ø¬","Ø¬Ø±ÙŠØ¯ÙŠÙ†Øº"],editor:["editor","video editor","Ù…ÙˆÙ†ØªÙŠØ±","Ù…Ø­Ø±Ø± ÙÙŠØ¯ÙŠÙˆ"],vfx:["vfx","visual effects","Ù…Ø¤Ø«Ø±Ø§Øª Ø¨ØµØ±ÙŠØ©"],dit:["dit","digital imaging technician","ÙÙ†ÙŠ ØµÙˆØ±Ø© Ø±Ù‚Ù…ÙŠ","Ø¯ÙŠ Ø§ÙŠ ØªÙŠ","Ø¯ÙŠ Ø¢ÙŠ ØªÙŠ"],data_wrangler:["data wrangler","data manager","loader data","Ù†Ø³Ø® Ø¨ÙŠØ§Ù†Ø§Øª","Ù…Ø³Ø¤ÙˆÙ„ Ø¨ÙŠØ§Ù†Ø§Øª"],steadicam_operator:["steadicam operator","steadicam","steadycam","Ù…Ø´ØºÙ„ Ø³ØªÙŠÙŠØ¯ÙŠÙƒØ§Ù…","Ù…Ø´ØºÙ„ Ø³ØªÙŠÙƒØ¯ÙŠØ§Ù…","Ù…Ø´ØºÙ„ Ø³ØªÙŠØ¯ÙŠÙƒØ§Ù…"],gimbal_operator:["gimbal operator","gimbal","ronin operator","ronin","Ù…Ø´ØºÙ„ Ø¬ÙŠÙ…Ø¨Ø§Ù„","Ù…Ø´ØºÙ„ Ø±ÙˆÙ†ÙŠÙ†"],drone_operator:["drone operator","drone op","uav pilot","drone pilot","Ù…Ø´ØºÙ„ Ø¯Ø±ÙˆÙ†","Ø·ÙŠØ§Ø± Ø¯Ø±ÙˆÙ†","Ø·ÙŠØ§Ø± Ù…Ø³ÙŠØ±Ø©"],photographer:["photographer","stills photographer","still photographer","Ù…ØµÙˆÙ‘Ø± ÙÙˆØªÙˆØºØ±Ø§ÙÙŠ","Ù…ØµÙˆØ± ÙÙˆØªÙˆØºØ±Ø§ÙÙŠ","ÙÙˆØªÙˆØºØ±Ø§ÙØ±"],bts_photographer:["bts photographer","behind the scenes photographer","bts","Ù…ØµÙˆØ± ÙƒÙˆØ§Ù„ÙŠØ³"],teleprompter:["teleprompter operator","teleprompter","prompt operator","Ù…Ø´ØºÙ„ ØªÙ„ÙŠØ¨Ø±ÙˆÙ…Ø¨ØªØ±","Ù…Ø´ØºÙ„ ØªÙ„Ù‚ÙŠÙ†"],driver:["driver","Ø³Ø§Ø¦Ù‚"],lighting_technician:["lighting technician","lighting tech","electric","ÙÙ†ÙŠ Ø§Ø¶Ø§Ø¡Ø©","ÙÙ†ÙŠ Ø¥Ø¶Ø§Ø¡Ø©"]},zt=(()=>{const e=new Map;return Object.values(Ft).forEach(t=>{const n=Array.from(new Set(t.map(ke)));n.forEach(a=>{const s=new Set(n);s.delete(a),e.set(a,s)})}),e})();function Dt(e){const t=ke(e);if(!t)return[];const n=zt.get(t);return n?Array.from(n):[]}const $t="technicianPositions:updated";let T=[],He=!1,H=null;function ye(e={}){return{id:Number(e.id)||0,name:String(e.name??"").trim(),labelAr:typeof e.label_ar=="string"?e.label_ar.trim():null,labelEn:typeof e.label_en=="string"?e.label_en.trim():null,cost:Number.parseFloat(e.cost??0)||0,clientPrice:e.client_price==null?null:Number.parseFloat(e.client_price),createdAt:e.created_at??null,updatedAt:e.updated_at??null}}function We({name:e,cost:t,clientPrice:n,labelAr:a,labelEn:s}){return{name:String(e??"").trim(),cost:t??0,client_price:n,label_ar:a??null,label_en:s??null}}function Mt(e){return T=Array.isArray(e)?e.map(ye).filter(t=>t.name!=="").sort((t,n)=>U(t).localeCompare(U(n),"ar",{sensitivity:"base"})):[],He=!0,ae(),q()}function ae(){try{const e={positions:q()},t=new CustomEvent($t,{detail:e});typeof window<"u"&&window.dispatchEvent(t),typeof document<"u"&&document.dispatchEvent(t)}catch(e){console.warn("[technicianPositions] Failed to dispatch update event",e)}}function U(e={}){return(e.labelAr||e.labelEn||e.name||"").toLowerCase()}function q(){return T.map(e=>({...e}))}function xt(e){const t=String(e??"").trim().toLowerCase();if(!t)return null;const n=(s,o)=>{const r=String(o||"").toLowerCase();return r?!!(s.name&&String(s.name).toLowerCase()===r||s.labelAr&&String(s.labelAr).toLowerCase()===r||s.labelEn&&String(s.labelEn).toLowerCase()===r):!1};let a=T.find(s=>n(s,t))||null;if(a)return a;try{const s=Dt(t)||[];for(const o of s)if(a=T.find(r=>n(r,o))||null,a)return a}catch{}return null}async function Rt({forceRefresh:e=!1}={}){return He&&!e?q():(H&&!e||(H=P("/technician-positions/").then(t=>{const n=Array.isArray(t?.data)?t.data:[];return Mt(n)}).finally(()=>{H=null})),H)}async function se({forceRefresh:e=!1}={}){try{return await Rt({forceRefresh:e})}catch(t){throw t instanceof ce?t:new ce(t?.message||m("positions.toast.fetchFailed","âš ï¸ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†Ø§ØµØ¨ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰"))}}async function jt({name:e,cost:t,clientPrice:n,labelAr:a,labelEn:s}){const o=We({name:e,cost:t,clientPrice:n,labelAr:a,labelEn:s}),r=await P("/technician-positions/",{method:"POST",body:o}),i=ye(r?.data??{});return T=[...T,i],T.sort((d,c)=>U(d).localeCompare(U(c),"ar",{sensitivity:"base"})),ae(),i}async function Ut(e,{name:t,cost:n,clientPrice:a,labelAr:s,labelEn:o}){if(!e)throw new Error("Position id is required");const r=We({name:t,cost:n,clientPrice:a,labelAr:s,labelEn:o}),i=await P(`/technician-positions/?id=${encodeURIComponent(e)}`,{method:"PATCH",body:r}),d=ye(i?.data??{});return T=T.map(c=>c.id===d.id?d:c),T.sort((c,l)=>U(c).localeCompare(U(l),"ar",{sensitivity:"base"})),ae(),d}async function Vt(e){if(!e)throw new Error("Position id is required");return await P(`/technician-positions/?id=${encodeURIComponent(e)}`,{method:"DELETE"}),T=T.filter(t=>t.id!==Number(e)),ae(),q()}ot();rt();ct();document.addEventListener("DOMContentLoaded",()=>{lt();const e=document.getElementById("logout-btn");e&&!e.dataset.listenerAttached&&(e.addEventListener("click",()=>dt()),e.dataset.listenerAttached="true")});function te(e){const t=Number(e)||0,a=ne()==="ar"?"ar-SA-u-nu-latn":"en-US",s=new Intl.NumberFormat(a,{minimumFractionDigits:0,maximumFractionDigits:0}).format(Math.round(t));return`${B(s)} SR`}function qn(e){return typeof e?.expensesTotal=="number"?e.expensesTotal:Array.isArray(e?.expenses)?e.expenses.reduce((t,n)=>t+(Number(n?.amount)||0),0):0}function Fn(e){const t=new Date,n=e?.start?new Date(e.start):null,a=e?.end?new Date(e.end):null;return n&&!Number.isNaN(n.getTime())&&n>t?"upcoming":a&&!Number.isNaN(a.getTime())&&a<t?"completed":"ongoing"}function zn(e,t){return e?e.length<=t?e:`${e.slice(0,t).trim()}â€¦`:""}function D(e=""){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}const de="__ART_RATIO_TECH_SUB_TAB__",Ke=["technicians-management","technicians-positions"];let _=null,Le=!1,ee=!1,K="",ue=!1,C=null,M="technicians-management";const Pe=kt();Pe&&(M=Pe);async function Ge({showToastOnError:e=!0}={}){if(!ee){ee=!0,K="",v();try{await ze(),ue=!0}catch(t){console.error("âŒ [technicians] loadTechniciansFromApi failed",t),K=Q(t)?t.message:m("technicians.toast.fetchFailed","ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ø§Ù‚Ù…ØŒ Ø­Ø§ÙˆÙ„ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©"),e&&g(K,"error")}finally{ee=!1,v()}}}function Qe(){return G()}function Y(e=""){return B(String(e)).trim().toLowerCase()}function Ot(e){return e==null?"":String(e)}function V(e=""){return B(String(e)).replace(/[^0-9+]/g,"")}function E(e=""){const t=B(String(e)).replace(/[^0-9.]/g,"");if(!t.includes("."))return t;const[n,...a]=t.split(".");return`${n}.${a.join("")}`}function R(e,t){!e||e.dataset.normalizerAttached||(e.addEventListener("input",()=>{const n=t(e.value);if(e.value!==n){const a=e.selectionEnd;e.value=n,a!=null&&e.setSelectionRange(n.length,n.length)}}),e.dataset.normalizerAttached="true")}function kt(){try{if(typeof window>"u"||!window.localStorage)return null;const e=window.localStorage.getItem(de);return e&&Ke.includes(e)?e:null}catch(e){return console.warn("âš ï¸ [technicians] Failed to read stored sub-tab",e),null}}function Ht(e){try{if(typeof window>"u"||!window.localStorage)return;if(!Ke.includes(e)){window.localStorage.removeItem(de);return}window.localStorage.setItem(de,e)}catch(t){console.warn("âš ï¸ [technicians] Failed to store sub-tab",t)}}function Ze(e,t=0,n=null){const a=String(e??"").trim(),s=a?xt(a):null;return s?{matchedPosition:s,dailyWage:Number.isFinite(s.cost)?s.cost:0,dailyTotal:s.clientPrice==null?null:Number.isFinite(s.clientPrice)?s.clientPrice:0}:{matchedPosition:null,dailyWage:Number.isFinite(t)?t:0,dailyTotal:n==null?null:Number.isFinite(n)?n:0}}function Je(){const e=document.getElementById("technician-position-summary"),t=document.getElementById("technician-position-summary-body");return{container:e,body:t}}function fe(e,t=ne()){return e?t==="ar"?e.labelAr||e.labelEn||e.name||"":e.labelEn||e.labelAr||e.name||"":""}function Wt(e,t=ne()){return t==="ar"?e.labelEn||e.labelAr||e.name||"":e.labelAr||e.labelEn||e.name||""}function Xe(){const{container:e,body:t}=Je();!e||!t||(t.textContent="",e.hidden=!0)}function Ie(e,t={}){const{container:n,body:a}=Je();if(!n||!a)return;const s=String(e??"").trim();if(!s){Xe();return}const o=Ze(s,t?.dailyWage??0,t?.dailyTotal??null),r=te(o.dailyWage||0),i=o.dailyTotal!=null?te(o.dailyTotal):m("technicians.positionSummary.noClientPrice","â€”");o.matchedPosition?a.textContent=m("technicians.positionSummary.match","Ø§Ù„ØªÙƒÙ„ÙØ©: {cost} Â· Ø³Ø¹Ø± Ø§Ù„Ø¹Ù…ÙŠÙ„: {price}").replace("{cost}",r).replace("{price}",i):a.textContent=m("technicians.positionSummary.custom","Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù†ØµØ¨ Ù…Ø·Ø§Ø¨Ù‚. ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØªÙ‡ Ù…Ù† ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ù†Ø§ØµØ¨. Ø³ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: {cost} Â· Ø³Ø¹Ø± Ø§Ù„Ø¹Ù…ÙŠÙ„: {price}").replace("{cost}",r).replace("{price}",i),n.hidden=!1}function X(){const e=document.getElementById("technician-position-options");if(!e)return;const t=q(),n=ne(),a=new Set,s=[];t.forEach(o=>{const r=fe(o,n).trim();r&&!a.has(r.toLowerCase())&&(s.push(`<option value="${D(r)}"></option>`),a.add(r.toLowerCase()));const i=Wt(o,n).trim();i&&!a.has(i.toLowerCase())&&(s.push(`<option value="${D(i)}"></option>`),a.add(i.toLowerCase()));const d=o.name?.trim();d&&!a.has(d.toLowerCase())&&(s.push(`<option value="${D(d)}"></option>`),a.add(d.toLowerCase()))}),e.innerHTML=s.join("")}function qe(e){const t=Array.from(document.querySelectorAll("[data-tech-tab]")),n=Array.from(document.querySelectorAll("[data-tech-tab-panel]")),s=t.map(i=>i?.getAttribute("data-tech-tab")).filter(Boolean).includes(e)?e:"technicians-management";t.forEach(i=>{if(!i)return;const c=i.getAttribute("data-tech-tab")===s;i.classList.toggle("tab-active",c),i.classList.toggle("active",c),i.setAttribute("aria-selected",c?"true":"false"),i.setAttribute("tabindex",c?"0":"-1")}),n.forEach(i=>{if(!i)return;const c=i.getAttribute("data-tech-tab-panel")===s;i.hidden=!c,i.classList.toggle("active",c)}),M=s,Ht(s);const r=t.find(i=>i?.getAttribute("data-tech-tab")===s)?.closest("[data-tab-scroll]");r&&r.dispatchEvent(new CustomEvent("tabScroll:update",{bubbles:!0})),s==="technicians-positions"&&(L(),se().then(()=>{L()}).catch(i=>{console.error("âŒ [technicians] failed to load positions for tab switch",i),g(i?.message||m("positions.toast.fetchFailed","âš ï¸ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†Ø§ØµØ¨ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰"),"error")}))}function Se(e="add"){const t=document.getElementById("technician-submit-btn");if(!t)return;const n=e==="update"?"technicians.form.actions.update":"technicians.form.actions.submit",a=e==="update"?"ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„":"â• Ø¥Ø¶Ø§ÙØ© Ø¹Ø¶Ùˆ Ø·Ø§Ù‚Ù…";t.textContent=m(n,a)}function ve(e){const t=document.getElementById("technician-cancel-btn");t&&(e?t.classList.remove("d-none"):t.classList.add("d-none"),t.textContent=m("technicians.form.actions.cancel","Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„"))}function _e(){Se(_?"update":"add"),ve(!!_),v()}function Kt(e=[]){const t=document.getElementById("technician-role-filter");if(!t)return"";const n=t.value,a=Array.from(new Set(e.map(o=>(o?.role||"").trim()).filter(Boolean))).sort((o,r)=>o.localeCompare(r,"ar",{sensitivity:"base"})),s=m("technicians.search.filters.allRoles","ğŸ‘” ÙƒÙ„ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù");return t.innerHTML=`<option value="">${s}</option>`+a.map(o=>`<option value="${o}">${o}</option>`).join(""),n&&a.includes(n)?t.value=n:t.value="",t.value}function oe(){const e=document.getElementById("technician-form");e&&(e.reset(),_=null,Se("add"),ve(!1),Xe())}function Gt(e){const t=document.getElementById("technician-name"),n=document.getElementById("technician-phone"),a=document.getElementById("technician-email"),s=document.getElementById("technician-role"),o=document.getElementById("technician-department"),r=document.getElementById("technician-notes");!t||!n||!s||(t.value=e.name||"",n.value=V(e.phone||""),a&&(a.value=e.email||""),s.value=e.role||"",o&&(o.value=e.department||""),r&&(r.value=e.notes||""),_=String(e.id),Se("update"),ve(!0),Ie(s.value,e))}function Qt(){const e=document.getElementById("technician-name"),t=document.getElementById("technician-phone"),n=document.getElementById("technician-email"),a=document.getElementById("technician-role"),s=document.getElementById("technician-department"),o=document.getElementById("technician-notes");if(!e||!t||!a)return null;const r=e.value.trim(),i=V(t.value.trim());t.value=i;const d=(n?.value||"").trim(),c=a.value.trim(),l=s?.value.trim()||"",f="available",p=o?.value.trim()||"",u=_?et(_):null,{dailyWage:h,dailyTotal:b}=Ze(c,u?.dailyWage??0,u?.dailyTotal??null);return r?i?c?!Number.isFinite(h)||h<0?(g(m("positions.toast.invalidCost","âš ï¸ Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© ØµØ­ÙŠØ­Ø© Ù„Ù„ØªÙƒÙ„ÙØ©")),null):b!=null&&(!Number.isFinite(b)||b<0)?(g(m("positions.toast.invalidClientPrice","âš ï¸ Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© ØµØ­ÙŠØ­Ø© Ù„Ø³Ø¹Ø± Ø§Ù„Ø¹Ù…ÙŠÙ„")),null):(Ie(c,{dailyWage:h,dailyTotal:b}),{name:r,phone:i,email:d,role:c,department:l,dailyWage:Number.isFinite(h)?h:0,dailyTotal:b==null?null:Number(b),status:f,baseStatus:f,notes:p}):(g(m("technicians.toast.missingRole","âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙˆØ¸ÙŠÙØ©")),a.focus(),null):(g(m("technicians.toast.missingPhone","âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„ØªÙˆØ§ØµÙ„")),t.focus(),null):(g(m("technicians.toast.missingName","âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…")),e.focus(),null)}async function Zt(e){e.preventDefault();try{await se()}catch(a){console.error("âŒ [technicians] failed to load positions before submit",a);const s=a?.message||m("positions.toast.fetchFailed","âš ï¸ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†Ø§ØµØ¨ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰");g(s,"error");return}const t=Qt();if(!t)return;const n=pe({name:t.name,phone:t.phone,email:t.email||null,role:t.role,department:t.department,dailyWage:t.dailyWage,dailyTotal:t.dailyTotal,status:t.status,notes:t.notes,active:!0});try{_?(await me(_,n),g(m("technicians.toast.updateSuccess","ğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…"))):(await De(n),g(m("technicians.toast.addSuccess","âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…"))),oe(),v()}catch(a){console.error("âŒ [technicians] handleTechnicianSubmit failed",a);const s=Q(a)?a.message:m("technicians.toast.saveFailed","ØªØ¹Ø°Ø± Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰");g(s,"error")}}function Jt(){oe()}function Xt(e){const t={id:document.getElementById("edit-technician-id"),name:document.getElementById("edit-technician-name"),phone:document.getElementById("edit-technician-phone"),email:document.getElementById("edit-technician-email"),role:document.getElementById("edit-technician-role"),department:document.getElementById("edit-technician-department"),wage:document.getElementById("edit-technician-wage"),total:document.getElementById("edit-technician-total"),status:document.getElementById("edit-technician-status"),notes:document.getElementById("edit-technician-notes")};if(!t.id||!t.name||!t.phone||!t.role||!t.wage||!t.total||!t.status)return;t.id.value=e.id||"",t.name.value!==(e.name||"")&&(t.name.value=e.name||"");const n=V(e.phone||"");t.phone.value!==n&&(t.phone.value=n),t.email&&t.email.value!==(e.email||"")&&(t.email.value=e.email||""),t.role.value!==(e.role||"")&&(t.role.value=e.role||""),t.department&&t.department.value!==(e.department||"")&&(t.department.value=e.department||"");const a=E(e.dailyWage!=null?e.dailyWage:"");t.wage.value!==a&&(t.wage.value=a);const s=E(e.dailyTotal!=null?e.dailyTotal:"");t.total.value!==s&&(t.total.value=s);const o=e.baseStatus||e.status||"available";t.status.value!==o&&(t.status.value=o),t.notes&&t.notes.value!==(e.notes||"")&&(t.notes.value=e.notes||""),R(t.phone,V),R(t.wage,E),R(t.total,E)}function Yt(){const e=document.getElementById("edit-technician-id"),t=document.getElementById("edit-technician-name"),n=document.getElementById("edit-technician-phone"),a=document.getElementById("edit-technician-email"),s=document.getElementById("edit-technician-role"),o=document.getElementById("edit-technician-department"),r=document.getElementById("edit-technician-wage"),i=document.getElementById("edit-technician-total"),d=document.getElementById("edit-technician-status"),c=document.getElementById("edit-technician-notes");if(!e||!t||!n||!s||!r||!i||!d)return null;const l=e.value.trim(),f=t.value.trim(),p=V(n.value.trim());n.value=p;const u=(a?.value||"").trim(),h=s.value.trim(),b=o?.value.trim()||"",y=E(r.value.trim());r.value=y;const S=y===""?0:parseFloat(y),F=E(i.value.trim());i.value=F;const z=F===""?null:parseFloat(F),Be=d.value||"available",at=c?.value.trim()||"";return l?f?p?h?Number.isNaN(S)||S<0?(g(m("technicians.toast.invalidWage","âš ï¸ Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© ØµØ­ÙŠØ­Ø© Ù„Ù„Ø£Ø¬Ø± Ø§Ù„ÙŠÙˆÙ…ÙŠ")),r.focus(),null):z!=null&&(Number.isNaN(z)||z<0)?(g(m("technicians.toast.invalidTotal","âš ï¸ Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© ØµØ­ÙŠØ­Ø© Ù„Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©")),i.focus(),null):{id:l,name:f,phone:p,email:u,role:h,department:b,dailyWage:Number.isFinite(S)?S:0,dailyTotal:z==null?null:Number(z),status:Be,baseStatus:Be,notes:at}:(g(m("technicians.toast.missingRole","âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙˆØ¸ÙŠÙØ©")),s.focus(),null):(g(m("technicians.toast.missingPhone","âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„ØªÙˆØ§ØµÙ„")),n.focus(),null):(g(m("technicians.toast.missingName","âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…")),t.focus(),null):(g(m("technicians.toast.unidentified","âš ï¸ ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ¯ Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨")),null)}async function en(){const e=Yt();if(!e)return;const t=pe({name:e.name,phone:e.phone,email:e.email||null,role:e.role,department:e.department,dailyWage:e.dailyWage,dailyTotal:e.dailyTotal,status:e.status,notes:e.notes,active:!0});try{await me(e.id,t),g(m("technicians.toast.updateSuccess","ğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…"));const n=document.getElementById("editTechnicianModal");n&&window.bootstrap?.Modal&&window.bootstrap.Modal.getInstance(n)?.hide(),v()}catch(n){console.error("âŒ [technicians] handleTechnicianModalSave failed",n);const a=Q(n)?n.message:m("technicians.toast.updateFailed","ØªØ¹Ø°Ø± Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…");g(a,"error")}}function v(){const e=document.getElementById("technicians-table");if(!e)return;const t=document.getElementById("search-technician-input"),n=Y(t?.value||"");if(ee&&!ue){const c=m("technicians.table.loading","Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...");e.innerHTML=`<tr><td colspan='6'>${c}</td></tr>`;return}if(K&&!ue){e.innerHTML=`<tr><td colspan='6' class='text-danger'>${K}</td></tr>`;return}const a=Ee(),{reservations:s=[]}=w(),o=new Date;Kt(a);const r=document.getElementById("technician-role-filter"),i=Y(r?.value||""),d=a.filter(c=>i&&Y(c.role||"")!==i?!1:n?Y([c.name,c.phone,c.email,c.role,c.department,c.notes].filter(Boolean).join(" ")).includes(n):!0);if(d.length===0){const c=m("technicians.table.empty","Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø¹Ø¶Ø§Ø¡ ÙÙŠ Ø§Ù„Ø·Ø§Ù‚Ù… Ø¨Ø¹Ø¯.");e.innerHTML=`<tr><td colspan='6'>${c}</td></tr>`;return}e.innerHTML=d.map(c=>{const l=_&&String(_)===String(c.id),u=(tt(c.id,s,o)?"busy":c.status||c.baseStatus||"available")==="busy"?{label:m("technicians.status.busy","â›” Ù…Ø´ØºÙˆÙ„"),className:"technician-status-badge technician-status-badge--busy"}:{label:m("technicians.status.available","âœ… Ù…ØªØ§Ø­"),className:"technician-status-badge technician-status-badge--available"},h=m("technicians.actions.edit","âœï¸ ØªØ¹Ø¯ÙŠÙ„"),b=m("technicians.actions.delete","ğŸ—‘ï¸ Ø­Ø°Ù"),y=Fe(),S=[`<button type="button" class="technician-action-btn technician-action-btn--edit technician-edit-btn" data-id="${c.id}">${h}</button>`];return y&&S.push(`<button type="button" class="technician-action-btn technician-action-btn--delete technician-delete-btn" data-id="${c.id}">${b}</button>`),`
      <tr${l?' class="technician-table-row-editing"':""}>
        <td><a href="technician.html?id=${c.id}" class="text-decoration-none">${c.name}</a></td>
        <td>${c.role||""}</td>
        <td>${c.department||m("common.placeholder.empty","â€”")}</td>
        <td><span class="${u.className}"><span class="technician-status-badge__text">${u.label}</span></span></td>
        <td class="table-notes-cell">${c.notes||m("common.placeholder.empty","â€”")}</td>
        <td class="table-actions-cell">
          <div class="table-action-buttons">
            ${S.join("")}
          </div>
        </td>
      </tr>
    `}).join("")}function re(){return{form:document.getElementById("position-form"),idInput:document.getElementById("position-id"),nameArInput:document.getElementById("position-name-ar"),nameEnInput:document.getElementById("position-name-en"),costInput:document.getElementById("position-cost"),clientPriceInput:document.getElementById("position-client-price"),submitBtn:document.getElementById("position-submit-btn"),cancelBtn:document.getElementById("position-cancel-btn")}}function Ye(e="add"){const{submitBtn:t,cancelBtn:n}=re(),a=e==="update";if(t){const s=a?"positions.form.actions.update":"positions.form.actions.submit",o=a?"ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØµØ¨":"â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØµØ¨";t.textContent=m(s,o)}n&&(n.classList.toggle("d-none",!a),n.textContent=m("positions.form.actions.cancel","Ø¥Ù„ØºØ§Ø¡"))}function Ae(){const{form:e,idInput:t,nameArInput:n,nameEnInput:a,costInput:s,clientPriceInput:o}=re();e&&e.reset(),t&&(t.value=""),n&&(n.value=""),a&&(a.value=""),s&&(s.value=""),o&&(o.value=""),C=null,Ye("add")}function tn(e){const{idInput:t,nameArInput:n,nameEnInput:a,costInput:s,clientPriceInput:o}=re();!e||!s||(t&&(t.value=e.id||""),n&&(n.value=e.labelAr||""),a&&(a.value=e.labelEn||""),s.value=E(e.cost??0),o&&(o.value=e.clientPrice==null?"":E(e.clientPrice)),C=e.id||null,Ye("update"))}function nn(){const{nameArInput:e,nameEnInput:t,costInput:n,clientPriceInput:a}=re();if(!n)return null;const s=e?.value.trim()||"",o=t?.value.trim()||"",r=o||s,i=C?q().find(p=>String(p.id)===String(C)):null,d=E(n.value.trim());n.value=d;const c=d===""?0:parseFloat(d),l=a?E(a.value.trim()):"";a&&(a.value=l);const f=l===""?null:parseFloat(l);return r?!Number.isFinite(c)||c<0?(g(m("positions.toast.invalidCost","âš ï¸ Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© ØµØ­ÙŠØ­Ø© Ù„Ù„ØªÙƒÙ„ÙØ©")),n.focus(),null):f!=null&&(!Number.isFinite(f)||f<0)?(g(m("positions.toast.invalidClientPrice","âš ï¸ Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© ØµØ­ÙŠØ­Ø© Ù„Ø³Ø¹Ø± Ø§Ù„Ø¹Ù…ÙŠÙ„")),a?.focus(),null):{id:C,name:i?.name||r,cost:Number(c.toFixed(2)),clientPrice:f==null?null:Number(f.toFixed(2)),labelAr:s||null,labelEn:o||null}:(g(m("positions.toast.invalidName","âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØµØ¨")),e&&e.focus(),null)}function O(){const e=document.getElementById("technician-role");if(!e)return;const t=_?et(_):null;Ie(e.value,t||{})}function L(){const e=document.getElementById("positions-table"),t=document.getElementById("positions-count");if(!e)return;const n=q();if(t&&(t.textContent=B(String(n.length))),!n.length){e.innerHTML=`
      <tr>
        <td colspan="5">${m("positions.table.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†Ø§ØµØ¨ Ø¨Ø¹Ø¯.")}</td>
      </tr>
    `;return}e.innerHTML=n.map(a=>{const s=C&&String(C)===String(a.id),o=te(a.cost||0),r=a.clientPrice==null?m("technicians.positionSummary.noClientPrice","â€”"):te(a.clientPrice),i=fe(a,"ar")||"â€”",d=fe(a,"en")||"â€”",c=m("positions.table.actions.edit","âœï¸ ØªØ¹Ø¯ÙŠÙ„"),l=m("positions.table.actions.delete","ğŸ—‘ï¸ Ø­Ø°Ù");return`
      <tr${s?' class="technician-table-row-editing"':""}>
        <td>${D(i)}</td>
        <td>${D(d)}</td>
        <td>${D(o)}</td>
        <td>${D(r)}</td>
        <td class="table-actions-cell">
          <div class="table-action-buttons">
            <button type="button" class="technician-action-btn technician-action-btn--edit position-edit-btn" data-id="${a.id}">${c}</button>
            <button type="button" class="technician-action-btn technician-action-btn--delete position-delete-btn" data-id="${a.id}">${l}</button>
          </div>
        </td>
      </tr>
    `}).join("")}async function an(e){e.preventDefault();const t=nn();if(t)try{const n=!!C;n?await Ut(t.id,t):await jt(t);const a=n?m("positions.toast.updateSuccess","ğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØµØ¨"):m("positions.toast.addSuccess","âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØµØ¨");g(a),Ae(),L(),X(),O()}catch(n){console.error("âŒ [technicians] handlePositionSubmit failed",n);const a=n?.message||m("positions.toast.saveFailed","âš ï¸ ØªØ¹Ø°Ø± Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØµØ¨ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰");g(a,"error")}}function sn(){Ae()}async function on(e){try{const t=e.target;if(!(t instanceof HTMLElement))return;const n=t.dataset.id;if(!n)return;if(t.classList.contains("position-edit-btn")){await se();const a=q().find(s=>String(s.id)===String(n));if(!a){g(m("positions.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØµØ¨"),"error");return}tn(a),L();return}if(t.classList.contains("position-delete-btn")){if(!confirm(m("positions.toast.deleteConfirm","âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØµØ¨ØŸ")))return;await Vt(n),C&&String(C)===String(n)&&Ae(),g(m("positions.toast.deleteSuccess","ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØµØ¨")),L(),X(),O()}}catch(t){console.error("âŒ [technicians] handlePositionsTableClick failed",t);const n=t?.message||m("positions.toast.fetchFailed","âš ï¸ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†Ø§ØµØ¨ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰");g(n,"error")}}function rn(e){const t=Qe().find(n=>String(n.id)===String(e));if(!t){g(m("technicians.toast.dataNotFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…"));return}Gt(t),g(m("technicians.toast.editReady","âœï¸ ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù… Ø§Ù„Ø¢Ù† Ø«Ù… Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„"))}async function cn(e){if(!Fe()){ft();return}if(confirm(m("technicians.toast.deleteConfirm","âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø¶ÙˆØŸ")))try{await $e(e),g(m("technicians.toast.deleteSuccess","ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…")),_&&String(_)===String(e)&&oe(),v()}catch(t){console.error("âŒ [technicians] handleDeleteClick failed",t);const n=Q(t)?t.message:m("technicians.toast.deleteFailed","ØªØ¹Ø°Ø± Ø­Ø°Ù Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰");g(n,"error")}}function Dn(){Te(),v()}function et(e){return Qe().find(t=>String(t.id)===String(e))||null}function ln(e){const t=new Set,n=s=>{if(s==null)return;const o=String(s).trim();o&&t.add(o)},a=s=>{Array.isArray(s)&&s.forEach(o=>{if(o!=null)if(typeof o=="object"){const r=o.id??o.technicianId??o.technician_id??(o.technician&&(o.technician.id??o.technician.technicianId??o.technician.technician_id));n(r)}else n(o)})};return a(e?.technicians),a(e?.techniciansDetails),Array.from(t)}function dn(e){const t=e?.start??e?.startDatetime??e?.start_datetime??e?.start_date??null,n=e?.end??e?.endDatetime??e?.end_datetime??e?.end_date??null;return{start:t,end:n}}function tt(e,t=[],n){const a=Ot(e);return a?t.some(s=>{if(!s)return!1;const o=String(s?.status||s?.reservationStatus||"").toLowerCase();if(o==="cancelled"||o==="canceled"||!ln(s).includes(a))return!1;const{start:i,end:d}=dn(s);if(!i||!d)return!1;const c=new Date(i),l=new Date(d);return Number.isNaN(c.getTime())||Number.isNaN(l.getTime())?!1:c<=n&&n<l}):!1}function Ee(){const e=w().reservations||[],t=G();if(!Array.isArray(t)||t.length===0)return t;const n=new Date;let a=!1;const s=t.map(o=>{if(!o)return o;const r=o.baseStatus||o.status||"available";let i=r==="busy"?"busy":r;return tt(o.id,e,n)&&(i="busy"),(i!==o.status||r!==o.baseStatus)&&(a=!0),{...o,baseStatus:r,status:i}});return a?(k(s),s):t}document.addEventListener("reservations:changed",()=>{const e=G();if(Ee()===e)try{v()}catch{}});document.addEventListener("reservations:updated",()=>{const e=G();if(Ee()===e)try{v()}catch{}});function Te(){const e=document.getElementById("technician-form"),t=e&&!e.dataset.initialized;e&&!e.dataset.listenerAttached&&(e.addEventListener("submit",p=>{Zt(p).catch(u=>{console.error("âŒ [technicians] submit handler failed",u)})}),e.dataset.listenerAttached="true"),e&&(e.dataset.initialized="true");const n=document.getElementById("technician-cancel-btn");n&&!n.dataset.listenerAttached&&(n.addEventListener("click",Jt),n.dataset.listenerAttached="true"),R(document.getElementById("technician-phone"),V);const a=document.getElementById("technician-role");a&&!a.dataset.listenerAttached&&(a.addEventListener("input",()=>{O()}),a.dataset.listenerAttached="true");const s=document.getElementById("technicians-table");s&&!s.dataset.listenerAttached&&(s.addEventListener("click",p=>{const u=p.target;if(u instanceof HTMLElement){if(u.classList.contains("technician-edit-btn")){const h=u.dataset.id;rn(h)}if(u.classList.contains("technician-delete-btn")){const h=u.dataset.id;cn(h).catch(b=>{console.error("âŒ [technicians] delete handler failed",b)})}}}),s.dataset.listenerAttached="true");const o=document.getElementById("search-technician-input");o&&!o.dataset.listenerAttached&&(o.addEventListener("input",()=>{o.value=B(o.value),v()}),o.dataset.listenerAttached="true");const r=document.getElementById("technician-role-filter");r&&!r.dataset.listenerAttached&&(r.addEventListener("change",()=>{v()}),r.dataset.listenerAttached="true");const i=document.getElementById("save-technician-changes");i&&!i.dataset.listenerAttached&&(i.addEventListener("click",()=>{en().catch(p=>{console.error("âŒ [technicians] modal save failed",p)})}),i.dataset.listenerAttached="true");const d=document.getElementById("position-form");d&&!d.dataset.listenerAttached&&(d.addEventListener("submit",p=>{an(p).catch(u=>{console.error("âŒ [technicians] position submit failed",u)})}),d.dataset.listenerAttached="true");const c=document.getElementById("position-cancel-btn");c&&!c.dataset.listenerAttached&&(c.addEventListener("click",sn),c.dataset.listenerAttached="true");const l=document.getElementById("positions-table");l&&!l.dataset.listenerAttached&&(l.addEventListener("click",on),l.dataset.listenerAttached="true"),R(document.getElementById("position-cost"),E),R(document.getElementById("position-client-price"),E);const f=document.querySelector("[data-tech-tabs]");f&&!f.dataset.listenerAttached&&(f.querySelectorAll("[data-tech-tab]").forEach(u=>{u&&u.addEventListener("click",()=>{const h=u.getAttribute("data-tech-tab");qe(h)})}),f.dataset.listenerAttached="true"),qe(M),se().then(()=>{X(),M==="technicians-positions"&&L(),O()}).catch(p=>{console.error("âŒ [technicians] failed to load technician positions",p),g(p?.message||m("positions.toast.fetchFailed","âš ï¸ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†Ø§ØµØ¨ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰"),"error")}),Le||(document.addEventListener("technician:prefill",p=>{const u=p.detail;u&&Xt(u)}),Le=!0),t&&oe(),M==="technicians-positions"&&L()}window.addEventListener("DOMContentLoaded",()=>{Te(),v(),_e(),Ge()});const nt=()=>{v()};window.addEventListener("technicians:updated",nt);document.addEventListener("technicians:updated",nt);document.addEventListener("technicians:refreshRequested",()=>{Te(),v(),_e(),Ge({showToastOnError:!1})});document.addEventListener("language:changed",()=>{_e(),X(),M==="technicians-positions"&&L(),O()});document.addEventListener(ut.USER_UPDATED,()=>{v()});const it=()=>{X(),M==="technicians-positions"&&L(),O()};window.addEventListener("technicianPositions:updated",it);document.addEventListener("technicianPositions:updated",it);export{wn as A,Pn as B,gn as C,An as D,bn as E,Et as F,Nn as G,Ln as H,N as I,Tn as J,yt as K,It as L,vn as M,En as N,In as O,mn as P,fn as _,Dn as a,ge as b,qn as c,Fn as d,D as e,te as f,et as g,G as h,q as i,xt as j,se as k,Cn as l,ie as m,A as n,bt as o,xe as p,yn as q,ze as r,Ee as s,zn as t,St as u,_n as v,Bn as w,hn as x,pn as y,Sn as z};
