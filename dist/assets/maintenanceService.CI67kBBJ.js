import{l as m,a as r,b as f,d as _,n as h}from"./auth.MErpxXfv.js";const A=m()||{};let o=(A.maintenance||[]).map(l);function E(){return o}function u(e){return o=Array.isArray(e)?e.map(l):[],_({maintenance:o}),M(),o}async function D(e={}){const t=new URLSearchParams;Object.entries(e).forEach(([a,c])=>{c!=null&&c!==""&&t.set(a,String(c))});const i=t.toString(),n=await r(`/maintenance/${i?`?${i}`:""}`),s=Array.isArray(n?.data)?n.data.map(d):[];return u(s)}async function I(e){const t=await r("/maintenance/",{method:"POST",body:e}),i=d(t?.data??{});return u([i,...o.filter(n=>n.id!==i.id)]),i}async function z(e,t){const i=await r(`/maintenance/?id=${encodeURIComponent(e)}`,{method:"PATCH",body:t}),n=d(i?.data??{});return u(o.map(s=>String(s.id)===String(e)?n:s)),n}async function L(e){await r(`/maintenance/?id=${encodeURIComponent(e)}`,{method:"DELETE"}),u(o.filter(t=>String(t.id)!==String(e)))}function v({equipmentId:e,technicianId:t,issue:i,priority:n,status:s,scheduledAt:a,resolutionReport:c}){return{equipment_id:e,technician_id:null,maintenance_type:null,priority:n,reported_at:null,scheduled_at:null,status:s,notes:i??"",resolution_report:null,repair_cost:null}}function d(e={}){return p({id:e.id,equipment_id:e.equipment_id,equipmentBarcode:e.equipmentBarcode??e.equipment_barcode,equipmentDesc:e.equipmentDesc??e.equipment_desc??e.equipment_description,issue:e.issue??e.notes,priority:e.priority,status:e.status,status_raw:e.status_raw,createdAt:e.createdAt??e.reportedAt??e.reported_at,reportedAt:e.reportedAt??e.reported_at,scheduledAt:e.scheduledAt??e.scheduled_at,resolvedAt:e.resolvedAt??e.resolved_at,resolutionReport:e.resolutionReport??e.resolution_report,technicianId:e.technicianId??e.technician_id,repairCost:e.repairCost??e.repair_cost})}function l(e={}){return p(e)}function p(e={}){const t=e.id??e.ticketId??Date.now(),i=e.equipmentDesc??e.equipment_desc??e.equipmentDescription??e.equipment_name??"",n=q(e.status_raw??e.status??"open"),s=y(n),a=b(e,n);return{id:Number(t),equipmentId:e.equipment_id??e.equipmentId??null,equipmentBarcode:e.equipmentBarcode??e.equipment_barcode??"",equipmentDesc:i,issue:e.issue??e.notes??"",priority:S(e.priority??"medium"),status:s,statusRaw:n,statusLabel:a,createdAt:e.createdAt??e.reportedAt??e.reported_at??null,reportedAt:e.reportedAt??e.reported_at??null,scheduledAt:e.scheduledAt??e.scheduled_at??null,resolvedAt:e.resolvedAt??e.resolved_at??null,resolutionReport:e.resolutionReport??e.resolution_report??"",technicianId:e.technicianId??e.technician_id??null,repairCost:g(e.repairCost??e.repair_cost??e.repair_cost_value??null)}}function g(e){if(e==null||e==="")return null;const t=Number.parseFloat(h(String(e)));return!Number.isFinite(t)||t<0?null:Math.round(t*100)/100}function q(e){const t=String(e??"").trim();return t&&t.toLowerCase().replace(/\s+/g,"_").replace(/[^a-z0-9_\-]/g,"")||"open"}function y(e){const t=C(e);return["completed","cancelled"].includes(t)?"closed":"open"}function S(e){const t=String(e??"medium").trim().toLowerCase();return["low","medium","high"].includes(t)?t:"medium"}function b(e={},t="open"){const i=e.status_label??e.statusLabel??e.status_display??e.status_text??e.status??e.status_raw??t,n=String(i??"").trim();return n||t.replace(/[_-]+/g," ").replace(/\b\w/g,s=>s.toUpperCase())}function C(e){const t=String(e??"").toLowerCase();switch(t){case"open":case"قيد الصيانة":case"قيد الانتظار":return"open";case"in_progress":case"in-progress":case"جاري العمل":return"in_progress";case"completed":case"مكتمل":case"تم الإصلاح":case"closed":case"مغلق":return"completed";case"cancelled":case"ملغي":return"cancelled";default:return t.includes("progress")||t.includes("تنفيذ")?"in_progress":t.includes("complete")||t.includes("close")||t.includes("منجز")||t.includes("مغلق")?"completed":t.includes("cancel")||t.includes("ملغي")?"cancelled":t||"open"}}function M(){typeof window<"u"&&typeof window.dispatchEvent=="function"?window.dispatchEvent(new CustomEvent("maintenance:updated")):typeof dispatchEvent=="function"&&dispatchEvent(new CustomEvent("maintenance:updated"))}function P(e){return e instanceof f}export{C as a,v as b,I as c,L as d,E as g,P as i,d as m,D as r,z as u};
