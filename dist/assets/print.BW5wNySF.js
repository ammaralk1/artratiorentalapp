import{e as f}from"./calculations.BVcyzysX.js";import"./reservationsService.BGgi72ed.js";import"./auth.Dym-pMl4.js";import"./state.D0_ft4YH.js";const d=new Map;function u(e){if(!e)return Promise.resolve(null);const o=String(e);if(d.has(o))return d.get(o);const n=new Promise(t=>{try{const r=new Image;r.crossOrigin="anonymous",r.referrerPolicy="no-referrer",r.onload=()=>t(r),r.onerror=()=>t(null),r.src=o}catch{t(null)}});return d.set(o,n),n}function p(e=[]){return Promise.all((e||[]).map(o=>u(o)))}async function y(){try{document.fonts&&document.fonts.ready&&await document.fonts.ready}catch{}}function h(e){try{if(!e)return!1;const o=!!e.querySelector(".callsheet-v1 .cs-header, .callsheet-v1 .cs-info td, .callsheet-v1 .cs-cast td"),n=!!Array.from(e.querySelectorAll(".callsheet-v1 table.cs-crew tbody tr")).find(r=>{try{return Array.from(r.querySelectorAll("td")).some(a=>(a.textContent||"").trim().length>0)}catch{return!1}}),t=!!Array.from(e.querySelectorAll("table.tpl-table tbody tr")).find(r=>{try{return Array.from(r.querySelectorAll("td")).some(s=>(s.textContent||"").trim().length>0)}catch{return!1}});return o||n||t}catch{return!0}}async function C(e){if(!e)throw new Error("No host");let o=null;try{o=await f()}catch{o=null}const n=document.createElement("div");Object.assign(n.style,{position:"fixed",top:"0",left:"-12000px",pointerEvents:"none",zIndex:"-1",backgroundColor:"#ffffff"});const t=document.createElement("div");t.id="templates-a4-root",t.setAttribute("data-render-context","export"),t.setAttribute("dir",e.getAttribute("dir")||document.documentElement.getAttribute("dir")||"rtl");const r=document.createElement("div");r.setAttribute("data-a4-pages","");const a=e.querySelector("[data-a4-pages]")?.cloneNode(!0)||e.cloneNode(!0);a.classList&&a.hasAttribute("data-a4-pages")?t.appendChild(a):(r.appendChild(a),t.appendChild(r)),n.appendChild(t),document.body.appendChild(n);try{try{const c=Array.from(t.querySelectorAll(".cs-logo img")).map(m=>m.getAttribute("src")).filter(Boolean);await p(c)}catch{}if(await y(),Array.from(t.querySelectorAll(".a4-page")).forEach(c=>{h(c)||c.parentElement?.removeChild(c)}),typeof o=="function"){await o().set({margin:0,html2canvas:{scale:2,useCORS:!0,allowTaint:!1,backgroundColor:"#ffffff"},jsPDF:{unit:"mm",format:"a4",orientation:"landscape"},pagebreak:{mode:["css","legacy"]},image:{type:"jpeg",quality:.98}}).from(t).save("template-callsheet.pdf");return}const s=`<!doctype html><html dir="${t.getAttribute("dir")||"rtl"}"><head><meta charset="utf-8"><title>Call Sheet</title><style>@page{size:A4 landscape;margin:0}html,body{margin:0;padding:0;background:#fff}#templates-a4-root{transform:none!important}</style></head><body>${t.innerHTML}</body></html>`,l=document.createElement("iframe");Object.assign(l.style,{position:"fixed",right:"0",bottom:"0",width:"1px",height:"1px",border:"0"}),document.body.appendChild(l);const i=l.contentWindow?.document;i&&(i.open(),i.write(s),i.close(),l.onload=()=>{try{l.contentWindow?.focus(),l.contentWindow?.print()}catch{}setTimeout(()=>l.remove(),1200)})}finally{try{n.remove()}catch{}}}export{C as printCallsheetFromHost};
