import{b as f,s as m,g as p,l as v,c as h,d as a,a as R,i as y,h as b,f as g,u as d,j as E}from"./controller.BGb3luey.js";import{n as $,m as J,o as O,p as Q,k as W}from"./controller.BGb3luey.js";import{i as w,j as I}from"./reservationsService.DsCKObJ9.js";import{d as l,t as F}from"./auth.CaTIBjKG.js";import{e as T}from"./reservationsActions.D-nlWB5h.js";import{ensureProjectsLoaded as k}from"./projectsService.JneHZb0p.js";import"./state.CydgozDm.js";import"./uiBridge.BpQ02mb-.js";import"./quotePdf.WC1ebubv.js";import"./canvasColorUtils.CviLtv6S.js";let s=!1;function C(){document.querySelectorAll('input[type="time"]').forEach(t=>{t.setAttribute("step","300")})}function S(){return typeof window<"u"&&typeof window.flatpickr=="function"?window.flatpickr.bind(window):typeof globalThis<"u"&&typeof globalThis.flatpickr=="function"?globalThis.flatpickr.bind(globalThis):(console.warn("⚠️ Flatpickr غير متاح - سيتم تخطي تهيئة عناصر التاريخ"),null)}function L(){const e=S(),t={dateFormat:"Y-m-d",altInput:!0,altFormat:"Y-m-d",allowInput:!0,disableMobile:!0,altInputClass:"flatpickr-alt-input form-control"},r=[["#res-start",{}],["#res-end",{}],["#filter-start-date",{}],["#filter-end-date",{}],["#edit-res-start",{}],["#edit-res-end",{}]],i={enableTime:!0,noCalendar:!0,dateFormat:"H:i",altInput:!0,altFormat:"h:i K",time_24hr:!1,defaultHour:9,defaultMinute:0,disableMobile:!0,minuteIncrement:5,altInputClass:"flatpickr-alt-input form-control"},c=["#res-start-time","#res-end-time","#edit-res-start-time","#edit-res-end-time"];e&&(r.forEach(([n,u])=>{document.querySelector(n)&&e(n,{...t,...u})}),c.forEach(n=>{document.querySelector(n)&&e(n,{...i})}));const o=document.querySelector("#res-start-time");o&&o.dispatchEvent(new Event("change",{bubbles:!0}))}function A(){if(!s){C(),f(()=>a()),m(p()),w({onDraftChange:E,onEditChange:d}),v(),h(),s=!0;try{const e=()=>a();document.addEventListener("reservations:updated",e),window.addEventListener("reservations:updated",e)}catch{}}}function j(){const e=document.body;e&&e.dataset.reservationsTechListener!=="true"&&(document.addEventListener("technicians:updated",()=>{const{technicians:t=[]}=l();I(t),g(),d()}),e.dataset.reservationsTechListener="true")}function q(){try{const{reservations:e=[]}=l();return Array.isArray(e)&&e.length>0}catch{return!1}}function x(){const e=document.getElementById("reservations-list");if(!e||e.querySelector("[data-reservations-loader]"))return;const t=document.createElement("div");t.className="reservations-inline-loader",t.setAttribute("data-reservations-loader","true"),t.setAttribute("aria-live","polite");const r=F("reservations.list.loading","جارٍ تحميل الحجوزات...");t.innerHTML=`
    <div class="loading loading-spinner loading-lg text-primary" aria-hidden="true"></div>
    <p class="reservations-inline-loader__text">${r}</p>
  `,e.replaceChildren(t)}function D(){const e=document.getElementById("reservations-list");if(!e)return;const t=e.querySelector("[data-reservations-loader]");t&&t.remove()}async function K(){if(q())try{a()}catch{}else x();const[t,r]=await Promise.allSettled([T(),k({force:!0})]);t.status==="rejected"&&console.warn("⚠️ [reservations/events] Failed to load reservations from API",t.reason),r.status==="rejected"&&console.warn("⚠️ [reservations/events] Failed to pre-load projects for reservation form",r.reason),D();try{a()}catch(i){console.error("❌ [reservations/events] Failed to render reservations after load",i)}R(),y({onAfterSubmit:b}),s||A(),L(),j()}export{$ as confirmReservation,J as deleteReservation,p as getReservationsEditContext,b as handleReservationsMutation,y as initCreateReservationForm,K as initializeReservationUI,v as loadReservationForm,O as openReservationEditor,R as registerReservationGlobals,E as renderDraftReservationSummary,a as renderReservations,Q as setFlatpickrValue,m as setupEditReservationModalEvents,h as setupEquipmentDescriptionInputs,A as setupReservationEvents,W as showReservationDetails,d as updateEditReservationSummary};
