import{d as C,n as B,h as it,b as P,A as ce,a as st,m as ot,c as rt,i as ct,l as lt,p as ne,t as u,q as dt,v as qe,j as g,w as ut}from"./auth.BSvC8jn9.js";const ft=C()||{};let $=(ft.technicians||[]).map(he);function G(){return $}function O(e){return $=Array.isArray(e)?e.map(he):[],it({technicians:$}),typeof window<"u"&&typeof window.dispatchEvent=="function"?(window.dispatchEvent(new CustomEvent("technicians:updated")),typeof document<"u"&&typeof document.dispatchEvent=="function"&&document.dispatchEvent(new CustomEvent("technicians:updated"))):typeof dispatchEvent=="function"&&dispatchEvent(new CustomEvent("technicians:updated")),$}async function Fe(e={}){const t=new URLSearchParams;Object.entries(e).forEach(([a,l])=>{l!=null&&l!==""&&t.set(a,String(l))});const n=t.toString(),i=await P(`/technicians/${n?`?${n}`:""}`),s=i?.data??i;let o=[];Array.isArray(s)?o=s:s&&typeof s=="object"&&(Array.isArray(s.items)?o=s.items:Array.isArray(s.results)?o=s.results:Array.isArray(s.data)?o=s.data:Array.isArray(s.records)&&(o=s.records));const r=o.map(ae);return O(r)}async function ze(e){const t=await P("/technicians/",{method:"POST",body:e}),n=ae(t?.data??{});return O([...$,n]),n}async function me(e,t){const n=await P(`/technicians/?id=${encodeURIComponent(e)}`,{method:"PATCH",body:t}),i=ae(n?.data??{}),s=$.map(o=>String(o.id)===String(e)?i:o);return O(s),i}async function De(e){await P(`/technicians/?id=${encodeURIComponent(e)}`,{method:"DELETE"}),O($.filter(t=>String(t.id)!==String(e)))}function pe({name:e,phone:t,email:n,role:i,department:s,dailyWage:o,dailyTotal:r,status:a,notes:l,active:c=!0}){return{full_name:e??"",phone:t??"",email:n??null,specialization:i??"",department:s??null,daily_wage:o??0,daily_total:r??null,status:a??"available",notes:l??null,active:c?1:0}}function ae(e={}){return $e({id:e.id,full_name:e.full_name,phone:e.phone,email:e.email,specialization:e.specialization,department:e.department,daily_wage:e.daily_wage,daily_total:e.daily_total,status:e.status,notes:e.notes,active:e.active})}function he(e={}){return $e(e)}function $e(e={}){const t=e.id??e.technicianId??e.technician_id??e.ID??e.uuid??e._id??null,n=e.full_name??e.name??e.fullName??"",i=e.phone??"",s=e.email??null,o=e.specialization??e.role??e.position??"",r=e.department??e.team??"",a=we(e.daily_wage??e.dailyWage??e.wage??e.rate??0),l=we(e.daily_total??e.dailyTotal??e.total??e.total_wage??a),c=Ce(e.baseStatus??e.status??"available"),d=Ce(e.status??e.baseStatus??"available"),m=e.notes??"",f=e.active!=null?!!e.active:!0;return{id:t!=null?String(t):"",name:n,phone:i,email:s,role:o,department:r,dailyWage:a,dailyTotal:l,status:d,baseStatus:c,notes:m,active:f}}function we(e){const t=Number.parseFloat(B(String(e??"0")));return Number.isFinite(t)?Number(t.toFixed(2)):0}function Ce(e){switch(String(e??"").trim().toLowerCase()){case"available":case"Ù…ØªØ§Ø­":return"available";case"busy":case"Ù…Ø´ØºÙˆÙ„":case"Ù‚ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„":return"busy";case"leave":case"Ø¥Ø¬Ø§Ø²Ø©":case"Ø®Ø§Ø±Ø¬ Ø§Ù„Ø®Ø¯Ù…Ø©":return"leave";case"inactive":case"Ù…ØªÙˆÙ‚Ù":return"inactive";default:return"available"}}function Q(e){return e instanceof ce}const ln=Object.freeze(Object.defineProperty({__proto__:null,buildTechnicianPayload:pe,createTechnicianApi:ze,deleteTechnicianApi:De,getTechniciansState:G,isApiError:Q,mapLegacyTechnician:he,mapTechnicianFromApi:ae,refreshTechniciansFromApi:Fe,setTechniciansState:O,updateTechnicianApi:me},Symbol.toStringTag,{value:"Module"}));st();ot();rt();document.addEventListener("DOMContentLoaded",()=>{ct();const e=document.getElementById("logout-btn");e&&!e.dataset.listenerAttached&&(e.addEventListener("click",()=>lt()),e.dataset.listenerAttached="true")});function te(e){const t=Number(e)||0,i=ne()==="ar"?"ar-SA-u-nu-latn":"en-US",s=new Intl.NumberFormat(i,{minimumFractionDigits:0,maximumFractionDigits:0}).format(Math.round(t));return`${B(s)} SR`}function dn(e){return typeof e?.expensesTotal=="number"?e.expensesTotal:Array.isArray(e?.expenses)?e.expenses.reduce((t,n)=>t+(Number(n?.amount)||0),0):0}function un(e){const t=new Date,n=e?.start?new Date(e.start):null,i=e?.end?new Date(e.end):null;return n&&!Number.isNaN(n.getTime())&&n>t?"upcoming":i&&!Number.isNaN(i.getTime())&&i<t?"completed":"ongoing"}function fn(e,t){return e?e.length<=t?e:`${e.slice(0,t).trim()}â€¦`:""}function D(e=""){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function Me(e){return String(e||"").toLowerCase().replace(/[\u064B-\u0652]/g,"").replace(/[\.\-_/]+/g," ").replace(/\s+/g," ").trim()}const mt={producer:["producer","prod","line producer","executive producer","associate producer","Ù…Ù†ØªØ¬","Ø§Ù„Ù…Ù†ØªØ¬","Ù…Ù†ØªØ¬ Ù…Ù†ÙØ°","Ù…Ù†ØªØ¬ Ù…Ø´Ø§Ø±Ùƒ","Ù…Ù†ØªØ¬ Ø®Ø·ÙŠ"],director:["director","film director","Ù…Ø®Ø±Ø¬","Ø§Ù„Ù…Ø®Ø±Ø¬"],dop:["dop","d o p","director of photography","cinematographer","Ù…Ø¯ÙŠØ± ØªØµÙˆÙŠØ±","Ù…Ø¯ÙŠØ± Ø§Ù„ØªØµÙˆÙŠØ±","Ù…Ø¯ÙŠØ± ØªØµÙˆÙŠØ± Ø³ÙŠÙ†Ù…Ø§Ø¦ÙŠ"],camera_operator:["camera operator","camera-op","cameraman","videographer","Ù…Ø´ØºÙ„ ÙƒØ§Ù…ÙŠØ±Ø§","Ø§Ù„Ù…ØµÙˆØ±","Ù…ØµÙˆØ± ÙÙŠØ¯ÙŠÙˆ"],first_ac:["1st ac","first ac","first assistant camera","focus puller","fo puller","focus-puller","Ù…Ø³Ø§Ø¹Ø¯ Ù…ØµÙˆØ± Ø§ÙˆÙ„","Ù…Ø³Ø§Ø¹Ø¯ Ù…ØµÙˆØ± Ø£ÙˆÙ„","Ø³Ø§Ø­Ø¨ ÙÙˆÙƒØ³"],second_ac:["2nd ac","second ac","second assistant camera","clapper loader","loader","Ù…Ø³Ø§Ø¹Ø¯ Ù…ØµÙˆØ± Ø«Ø§Ù†ÙŠ","Ø§Ù„ÙƒÙ„Ø§Ù¾Ø±","Ù„ÙˆÙˆØ¯Ø±","Ù„ÙˆØ¯Ø±"],gaffer:["gaffer","chief lighting technician","Ù…Ø¯ÙŠØ± Ø§Ø¶Ø§Ø¡Ø©","Ù…Ø¯ÙŠØ± Ø¥Ø¶Ø§Ø¡Ø©","ÙƒØ¨ÙŠØ± ÙÙ†ÙŠÙŠ Ø§Ù„Ø§Ø¶Ø§Ø¡Ø©","ÙƒØ¨ÙŠØ± ÙÙ†ÙŠÙŠ Ø§Ù„Ø¥Ø¶Ø§Ø¡Ø©"],best_boy_electric:["best boy electric","assistant gaffer","best boy","Ù…Ø³Ø§Ø¹Ø¯ Ø¬Ø§ÙØ±","Ù†Ø§Ø¦Ø¨ Ù…Ø¯ÙŠØ± Ø§Ù„Ø§Ø¶Ø§Ø¡Ø©","Ù†Ø§Ø¦Ø¨ Ù…Ø¯ÙŠØ± Ø§Ù„Ø¥Ø¶Ø§Ø¡Ø©"],electrician:["electrician","spark","sparks","ÙÙ†ÙŠ ÙƒÙ‡Ø±Ø¨Ø§Ø¡","Ø³Ø¨Ø§Ø±Ùƒ"],key_grip:["key grip","chief grip","Ø±Ø¦ÙŠØ³ Ø¬Ø±Ø¨","Ø±Ø¦ÙŠØ³ Ø§Ù„Ø¬Ø±Ø¨","ÙƒØ¨ÙŠØ± Ø§Ù„ÙÙ†ÙŠÙŠÙ† Ø§Ù„Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠÙŠÙ†"],best_boy_grip:["best boy grip","assistant key grip","Ù†Ø§Ø¦Ø¨ Ø±Ø¦ÙŠØ³ Ø§Ù„Ø¬Ø±Ø¨","Ù…Ø³Ø§Ø¹Ø¯ ÙƒØ§ÙŠ Ø¬Ø±Ø¨"],grip:["grip","grips","rigger","rigging","Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠ","Ø±ÙŠØ¬Ø±"],sound_mixer:["production sound mixer","sound mixer","mixer","Ù…Ù‡Ù†Ø¯Ø³ ØµÙˆØª","Ù…ÙŠÙƒØ³Ø± ØµÙˆØª"],boom_operator:["boom operator","boom op","boom","Ø­Ø§Ù…Ù„ Ø§Ù„Ø¨ÙˆÙ…","ÙÙ†ÙŠ Ù…Ø§ÙŠÙƒ","Ø¨ÙˆÙˆÙ…"],sound_assistant:["sound assistant","assistant sound","ÙÙ†ÙŠ ØµÙˆØª Ù…Ø³Ø§Ø¹Ø¯"],script_supervisor:["script supervisor","continuity","script","Ø³ÙƒØ±Ø¨Øª","Ù…Ø³Ø¬Ù„ Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ","ÙƒÙˆÙ†ØªÙŠÙ†ÙˆÙŠØªÙŠ"],location_manager:["location manager","Ù„ÙˆÙƒÙŠØ´Ù† Ù…Ø§Ù†Ø¬Ø±","Ù…Ø¯ÙŠØ± Ù…ÙˆØ§Ù‚Ø¹","Ù…Ø³Ø¤ÙˆÙ„ Ù…ÙˆØ§Ù‚Ø¹","Ù…Ø¯ÙŠØ± Ø§Ù„Ù„ÙˆÙƒÙŠØ´Ù†"],first_ad:["1st assistant director","first assistant director","1st ad","1 ad","first ad","assistant director","Ù…Ø³Ø§Ø¹Ø¯ Ù…Ø®Ø±Ø¬","Ù…Ø³Ø§Ø¹Ø¯ Ù…Ø®Ø±Ø¬ Ø§ÙˆÙ„","Ù…Ø³Ø§Ø¹Ø¯ Ù…Ø®Ø±Ø¬ Ø£ÙˆÙ„"],second_ad:["2nd assistant director","second assistant director","2nd ad","second ad","2 ad","Ù…Ø³Ø§Ø¹Ø¯ Ù…Ø®Ø±Ø¬ Ø«Ø§Ù†ÙŠ"],production_manager:["production manager","pm","Ù…Ø¯ÙŠØ± Ø§Ù†ØªØ§Ø¬","Ù…Ø¯ÙŠØ± Ø¥Ù†ØªØ§Ø¬"],production_coordinator:["production coordinator","pc","Ù…Ù†Ø³Ù‚ Ø§Ù†ØªØ§Ø¬","Ù…Ù†Ø³Ù‚ Ø¥Ù†ØªØ§Ø¬"],production_assistant:["production assistant","pa","runner","production runner","Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù†ØªØ§Ø¬","Ù…Ø³Ø§Ø¹Ø¯ Ø¥Ù†ØªØ§Ø¬","Ø¹Ø¯Ø§Ø¡"],art_director:["art director","Ù…Ø¯ÙŠØ± ÙÙ†ÙŠ","Ø¢Ø±Øª Ø¯Ø§ÙŠØ±ÙƒØªÙˆØ±"],production_designer:["production designer","Ù…ØµÙ…Ù… Ø§Ù„Ø§Ù†ØªØ§Ø¬","Ù…ØµÙ…Ù… Ø§Ù„Ø¥Ù†ØªØ§Ø¬","Ù…ØµÙ…Ù… Ø§Ù„Ø¯ÙŠÙƒÙˆØ±"],props_master:["props master","property master","Ø±Ø¦ÙŠØ³ Ø§Ù„Ø§ÙƒØ³Ø³ÙˆØ§Ø±","Ø±Ø¦ÙŠØ³ Ø§Ù„Ø¥ÙƒØ³Ø³ÙˆØ§Ø±","Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø§ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª","Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª"],set_dresser:["set dresser","dressing","Ù…Ø¬Ù‡Ø² Ø¯ÙŠÙƒÙˆØ±","ÙÙ†ÙŠ Ø¯ÙŠÙƒÙˆØ±"],wardrobe:["wardrobe","costume designer","Ù…ØµÙ…Ù… Ø§Ø²ÙŠØ§Ø¡","Ù…ØµÙ…Ù… Ø£Ø²ÙŠØ§Ø¡","Ù…Ø³Ø¤ÙˆÙ„ Ù…Ù„Ø§Ø¨Ø³"],makeup_artist:["makeup artist","makeup","mua","Ø®Ø¨ÙŠØ± ØªØ¬Ù…ÙŠÙ„","Ù…Ø§ÙƒÙŠÙŠØ±","Ù…ÙƒÙŠØ§Ø¬"],hair_stylist:["hair stylist","hair","Ù…ØµÙÙ Ø´Ø¹Ø±"],colorist:["colorist","grading","grader","ØªÙ„ÙˆÙŠÙ†","Ù…ØµØ­Ø­ Ø§Ù„ÙˆØ§Ù†","Ù…ØµØ­Ø­ Ø£Ù„ÙˆØ§Ù†","Ø¬Ø±ÙŠØ¯ÙŠÙ†Ø¬","Ø¬Ø±ÙŠØ¯ÙŠÙ†Øº"],editor:["editor","video editor","Ù…ÙˆÙ†ØªÙŠØ±","Ù…Ø­Ø±Ø± ÙÙŠØ¯ÙŠÙˆ"],vfx:["vfx","visual effects","Ù…Ø¤Ø«Ø±Ø§Øª Ø¨ØµØ±ÙŠØ©"],dit:["dit","digital imaging technician","ÙÙ†ÙŠ ØµÙˆØ±Ø© Ø±Ù‚Ù…ÙŠ","Ø¯ÙŠ Ø§ÙŠ ØªÙŠ","Ø¯ÙŠ Ø¢ÙŠ ØªÙŠ"],data_wrangler:["data wrangler","data manager","loader data","Ù†Ø³Ø® Ø¨ÙŠØ§Ù†Ø§Øª","Ù…Ø³Ø¤ÙˆÙ„ Ø¨ÙŠØ§Ù†Ø§Øª"],steadicam_operator:["steadicam operator","steadicam","steadycam","Ù…Ø´ØºÙ„ Ø³ØªÙŠÙŠØ¯ÙŠÙƒØ§Ù…","Ù…Ø´ØºÙ„ Ø³ØªÙŠÙƒØ¯ÙŠØ§Ù…","Ù…Ø´ØºÙ„ Ø³ØªÙŠØ¯ÙŠÙƒØ§Ù…"],gimbal_operator:["gimbal operator","gimbal","ronin operator","ronin","Ù…Ø´ØºÙ„ Ø¬ÙŠÙ…Ø¨Ø§Ù„","Ù…Ø´ØºÙ„ Ø±ÙˆÙ†ÙŠÙ†"],drone_operator:["drone operator","drone op","uav pilot","drone pilot","Ù…Ø´ØºÙ„ Ø¯Ø±ÙˆÙ†","Ø·ÙŠØ§Ø± Ø¯Ø±ÙˆÙ†","Ø·ÙŠØ§Ø± Ù…Ø³ÙŠØ±Ø©"],photographer:["photographer","stills photographer","still photographer","Ù…ØµÙˆÙ‘Ø± ÙÙˆØªÙˆØºØ±Ø§ÙÙŠ","Ù…ØµÙˆØ± ÙÙˆØªÙˆØºØ±Ø§ÙÙŠ","ÙÙˆØªÙˆØºØ±Ø§ÙØ±"],bts_photographer:["bts photographer","behind the scenes photographer","bts","Ù…ØµÙˆØ± ÙƒÙˆØ§Ù„ÙŠØ³"],teleprompter:["teleprompter operator","teleprompter","prompt operator","Ù…Ø´ØºÙ„ ØªÙ„ÙŠØ¨Ø±ÙˆÙ…Ø¨ØªØ±","Ù…Ø´ØºÙ„ ØªÙ„Ù‚ÙŠÙ†"],driver:["driver","Ø³Ø§Ø¦Ù‚"],lighting_technician:["lighting technician","lighting tech","electric","ÙÙ†ÙŠ Ø§Ø¶Ø§Ø¡Ø©","ÙÙ†ÙŠ Ø¥Ø¶Ø§Ø¡Ø©"]},pt=(()=>{const e=new Map;return Object.values(mt).forEach(t=>{const n=Array.from(new Set(t.map(Me)));n.forEach(i=>{const s=new Set(n);s.delete(i),e.set(i,s)})}),e})();function ht(e){const t=Me(e);if(!t)return[];const n=pt.get(t);return n?Array.from(n):[]}const gt="technicianPositions:updated";let T=[],xe=!1,H=null;function ge(e={}){return{id:Number(e.id)||0,name:String(e.name??"").trim(),labelAr:typeof e.label_ar=="string"?e.label_ar.trim():null,labelEn:typeof e.label_en=="string"?e.label_en.trim():null,cost:Number.parseFloat(e.cost??0)||0,clientPrice:e.client_price==null?null:Number.parseFloat(e.client_price),createdAt:e.created_at??null,updatedAt:e.updated_at??null}}function Re({name:e,cost:t,clientPrice:n,labelAr:i,labelEn:s}){return{name:String(e??"").trim(),cost:t??0,client_price:n,label_ar:i??null,label_en:s??null}}function bt(e){return T=Array.isArray(e)?e.map(ge).filter(t=>t.name!=="").sort((t,n)=>j(t).localeCompare(j(n),"ar",{sensitivity:"base"})):[],xe=!0,ie(),q()}function ie(){try{const e={positions:q()},t=new CustomEvent(gt,{detail:e});typeof window<"u"&&window.dispatchEvent(t),typeof document<"u"&&document.dispatchEvent(t)}catch(e){console.warn("[technicianPositions] Failed to dispatch update event",e)}}function j(e={}){return(e.labelAr||e.labelEn||e.name||"").toLowerCase()}function q(){return T.map(e=>({...e}))}function yt(e){const t=String(e??"").trim().toLowerCase();if(!t)return null;const n=(s,o)=>{const r=String(o||"").toLowerCase();return r?!!(s.name&&String(s.name).toLowerCase()===r||s.labelAr&&String(s.labelAr).toLowerCase()===r||s.labelEn&&String(s.labelEn).toLowerCase()===r):!1};let i=T.find(s=>n(s,t))||null;if(i)return i;try{const s=ht(t)||[];for(const o of s)if(i=T.find(r=>n(r,o))||null,i)return i}catch{}return null}async function It({forceRefresh:e=!1}={}){return xe&&!e?q():(H&&!e||(H=P("/technician-positions/").then(t=>{const n=Array.isArray(t?.data)?t.data:[];return bt(n)}).finally(()=>{H=null})),H)}async function se({forceRefresh:e=!1}={}){try{return await It({forceRefresh:e})}catch(t){throw t instanceof ce?t:new ce(t?.message||u("positions.toast.fetchFailed","âš ï¸ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†Ø§ØµØ¨ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰"))}}async function St({name:e,cost:t,clientPrice:n,labelAr:i,labelEn:s}){const o=Re({name:e,cost:t,clientPrice:n,labelAr:i,labelEn:s}),r=await P("/technician-positions/",{method:"POST",body:o}),a=ge(r?.data??{});return T=[...T,a],T.sort((l,c)=>j(l).localeCompare(j(c),"ar",{sensitivity:"base"})),ie(),a}async function vt(e,{name:t,cost:n,clientPrice:i,labelAr:s,labelEn:o}){if(!e)throw new Error("Position id is required");const r=Re({name:t,cost:n,clientPrice:i,labelAr:s,labelEn:o}),a=await P(`/technician-positions/?id=${encodeURIComponent(e)}`,{method:"PATCH",body:r}),l=ge(a?.data??{});return T=T.map(c=>c.id===l.id?l:c),T.sort((c,d)=>j(c).localeCompare(j(d),"ar",{sensitivity:"base"})),ie(),l}async function Et(e){if(!e)throw new Error("Position id is required");return await P(`/technician-positions/?id=${encodeURIComponent(e)}`,{method:"DELETE"}),T=T.filter(t=>t.id!==Number(e)),ie(),q()}const le="__ART_RATIO_TECH_SUB_TAB__",je=["technicians-management","technicians-positions"];let E=null,Ne=!1,ee=!1,K="",de=!1,w=null,M="technicians-management";const Le=_t();Le&&(M=Le);async function Ue({showToastOnError:e=!0}={}){if(!ee){ee=!0,K="",v();try{await Fe(),de=!0}catch(t){console.error("âŒ [technicians] loadTechniciansFromApi failed",t),K=Q(t)?t.message:u("technicians.toast.fetchFailed","ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ø§Ù‚Ù…ØŒ Ø­Ø§ÙˆÙ„ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©"),e&&g(K,"error")}finally{ee=!1,v()}}}function ke(){return G()}function Y(e=""){return B(String(e)).trim().toLowerCase()}function At(e){return e==null?"":String(e)}function U(e=""){return B(String(e)).replace(/[^0-9+]/g,"")}function _(e=""){const t=B(String(e)).replace(/[^0-9.]/g,"");if(!t.includes("."))return t;const[n,...i]=t.split(".");return`${n}.${i.join("")}`}function R(e,t){!e||e.dataset.normalizerAttached||(e.addEventListener("input",()=>{const n=t(e.value);if(e.value!==n){const i=e.selectionEnd;e.value=n,i!=null&&e.setSelectionRange(n.length,n.length)}}),e.dataset.normalizerAttached="true")}function _t(){try{if(typeof window>"u"||!window.localStorage)return null;const e=window.localStorage.getItem(le);return e&&je.includes(e)?e:null}catch(e){return console.warn("âš ï¸ [technicians] Failed to read stored sub-tab",e),null}}function Tt(e){try{if(typeof window>"u"||!window.localStorage)return;if(!je.includes(e)){window.localStorage.removeItem(le);return}window.localStorage.setItem(le,e)}catch(t){console.warn("âš ï¸ [technicians] Failed to store sub-tab",t)}}function Ve(e,t=0,n=null){const i=String(e??"").trim(),s=i?yt(i):null;return s?{matchedPosition:s,dailyWage:Number.isFinite(s.cost)?s.cost:0,dailyTotal:s.clientPrice==null?null:Number.isFinite(s.clientPrice)?s.clientPrice:0}:{matchedPosition:null,dailyWage:Number.isFinite(t)?t:0,dailyTotal:n==null?null:Number.isFinite(n)?n:0}}function Oe(){const e=document.getElementById("technician-position-summary"),t=document.getElementById("technician-position-summary-body");return{container:e,body:t}}function ue(e,t=ne()){return e?t==="ar"?e.labelAr||e.labelEn||e.name||"":e.labelEn||e.labelAr||e.name||"":""}function Bt(e,t=ne()){return t==="ar"?e.labelEn||e.labelAr||e.name||"":e.labelAr||e.labelEn||e.name||""}function He(){const{container:e,body:t}=Oe();!e||!t||(t.textContent="",e.hidden=!0)}function be(e,t={}){const{container:n,body:i}=Oe();if(!n||!i)return;const s=String(e??"").trim();if(!s){He();return}const o=Ve(s,t?.dailyWage??0,t?.dailyTotal??null),r=te(o.dailyWage||0),a=o.dailyTotal!=null?te(o.dailyTotal):u("technicians.positionSummary.noClientPrice","â€”");o.matchedPosition?i.textContent=u("technicians.positionSummary.match","Ø§Ù„ØªÙƒÙ„ÙØ©: {cost} Â· Ø³Ø¹Ø± Ø§Ù„Ø¹Ù…ÙŠÙ„: {price}").replace("{cost}",r).replace("{price}",a):i.textContent=u("technicians.positionSummary.custom","Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù†ØµØ¨ Ù…Ø·Ø§Ø¨Ù‚. ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØªÙ‡ Ù…Ù† ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ù†Ø§ØµØ¨. Ø³ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: {cost} Â· Ø³Ø¹Ø± Ø§Ù„Ø¹Ù…ÙŠÙ„: {price}").replace("{cost}",r).replace("{price}",a),n.hidden=!1}function Z(){const e=document.getElementById("technician-position-options");if(!e)return;const t=q(),n=ne(),i=new Set,s=[];t.forEach(o=>{const r=ue(o,n).trim();r&&!i.has(r.toLowerCase())&&(s.push(`<option value="${D(r)}"></option>`),i.add(r.toLowerCase()));const a=Bt(o,n).trim();a&&!i.has(a.toLowerCase())&&(s.push(`<option value="${D(a)}"></option>`),i.add(a.toLowerCase()));const l=o.name?.trim();l&&!i.has(l.toLowerCase())&&(s.push(`<option value="${D(l)}"></option>`),i.add(l.toLowerCase()))}),e.innerHTML=s.join("")}function Pe(e){const t=Array.from(document.querySelectorAll("[data-tech-tab]")),n=Array.from(document.querySelectorAll("[data-tech-tab-panel]")),s=t.map(a=>a?.getAttribute("data-tech-tab")).filter(Boolean).includes(e)?e:"technicians-management";t.forEach(a=>{if(!a)return;const c=a.getAttribute("data-tech-tab")===s;a.classList.toggle("tab-active",c),a.classList.toggle("active",c),a.setAttribute("aria-selected",c?"true":"false"),a.setAttribute("tabindex",c?"0":"-1")}),n.forEach(a=>{if(!a)return;const c=a.getAttribute("data-tech-tab-panel")===s;a.hidden=!c,a.classList.toggle("active",c)}),M=s,Tt(s);const r=t.find(a=>a?.getAttribute("data-tech-tab")===s)?.closest("[data-tab-scroll]");r&&r.dispatchEvent(new CustomEvent("tabScroll:update",{bubbles:!0})),s==="technicians-positions"&&(N(),se().then(()=>{N()}).catch(a=>{console.error("âŒ [technicians] failed to load positions for tab switch",a),g(a?.message||u("positions.toast.fetchFailed","âš ï¸ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†Ø§ØµØ¨ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰"),"error")}))}function ye(e="add"){const t=document.getElementById("technician-submit-btn");if(!t)return;const n=e==="update"?"technicians.form.actions.update":"technicians.form.actions.submit",i=e==="update"?"ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„":"â• Ø¥Ø¶Ø§ÙØ© Ø¹Ø¶Ùˆ Ø·Ø§Ù‚Ù…";t.textContent=u(n,i)}function Ie(e){const t=document.getElementById("technician-cancel-btn");t&&(e?t.classList.remove("d-none"):t.classList.add("d-none"),t.textContent=u("technicians.form.actions.cancel","Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„"))}function Se(){ye(E?"update":"add"),Ie(!!E),v()}function wt(e=[]){const t=document.getElementById("technician-role-filter");if(!t)return"";const n=t.value,i=Array.from(new Set(e.map(o=>(o?.role||"").trim()).filter(Boolean))).sort((o,r)=>o.localeCompare(r,"ar",{sensitivity:"base"})),s=u("technicians.search.filters.allRoles","ğŸ‘” ÙƒÙ„ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù");return t.innerHTML=`<option value="">${s}</option>`+i.map(o=>`<option value="${o}">${o}</option>`).join(""),n&&i.includes(n)?t.value=n:t.value="",t.value}function oe(){const e=document.getElementById("technician-form");e&&(e.reset(),E=null,ye("add"),Ie(!1),He())}function Ct(e){const t=document.getElementById("technician-name"),n=document.getElementById("technician-phone"),i=document.getElementById("technician-email"),s=document.getElementById("technician-role"),o=document.getElementById("technician-department"),r=document.getElementById("technician-notes");!t||!n||!s||(t.value=e.name||"",n.value=U(e.phone||""),i&&(i.value=e.email||""),s.value=e.role||"",o&&(o.value=e.department||""),r&&(r.value=e.notes||""),E=String(e.id),ye("update"),Ie(!0),be(s.value,e))}function Nt(){const e=document.getElementById("technician-name"),t=document.getElementById("technician-phone"),n=document.getElementById("technician-email"),i=document.getElementById("technician-role"),s=document.getElementById("technician-department"),o=document.getElementById("technician-notes");if(!e||!t||!i)return null;const r=e.value.trim(),a=U(t.value.trim());t.value=a;const l=(n?.value||"").trim(),c=i.value.trim(),d=s?.value.trim()||"",m="available",f=o?.value.trim()||"",h=E?Ke(E):null,{dailyWage:p,dailyTotal:b}=Ve(c,h?.dailyWage??0,h?.dailyTotal??null);return r?a?c?!Number.isFinite(p)||p<0?(g(u("positions.toast.invalidCost","âš ï¸ Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© ØµØ­ÙŠØ­Ø© Ù„Ù„ØªÙƒÙ„ÙØ©")),null):b!=null&&(!Number.isFinite(b)||b<0)?(g(u("positions.toast.invalidClientPrice","âš ï¸ Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© ØµØ­ÙŠØ­Ø© Ù„Ø³Ø¹Ø± Ø§Ù„Ø¹Ù…ÙŠÙ„")),null):(be(c,{dailyWage:p,dailyTotal:b}),{name:r,phone:a,email:l,role:c,department:d,dailyWage:Number.isFinite(p)?p:0,dailyTotal:b==null?null:Number(b),status:m,baseStatus:m,notes:f}):(g(u("technicians.toast.missingRole","âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙˆØ¸ÙŠÙØ©")),i.focus(),null):(g(u("technicians.toast.missingPhone","âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„ØªÙˆØ§ØµÙ„")),t.focus(),null):(g(u("technicians.toast.missingName","âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…")),e.focus(),null)}async function Lt(e){e.preventDefault();try{await se()}catch(i){console.error("âŒ [technicians] failed to load positions before submit",i);const s=i?.message||u("positions.toast.fetchFailed","âš ï¸ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†Ø§ØµØ¨ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰");g(s,"error");return}const t=Nt();if(!t)return;const n=pe({name:t.name,phone:t.phone,email:t.email||null,role:t.role,department:t.department,dailyWage:t.dailyWage,dailyTotal:t.dailyTotal,status:t.status,notes:t.notes,active:!0});try{E?(await me(E,n),g(u("technicians.toast.updateSuccess","ğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…"))):(await ze(n),g(u("technicians.toast.addSuccess","âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…"))),oe(),v()}catch(i){console.error("âŒ [technicians] handleTechnicianSubmit failed",i);const s=Q(i)?i.message:u("technicians.toast.saveFailed","ØªØ¹Ø°Ø± Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰");g(s,"error")}}function Pt(){oe()}function qt(e){const t={id:document.getElementById("edit-technician-id"),name:document.getElementById("edit-technician-name"),phone:document.getElementById("edit-technician-phone"),email:document.getElementById("edit-technician-email"),role:document.getElementById("edit-technician-role"),department:document.getElementById("edit-technician-department"),wage:document.getElementById("edit-technician-wage"),total:document.getElementById("edit-technician-total"),status:document.getElementById("edit-technician-status"),notes:document.getElementById("edit-technician-notes")};if(!t.id||!t.name||!t.phone||!t.role||!t.wage||!t.total||!t.status)return;t.id.value=e.id||"",t.name.value!==(e.name||"")&&(t.name.value=e.name||"");const n=U(e.phone||"");t.phone.value!==n&&(t.phone.value=n),t.email&&t.email.value!==(e.email||"")&&(t.email.value=e.email||""),t.role.value!==(e.role||"")&&(t.role.value=e.role||""),t.department&&t.department.value!==(e.department||"")&&(t.department.value=e.department||"");const i=_(e.dailyWage!=null?e.dailyWage:"");t.wage.value!==i&&(t.wage.value=i);const s=_(e.dailyTotal!=null?e.dailyTotal:"");t.total.value!==s&&(t.total.value=s);const o=e.baseStatus||e.status||"available";t.status.value!==o&&(t.status.value=o),t.notes&&t.notes.value!==(e.notes||"")&&(t.notes.value=e.notes||""),R(t.phone,U),R(t.wage,_),R(t.total,_)}function Ft(){const e=document.getElementById("edit-technician-id"),t=document.getElementById("edit-technician-name"),n=document.getElementById("edit-technician-phone"),i=document.getElementById("edit-technician-email"),s=document.getElementById("edit-technician-role"),o=document.getElementById("edit-technician-department"),r=document.getElementById("edit-technician-wage"),a=document.getElementById("edit-technician-total"),l=document.getElementById("edit-technician-status"),c=document.getElementById("edit-technician-notes");if(!e||!t||!n||!s||!r||!a||!l)return null;const d=e.value.trim(),m=t.value.trim(),f=U(n.value.trim());n.value=f;const h=(i?.value||"").trim(),p=s.value.trim(),b=o?.value.trim()||"",y=_(r.value.trim());r.value=y;const S=y===""?0:parseFloat(y),F=_(a.value.trim());a.value=F;const z=F===""?null:parseFloat(F),Be=l.value||"available",at=c?.value.trim()||"";return d?m?f?p?Number.isNaN(S)||S<0?(g(u("technicians.toast.invalidWage","âš ï¸ Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© ØµØ­ÙŠØ­Ø© Ù„Ù„Ø£Ø¬Ø± Ø§Ù„ÙŠÙˆÙ…ÙŠ")),r.focus(),null):z!=null&&(Number.isNaN(z)||z<0)?(g(u("technicians.toast.invalidTotal","âš ï¸ Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© ØµØ­ÙŠØ­Ø© Ù„Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©")),a.focus(),null):{id:d,name:m,phone:f,email:h,role:p,department:b,dailyWage:Number.isFinite(S)?S:0,dailyTotal:z==null?null:Number(z),status:Be,baseStatus:Be,notes:at}:(g(u("technicians.toast.missingRole","âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙˆØ¸ÙŠÙØ©")),s.focus(),null):(g(u("technicians.toast.missingPhone","âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„ØªÙˆØ§ØµÙ„")),n.focus(),null):(g(u("technicians.toast.missingName","âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…")),t.focus(),null):(g(u("technicians.toast.unidentified","âš ï¸ ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ¯ Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨")),null)}async function zt(){const e=Ft();if(!e)return;const t=pe({name:e.name,phone:e.phone,email:e.email||null,role:e.role,department:e.department,dailyWage:e.dailyWage,dailyTotal:e.dailyTotal,status:e.status,notes:e.notes,active:!0});try{await me(e.id,t),g(u("technicians.toast.updateSuccess","ğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…"));const n=document.getElementById("editTechnicianModal");n&&window.bootstrap?.Modal&&window.bootstrap.Modal.getInstance(n)?.hide(),v()}catch(n){console.error("âŒ [technicians] handleTechnicianModalSave failed",n);const i=Q(n)?n.message:u("technicians.toast.updateFailed","ØªØ¹Ø°Ø± Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…");g(i,"error")}}function v(){const e=document.getElementById("technicians-table");if(!e)return;const t=document.getElementById("search-technician-input"),n=Y(t?.value||"");if(ee&&!de){const c=u("technicians.table.loading","Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...");e.innerHTML=`<tr><td colspan='6'>${c}</td></tr>`;return}if(K&&!de){e.innerHTML=`<tr><td colspan='6' class='text-danger'>${K}</td></tr>`;return}const i=Ee(),{reservations:s=[]}=C(),o=new Date;wt(i);const r=document.getElementById("technician-role-filter"),a=Y(r?.value||""),l=i.filter(c=>a&&Y(c.role||"")!==a?!1:n?Y([c.name,c.phone,c.email,c.role,c.department,c.notes].filter(Boolean).join(" ")).includes(n):!0);if(l.length===0){const c=u("technicians.table.empty","Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø¹Ø¶Ø§Ø¡ ÙÙŠ Ø§Ù„Ø·Ø§Ù‚Ù… Ø¨Ø¹Ø¯.");e.innerHTML=`<tr><td colspan='6'>${c}</td></tr>`;return}e.innerHTML=l.map(c=>{const d=E&&String(E)===String(c.id),h=(Ge(c.id,s,o)?"busy":c.status||c.baseStatus||"available")==="busy"?{label:u("technicians.status.busy","â›” Ù…Ø´ØºÙˆÙ„"),className:"technician-status-badge technician-status-badge--busy"}:{label:u("technicians.status.available","âœ… Ù…ØªØ§Ø­"),className:"technician-status-badge technician-status-badge--available"},p=u("technicians.actions.edit","âœï¸ ØªØ¹Ø¯ÙŠÙ„"),b=u("technicians.actions.delete","ğŸ—‘ï¸ Ø­Ø°Ù"),y=qe(),S=[`<button type="button" class="technician-action-btn technician-action-btn--edit technician-edit-btn" data-id="${c.id}">${p}</button>`];return y&&S.push(`<button type="button" class="technician-action-btn technician-action-btn--delete technician-delete-btn" data-id="${c.id}">${b}</button>`),`
      <tr${d?' class="technician-table-row-editing"':""}>
        <td><a href="technician.html?id=${c.id}" class="text-decoration-none">${c.name}</a></td>
        <td>${c.role||""}</td>
        <td>${c.department||"â€”"}</td>
        <td><span class="${h.className}"><span class="technician-status-badge__text">${h.label}</span></span></td>
        <td class="table-notes-cell">${c.notes||"â€”"}</td>
        <td class="table-actions-cell">
          <div class="table-action-buttons">
            ${S.join("")}
          </div>
        </td>
      </tr>
    `}).join("")}function re(){return{form:document.getElementById("position-form"),idInput:document.getElementById("position-id"),nameArInput:document.getElementById("position-name-ar"),nameEnInput:document.getElementById("position-name-en"),costInput:document.getElementById("position-cost"),clientPriceInput:document.getElementById("position-client-price"),submitBtn:document.getElementById("position-submit-btn"),cancelBtn:document.getElementById("position-cancel-btn")}}function We(e="add"){const{submitBtn:t,cancelBtn:n}=re(),i=e==="update";if(t){const s=i?"positions.form.actions.update":"positions.form.actions.submit",o=i?"ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØµØ¨":"â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØµØ¨";t.textContent=u(s,o)}n&&(n.classList.toggle("d-none",!i),n.textContent=u("positions.form.actions.cancel","Ø¥Ù„ØºØ§Ø¡"))}function ve(){const{form:e,idInput:t,nameArInput:n,nameEnInput:i,costInput:s,clientPriceInput:o}=re();e&&e.reset(),t&&(t.value=""),n&&(n.value=""),i&&(i.value=""),s&&(s.value=""),o&&(o.value=""),w=null,We("add")}function Dt(e){const{idInput:t,nameArInput:n,nameEnInput:i,costInput:s,clientPriceInput:o}=re();!e||!s||(t&&(t.value=e.id||""),n&&(n.value=e.labelAr||""),i&&(i.value=e.labelEn||""),s.value=_(e.cost??0),o&&(o.value=e.clientPrice==null?"":_(e.clientPrice)),w=e.id||null,We("update"))}function $t(){const{nameArInput:e,nameEnInput:t,costInput:n,clientPriceInput:i}=re();if(!n)return null;const s=e?.value.trim()||"",o=t?.value.trim()||"",r=o||s,a=w?q().find(f=>String(f.id)===String(w)):null,l=_(n.value.trim());n.value=l;const c=l===""?0:parseFloat(l),d=i?_(i.value.trim()):"";i&&(i.value=d);const m=d===""?null:parseFloat(d);return r?!Number.isFinite(c)||c<0?(g(u("positions.toast.invalidCost","âš ï¸ Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© ØµØ­ÙŠØ­Ø© Ù„Ù„ØªÙƒÙ„ÙØ©")),n.focus(),null):m!=null&&(!Number.isFinite(m)||m<0)?(g(u("positions.toast.invalidClientPrice","âš ï¸ Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© ØµØ­ÙŠØ­Ø© Ù„Ø³Ø¹Ø± Ø§Ù„Ø¹Ù…ÙŠÙ„")),i?.focus(),null):{id:w,name:a?.name||r,cost:Number(c.toFixed(2)),clientPrice:m==null?null:Number(m.toFixed(2)),labelAr:s||null,labelEn:o||null}:(g(u("positions.toast.invalidName","âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØµØ¨")),e&&e.focus(),null)}function k(){const e=document.getElementById("technician-role");if(!e)return;const t=E?Ke(E):null;be(e.value,t||{})}function N(){const e=document.getElementById("positions-table"),t=document.getElementById("positions-count");if(!e)return;const n=q();if(t&&(t.textContent=B(String(n.length))),!n.length){e.innerHTML=`
      <tr>
        <td colspan="5">${u("positions.table.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†Ø§ØµØ¨ Ø¨Ø¹Ø¯.")}</td>
      </tr>
    `;return}e.innerHTML=n.map(i=>{const s=w&&String(w)===String(i.id),o=te(i.cost||0),r=i.clientPrice==null?u("technicians.positionSummary.noClientPrice","â€”"):te(i.clientPrice),a=ue(i,"ar")||"â€”",l=ue(i,"en")||"â€”",c=u("positions.table.actions.edit","âœï¸ ØªØ¹Ø¯ÙŠÙ„"),d=u("positions.table.actions.delete","ğŸ—‘ï¸ Ø­Ø°Ù");return`
      <tr${s?' class="technician-table-row-editing"':""}>
        <td>${D(a)}</td>
        <td>${D(l)}</td>
        <td>${D(o)}</td>
        <td>${D(r)}</td>
        <td class="table-actions-cell">
          <div class="table-action-buttons">
            <button type="button" class="technician-action-btn technician-action-btn--edit position-edit-btn" data-id="${i.id}">${c}</button>
            <button type="button" class="technician-action-btn technician-action-btn--delete position-delete-btn" data-id="${i.id}">${d}</button>
          </div>
        </td>
      </tr>
    `}).join("")}async function Mt(e){e.preventDefault();const t=$t();if(t)try{const n=!!w;n?await vt(t.id,t):await St(t);const i=n?u("positions.toast.updateSuccess","ğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØµØ¨"):u("positions.toast.addSuccess","âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØµØ¨");g(i),ve(),N(),Z(),k()}catch(n){console.error("âŒ [technicians] handlePositionSubmit failed",n);const i=n?.message||u("positions.toast.saveFailed","âš ï¸ ØªØ¹Ø°Ø± Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØµØ¨ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰");g(i,"error")}}function xt(){ve()}async function Rt(e){try{const t=e.target;if(!(t instanceof HTMLElement))return;const n=t.dataset.id;if(!n)return;if(t.classList.contains("position-edit-btn")){await se();const i=q().find(s=>String(s.id)===String(n));if(!i){g(u("positions.toast.notFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØµØ¨"),"error");return}Dt(i),N();return}if(t.classList.contains("position-delete-btn")){if(!confirm(u("positions.toast.deleteConfirm","âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØµØ¨ØŸ")))return;await Et(n),w&&String(w)===String(n)&&ve(),g(u("positions.toast.deleteSuccess","ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØµØ¨")),N(),Z(),k()}}catch(t){console.error("âŒ [technicians] handlePositionsTableClick failed",t);const n=t?.message||u("positions.toast.fetchFailed","âš ï¸ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†Ø§ØµØ¨ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰");g(n,"error")}}function jt(e){const t=ke().find(n=>String(n.id)===String(e));if(!t){g(u("technicians.toast.dataNotFound","âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…"));return}Ct(t),g(u("technicians.toast.editReady","âœï¸ ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù… Ø§Ù„Ø¢Ù† Ø«Ù… Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„"))}async function Ut(e){if(!qe()){ut();return}if(confirm(u("technicians.toast.deleteConfirm","âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø¶ÙˆØŸ")))try{await De(e),g(u("technicians.toast.deleteSuccess","ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…")),E&&String(E)===String(e)&&oe(),v()}catch(t){console.error("âŒ [technicians] handleDeleteClick failed",t);const n=Q(t)?t.message:u("technicians.toast.deleteFailed","ØªØ¹Ø°Ø± Ø­Ø°Ù Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰");g(n,"error")}}function mn(){Ae(),v()}function Ke(e){return ke().find(t=>String(t.id)===String(e))||null}function kt(e){const t=new Set,n=s=>{if(s==null)return;const o=String(s).trim();o&&t.add(o)},i=s=>{Array.isArray(s)&&s.forEach(o=>{if(o!=null)if(typeof o=="object"){const r=o.id??o.technicianId??o.technician_id??(o.technician&&(o.technician.id??o.technician.technicianId??o.technician.technician_id));n(r)}else n(o)})};return i(e?.technicians),i(e?.techniciansDetails),Array.from(t)}function Vt(e){const t=e?.start??e?.startDatetime??e?.start_datetime??e?.start_date??null,n=e?.end??e?.endDatetime??e?.end_datetime??e?.end_date??null;return{start:t,end:n}}function Ge(e,t=[],n){const i=At(e);return i?t.some(s=>{if(!s)return!1;const o=String(s?.status||s?.reservationStatus||"").toLowerCase();if(o==="cancelled"||o==="canceled"||!kt(s).includes(i))return!1;const{start:a,end:l}=Vt(s);if(!a||!l)return!1;const c=new Date(a),d=new Date(l);return Number.isNaN(c.getTime())||Number.isNaN(d.getTime())?!1:c<=n&&n<d}):!1}function Ee(){const e=C().reservations||[],t=G();if(!Array.isArray(t)||t.length===0)return t;const n=new Date;let i=!1;const s=t.map(o=>{if(!o)return o;const r=o.baseStatus||o.status||"available";let a=r==="busy"?"busy":r;return Ge(o.id,e,n)&&(a="busy"),(a!==o.status||r!==o.baseStatus)&&(i=!0),{...o,baseStatus:r,status:a}});return i?(O(s),s):t}document.addEventListener("reservations:changed",()=>{const e=G();if(Ee()===e)try{v()}catch{}});document.addEventListener("reservations:updated",()=>{const e=G();if(Ee()===e)try{v()}catch{}});function Ae(){const e=document.getElementById("technician-form"),t=e&&!e.dataset.initialized;e&&!e.dataset.listenerAttached&&(e.addEventListener("submit",f=>{Lt(f).catch(h=>{console.error("âŒ [technicians] submit handler failed",h)})}),e.dataset.listenerAttached="true"),e&&(e.dataset.initialized="true");const n=document.getElementById("technician-cancel-btn");n&&!n.dataset.listenerAttached&&(n.addEventListener("click",Pt),n.dataset.listenerAttached="true"),R(document.getElementById("technician-phone"),U);const i=document.getElementById("technician-role");i&&!i.dataset.listenerAttached&&(i.addEventListener("input",()=>{k()}),i.dataset.listenerAttached="true");const s=document.getElementById("technicians-table");s&&!s.dataset.listenerAttached&&(s.addEventListener("click",f=>{const h=f.target;if(h instanceof HTMLElement){if(h.classList.contains("technician-edit-btn")){const p=h.dataset.id;jt(p)}if(h.classList.contains("technician-delete-btn")){const p=h.dataset.id;Ut(p).catch(b=>{console.error("âŒ [technicians] delete handler failed",b)})}}}),s.dataset.listenerAttached="true");const o=document.getElementById("search-technician-input");o&&!o.dataset.listenerAttached&&(o.addEventListener("input",()=>{o.value=B(o.value),v()}),o.dataset.listenerAttached="true");const r=document.getElementById("technician-role-filter");r&&!r.dataset.listenerAttached&&(r.addEventListener("change",()=>{v()}),r.dataset.listenerAttached="true");const a=document.getElementById("save-technician-changes");a&&!a.dataset.listenerAttached&&(a.addEventListener("click",()=>{zt().catch(f=>{console.error("âŒ [technicians] modal save failed",f)})}),a.dataset.listenerAttached="true");const l=document.getElementById("position-form");l&&!l.dataset.listenerAttached&&(l.addEventListener("submit",f=>{Mt(f).catch(h=>{console.error("âŒ [technicians] position submit failed",h)})}),l.dataset.listenerAttached="true");const c=document.getElementById("position-cancel-btn");c&&!c.dataset.listenerAttached&&(c.addEventListener("click",xt),c.dataset.listenerAttached="true");const d=document.getElementById("positions-table");d&&!d.dataset.listenerAttached&&(d.addEventListener("click",Rt),d.dataset.listenerAttached="true"),R(document.getElementById("position-cost"),_),R(document.getElementById("position-client-price"),_);const m=document.querySelector("[data-tech-tabs]");m&&!m.dataset.listenerAttached&&(m.querySelectorAll("[data-tech-tab]").forEach(h=>{h&&h.addEventListener("click",()=>{const p=h.getAttribute("data-tech-tab");Pe(p)})}),m.dataset.listenerAttached="true"),Pe(M),se().then(()=>{Z(),M==="technicians-positions"&&N(),k()}).catch(f=>{console.error("âŒ [technicians] failed to load technician positions",f),g(f?.message||u("positions.toast.fetchFailed","âš ï¸ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†Ø§ØµØ¨ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰"),"error")}),Ne||(document.addEventListener("technician:prefill",f=>{const h=f.detail;h&&qt(h)}),Ne=!0),t&&oe(),M==="technicians-positions"&&N()}window.addEventListener("DOMContentLoaded",()=>{Ae(),v(),Se(),Ue()});const Qe=()=>{v()};window.addEventListener("technicians:updated",Qe);document.addEventListener("technicians:updated",Qe);document.addEventListener("technicians:refreshRequested",()=>{Ae(),v(),Se(),Ue({showToastOnError:!1})});document.addEventListener("language:changed",()=>{Se(),Z(),M==="technicians-positions"&&N(),k()});document.addEventListener(dt.USER_UPDATED,()=>{v()});const Ze=()=>{Z(),M==="technicians-positions"&&N(),k()};window.addEventListener("technicianPositions:updated",Ze);document.addEventListener("technicianPositions:updated",Ze);function W(e){return B(String(e||"")).trim().toLowerCase()}function Ot(e){const t=Number.parseFloat(B(String(e??"1")));return!Number.isFinite(t)||t<=0||t>50?1:Math.max(1,Math.round(t))}function L(e){const t=String(e??"").trim().toLowerCase();return t||""}function Je(){const{packages:e=[]}=C();return Array.isArray(e)?e.filter(t=>t&&typeof t=="object"):[]}function Ht(e){const t=L(e);return t&&Je().find(i=>L(i?.id??i?.packageId??i?.package_id)===t)||null}function _e(e){if(!e||typeof e!="object")return[];const t=[],n=[];Array.isArray(e.items)&&n.push(...e.items),Array.isArray(e.packageItems)&&n.push(...e.packageItems),Array.isArray(e.bundleItems)&&n.push(...e.bundleItems),Array.isArray(e.barcodes)&&n.push(...e.barcodes.map(a=>({barcode:a}))),n.forEach(a=>{if(!a)return;if(typeof a=="string"||typeof a=="number"){const f=W(a);if(!f)return;t.push({equipmentId:null,barcode:f,normalizedBarcode:f,qty:1,price:0,desc:""});return}if(typeof a!="object")return;const l=W(a.barcode??a.equipmentBarcode??a.code??a.serial??a.serialNumber??a.serial_number),c=[a.equipmentId,a.equipment_id,a.itemId,a.item_id,a.id].find(f=>f!=null&&f!==""),d=[a.unit_price,a.unitPrice,a.price,a.daily_rate].find(f=>Number.isFinite(Number(f))),m=[a.quantity,a.qty,a.count].find(f=>f!=null&&String(f).trim()!=="");t.push({equipmentId:c!=null?String(c):null,barcode:a.barcode??a.equipmentBarcode??a.code??a.serial??a.serialNumber??"",normalizedBarcode:l,qty:Ot(m),price:d!=null?Number(d):0,desc:a.description??a.desc??a.name??"",image:a.image??a.imageUrl??a.img??null})});const i=new Map,{equipment:s=[]}=C()||{},o=new Map,r=new Map;return(Array.isArray(s)?s:[]).forEach(a=>{if(!a||typeof a!="object")return;[a.id,a.equipment_id,a.equipmentId,a.item_id,a.itemId].map(d=>d!=null?String(d):"").filter(Boolean).forEach(d=>{o.has(d)||o.set(d,a)});const c=W(a.barcode);c&&!r.has(c)&&r.set(c,a)}),t.forEach(a=>{if(a.equipmentId&&o.has(a.equipmentId)){const l=o.get(a.equipmentId);if(l){if(a.desc||(a.desc=l.desc||l.description||l.name||""),a.barcode||(a.barcode=l.barcode||""),a.price==null||a.price===0){const c=l.price??l.unit_price,d=Number(c);Number.isFinite(d)&&d>=0&&d<1e6&&(a.price=d)}a.image||(a.image=l.image||l.imageUrl||l.img||null)}}else if(a.normalizedBarcode&&r.has(a.normalizedBarcode)){const l=r.get(a.normalizedBarcode);if(l){if(a.desc||(a.desc=l.desc||l.description||l.name||""),a.barcode||(a.barcode=l.barcode||""),a.price==null||a.price===0){const c=l.price??l.unit_price,d=Number(c);Number.isFinite(d)&&d>=0&&d<1e6&&(a.price=d)}a.image||(a.image=l.image||l.imageUrl||l.img||null)}}}),t.forEach(a=>{const l=a.normalizedBarcode||(a.barcode?W(a.barcode):""),c=l||(a.equipmentId?`id:${a.equipmentId}`:null);if(!c)return;if(!i.has(c)){i.set(c,{...a,normalizedBarcode:l});return}const d=i.get(c);d.qty+=a.qty,!d.price&&a.price&&(d.price=a.price),!d.desc&&a.desc&&(d.desc=a.desc),!d.image&&a.image&&(d.image=a.image)}),Array.from(i.values())}function Wt(e){if(!e||typeof e!="object")return 0;const t=[e.price,e.totalPrice,e.total_price,e.packagePrice,e.package_price];for(const i of t){const s=Number(i);if(Number.isFinite(s))return s}return _e(e).reduce((i,s)=>i+(s.price||0)*(s.qty||1),0)}function Kt(e){return!e||typeof e!="object"?"":e.name??e.title??e.label??e.package_name??e.packageName??""}function Gt(){return Je().map(t=>{const n=L(t?.id??t?.packageId??t?.package_id??t?.code),i=Kt(t)||n||"package",s=Wt(t);return{id:n,name:i,price:s,code:t?.package_code??t?.code??n,items:_e(t),raw:t}}).filter(t=>t.id)}function Qt(e){const t=W(e);return t?Gt().filter(n=>n.items.some(i=>i.normalizedBarcode===t)):[]}function Zt(e){return _e(e).map(n=>({equipmentId:n.equipmentId,barcode:n.barcode,normalizedBarcode:n.normalizedBarcode,qty:n.qty,price:n.price,desc:n.desc,image:n.image??null}))}let V=[],Xe=[],Ye=[],et="single";function pn(){return V}function hn(e){V=Array.isArray(e)?e:[]}function gn(e){V=[...V,e]}function bn(e){Number.isInteger(e)&&e>=0&&(V=V.filter((t,n)=>n!==e))}function yn(){return Xe}function In(e){Xe=Array.isArray(e)?e:[]}function Sn(){return Ye}function vn(e){Ye=Array.isArray(e)?e:[]}function En(e){}function An(){return et==="package"?"package":"single"}function _n(e){et=e==="package"?"package":"single"}function Tn(e){if(!e)return{date:"",time:""};const t=String(e).trim();if(!t)return{date:"",time:""};let n=t;n.includes(" ")&&!n.includes("T")&&(n=n.replace(" ","T"));const[i="",s=""]=n.split("T"),o=i?i.slice(0,10):"",r=s.match(/(\d{1,2}:\d{2})/);let a="";if(r){const[l="00",c="00"]=r[0].split(":");a=`${l.padStart(2,"0")}:${c.padStart(2,"0")}`}return{date:o,time:a}}function Bn(e,t){if(!e)return"";const n=t&&t.length?t:"00:00";return`${e}T${n}`}function A(e){return B(String(e||"")).trim().toLowerCase()}const Jt=864e13;function I(e){if(!e&&e!==0)return null;if(e instanceof Date){const i=e.getTime();return Number.isNaN(i)?null:new Date(i)}if(typeof e=="number"){if(!Number.isFinite(e))return null;const i=new Date(e);return Number.isNaN(i.getTime())?null:i}let t=String(e??"").trim();if(!t)return null;if(/^\d+$/.test(t)){const i=Number(t);if(Number.isFinite(i)){const s=new Date(i);if(!Number.isNaN(s.getTime()))return s}}if(!t.includes("T")&&t.includes(" ")){const i=t.indexOf(" ");t=`${t.slice(0,i)}T${t.slice(i+1).trimStart()}`}else t.includes(" ")&&(t=t.replace(" ","T"));const n=new Date(t);if(!Number.isNaN(n.getTime()))return n;if(!t.endsWith("Z")&&/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}(:\d{2})?$/.test(t)){const i=new Date(`${t}Z`);if(!Number.isNaN(i.getTime()))return i}return null}function wn(e,t,n,i=null){if(!e||!t||!n)return!1;const s=I(t),o=I(n);if(!s||!o||s>=o)return!1;const r=A(e);if(!r)return!1;const a=C()||{},l=Array.isArray(a.reservations)?a.reservations:[],c=Array.isArray(a.maintenance)?a.maintenance:[],d=Array.isArray(a.equipment)?a.equipment:[],m=rn(d),f=J(i);return l.some(p=>{if(!p||X(p,f)||!p.start||!p.end)return!1;const b=String(p?.status||p?.reservationStatus||"").toLowerCase();if(b==="cancelled"||b==="canceled")return!1;const y=I(p.start),S=I(p.end);return!y||!S||!(y<o&&S>s)?!1:nt(p,r)})?!0:c.some(p=>{if(!tn(p)||!an(p,m).has(r))return!1;const{start:y,end:S}=sn(p);if(!y&&!S)return!0;const F=y??new Date(0),z=S??new Date(Jt);return F<o&&z>s})}function Xt(e,t,n,i=null){const s=L(e);if(!s||!t||!n)return!1;const o=I(t),r=I(n);if(!o||!r||o>=r)return!1;const a=C()||{},l=Array.isArray(a.reservations)?a.reservations:[],c=J(i);return l.some(d=>{if(!d?.start||!d?.end||X(d,c))return!1;const m=String(d?.status||d?.reservationStatus||"").toLowerCase();if(m==="cancelled"||m==="canceled")return!1;const f=I(d.start),h=I(d.end);return!f||!h||!(f<r&&h>o)?!1:Yt(d,s)})}function Cn(e,t,n,i=null){const s=A(e);if(!s||!t||!n)return[];const o=Qt(s);return o.length?o.filter(r=>Xt(r.id,t,n,i)):[]}function tt(e){const t=[];return!e||typeof e!="object"||["items","equipment","packages","packageItems","package_items","reservedItems","reserved_items"].forEach(i=>{const s=e[i];Array.isArray(s)&&s.length&&t.push(s)}),t}function nt(e,t){if(!t||!e||typeof e!="object")return!1;const n=A(e?.barcode);if(n&&n===t)return!0;const i=tt(e);for(const s of i)for(const o of s)if(en(o).has(t))return!0;return!1}function Yt(e,t){if(!t||!e||typeof e!="object")return!1;const n=[e.packageId,e.package_id,e.bundleId,e.bundle_id,e.packageCode,e.package_code];for(const o of n){if(!o&&o!==0)continue;const r=L(o);if(r&&r===t)return!0}const i=e.packages;if(Array.isArray(i))for(const o of i){const r=L(o);if(r&&r===t)return!0}const s=tt(e);for(const o of s)for(const r of o)if(Te(r).has(t))return!0;return!1}function en(e){const t=new Set;if(!e&&e!==0)return t;if(typeof e=="string"||typeof e=="number"){const o=A(e);return o&&t.add(o),t}if(typeof e!="object")return t;const n=A(e.barcode??e.equipmentBarcode??e.code??e.serial??e.serialNumber??e.serial_number);n&&t.add(n),["packageItems","package_items","items","equipment","bundleItems","bundle_items"].forEach(o=>{const r=e[o];Array.isArray(r)&&r.forEach(a=>{if(a!=null){if(typeof a=="string"||typeof a=="number"){const l=A(a);l&&t.add(l);return}if(typeof a=="object"){const l=A(a.barcode??a.equipmentBarcode??a.code??a.serial??a.serialNumber??a.serial_number);l&&t.add(l)}}})});const s=Te(e);return s.size&&s.forEach(o=>{const r=Ht(o);if(!r)return;Zt(r).forEach(l=>{const c=l.normalizedBarcode??A(l.barcode);c&&t.add(c)})}),t}function Te(e){const t=new Set;if(!e&&e!==0||typeof e=="string"||typeof e=="number"||typeof e!="object")return t;const n=[e.packageId,e.package_id,e.packageCode,e.package_code,e.bundleId,e.bundle_id];return(e.type==="package"||e.kind==="package"||e.category==="package")&&n.push(e.id,e.code,e.uuid),n.forEach(i=>{const s=L(i);s&&t.add(s)}),e.package&&typeof e.package=="object"&&Te(e.package).forEach(s=>t.add(s)),Array.isArray(e.packages)&&e.packages.forEach(i=>{const s=L(i);s&&t.add(s)}),t}function tn(e){const t=[e?.statusRaw,e?.status_raw,e?.status,e?.statusLabel,e?.status_label];if(on(e))return!1;for(const n of t){const i=nn(n);if(i){if(i==="completed"||i==="cancelled"||i==="closed")return!1;if(i==="open"||i==="in_progress")return!0}}return!0}function nn(e){const t=String(e??"").trim().toLowerCase().replace(/\s+/g,"_");return t?t==="completed"||t==="done"||t==="finished"||t==="resolved"||t==="closed"||t==="Ù…ÙƒØªÙ…Ù„"||t==="Ù…ØºÙ„Ù‚"?"completed":t==="cancelled"||t==="canceled"||t==="Ù…Ù„ØºÙŠ"?"cancelled":t==="in_progress"||t==="in-progress"||t==="Ù‚ÙŠØ¯_Ø§Ù„ØªÙ†ÙÙŠØ°"||t==="Ø¬Ø§Ø±ÙŠ_Ø§Ù„Ø¹Ù…Ù„"||t==="inprogress"?"in_progress":t==="open"||t==="Ù‚ÙŠØ¯_Ø§Ù„ØµÙŠØ§Ù†Ø©"||t==="Ù‚ÙŠØ¯_Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±"||t==="pending"||t==="scheduled"||t==="active"?"open":t.includes("progress")||t.includes("ongoing")||t.includes("ØªÙ†ÙÙŠØ°")?"in_progress":t.includes("close")||t.includes("complete")||t.includes("finish")||t.includes("resolve")?"completed":t.includes("cancel")?"cancelled":"open":""}function an(e,t){const n=new Set;[e?.equipmentBarcode,e?.equipment_barcode,e?.barcode].forEach(r=>{const a=A(r);a&&n.add(a)});const s=e?.equipment&&typeof e.equipment=="object"?e.equipment:null;if(s){const r=A(s.barcode??s.equipmentBarcode??s.code??s.serial??s.serialNumber??s.serial_number);r&&n.add(r)}return[e?.equipmentId,e?.equipment_id,s?.id,s?.equipmentId,s?.equipment_id].map(r=>r!=null?String(r):"").filter(Boolean).forEach(r=>{const a=t.get(r);if(!a)return;const l=A(a?.barcode??a?.equipmentBarcode??a?.code??a?.serial??a?.serialNumber??a?.serial_number);l&&n.add(l)}),n}function sn(e){const t=fe([e?.scheduledAt,e?.scheduled_at,e?.startAt,e?.start_at,e?.startDate,e?.start_date,e?.reportedAt,e?.reported_at,e?.createdAt,e?.created_at]),n=fe([e?.resolvedAt,e?.resolved_at,e?.closedAt,e?.closed_at,e?.completedAt,e?.completed_at,e?.finishedAt,e?.finished_at,e?.endAt,e?.end_at,e?.endDate,e?.end_date,e?.expectedCompletionAt,e?.expected_completion_at,e?.dueAt,e?.due_at]);return{start:t,end:n}}function on(e){return!!fe([e?.resolvedAt,e?.resolved_at,e?.closedAt,e?.closed_at,e?.completedAt,e?.completed_at,e?.finishedAt,e?.finished_at,e?.endAt,e?.end_at,e?.endDate,e?.end_date,e?.expectedCompletionAt,e?.expected_completion_at,e?.dueAt,e?.due_at])}function fe(e=[]){for(const t of e){const n=I(t);if(n)return n}return null}function rn(e){const t=new Map;return Array.isArray(e)&&e.forEach(n=>{if(!n||typeof n!="object")return;[n?.id,n?.ID,n?.equipment_id,n?.equipmentId,n?.item_id,n?.itemId,n?.uuid,n?.UUID].map(s=>s!=null?String(s):"").filter(Boolean).forEach(s=>{t.has(s)||t.set(s,n)})}),t}function Nn(e,t,n,i=null){if(!e||!t||!n)return!1;const s=new Date(t),o=new Date(n);if(Number.isNaN(s.getTime())||Number.isNaN(o.getTime()))return!1;const{reservations:r=[]}=C(),a=String(e),l=J(i);return r.some(c=>{if(!c?.start||!c?.end||X(c,l))return!1;const d=String(c?.status||c?.reservationStatus||"").toLowerCase();if(d==="cancelled"||d==="canceled")return!1;const m=new Date(c.start),f=new Date(c.end);return Number.isNaN(m.getTime())||Number.isNaN(f.getTime())||!(m<o&&f>s)?!1:(Array.isArray(c.technicians)?c.technicians:[]).some(b=>String(b)===a)})}function Ln(e,t,n,i=null){if(!e||!t||!n)return[];const s=I(t),o=I(n);if(!s||!o||s>=o)return[];const{reservations:r=[]}=C(),a=String(e),l=J(i),c=[];return r.forEach(d=>{if(!d?.start||!d?.end||X(d,l))return;const m=String(d?.status||d?.reservationStatus||"").toLowerCase();if(m==="cancelled"||m==="canceled")return;const f=I(d.start),h=I(d.end);if(!f||!h||!(f<o&&h>s)||!(Array.isArray(d.technicians)?d.technicians:[]).some(y=>String(y)===a))return;const b=d.reservationCode||d.reservation_code||null;if(b)c.push(String(b));else if(d.id!=null||d.reservationId!=null){const y=d.id??d.reservationId;c.push(`#${String(y)}`)}}),Array.from(new Set(c))}function Pn(e=[],t,n,i=null){const o=(Array.isArray(e)?e:[e]).map(m=>A(m)).filter(Boolean);if(!o.length||!t||!n)return[];const r=I(t),a=I(n);if(!r||!a||r>=a)return[];const{reservations:l=[]}=C(),c=J(i),d=[];return l.forEach(m=>{if(!m?.start||!m?.end||X(m,c))return;const f=String(m?.status||m?.reservationStatus||"").toLowerCase();if(f==="cancelled"||f==="canceled")return;const h=I(m.start),p=I(m.end);if(!(!h||!p)&&h<a&&p>r){for(const b of o)if(nt(m,b)){const y=m.reservationCode||m.reservation_code||null;if(y)d.push(String(y));else if(m.id!=null||m.reservationId!=null){const S=m.id??m.reservationId;d.push(`#${String(S)}`)}break}}}),Array.from(new Set(d))}function J(e){return x(e,new Set)}function X(e,t){if(!t||t.size===0)return!1;const n=x([e?.id,e?.reservationId,e?.reservation_id,e?.reservationCode,e?.reservation_code,e?.uuid,e?.UUID,e?._id],new Set);for(const i of n)if(t.has(i))return!0;return!1}function x(e,t){if(e==null)return t;if(e instanceof Set)return e.forEach(o=>x(o,t)),t;if(Array.isArray(e))return e.forEach(o=>x(o,t)),t;if(typeof e=="object"){const o=["id","reservationId","reservation_id","reservationCode","reservation_code","uuid","UUID","_id"];let r=!1;return o.forEach(a=>{Object.prototype.hasOwnProperty.call(e,a)&&(r=!0,x(e[a],t))}),r||Object.values(e).forEach(a=>x(a,t)),t}const n=B(String(e??"")).trim();if(!n)return t;const i=[n,n.toLowerCase(),n.toUpperCase()],s=n.replace(/\D+/g,"");if(s){i.push(s);const o=Number.parseInt(s,10);Number.isNaN(o)||i.push(String(o))}return i.forEach(o=>{o&&t.add(o)}),t}export{bn as A,Xt as B,Nn as C,Ln as D,Tn as E,L as F,hn as G,Ht as H,Wt as I,Kt as J,vn as K,_n as L,In as M,Je as N,Pn as O,vt as P,ln as Q,mn as a,_e as b,dn as c,un as d,D as e,te as f,Ke as g,G as h,q as i,yt as j,se as k,yn as l,ae as m,A as n,Gt as o,En as p,pn as q,Fe as r,Ee as s,fn as t,Bn as u,Sn as v,Cn as w,wn as x,gn as y,An as z};
