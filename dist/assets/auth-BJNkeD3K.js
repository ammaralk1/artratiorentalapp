(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}})();const he="/backend/api";class p extends Error{constructor(t,{status:n,payload:r}={}){super(t),this.name="ApiError",this.status=n??null,this.payload=r??null}}function pe(){const t=(typeof window<"u"?window.APP_API_BASE:null)||he;return String(t).replace(/\/$/,"")}async function R(e,{method:t="GET",headers:n={},body:r,signal:o,credentials:a="include"}={}){const i=e.startsWith("/")?e:`/${e}`,l=`${pe()}${i}`,u={Accept:"application/json",...n},s={method:t,headers:u,signal:o,credentials:a};r!==void 0&&(r instanceof FormData?(delete u["Content-Type"],s.body=r):typeof r=="string"?(u["Content-Type"]=u["Content-Type"]||"application/json",s.body=r):(u["Content-Type"]=u["Content-Type"]||"application/json",s.body=JSON.stringify(r)));const c=await fetch(l,s),F=c.headers.get("content-type")||"";let f=null;if(F.includes("application/json"))try{f=await c.json()}catch{throw new p("Failed to parse server response as JSON",{status:c.status})}else{const y=await c.text();f=y?{raw:y}:null}if(!c.ok){const y=f?.error||`Request failed with status ${c.status}`;throw new p(y,{status:c.status,payload:f})}if(f&&typeof f=="object"&&f.ok===!1){const y=f.error||"API returned an error response";throw new p(y,{status:c.status,payload:f})}return f}const m=Object.freeze({language:"ar",theme:"light",dashboardTab:null,dashboardSubTab:null,projectsTab:null,projectsSubTab:null});let g=null,N=null;const M=new Set,ne="__ART_RATIO_SKIP_PREF_FETCH__",re="__ART_RATIO_PREFERENCES__";function oe(){try{return typeof window>"u"?!1:!!window[ne]}catch{return!1}}function ye(){try{typeof window<"u"&&delete window[ne]}catch{}}function w(e={}){const t=e.language==="en"?"en":"ar",n=e.theme==="dark"?"dark":"light",r=typeof e.dashboardTab=="string"?O(e.dashboardTab):null,o=typeof e.dashboardSubTab=="string"?O(e.dashboardSubTab):null,a=typeof e.projectsTab=="string"?O(e.projectsTab):null,i=typeof e.projectsSubTab=="string"?O(e.projectsSubTab):null;return{language:t,theme:n,dashboardTab:r,dashboardSubTab:o,projectsTab:a,projectsSubTab:i}}function O(e){const t=String(e||"").trim();return t&&/^[a-z0-9\-]+$/i.test(t)?t:null}function be(){try{if(typeof window>"u"||!window.localStorage)return null;const e=window.localStorage.getItem(re);if(!e)return null;const t=JSON.parse(e);return w(t)}catch(e){return console.warn("âš ï¸ [preferencesService] Failed to read cached preferences",e),null}}function Te(e){try{if(typeof window>"u"||!window.localStorage)return;window.localStorage.setItem(re,JSON.stringify(e))}catch(t){console.warn("âš ï¸ [preferencesService] Failed to persist preferences",t)}}const K=be();K&&(g=K);function Ae(){const e=d();M.forEach(t=>{try{t(e)}catch(n){console.error("âš ï¸ [preferencesService] listener failed",n)}})}function E(e){const n={...g?{...g}:{...m},...e};g=w(n),Te(g),Ae()}function d(){return g?{...g}:null}function ae(e){if(typeof e!="function")return()=>{};if(M.add(e),g)try{e(d())}catch(t){console.error("âš ï¸ [preferencesService] listener failed",t)}return()=>{M.delete(e)}}function se({refresh:e=!1}={}){return oe()?Promise.resolve({...m}):!e&&g?Promise.resolve(d()):(N||(N=R("/preferences/").then(t=>{const n=t?.data??m;return E(n),d()}).catch(t=>t instanceof p&&t.status===401?(g=null,m):(console.warn("âš ï¸ [preferencesService] Failed to load preferences",t),E(m),m)).finally(()=>{N=null})),N)}function Ee(e=null){if(!e){const t=d();return w(t||m)}return w(e)}async function z(e={}){if(oe())return{...m,...e};e.language!==void 0&&e.language,e.theme!==void 0&&e.theme,e.dashboardTab!==void 0&&e.dashboardTab,e.dashboardSubTab!==void 0&&e.dashboardSubTab,e.projectsTab!==void 0&&e.projectsTab,e.projectsSubTab!==void 0&&e.projectsSubTab;const t=Ee(),n={...t,...e},r=w(n),o={},a={};["language","theme","dashboardTab","dashboardSubTab","projectsTab","projectsSubTab"].forEach(s=>{if(e[s]===void 0)return;const c=r[s],F=t[s];c!==F&&(o[s]=c,(s==="language"||s==="theme")&&(a[s]=c))});const l=Object.keys(o).length>0,u=Object.keys(a).length>0;if(!u&&!l)return d();if(!u&&l)return E(r),d();try{const s=await R("/preferences/",{method:"PATCH",body:a});return E(s?.data??m),l&&E({...d(),...o}),d()}catch(s){if(s instanceof p&&s.status===422)return console.warn("âš ï¸ [preferencesService] Server rejected preference update (no changes)."),E(r),d();throw s}}const _="ar",Se="ar",we="language-loading",V="language-ready",ie=["Placeholder","Title","AriaLabel","AriaDescription","Value"],v={ar:Object.create(null),en:Object.create(null)};let T=_,x=!1,U=null;function P(e){return e==="en"?"en":"ar"}function _e(){if(!U){const e=d();if(e?.language){const t=P(e.language);C(t,{persist:!1,dispatch:!1})}U=se().then(t=>{const n=P(t?.language??_);return C(n,{persist:!1}),x=!0,n}).catch(t=>(console.warn("âš ï¸ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ ØªÙØ¶ÙŠÙ„ Ø§Ù„Ù„ØºØ© Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…",t),C(_,{persist:!1}),x=!0,_))}return U}function Le(e){if(e.dataset.i18nCached==="true")return;e.dataset.i18nHtml==="true"?e.dataset.arHtml===void 0&&(e.dataset.arHtml=e.innerHTML):e.dataset.ar===void 0&&(e.dataset.ar=e.textContent),ie.forEach(n=>{const r=n.charAt(0).toLowerCase()+n.slice(1),o=e.getAttribute(r);o!=null&&e.dataset[`ar${n}`]===void 0&&(e.dataset[`ar${n}`]=o)}),e.dataset.i18nCached="true"}function J(e,t){if(!t)return;const n=v[e]??(v[e]=Object.create(null));Object.entries(t).forEach(([r,o])=>{typeof r=="string"&&(n[r]=o)})}function Y(e,t){if(!t)return;const n=v[e];return n?n[t]:void 0}function Ce(e,t){Le(e);const n=e.dataset.i18nHtml==="true",r=e.dataset.i18nKey,o=Y(t,r);o!==void 0?n?e.innerHTML=o:e.textContent=o:t==="en"?n?e.dataset.enHtml!==void 0&&(e.innerHTML=e.dataset.enHtml):e.dataset.en!==void 0&&(e.textContent=e.dataset.en):n?e.innerHTML=e.dataset.arHtml??e.innerHTML:e.textContent=e.dataset.ar??e.textContent,ie.forEach(a=>{const i=a.charAt(0).toLowerCase()+a.slice(1),l=e.dataset[`i18n${a}Key`],u=Y(t,l);if(u!==void 0){e.setAttribute(i,u);return}const s=t==="en"?`en${a}`:`ar${a}`,c=e.dataset[s];c!==void 0&&e.setAttribute(i,c)})}function ce(e){document.querySelectorAll("[data-i18n]").forEach(n=>Ce(n,e))}function ve(e){const t=document.documentElement,n=document.body,r=e===Se?"rtl":"ltr";t.setAttribute("lang",e),t.setAttribute("dir",r),n&&(n.setAttribute("dir",r),n.dataset.lang=e)}function Pe(){const e=document.documentElement;e&&(e.classList.contains(V)||(e.classList.remove(we),e.classList.add(V)))}function ue(e){document.querySelectorAll(".language-toggle-btn").forEach(t=>{const n=t.dataset.labelAr||"ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",r=t.dataset.labelEn||"ğŸ‡¬ğŸ‡§ English";t.textContent=e==="en"?n:r,t.setAttribute("aria-pressed",e==="en"?"true":"false")})}function C(e,{persist:t=!1,dispatch:n=!0}={}){const r=P(e);T===r&&x&&!t||(T=r,x=!0,ve(r),ce(r),ue(r),Pe(),n&&document.dispatchEvent(new CustomEvent("language:changed",{detail:{language:r}})),t&&z({language:r}).catch(o=>{console.warn("âš ï¸ ØªØ¹Ø°Ø± Ø­ÙØ¸ ØªÙØ¶ÙŠÙ„ Ø§Ù„Ù„ØºØ© ÙÙŠ Ø§Ù„Ø®Ø§Ø¯Ù…",o)}))}function je(){De(T==="ar"?"en":"ar")}function Re(){document.querySelectorAll(".language-toggle-btn").forEach(t=>{t.dataset.listenerAttached||(t.addEventListener("click",()=>{je()}),t.dataset.listenerAttached="true")}),ue(T)}function tt(e={}){J("ar",e.ar),J("en",e.en);const t=H();ce(t),document.dispatchEvent(new CustomEvent("language:translationsReady",{detail:{language:t}}))}function b(e,t=""){if(!e)return t;const n=T||_,r=v[n];if(r&&r[e]!==void 0)return r[e];const a=v[n==="en"?"ar":"en"];return a&&a[e]!==void 0?a[e]:t}function De(e){const t=P(e);C(t,{persist:!0})}function H(){return T}function W(){_e().catch(()=>_),Re()}ae(e=>{e&&e.language&&P(e.language)!==T&&C(e.language,{persist:!1})});document.readyState==="loading"?document.addEventListener("DOMContentLoaded",W,{once:!0}):W();const S="dark-mode",X=new WeakSet,Q="theme-loading",le="art-ratio:session-theme";let Z=!1;function de(e){return e==="dark"?"dark":"light"}function Ne(e){try{window.sessionStorage?.setItem(le,de(e))}catch{}}function Oe(){try{const e=window.sessionStorage?.getItem(le);return e==="dark"?"dark":e==="light"?"light":null}catch{return null}}function xe(){document.documentElement.classList.remove(Q);const e=document.body;e&&e.classList.remove(Q)}function I(e,{persist:t=!0}={}){const n=de(e),r=document.documentElement,o=document.body;n==="dark"?(r.classList.add(S),o&&o.classList.add(S)):(r.classList.remove(S),o&&o.classList.remove(S)),r.setAttribute("data-theme",n==="dark"?"dark":"light"),Ne(n),B(n);try{document.dispatchEvent(new CustomEvent("theme:changed",{detail:{theme:n}}))}catch(a){console.warn("âš ï¸ [theme.js] Failed to dispatch theme change event",a)}t&&z({theme:n}).catch(a=>{console.warn("âš ï¸ ØªØ¹Ø°Ø± Ø­ÙØ¸ ØªÙØ¶ÙŠÙ„ Ø§Ù„Ø³Ù…Ø© ÙÙŠ Ø§Ù„Ø®Ø§Ø¯Ù…",a)})}function D(){const e=document.body;return e&&e.classList.contains(S)||document.documentElement.classList.contains(S)?"dark":"light"}function Ie(){const e=D()==="dark"?"light":"dark";I(e,{persist:!0})}function Fe(e,t){if(!e)return;const n=t==="dark",r=n?b("theme.toggle.toLight","â˜€ï¸ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø§Ø¯ÙŠ"):b("theme.toggle.toDark","ğŸŒ™ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ");e.textContent=r,e.setAttribute("aria-pressed",String(n)),e.setAttribute("title",n?b("theme.toggle.titleLight","Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¥Ù„Ù‰ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø§Ø¯ÙŠ"):b("theme.toggle.titleDark","Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¥Ù„Ù‰ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ")),e.setAttribute("aria-label",n?b("theme.toggle.ariaLight","Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø§Ø¯ÙŠ Ù…ÙØ¹Ù„"):b("theme.toggle.ariaDark","Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ Ù…ÙØ¹Ù„"))}function B(e){document.querySelectorAll(".theme-toggle-btn").forEach(t=>Fe(t,e)),xe()}function Ue(){const e=document.querySelectorAll(".theme-toggle-btn");B(D()),e.forEach(t=>{t&&(t.getAttribute("type")||t.setAttribute("type","button"),!X.has(t)&&(t.addEventListener("click",n=>{n.preventDefault(),Ie()}),X.add(t)))})}function nt({skipRemote:e=!1}={}){const t=d(),o=(t?.theme==="dark"?"dark":t?.theme==="light"?"light":null)||Oe()||ke();I(o,{persist:!1}),qe({skipRemote:e})}function ke(){try{if(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches)return"dark"}catch{}return"light"}function qe({skipRemote:e=!1}={}){Z||(Z=!0,!e&&se().then(t=>{const n=t?.theme==="dark"?"dark":t?.theme==="light"?"light":null;n&&I(n,{persist:!1})}).catch(t=>{console.warn("âš ï¸ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ ØªÙØ¶ÙŠÙ„ Ø§Ù„Ø³Ù…Ø© Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…",t)}))}document.addEventListener("language:changed",()=>{B(D()),Ue()});ae(e=>{const t=e?.theme==="dark"?"dark":e?.theme==="light"?"light":null;t&&t!==D()&&I(t,{persist:!1})});function G(){const e=typeof window<"u"?window:globalThis;return e.__APP_DATA_STORE__||(e.__APP_DATA_STORE__={customers:[],reservations:[],equipment:[],technicians:[],maintenance:[],projects:[]}),e.__APP_DATA_STORE__}function A(e,t,n){n!=null&&(e[t]=Array.isArray(n)?[...n]:n)}function Me(){const e=G();return{customers:[...e.customers],reservations:[...e.reservations],equipment:[...e.equipment],technicians:[...e.technicians],maintenance:[...e.maintenance],projects:[...e.projects]}}function rt({customers:e,reservations:t,equipment:n,technicians:r,maintenance:o,projects:a}){const i=G();A(i,"customers",e),A(i,"reservations",t),A(i,"equipment",n),A(i,"technicians",r),A(i,"maintenance",o),A(i,"projects",a)}let k=!1;function ot(e=null){if(k)return;const t=e||(typeof window<"u"?window.__LEGACY_DATA__:null);if(!t||typeof t!="object"){k=!0;return}const n=G();if(["customers","reservations","equipment","technicians","maintenance","projects"].forEach(o=>{const a=t[o];Array.isArray(a)&&a.length>0&&(n[o]=[...a])}),k=!0,!e&&typeof window<"u")try{delete window.__LEGACY_DATA__}catch{}}function $(e,t=3e3){let n=document.getElementById("toast-container");n||(n=document.createElement("div"),n.id="toast-container",n.style.position="fixed",n.style.top="20px",n.style.left="50%",n.style.transform="translateX(-50%)",n.style.zIndex="9999",document.body.appendChild(n));const r=document.createElement("div");r.className="toast-message",r.textContent=e,r.style.background="#333",r.style.color="#fff",r.style.padding="10px 20px",r.style.marginTop="10px",r.style.borderRadius="6px",r.style.boxShadow="0 2px 6px rgba(0,0,0,0.3)",r.style.opacity="0",r.style.transition="opacity 0.3s ease",n.appendChild(r),setTimeout(()=>r.style.opacity="1",10),setTimeout(()=>{r.style.opacity="0",setTimeout(()=>r.remove(),300)},t)}const ee="RSV",te="PRJ",He=4,L=(()=>{try{const e=typeof globalThis<"u"?globalThis:window;return e.__APP_SEQUENCE_STATE__=e.__APP_SEQUENCE_STATE__||{reservation:0,project:0},e.__APP_SEQUENCE_STATE__}catch{return{reservation:0,project:0}}})();function ze(){return Number.isFinite(L.reservation)?L.reservation:0}function Be(e){L.reservation=Math.max(0,Number.parseInt(e,10)||0)}function Ge(){return Number.isFinite(L.project)?L.project:0}function $e(e){L.project=Math.max(0,Number.parseInt(e,10)||0)}function fe(){try{const e=Me();return{reservations:Array.isArray(e?.reservations)?e.reservations:[],projects:Array.isArray(e?.projects)?e.projects:[]}}catch(e){return console.warn("âš ï¸ [utils] Failed to load data snapshot for code generation",e),{reservations:[],projects:[]}}}function Ke(e,t){if(e==null)return 0;if(typeof e=="number")return Number.isFinite(e)?Math.max(0,Math.trunc(e)):0;const n=String(e).trim();if(!n)return 0;const r=`${t.toUpperCase()}-`,o=n.toUpperCase();let a=n;o.startsWith(r)&&(a=n.slice(r.length));const i=a.match(/(\d+)$/);if(i){const u=Number.parseInt(i[1],10);return Number.isFinite(u)?Math.max(0,u):0}const l=Number.parseInt(n,10);return Number.isFinite(l)?Math.max(0,l):0}function Ve(e){return Array.isArray(e)?e:[e]}function ge(e,t,n){return!Array.isArray(e)||e.length===0?0:e.reduce((r,o)=>{const a=n(o),l=Ve(a).reduce((u,s)=>{const c=Ke(s,t);return c>u?c:u},0);return l>r?l:r},0)}function me(e,t){const n=Math.max(0,Number.parseInt(t,10)||0);return`${e}-${String(n).padStart(He,"0")}`}function at(){const{reservations:e}=fe(),t=ge(e,ee,r=>[r?.reservationCode,r?.reservation_code,r?.reservationId,r?.reservation_id,r?.id]),n=Math.max(t,ze())+1;return Be(n),me(ee,n)}function st(){const{projects:e}=fe(),t=ge(e,te,r=>[r?.projectCode,r?.project_code,r?.code,r?.id]),n=Math.max(t,Ge())+1;return $e(n),me(te,n)}function it(e,t={}){if(!e)return"-";const n=new Date(e);if(Number.isNaN(n.getTime()))return"-";const r=document?.documentElement?.getAttribute("lang")||(typeof H=="function"?H():null)||"ar",a=String(r).toLowerCase().startsWith("ar")?"ar-SA-u-ca-gregory":"en-US",l=new Intl.DateTimeFormat(a,{dateStyle:"short",timeStyle:"short",hour12:!0,calendar:"gregory",...t}).formatToParts(n),u=n.getHours()>=12?"PM":"AM",s=l.map(c=>c.type==="dayPeriod"?u:c.value).join("").replace(/\u200f/g,"");return Je(s)}function Je(e){if(e==null)return"";e=String(e);const t=["Ù ","Ù¡","Ù¢","Ù£","Ù¤","Ù¥","Ù¦","Ù§","Ù¨","Ù©"],n=["0","1","2","3","4","5","6","7","8","9"];return e.split("").map(r=>{const o=t.indexOf(r);return o>-1?n[o]:r}).join("")}const Ye="âŒ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©";let h=null;const We={USER_UPDATED:"auth:user-updated"};function Xe(e){if(typeof document>"u")return;const t=document.documentElement;t&&(e?t.dataset.userRole=e:delete t.dataset.userRole)}function Qe(){typeof document>"u"||document.dispatchEvent(new CustomEvent(We.USER_UPDATED,{detail:h?{...h}:null}))}function j(e){if(e&&typeof e=="object"){const t=typeof e.role=="string"?e.role.trim().toLowerCase():null;h={id:Number.isFinite(e.id)?Number(e.id):null,username:String(e.username||""),loginAt:e.loginAt??null,role:t}}else h=null;Xe(h?.role||""),Qe()}function q(e=Ye){$(e);const t=document.getElementById("login-error");t&&(t.innerText=e)}async function ct(e,t){const n=(e||"").trim(),r=t||"";if(!n||!r){q();return}try{const o=await R("/auth/",{method:"POST",body:{username:n,password:r}});j(o?.data??null);try{await z({theme:D()})}catch(a){console.warn("âš ï¸ ØªØ¹Ø°Ø± Ø­ÙØ¸ ØªÙØ¶ÙŠÙ„ Ø§Ù„Ø³Ù…Ø© Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„",a)}ye(),window.location.href="home.html"}catch(o){console.error("âŒ ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„",o),j(null),o instanceof p&&o.message?q(o.message):q()}}async function ut(){try{await R("/auth/",{method:"DELETE"})}catch(e){console.warn("âš ï¸ ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…",e)}finally{j(null),$("ğŸšª ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬"),window.location.href="login.html"}}async function Ze({refresh:e=!1}={}){if(!e&&h)return h;try{const t=await R("/auth/");return j(t?.data??null),h}catch(t){throw t instanceof p&&t.status===401&&j(null),t}}function lt({redirect:e=!0}={}){return Ze({refresh:!0}).then(t=>(!t&&e&&(window.location.href="login.html"),t)).catch(t=>t instanceof p&&t.status===401?(e&&(window.location.href="login.html"),null):(console.error("âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¬Ù„Ø³Ø©",t),e&&(window.location.href="login.html"),null))}function et(){return h?.role||null}function dt(){return et()==="admin"}function ft(){$(b("auth.permissions.denied","âš ï¸ Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„ØªÙ†ÙÙŠØ° Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡"),"error")}export{p as A,nt as a,R as b,lt as c,H as d,Me as e,it as f,Ze as g,We as h,Ue as i,$ as j,dt as k,ut as l,ot as m,Je as n,ft as o,se as p,ae as q,d as r,rt as s,b as t,z as u,ct as v,tt as w,st as x,at as y};
