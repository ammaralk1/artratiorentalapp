import{e as h}from"./calculations.B7dPeN6e.js";import{p as y,e as g,a as b}from"./projects.AncTQLeJ.js";import"./reservationsService.DYKKik27.js";import"./auth.C2qS32r7.js";import"./state.BZprRkn3.js";import"./dashboard.UNB3M4GP.js";import"./form.BwDzleH4.js";import"./projectsService.CTz-_8Rg.js";import"./constants.sfNl90l5.js";import"./customers.DvSgs09j.js";import"./controller.FVWq_XZa.js";import"./details.CX1n4h_9.js";import"./equipment.BPKcUJ6u.js";import"./quotePdf.C2lQPEPC.js";import"./canvasColorUtils.CviLtv6S.js";import"./reservationsActions.DwfxmyeD.js";import"./uiBridge.BLZZT8b9.js";import"./dashboardShell.DF2kUed9.js";function w(){try{return String(localStorage.getItem("templatesPdf.mode")||"").trim()==="html2pdf"?"html2pdf":"iframe"}catch{return"iframe"}}function v(){try{return/iP(hone|ad|od)/.test(navigator.userAgent||"")}catch{return!1}}function x(){try{return/^((?!chrome|android).)*safari/i.test(navigator.userAgent||"")}catch{return!1}}function A(){return v()&&x()}function _(t=2e3){return window.__tplPrintingLock?!1:(window.__tplPrintingLock=!0,setTimeout(()=>{try{window.__tplPrintingLock=!1}catch{}},Math.max(500,t)),!0)}function C(t){const r=window.open("","_blank");if(!r||!r.document)return null;try{r.document.open(),r.document.write(t),r.document.close()}catch{}return r}async function E(){let t="";try{Array.from(document.styleSheets||[]).forEach(i=>{try{const e=i.cssRules;if(!e)return;for(let c=0;c<e.length;c+=1){const o=e[c];t+=o&&o.cssText?o.cssText:""}}catch{}})}catch{}return`<style>${t}</style>`}function k(){try{return Array.from(document.querySelectorAll('link[rel="stylesheet"]')).map(r=>{const i=r.getAttribute("href");return i?`<link rel="stylesheet" href="${i}">`:""}).join("")}catch{return""}}async function P({orientation:t="portrait",title:r="Print"}={}){const i=await E(),e=k(),c=`@page{size:A4 ${t};margin:0}html,body{margin:0;padding:0;background:#fff}#templates-a4-root{transform:none!important}`;return`<!doctype html><html><head><meta charset="utf-8"><title>${r}</title>${e}${i}<style>${c}</style></head>`}async function U(t){if(!t)throw new Error("No host");let r=null;try{r=await h()}catch{r=null}const i=document.createElement("div");Object.assign(i.style,{position:"fixed",top:"0",left:"-12000px",pointerEvents:"none",zIndex:"-1",backgroundColor:"#ffffff"});const e=document.createElement("div");e.id="templates-a4-root",e.setAttribute("data-render-context","export"),e.setAttribute("dir",t.getAttribute("dir")||document.documentElement.getAttribute("dir")||"rtl");const c=document.createElement("div");c.setAttribute("data-a4-pages","");const o=t.querySelector("[data-a4-pages]")?.cloneNode(!0)||t.cloneNode(!0);o.classList&&o.hasAttribute("data-a4-pages")?e.appendChild(o):(c.appendChild(o),e.appendChild(c)),i.appendChild(e),document.body.appendChild(i);try{try{const n=Array.from(e.querySelectorAll(".cs-logo img")).map(a=>a.getAttribute("src")).filter(Boolean);await y(n)}catch{}if(await g(),Array.from(e.querySelectorAll(".a4-page")).forEach(n=>{b(n)||n.parentElement?.removeChild(n)}),w()==="html2pdf"&&typeof r=="function"){await r().set({margin:0,html2canvas:{scale:1.5,useCORS:!0,allowTaint:!1,backgroundColor:"#ffffff"},jsPDF:{unit:"mm",format:"a4",orientation:"landscape"},pagebreak:{mode:["css","legacy"]},image:{type:"jpeg",quality:.98}}).from(e).save("template-callsheet.pdf");return}const u=`${await P({orientation:"landscape",title:"Call Sheet"})}<body dir="${e.getAttribute("dir")||"rtl"}">${e.outerHTML}</body></html>`;if(A()&&_()){const n=C(u);if(n){setTimeout(()=>{try{n.focus(),n.print()}catch{}setTimeout(()=>{try{n.close()}catch{}},1200)},600);return}}const d=document.createElement("iframe");Object.assign(d.style,{position:"fixed",right:"0",bottom:"0",width:"1px",height:"1px",border:"0"}),document.body.appendChild(d);const s=d.contentWindow?.document;s&&(s.open(),s.write(u),s.close(),setTimeout(()=>{try{d.contentWindow?.focus(),d.contentWindow?.print()}catch{}setTimeout(()=>d.remove(),1200)},500))}finally{try{i.remove()}catch{}}}async function J(t,{orientation:r="portrait",filename:i="template.pdf"}={}){if(!t)throw new Error("No host");let e=null;try{e=await h()}catch{e=null}const c=document.createElement("div");Object.assign(c.style,{position:"fixed",top:"0",left:"-12000px",pointerEvents:"none",zIndex:"-1",backgroundColor:"#ffffff"});const o=document.createElement("div");o.id="templates-a4-root",o.setAttribute("data-render-context","export"),o.setAttribute("dir",t.getAttribute("dir")||document.documentElement.getAttribute("dir")||"rtl");const m=t.querySelector("[data-a4-pages]")?.cloneNode(!0)||t.cloneNode(!0);if(m.classList&&m.hasAttribute("data-a4-pages"))o.appendChild(m);else{const l=document.createElement("div");l.setAttribute("data-a4-pages",""),Array.from(t.children).forEach(u=>l.appendChild(u.cloneNode(!0))),o.appendChild(l)}c.appendChild(o),document.body.appendChild(c);try{try{const a=Array.from(o.querySelectorAll("img")).map(p=>p.getAttribute("src")).filter(Boolean);await y(a)}catch{}if(await g(),Array.from(o.querySelectorAll(".a4-page")).forEach(a=>{if(!b(a))try{a.parentElement?.removeChild(a)}catch{}}),w()==="html2pdf"&&typeof e=="function"){await e().set({margin:0,html2canvas:{scale:1.5,useCORS:!0,allowTaint:!1,backgroundColor:"#ffffff"},jsPDF:{unit:"mm",format:"a4",orientation:r==="landscape"?"landscape":"portrait"},pagebreak:{mode:["css","legacy"]},image:{type:"jpeg",quality:.98}}).from(o).save(i);return}const f=`${await P({orientation:r,title:"Print"})}<body dir="${o.getAttribute("dir")||"rtl"}">${o.outerHTML}</body></html>`;if(A()&&_()){const a=C(f);if(a){setTimeout(()=>{try{a.focus(),a.print()}catch{}setTimeout(()=>{try{a.close()}catch{}},1200)},600);return}}const s=document.createElement("iframe");Object.assign(s.style,{position:"fixed",right:"0",bottom:"0",width:"1px",height:"1px",border:"0"}),document.body.appendChild(s);const n=s.contentWindow?.document;n&&(n.open(),n.write(f),n.close(),setTimeout(()=>{try{s.contentWindow?.focus(),s.contentWindow?.print()}catch{}setTimeout(()=>s.remove(),1200)},500))}finally{try{c.remove()}catch{}}}export{U as printCallsheetFromHost,J as printGenericTemplate};
