import{a as L,c as E,i as v,m as A,t as s,l as $,g as q,b as k,A as M,n as C,u as f}from"./auth.js";import"./dashboard2.js";/* empty css   */import{i as H}from"./dashboardShell.js";L();E();H();v();A();let u="",p="",l=null,d=!1,m="";function o(){const e=document.querySelectorAll("[data-home-greeting]");if(!e.length)return;const t=s("home.hero.title","مرحباً بك"),a=u?s("home.hero.greetingUser","مرحباً {name}").replace("{name}",u):t;e.forEach(n=>{n.textContent=a})}function h(){const e=p==="admin";document.querySelectorAll("[data-admin-card]").forEach(t=>{e?t.classList.remove("hidden"):t.classList.add("hidden")})}function P(e){if(!e||typeof e!="object")return null;const t=a=>{const n=Number.parseInt(String(a??"0"),10);return Number.isFinite(n)?n:0};return{customers:{total:t(e?.customers?.total)},reservations:{total:t(e?.reservations?.total),today:t(e?.reservations?.today),upcoming:t(e?.reservations?.upcoming)},equipment:{total:t(e?.equipment?.total),maintenance:t(e?.equipment?.maintenance)},technicians:{total:t(e?.technicians?.total),busy:t(e?.technicians?.busy)},projects:{total:t(e?.projects?.total),active:t(e?.projects?.active)},maintenance:{open:t(e?.maintenance?.open),highPriority:t(e?.maintenance?.highPriority)}}}function O(e){return[{key:"customers.total",label:s("home.summary.customers","إجمالي العملاء"),value:e.customers.total,icon:"👥",accent:"primary",href:"dashboard.html#customers-tab",dashboardTab:"customers-tab"},{key:"reservations.today",label:s("home.summary.reservationsToday","حجوزات اليوم"),value:e.reservations.today,icon:"🛎️",accent:"success",href:"dashboard.html#reservations-tab",dashboardTab:"reservations-tab",dashboardSubTab:"my-reservations-tab"},{key:"reservations.upcoming",label:s("home.summary.reservationsUpcoming","حجوزات قادمة"),value:e.reservations.upcoming,icon:"🔔",accent:"info",href:"dashboard.html#reservations-tab",dashboardTab:"reservations-tab",dashboardSubTab:"calendar-tab"},{key:"projects.active",label:s("home.summary.projectsActive","مشاريع نشطة"),value:e.projects.active,icon:"🏗️",accent:"warning",href:"projects.html#projects-section",projectsTab:"projects-section",projectsSubTab:"projects-list-tab"},{key:"equipment.maintenance",label:s("home.summary.equipmentMaintenance","معدات قيد الصيانة"),value:e.equipment.maintenance,icon:"🛠️",accent:"error",href:"dashboard.html#maintenance-tab",dashboardTab:"maintenance-tab"},{key:"maintenance.highPriority",label:s("home.summary.maintenanceHigh","بلاغات صيانة عاجلة"),value:e.maintenance.highPriority,icon:"⚡",accent:"error",href:"dashboard.html#maintenance-tab",dashboardTab:"maintenance-tab"},{key:"technicians.busy",label:s("home.summary.techniciansBusy","أعضاء طاقم مشغولون"),value:e.technicians.busy,icon:"👷",accent:"secondary",href:"dashboard.html#technicians-tab",dashboardTab:"technicians-tab"}]}const y={primary:"bg-primary/10 text-primary",success:"bg-success/10 text-success",info:"bg-info/10 text-info",warning:"bg-warning/10 text-warning",error:"bg-error/10 text-error",secondary:"bg-secondary/10 text-secondary"};function _(e){if(typeof f!="function")return;const t=["dashboardTab","dashboardSubTab","projectsTab","projectsSubTab"],a={};if(t.forEach(n=>{Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n]??null)}),Object.keys(a).length!==0)try{const n=f(a);n&&typeof n.catch=="function"&&n.catch(b=>{console.warn("⚠️ [home] Failed to persist navigation preference",b)})}catch(n){console.warn("⚠️ [home] Failed to persist navigation preference",n)}}function B(e){e.querySelectorAll("[data-summary-card]").forEach(t=>{t.dataset.listenerAttached||(t.addEventListener("click",()=>{const a={};t.dataset.dashboardTab!==void 0&&(a.dashboardTab=t.dataset.dashboardTab||null),t.dataset.dashboardSubtab!==void 0&&(a.dashboardSubTab=t.dataset.dashboardSubtab||null),t.dataset.projectsTab!==void 0&&(a.projectsTab=t.dataset.projectsTab||null),t.dataset.projectsSubtab!==void 0&&(a.projectsSubTab=t.dataset.projectsSubtab||null),Object.keys(a).length>0&&_(a)}),t.dataset.listenerAttached="true")})}function R(e){const t=["glass-card","summary-card","flex","flex-col","items-center","gap-2","p-5","text-center","transition","duration-200","hover:-translate-y-1","focus-visible:outline","focus-visible:outline-2","focus-visible:outline-offset-2","focus-visible:outline-primary"],a=["data-summary-card"],n=x=>String(x??"").replace(/"/g,"&quot;");e.href&&a.push(`href="${n(e.href)}"`),e.dashboardTab!==void 0&&a.push(`data-dashboard-tab="${n(e.dashboardTab??"")}"`),e.dashboardSubTab!==void 0&&a.push(`data-dashboard-subtab="${n(e.dashboardSubTab??"")}"`),e.projectsTab!==void 0&&a.push(`data-projects-tab="${n(e.projectsTab??"")}"`),e.projectsSubTab!==void 0&&a.push(`data-projects-subtab="${n(e.projectsSubTab??"")}"`);const b=C(String(e.value??0)),j=n(e.label),S=y[e.accent]||y.primary;return`
    <a ${a.join(" ")} class="${t.join(" ")}" aria-label="${j}">
      <span class="summary-card__icon flex h-12 w-12 items-center justify-center rounded-2xl text-2xl ${S}">${e.icon}</span>
      <span class="summary-card__label text-sm font-medium text-base-content/70">${e.label}</span>
      <span class="summary-card__value text-3xl font-bold text-base-content">${b}</span>
    </a>
  `}function i(){const e=document.querySelector("[data-home-summary]");if(!e)return;if(d){e.innerHTML=`
      <div class="w-full text-center text-base-content/60" data-i18n data-i18n-key="home.summary.loading">
        ${s("home.summary.loading","⏳ جارٍ جلب بيانات النظام...")}
      </div>
    `;return}if(m){e.innerHTML=`
      <div class="alert alert-warning" role="alert">
        ${m}
      </div>
    `;return}if(!l){e.innerHTML=`
      <div class="w-full text-center text-base-content/60">
        ${s("home.summary.empty","لا تتوفر بيانات بعد. ابدأ بإضافة سجلات.")} 
      </div>
    `;return}const t=O(l);e.innerHTML=t.map(R).join(""),B(e)}async function T({silent:e=!1}={}){if(!d){d=!0,e||i();try{const t=await k("/summary/");l=P(t?.data??null),m=""}catch(t){console.error("❌ [home] Failed to load summary data",t),l=null,m=t instanceof M?t.message:s("home.summary.error","تعذر تحميل بيانات النظام، حاول لاحقاً")}finally{d=!1,i()}}}function r(){T({silent:!0}).catch(e=>{console.error("❌ [home] Summary refresh failed",e)})}const c=document.getElementById("home-refresh-summary");c&&!c.dataset.listenerAttached&&(c.addEventListener("click",()=>{r()}),c.dataset.listenerAttached="true");document.addEventListener("language:translationsReady",()=>{o(),i()});document.addEventListener("language:changed",()=>{o(),i()});function g(){v();const e=document.getElementById("logout-btn");e&&!e.dataset.listenerAttached&&(e.addEventListener("click",()=>$()),e.dataset.listenerAttached="true"),q({refresh:!0}).then(t=>{u=t?.username||"",p=(t?.role||"").toLowerCase(),o(),h()}).catch(()=>{u="",p="",o(),h()}),o(),h(),i(),T(),document.addEventListener("customers:changed",r,{passive:!0}),document.addEventListener("reservations:changed",r,{passive:!0}),document.addEventListener("equipment:changed",r,{passive:!0}),document.addEventListener("maintenance:updated",r,{passive:!0}),document.addEventListener("technicians:updated",r,{passive:!0}),document.addEventListener("projects:changed",r,{passive:!0})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{g()},{once:!0}):g();
