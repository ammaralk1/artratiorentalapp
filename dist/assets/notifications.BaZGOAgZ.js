import{r as rt,a as ct,c as lt,g as dt,j as c,b as f,t as w}from"./auth.CBLJBoUs.js";import{i as ht}from"./dashboardShell.DF2kUed9.js";rt({ar:{"notifications.title":"Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª","notifications.header":"ğŸ”” Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª","notifications.subtitle":"Ø£Ø±Ø³Ù„ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù„Ù„ÙØ±ÙŠÙ‚ Ø¨Ø®ØµÙˆØµ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª/Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ØŒ ÙˆØ­Ø¯Ø¯ Ø§Ù„Ù‚Ù†ÙˆØ§Øª ÙˆØ§Ù„Ù…Ø³ØªÙ„Ù…ÙŠÙ†.","notifications.form.entityType":"Ø§Ù„Ù†ÙˆØ¹","notifications.form.entity.reservation":"Ø­Ø¬Ø²","notifications.form.entity.project":"Ù…Ø´Ø±ÙˆØ¹","notifications.form.search":"Ø¨Ø­Ø«","notifications.form.search.placeholder":"Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„ÙƒÙˆØ¯ Ø£Ùˆ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†","notifications.table.headers.code":"Ø§Ù„ÙƒÙˆØ¯","notifications.table.headers.title":"Ø§Ù„Ø¹Ù†ÙˆØ§Ù†","notifications.table.headers.when":"Ø§Ù„ÙˆÙ‚Øª","notifications.table.headers.customer":"Ø§Ù„Ø¹Ù…ÙŠÙ„","notifications.table.headers.actions":"Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª","notifications.table.loading":"â³ Ø§ÙƒØªØ¨ Ù„Ù„Ø¨Ø­Ø«â€¦","notifications.compose.title":"âœ‰ï¸ Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø³Ø§Ù„Ø©","notifications.logs.title":"ğŸ“œ Ø³Ø¬Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª","notifications.sidebar.helpLinksHeading":"Ø±ÙˆØ§Ø¨Ø· Ù…Ø³Ø§Ø¹Ø¯Ø©","notifications.sidebar.helpLinksAria":"Ø±ÙˆØ§Ø¨Ø· Ù…Ø³Ø§Ø¹Ø¯Ø©","notifications.chat.searchButton":"ğŸ” Ø¨Ø­Ø«","notifications.chat.refreshButton":"ğŸ”„ ØªØ­Ø¯ÙŠØ«","notifications.chat.liveToggle":"ØªØ­Ø¯ÙŠØ« Ø­ÙŠ (Ù„Ø§ÙŠÙ)","notifications.chat.status.label":"Ø§Ù„Ø­Ø§Ù„Ø©:","notifications.chat.status.stopped":"Ù…ØªÙˆÙ‚Ù","notifications.chat.lastSeen":"Ø¢Ø®Ø± Ù…Ø´Ø§Ù‡Ø¯Ø©:","notifications.chat.input.placeholder":"Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©â€¦","notifications.chat.send":"Ø¥Ø±Ø³Ø§Ù„","notifications.chat.sendPhoto":"ğŸ“· ØµÙˆØ±Ø©","notifications.chat.sendPhotos":"ğŸ–¼ï¸ ØµÙˆØ± Ù…ØªØ¹Ø¯Ø¯Ø©","notifications.compose.extraEmails.placeholder":"Ø¥ÙŠÙ…ÙŠÙ„Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© (Ù…ÙØµÙˆÙ„Ø© Ø¨ÙÙˆØ§ØµÙ„)","notifications.compose.extraChatIds.placeholder":"Ù…Ø¹Ø±Ù‘ÙØ§Øª ØªÙ„ÙŠØºØ±Ø§Ù… Ø¥Ø¶Ø§ÙÙŠØ© (Ù…ÙØµÙˆÙ„Ø© Ø¨ÙÙˆØ§ØµÙ„)","notifications.compose.templateLabel":"Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø±Ø³Ø§Ù„Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)","notifications.compose.template.none":"â€” Ø¨Ø¯ÙˆÙ† Ù‚Ø§Ù„Ø¨ â€”","notifications.compose.subject.placeholder":"ØªÙ†Ø¨ÙŠÙ‡ Ø¥Ø¯Ø§Ø±ÙŠ","notifications.compose.body.placeholder":"Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§","notifications.compose.preview":"ğŸ‘ï¸ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…Ø³ØªÙ„Ù…ÙŠÙ†","notifications.compose.retryLast":"ğŸ” Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙØ§Ø´Ù„Ø© (Ø¢Ø®Ø± Ø¯ÙØ¹Ø©)","notifications.logs.clear":"ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„","notifications.logs.headers.name":"Ø§Ù„Ø§Ø³Ù…","notifications.templates.title":"ğŸ§© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨","notifications.templates.subtitle":"Ø¥Ù†Ø´Ø§Ø¡/ØªØ¹Ø¯ÙŠÙ„ Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø¨Ù…ØªØºÙŠØ±Ø§Øª.","notifications.templates.actions.refresh":"ğŸ”„ ØªØ­Ø¯ÙŠØ«","notifications.templates.actions.new":"â• Ù‚Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯","notifications.templates.actions.vars":"ğŸ§  Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª","notifications.logs.subtitle":"ØªØ§Ø¨Ø¹ Ø¢Ø®Ø± Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ ÙˆØ­Ø§Ù„Ø© ÙƒÙ„ Ø±Ø³Ø§Ù„Ø©.","notifications.logs.refresh":"ğŸ”„ ØªØ­Ø¯ÙŠØ«","notifications.logs.loading":"â³ Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„â€¦","notifications.logs.filters.allEntities":"ÙƒÙ„ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹","notifications.logs.filters.allChannels":"ÙƒÙ„ Ø§Ù„Ù‚Ù†ÙˆØ§Øª","notifications.logs.filters.allStatuses":"ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª","notifications.logs.filters.sent":"Ù…Ø±Ø³Ù„Ø©","notifications.logs.filters.failed":"ÙØ§Ø´Ù„Ø©","notifications.logs.filters.q.placeholder":"Ø¨Ø­Ø« Ø¨Ø§Ù„Ù…Ø³ØªÙ„Ù…/Ø§Ù„Ø±Ù‚Ù…","notifications.channels.email":"Ø¥ÙŠÙ…ÙŠÙ„","notifications.channels.telegram":"ØªÙ„ÙŠØºØ±Ø§Ù…","notifications.logs.headers.time":"Ø§Ù„ÙˆÙ‚Øª","notifications.logs.headers.event":"Ø§Ù„Ø­Ø¯Ø«","notifications.logs.headers.entity":"Ø§Ù„Ù†ÙˆØ¹/Ø§Ù„Ù…Ø¹Ø±Ù","notifications.logs.headers.recipient":"Ø§Ù„Ù…Ø³ØªÙ„Ù…","notifications.logs.headers.channel":"Ø§Ù„Ù‚Ù†Ø§Ø©","notifications.logs.headers.status":"Ø§Ù„Ø­Ø§Ù„Ø©","notifications.logs.headers.error":"Ø§Ù„Ø®Ø·Ø£","notifications.templates.vars.help":"Ø§Ø³ØªØ®Ø¯Ù… ØµÙŠØºØ© {{variable}}. Ø£Ù…Ø«Ù„Ø© Ù…ØªØ§Ø­Ø©:","notifications.templates.table.headers.name":"Ø§Ù„Ø§Ø³Ù…","notifications.templates.table.headers.channel":"Ø§Ù„Ù‚Ù†Ø§Ø©","notifications.templates.table.headers.updated":"Ø¢Ø®Ø± ØªØ¹Ø¯ÙŠÙ„","notifications.templates.table.headers.actions":"Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª","notifications.templates.form.labels.name":"Ø§Ù„Ø§Ø³Ù…","notifications.templates.form.labels.channel":"Ø§Ù„Ù‚Ù†Ø§Ø©","notifications.templates.form.labels.attachment":"Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ù„ØªÙŠÙ„ÙŠØºØ±Ø§Ù…)","notifications.templates.form.labels.attachments":"Ø±ÙˆØ§Ø¨Ø· ØµÙˆØ± Ù…ØªØ¹Ø¯Ø¯Ø© (ÙƒÙ„ Ø³Ø·Ø± Ø±Ø§Ø¨Ø·)","notifications.templates.form.labels.subject":"Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹","notifications.templates.form.labels.text":"Ø§Ù„Ù†Øµ (Text)","notifications.templates.form.labels.html":"HTML (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ù„Ù„Ø¨Ø±ÙŠØ¯)","notifications.templates.form.placeholders.name":"Ø§Ø³Ù… Ø§Ù„Ù‚Ø§Ù„Ø¨","notifications.templates.form.placeholders.attachment":"https://...jpg","notifications.templates.form.placeholders.attachments":"https://..1.jpg\\nhttps://..2.jpg\\n...","notifications.templates.form.placeholders.subject":"Ù…Ø«Ø§Ù„: Ø¥Ø´Ø¹Ø§Ø±...","notifications.templates.form.placeholders.text":"Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø© (Ø³ÙŠÙØ³ØªØ®Ø¯Ù… Ø£ÙŠØ¶Ø§Ù‹ ÙƒØªØ³Ù…ÙŠØ© Ù„Ù„ØµÙˆØ±Ø©)","notifications.templates.form.placeholders.html":"HTML Ù„Ù„Ø±Ø³Ø§Ù„Ø©","notifications.templates.actions.save":"ğŸ’¾ Ø­ÙØ¸","notifications.templates.actions.cancel":"Ø¥Ù„ØºØ§Ø¡","notifications.telegram.tech.title":"âœˆï¸ Ø±Ø¨Ø· ØªÙŠÙ„ÙŠØºØ±Ø§Ù… Ù„Ù„ÙÙ†ÙŠÙŠÙ†","notifications.telegram.tech.subtitle":"Ø§Ù„Ø±Ø¨Ø· ÙŠØªÙ… Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© Ù„ÙƒÙ„ ÙÙ†ÙŠ. Ø£Ù†Ø´Ø¦ Ø§Ù„Ø±Ø§Ø¨Ø· ÙˆØ§Ù†Ø³Ø®Ù‡ ÙˆØ£Ø±Ø³Ù„Ù‡ Ù„Ù„ÙÙ†ÙŠ Ø®Ø§Ø±Ø¬ Ø§Ù„Ù†Ø¸Ø§Ù…. Ø¨Ø¹Ø¯ Ø£Ù† ÙŠÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø· ÙˆÙŠØ¶ØºØ· Start Ø³ØªØµÙ„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.","notifications.telegram.techTable.headers.tech":"Ø§Ù„ÙÙ†ÙŠ","notifications.telegram.techTable.headers.phone":"Ø§Ù„Ø¬ÙˆØ§Ù„","notifications.telegram.techTable.headers.status":"Ø§Ù„Ø­Ø§Ù„Ø©","notifications.telegram.techTable.headers.actions":"Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª","notifications.telegram.admin.title":"ğŸ‘‘ Ø±Ø¨Ø· ØªÙŠÙ„ÙŠØºØ±Ø§Ù… Ù„Ù„Ø¥Ø¯Ù…Ù†","notifications.telegram.admin.subtitle":"ÙŠÙØ³ØªØ®Ø¯Ù… ÙƒÙ‚Ù†Ø§Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø£Ùˆ Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø¥Ø¯Ù…Ù†. Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠÙØ³ØªØ®Ø¯Ù… Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·.","notifications.telegram.adminTable.headers.chatId":"Ù…Ø¹Ø±Ù‘Ù Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©","notifications.telegram.adminTable.headers.lastUsed":"Ø¢Ø®Ø± Ø§Ø³ØªØ®Ø¯Ø§Ù…","notifications.telegram.adminTable.headers.actions":"Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª","notifications.telegram.webhook.title":"ğŸ”— Ø­Ø§Ù„Ø© Webhook Ù„ØªÙ„ÙŠØºØ±Ø§Ù…","notifications.telegram.webhook.subtitle":"ØªØ¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„Ø±Ø¨Ø· ÙˆØªØ³Ù…Ø­ Ø¨Ø¶Ø¨Ø·Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.","notifications.telegram.webhook.actions.fix":"âš™ï¸ Ø¶Ø¨Ø·/Ø¥ØµÙ„Ø§Ø­ Webhook","notifications.diagnostics.title":"ğŸ§ª Diagnostics","notifications.diagnostics.subtitle":"ÙØ­Øµ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ ÙˆØ§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ÙˆØ§Ù„ØªÙ„ÙŠØºØ±Ø§Ù….","notifications.diagnostics.actions.refresh":"ğŸ”„ ÙØ­Øµ","notifications.diagnostics.headers.item":"Ø§Ù„Ø¹Ù†ØµØ±","notifications.diagnostics.headers.status":"Ø§Ù„Ø­Ø§Ù„Ø©","notifications.diagnostics.headers.note":"Ù…Ù„Ø§Ø­Ø¸Ø©","notifications.chat.subtitle":"Ø§Ø®ØªØ± ÙÙ†ÙŠ Ù„Ø¹Ø±Ø¶ Ø¢Ø®Ø± Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ÙˆØ§Ù„Ø±Ø¯ Ø¹Ù„ÙŠÙ‡.","notifications.telegram.techSearch":"Ø¨Ø­Ø« Ø§Ù„ÙÙ†ÙŠÙŠÙ†","notifications.chat.title":"ğŸ’¬ Ù…Ø­Ø§Ø¯Ø«Ø© ØªÙŠÙ„ÙŠØºØ±Ø§Ù… (ØªØ¬Ø±ÙŠØ¨ÙŠ)","notifications.chat.recent":"Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø©","notifications.chat.pickTechnician":"Ø§Ø®ØªÙŠØ§Ø± ÙÙ†ÙŠ","notifications.chat.techSearch.placeholder":"Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø¬ÙˆØ§Ù„","notifications.telegram.admin.generate":"ğŸ”— ØªÙˆÙ„ÙŠØ¯ Ø±Ø§Ø¨Ø· Ø¥Ø¯Ù…Ù†","notifications.telegram.admin.copy":"ğŸ“‹ Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·"},en:{"notifications.title":"Notification Center","notifications.header":"ğŸ”” Notification Center","notifications.subtitle":"Send alerts to the team about reservations/projects, choose channels and recipients.","notifications.form.entityType":"Type","notifications.form.entity.reservation":"Reservation","notifications.form.entity.project":"Project","notifications.form.search":"Search","notifications.form.search.placeholder":"Search by code or title","notifications.table.headers.code":"Code","notifications.table.headers.title":"Title","notifications.table.headers.when":"When","notifications.table.headers.customer":"Customer","notifications.table.headers.actions":"Actions","notifications.table.loading":"â³ Type to searchâ€¦","notifications.compose.title":"âœ‰ï¸ Compose Message","notifications.logs.title":"ğŸ“œ Notifications Log","notifications.sidebar.helpLinksHeading":"Helpful Links","notifications.sidebar.helpLinksAria":"Helpful Links","notifications.chat.searchButton":"ğŸ” Search","notifications.chat.refreshButton":"ğŸ”„ Refresh","notifications.chat.liveToggle":"Live update","notifications.chat.status.label":"Status:","notifications.chat.status.stopped":"Stopped","notifications.chat.lastSeen":"Last seen:","notifications.chat.input.placeholder":"Type a messageâ€¦","notifications.chat.send":"Send","notifications.chat.sendPhoto":"ğŸ“· Photo","notifications.chat.sendPhotos":"ğŸ–¼ï¸ Multiple photos","notifications.compose.extraEmails.placeholder":"Additional emails (comma-separated)","notifications.compose.extraChatIds.placeholder":"Additional Telegram chat IDs (comma-separated)","notifications.compose.templateLabel":"Message template (optional)","notifications.compose.template.none":"â€” No template â€”","notifications.compose.subject.placeholder":"Administrative alert","notifications.compose.body.placeholder":"Type your message here","notifications.compose.preview":"ğŸ‘ï¸ Preview recipients","notifications.compose.retryLast":"ğŸ” Retry failed (last batch)","notifications.logs.clear":"ğŸ—‘ï¸ Clear log","notifications.logs.headers.name":"Name","notifications.templates.title":"ğŸ§© Templates Manager","notifications.templates.subtitle":"Create/edit message templates with variables.","notifications.templates.actions.refresh":"ğŸ”„ Refresh","notifications.templates.actions.new":"â• New template","notifications.templates.actions.vars":"ğŸ§  Variables guide","notifications.logs.subtitle":"Track recent sends and their status.","notifications.logs.refresh":"ğŸ”„ Refresh","notifications.logs.loading":"â³ Loadingâ€¦","notifications.logs.filters.allEntities":"All types","notifications.logs.filters.allChannels":"All channels","notifications.logs.filters.allStatuses":"All statuses","notifications.logs.filters.sent":"Sent","notifications.logs.filters.failed":"Failed","notifications.logs.filters.q.placeholder":"Search by recipient/number","notifications.channels.email":"Email","notifications.channels.telegram":"Telegram","notifications.logs.headers.time":"Time","notifications.logs.headers.event":"Event","notifications.logs.headers.entity":"Entity/ID","notifications.logs.headers.recipient":"Recipient","notifications.logs.headers.channel":"Channel","notifications.logs.headers.status":"Status","notifications.logs.headers.error":"Error","notifications.templates.vars.help":"Use the {{variable}} format. Examples:","notifications.templates.table.headers.name":"Name","notifications.templates.table.headers.channel":"Channel","notifications.templates.table.headers.updated":"Last updated","notifications.templates.table.headers.actions":"Actions","notifications.templates.form.labels.name":"Name","notifications.templates.form.labels.channel":"Channel","notifications.templates.form.labels.attachment":"Image URL (optional for Telegram)","notifications.templates.form.labels.attachments":"Multiple image URLs (one per line)","notifications.templates.form.labels.subject":"Subject","notifications.templates.form.labels.text":"Text","notifications.templates.form.labels.html":"HTML (optional for email)","notifications.templates.form.placeholders.name":"Template name","notifications.templates.form.placeholders.attachment":"https://...jpg","notifications.templates.form.placeholders.attachments":"https://..1.jpg\\nhttps://..2.jpg\\n...","notifications.templates.form.placeholders.subject":"e.g. Notification...","notifications.templates.form.placeholders.text":"Message text (also used as image caption)","notifications.templates.form.placeholders.html":"Email HTML content","notifications.templates.actions.save":"ğŸ’¾ Save","notifications.templates.actions.cancel":"Cancel","notifications.telegram.tech.title":"âœˆï¸ Telegram linking for technicians","notifications.telegram.tech.subtitle":"Link is generated once per technician. Create and share the link outside the system. After pressing Start in Telegram, notifications will be delivered automatically.","notifications.telegram.techTable.headers.tech":"Technician","notifications.telegram.techTable.headers.phone":"Phone","notifications.telegram.techTable.headers.status":"Status","notifications.telegram.techTable.headers.actions":"Actions","notifications.telegram.admin.title":"ğŸ‘‘ Telegram linking for admins","notifications.telegram.admin.subtitle":"Used as a primary or fallback channel for admin notifications. The link is one-time use.","notifications.telegram.adminTable.headers.chatId":"Chat ID","notifications.telegram.adminTable.headers.lastUsed":"Last used","notifications.telegram.adminTable.headers.actions":"Actions","notifications.telegram.webhook.title":"ğŸ”— Telegram Webhook status","notifications.telegram.webhook.subtitle":"Shows webhook status and allows automatic setup.","notifications.telegram.webhook.actions.fix":"âš™ï¸ Setup/Fix Webhook","notifications.diagnostics.title":"ğŸ§ª Diagnostics","notifications.diagnostics.subtitle":"Check required tables and columns for notifications and Telegram.","notifications.diagnostics.actions.refresh":"ğŸ”„ Check","notifications.diagnostics.headers.item":"Item","notifications.diagnostics.headers.status":"Status","notifications.diagnostics.headers.note":"Note","notifications.chat.subtitle":"Pick a technician to view recent messages and reply.","notifications.telegram.techSearch":"Technicians search","notifications.chat.title":"ğŸ’¬ Telegram chat (beta)","notifications.chat.recent":"Recent chats","notifications.chat.pickTechnician":"Pick a technician","notifications.chat.techSearch.placeholder":"Search by name or phone","notifications.telegram.admin.generate":"ğŸ”— Generate admin link","notifications.telegram.admin.copy":"ğŸ“‹ Copy link"}});ct();ht();const t={};let A=null,T=null,R=null,k=!1,x=null,S=0,j=!1,y=null,F=!1;function s(e){return document.querySelector(e)}function mt(){t.entityType=s("#notif-entity-type"),t.search=s("#notif-search"),t.resultsBody=s("#notif-results-body"),t.composeSection=s("#notif-compose-section"),t.selectedSummary=s("#notif-selected-summary"),t.chEmail=s("#notif-channel-email"),t.chTelegram=s("#notif-channel-telegram"),t.toTechs=s("#notif-to-techs"),t.toAdmins=s("#notif-to-admins"),t.extraEmails=s("#notif-extra-emails"),t.extraChatIds=s("#notif-extra-chatids"),t.templateSelect=s("#notif-template"),t.subject=s("#notif-subject"),t.body=s("#notif-body"),t.sendBtn=s("#notif-send-btn"),t.previewBtn=s("#notif-preview-btn"),t.retryLastBtn=s("#notif-retry-last"),t.previewBox=s("#notif-preview"),t.tReminder=s("#notif-template-reminder"),t.tNote=s("#notif-template-note"),t.logEntity=s("#log-filter-entity"),t.logChannel=s("#log-filter-channel"),t.logStatus=s("#log-filter-status"),t.logBatch=s("#log-filter-batch"),t.logQ=s("#log-filter-q"),t.logRefresh=s("#log-refresh-btn"),t.logClear=s("#log-clear-btn"),t.logBody=s("#notif-logs-body"),t.logPagination=s("#log-pagination"),t.logFailedSummary=s("#notif-logs-failed-summary"),t.diagRefresh=s("#notif-diag-refresh"),t.diagBody=s("#notif-diag-body"),t.tplRefresh=s("#tpl-refresh"),t.tplNew=s("#tpl-new"),t.tplVars=s("#tpl-vars"),t.tplVarsBox=s("#tpl-vars-box"),t.tplTable=s("#tpl-table"),t.tplBody=s("#tpl-body"),t.tplForm=s("#tpl-form"),t.tplId=s("#tpl-id"),t.tplName=s("#tpl-name"),t.tplChannel=s("#tpl-channel"),t.tplAttachment=s("#tpl-attachment"),t.tplAttachments=s("#tpl-attachments"),t.tplSubject=s("#tpl-subject"),t.tplText=s("#tpl-text"),t.tplHtml=s("#tpl-html"),t.tplSave=s("#tpl-save"),t.tplCancel=s("#tpl-cancel"),t.tgSearch=s("#tg-tech-search"),t.tgSearchBtn=s("#tg-tech-search-btn"),t.tgRefreshBtn=s("#tg-tech-refresh-btn"),t.tgBody=s("#tg-tech-body"),t.tgAdminGenBtn=s("#tg-admin-gen-btn"),t.tgAdminCopyBtn=s("#tg-admin-copy-btn"),t.tgAdminBody=s("#tg-admin-body"),t.tgAdminLinkBox=s("#tg-admin-link-box"),t.tgWebhookRefresh=s("#tg-webhook-refresh"),t.tgWebhookSet=s("#tg-webhook-set"),t.tgWebhookInfo=s("#tg-webhook-info"),t.tgChatSearch=s("#tg-chat-tech-search"),t.tgChatPick=s("#tg-chat-pick-btn"),t.tgChatRefresh=s("#tg-chat-refresh-btn"),t.tgChatSelected=s("#tg-chat-selected"),t.tgChatMessages=s("#tg-chat-messages"),t.tgChatInput=s("#tg-chat-input"),t.tgChatSend=s("#tg-chat-send"),t.tgChatSendPhoto=s("#tg-chat-send-photo"),t.tgChatSendPhotos=s("#tg-chat-send-photos"),t.tgChatLive=s("#tg-chat-live"),t.tgLiveStatus=s("#tg-live-status"),t.tgChatLastSeen=s("#tg-chat-last-seen"),t.tgChatList=s("#tg-chat-list"),t.tgChatListRefresh=s("#tg-chat-list-refresh")}function J(e,a){const n=e.start_datetime||e.startDate||"",i=e.end_datetime||e.endDate||"";return n&&i&&n!==i?`${n} â€” ${i}`:n||i||""}function ft(e,a){if(!Array.isArray(e)||e.length===0){t.resultsBody.innerHTML=`<tr><td colspan="5" class="text-center text-muted">${w("notifications.table.loading","Ù„Ø§ Ù†ØªØ§Ø¦Ø¬")}</td></tr>`;return}t.resultsBody.innerHTML=e.map(n=>{const i=a==="reservation"?n.reservation_code||"":n.project_code||"",o=n.title||"",r=J(n),l=a==="reservation"?n.customer_name||"":n.client_name||"";return`
      <tr>
        <td>${i||"â€”"}</td>
        <td>${o||"â€”"}</td>
        <td>${r||"â€”"}</td>
        <td>${l||"â€”"}</td>
        <td><button type="button" class="btn btn-sm btn-primary" data-select-id="${n.id}" data-select-type="${a}">${w("notifications.table.select","Ø§Ø®ØªÙŠØ§Ø±")}</button></td>
      </tr>
    `}).join("")}async function W(){const e=t.entityType.value,a=(t.search.value||"").trim();try{const n=e==="reservation"?"/reservations/":"/projects/",i=new URLSearchParams;a!==""&&i.set("search",a),i.set("limit","20");const o=await f(`${n}?${i.toString()}`);ft(o?.data??[],e)}catch(n){console.error(n),t.resultsBody.innerHTML='<tr><td colspan="5" class="text-center text-error">ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</td></tr>'}}function gt(){T&&clearTimeout(T),T=setTimeout(W,350)}function pt(e,a){const n=e==="reservation"?a.reservation_code||"":a.project_code||"",i=a.title||n||e,o=J(a),r=a.location||"",l=e==="reservation"?a.customer_name||"":a.client_name||"";return[n?`Ø§Ù„ÙƒÙˆØ¯: ${n}`:"",`Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${i}`,o?`Ø§Ù„ÙˆÙ‚Øª: ${o}`:"",r?`Ø§Ù„Ù…ÙˆÙ‚Ø¹: ${r}`:"",l?`Ø§Ù„Ø¹Ù…ÙŠÙ„: ${l}`:""].filter(Boolean).join(" | ")}async function ut(e,a){try{const o=(await f(`${a==="reservation"?"/reservations/":"/projects/"}?id=${encodeURIComponent(e)}`))?.data;if(!o)throw new Error("Not found");A={type:a,id:Number(o.id),summary:pt(a,o)},t.selectedSummary.textContent=A.summary,t.composeSection.hidden=!1;try{setTimeout(()=>{t.composeSection?.scrollIntoView({behavior:"smooth",block:"start"}),t.body&&typeof t.body.focus=="function"&&t.body.focus()},10)}catch{}try{await U()}catch{}}catch(n){console.error(n),c("âš ï¸ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù…Ø­Ø¯Ø¯")}}function yt(e,{prefix:a}={}){if(!t.previewBox)return;const n=K(e,{prefix:a});t.previewBox.innerHTML=n;try{bt(e)}catch{}}function K(e,{prefix:a}={}){const n=e?.sent||null,i=e?.targets||{},o=e?.targets_detail||{};let r=Number(i.email||0),l=Number(i.telegram||0);const d=Array.isArray(o.email)?o.email:[],h=Array.isArray(o.telegram)?o.telegram:[];!r&&d.length&&(r=d.length),!l&&h.length&&(l=h.length);const m=(L,C=10)=>{const I=L.map(P=>String(P.name||P.recipient||"")).filter(Boolean),b=Array.from(new Set(I));return b.length?b.length<=C?b.join("ØŒ "):b.slice(0,C).join("ØŒ ")+`ØŒ Ùˆ+${b.length-C} Ø¢Ø®Ø±ÙŠÙ†`:""},g=[];if(r){const L=n&&typeof n.email=="number"?`${n.email}/${r}`:String(r),C=m(d);g.push(`Ø¥ÙŠÙ…ÙŠÙ„: <strong>${L}</strong>${C?` â€” ${C}`:""}`)}if(l){const L=n&&typeof n.telegram=="number"?`${n.telegram}/${l}`:String(l),C=m(h);g.push(`ØªÙ„ÙŠØºØ±Ø§Ù…: <strong>${L}</strong>${C?` â€” ${C}`:""}`)}const u=a?`<span class="text-base-content/80">${a}</span> â€” `:"",v=g.length?g.join(" | "):"Ù„Ø§ Ù…Ø³ØªÙ„Ù…ÙŠÙ† Ù…Ø·Ø§Ø¨Ù‚ÙŠÙ†.";return u+v}function bt(e){const a=e?.targets||{},n=e?.targets_detail||{};let i=Number(a.email||0),o=Number(a.telegram||0);!i&&Array.isArray(n.email)&&(i=n.email.length),!o&&Array.isArray(n.telegram)&&(o=n.telegram.length);const r=(l,d,h)=>{if(!l)return;const m=l.parentElement?.querySelector("span");m&&(m.textContent=h?`${d} (${h})`:d)};r(t.chEmail,"Ø¥ÙŠÙ…ÙŠÙ„",i),r(t.chTelegram,"ØªÙ„ÙŠØºØ±Ø§Ù…",o)}async function vt(){if(!A){c("Ø§Ø®ØªØ± Ø¹Ù†ØµØ±Ø§Ù‹ Ø£ÙˆÙ„Ø§Ù‹");return}const e={email:!!t.chEmail.checked,telegram:!!t.chTelegram.checked};if(!e.email&&!e.telegram){c("Ø§Ø®ØªØ± Ù‚Ù†Ø§Ø© Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„");return}const a={technicians:!!t.toTechs.checked,admins:!!t.toAdmins.checked,additional_emails:(t.extraEmails.value||"").split(",").map(i=>i.trim()).filter(Boolean),additional_telegram_chat_ids:(t.extraChatIds.value||"").split(",").map(i=>i.trim()).filter(Boolean)},n={subject:(t.subject.value||"ØªÙ†Ø¨ÙŠÙ‡ Ø¥Ø¯Ø§Ø±ÙŠ").trim(),text:(t.body.value||"").trim()};if(!n.text){c("Ø§ÙƒØªØ¨ Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©");return}try{const i=await f("/notifications/send.php",{method:"POST",body:{entity_type:A.type,entity_id:A.id,template_id:t.templateSelect&&t.templateSelect.value?Number(t.templateSelect.value):void 0,channels:e,recipients:a,message:n}}),o=i?.data||{},r=o?.sent||{email:0,telegram:0},l=o?.targets||{email:0,telegram:0},d=o?.targets_detail||{email:[],telegram:[]},h=Number(r.email||0),m=Number(r.telegram||0);let g=Number(l.email||0),u=Number(l.telegram||0);!g&&Array.isArray(d.email)&&(g=d.email.length),!u&&Array.isArray(d.telegram)&&(u=d.telegram.length);const v=[],L=g>0||h>0,C=u>0||m>0;if(L){const b=h>0?`Ø¥ÙŠÙ…ÙŠÙ„: ${h}/${g}`:g>0?`Ø¥ÙŠÙ…ÙŠÙ„: ${g}`:"";b&&v.push(b)}if(C){const b=m>0?`ØªÙ„ÙŠØºØ±Ø§Ù…: ${m}/${u}`:u>0?`ØªÙ„ÙŠØºØ±Ø§Ù…: ${u}`:"";b&&v.push(b)}L&&h===0&&g>0&&o?.errors?.last_email_error&&v.push("ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨Ø±ÙŠØ¯");const I=v.length?` â€” ${v.join(" | ")}`:"";c(`${w("notifications.compose.sentOk","ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­")}${I}`),yt(o,{prefix:"Ø¢Ø®Ø± Ø¥Ø±Ø³Ø§Ù„"});try{const b=Number(l.email||0)+Number(l.telegram||0),P=Number(r.email||0)+Number(r.telegram||0),st=b>P;if(t.retryLastBtn){const G=i?.data?.batch_id||o?.batch_id;st&&G?(t.retryLastBtn.hidden=!1,t.retryLastBtn.setAttribute("data-batch",String(G))):(t.retryLastBtn.hidden=!0,t.retryLastBtn.removeAttribute("data-batch"))}}catch{}_()}catch(i){console.error(i);const o=i&&i.message?String(i.message):"ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„";c(o)}}async function Lt(){const e=t.retryLastBtn?.getAttribute("data-batch")||"";if(!e){c("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯ÙØ¹Ø© Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©");return}try{const a=await f("/notifications/retry.php",{method:"POST",body:{batch_id:e}}),n=Number(a?.data?.sent||0);c(`ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© â€” Ø£ÙØ±Ø³Ù„Øª: ${n}`),_()}catch(a){console.error(a);const n=a&&(a.payload?.error||a.message)?String(a.payload?.error||a.message):"ÙØ´Ù„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©";c(n)}}async function U(){if(!A){c("Ø§Ø®ØªØ± Ø¹Ù†ØµØ±Ø§Ù‹ Ø£ÙˆÙ„Ø§Ù‹");return}const e={email:!!t.chEmail.checked,telegram:!!t.chTelegram.checked};if(!e.email&&!e.telegram){c("Ø§Ø®ØªØ± Ù‚Ù†Ø§Ø© Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„");return}const a={technicians:!!t.toTechs.checked,admins:!!t.toAdmins.checked,additional_emails:(t.extraEmails.value||"").split(",").map(n=>n.trim()).filter(Boolean),additional_telegram_chat_ids:(t.extraChatIds.value||"").split(",").map(n=>n.trim()).filter(Boolean)};try{const i=(await f("/notifications/resolve.php",{method:"POST",body:{entity_type:A.type,entity_id:A.id,channels:e,recipients:a,template_id:t.templateSelect&&t.templateSelect.value?Number(t.templateSelect.value):void 0}}))?.data||{};t.previewBox&&(t.previewBox.innerHTML=K(i)),c("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©")}catch(n){console.error(n),c("ÙØ´Ù„ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©")}}function St(){if(t.search.addEventListener("input",gt),t.entityType.addEventListener("change",()=>{t.resultsBody.innerHTML=`<tr><td colspan="5" class="text-center text-muted">${w("notifications.table.loading","Ø§ÙƒØªØ¨ Ù„Ù„Ø¨Ø­Ø«â€¦")}</td></tr>`,W()}),t.resultsBody.addEventListener("click",n=>{const i=n.target.closest("[data-select-id]");i&&ut(i.getAttribute("data-select-id"),i.getAttribute("data-select-type"))}),t.tReminder.addEventListener("click",()=>{const n=`ØªØ°ÙƒÙŠØ± Ø¨Ø§Ù„Ø­Ø¬Ø²/Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:
ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ø·Ù„Ø§Ø¹ ÙˆØ§ØªØ®Ø§Ø° Ø§Ù„Ù„Ø§Ø²Ù….`;t.body.value=n}),t.tNote.addEventListener("click",()=>{const n=`Ù…Ù„Ø§Ø­Ø¸Ø© Ø¥Ø¯Ø§Ø±ÙŠØ©:
ÙŠØ±Ø¬Ù‰ Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨.`;t.body.value=n}),t.sendBtn.addEventListener("click",vt),t.tgSearchBtn&&t.tgSearchBtn.addEventListener("click",E),t.tgRefreshBtn&&t.tgRefreshBtn.addEventListener("click",E),t.tgSearch&&t.tgSearch.addEventListener("keydown",n=>{n.key==="Enter"&&E()}),t.tgBody&&t.tgBody.addEventListener("click",async n=>{const i=n.target.closest("[data-gen-id]"),o=n.target.closest("[data-copy-link]"),r=n.target.closest("[data-unlink-id]");if(i){const l=i.getAttribute("data-gen-id");await Mt(l);return}if(o){const l=o.getAttribute("data-copy-link");if(l)try{await navigator.clipboard.writeText(l),c("âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·")}catch{c("âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ù†Ø³Ø®ØŒ Ø§Ù†Ø³Ø® ÙŠØ¯ÙˆÙŠØ§Ù‹")}return}if(r){const l=r.getAttribute("data-unlink-id");await Pt(l);return}}),t.tgAdminGenBtn&&t.tgAdminGenBtn.addEventListener("click",Ht),t.tgAdminCopyBtn&&t.tgAdminCopyBtn.addEventListener("click",async()=>{const n=t.tgAdminCopyBtn.getAttribute("data-link");if(n)try{await navigator.clipboard.writeText(n),c("âœ… ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø¯Ù…Ù†")}catch{c("âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ù†Ø³Ø®")}}),t.tgAdminBody&&t.tgAdminBody.addEventListener("click",async n=>{const i=n.target.closest("[data-admin-unlink]");if(!i)return;const o=i.getAttribute("data-admin-unlink");await jt(o)}),t.tgWebhookRefresh&&t.tgWebhookRefresh.addEventListener("click",D),t.tgWebhookSet&&t.tgWebhookSet.addEventListener("click",At),t.previewBtn&&t.previewBtn.addEventListener("click",U),t.templateSelect&&t.templateSelect.addEventListener("change",xt),t.retryLastBtn&&t.retryLastBtn.addEventListener("click",Lt),t.tgChatPick&&t.tgChatPick.addEventListener("click",z),t.tgChatRefresh&&t.tgChatRefresh.addEventListener("click",B),t.tgChatSend&&t.tgChatSend.addEventListener("click",$t),t.tgChatSendPhoto&&t.tgChatSendPhoto.addEventListener("click",Et),t.tgChatSendPhotos&&t.tgChatSendPhotos.addEventListener("click",Bt),t.tgChatSearch&&t.tgChatSearch.addEventListener("keydown",n=>{n.key==="Enter"&&z()}),t.tgChatListRefresh&&t.tgChatListRefresh.addEventListener("click",H),t.tgChatList&&t.tgChatList.addEventListener("click",n=>{const i=n.target.closest("li[data-tech-id]");if(!i)return;const o=Number(i.getAttribute("data-tech-id"))||0,r=i.getAttribute("data-tech-name")||"";o&&(p={id:o,name:r},t.tgChatSelected&&(t.tgChatSelected.textContent=`Ø§Ù„Ù…Ø­Ø¯Ø¯: ${r}`),B())}),t.tgChatInput){let n=null;t.tgChatInput.addEventListener("input",()=>{p&&(n||(n=setTimeout(()=>{n=null},4e3),f("/telegram/messages.php",{method:"POST",body:{action:"typing",technician_id:p.id}}).catch(()=>{})))})}t.tgChatLive&&t.tgChatLive.addEventListener("change",()=>{k=!!t.tgChatLive.checked,k?nt():at()});const e=()=>{R&&clearTimeout(R),R=setTimeout(()=>{A&&U().catch(()=>{})},250)};t.chEmail&&t.chEmail.addEventListener("change",e),t.chTelegram&&t.chTelegram.addEventListener("change",e),t.toTechs&&t.toTechs.addEventListener("change",e),t.toAdmins&&t.toAdmins.addEventListener("change",e),t.extraEmails&&t.extraEmails.addEventListener("input",e),t.extraChatIds&&t.extraChatIds.addEventListener("input",e);const a=()=>{$=1,_()};["change","input"].forEach(n=>{t.logEntity.addEventListener(n,a),t.logChannel.addEventListener(n,a),t.logStatus.addEventListener(n,a),t.logBatch.addEventListener(n,()=>{T&&clearTimeout(T),T=setTimeout(()=>{$=1,_()},350)}),t.logQ.addEventListener(n,()=>{T&&clearTimeout(T),T=setTimeout(()=>{$=1,_()},350)})}),t.logRefresh.addEventListener("click",_),t.tplRefresh&&t.tplRefresh.addEventListener("click",N),t.tplNew&&t.tplNew.addEventListener("click",()=>Q()),t.tplVars&&t.tplVars.addEventListener("click",()=>{t.tplVarsBox&&t.tplVarsBox.classList.toggle("hidden")}),t.tplSave&&t.tplSave.addEventListener("click",wt),t.tplCancel&&t.tplCancel.addEventListener("click",()=>tt()),t.diagRefresh&&t.diagRefresh.addEventListener("click",Z),t.tplBody&&t.tplBody.addEventListener("click",async n=>{const i=n.target.closest("[data-edit-id]"),o=n.target.closest("[data-delete-id]");try{if(i){const r=Number(i.getAttribute("data-edit-id"))||0;if(!r)return;const l=await f(`/notifications/templates.php?id=${encodeURIComponent(r)}`),d=l?.data||l||null;if(!d)return;Q(d);return}if(o){const r=Number(o.getAttribute("data-delete-id"))||0;if(!r||!window.confirm("ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù‚Ø§Ù„Ø¨ØŸ"))return;await f(`/notifications/templates.php?id=${encodeURIComponent(r)}`,{method:"DELETE"}),c("ØªÙ… Ø­Ø°Ù Ø§Ù„Ù‚Ø§Ù„Ø¨"),await N(),await O();return}}catch(r){console.error(r),c("ÙØ´Ù„ ØªÙ†ÙÙŠØ° Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø§Ù„Ø¨")}}),t.logClear&&t.logClear.addEventListener("click",async()=>{if(window.confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„ÙÙ„Ø§ØªØ±."))try{const i=Y();await f(`/notifications/logs.php?${i.toString()}`,{method:"DELETE"}),c("ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„"),$=1,_()}catch(i){console.error(i),c("ÙØ´Ù„ Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„")}}),t.logPagination&&t.logPagination.addEventListener("click",n=>{const i=n.target.closest("[data-page]");if(!i)return;const o=Number(i.getAttribute("data-page"))||1;o!==$&&($=o,_())})}let $=1;const X=20;function Y(){const e=new URLSearchParams;t.logEntity.value&&e.set("entity_type",t.logEntity.value),t.logChannel.value&&e.set("channel",t.logChannel.value),t.logStatus.value&&e.set("status",t.logStatus.value),(t.logQ.value||"").trim()&&e.set("q",t.logQ.value.trim());try{const n=new URLSearchParams((location.hash||"").replace(/^#/,"")).get("batch"),i=(t.logBatch?.value||"").trim();i?e.set("batch_id",i):n&&e.set("batch_id",n)}catch{}return e.set("limit",String(X)),e.set("page",String($)),e}function Ct(e){const a=Number(e?.total||0),n=Number(e?.pages||1),i=Number(e?.page||1);if(!t.logPagination)return;if(a<=X){t.logPagination.innerHTML="";return}const o=(m,g,u=!1,v=!1)=>{const L=["btn","btn-sm"];return v?L.push("btn-primary"):L.push("btn-outline"),u&&L.push("btn-disabled"),`<button type="button" class="${L.join(" ")}" data-page="${g}" ${u?"disabled":""}>${m}</button>`};let r="";r+=o(w("notifications.logs.prev","Ø§Ù„Ø³Ø§Ø¨Ù‚"),Math.max(1,i-1),i<=1);const l=7,d=(m,g)=>Array.from({length:g-m+1},(u,v)=>m+v);let h=[];if(n<=l)h=d(1,n);else{const m=Math.max(2,i-1),g=Math.min(n-1,i+1);h=[1,...d(m,g),n]}for(const m of h){if(m<1||m>n)continue;const g=m===i;r+=o(String(m),m,!1,g)}r+=o(w("notifications.logs.next","Ø§Ù„ØªØ§Ù„ÙŠ"),Math.min(n,i+1),i>=n),t.logPagination.innerHTML=r}function Tt(e){return{reservation_created:"Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø¬Ø²",reservation_reminder_24h:"ØªØ°ÙƒÙŠØ± 24 Ø³Ø§Ø¹Ø©",reservation_reminder_1h:"ØªØ°ÙƒÙŠØ± Ø³Ø§Ø¹Ø©",reservation_technician_assigned:"ØªØ¹ÙŠÙŠÙ† ÙÙ†ÙŠ (Ø­Ø¬Ø²)",reservation_status_changed:"ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø­Ø¬Ø²",project_created:"Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø´Ø±ÙˆØ¹",project_technician_assigned:"ØªØ¹ÙŠÙŠÙ† ÙÙ†ÙŠ (Ù…Ø´Ø±ÙˆØ¹)",manual_notification:"Ø¥Ø±Ø³Ø§Ù„ ÙŠØ¯ÙˆÙŠ"}[e]||e}function _t(e){if(!Array.isArray(e)||e.length===0){t.logBody.innerHTML=`<tr><td colspan="8" class="text-center text-muted">${w("notifications.logs.empty","Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.")}</td></tr>`;return}t.logBody.innerHTML=e.map(a=>{const n=a.created_at||"â€”",i=Tt(a.event_type||""),o=`${a.entity_type||""} #${a.entity_id||""}`,r=a.recipient_display||`${a.recipient_type||""}: ${a.recipient_identifier||""}`,l=a.recipient_name||"",d=a.channel||"",h=a.status||"",m=(a.error||"").toString().slice(0,140);return`
      <tr>
        <td>${n}</td>
        <td>${i}</td>
        <td>${o}</td>
        <td>${l||"â€”"}</td>
        <td>${r}</td>
        <td>${d}</td>
        <td>${h==="sent"?'<span class="badge bg-primary-subtle">Ù…Ø±Ø³Ù„Ø©</span>':'<span class="badge bg-danger-subtle">ÙØ§Ø´Ù„Ø©</span>'}</td>
        <td title="${m}">${m}</td>
      </tr>
    `}).join("")}async function _(){try{t.logBody.innerHTML=`<tr><td colspan="8" class="text-center text-muted">${w("notifications.logs.loading","â³ Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„â€¦")}</td></tr>`;const e=Y(),a=await f(`/notifications/logs.php?${e.toString()}`),n=Array.isArray(a?.data)?a.data:[];_t(n),kt(n),Ct(a?.meta||{})}catch(e){console.error(e),t.logBody.innerHTML='<tr><td colspan="8" class="text-center text-error">ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„</td></tr>'}}function kt(e){if(t.logFailedSummary)try{const a=(Array.isArray(e)?e:[]).filter(r=>(r?.status||"")==="failed");if(!a.length){t.logFailedSummary.classList.add("hidden"),t.logFailedSummary.textContent="";return}const n=a.map(r=>String(r.recipient_display||`${r.recipient_type||""}: ${r.recipient_identifier||""}`)).filter(Boolean),i=Array.from(new Set(n)),o=i.length<=10?i.join("ØŒ "):i.slice(0,10).join("ØŒ ")+`ØŒ Ùˆ+${i.length-10} Ø¢Ø®Ø±ÙŠÙ†`;t.logFailedSummary.textContent=`ÙØ§Ø´Ù„Ø©: ${a.length} â€” ${o}`,t.logFailedSummary.classList.remove("hidden")}catch{t.logFailedSummary.classList.add("hidden")}}async function O(){if(t.templateSelect)try{const e=await f("/notifications/templates.php?limit=100"),a=Array.isArray(e?.data)?e.data:Array.isArray(e)?e:[],n=['<option value="">â€” Ø¨Ø¯ÙˆÙ† Ù‚Ø§Ù„Ø¨ â€”</option>'].concat(a.map(i=>`<option value="${i.id}">${(i.name||"").toString()} (${i.channel})</option>`));t.templateSelect.innerHTML=n.join("")}catch(e){console.error(e)}}async function xt(){const e=t.templateSelect?.value||"";if(e)try{const a=await f(`/notifications/templates.php?id=${encodeURIComponent(e)}`),n=a?.data||a||null;if(!n)return;n.subject&&t.subject&&(t.subject.value=String(n.subject));const i=n.body_text||(n.body_html?String(n.body_html).replace(/<[^>]+>/g,""):"");i&&t.body&&(t.body.value=i),c("ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù‚Ø§Ù„Ø¨")}catch(a){console.error(a)}}async function D(){try{t.tgWebhookInfo&&(t.tgWebhookInfo.textContent="Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„â€¦");const e=await f("/telegram/webhook-manage.php"),a=e?.data||e||{},n=a.url||"â€”",i=a.has_custom_certificate?"yes":"no",o=a.pending_update_count!=null?String(a.pending_update_count):"â€”",r=a.last_error_message?`Ø®Ø·Ø£: ${a.last_error_message}`:"",l=a.last_error_date?new Date(a.last_error_date*1e3).toLocaleString():"",d=[`URL: ${n}`,`Pending: ${o}`,`Cert: ${i}`];r&&d.push(r),l&&d.push(`ÙˆÙ‚Øª Ø§Ù„Ø®Ø·Ø£: ${l}`),t.tgWebhookInfo&&(t.tgWebhookInfo.textContent=d.join(" | "))}catch(e){console.error(e),t.tgWebhookInfo&&(t.tgWebhookInfo.textContent="ÙØ´Ù„ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø­Ø§Ù„Ø©")}}async function At(){try{const e=await f("/telegram/webhook-manage.php",{method:"POST",body:{}});e?.ok===!0||e?.data?.ok===!0?c("ØªÙ… Ø¶Ø¨Ø· Webhook"):c("ØªØ¹Ø°Ø± Ø¶Ø¨Ø· Webhook")}catch(e){console.error(e),c("ÙØ´Ù„ Ø¶Ø¨Ø· Webhook")}finally{D()}}async function Z(){if(t.diagBody)try{t.diagBody.innerHTML='<tr><td colspan="3" class="text-center text-muted">Ø¬Ø§Ø±Ù Ø§Ù„ÙØ­Øµâ€¦</td></tr>';const e=await f("/notifications/diagnostics.php"),a=Array.isArray(e?.data)?e.data:Array.isArray(e)?e:[];if(!a.length){t.diagBody.innerHTML='<tr><td colspan="3" class="text-center text-muted">â€”</td></tr>';return}t.diagBody.innerHTML=a.map(n=>{const o=!!n.ok?'<span class="badge bg-primary-subtle">OK</span>':'<span class="badge bg-danger-subtle">Ù…ÙÙ‚ÙˆØ¯</span>',r=n.hint||"";return`<tr><td>${n.name}</td><td>${o}</td><td>${r}</td></tr>`}).join("")}catch(e){console.error(e),t.diagBody.innerHTML='<tr><td colspan="3" class="text-center text-error">ÙØ´Ù„ Ø§Ù„ÙØ­Øµ</td></tr>'}}(async function(){await lt();const a=await dt();if(!a||a.role!=="admin"){c("Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ† ÙÙ‚Ø·"),window.location.href="home.html";return}mt(),St(),W(),_(),E(),ot(),D(),Z(),O(),N(),H()})();async function N(){if(t.tplBody)try{t.tplBody.innerHTML='<tr><td colspan="4" class="text-center text-muted">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„â€¦</td></tr>';const e=await f("/notifications/templates.php?limit=100"),a=Array.isArray(e?.data)?e.data:Array.isArray(e)?e:[];if(!a.length){t.tplBody.innerHTML='<tr><td colspan="4" class="text-center text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚ÙˆØ§Ù„Ø¨</td></tr>';return}t.tplBody.innerHTML=a.map(n=>{const i=Number(n.id||0),o=(n.name||"").toString(),r=(n.channel||"").toString(),l=(n.updated_at||"").toString()||"â€”";return`<tr>
        <td>${o}</td>
        <td>${r}</td>
        <td>${l}</td>
        <td>
          <button type="button" class="btn btn-sm" data-edit-id="${i}">ØªØ¹Ø¯ÙŠÙ„</button>
          <button type="button" class="btn btn-sm btn-outline btn-error" data-delete-id="${i}">Ø­Ø°Ù</button>
        </td>
      </tr>`}).join("")}catch(e){console.error(e),t.tplBody.innerHTML='<tr><td colspan="4" class="text-center text-error">ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨</td></tr>'}}function Q(e=null){if(!t.tplForm)return;t.tplForm.hidden=!1;const a=(i,o)=>{i&&(i.value=o!=null?String(o):"")};a(t.tplId,e?.id||""),a(t.tplName,e?.name||""),t.tplChannel&&(t.tplChannel.value=e?.channel||"both"),a(t.tplAttachment,e?.attachment_url||"");const n=Array.isArray(e?.attachment_urls)?e.attachment_urls:[];a(t.tplAttachments,n.length?n.join(`
`):""),a(t.tplSubject,e?.subject||""),a(t.tplText,e?.body_text||""),a(t.tplHtml,e?.body_html||"");try{t.tplName?.focus()}catch{}}function tt(){t.tplForm&&(t.tplForm.hidden=!0,["tplId","tplName","tplAttachment","tplAttachments","tplSubject","tplText","tplHtml"].forEach(e=>{t[e]&&(t[e].value="")}),t.tplChannel&&(t.tplChannel.value="both"))}async function wt(){if(!t.tplName||!t.tplChannel)return;const e=Number(t.tplId?.value||"")||0,a=(t.tplName.value||"").trim(),n=t.tplChannel.value||"both",i=(t.tplSubject?.value||"").trim(),o=(t.tplText?.value||"").trim(),r=(t.tplHtml?.value||"").trim(),l=(t.tplAttachment?.value||"").trim()||null,d=(t.tplAttachments?.value||"").split(`
`).map(h=>h.trim()).filter(Boolean);if(!a){c("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù‚Ø§Ù„Ø¨");return}try{e>0?(await f(`/notifications/templates.php?id=${encodeURIComponent(e)}`,{method:"PUT",body:{name:a,channel:n,subject:i,body_text:o,body_html:r,attachment_url:l,attachment_urls:d}}),c("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ù„Ø¨")):(await f("/notifications/templates.php",{method:"POST",body:{name:a,channel:n,subject:i,body_text:o,body_html:r,attachment_url:l,attachment_urls:d}}),c("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‚Ø§Ù„Ø¨")),tt(),await N(),await O()}catch(h){console.error(h);const m=h&&(h.payload?.error||h.message)?String(h.payload?.error||h.message):"ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ù‚Ø§Ù„Ø¨";c(m)}}let p=null;async function z(){const e=(t.tgChatSearch?.value||"").trim();if(!e){c("Ø§ÙƒØªØ¨ Ø§Ø³Ù…/Ø¬ÙˆØ§Ù„ Ø§Ù„ÙÙ†ÙŠ Ù„Ù„Ø¨Ø­Ø«");return}try{const a=new URLSearchParams;a.set("search",e),a.set("limit","5");const n=await f(`/technicians/?${a.toString()}`),i=Array.isArray(n?.data)?n.data:[];if(!i.length){c("Ù„Ø§ Ù†ØªØ§Ø¦Ø¬");return}const o=i[0];p={id:o.id,name:o.full_name||o.name||String(o.id)},t.tgChatSelected&&(t.tgChatSelected.textContent=`Ø§Ù„Ù…Ø­Ø¯Ø¯: ${p.name}`),await B()}catch(a){console.error("[chatPickTechnician] primary lookup failed",a);try{const n=await f("/technicians/?limit=20"),i=Array.isArray(n?.data)?n.data:[],o=g=>String(g||"").toLowerCase(),r=g=>String(g||"").replace(/[^0-9]/g,""),l=o(e),d=r(e),h=i.find(g=>o(g.full_name||g.name).includes(l)||d&&r(g.phone||"").includes(d));if(h){p={id:h.id,name:h.full_name||h.name||String(h.id)},t.tgChatSelected&&(t.tgChatSelected.textContent=`Ø§Ù„Ù…Ø­Ø¯Ø¯: ${p.name}`),await B();return}const m=a&&(a.payload?.error||a.message)?String(a.payload?.error||a.message):"Ù„Ø§ Ù†ØªØ§Ø¦Ø¬";c(`ÙØ´Ù„ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙÙ†ÙŠ â€” ${m}`)}catch(n){console.error("[chatPickTechnician] fallback lookup failed",n);const i=n&&(n.payload?.error||n.message)?String(n.payload?.error||n.message):"ÙØ´Ù„ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙÙ†ÙŠ";c(i)}}}async function B(){if(!p){c("Ø§Ø®ØªØ± ÙÙ†ÙŠØ§Ù‹ Ø£ÙˆÙ„Ø§Ù‹");return}try{t.tgChatMessages&&(t.tgChatMessages.innerHTML='<div class="text-center text-muted">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„â€¦</div>');const e=new URLSearchParams;e.set("technician_id",String(p.id)),e.set("limit","100");const a=await f(`/telegram/messages.php?${e.toString()}`),n=Array.isArray(a?.data)?a.data:Array.isArray(a)?a:[];if(!n.length){t.tgChatMessages.innerHTML='<div class="text-center text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„</div>';return}const i=n.map(q).join("");t.tgChatMessages.innerHTML=i,t.tgChatMessages.scrollTop=t.tgChatMessages.scrollHeight,S=Number(n[n.length-1]?.id||0),k&&!x&&nt();try{await V(p.id,S),H()}catch{}try{et()}catch{}}catch(e){console.error(e),t.tgChatMessages.innerHTML='<div class="text-center text-error">ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</div>'}}function et(){try{const e=window.__CHAT_LIST_CACHE__||[];if(!p||!t.tgChatLastSeen)return;const a=e.find(n=>Number(n.technician_id||0)===Number(p.id));t.tgChatLastSeen.textContent=a&&a.last_seen_at?String(a.last_seen_at):"â€”"}catch{}}function q(e){const a=e.direction==="outbound",n=a?"Ø£Ù†Ø§":e.technician_name||"ÙÙ†ÙŠ",i=a?"justify-end":"justify-start",o=a?"bg-primary text-primary-content":"bg-base-200",r=e.created_at||"",l=(e.text||"").replace(/</g,"&lt;"),d=[];try{const m=e.media_json||null;(Array.isArray(m?.photos)?m.photos:[]).forEach(u=>{const v=/^https?:\/\//i.test(String(u))?String(u):`/backend/api/telegram/file.php?file_id=${encodeURIComponent(String(u))}`;d.push(`<img src="${v}" class="rounded mt-2 max-w-[240px] max-h-[240px]" loading="lazy">`)})}catch{}const h=d.length?d.join(""):"";return`<div class="flex ${i}"><div class="rounded-xl px-3 py-2 m-1 max-w-[80%] ${o}"><div class="text-xs opacity-70">${n} â€¢ ${r}</div><div>${l}</div>${h}</div></div>`}function nt(){if(at(),!!p){if(k=!0,t.tgChatLive&&(t.tgChatLive.checked=!0),typeof EventSource<"u"&&!F)try{t.tgLiveStatus&&(t.tgLiveStatus.textContent="Connectingâ€¦"),it();return}catch{}x=setInterval(()=>M().catch(()=>{}),3e3),t.tgLiveStatus&&(t.tgLiveStatus.textContent="Polling")}}function at(){if(k=!1,t.tgChatLive&&(t.tgChatLive.checked=!1),x&&(clearInterval(x),x=null),j=!1,y){try{y.close()}catch{}y=null}t.tgLiveStatus&&(t.tgLiveStatus.textContent="Ù…ØªÙˆÙ‚Ù")}async function M(){if(p&&!j){j=!0;try{const e=new URLSearchParams;e.set("technician_id",String(p.id)),S>0&&e.set("since_id",String(S)),e.set("limit","100");const a=await f(`/telegram/messages.php?${e.toString()}`),n=Array.isArray(a?.data)?a.data:Array.isArray(a)?a:[];if(n.length){const i=document.createDocumentFragment();n.forEach(o=>{S=Math.max(S,Number(o.id||0));const r=document.createElement("div");r.innerHTML=q(o),i.appendChild(r.firstChild)}),t.tgChatMessages.appendChild(i),t.tgChatMessages.scrollTop=t.tgChatMessages.scrollHeight}try{await V(p.id,S),H()}catch{}}catch{}finally{j=!1}}}function it(){if(!p)return;const e=String(p.id),a=S>0?`&since_id=${encodeURIComponent(String(S))}`:"",n=`/backend/api/telegram/stream.php?technician_id=${encodeURIComponent(e)}${a}&timeout=25`;try{y&&(y.close(),y=null)}catch{}y=new EventSource(n,{withCredentials:!0}),y.onopen=()=>{t.tgLiveStatus&&(t.tgLiveStatus.textContent="SSE")},y.addEventListener("message",async i=>{try{const o=i.data?JSON.parse(i.data):[];if(Array.isArray(o)&&o.length){const r=document.createDocumentFragment();o.forEach(l=>{S=Math.max(S,Number(l.id||0));const d=document.createElement("div");d.innerHTML=q(l),r.appendChild(d.firstChild)}),t.tgChatMessages&&(t.tgChatMessages.appendChild(r),t.tgChatMessages.scrollTop=t.tgChatMessages.scrollHeight);try{await V(p.id,S),H()}catch{}}}catch{}}),y.addEventListener("done",()=>{try{y.close()}catch{}y=null,k&&setTimeout(()=>{if(k&&!F)try{it();return}catch{}k&&!x&&(x=setInterval(()=>M().catch(()=>{}),3e3))},200)}),y.onerror=()=>{try{y.close()}catch{}y=null,F=!0,k&&!x&&(x=setInterval(()=>M().catch(()=>{}),3e3)),t.tgLiveStatus&&(t.tgLiveStatus.textContent="Polling")}}async function H(){if(t.tgChatList)try{t.tgChatList.innerHTML='<li class="px-3 py-1 text-center text-muted">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„â€¦</li>';const e=await f("/telegram/messages.php?list=recent"),a=Array.isArray(e?.data)?e.data:Array.isArray(e)?e:[];if(!a.length){t.tgChatList.innerHTML='<li class="px-3 py-1 text-center text-muted">Ù„Ø§ Ù…Ø­Ø§Ø¯Ø«Ø§Øª</li>';return}window.__CHAT_LIST_CACHE__=a,t.tgChatList.innerHTML=a.map(n=>{const i=n.technician_name||n.chat_id||"Ø¯Ø±Ø¯Ø´Ø©",o=Number(n.unread||0),r=o?`<span class="badge badge-primary badge-sm ms-2">${o}</span>`:"";return`<li class="px-3 py-2 cursor-pointer hover:bg-base-300" data-tech-id="${n.technician_id||""}" data-tech-name="${i}">${i}${r}<div class="text-xs opacity-70 truncate">${(n.last_text||"").toString()}</div></li>`}).join(""),et()}catch(e){console.error(e),t.tgChatList.innerHTML='<li class="px-3 py-1 text-center text-error">ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</li>'}}async function V(e,a){try{await f("/telegram/messages.php",{method:"POST",body:{action:"mark_read",technician_id:Number(e),last_seen_id:Number(a)}})}catch{}}async function $t(){if(!p){c("Ø§Ø®ØªØ± ÙÙ†ÙŠØ§Ù‹ Ø£ÙˆÙ„Ø§Ù‹");return}const e=(t.tgChatInput?.value||"").trim();if(!e){c("Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©");return}try{await f("/telegram/messages.php",{method:"POST",body:{technician_id:p.id,text:e}}),t.tgChatInput&&(t.tgChatInput.value=""),await B()}catch(a){console.error(a);const n=a&&(a.payload?.error||a.message)?String(a.payload?.error||a.message):"ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„";c(n)}}async function Et(){if(!p){c("Ø§Ø®ØªØ± ÙÙ†ÙŠØ§Ù‹ Ø£ÙˆÙ„Ø§Ù‹");return}const e=window.prompt("Ø¶Ø¹ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© (https://...)");if(!e)return;const a=(t.tgChatInput?.value||"").trim();try{await f("/telegram/messages.php",{method:"POST",body:{technician_id:p.id,photo_url:e,text:a||void 0}}),t.tgChatInput&&(t.tgChatInput.value=""),await M()}catch(n){console.error(n),c("ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø©")}}async function Bt(){if(!p){c("Ø§Ø®ØªØ± ÙÙ†ÙŠØ§Ù‹ Ø£ÙˆÙ„Ø§Ù‹");return}const e=window.prompt("Ø¶Ø¹ Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØµÙˆØ± ÙƒÙ„ Ø±Ø§Ø¨Ø· Ø¨Ø³Ø·Ø± (Ø£Ùˆ Ù…ÙØµÙˆÙ„Ø© Ø¨ÙÙˆØ§ØµÙ„)");if(!e)return;const a=e.split(/\n|,/).map(n=>n.trim()).filter(Boolean);if(a.length)try{await f("/telegram/messages.php",{method:"POST",body:{technician_id:p.id,photo_urls:a}}),await M()}catch(n){console.error(n),c("ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±")}}async function E(){if(t.tgBody)try{t.tgBody.innerHTML='<tr><td colspan="4" class="text-center text-muted">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„â€¦</td></tr>';const e=(t.tgSearch?.value||"").trim(),a=new URLSearchParams;e&&a.set("search",e),a.set("limit","20");const n=await f(`/technicians/?${a.toString()}`),i=Array.isArray(n?.data)?n.data:Array.isArray(n)?n:[];if(!i.length){t.tgBody.innerHTML='<tr><td colspan="4" class="text-center text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</td></tr>';return}t.tgBody.innerHTML=i.map(o=>{const r=o.full_name||o.name||"",l=o.phone||"",d=!!(o.telegram_chat_id||o.telegramChatId||o.has_tg_link),h=d?'<span class="badge bg-primary-subtle">Ù…Ø±ØªØ¨Ø·</span>':'<span class="badge bg-warning-subtle">ØºÙŠØ± Ù…Ø±ØªØ¨Ø·</span>',m=d?`<button type="button" class="btn btn-sm btn-outline btn-error" data-unlink-id="${o.id}">âŒ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø±Ø¨Ø·</button>`:`<button type="button" class="btn btn-sm" data-gen-id="${o.id}">ğŸ”— ØªÙˆÙ„ÙŠØ¯ Ø±Ø§Ø¨Ø·</button>`;return`<tr>
        <td>${r}</td>
        <td>${l}</td>
        <td>${h}</td>
        <td>${m}</td>
      </tr>`}).join("")}catch(e){console.error(e),t.tgBody.innerHTML='<tr><td colspan="4" class="text-center text-error">ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„</td></tr>'}}async function Mt(e){try{const a=await f(`/telegram/generate-link.php?technician_id=${encodeURIComponent(e)}`),n=a?.data?.link||a?.link||null;if(!n){c("âš ï¸ ØªØ¹Ø°Ø± ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø±Ø§Ø¨Ø·");return}const i=t.tgBody?.querySelector(`button[data-gen-id="${e}"]`)?.closest("tr");if(i){const o=i.querySelector("td:last-child");o&&(o.innerHTML=`<button type="button" class="btn btn-sm" data-copy-link="${n}">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·</button>`)}c("âœ… ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø±Ø§Ø¨Ø·")}catch(a){console.error(a),c("ÙØ´Ù„ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø±Ø§Ø¨Ø·")}}async function ot(){if(t.tgAdminBody)try{t.tgAdminBody.innerHTML='<tr><td colspan="3" class="text-center text-muted">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„â€¦</td></tr>';const e=await f("/telegram/admins.php"),a=Array.isArray(e?.data)?e.data:Array.isArray(e)?e:[];if(!a.length){t.tgAdminBody.innerHTML='<tr><td colspan="3" class="text-center text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±ÙˆØ§Ø¨Ø· Ø¥Ø¯Ù…Ù† Ù…Ø±ØªØ¨Ø·Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</td></tr>';return}t.tgAdminBody.innerHTML=a.map(n=>{const i=String(n.chat_id||""),o=n.last_used_at||"â€”";return`<tr>
        <td>${i}</td>
        <td>${o}</td>
        <td><button type="button" class="btn btn-sm btn-outline btn-error" data-admin-unlink="${i}">âŒ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø±Ø¨Ø·</button></td>
      </tr>`}).join("")}catch(e){console.error(e),t.tgAdminBody.innerHTML='<tr><td colspan="3" class="text-center text-error">ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø¥Ø¯Ù…Ù†</td></tr>'}}async function Ht(){try{const e=await f("/telegram/generate-link.php?context=admin"),a=e?.data?.link||e?.link||null;if(!a){c("âš ï¸ ØªØ¹Ø°Ø± ØªÙˆÙ„ÙŠØ¯ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø¯Ù…Ù†");return}t.tgAdminCopyBtn&&(t.tgAdminCopyBtn.removeAttribute("disabled"),t.tgAdminCopyBtn.setAttribute("data-link",a)),t.tgAdminLinkBox&&(t.tgAdminLinkBox.classList.remove("hidden"),t.tgAdminLinkBox.textContent=a),c("âœ… ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø¯Ù…Ù†")}catch(e){console.error(e),c("ÙØ´Ù„ ØªÙˆÙ„ÙŠØ¯ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø¯Ù…Ù†")}}async function Pt(e){if(!(!e||!window.confirm("ØªØ£ÙƒÙŠØ¯ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø±Ø¨Ø· Ù„Ù‡Ø°Ø§ Ø§Ù„ÙÙ†ÙŠØŸ")))try{await f("/telegram/unlink.php",{method:"POST",body:{target:"technician",technician_id:Number(e)}}),c("ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø±Ø¨Ø· Ù„Ù„ÙÙ†ÙŠ"),E()}catch(n){console.error(n);const i=n&&(n.payload?.error||n.message)?String(n.payload?.error||n.message):"ÙØ´Ù„ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø±Ø¨Ø·";c(i)}}async function jt(e){if(!(!e||!window.confirm(`ØªØ£ÙƒÙŠØ¯ Ø¥Ù„ØºØ§Ø¡ Ø±Ø¨Ø· Ø§Ù„Ø¥Ø¯Ù…Ù† (${e})ØŸ`)))try{await f("/telegram/unlink.php",{method:"POST",body:{target:"admin",chat_id:String(e)}}),c("ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø±Ø¨Ø· Ø§Ù„Ø¥Ø¯Ù…Ù†"),ot()}catch(n){console.error(n);const i=n&&(n.payload?.error||n.message)?String(n.payload?.error||n.message):"ÙØ´Ù„ Ø¥Ù„ØºØ§Ø¡ Ø±Ø¨Ø· Ø§Ù„Ø¥Ø¯Ù…Ù†";c(i)}}
