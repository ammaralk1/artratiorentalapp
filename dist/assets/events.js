import{e as f,k as m,d as a,o as p,p as v,q as h,t as b,l as y,v as I,w,x as s,y as E,z as R,A as g}from"./controller.js";import{q as F,v as T}from"./reservationsService.js";import{d as k}from"./auth.js";let o=!1;function C(){document.querySelectorAll('input[type="time"]').forEach(t=>{t.setAttribute("step","300")})}function S(){return typeof window<"u"&&typeof window.flatpickr=="function"?window.flatpickr.bind(window):typeof globalThis<"u"&&typeof globalThis.flatpickr=="function"?globalThis.flatpickr.bind(globalThis):(console.warn("⚠️ Flatpickr غير متاح - سيتم تخطي تهيئة عناصر التاريخ"),null)}function L(){const e=S(),t={dateFormat:"Y-m-d",altInput:!0,altFormat:"Y-m-d",allowInput:!0,disableMobile:!0,altInputClass:"flatpickr-alt-input form-control"},c=[["#res-start",{}],["#res-end",{}],["#filter-start-date",{}],["#filter-end-date",{}],["#edit-res-start",{}],["#edit-res-end",{}]],d={enableTime:!0,noCalendar:!0,dateFormat:"H:i",altInput:!0,altFormat:"h:i K",time_24hr:!1,defaultHour:9,defaultMinute:0,disableMobile:!0,minuteIncrement:5,altInputClass:"flatpickr-alt-input form-control"},l=["#res-start-time","#res-end-time","#edit-res-start-time","#edit-res-end-time"];e&&(c.forEach(([n,u])=>{document.querySelector(n)&&e(n,{...t,...u})}),l.forEach(n=>{document.querySelector(n)&&e(n,{...d})}));const i=document.querySelector("#res-start-time");i&&i.dispatchEvent(new Event("change",{bubbles:!0}))}function q(){C(),h(()=>a()),b(E()),F({onDraftChange:R,onEditChange:s}),y(),I(),o=!0}function z(){const e=document.body;e&&e.dataset.reservationsTechListener!=="true"&&(document.addEventListener("technicians:updated",()=>{const{technicians:t=[]}=k();T(t),w(),s()}),e.dataset.reservationsTechListener="true")}async function r(){await f();try{await m({force:!0})}catch(e){console.warn("⚠️ [reservations/events] Failed to pre-load projects for reservation form",e)}a(),p(),v({onAfterSubmit:g}),o||q(),L(),z()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{r().catch(e=>{console.error("❌ [reservations/events] Failed to initialize reservations UI",e)})},{once:!0}):r().catch(e=>{console.error("❌ [reservations/events] Failed to initialize reservations UI",e)});export{q as s};
