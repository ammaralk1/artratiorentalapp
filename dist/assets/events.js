import{r as a,c as f,i as m,d as p,e as v,l as h,f as b,g as y,u as s,h as I,j as w,k as E}from"./controller.js";import{e as R,w as g,x as F,y as T}from"./projectsService.js";import{e as k}from"./auth.js";let o=!1;function C(){document.querySelectorAll('input[type="time"]').forEach(t=>{t.setAttribute("step","300")})}function S(){return typeof window<"u"&&typeof window.flatpickr=="function"?window.flatpickr.bind(window):typeof globalThis<"u"&&typeof globalThis.flatpickr=="function"?globalThis.flatpickr.bind(globalThis):(console.warn("⚠️ Flatpickr غير متاح - سيتم تخطي تهيئة عناصر التاريخ"),null)}function L(){const e=S(),t={dateFormat:"Y-m-d",altInput:!0,altFormat:"Y-m-d",allowInput:!0,disableMobile:!0,altInputClass:"flatpickr-alt-input form-control"},c=[["#res-start",{}],["#res-end",{}],["#filter-start-date",{}],["#filter-end-date",{}],["#edit-res-start",{}],["#edit-res-end",{}]],d={enableTime:!0,noCalendar:!0,dateFormat:"H:i",altInput:!0,altFormat:"h:i K",time_24hr:!1,defaultHour:9,defaultMinute:0,disableMobile:!0,minuteIncrement:5,altInputClass:"flatpickr-alt-input form-control"},l=["#res-start-time","#res-end-time","#edit-res-start-time","#edit-res-end-time"];e&&(c.forEach(([n,u])=>{document.querySelector(n)&&e(n,{...t,...u})}),l.forEach(n=>{document.querySelector(n)&&e(n,{...d})}));const i=document.querySelector("#res-start-time");i&&i.dispatchEvent(new Event("change",{bubbles:!0}))}function D(){C(),p(()=>a()),v(I()),F({onDraftChange:w,onEditChange:s}),h(),b(),o=!0}function M(){const e=document.body;e&&e.dataset.reservationsTechListener!=="true"&&(document.addEventListener("technicians:updated",()=>{const{technicians:t=[]}=k();T(t),y(),s()}),e.dataset.reservationsTechListener="true")}async function r(){await R();try{await g({force:!0})}catch(e){console.warn("⚠️ [reservations/events] Failed to pre-load projects for reservation form",e)}a(),f(),m({onAfterSubmit:E}),o||D(),L(),M()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{r().catch(e=>{console.error("❌ [reservations/events] Failed to initialize reservations UI",e)})},{once:!0}):r().catch(e=>{console.error("❌ [reservations/events] Failed to initialize reservations UI",e)});export{D as s};
