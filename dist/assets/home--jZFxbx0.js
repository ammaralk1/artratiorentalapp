import{a as T,m as j,c as S,t as s,i as L,l as E,g as x,b as $,A as q,n as A,u as p}from"./auth-F79eM6s1.js";import"./common-cX5geGZ9.js";T();j();S();let d="",h="",u=null,c=!1,l="";function o(){const e=document.querySelector("[data-home-greeting]");if(e){if(d){const a=s("home.hero.greetingUser","مرحباً {name}");e.textContent=a.replace("{name}",d);return}e.textContent=s("home.hero.title","مرحباً بك")}}function b(){const e=h==="admin";document.querySelectorAll("[data-admin-card]").forEach(a=>{e?a.classList.remove("d-none"):a.classList.add("d-none")})}function k(e){if(!e||typeof e!="object")return null;const a=t=>{const n=Number.parseInt(String(t??"0"),10);return Number.isFinite(n)?n:0};return{customers:{total:a(e?.customers?.total)},reservations:{total:a(e?.reservations?.total),today:a(e?.reservations?.today),upcoming:a(e?.reservations?.upcoming)},equipment:{total:a(e?.equipment?.total),maintenance:a(e?.equipment?.maintenance)},technicians:{total:a(e?.technicians?.total),busy:a(e?.technicians?.busy)},projects:{total:a(e?.projects?.total),active:a(e?.projects?.active)},maintenance:{open:a(e?.maintenance?.open),highPriority:a(e?.maintenance?.highPriority)}}}function M(e){return[{key:"customers.total",label:s("home.summary.customers","إجمالي العملاء"),value:e.customers.total,icon:"👥",accent:"bg-primary-subtle",href:"dashboard.html#customers-tab",dashboardTab:"customers-tab"},{key:"reservations.today",label:s("home.summary.reservationsToday","حجوزات اليوم"),value:e.reservations.today,icon:"🛎️",accent:"bg-success-subtle",href:"dashboard.html#reservations-tab",dashboardTab:"reservations-tab",dashboardSubTab:"my-reservations-tab"},{key:"reservations.upcoming",label:s("home.summary.reservationsUpcoming","حجوزات قادمة"),value:e.reservations.upcoming,icon:"🔔",accent:"bg-info-subtle",href:"dashboard.html#reservations-tab",dashboardTab:"reservations-tab",dashboardSubTab:"calendar-tab"},{key:"projects.active",label:s("home.summary.projectsActive","مشاريع نشطة"),value:e.projects.active,icon:"🏗️",accent:"bg-warning-subtle",href:"projects.html#projects-section",projectsTab:"projects-section",projectsSubTab:"projects-list-tab"},{key:"equipment.maintenance",label:s("home.summary.equipmentMaintenance","معدات قيد الصيانة"),value:e.equipment.maintenance,icon:"🛠️",accent:"bg-danger-subtle",href:"dashboard.html#maintenance-tab",dashboardTab:"maintenance-tab"},{key:"maintenance.highPriority",label:s("home.summary.maintenanceHigh","بلاغات صيانة عاجلة"),value:e.maintenance.highPriority,icon:"⚡",accent:"bg-danger-subtle",href:"dashboard.html#maintenance-tab",dashboardTab:"maintenance-tab"},{key:"technicians.busy",label:s("home.summary.techniciansBusy","أعضاء طاقم مشغولون"),value:e.technicians.busy,icon:"👷",accent:"bg-secondary-subtle",href:"dashboard.html#technicians-tab",dashboardTab:"technicians-tab"}]}function C(e){if(typeof p!="function")return;const a=["dashboardTab","dashboardSubTab","projectsTab","projectsSubTab"],t={};if(a.forEach(n=>{Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]??null)}),Object.keys(t).length!==0)try{const n=p(t);n&&typeof n.catch=="function"&&n.catch(m=>{console.warn("⚠️ [home] Failed to persist navigation preference",m)})}catch(n){console.warn("⚠️ [home] Failed to persist navigation preference",n)}}function H(e){e.querySelectorAll("[data-summary-card]").forEach(a=>{a.dataset.listenerAttached||(a.addEventListener("click",()=>{const t={};a.dataset.dashboardTab!==void 0&&(t.dashboardTab=a.dataset.dashboardTab||null),a.dataset.dashboardSubtab!==void 0&&(t.dashboardSubTab=a.dataset.dashboardSubtab||null),a.dataset.projectsTab!==void 0&&(t.projectsTab=a.dataset.projectsTab||null),a.dataset.projectsSubtab!==void 0&&(t.projectsSubTab=a.dataset.projectsSubtab||null),Object.keys(t).length>0&&C(t)}),a.dataset.listenerAttached="true")})}function P(e){const a=["card","home-summary-card","shadow-sm","h-100","text-reset","text-decoration-none"],t=["data-summary-card"],n=g=>String(g??"").replace(/"/g,"&quot;");e.href&&t.push(`href="${n(e.href)}"`),e.dashboardTab!==void 0&&t.push(`data-dashboard-tab="${n(e.dashboardTab??"")}"`),e.dashboardSubTab!==void 0&&t.push(`data-dashboard-subtab="${n(e.dashboardSubTab??"")}"`),e.projectsTab!==void 0&&t.push(`data-projects-tab="${n(e.projectsTab??"")}"`),e.projectsSubTab!==void 0&&t.push(`data-projects-subtab="${n(e.projectsSubTab??"")}"`);const m=A(String(e.value??0)),v=n(e.label);return`
    <div class="col-6 col-md-4 col-xl-3 col-xxl-2">
      <a ${t.join(" ")} class="${a.join(" ")}" aria-label="${v}">
        <div class="card-body d-flex flex-column align-items-center text-center gap-1 gap-md-2">
          <div class="home-summary-icon ${e.accent??""}">${e.icon}</div>
          <span class="home-summary-label text-muted small mb-0">${e.label}</span>
          <span class="home-summary-value fw-semibold">${m}</span>
        </div>
      </a>
    </div>
  `}function i(){const e=document.querySelector("[data-home-summary]");if(!e)return;if(c){e.innerHTML=`
      <div class="col-12 text-center text-muted" data-i18n data-i18n-key="home.summary.loading">
        ${s("home.summary.loading","⏳ جارٍ جلب بيانات النظام...")}
      </div>
    `;return}if(l){e.innerHTML=`
      <div class="col-12">
        <div class="alert alert-warning mb-0" role="alert">
          ${l}
        </div>
      </div>
    `;return}if(!u){e.innerHTML=`
      <div class="col-12 text-center text-muted">
        ${s("home.summary.empty","لا تتوفر بيانات بعد. ابدأ بإضافة سجلات.")} 
      </div>
    `;return}const a=M(u);e.innerHTML=a.map(P).join(""),H(e)}async function y({silent:e=!1}={}){if(!c){c=!0,e||i();try{const a=await $("/summary/");u=k(a?.data??null),l=""}catch(a){console.error("❌ [home] Failed to load summary data",a),u=null,l=a instanceof q?a.message:s("home.summary.error","تعذر تحميل بيانات النظام، حاول لاحقاً")}finally{c=!1,i()}}}function r(){y({silent:!0}).catch(e=>{console.error("❌ [home] Summary refresh failed",e)})}document.addEventListener("language:translationsReady",()=>{o(),i()});document.addEventListener("language:changed",()=>{o(),i()});function f(){L();const e=document.getElementById("logout-btn");e&&!e.dataset.listenerAttached&&(e.addEventListener("click",()=>E()),e.dataset.listenerAttached="true"),x({refresh:!0}).then(a=>{d=a?.username||"",h=(a?.role||"").toLowerCase(),o(),b()}).catch(()=>{d="",h="",o(),b()}),o(),b(),i(),y(),document.addEventListener("customers:changed",r,{passive:!0}),document.addEventListener("reservations:changed",r,{passive:!0}),document.addEventListener("equipment:changed",r,{passive:!0}),document.addEventListener("maintenance:updated",r,{passive:!0}),document.addEventListener("technicians:updated",r,{passive:!0}),document.addEventListener("projects:changed",r,{passive:!0})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{f()},{once:!0}):f();
