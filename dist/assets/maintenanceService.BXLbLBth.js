import{d as _,h as y,b as c,A,n as h}from"./auth.CdkYe04c.js";const g=_()||{};let o=(g.maintenance||[]).map(p);function I(){return o}function u(e){return o=Array.isArray(e)?e.map(p):[],y({maintenance:o}),R(),o}async function z(e={}){const t=new URLSearchParams;Object.entries(e).forEach(([f,a])=>{a!=null&&a!==""&&t.set(f,String(a))});const s=t.toString(),i=await c(`/maintenance/${s?`?${s}`:""}`),n=i?.data??i;let r=[];Array.isArray(n)?r=n:n&&typeof n=="object"&&(Array.isArray(n.items)?r=n.items:Array.isArray(n.results)?r=n.results:Array.isArray(n.data)?r=n.data:Array.isArray(n.records)&&(r=n.records));const d=r.map(l);return u(d)}async function L(e){const t=await c("/maintenance/",{method:"POST",body:e}),s=l(t?.data??{});return u([s,...o.filter(i=>i.id!==s.id)]),s}async function v(e,t){const s=await c(`/maintenance/?id=${encodeURIComponent(e)}`,{method:"PATCH",body:t}),i=l(s?.data??{});return u(o.map(n=>String(n.id)===String(e)?i:n)),i}async function P(e){await c(`/maintenance/?id=${encodeURIComponent(e)}`,{method:"DELETE"}),u(o.filter(t=>String(t.id)!==String(e)))}function T({equipmentId:e,technicianId:t,issue:s,priority:i,status:n,scheduledAt:r,resolutionReport:d}){return{equipment_id:e,technician_id:t||null,maintenance_type:null,priority:i??"medium",reported_at:null,scheduled_at:r||null,status:n??"open",notes:s??"",resolution_report:d??null,repair_cost:null}}function l(e={}){return m({id:e.id,equipment_id:e.equipment_id,equipmentBarcode:e.equipmentBarcode??e.equipment_barcode,equipmentDesc:e.equipmentDesc??e.equipment_desc??e.equipment_description,issue:e.issue??e.notes,priority:e.priority,status:e.status,status_raw:e.status_raw,createdAt:e.createdAt??e.reportedAt??e.reported_at,reportedAt:e.reportedAt??e.reported_at,scheduledAt:e.scheduledAt??e.scheduled_at,resolvedAt:e.resolvedAt??e.resolved_at,resolutionReport:e.resolutionReport??e.resolution_report,technicianId:e.technicianId??e.technician_id,repairCost:e.repairCost??e.repair_cost})}function p(e={}){return m(e)}function m(e={}){const t=e.id??e.ticketId??Date.now(),s=e.equipmentDesc??e.equipment_desc??e.equipmentDescription??e.equipment_name??"",i=S(e.status_raw??e.status??"open"),n=b(i),r=M(e,i);return{id:Number(t),equipmentId:e.equipment_id??e.equipmentId??null,equipmentBarcode:e.equipmentBarcode??e.equipment_barcode??"",equipmentDesc:s,issue:e.issue??e.notes??"",priority:C(e.priority??"medium"),status:n,statusRaw:i,statusLabel:r,createdAt:e.createdAt??e.reportedAt??e.reported_at??null,reportedAt:e.reportedAt??e.reported_at??null,scheduledAt:e.scheduledAt??e.scheduled_at??null,resolvedAt:e.resolvedAt??e.resolved_at??null,resolutionReport:e.resolutionReport??e.resolution_report??"",technicianId:e.technicianId??e.technician_id??null,repairCost:q(e.repairCost??e.repair_cost??e.repair_cost_value??null)}}function q(e){if(e==null||e==="")return null;const t=Number.parseFloat(h(String(e)));return!Number.isFinite(t)||t<0?null:Math.round(t*100)/100}function S(e){const t=String(e??"").trim();return t&&t.toLowerCase().replace(/\s+/g,"_").replace(/[^a-z0-9_\-]/g,"")||"open"}function b(e){const t=E(e);return["completed","cancelled"].includes(t)?"closed":"open"}function C(e){const t=String(e??"medium").trim().toLowerCase();return["low","medium","high"].includes(t)?t:"medium"}function M(e={},t="open"){const s=e.status_label??e.statusLabel??e.status_display??e.status_text??e.status??e.status_raw??t,i=String(s??"").trim();return i||t.replace(/[_-]+/g," ").replace(/\b\w/g,n=>n.toUpperCase())}function E(e){const t=String(e??"").toLowerCase();switch(t){case"open":case"قيد الصيانة":case"قيد الانتظار":return"open";case"in_progress":case"in-progress":case"جاري العمل":return"in_progress";case"completed":case"مكتمل":case"تم الإصلاح":case"closed":case"مغلق":return"completed";case"cancelled":case"ملغي":return"cancelled";default:return t.includes("progress")||t.includes("تنفيذ")?"in_progress":t.includes("complete")||t.includes("close")||t.includes("منجز")||t.includes("مغلق")?"completed":t.includes("cancel")||t.includes("ملغي")?"cancelled":t||"open"}}function R(){typeof window<"u"&&typeof window.dispatchEvent=="function"?window.dispatchEvent(new CustomEvent("maintenance:updated")):typeof dispatchEvent=="function"&&dispatchEvent(new CustomEvent("maintenance:updated"))}function B(e){return e instanceof A}export{T as buildMaintenancePayload,E as categorizeMaintenanceStatus,L as createMaintenanceRequest,P as deleteMaintenanceRequest,I as getMaintenanceState,B as isApiError,p as mapLegacyMaintenanceTicket,l as mapMaintenanceFromApi,z as refreshMaintenanceFromApi,u as setMaintenanceState,v as updateMaintenanceRequest};
