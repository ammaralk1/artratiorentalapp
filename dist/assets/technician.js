import{x as me,t as l,n as _,e as K,j as E,a as fe,c as pe,i as he,l as ge}from"./auth.js";/* empty css     */import{a as ee,b as ce,s as ye}from"./controller.js";import"./projects2.js";import{e as be,r as te,g as ve,o as De,p as we,s as Ie,t as ne,v as ke}from"./projectsService.js";import"./events.js";import{g as O,b as Se,e as je,a as Te,c as Ae,d as ae,P as Ee,s as xe,f as Pe}from"./projectFocusTemplates.js";import{c as Le}from"./projectsCommon.js";me({ar:{"technicianDetails.pageTitle":"Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…","technicianDetails.title":"ğŸ˜ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…","technicianDetails.actions.back":"â¬…ï¸ Ø§Ù„Ø¹ÙˆØ¯Ø©","technicianDetails.actions.edit":"âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…","technicianDetails.filters.search":"ğŸ” Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ø­Ø¬Ø²...","technicianDetails.fields.role":"ğŸ‘” Ø§Ù„ÙˆØ¸ÙŠÙØ©:","technicianDetails.fields.department":"ğŸ§© Ø§Ù„Ù‚Ø³Ù…:","technicianDetails.fields.phone":"ğŸ“ Ø§Ù„Ø¬ÙˆØ§Ù„:","technicianDetails.fields.wage":"ğŸ’° Ø§Ù„Ø£Ø¬Ø± Ø§Ù„ÙŠÙˆÙ…ÙŠ:","technicianDetails.fields.baseStatus":"âš™ï¸ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©:","technicianDetails.fields.notes":"ğŸ“ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:","technicianDetails.fallback.name":"â€”","technicianDetails.fallback.role":"ØºÙŠØ± Ù…Ø­Ø¯Ø¯","technicianDetails.fallback.department":"â€”","technicianDetails.fallback.notes":"â€”","technicianDetails.errors.missingId":"âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø¹Ø±Ù Ø¹Ø¶Ùˆ Ø·Ø§Ù‚Ù… ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø·.","technicianDetails.errors.notFound":"âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø¶Ùˆ.","technicianDetails.errors.loadFailed":"âŒ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ø§Ø­Ù‚Ù‹Ø§.","technicianDetails.errors.reservationsLoadFailed":"âŒ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø­Ø¬ÙˆØ²Ø§Øª Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø¶Ùˆ Ø­Ø§Ù„ÙŠØ§Ù‹.","technicianDetails.status.loading":"â³ Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…...","technicianDetails.edit.modalTitle":"âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…","technicians.picker.actions.apply":"ØªÙ…","technicianProjects.title":"ğŸ“ Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„Ø·Ø§Ù‚Ù…","technicianProjects.empty":"Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø¶Ùˆ."},en:{"technicianDetails.pageTitle":"Crew Member Details","technicianDetails.title":"ğŸ˜ Crew Member Profile","technicianDetails.actions.back":"â¬…ï¸ Back","technicianDetails.actions.edit":"âœï¸ Edit Crew Member","technicianDetails.filters.search":"ğŸ” Search by client or reservation ID...","technicianDetails.fields.role":"ğŸ‘” Role:","technicianDetails.fields.department":"ğŸ§© Department:","technicianDetails.fields.phone":"ğŸ“ Phone:","technicianDetails.fields.wage":"ğŸ’° Daily Rate:","technicianDetails.fields.baseStatus":"âš™ï¸ Base Status:","technicianDetails.fields.notes":"ğŸ“ Notes:","technicianDetails.fallback.name":"â€”","technicianDetails.fallback.role":"Not specified","technicianDetails.fallback.department":"â€”","technicianDetails.fallback.notes":"â€”","technicianDetails.errors.missingId":"âš ï¸ Missing crew member identifier in the URL.","technicianDetails.errors.notFound":"âš ï¸ Crew member not found.","technicianDetails.errors.loadFailed":"âŒ Unable to load crew member details. Please try again later.","technicianDetails.errors.reservationsLoadFailed":"âŒ Unable to load this crew member's reservations right now.","technicianDetails.status.loading":"â³ Loading crew member details...","technicianDetails.edit.modalTitle":"âœï¸ Edit Crew Member","technicians.picker.actions.apply":"Done","technicianProjects.title":"ğŸ“ Crew Projects","technicianProjects.empty":"No projects are linked to this crew member."}});let z={},p={initialized:!1,currentId:null,modal:{el:null,body:null},projectsMap:new Map},ie=!1;function G(e=""){return _(String(e)).trim().toLowerCase()}function _e(e,n,t){if(!n||!t)return;const{startDate:i,endDate:c}=ce(e);n._flatpickr?i?n._flatpickr.setDate(i,!1,"Y-m-d"):n._flatpickr.clear():n.value=i||"",t._flatpickr?c?t._flatpickr.setDate(c,!1,"Y-m-d"):t._flatpickr.clear():t.value=c||""}function P(e){if(!Array.isArray(e))return[];const n=new Set;return e.map(t=>{if(t==null)return null;if(typeof t=="object"){const i=t.id??t.technicianId??t.technician_id??t.technician?.id??null;return i!=null?String(i):null}return typeof t=="string"||typeof t=="number"?String(t):null}).filter(t=>!t||n.has(t)?!1:(n.add(t),!0))}async function Me(e){const n=document.getElementById("technician-reservations");if(!n)return;if(!ie){try{await be({suppressError:!1,force:!0})}catch(f){console.error("âŒ [technician-details] Failed to hydrate reservations list",f),n.innerHTML=`<p class="text-danger" data-i18n data-i18n-key="technicianDetails.errors.reservationsLoadFailed">${l("technicianDetails.errors.reservationsLoadFailed","âŒ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø­Ø¬ÙˆØ²Ø§Øª Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø¶Ùˆ Ø­Ø§Ù„ÙŠØ§Ù‹.")}</p>`;return}ie=!0}const t=document.getElementById("technician-search-reservation"),i=document.getElementById("technician-filter-start-date"),c=document.getElementById("technician-filter-end-date"),s=document.getElementById("technician-reservation-date-range"),d=document.getElementById("technician-reservation-status-filter"),r=document.getElementById("technician-clear-filters");window.flatpickr&&(i&&window.flatpickr(i,{dateFormat:"Y-m-d"}),c&&window.flatpickr(c,{dateFormat:"Y-m-d"}));const u=()=>{let f=_(i?.value||"").trim(),w=_(c?.value||"").trim(),y=s?.value||"";if(new Set(["","today","week","month"]).has(y)||(y="",s&&(s.value=""),i&&(i._flatpickr&&i._flatpickr.clear(),i.value=""),c&&(c._flatpickr&&c._flatpickr.clear(),c.value=""),f="",w=""),!f&&!w&&y){const{startDate:D,endDate:h}=ce(y);f=D,w=h}const b=t?.value||"",v=G(b);return{searchTerm:v,searchReservationId:v,searchCustomerName:v,startDate:f,endDate:w,status:d?.value||"",quickRange:y,technicianId:e}},m=()=>{z=u(),ee("technician-reservations",z)};t&&!t.dataset.listenerAttached&&(t.addEventListener("input",()=>{t.value=_(t.value),m()}),t.dataset.listenerAttached="true"),i&&!i.dataset.listenerAttached&&(i.addEventListener("change",()=>{s&&(s.value=""),m()}),i.dataset.listenerAttached="true"),c&&!c.dataset.listenerAttached&&(c.addEventListener("change",()=>{s&&(s.value=""),m()}),c.dataset.listenerAttached="true"),s&&!s.dataset.listenerAttached&&(s.addEventListener("change",()=>{_e(s.value,i,c),m()}),s.dataset.listenerAttached="true"),d&&!d.dataset.listenerAttached&&(d.addEventListener("change",m),d.dataset.listenerAttached="true"),r&&!r.dataset.listenerAttached&&(r.addEventListener("click",()=>{t&&(t.value=""),i&&(i._flatpickr&&i._flatpickr.clear(),i.value=""),c&&(c._flatpickr&&c._flatpickr.clear(),c.value=""),s&&(s.value=""),d&&(d.value=""),m()}),r.dataset.listenerAttached="true"),window.refreshTechnicianReservationsViews=()=>{ee("technician-reservations",z)},m()}function Re(e){p.currentId=e;const{container:n}=B();n&&(p.initialized||(Be(),Ne(),$e(),document.addEventListener("projects:changed",()=>{p.currentId&&j()}),document.addEventListener("language:changed",()=>{p.currentId&&j()}),document.addEventListener("customers:changed",()=>{p.currentId&&j()}),document.addEventListener("technicians:updated",()=>{p.currentId&&j()}),p.initialized=!0),j())}function B(){return{container:document.getElementById("technician-projects"),searchInput:document.getElementById("technician-project-search"),statusSelect:document.getElementById("technician-project-status-filter"),clearBtn:document.getElementById("technician-projects-clear-filters")}}function Be(){const{searchInput:e,statusSelect:n,clearBtn:t}=B();e&&!e.dataset.listenerAttached&&(e.addEventListener("input",()=>{e.value=_(e.value),j()}),e.dataset.listenerAttached="true"),n&&!n.dataset.listenerAttached&&(n.addEventListener("change",()=>{j()}),n.dataset.listenerAttached="true"),t&&!t.dataset.listenerAttached&&(t.addEventListener("click",()=>{const{searchInput:i,statusSelect:c}=B();i&&(i.value=""),c&&(c.value=""),j()}),t.dataset.listenerAttached="true")}function Ne(){const{container:e}=B();!e||e.dataset.projectModalListenerAttached==="true"||(e.addEventListener("click",Fe),e.dataset.projectModalListenerAttached="true")}function Ce(){const{container:e}=B();e&&e.querySelectorAll(".project-focus-card").forEach(n=>{n.dataset.technicianModalListenerAttached!=="true"&&(n.addEventListener("click",t=>{if(t.target.closest("[data-ignore-project-modal]"))return;const c=n.dataset.projectId?String(n.dataset.projectId):"";c&&$(c)}),n.dataset.technicianModalListenerAttached="true")})}function Fe(e){const n=e.target.closest(".project-focus-card");if(!n||(console.debug("[technician] card click",n.dataset.projectId),!n)||e.target.closest("[data-ignore-project-modal]"))return;const i=n.dataset.projectId?String(n.dataset.projectId):"";i&&$(i)}function $e(){Y()}function Y(){if(p.modal?.el&&p.modal?.body)return!0;const e=document.getElementById("projectDetailsModal"),n=document.getElementById("project-details-body");return!e||!n?!1:(p.modal={el:e,body:n},!0)}function j(){const{container:e,searchInput:n,statusSelect:t}=B();if(!e||!p.currentId)return;const i=G(n?.value||""),c=t?.value||"",{projects:s=[],customers:d=[],technicians:r=[],reservations:u=[]}=K(),m=new Map(d.map(a=>[String(a.id),a])),f=new Map(r.map(a=>[String(a.id),a])),w=new Map(s.map(a=>[String(a.id),a])),y=qe(u),I=String(p.currentId),b=new Map,v=(a,o=null)=>{if(!a)return;const g=a.id!=null?String(a.id):a.projectId!=null?String(a.projectId):null;if(g&&!b.has(g)){const k=o??P(a?.technicians);b.set(g,{...a,technicians:k})}};s.forEach(a=>{const o=P(a?.technicians);o.length&&o.includes(I)&&v({...a,technicians:o},o)}),u.forEach(a=>{if(!a?.projectId)return;const o=P(a.technicians);if(!o.includes(I))return;const g=String(a.projectId),k=b.get(g),T=w.get(g),{effectiveConfirmed:N}=te(a,T??k??null);if(k){const M=P(k.technicians),R=Array.from(new Set([...M,...o]));b.set(g,{...k,technicians:R,confirmed:k.confirmed||N});return}if(T){const M=P(T?.technicians),R=Array.from(new Set([...M,...o]));v({...T,technicians:R,confirmed:te(a,T).effectiveConfirmed},R);return}v({id:g,title:a.projectTitle||a.title||a.project_title||`#${g}`,description:a.notes||"",start:a.projectStart||a.start||null,end:a.projectEnd||a.end||null,technicians:o,clientId:a.projectClientId??a.customerId??null,confirmed:N,status:a.status??null,equipmentEstimate:a.totalAmount??a.total_amount??0,createdAt:a.start??a.created_at??null},o)});const D=Array.from(b.values());p.projectsMap=b,typeof window=="object"&&(window.__ART_RATIO_APP_DEBUG={...window.__ART_RATIO_APP_DEBUG||{},technicianProjects:{projectsMap:b,keys:()=>Array.from(b.keys())}});const h=D.filter(a=>{if(i){const o=m.get(String(a.clientId))?.customerName||"";if(!G([a.title,a.description,o].filter(Boolean).join(" ")).includes(i))return!1}return!(c&&Oe(a)!==c)}).sort((a,o)=>{const g=new Date(a.start||a.createdAt||0).getTime();return new Date(o.start||o.createdAt||0).getTime()-g});if(!h.length){const a=l("technicianProjects.empty",e.dataset.empty||"Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø¶Ùˆ.");e.innerHTML=`<div class="col-12"><div class="alert alert-info text-center mb-0">${a}</div></div>`;return}e.innerHTML=h.map(a=>{const o=O(a),g=o?y.get(o)||[]:[],k=m.get(String(a.clientId))||null;return Se(a,{customer:k,techniciansMap:f,reservations:g})}).join(""),Ce()}function qe(e=[]){const n=new Map;return e.forEach(t=>{const i=t?.projectId??t?.project_id??t?.projectID;if(i==null)return;const c=String(i);n.has(c)||n.set(c,[]),n.get(c).push(t)}),n}function $(e){const n=String(e||"").trim();if(console.debug("[technician] open details",n),!n||!Y())return;const t=p.modal;if(!t?.body)return;const{projects:i=[],reservations:c=[],customers:s=[]}=K(),d=p.projectsMap?.get(n)||null;let r=d??se(i,n);if(r||(r=se(i,n)),!r)return;const u=String(p.currentId||"");let m=P(r.technicians);if(!m.length&&d&&(m=P(d.technicians),r={...d,...r}),typeof window=="object"&&(window.__ART_RATIO_APP_DEBUG={...window.__ART_RATIO_APP_DEBUG||{},technicianProjects:{...window.__ART_RATIO_APP_DEBUG?.technicianProjects||{},lastOpen:{id:n,activeTechnicianId:u,normalizedTechnicians:m}}}),u&&!m.includes(u)){console.debug("[technician] open details skipped (technician not in project)",{normalizedId:n,activeTechnicianId:u,normalizedTechnicians:m});return}r={...r,technicians:m};const f=s.find(y=>String(y.id)===String(r.clientId))||null,w=c.filter(y=>{const I=je(y);return I&&I===n});t.body.dataset.mode="view",t.body.innerHTML=Te(r,{customer:f,reservations:w}),Ve(r),Ue(t.body),window.bootstrap?.Modal?window.bootstrap.Modal.getOrCreateInstance(t.el).show():(t.el.classList.add("show"),t.el.style.display="block")}function Ve(e){if(!e||!p.modal?.body)return;const n=p.modal.body.querySelector('[data-action="edit-project"]');n&&n.addEventListener("click",t=>{t.preventDefault(),ze(e)})}function Ue(e){if(!e)return;const n=e.querySelectorAll('[data-action="view-reservation"]');n.length&&n.forEach(t=>{t.dataset.listenerAttached!=="true"&&(t.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation();const c=ve();let s=Number.parseInt(t.dataset.index||"",10);if(!Number.isInteger(s)||s<0){const d=t.dataset.reservationId;d&&(s=c.findIndex(u=>[u?.id,u?.reservationId,u?.reservation_id].some(f=>f!=null&&String(f)===d)))}Number.isInteger(s)&&s>=0&&typeof window.showReservationDetails=="function"?window.showReservationDetails(s):E(l("projects.details.reservations.viewUnavailable","ØªØ¹Ø°Ø± ÙØªØ­ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø² Ø§Ù„Ø¢Ù†"))}),t.dataset.listenerAttached="true")})}function ze(e){if(!e||!Y())return;const n=p.modal;if(!n?.body)return;const{customers:t=[]}=K(),i=t.find(r=>String(r.id)===String(e.clientId))||null,c=i?.customerName||e.clientName||e.customerName||"",s=e.clientCompany||i?.companyName||i?.company||"",d=Array.isArray(e?.expenses)?e.expenses.map((r,u)=>({id:r?.id||`expense-${e.id}-${u}-${Date.now()}`,label:r?.label||"",amount:Number(r?.amount)||0})):[];n.body.dataset.mode="edit",n.body.innerHTML=Ae(e,{clientName:c,clientCompany:s}),He(e,{clientName:c,clientCompany:s,expenses:d})}function He(e,{clientName:n="",clientCompany:t="",expenses:i=[]}={}){const c={clientCompany:t,expenses:Array.isArray(i)?[...i]:[]},s=p.modal?.body?.querySelector("#project-details-edit-form");if(!s)return;const d=s.querySelector('[data-action="cancel-edit"]');d&&d.addEventListener("click",D=>{D.preventDefault(),$(e.id)});const r=s.querySelector("#project-edit-expense-label"),u=s.querySelector("#project-edit-expense-amount"),m=s.querySelector('[data-action="add-expense"]'),f=s.querySelector("#project-edit-expense-list"),w=s.querySelector('[name="project-start-date"]'),y=s.querySelector('[name="project-start-time"]'),I=s.querySelector('[name="project-end-date"]'),b=s.querySelector('[name="project-end-time"]');function v(){f&&(f.innerHTML=Pe(c.expenses))}v(),m&&m.addEventListener("click",D=>{D.preventDefault();const h=r?.value.trim()||"",a=_(u?.value||"0"),o=Number(a);if(!h){E(l("projects.toast.missingExpenseLabel","âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙˆØµÙ Ø§Ù„Ù…ØµØ±ÙˆÙ")),r?.focus();return}if(!Number.isFinite(o)||o<=0){E(l("projects.toast.invalidExpenseAmount","âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­")),u?.focus();return}c.expenses.push({id:`expense-${e.id}-${Date.now()}`,label:h,amount:o}),r&&(r.value=""),u&&(u.value=""),v()}),f&&f.addEventListener("click",D=>{const h=D.target.closest('[data-action="remove-expense"]');if(!h)return;const{id:a}=h.dataset;c.expenses=c.expenses.filter(o=>String(o.id)!==String(a)),v()}),s.addEventListener("submit",async D=>{if(D.preventDefault(),s.dataset.submitting==="true")return;const h=s.querySelector('[name="project-title"]'),a=s.querySelector('[name="project-type"]'),o=s.querySelector('[name="project-description"]'),g=s.querySelector('[name="project-payment-status"]'),k=s.querySelector('[name="project-apply-tax"]'),T=h?.value.trim()||"",N=a?.value||"",M=w?.value.trim()||"",R=y?.value.trim()||"",re=o?.value.trim()||"",W=g?.value==="paid"?"paid":"unpaid",q=k?.checked===!0;if(!T||!N||!M){E(l("projects.toast.missingRequiredFields","âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©")),h?.focus();return}const Q=I?.value.trim()||"",oe=b?.value.trim()||"",J=ae(M,R),V=Q?ae(Q,oe):"";if(V){const A=new Date(J),x=new Date(V);if(!Number.isNaN(A.getTime())&&!Number.isNaN(x.getTime())&&A>x){E(l("projects.toast.invalidDateRange","âš ï¸ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨Ø¹Ø¯ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©")),I?.focus();return}}const C=O(e);if(!C){E(l("projects.toast.editMissing","âš ï¸ ØªØ¹Ø°Ù‘Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ ØªØ¹Ø¯ÙŠÙ„Ù‡"));return}const X=Number(e?.equipmentEstimate??e?.equipment_estimate??0)||0,le=Le({...e,expenses:c.expenses}),U=Number((X+le).toFixed(2)),Z=q?Number((U*Ee).toFixed(2)):0,de=q?Number((U+Z).toFixed(2)):U,ue=De({projectCode:e.projectCode,title:T,type:N,clientId:e.clientId,clientCompany:c.clientCompany,description:re,start:J,end:V||null,applyTax:q,paymentStatus:W,equipmentEstimate:X,expenses:c.expenses,taxAmount:Z,totalWithTax:de,confirmed:e.confirmed,technicians:Array.isArray(e?.technicians)?e.technicians:[],equipment:Array.isArray(e?.equipment)?e.equipment:[]}),S=s.querySelector('button[type="submit"]');S&&(S.disabled=!0,S.dataset.originalText=S.textContent||"",S.textContent=l("projects.details.edit.saving","Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...")),s.dataset.submitting="true";try{const A=await we(C,ue);await xe(C,W),document.dispatchEvent(new CustomEvent("projects:changed")),E(l("projects.toast.updated","âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¨Ù†Ø¬Ø§Ø­")),j();const x=O(A)||C;x&&$(x)}catch(A){console.error("âŒ [technicianDetails] Failed to update project from modal",A);const x=typeof A?.message=="string"?A.message:l("projects.toast.updateFailed","ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰");E(x)}finally{delete s.dataset.submitting,S&&(S.disabled=!1,S.dataset.originalText&&(S.textContent=S.dataset.originalText,delete S.dataset.originalText))}})}function se(e=[],n){const t=String(n);return e.find(i=>[i?.id,i?.projectId,i?.project_id].some(s=>s!=null&&String(s)===t))||null}function Oe(e){const n=new Date,t=e.start?new Date(e.start):null,i=e.end?new Date(e.end):null;return t&&!Number.isNaN(t.getTime())&&t>n?"upcoming":i&&!Number.isNaN(i.getTime())&&i<n?"completed":"ongoing"}fe();pe();const Ge=new URLSearchParams(window.location.search),H=Ge.get("id"),L=document.getElementById("technician-details");window.showReservationDetails=ye;he();const F=document.getElementById("logout-btn");F&&!F.dataset.listenerAttached&&(F.addEventListener("click",()=>ge()),F.dataset.listenerAttached="true");function Ke(e){const n=Number(e??0);return Number.isFinite(n)?n.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:2}):"0"}function Ye(e){if(!L)return;const n=e.name||l("technicianDetails.fallback.name","â€”"),t=e.status==="busy"?"technicians.status.busy":"technicians.status.available",c=`
    <span class="badge ${e.status==="busy"?"bg-danger":"bg-success"}" data-i18n data-i18n-key="${t}">
      ${l(t)}
    </span>
  `,s=e.phone?_(e.phone):`<span data-i18n data-i18n-key="reservations.details.technicians.phoneUnknown">${l("reservations.details.technicians.phoneUnknown","ØºÙŠØ± Ù…ØªÙˆÙØ±")}</span>`,d=e.role?e.role:`<span data-i18n data-i18n-key="technicianDetails.fallback.role">${l("technicianDetails.fallback.role","ØºÙŠØ± Ù…Ø­Ø¯Ø¯")}</span>`,r=e.department?e.department:`<span data-i18n data-i18n-key="technicianDetails.fallback.department">${l("technicianDetails.fallback.department","â€”")}</span>`,u=e.notes?e.notes:`<span data-i18n data-i18n-key="technicianDetails.fallback.notes">${l("technicianDetails.fallback.notes","â€”")}</span>`,f=`<span data-i18n data-i18n-key="reservations.create.summary.currency">${l("reservations.create.summary.currency","Ø±ÙŠØ§Ù„")}</span>`,w=`${Ke(e.dailyWage)} ${f}`,I=(e.baseStatus||e.status||"available")==="busy"?"technicians.status.busy":"technicians.status.available",b=`<span data-i18n data-i18n-key="${I}">${l(I)}</span>`,v=l("technicianDetails.actions.edit","âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…"),D=[{key:"technicianDetails.fields.role",value:d},{key:"technicianDetails.fields.department",value:r},{key:"technicianDetails.fields.phone",value:s},{key:"technicianDetails.fields.wage",value:w},{key:"technicianDetails.fields.baseStatus",value:b},{key:"technicianDetails.fields.notes",value:u}].map(({key:h,value:a})=>`
    <p class="technician-detail-row">
      <strong data-i18n data-i18n-key="${h}">${l(h)}</strong>
      <span>${a}</span>
    </p>
  `).join("");L.innerHTML=`
    <div class="technician-details">
      <div class="d-flex align-items-center gap-2 technician-header">
        <h3 class="mb-0 technician-name">${n}</h3>
        ${c}
      </div>
      <div class="technician-details-body">
        ${D}
      </div>
      <div class="d-flex justify-content-start mt-3 gap-2">
        <button type="button" class="btn btn-warning" id="edit-technician-btn" data-i18n data-i18n-key="technicianDetails.actions.edit">${v}</button>
      </div>
    </div>
  `}async function We(){if(!L)return;if(!H){L.innerHTML=`<p class="text-danger" data-i18n data-i18n-key="technicianDetails.errors.missingId">${l("technicianDetails.errors.missingId","âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø¹Ø±Ù Ø¹Ø¶Ùˆ Ø·Ø§Ù‚Ù… ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø·.")}</p>`;return}L.innerHTML=`<p class="text-muted" data-i18n data-i18n-key="technicianDetails.status.loading">${l("technicianDetails.status.loading","â³ Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…...")}</p>`;let e=ne(H);if(!e){try{await ke()}catch(n){console.error("âŒ [technician-details] Failed to load technician from API",n),L.innerHTML=`<p class="text-danger" data-i18n data-i18n-key="technicianDetails.errors.loadFailed">${l("technicianDetails.errors.loadFailed","âŒ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù…. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ø§Ø­Ù‚Ù‹Ø§.")}</p>`;return}e=ne(H)}if(!e){L.innerHTML=`<p class="text-danger" data-i18n data-i18n-key="technicianDetails.errors.notFound">${l("technicianDetails.errors.notFound","âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¹Ø¶Ùˆ Ø§Ù„Ø·Ø§Ù‚Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨.")}</p>`;return}Ye(e),Me({technician:e}),Re({technician:e})}Ie();We();
