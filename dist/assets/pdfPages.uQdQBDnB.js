import{t as i,f as w,a as P,b as u,r as N}from"./calculations.xs5ZU-uw.js";import{e as _}from"./reports.BxlDl5Ps.js";import{s as q,c as R,d as S,q as H}from"./controller.CwK47G-r.js";import"./reservationsService.BtJ4Aekt.js";import"./auth.BcQOd76e.js";import"./dashboard.D_Pxgen_.js";/* empty css              */import"./dashboardShell.deT9qe6E.js";import"./customers.Bfn9j-AP.js";import"./maintenanceService.Cf3sMnbW.js";const x=96,v=25.4,M=210,z=297,y=Math.round(M/v*x),E=Math.round(z/v*x);function A(t="preview"){const e=document.createElement("div");e.id="quotation-pdf-root",e.setAttribute("dir",document.documentElement.getAttribute("dir")||"rtl"),e.setAttribute("data-quote-render-context",t);const s=document.createElement("style");s.textContent=String(H).trim(),e.appendChild(s);const a=document.createElement("div");a.className="quote-preview-pages",a.setAttribute("data-quote-pages",""),e.appendChild(a);const r=document.createElement("style");return r.textContent=`
    .rpt-header { display:flex; flex-direction:column; gap:6px; }
    .rpt-header h1 { margin:0; font-weight:800; font-size:18px; text-align:right; }
    .rpt-subtitle { margin:0; font-size:12px; opacity:.8; text-align:right; }
    .rpt-kpis { display:grid; grid-template-columns: repeat(3, 1fr); gap:8px; margin:8px 0 4px; }
    .rpt-kpi { border:1px solid #e5e7eb; border-radius:10px; padding:8px 10px; background:#fff; }
    .rpt-kpi .label { font-size:11px; opacity:.8; }
    .rpt-kpi .value { font-weight:700; font-size:14px; }
    .rpt-table { width:100%; border-collapse:collapse; font-size:12px; }
    .rpt-table th { background:#f3f4f6; border:1px solid #e5e7eb; padding:6px 8px; text-align:right; font-weight:800; }
    .rpt-table td { border:1px solid #e5e7eb; padding:6px 8px; text-align:right; }
  `,e.appendChild(r),e}function g({primary:t=!1}={}){const e=document.createElement("div");return e.className="quote-page",t&&e.classList.add("quote-page--primary"),e}function T(t){const e=document.createElement("div");e.className="rpt-header";const s=document.createElement("h1");s.textContent=i("reservations.reports.print.title","تقرير الحجوزات","Reservations report");const a=document.createElement("p");a.className="rpt-subtitle",a.textContent=`${w(new Date)} • ${i("reservations.reports.print.generated","تاريخ التوليد","Generated on")}`,e.appendChild(s),e.appendChild(a);const r=document.createElement("div");r.className="rpt-kpis";const n=(o,p)=>{const l=document.createElement("div");return l.className="rpt-kpi",l.innerHTML=`<div class="label">${o}</div><div class="value">${p}</div>`,l};return r.appendChild(n(i("reservations.reports.kpi.total.label","الحجوزات","Reservations"),P(t.total||0))),r.appendChild(n(i("reservations.reports.kpi.revenue.label","الإيرادات","Revenue"),u(t.revenue||0))),r.appendChild(n(i("reservations.reports.kpi.net.label","صافي الربح","Net profit"),u(t.netProfit||0))),r.appendChild(n(i("reservations.reports.kpi.share.label","نسبة الشركة","Company share"),u(t.companyShareTotal||0))),r.appendChild(n(i("reservations.reports.kpi.tax.label","الضريبة","Tax"),u(t.taxTotal||0))),r.appendChild(n(i("reservations.reports.kpi.maintenance.label","مصاريف الصيانة","Maintenance"),u(t.maintenanceExpense||0))),e.appendChild(r),e}function C(t){const e=document.createElement("table");e.className="rpt-table";const s=document.createElement("thead"),a=document.createElement("tr");t.forEach(n=>{const o=document.createElement("th");o.textContent=n,a.appendChild(o)}),s.appendChild(a);const r=document.createElement("tbody");return e.appendChild(s),e.appendChild(r),{table:e,tbody:r}}function I(t){const e=t.getBoundingClientRect().height||E;return(t.scrollHeight||t.firstElementChild?.scrollHeight||e)>e-1}function j(t,e,s,a){const r=t.querySelector("[data-quote-pages]"),n=g({primary:!0});r.appendChild(n);const o=T(a);n.appendChild(o);let{table:p,tbody:l}=C(s);n.appendChild(p);const f=c=>{const d=document.createElement("tr");return s.forEach(h=>{const b=document.createElement("td");b.textContent=c[h]!=null?String(c[h]):"",d.appendChild(b)}),l.appendChild(d),I(n)?(l.removeChild(d),!1):!0},k=()=>{const c=g({primary:!1});r.appendChild(c);const d=C(s);return c.appendChild(d.table),{page:c,tbody:d.tbody}};let m=0;for(;m<e.length;)if(f(e[m]))m++;else{const d=k();p=d.page.querySelector("table"),l=d.tbody,f(e[m])||l.appendChild(d.tbody.lastElementChild||document.createElement("tr")),m++}}function D(t=[],{context:e="preview"}={}){const a=(N.lastSnapshot||{}).metrics||{},r=t&&t.length?Object.keys(t[0]):[i("reservations.reports.results.headers.id","الحجز","Reservation"),i("reservations.reports.results.headers.customer","العميل","Customer"),i("reservations.reports.results.headers.date","التاريخ","Date"),i("reservations.reports.results.headers.status","الحالة","Status"),i("reservations.reports.results.headers.payment","الدفع","Payment"),i("reservations.reports.results.headers.total","الإجمالي","Total"),i("reservations.reports.results.headers.share","نسبة الشركة","Company share"),i("reservations.reports.results.headers.net","صافي الربح","Net profit")],n=A(e),o=document.createElement("div");o.style.position="fixed",o.style.left="-10000px",o.style.top="0",o.style.width=`${y}px`,o.style.zIndex="-1",document.body.appendChild(o),o.appendChild(n);try{q(n),R(n),S(n)}catch{}return j(n,t||[],r,a),n.parentElement?.removeChild(n),o.parentElement?.removeChild(o),n}async function J(t=[],{action:e="save"}={}){const s=D(t,{context:"export"}),a=document.createElement("div");Object.assign(a.style,{position:"fixed",top:"0",left:"0",pointerEvents:"none",zIndex:"-1"}),a.appendChild(s),document.body.appendChild(a);try{await _();const r=window.html2pdf().set({margin:0,html2canvas:{scale:2,useCORS:!0,allowTaint:!1,backgroundColor:"#ffffff",scrollX:0,scrollY:0,windowWidth:y,windowHeight:E},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"},pagebreak:{mode:["css","legacy"]},image:{type:"jpeg",quality:.98}}).from(s).toPdf();if(e==="print"){const n=await r.get("pdf").then(o=>o.output("bloburl"));await new Promise(o=>{const p=document.createElement("iframe");Object.assign(p.style,{position:"fixed",right:"0",bottom:"0",width:"1px",height:"1px",border:"0"}),p.onload=()=>{try{p.contentWindow?.focus(),p.contentWindow?.print()}catch{}setTimeout(()=>{p.remove(),o()},1e3)},p.src=n,document.body.appendChild(p)})}else await r.save("reservations-report.pdf")}finally{a.remove()}}export{D as buildReportsPdfPages,J as exportReportsPdf};
