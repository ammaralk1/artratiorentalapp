const h=/color\([^)]*\)/gi,p=/color-mix\([^)]*\)/gi,k=/oklab\([^)]*\)/gi,S=/oklch\([^)]*\)/gi,a=/(color\(|color-mix\(|oklab|oklch)/i,E=["color","backgroundColor","borderColor","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor","outlineColor","fill","stroke","boxShadow","textShadow","accentColor","caretColor","columnRuleColor"],P=typeof document<"u"?document.createElement("canvas"):null,d=P?.getContext?.("2d")||null;function C(r){return r.replace(/[A-Z]/g,t=>`-${t.toLowerCase()}`)}function g(r,t="#000"){if(!d||!r)return t;try{return d.fillStyle="#000",d.fillStyle=r,d.fillStyle||t}catch{return t}}function m(){const r=window.html2canvas;if(!r?.Color||r.Color.__artRatioPatched)return;const t=r.Color.fromString.bind(r.Color);r.Color.fromString=o=>{try{return t(o)}catch(e){if(typeof o=="string"&&a.test(o)){const n=g(o)||"#000";try{return t(n)}catch{return t("#000")}}throw e}},r.Color.__artRatioPatched=!0}function i(r,t,o){if(!r||!t?.style)return;const e=t.style.getPropertyValue(o),n=t.style.getPropertyPriority(o);r.push({element:t,prop:o,value:e,priority:n})}function x(r,t=window,o=[]){if(!r||!t||typeof t.getComputedStyle!="function")return;const e=r.querySelectorAll?.("*");e&&e.forEach(n=>{const l=t.getComputedStyle(n);if(!l)return;E.forEach(c=>{const f=l[c];if(f&&a.test(f)){const s=C(c);if(i(o,n,s),c==="boxShadow"||c==="textShadow")n.style.setProperty(s,"none","important");else{const y=c==="backgroundColor"?"#ffffff":l.color||"#000000",b=g(f,y);n.style.setProperty(s,b,"important")}}});const u=l.backgroundImage;if(u&&a.test(u)){const c=g(l.backgroundColor||"#ffffff","#ffffff");i(o,n,"background-image"),i(o,n,"background-color"),n.style.setProperty("background-image","none","important"),n.style.setProperty("background-color",c,"important")}})}function R(r,t=window,o=[]){if(!r||!t||typeof t.getComputedStyle!="function")return;const e=r.querySelectorAll?.("*");e&&e.forEach(n=>{const l=t.getComputedStyle(n);if(!l)return;["color","backgroundColor","borderColor","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor","boxShadow","textShadow","accentColor","caretColor","columnRuleColor"].forEach(c=>{const f=l[c];if(f&&a.test(f)){const s=C(c);if(i(o,n,s),c==="boxShadow"||c==="textShadow")n.style.setProperty(s,"none","important");else{const y=c==="backgroundColor"?"#ffffff":"#000000";n.style.setProperty(s,y,"important")}}});const u=l.backgroundImage;u&&a.test(u)&&(i(o,n,"background-image"),i(o,n,"background-color"),n.style.setProperty("background-image","none","important"),n.style.setProperty("background-color","#ffffff","important"))})}function O(r){if(!r)return;const t=(o="")=>{if(typeof o!="string")return o;let e=o;return a.test(e)&&(e=e.replace(h,"#000").replace(p,"#000").replace(k,"#000").replace(S,"#000")),e};r.querySelectorAll?.("style")?.forEach?.(o=>{const e=o.textContent;typeof e=="string"&&a.test(e)&&(o.textContent=t(e))}),r.querySelectorAll?.("[style]")?.forEach?.(o=>{const e=o.getAttribute("style");typeof e=="string"&&a.test(e)&&o.setAttribute("style",t(e))})}export{x as a,R as e,m as p,O as s};
