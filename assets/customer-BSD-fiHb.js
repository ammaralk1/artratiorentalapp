import{r as R,n as f,t as u,a as g,s as D,g as p}from"./utils-C0DqWSLe.js";import{d as k,h as I,j as C}from"./reservationsUI-BwO38w_2.js";import{g as _}from"./customers-C-_eQ3rP.js";import{a as b,i as A}from"./theme-DNrHvxu3.js";R({ar:{"customerDetails.pageTitle":"معلومات العميل","customerDetails.title":"👤 بيانات العميل","customerDetails.actions.back":"⬅️ العودة","customerDetails.actions.edit":"✏️ تعديل العميل","customerDetails.filters.search":"🔍 ابحث باسم العميل أو رقم الحجز...","customerDetails.fields.name":"👤 الاسم:","customerDetails.fields.phone":"📞 الجوال:","customerDetails.fields.company":"🏢 الشركة:","customerDetails.fields.email":"📧 البريد:","customerDetails.fields.address":"📍 العنوان:","customerDetails.fields.notes":"📝 الملاحظات:","customerDetails.toast.missingRequired":"⚠️ الاسم ورقم الهاتف إلزاميان","customerDetails.toast.notFound":"⚠️ العميل غير موجود","customerDetails.toast.updateSuccess":"✅ تم تحديث بيانات العميل","customerDetails.errors.notFound":"⚠️ لم يتم العثور على هذا العميل.","customerDetails.errors.missingId":"⚠️ لا يوجد معرف عميل في الرابط.","customerDetails.edit.modalTitle":"✏️ تعديل العميل"},en:{"customerDetails.pageTitle":"Customer Details","customerDetails.title":"👤 Client Profile","customerDetails.actions.back":"⬅️ Back","customerDetails.actions.edit":"✏️ Edit Client","customerDetails.filters.search":"🔍 Search by client or reservation ID...","customerDetails.fields.name":"👤 Name:","customerDetails.fields.phone":"📞 Phone:","customerDetails.fields.company":"🏢 Company:","customerDetails.fields.email":"📧 Email:","customerDetails.fields.address":"📍 Address:","customerDetails.fields.notes":"📝 Notes:","customerDetails.toast.missingRequired":"⚠️ Name and phone are required","customerDetails.toast.notFound":"⚠️ Client not found","customerDetails.toast.updateSuccess":"✅ Client information updated","customerDetails.errors.notFound":"⚠️ This client could not be found.","customerDetails.errors.missingId":"⚠️ Missing client identifier in the URL.","customerDetails.edit.modalTitle":"✏️ Edit Client"}});let y={};function N(a=""){return f(String(a)).trim().toLowerCase()}function S(a,r,s){if(!r||!s)return;const{startDate:e,endDate:t}=I(a);r._flatpickr?e?r._flatpickr.setDate(e,!1,"Y-m-d"):r._flatpickr.clear():r.value=e||"",s._flatpickr?t?s._flatpickr.setDate(t,!1,"Y-m-d"):s._flatpickr.clear():s.value=t||""}function F(a){if(!document.getElementById("customer-reservations"))return;const s=document.getElementById("customer-search-reservation"),e=document.getElementById("customer-filter-start-date"),t=document.getElementById("customer-filter-end-date"),i=document.getElementById("customer-reservation-date-range"),n=document.getElementById("customer-reservation-status-filter"),d=document.getElementById("customer-clear-filters");window.flatpickr&&(e&&window.flatpickr(e,{dateFormat:"Y-m-d"}),t&&window.flatpickr(t,{dateFormat:"Y-m-d"}));const v=()=>{let l=f((e==null?void 0:e.value)||"").trim(),c=f((t==null?void 0:t.value)||"").trim(),m=(i==null?void 0:i.value)||"";if(new Set(["","today","week","month"]).has(m)||(m="",i&&(i.value=""),e&&(e._flatpickr&&e._flatpickr.clear(),e.value=""),t&&(t._flatpickr&&t._flatpickr.clear(),t.value=""),l="",c=""),!l&&!c&&m){const{startDate:L,endDate:T}=I(m);l=L,c=T}return{searchTerm:N((s==null?void 0:s.value)||""),startDate:l,endDate:c,status:(n==null?void 0:n.value)||"",quickRange:m,customerId:a}},o=()=>{y=v(),k("customer-reservations",y)};s&&!s.dataset.listenerAttached&&(s.addEventListener("input",()=>{s.value=f(s.value),o()}),s.dataset.listenerAttached="true"),e&&!e.dataset.listenerAttached&&(e.addEventListener("change",()=>{i&&(i.value=""),o()}),e.dataset.listenerAttached="true"),t&&!t.dataset.listenerAttached&&(t.addEventListener("change",()=>{i&&(i.value=""),o()}),t.dataset.listenerAttached="true"),i&&!i.dataset.listenerAttached&&(i.addEventListener("change",()=>{S(i.value,e,t),o()}),i.dataset.listenerAttached="true"),n&&!n.dataset.listenerAttached&&(n.addEventListener("change",o),n.dataset.listenerAttached="true"),d&&!d.dataset.listenerAttached&&(d.addEventListener("click",()=>{s&&(s.value=""),e&&(e._flatpickr&&e._flatpickr.clear(),e.value=""),t&&(t._flatpickr&&t._flatpickr.clear(),t.value=""),i&&(i.value=""),n&&(n.value=""),o()}),d.dataset.listenerAttached="true"),window.refreshCustomerReservationsViews=()=>{k("customer-reservations",y)},o()}b();const M=new URLSearchParams(window.location.search),h=M.get("id"),E=document.getElementById("customer-details");window.showReservationDetails=C;A();var w,B;if(h){const a=_(h);if(a){const r=[{key:"customerDetails.fields.name",value:a.customerName||"—"},{key:"customerDetails.fields.phone",value:a.phone?f(a.phone):"—"},{key:"customerDetails.fields.company",value:a.companyName||"—"},{key:"customerDetails.fields.email",value:a.email||"—"},{key:"customerDetails.fields.address",value:a.address||"—"},{key:"customerDetails.fields.notes",value:a.notes||"—"}].map(({key:s,value:e})=>`
          <p class="customer-detail-row">
            <strong data-i18n data-i18n-key="${s}">${u(s)}</strong>
            <span>${e}</span>
          </p>
        `).join("");E.innerHTML=`
          <div class="customer-details">
            ${r}
          </div>
          <button class="btn btn-warning mt-3" id="edit-btn" data-i18n data-i18n-key="customerDetails.actions.edit">${u("customerDetails.actions.edit","✏️ تعديل العميل")}</button>
        `,g(p()),F(h),(w=document.getElementById("edit-btn"))==null||w.addEventListener("click",()=>{document.getElementById("edit-id").value=a.id,document.getElementById("edit-name").value=a.customerName,document.getElementById("edit-phone").value=a.phone,document.getElementById("edit-company").value=a.companyName||"",document.getElementById("edit-email").value=a.email||"",document.getElementById("edit-address").value=a.address||"",document.getElementById("edit-notes").value=a.notes||"",new bootstrap.Modal(document.getElementById("editCustomerModal")).show()}),(B=document.getElementById("save-edit-btn"))==null||B.addEventListener("click",()=>{const s=document.getElementById("edit-id").value,e=document.getElementById("edit-name").value.trim(),t=document.getElementById("edit-phone").value.trim(),i=document.getElementById("edit-company").value.trim(),n=document.getElementById("edit-email").value.trim(),d=document.getElementById("edit-address").value.trim(),v=document.getElementById("edit-notes").value.trim();if(!e||!t){D(u("customerDetails.toast.missingRequired","⚠️ الاسم ورقم الهاتف إلزاميان"));return}const o=JSON.parse(localStorage.getItem("customersList")||"[]"),l=o.findIndex(c=>c.id===s);if(l===-1){D(u("customerDetails.toast.notFound","⚠️ العميل غير موجود"));return}o[l]={...o[l],customerName:e,phone:t,companyName:i,email:n,address:d,notes:v},localStorage.setItem("customersList",JSON.stringify(o)),D(u("customerDetails.toast.updateSuccess","✅ تم تحديث بيانات العميل")),window.location.reload()})}else E.innerHTML='<p class="text-danger" data-i18n data-i18n-key="customerDetails.errors.notFound">⚠️ لم يتم العثور على هذا العميل.</p>',g(p())}else E.innerHTML='<p class="text-danger" data-i18n data-i18n-key="customerDetails.errors.missingId">⚠️ لا يوجد معرف عميل في الرابط.</p>',g(p());
