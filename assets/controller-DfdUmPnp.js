import{r as Sn,s as f,t as r,n as g,e as Cn,f as Ae}from"./auth-CNAfl19F.js";import{l as A,s as Y}from"./storage-DOnDLvtb.js";import{n as N,d as Bn,e as Ie,h as pe,f as dt,j as _e,k as Tn,l as Ee,m as xn,o as ut,b as mt,s as Le,p as pt,q as An,t as kn,u as Dn,v as Ln,w as $n,c as Nn,x as jn,y as Rn,z as Mn,A as Pn,a as Fn}from"./reservationsSummary-CBdNx1nm.js";Sn({ar:{"dashboard.header.greeting":"👋 أهلاً بك في لوحة التحكم","tabs.customers":"👤 العملاء","tabs.equipment":"🎥 المعدات","tabs.maintenance":"🛠️ الصيانة","tabs.technicians":"😎 طاقم العمل","tabs.reservations":"📅 الحجوزات","actions.close":"إغلاق","actions.cancel":"إلغاء","actions.goHome":"🏠 الرئيسية","customers.section.title":"📋 إدارة العملاء","customers.form.title":"📋 إضافة / تعديل عميل","customers.form.hint":"حدّث بيانات العميل وسيتم مزامنتها مع الحجوزات والفواتير.","customers.form.labels.name":"👤 الاسم","customers.form.labels.phone":"📞 الجوال","customers.form.labels.email":"📧 البريد","customers.form.labels.address":"📍 العنوان","customers.form.labels.company":"🏢 الشركة","customers.form.labels.notes":"📝 الملاحظات","customers.form.placeholders.name":"اسم العميل","customers.form.placeholders.phone":"05xxxxxxxx","customers.form.placeholders.email":"example@email.com","customers.form.placeholders.address":"عنوان العميل","customers.form.placeholders.company":"اسم الشركة","customers.form.placeholders.notes":"معلومات إضافية أو تذكيرات","customers.form.actions.cancel":"إلغاء التعديل","customers.form.actions.submit":"➕ إضافة عميل","customers.form.actions.update":"💾 حفظ التعديل","customers.search.placeholder":"🔍 ابحث عن عميل بالاسم أو الجوال أو الشركة...","customers.table.headers.name":"👤 الاسم","customers.table.headers.phone":"📞 الجوال","customers.table.headers.company":"🏢 الشركة","customers.table.headers.notes":"📝 ملاحظات","customers.table.headers.actions":"⚙️ الإجراءات","customers.table.loading":"جاري التحميل...","customers.table.empty":"لا يوجد عملاء","customers.table.noResults":"لا توجد نتائج مطابقة","customers.actions.edit":"✏️ تعديل","customers.actions.delete":"🗑️ حذف","customers.toast.updateSuccess":"تم تحديث بيانات العميل بنجاح","customers.toast.createSuccess":"تمت إضافة العميل بنجاح","customers.toast.missingFields":"يرجى تعبئة الاسم ورقم الهاتف","customers.toast.deleteConfirm":"⚠️ هل أنت متأكد من حذف هذا العميل؟","customers.toast.deleteSuccess":"تم حذف العميل","equipment.section.title":"🎥 إدارة المعدات","equipment.actions.clearAll":"🗑️ مسح الكل","equipment.actions.uploadExcel":"📤 رفع من Excel","equipment.form.title":"🎥 إضافة معدة","equipment.form.hint":"أدخل بيانات المعدة ليتم حفظها ضمن قائمة المعدات.","equipment.form.labels.description":"📝 الوصف","equipment.form.placeholders.description":"وصف المعدة","equipment.form.labels.barcode":"🏷️ الباركود","equipment.form.placeholders.barcode":"الباركود","equipment.form.labels.price":"💵 السعر","equipment.form.placeholders.price":"0","equipment.form.labels.quantity":"🔢 الكمية","equipment.form.placeholders.quantity":"1","equipment.form.labels.image":"🖼️ رابط الصورة","equipment.form.placeholders.image":"https://...","equipment.form.labels.category":"📂 القسم","equipment.form.placeholders.category":"القسم","equipment.form.labels.subcategory":"📑 القسم الثانوي","equipment.form.placeholders.subcategory":"القسم الثانوي","equipment.form.labels.status":"⚙️ الحالة","equipment.form.options.available":"✅ متاح","equipment.form.options.booked":"📌 محجوز","equipment.form.options.maintenance":"🛠️ صيانة","equipment.form.actions.submit":"➕ إضافة معدة","equipment.filters.search":"🔍 ابحث عن معدة...","equipment.filters.status.all":"⚙️ كل الحالات","equipment.filters.category.all":"📂 كل الأقسام","equipment.filters.subcategory.all":"📑 كل الأقسام الثانوية","equipment.list.title":"📋 كل المعدات","equipment.modal.title":"✏️ تعديل بيانات المعدة","equipment.modal.placeholders.image":"ضع رابط مباشر للصورة","equipment.modal.actions.cancel":"❌ إلغاء","equipment.modal.actions.save":"💾 حفظ التعديلات","equipment.toast.xlsxMissing":"⚠️ مكتبة Excel (XLSX) غير محملة. تحقق من الروابط في dashboard.html","equipment.toast.uploadSuccess":"✅ تم رفع المعدات بنجاح","equipment.toast.uploadEmpty":"⚠️ الملف لا يحتوي على بيانات يمكن استيرادها","equipment.toast.uploadFailed":"❌ حدث خطأ أثناء قراءة ملف الإكسل","equipment.toast.clearConfirm":"⚠️ هل أنت متأكد من حذف كل المعدات؟","equipment.toast.clearSuccess":"🗑️ تم مسح جميع المعدات","equipment.toast.deleteConfirm":"❌ هل أنت متأكد من حذف هذه المعدة؟","equipment.toast.deleteSuccess":"🗑️ تم حذف المعدة","equipment.toast.editSuccess":"✏️ تم تعديل بيانات المعدة","equipment.toast.addSuccess":"✅ تم إضافة المعدة","equipment.toast.updateSuccess":"✅ تم تحديث بيانات المعدة بنجاح","equipment.toast.missingFields":"⚠️ يرجى إدخال الوصف والباركود","equipment.toast.duplicateBarcode":"⚠️ هذا الباركود مستخدم مسبقًا","equipment.list.emptyFiltered":"⚠️ لا توجد معدات مطابقة.","equipment.list.countSuffix":"عنصر","equipment.item.imageAlt":"صورة","equipment.item.currency":"ريال","equipment.item.actions.edit":"✏️ تعديل","equipment.item.actions.delete":"🗑️ حذف","reservations.tabs.create":"➕ إنشاء حجز","reservations.tabs.mine":"📋 حجوزاتي","reservations.tabs.reports":"📊 تقارير","reservations.tabs.calendar":"📅 التقويم","reservations.create.title":"➕ إنشاء حجز جديد","reservations.create.labels.startDate":"📅 تاريخ البداية","reservations.create.labels.startTime":"⏰ وقت البداية","reservations.create.labels.endDate":"📅 تاريخ النهاية","reservations.create.labels.endTime":"⏰ وقت النهاية","reservations.create.labels.client":"👤 العميل","reservations.create.placeholders.client":"اكتب اسم العميل...","reservations.create.labels.project":"📁 المشروع المرتبط","reservations.create.placeholders.project":"اختر مشروعاً (اختياري)","reservations.create.labels.notes":"📝 ملاحظات","reservations.create.placeholders.notes":"اكتب أي ملاحظات إضافية...","reservations.create.equipment.title":"🎥 أضف المعدات","reservations.create.equipment.placeholders.barcode":"🔍 امسح أو أدخل الباركود ثم اضغط Enter","reservations.create.equipment.placeholders.description":"🎥 اكتب اسم المعدة ثم اضغط Enter","reservations.create.equipment.table.code":"الكود","reservations.create.equipment.table.description":"الوصف","reservations.create.equipment.table.price":"السعر","reservations.create.equipment.table.image":"الصورة","reservations.create.equipment.table.delete":"حذف","reservations.create.billing.title":"💵 الخصم والضريبة","reservations.create.billing.discount":"ادخل قيمة الخصم","reservations.create.billing.discountPercent":"٪ نسبة","reservations.create.billing.discountAmount":"💵 مبلغ","reservations.create.billing.taxLabel":"شامل الضريبة (15٪)","reservations.create.labels.paymentStatus":"💳 حالة الدفع","reservations.create.paymentStatus.paid":"مدفوع","reservations.create.paymentStatus.unpaid":"لم يتم الدفع","reservations.create.actions.submit":"💾 إنشاء الحجز","reservations.section.title":"📅 إدارة الحجوزات","reservations.crew.none":"لم يتم اختيار أي عضو من الطاقم.","reservations.crew.noneShort":"لم يتم اختيار أي عضو بعد","reservations.crew.selectedCount":"تم اختيار {count} عضو","reservations.crew.fallbackName":"عضو الطاقم {id}","reservations.crew.removeAria":"إزالة","reservations.crew.searchEmpty":"لا يوجد نتائج مطابقة.","reservations.create.equipment.noResults":"لا يوجد نتائج مطابقة.","reservations.create.equipment.noneAdded":"لا توجد معدات مضافة","reservations.create.equipment.none":"لا توجد معدات","reservations.create.summary.currency":"ريال","reservations.create.equipment.imageAlt":"صورة","reservations.summary.total":"💰 التكلفة الإجمالية: <strong>{total} {currency}</strong>","reservations.summary.totalAfterEdit":"💰 التكلفة بعد التعديل: <strong>{total} {currency}</strong>","reservations.summary.itemsCount":"📦 عدد المعدات: {count}","reservations.summary.crewCount":"😎 عدد الفريق: {count}","reservations.summary.taxIncluded":"شامل الضريبة 15%","reservations.summary.taxExcluded":"غير شامل الضريبة","reservations.summary.paymentLabel":"💳 حالة الدفع: {status}","reservations.toast.customerNotFound":"⚠️ لم يتم العثور على العميل بالاسم المدخل","reservations.toast.invalidDateOrder":"⚠️ تاريخ البداية لا يمكن أن يكون بعد تاريخ النهاية","reservations.toast.reservationMissing":"⚠️ تعذر العثور على الحجز المطلوب","reservations.list.title":"📋 حجوزاتي","reservations.list.search.placeholder":"🔍 ابحث باسم العميل أو الكود...","reservations.list.filters.start":"📅 من تاريخ","reservations.list.filters.end":"📅 إلى تاريخ","reservations.list.filters.range.all":"⏱️ كل التواريخ","reservations.list.filters.range.today":"📅 اليوم","reservations.list.filters.range.week":"📆 هذا الأسبوع","reservations.list.filters.range.month":"🗓️ هذا الشهر","reservations.list.filters.status.all":"⚙️ كل الحالات","reservations.list.filters.status.confirmed":"✅ مؤكدة","reservations.list.filters.status.pending":"⏳ غير مؤكدة","reservations.list.filters.status.completed":"📁 منتهية","reservations.list.empty":"⚠️ لا توجد حجوزات بعد.","reservations.list.noResults":"🔍 لا توجد حجوزات مطابقة للبحث.","reservations.list.taxIncludedShort":"(شامل الضريبة)","reservations.list.unknownCustomer":"غير معروف","reservations.list.noNotes":"لا توجد ملاحظات","reservations.list.project.unlinked":"غير مرتبط بمشروع","reservations.list.itemsCountShort":"{count} عنصر","reservations.list.crew.separator":"، ","reservations.list.status.confirmed":"✅ مؤكد","reservations.list.status.pending":"⏳ غير مؤكد","reservations.list.payment.paid":"💳 مدفوع","reservations.list.payment.unpaid":"💳 غير مدفوع","reservations.list.status.completed":"📁 منتهي","reservations.list.ribbon.completed":"منتهي","reservations.list.actions.confirm":"✔️ تأكيد","reservations.list.labels.client":"👤 العميل","reservations.list.labels.project":"📁 المشروع","reservations.edit.modalTitle":"✏️ تعديل الحجز","reservations.edit.labels.id":"🆔 رقم الحجز","reservations.edit.labels.customer":"👤 العميل","reservations.edit.labels.project":"📁 المشروع المرتبط","reservations.edit.labels.startDate":"📅 تاريخ البداية","reservations.edit.labels.startTime":"⏰ وقت البداية","reservations.edit.labels.endDate":"📅 تاريخ النهاية","reservations.edit.labels.endTime":"⏰ وقت النهاية","reservations.edit.labels.discount":"💵 الخصم","reservations.edit.placeholders.discount":"ادخل قيمة الخصم","reservations.edit.discount.percent":"٪ نسبة","reservations.edit.discount.amount":"💵 مبلغ","reservations.edit.labels.tax":"شامل الضريبة (15%)","reservations.edit.labels.confirmed":"✅ تم التأكيد","reservations.edit.labels.paymentStatus":"💳 حالة الدفع","reservations.edit.payment.paid":"مدفوع","reservations.edit.payment.unpaid":"لم يتم الدفع","reservations.edit.labels.notes":"📝 الملاحظات","reservations.edit.placeholders.notes":"اكتب أي ملاحظات...","reservations.edit.labels.addEquipment":"🎥 إضافة معدة","reservations.edit.project.missing":"⚠️ المشروع غير متوفر (تم حذفه)","reservations.edit.placeholders.barcode":"🔍 امسح أو أدخل الباركود ثم اضغط Enter","reservations.edit.placeholders.description":"🎥 اكتب اسم المعدة ثم اضغط Enter","reservations.edit.table.headers.code":"الكود","reservations.edit.table.headers.description":"الوصف","reservations.edit.table.headers.price":"السعر","reservations.edit.table.headers.quantity":"الكمية","reservations.edit.table.headers.image":"الصورة","reservations.edit.table.headers.delete":"حذف","reservations.edit.table.empty":"لا توجد معدات","reservations.edit.actions.save":"💾 حفظ التعديلات","reservations.list.labels.start":"🗓️ بداية الحجز","reservations.list.labels.end":"🗓️ نهاية الحجز","reservations.list.labels.cost":"💵 التكلفة","reservations.list.labels.equipment":"📦 المعدات","reservations.list.labels.crew":"😎 الفريق","reservations.details.labels.discount":"الخصم","reservations.details.labels.subtotalAfterDiscount":"الإجمالي","reservations.details.labels.tax":"الضريبة (15%)","reservations.details.labels.crewTotal":"إجمالي الفريق","reservations.details.table.headers.code":"الكود","reservations.details.table.headers.description":"الوصف","reservations.details.table.headers.quantity":"الكمية","reservations.details.table.headers.price":"السعر","reservations.details.table.headers.image":"الصورة","reservations.details.noItems":"📦 لا توجد معدات ضمن هذا الحجز حالياً.","reservations.details.noCrew":"😎 لا يوجد فريق مرتبط بهذا الحجز.","reservations.details.project.unlinked":"غير مرتبط بأي مشروع.","reservations.details.technicians.roleUnknown":"غير محدد","reservations.details.technicians.phoneUnknown":"غير متوفر","reservations.details.technicians.wage":"{amount} {currency} / اليوم","reservations.details.labels.id":"🆔 رقم الحجز","reservations.details.section.bookingInfo":"بيانات الحجز","reservations.details.section.statusSummary":"ملخص الحالة","reservations.details.section.paymentSummary":"💳 ملخص الدفع","reservations.details.labels.finalTotal":"المجموع النهائي","reservations.details.section.crew":"😎 الفريق الفني","reservations.details.crew.count":"{count} عضو","reservations.details.section.items":"📦 المعدات المرتبطة","reservations.details.items.count":"{count} عنصر","reservations.details.actions.edit":"✏️ تعديل","reservations.details.actions.delete":"🗑️ حذف","reservations.details.actions.openProject":"📁 فتح المشروع","reservations.details.labels.customer":"العميل","reservations.details.labels.contact":"رقم التواصل","reservations.details.labels.project":"📁 المشروع المرتبط","reservations.details.labels.start":"بداية الحجز","reservations.details.labels.end":"نهاية الحجز","reservations.details.labels.notes":"ملاحظات","reservations.details.labels.itemsCount":"عدد المعدات","reservations.details.labels.itemsTotal":"إجمالي المعدات","reservations.details.labels.paymentStatus":"حالة الدفع","reservations.details.modalTitle":"📋 تفاصيل الحجز","reservations.calendar.title":"📅 التقويم","reservations.reports.title":"📊 تقارير الأداء","reservations.reports.subtitle":"نظرة شاملة على الحجوزات والإيرادات ونسب الإشغال خلال الفترة المحددة.","reservations.reports.filters.rangeLabel":"الفترة","reservations.reports.filters.range.last30":"آخر 30 يوم","reservations.reports.filters.range.thisWeek":"هذا الأسبوع","reservations.reports.filters.range.thisMonth":"هذا الشهر","reservations.reports.filters.range.thisQuarter":"هذا الربع","reservations.reports.filters.range.thisYear":"هذا العام","reservations.reports.filters.range.all":"كل الوقت","reservations.reports.filters.range.custom":"مخصص","reservations.reports.filters.startLabel":"من","reservations.reports.filters.endLabel":"إلى","reservations.reports.filters.statusLabel":"الحالة","reservations.reports.filters.status.all":"كل الحالات","reservations.reports.filters.status.confirmed":"مؤكدة","reservations.reports.filters.status.pending":"قيد التأكيد","reservations.reports.filters.status.completed":"منتهية","reservations.reports.filters.paymentLabel":"الدفع","reservations.reports.filters.payment.all":"الكل","reservations.reports.filters.payment.paid":"مدفوعة","reservations.reports.filters.payment.unpaid":"غير مدفوعة","reservations.reports.filters.searchLabel":"البحث","reservations.reports.filters.searchPlaceholder":"ابحث باسم العميل، رقم الحجز، أو المعدة...","reservations.reports.actions.refresh":"🔄 تحديث","reservations.reports.kpi.total.label":"إجمالي الحجوزات","reservations.reports.kpi.total.meta":"لم يتم تسجيل بيانات بعد","reservations.reports.kpi.revenue.label":"إجمالي الإيرادات","reservations.reports.kpi.revenue.meta":"متوسط الحجز —","reservations.reports.kpi.confirmation.label":"معدل التأكيد","reservations.reports.kpi.confirmation.meta":"الحجوزات المؤكدة —","reservations.reports.kpi.paid.label":"نسبة المدفوع","reservations.reports.kpi.paid.meta":"الحجوزات المدفوعة —","reservations.reports.kpi.total.dynamicMeta":"منها {count} منتهية","reservations.reports.kpi.revenue.average":"متوسط قيمة الحجز {value}","reservations.reports.kpi.confirmed.detail":"{count} حجوزات مؤكدة","reservations.reports.kpi.paid.detail":"{count} حجوزات مدفوعة","reservations.reports.status.confirmedLabel":"مؤكدة","reservations.reports.status.pendingLabel":"قيد التأكيد","reservations.reports.status.completedLabel":"منتهية","reservations.reports.payment.paidLabel":"مدفوعة","reservations.reports.payment.unpaidLabel":"غير مدفوعة","reservations.reports.progress.empty":"لا توجد بيانات لعرضها.","reservations.reports.progress.meta":"{count} حجز","reservations.reports.chart.volume.title":"📈 تطور الحجوزات","reservations.reports.chart.volume.hint":"آخر 6 أشهر","reservations.reports.chart.status.title":"📊 توزيع الحالات والدفع","reservations.reports.chart.status.hint":"نسب مئوية","reservations.reports.chart.status.statusLabel":"الحالات","reservations.reports.chart.status.paymentLabel":"الدفع","reservations.reports.topCustomers.title":"👥 أفضل العملاء","reservations.reports.topCustomers.hint":"حسب إجمالي الإيراد","reservations.reports.topCustomers.headers.customer":"العميل","reservations.reports.topCustomers.headers.count":"عدد الحجوزات","reservations.reports.topCustomers.headers.revenue":"الإيراد الكلي","reservations.reports.topCustomers.unknown":"عميل غير معروف","reservations.reports.table.empty":"لا توجد بيانات","reservations.reports.table.emptyPeriod":"لا توجد بيانات في هذه الفترة.","reservations.reports.results.title":"📄 تفاصيل الحجوزات","reservations.reports.results.hint":"أحدث الحجوزات المطابقة لعوامل التصفية","reservations.reports.results.headers.id":"الحجز","reservations.reports.results.headers.customer":"العميل","reservations.reports.results.headers.date":"التاريخ","reservations.reports.results.headers.status":"الحالة","reservations.reports.results.headers.payment":"الدفع","reservations.reports.results.headers.total":"الإجمالي","reservations.reports.topEquipment.title":"🎥 المعدات الأكثر استخدامًا","reservations.reports.topEquipment.hint":"عدد مرات الحجز","reservations.reports.topEquipment.headers.item":"المعدة","reservations.reports.topEquipment.headers.usage":"عدد مرات الاستخدام","reservations.reports.topEquipment.headers.revenue":"الإيراد المرتبط","reservations.reports.topEquipment.unknown":"معدة بدون اسم","reservations.reports.empty.title":"لا توجد بيانات ضمن المعايير الحالية","reservations.reports.empty.subtitle":"جرّب تغيير الفترة الزمنية أو إزالة عوامل التصفية لعرض نتائج أخرى.","calendar.buttons.today":"اليوم","calendar.buttons.month":"شهر","calendar.buttons.week":"أسبوع","calendar.buttons.day":"يوم","calendar.badges.confirmed":"مؤكد","calendar.badges.pending":"غير مؤكد","calendar.badges.paid":"مدفوع","calendar.badges.unpaid":"غير مدفوع","calendar.badges.completed":"منتهي","calendar.labels.unknownCustomer":"غير معروف","calendar.labels.unknownEquipment":"معدة بدون اسم","calendar.labels.currencySuffix":"ريال","calendar.labels.noEquipment":"لا توجد معدات","calendar.labels.noNotes":"لا توجد ملاحظات","calendar.labels.reservationId":"رقم الحجز","calendar.labels.customer":"العميل","calendar.labels.start":"بداية الحجز","calendar.labels.end":"نهاية الحجز","calendar.labels.notes":"الملاحظات","calendar.sections.crew":"😎 الفريق الفني","calendar.sections.equipment":"📦 المعدات","calendar.emptyStates.noCrew":"😎 لا يوجد فريق مرتبط بهذا الحجز.","calendar.table.headers.barcode":"الباركود","calendar.table.headers.description":"الوصف","calendar.table.headers.quantity":"الكمية","calendar.table.headers.price":"السعر","calendar.table.headers.image":"الصورة","calendar.summary.baseCost":"💵 إجمالي المعدات: <strong>{value} ريال</strong>","calendar.summary.discount":"💸 الخصم: <strong>{value}</strong>","calendar.summary.tax":"🧾 الضريبة (15%): <strong>{value} ريال</strong>","calendar.summary.total":"💰 المجموع النهائي: <strong>{value} ريال</strong>","calendar.alerts.cannotShowDetails":"لا يمكن عرض تفاصيل الحجز","calendar.alerts.cannotOpenModal":"لا يمكن فتح نافذة التفاصيل","calendar.modal.title":"📅 تفاصيل الحجز","reservations.toast.equipmentNameNotFound":"❌ لم يتم العثور على معدة بالاسم المدخل","reservations.toast.equipmentMaintenance":"⚠️ هذه المعدة قيد الصيانة ولا يمكن إضافتها حالياً","reservations.toast.equipmentMissingBarcode":"⚠️ هذه المعدة لا تحتوي على باركود معرف","reservations.toast.requireDatesBeforeAdd":"⚠️ يرجى تحديد تاريخ ووقت البداية والنهاية قبل إضافة المعدات","reservations.toast.equipmentDuplicate":"⚠️ هذه المعدة موجودة بالفعل في الحجز","reservations.toast.equipmentTimeConflict":"⚠️ لا يمكن إضافة المعدة لأنها محجوزة في نفس الفترة الزمنية","reservations.toast.equipmentMaintenanceStrict":"⚠️ لا يمكن إضافة معدة قيد الصيانة إلى الحجز","reservations.toast.requireOverallDates":"⚠️ يرجى تحديد تواريخ الحجز قبل إضافة المعدات","reservations.toast.equipmentTimeConflictSimple":"⚠️ هذه المعدة محجوزة في نفس الفترة الزمنية","reservations.toast.barcodeNotFound":"❌ الباركود غير موجود","reservations.toast.equipmentAdded":"✅ تم إضافة المعدة بنجاح","reservations.toast.barcodeNotInCatalog":"❌ الباركود غير موجود ضمن المعدات","reservations.toast.requireDates":"⚠️ يرجى تحديد تاريخ البداية والنهاية","reservations.toast.invalidDateRange":"⚠️ تأكد من أن تاريخ ووقت البداية يسبق تاريخ ووقت النهاية","reservations.toast.missingFields":"⚠️ تأكد من تعبئة جميع الحقول","reservations.toast.noItems":"⚠️ لا يمكنك إنشاء حجز بدون معدات","reservations.toast.cannotCreateEquipmentMaintenance":"⚠️ لا يمكن إتمام الحجز لأن إحدى المعدات قيد الصيانة","reservations.toast.cannotCreateEquipmentConflict":"⚠️ لا يمكن إتمام الحجز، إحدى المعدات محجوزة في نفس الفترة الزمنية","reservations.toast.cannotCreateCrewConflict":"⚠️ لا يمكن إتمام الحجز، أحد أعضاء الطاقم مرتبط بحجز آخر في نفس الفترة","reservations.toast.projectNotFound":"⚠️ لم يتم العثور على المشروع المحدد. يرجى تحديث الصفحة أو اختيار مشروع آخر.","reservations.toast.technicianSelectionConflict":"⚠️ لا يمكن اختيار {names} لأنهم مرتبطون بحجز آخر في نفس الفترة الزمنية","reservations.toast.created":"✅ تم إنشاء الحجز","reservations.toast.notFound":"⚠️ تعذر العثور على بيانات الحجز","reservations.toast.updateNoItems":"⚠️ لا يمكن حفظ التعديلات لعدم وجود معدات","reservations.toast.updateEquipmentMaintenance":"⚠️ لا يمكن حفظ التعديلات لأن إحدى المعدات قيد الصيانة","reservations.toast.updateEquipmentConflict":"⚠️ لا يمكن حفظ التعديلات بسبب تعارض في أحد المعدات","reservations.toast.updateCrewConflict":"⚠️ لا يمكن حفظ التعديلات بسبب تعارض في جدول أحد أعضاء الطاقم","reservations.toast.updated":"✅ تم حفظ التعديلات على الحجز","reservations.toast.confirmed":"✅ تم تأكيد الحجز","reservations.toast.deleteConfirm":"⚠️ هل أنت متأكد من حذف هذا الحجز؟","maintenance.section.title":"🛠️ إدارة الصيانة","maintenance.form.title":"➕ إنشاء تذكرة صيانة","maintenance.form.hint":"حدد المعدة المتضررة وسجّل المشكلة لإيقافها عن الاستخدام لحين الإصلاح.","maintenance.form.labels.barcode":"🏷️ الباركود","maintenance.form.placeholders.barcode":"🖨️ امسح أو أدخل الباركود ثم اضغط Enter","maintenance.form.labels.search":"🎥 البحث باسم المعدة","maintenance.form.placeholders.search":"اكتب اسم المعدة...","maintenance.form.labels.priority":"⚠️ الأولوية","maintenance.form.options.priority.high":"مرتفعة","maintenance.form.options.priority.medium":"متوسطة","maintenance.form.options.priority.low":"منخفضة","maintenance.form.selectedInfo":"لم يتم اختيار معدة بعد.","maintenance.form.labels.issue":"📝 وصف المشكلة","maintenance.form.placeholders.issue":"اشرح المشكلة أو الأعراض الظاهرة للمعدة","maintenance.form.actions.submit":"🛠️ إنشاء التذكرة","maintenance.form.blockedSuffix":"(صيانة)","maintenance.list.title":"📋 تذاكر الصيانة","maintenance.list.hint":"تابع حالة الأعطال وقم بإغلاق التذاكر بعد إتمام الإصلاح.","maintenance.filters.status.label":"الحالة","maintenance.filters.status.all":"كل الحالات","maintenance.filters.status.open":"قيد الصيانة","maintenance.filters.status.closed":"مغلقة","maintenance.table.headers.equipment":"المعدة","maintenance.table.headers.issue":"وصف المشكلة","maintenance.table.headers.priority":"الأولوية","maintenance.table.headers.created":"تاريخ الإنشاء","maintenance.table.headers.status":"الحالة","maintenance.table.headers.actions":"الإجراءات","maintenance.table.empty":"لا توجد تذاكر بعد.","maintenance.table.emptyFiltered":"لا توجد تذاكر ضمن هذا الفلتر.","maintenance.table.noName":"بدون اسم","maintenance.empty.title":"لا توجد تذاكر صيانة","maintenance.empty.subtitle":"عند إنشاء تذكرة جديدة ستظهر في هذه القائمة.","maintenance.table.noBarcode":"بدون باركود","maintenance.stats.open":"{count} قيد الصيانة","maintenance.stats.closed":"{count} مغلقة","maintenance.stats.total":"{count} إجمالي التذاكر","maintenance.status.open":"قيد الصيانة","maintenance.status.closed":"مغلقة","maintenance.priority.high":"مرتفعة","maintenance.priority.medium":"متوسطة","maintenance.priority.low":"منخفضة","maintenance.actions.close":"🔧 إغلاق بعد الإصلاح","maintenance.actions.view":"👁️ عرض التقرير","maintenance.actions.delete":"🗑️ حذف التذكرة","maintenance.toast.equipmentBlocked":"⚠️ هذه المعدة قيد الصيانة ولا يمكن اختيارها حالياً","maintenance.toast.equipmentNotFoundBarcode":"❌ لم يتم العثور على معدة بهذا الباركود","maintenance.toast.equipmentNotFoundName":"❌ لم يتم العثور على معدة بالاسم المدخل","maintenance.toast.equipmentBecameBlocked":"⚠️ هذه المعدة أصبحت قيد الصيانة ولا يمكن اختيارها","maintenance.toast.selectEquipment":"⚠️ يرجى اختيار المعدة","maintenance.toast.selectedNotFound":"❌ لم يتم العثور على المعدة المختارة","maintenance.toast.equipmentAlreadyMaintenance":"⚠️ هذه المعدة بالفعل في حالة صيانة","maintenance.toast.ticketExists":"⚠️ توجد تذكرة صيانة مفتوحة لهذه المعدة","maintenance.toast.ticketCreated":"🛠️ تم إنشاء تذكرة الصيانة وإيقاف المعدة","maintenance.toast.storageError":"⚠️ تعذر حفظ بيانات الصيانة. يرجى المحاولة مجدداً.","maintenance.toast.submitError":"⚠️ تعذر إنشاء تذكرة الصيانة. يرجى المحاولة مجدداً.","maintenance.toast.ticketClosed":"✅ تم إغلاق تذكرة الصيانة وإعادة المعدة إلى الحالة المتاحة","maintenance.toast.ticketDeleted":"🗑️ تم حذف تذكرة الصيانة","maintenance.toast.ticketDeleteConfirm":"⚠️ هل أنت متأكد من حذف تذكرة الصيانة؟","maintenance.prompt.closeReport":"أدخل تقرير الإصلاح / الإجراءات المتخذة:","maintenance.report.equipment":"المعدة","maintenance.report.barcode":"الباركود","maintenance.report.issue":"الوصف","maintenance.report.createdAt":"تاريخ الإنشاء","maintenance.report.closedAt":"تاريخ الإغلاق","maintenance.report.summary":"التقرير","maintenance.report.notAvailable":"غير متوفر","maintenance.report.none":"—","maintenance.info.barcodeLabel":"باركود","technicians.section.title":"😎 إدارة طاقم العمل","technicians.form.title":"📝 إضافة / تعديل عضو طاقم","technicians.form.hint":"أدخل بيانات عضو الطاقم ليتم حفظها وتحديثها في سجلات الحجز.","technicians.form.labels.name":"😎 اسم العضو","technicians.form.labels.phone":"📞 الجوال","technicians.form.labels.role":"👔 الوظيفة","technicians.form.labels.department":"🧩 القسم","technicians.form.labels.wage":"💰 الأجر اليومي","technicians.form.labels.status":"⚙️ الحالة الأساسية","technicians.form.labels.notes":"📝 ملاحظات","technicians.form.placeholders.name":"اسم عضو الطاقم","technicians.form.placeholders.phone":"05xxxxxxxx","technicians.form.placeholders.role":"مثال: مصور","technicians.form.placeholders.department":"مثال: قسم الصوت","technicians.form.placeholders.wage":"0","technicians.form.placeholders.notes":"معلومات إضافية","technicians.form.actions.cancel":"إلغاء التعديل","technicians.form.actions.submit":"➕ إضافة عضو طاقم","technicians.form.actions.update":"💾 حفظ التعديل","technicians.picker.selectedLabel":"😎 طاقم العمل المشارك","technicians.picker.openButton":"➕ اختيار الطاقم","technicians.picker.editButton":"🔁 تعديل الطاقم","technicians.picker.modalTitle":"😎 اختيار طاقم العمل","technicians.picker.actions.apply":"تم","technicians.form.options.available":"✅ متاح","technicians.form.options.busy":"⛔ مشغول","technicians.search.placeholder":"🔍 ابحث عن عضو الطاقم بالاسم أو الجوال أو الوظيفة...","technicians.search.filters.allRoles":"👔 كل الوظائف","technicians.table.empty":"لا يوجد أعضاء في الطاقم بعد.","technicians.table.loading":"جاري التحميل...","technicians.table.headers.name":"😎 اسم العضو","technicians.table.headers.phone":"📞 الجوال","technicians.table.headers.role":"👔 الوظيفة","technicians.table.headers.department":"🧩 القسم","technicians.table.headers.wage":"💰 الأجر اليومي","technicians.table.headers.status":"⚙️ الحالة","technicians.table.headers.notes":"📝 ملاحظات","technicians.table.headers.actions":"⚙️ الإجراءات","technicians.status.available":"✅ متاح","technicians.status.busy":"⛔ مشغول","technicians.table.wageSuffix":"ريال","technicians.actions.edit":"✏️ تعديل","technicians.actions.delete":"🗑️ حذف","technicians.toast.missingName":"⚠️ يرجى إدخال اسم عضو الطاقم","technicians.toast.missingPhone":"⚠️ يرجى إدخال رقم التواصل","technicians.toast.missingRole":"⚠️ يرجى إدخال الوظيفة","technicians.toast.invalidWage":"⚠️ أدخل قيمة صحيحة للأجر اليومي","technicians.toast.addSuccess":"✅ تم إضافة عضو الطاقم","technicians.toast.updateSuccess":"💾 تم حفظ بيانات عضو الطاقم","technicians.toast.notFound":"⚠️ تعذر العثور على عضو الطاقم المطلوب","technicians.toast.unidentified":"⚠️ تعذر تحديد عضو الطاقم المطلوب","technicians.toast.dataNotFound":"⚠️ تعذر العثور على بيانات عضو الطاقم","technicians.toast.editReady":"✏️ يمكنك تعديل بيانات عضو الطاقم الآن ثم الضغط على حفظ التعديل","technicians.toast.deleteConfirm":"⚠️ هل أنت متأكد من حذف هذا العضو؟","technicians.toast.deleteSuccess":"🗑️ تم حذف عضو الطاقم"},en:{"dashboard.header.greeting":"👋 Welcome to the Dashboard","tabs.customers":"👤 Clients","tabs.equipment":"🎥 Equipment","tabs.maintenance":"🛠️ Maintenance","tabs.technicians":"😎 Crew","tabs.reservations":"📅 Reservations","actions.close":"Close","actions.cancel":"Cancel","actions.goHome":"🏠 Home","customers.section.title":"📋 Client Management","customers.form.title":"📋 Add / Edit Client","customers.form.hint":"Update client details and they will sync with bookings and invoices.","customers.form.labels.name":"👤 Client","customers.form.labels.phone":"📞 Phone","customers.form.labels.email":"📧 Email","customers.form.labels.address":"📍 Address","customers.form.labels.company":"🏢 Company","customers.form.labels.notes":"📝 Notes","customers.form.placeholders.name":"Client name","customers.form.placeholders.phone":"05xxxxxxxx","customers.form.placeholders.email":"name@email.com","customers.form.placeholders.address":"Client address","customers.form.placeholders.company":"Company name","customers.form.placeholders.notes":"Additional info or reminders","customers.form.actions.cancel":"Cancel edit","customers.form.actions.submit":"➕ Add Client","customers.form.actions.update":"💾 Update Client","customers.search.placeholder":"🔍 Search by name, phone, or company...","customers.table.headers.name":"👤 Client","customers.table.headers.phone":"📞 Phone","customers.table.headers.company":"🏢 Company","customers.table.headers.notes":"📝 Notes","customers.table.headers.actions":"⚙️ Actions","customers.table.loading":"Loading...","customers.table.empty":"No clients found","customers.table.noResults":"No matching results","customers.actions.edit":"✏️ Edit","customers.actions.delete":"🗑️ Delete","customers.toast.updateSuccess":"Client updated successfully","customers.toast.createSuccess":"Client added successfully","customers.toast.missingFields":"Please fill in the name and phone number","customers.toast.deleteConfirm":"⚠️ Are you sure you want to delete this client?","customers.toast.deleteSuccess":"Client removed","equipment.section.title":"🎥 Equipment Management","equipment.actions.clearAll":"🗑️ Clear All","equipment.actions.uploadExcel":"📤 Import from Excel","equipment.form.title":"🎥 Add Equipment","equipment.form.hint":"Enter equipment details to store them in the catalog.","equipment.form.labels.description":"📝 Description","equipment.form.placeholders.description":"Equipment description","equipment.form.labels.barcode":"🏷️ Barcode","equipment.form.placeholders.barcode":"Barcode","equipment.form.labels.price":"💵 Price","equipment.form.placeholders.price":"0","equipment.form.labels.quantity":"🔢 Quantity","equipment.form.placeholders.quantity":"1","equipment.form.labels.image":"🖼️ Image URL","equipment.form.placeholders.image":"https://...","equipment.form.labels.category":"📂 Category","equipment.form.placeholders.category":"Category","equipment.form.labels.subcategory":"📑 Subcategory","equipment.form.placeholders.subcategory":"Subcategory","equipment.form.labels.status":"⚙️ Status","equipment.form.options.available":"✅ Available","equipment.form.options.booked":"📌 Booked","equipment.form.options.maintenance":"🛠️ Maintenance","equipment.form.actions.submit":"➕ Add Equipment","equipment.filters.search":"🔍 Search equipment...","equipment.filters.status.all":"⚙️ All statuses","equipment.filters.category.all":"📂 All categories","equipment.filters.subcategory.all":"📑 All subcategories","equipment.list.title":"📋 All Equipment","equipment.modal.title":"✏️ Edit Equipment","equipment.modal.placeholders.image":"Paste a direct image link","equipment.modal.actions.cancel":"❌ Cancel","equipment.modal.actions.save":"💾 Save Changes","equipment.toast.xlsxMissing":"⚠️ Excel library (XLSX) is not loaded. Check dashboard.html links","equipment.toast.uploadSuccess":"✅ Equipment imported successfully","equipment.toast.uploadEmpty":"⚠️ The file did not contain any rows to import","equipment.toast.uploadFailed":"❌ Something went wrong while reading the Excel file","equipment.toast.clearConfirm":"⚠️ Are you sure you want to delete all equipment?","equipment.toast.clearSuccess":"🗑️ All equipment cleared","equipment.toast.deleteConfirm":"❌ Are you sure you want to delete this equipment item?","equipment.toast.deleteSuccess":"🗑️ Equipment item deleted","equipment.toast.editSuccess":"✏️ Equipment updated","equipment.toast.addSuccess":"✅ Equipment added","equipment.toast.updateSuccess":"✅ Equipment updated successfully","equipment.toast.missingFields":"⚠️ Please enter the description and barcode","equipment.toast.duplicateBarcode":"⚠️ This barcode is already in use","equipment.list.emptyFiltered":"⚠️ No matching equipment.","equipment.list.countSuffix":"item(s)","equipment.item.imageAlt":"Image","equipment.item.currency":"SAR","equipment.item.actions.edit":"✏️ Edit","equipment.item.actions.delete":"🗑️ Delete","reservations.tabs.create":"➕ Create Reservation","reservations.tabs.mine":"📋 My Reservations","reservations.tabs.reports":"📊 Reports","reservations.tabs.calendar":"📅 Calendar","reservations.create.title":"➕ Create New Reservation","reservations.create.labels.startDate":"📅 Start date","reservations.create.labels.startTime":"⏰ Start time","reservations.create.labels.endDate":"📅 End date","reservations.create.labels.endTime":"⏰ End time","reservations.create.labels.client":"👤 Client","reservations.create.placeholders.client":"Type client name...","reservations.create.labels.project":"📁 Linked project","reservations.create.placeholders.project":"Select a project (optional)","reservations.create.labels.notes":"📝 Notes","reservations.create.placeholders.notes":"Add any additional notes...","reservations.create.equipment.title":"🎥 Add Equipment","reservations.create.equipment.placeholders.barcode":"🔍 Scan or enter a barcode then press Enter","reservations.create.equipment.placeholders.description":"🎥 Type the equipment name then press Enter","reservations.create.equipment.table.code":"Code","reservations.create.equipment.table.description":"Description","reservations.create.equipment.table.price":"Price","reservations.create.equipment.table.image":"Image","reservations.create.equipment.table.delete":"Delete","reservations.create.billing.title":"💵 Discount & Tax","reservations.create.billing.discount":"Enter discount value","reservations.create.billing.discountPercent":"% Percent","reservations.create.billing.discountAmount":"💵 Amount","reservations.create.billing.taxLabel":"Include VAT (15%)","reservations.create.labels.paymentStatus":"💳 Payment status","reservations.create.paymentStatus.paid":"Paid","reservations.create.paymentStatus.unpaid":"Unpaid","reservations.create.actions.submit":"💾 Create reservation","reservations.section.title":"📅 Reservation Management","reservations.crew.none":"No crew members selected yet.","reservations.crew.noneShort":"No crew members selected","reservations.crew.selectedCount":"{count} crew member(s) selected","reservations.crew.fallbackName":"Crew member {id}","reservations.crew.removeAria":"Remove","reservations.crew.searchEmpty":"No matching results.","reservations.create.equipment.noResults":"No matching equipment.","reservations.create.equipment.noneAdded":"No equipment added","reservations.create.equipment.none":"No equipment","reservations.create.summary.currency":"SAR","reservations.create.equipment.imageAlt":"Image","reservations.summary.total":"💰 Total cost: <strong>{total} {currency}</strong>","reservations.summary.totalAfterEdit":"💰 Updated total: <strong>{total} {currency}</strong>","reservations.summary.itemsCount":"📦 Items: {count}","reservations.summary.crewCount":"😎 Crew members: {count}","reservations.summary.taxIncluded":"Includes 15% VAT","reservations.summary.taxExcluded":"VAT not included","reservations.summary.paymentLabel":"💳 Payment status: {status}","reservations.toast.customerNotFound":"⚠️ Customer not found for the entered name","reservations.toast.invalidDateOrder":"⚠️ Start date cannot be after the end date","reservations.toast.reservationMissing":"⚠️ Unable to locate the selected reservation","reservations.list.title":"📋 My Reservations","reservations.list.search.placeholder":"🔍 Search by client name or code...","reservations.list.filters.start":"📅 From date","reservations.list.filters.end":"📅 To date","reservations.list.filters.range.all":"⏱️ All dates","reservations.list.filters.range.today":"📅 Today","reservations.list.filters.range.week":"📆 This week","reservations.list.filters.range.month":"🗓️ This month","reservations.list.filters.status.all":"⚙️ All statuses","reservations.list.filters.status.confirmed":"✅ Confirmed","reservations.list.filters.status.pending":"⏳ Pending","reservations.list.filters.status.completed":"📁 Completed","reservations.list.empty":"⚠️ No reservations yet.","reservations.list.noResults":"🔍 No reservations match the search.","reservations.list.taxIncludedShort":"(Tax included)","reservations.list.unknownCustomer":"Unknown","reservations.list.noNotes":"No notes","reservations.list.project.unlinked":"Not linked to a project","reservations.list.itemsCountShort":"{count} item(s)","reservations.list.crew.separator":", ","reservations.list.status.confirmed":"✅ Confirmed","reservations.list.status.pending":"⏳ Pending","reservations.list.payment.paid":"💳 Paid","reservations.list.payment.unpaid":"💳 Unpaid","reservations.list.status.completed":"📁 Completed","reservations.list.ribbon.completed":"Completed","reservations.list.actions.confirm":"✔️ Confirm","reservations.list.labels.client":"👤 Client","reservations.list.labels.project":"📁 Project","reservations.edit.modalTitle":"✏️ Edit Reservation","reservations.edit.labels.id":"🆔 Reservation ID","reservations.edit.labels.customer":"👤 Customer","reservations.edit.labels.project":"📁 Linked project","reservations.edit.labels.startDate":"📅 Start date","reservations.edit.labels.startTime":"⏰ Start time","reservations.edit.labels.endDate":"📅 End date","reservations.edit.labels.endTime":"⏰ End time","reservations.edit.labels.discount":"💵 Discount","reservations.edit.placeholders.discount":"Enter discount value","reservations.edit.discount.percent":"% Percent","reservations.edit.discount.amount":"💵 Amount","reservations.edit.labels.tax":"Include VAT (15%)","reservations.edit.labels.confirmed":"✅ Confirmed","reservations.edit.labels.paymentStatus":"💳 Payment status","reservations.edit.payment.paid":"Paid","reservations.edit.payment.unpaid":"Unpaid","reservations.edit.labels.notes":"📝 Notes","reservations.edit.placeholders.notes":"Add any notes...","reservations.edit.labels.addEquipment":"🎥 Add equipment","reservations.edit.project.missing":"⚠️ Project unavailable (deleted)","reservations.edit.placeholders.barcode":"🔍 Scan or enter a barcode then press Enter","reservations.edit.placeholders.description":"🎥 Type the equipment name then press Enter","reservations.edit.table.headers.code":"Code","reservations.edit.table.headers.description":"Description","reservations.edit.table.headers.price":"Price","reservations.edit.table.headers.quantity":"Qty","reservations.edit.table.headers.image":"Image","reservations.edit.table.headers.delete":"Delete","reservations.edit.table.empty":"No equipment","reservations.edit.actions.save":"💾 Save changes","reservations.list.labels.start":"🗓️ Start","reservations.list.labels.end":"🗓️ End","reservations.list.labels.cost":"💵 Cost","reservations.list.labels.equipment":"📦 Equipment","reservations.list.labels.crew":"😎 Crew","reservations.details.labels.discount":"Discount","reservations.details.labels.subtotalAfterDiscount":"Subtotal","reservations.details.labels.tax":"Tax (15%)","reservations.details.labels.crewTotal":"Crew total","reservations.details.table.headers.code":"Code","reservations.details.table.headers.description":"Description","reservations.details.table.headers.quantity":"Qty","reservations.details.table.headers.price":"Price","reservations.details.table.headers.image":"Image","reservations.details.noItems":"📦 No equipment is linked to this reservation yet.","reservations.details.noCrew":"😎 No crew assigned to this reservation.","reservations.details.project.unlinked":"Not linked to any project.","reservations.details.technicians.roleUnknown":"Not specified","reservations.details.technicians.phoneUnknown":"Not available","reservations.details.technicians.wage":"{amount} {currency} / day","reservations.details.labels.id":"🆔 Reservation ID","reservations.details.section.bookingInfo":"Booking details","reservations.details.section.statusSummary":"Status summary","reservations.details.section.paymentSummary":"💳 Payment summary","reservations.details.labels.finalTotal":"Final total","reservations.details.section.crew":"😎 Crew members","reservations.details.crew.count":"{count} member(s)","reservations.details.section.items":"📦 Linked equipment","reservations.details.items.count":"{count} item(s)","reservations.details.actions.edit":"✏️ Edit","reservations.details.actions.delete":"🗑️ Delete","reservations.details.actions.openProject":"📁 Open project","reservations.details.labels.customer":"Customer","reservations.details.labels.contact":"Contact","reservations.details.labels.start":"Start","reservations.details.labels.end":"End","reservations.details.labels.notes":"Notes","reservations.details.labels.itemsCount":"Equipment count","reservations.details.labels.itemsTotal":"Equipment total","reservations.details.labels.paymentStatus":"Payment status","reservations.details.modalTitle":"📋 Reservation Details","reservations.calendar.title":"📅 Calendar","reservations.reports.title":"📊 Performance Reports","reservations.reports.subtitle":"A holistic view of reservations, revenue, and utilization for the selected period.","reservations.reports.filters.rangeLabel":"Period","reservations.reports.filters.range.last30":"Last 30 days","reservations.reports.filters.range.thisWeek":"This week","reservations.reports.filters.range.thisMonth":"This month","reservations.reports.filters.range.thisQuarter":"This quarter","reservations.reports.filters.range.thisYear":"This year","reservations.reports.filters.range.all":"All time","reservations.reports.filters.range.custom":"Custom","reservations.reports.filters.startLabel":"From","reservations.reports.filters.endLabel":"To","reservations.reports.filters.statusLabel":"Status","reservations.reports.filters.status.all":"All statuses","reservations.reports.filters.status.confirmed":"Confirmed","reservations.reports.filters.status.pending":"Pending confirmation","reservations.reports.filters.status.completed":"Completed","reservations.reports.filters.paymentLabel":"Payment","reservations.reports.filters.payment.all":"All","reservations.reports.filters.payment.paid":"Paid","reservations.reports.filters.payment.unpaid":"Unpaid","reservations.reports.filters.searchLabel":"Search","reservations.reports.filters.searchPlaceholder":"Search by customer, reservation number, or equipment...","reservations.reports.actions.refresh":"🔄 Refresh","reservations.reports.kpi.total.label":"Total reservations","reservations.reports.kpi.total.meta":"No data recorded yet","reservations.reports.kpi.revenue.label":"Total revenue","reservations.reports.kpi.revenue.meta":"Average reservation —","reservations.reports.kpi.confirmation.label":"Confirmation rate","reservations.reports.kpi.confirmation.meta":"Confirmed reservations —","reservations.reports.kpi.paid.label":"Paid ratio","reservations.reports.kpi.paid.meta":"Paid reservations —","reservations.reports.kpi.total.dynamicMeta":"Includes {count} completed","reservations.reports.kpi.revenue.average":"Average reservation value {value}","reservations.reports.kpi.confirmed.detail":"{count} confirmed reservations","reservations.reports.kpi.paid.detail":"{count} paid reservations","reservations.reports.status.confirmedLabel":"Confirmed","reservations.reports.status.pendingLabel":"Pending confirmation","reservations.reports.status.completedLabel":"Completed","reservations.reports.payment.paidLabel":"Paid","reservations.reports.payment.unpaidLabel":"Unpaid","reservations.reports.progress.empty":"No data to display.","reservations.reports.progress.meta":"{count} reservations","reservations.reports.chart.volume.title":"📈 Reservation trend","reservations.reports.chart.volume.hint":"Last 6 months","reservations.reports.chart.status.title":"📊 Status & payment breakdown","reservations.reports.chart.status.hint":"Percentages","reservations.reports.chart.status.statusLabel":"Status","reservations.reports.chart.status.paymentLabel":"Payment","reservations.reports.topCustomers.title":"👥 Top customers","reservations.reports.topCustomers.hint":"By total revenue","reservations.reports.topCustomers.headers.customer":"Customer","reservations.reports.topCustomers.headers.count":"Reservations","reservations.reports.topCustomers.headers.revenue":"Total revenue","reservations.reports.topCustomers.unknown":"Unknown customer","reservations.reports.table.empty":"No data available","reservations.reports.table.emptyPeriod":"No data for this period.","reservations.reports.results.title":"📄 Reservation Details","reservations.reports.results.hint":"Latest reservations matching the current filters","reservations.reports.results.headers.id":"Reservation","reservations.reports.results.headers.customer":"Customer","reservations.reports.results.headers.date":"Date","reservations.reports.results.headers.status":"Status","reservations.reports.results.headers.payment":"Payment","reservations.reports.results.headers.total":"Total","reservations.reports.topEquipment.title":"🎥 Most used equipment","reservations.reports.topEquipment.hint":"Total bookings","reservations.reports.topEquipment.headers.item":"Equipment","reservations.reports.topEquipment.headers.usage":"Usage count","reservations.reports.topEquipment.headers.revenue":"Linked revenue","reservations.reports.topEquipment.unknown":"Unnamed equipment","reservations.reports.empty.title":"No data matches the current filters","reservations.reports.empty.subtitle":"Try adjusting the date range or removing filters to see more results.","calendar.buttons.today":"Today","calendar.buttons.month":"Month","calendar.buttons.week":"Week","calendar.buttons.day":"Day","calendar.badges.confirmed":"Confirmed","calendar.badges.pending":"Pending","calendar.badges.paid":"Paid","calendar.badges.unpaid":"Unpaid","calendar.badges.completed":"Completed","calendar.labels.unknownCustomer":"Unknown","calendar.labels.unknownEquipment":"Unnamed equipment","calendar.labels.currencySuffix":"SAR","calendar.labels.noEquipment":"No equipment","calendar.labels.noNotes":"No notes","calendar.labels.reservationId":"Reservation ID","calendar.labels.customer":"Customer","calendar.labels.start":"Start","calendar.labels.end":"End","calendar.labels.notes":"Notes","calendar.sections.crew":"😎 Crew members","calendar.sections.equipment":"📦 Equipment","calendar.emptyStates.noCrew":"😎 No crew assigned to this reservation.","calendar.table.headers.barcode":"Barcode","calendar.table.headers.description":"Description","calendar.table.headers.quantity":"Qty","calendar.table.headers.price":"Price","calendar.table.headers.image":"Image","calendar.summary.baseCost":"💵 Equipment subtotal: <strong>{value} SAR</strong>","calendar.summary.discount":"💸 Discount: <strong>{value}</strong>","calendar.summary.tax":"🧾 Tax (15%): <strong>{value} SAR</strong>","calendar.summary.total":"💰 Grand total: <strong>{value} SAR</strong>","calendar.alerts.cannotShowDetails":"Unable to show reservation details","calendar.alerts.cannotOpenModal":"Unable to open details modal","calendar.modal.title":"📅 Reservation Details","reservations.toast.equipmentNameNotFound":"❌ No equipment found with that name","reservations.toast.equipmentMaintenance":"⚠️ This equipment is under maintenance and cannot be added","reservations.toast.equipmentMissingBarcode":"⚠️ This equipment has no barcode assigned","reservations.toast.requireDatesBeforeAdd":"⚠️ Set start and end date/time before adding equipment","reservations.toast.equipmentDuplicate":"⚠️ This equipment is already in the reservation","reservations.toast.equipmentTimeConflict":"⚠️ Cannot add equipment because it is booked in the same period","reservations.toast.equipmentMaintenanceStrict":"⚠️ Cannot add equipment while it is marked for maintenance","reservations.toast.requireOverallDates":"⚠️ Set the reservation dates before adding equipment","reservations.toast.equipmentTimeConflictSimple":"⚠️ This equipment is booked in the same period","reservations.toast.barcodeNotFound":"❌ Barcode not found","reservations.toast.equipmentAdded":"✅ Equipment added successfully","reservations.toast.barcodeNotInCatalog":"❌ Barcode not found in catalog","reservations.toast.requireDates":"⚠️ Please set start and end date","reservations.toast.invalidDateRange":"⚠️ Make sure start time is before end time","reservations.toast.missingFields":"⚠️ Please fill in all required fields","reservations.toast.noItems":"⚠️ You cannot create a reservation without equipment","reservations.toast.cannotCreateEquipmentMaintenance":"⚠️ Cannot create reservation because an item is under maintenance","reservations.toast.cannotCreateEquipmentConflict":"⚠️ Cannot create reservation because an item is already booked","reservations.toast.cannotCreateCrewConflict":"⚠️ Cannot create reservation because a crew member has another booking in that period","reservations.toast.projectNotFound":"⚠️ Selected project was not found. Please refresh the page or choose another project.","reservations.toast.technicianSelectionConflict":"⚠️ Cannot select {names}; they are already booked for the selected time range","reservations.toast.created":"✅ Reservation created","reservations.toast.notFound":"⚠️ Unable to locate reservation data","reservations.toast.updateNoItems":"⚠️ Cannot save changes without equipment","reservations.toast.updateEquipmentMaintenance":"⚠️ Cannot save changes because an item is under maintenance","reservations.toast.updateEquipmentConflict":"⚠️ Cannot save changes because an item conflicts with another booking","reservations.toast.updateCrewConflict":"⚠️ Cannot save changes because a crew member conflicts with another booking","reservations.toast.updated":"✅ Reservation updated","reservations.toast.confirmed":"✅ Reservation confirmed","reservations.toast.deleteConfirm":"⚠️ Are you sure you want to delete this reservation?","maintenance.section.title":"🛠️ Maintenance Management","maintenance.form.title":"➕ Create Maintenance Ticket","maintenance.form.hint":"Select the affected equipment and describe the issue to take it out of service.","maintenance.form.labels.barcode":"🏷️ Barcode","maintenance.form.placeholders.barcode":"🖨️ Scan or enter the barcode, then press Enter","maintenance.form.labels.search":"🎥 Search by equipment name","maintenance.form.placeholders.search":"Type the equipment name...","maintenance.form.labels.priority":"⚠️ Priority","maintenance.form.options.priority.high":"High","maintenance.form.options.priority.medium":"Medium","maintenance.form.options.priority.low":"Low","maintenance.form.selectedInfo":"No equipment selected yet.","maintenance.form.labels.issue":"📝 Issue description","maintenance.form.placeholders.issue":"Describe the issue or symptoms for the equipment","maintenance.form.actions.submit":"🛠️ Create Ticket","maintenance.form.blockedSuffix":"(In maintenance)","maintenance.list.title":"📋 Maintenance Tickets","maintenance.list.hint":"Track issues and close tickets once repairs are completed.","maintenance.filters.status.label":"Status","maintenance.filters.status.all":"All statuses","maintenance.filters.status.open":"In maintenance","maintenance.filters.status.closed":"Closed","maintenance.table.headers.equipment":"Equipment","maintenance.table.headers.issue":"Issue","maintenance.table.headers.priority":"Priority","maintenance.table.headers.created":"Created At","maintenance.table.headers.status":"Status","maintenance.table.headers.actions":"Actions","maintenance.table.empty":"No tickets yet.","maintenance.table.emptyFiltered":"No tickets match this filter.","maintenance.table.noName":"No name","maintenance.empty.title":"No maintenance tickets","maintenance.empty.subtitle":"Once you create a new ticket it will appear here.","maintenance.table.noBarcode":"No barcode","maintenance.stats.open":"{count} in maintenance","maintenance.stats.closed":"{count} closed","maintenance.stats.total":"{count} total tickets","maintenance.status.open":"In maintenance","maintenance.status.closed":"Closed","maintenance.priority.high":"High","maintenance.priority.medium":"Medium","maintenance.priority.low":"Low","maintenance.actions.close":"🔧 Close after repair","maintenance.actions.view":"👁️ View report","maintenance.actions.delete":"🗑️ Delete ticket","maintenance.toast.equipmentBlocked":"⚠️ This equipment is already under maintenance and can’t be selected","maintenance.toast.equipmentNotFoundBarcode":"❌ No equipment found with this barcode","maintenance.toast.equipmentNotFoundName":"❌ No equipment found with that name","maintenance.toast.equipmentBecameBlocked":"⚠️ This equipment is now under maintenance and can’t be selected","maintenance.toast.selectEquipment":"⚠️ Please select equipment","maintenance.toast.selectedNotFound":"❌ Selected equipment was not found","maintenance.toast.equipmentAlreadyMaintenance":"⚠️ This equipment is already marked as in maintenance","maintenance.toast.ticketExists":"⚠️ There is already an open maintenance ticket for this equipment","maintenance.toast.ticketCreated":"🛠️ Maintenance ticket created and equipment removed from service","maintenance.toast.storageError":"⚠️ Could not save maintenance data. Please try again.","maintenance.toast.submitError":"⚠️ Could not create the maintenance ticket. Please try again.","maintenance.toast.ticketClosed":"✅ Maintenance ticket closed and equipment set to available","maintenance.toast.ticketDeleted":"🗑️ Maintenance ticket deleted","maintenance.toast.ticketDeleteConfirm":"⚠️ Are you sure you want to delete this maintenance ticket?","maintenance.prompt.closeReport":"Enter repair report / actions taken:","maintenance.report.equipment":"Equipment","maintenance.report.barcode":"Barcode","maintenance.report.issue":"Issue","maintenance.report.createdAt":"Created at","maintenance.report.closedAt":"Closed at","maintenance.report.summary":"Report","maintenance.report.notAvailable":"Not available","maintenance.report.none":"—","maintenance.info.barcodeLabel":"Barcode","technicians.section.title":"😎 Crew Management","technicians.form.title":"📝 Add / Edit Crew Member","technicians.form.hint":"Enter crew member details to save and keep bookings updated.","technicians.form.labels.name":"😎 Crew Member","technicians.form.labels.phone":"📞 Phone","technicians.form.labels.role":"👔 Role","technicians.form.labels.department":"🧩 Department","technicians.form.labels.wage":"💰 Daily Rate","technicians.form.labels.status":"⚙️ Base Status","technicians.form.labels.notes":"📝 Notes","technicians.form.placeholders.name":"Crew member name","technicians.form.placeholders.phone":"05xxxxxxxx","technicians.form.placeholders.role":"e.g. Camera operator","technicians.form.placeholders.department":"e.g. Audio team","technicians.form.placeholders.wage":"0","technicians.form.placeholders.notes":"Additional information","technicians.form.actions.cancel":"Cancel edit","technicians.form.actions.submit":"➕ Add Crew Member","technicians.form.actions.update":"💾 Update Crew Member","technicians.picker.selectedLabel":"😎 Assigned crew","technicians.picker.openButton":"➕ Choose crew","technicians.picker.editButton":"🔁 Edit crew","technicians.picker.modalTitle":"😎 Select crew","technicians.picker.actions.apply":"Done","technicians.form.options.available":"✅ Available","technicians.form.options.busy":"⛔ Busy","technicians.search.placeholder":"🔍 Search crew member by name, phone, or role...","technicians.search.filters.allRoles":"👔 All roles","technicians.table.empty":"No crew members yet.","technicians.table.loading":"Loading...","technicians.table.headers.name":"😎 Crew Member","technicians.table.headers.phone":"📞 Phone","technicians.table.headers.role":"👔 Role","technicians.table.headers.department":"🧩 Department","technicians.table.headers.wage":"💰 Daily Rate","technicians.table.headers.status":"⚙️ Status","technicians.table.headers.notes":"📝 Notes","technicians.table.headers.actions":"⚙️ Actions","technicians.status.available":"✅ Available","technicians.status.busy":"⛔ Busy","technicians.table.wageSuffix":"SAR","technicians.actions.edit":"✏️ Edit","technicians.actions.delete":"🗑️ Delete","technicians.toast.missingName":"⚠️ Please enter the crew member name","technicians.toast.missingPhone":"⚠️ Please enter a contact number","technicians.toast.missingRole":"⚠️ Please enter the role","technicians.toast.invalidWage":"⚠️ Enter a valid daily wage","technicians.toast.addSuccess":"✅ Crew member added","technicians.toast.updateSuccess":"💾 Crew member updated","technicians.toast.notFound":"⚠️ Crew member not found","technicians.toast.unidentified":"⚠️ Unable to identify crew member","technicians.toast.dataNotFound":"⚠️ Crew member details not found","technicians.toast.editReady":"✏️ You can edit the crew member details now then press Save","technicians.toast.deleteConfirm":"⚠️ Are you sure you want to remove this crew member?","technicians.toast.deleteSuccess":"🗑️ Crew member removed"}});let{equipment:z}=A();z=z||[];const Un="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js";let ge=null;function Hn(){return typeof XLSX<"u"?Promise.resolve():typeof window>"u"||typeof document>"u"?Promise.reject(new Error("XLSX library is not available in this environment")):ge||(ge=new Promise((e,t)=>{const n=document.querySelector('script[data-xlsx-loader="true"]');if(n){n.addEventListener("load",i,{once:!0}),n.addEventListener("error",a,{once:!0});return}const s=document.createElement("script");s.src=Un,s.async=!0,s.defer=!0,s.dataset.xlsxLoader="true",s.addEventListener("load",i,{once:!0}),s.addEventListener("error",a,{once:!0}),document.head.appendChild(s);function i(){if(typeof XLSX>"u"){t(new Error("XLSX did not load correctly"));return}e()}function a(){t(new Error("Failed to load XLSX library"))}}).catch(e=>{throw console.warn("⚠️ [equipment.js] ensureXLSXLoaded failed",e),ge=null,e}),ge)}async function Ds(e){if(!e)return;try{await Hn()}catch(n){console.error("❌ [equipment.js] Unable to load XLSX library",n),alert(r("equipment.toast.xlsxMissing","⚠️ مكتبة Excel (XLSX) غير محملة. تحقق من اتصال الإنترنت أو الروابط في dashboard.html"));return}const t=new FileReader;t.onload=function(n){try{const s=new Uint8Array(n.target.result),i=XLSX.read(s,{type:"array"}),a=i.Sheets[i.SheetNames[0]],o=XLSX.utils.sheet_to_json(a);if(!Array.isArray(o)||o.length===0){f(r("equipment.toast.uploadEmpty","⚠️ لم يتم العثور على بيانات في الملف"));return}const l=A().equipment||[];o.forEach(c=>{l.push({category:c.القسم||"",sub:c["القسم الثانوي"]||"",desc:c.الوصف||"",qty:c.الكمية||1,price:c.السعر||0,barcode:g(String(c.الباركود||"")),status:"متاح",image:c.الصورة||""})}),z=l,Y({equipment:l}),f(r("equipment.toast.uploadSuccess","✅ تم رفع المعدات بنجاح")),W()}catch(s){console.error("❌ [equipment.js] Failed to process Excel file",s),f(r("equipment.toast.uploadFailed","❌ حدث خطأ أثناء قراءة ملف الإكسل"))}},t.onerror=function(){console.error("❌ [equipment.js] FileReader encountered an error",t.error),f(r("equipment.toast.uploadFailed","❌ حدث خطأ أثناء قراءة ملف الإكسل"))},t.readAsArrayBuffer(e)}function On(){confirm(r("equipment.toast.clearConfirm","⚠️ هل أنت متأكد من حذف كل المعدات؟"))&&(z=[],Y({equipment:[]}),f(r("equipment.toast.clearSuccess","🗑️ تم مسح جميع المعدات")),W())}function Xn(e){const t=Se();t.push(e),z=t,Y({equipment:t})}function Se(){const{equipment:e}=A();return e||[]}function ne(e){return g(String(e||"")).trim().toLowerCase()}function _n(e,t){if(!(e!=null&&e.start)||!(e!=null&&e.end))return!1;const n=new Date(e.start),s=new Date(e.end);return Number.isNaN(n.getTime())||Number.isNaN(s.getTime())?!1:n<=t&&t<s}function ze(){const e=A();let{equipment:t=[],reservations:n=[],maintenance:s=[]}=e;if(!Array.isArray(t)||t.length===0)return z=t||[],z;const i=new Date;let a=!1;const o=new Set((s||[]).filter(c=>(c==null?void 0:c.status)==="open").map(c=>ne(c==null?void 0:c.equipmentBarcode))),l=t.map(c=>{var h;if(!c)return c;const m=ne(c.barcode),d=m&&o.has(m);let b=d||c.status==="صيانة"?"صيانة":"متاح";if(!d&&m)for(const w of n||[]){if(!_n(w,i))continue;if((h=w.items)==null?void 0:h.some(y=>ne(y==null?void 0:y.barcode)===m)){b="محجوز";break}}return b!==c.status?(a=!0,{...c,status:b}):c});return a?(z=l,Y({equipment:l}),l):(z=l,l)}function zn(e){const t=Se();confirm(r("equipment.toast.deleteConfirm","❌ هل أنت متأكد من حذف هذه المعدة؟"))&&(t.splice(e,1),z=t,Y({equipment:t}),f(r("equipment.toast.deleteSuccess","🗑️ تم حذف المعدة")),W())}function Wn(e,t){const n=Se();n[e]={...n[e],...t},z=n,Y({equipment:n}),f(r("equipment.toast.editSuccess","✏️ تم تعديل بيانات المعدة")),W()}function W(){var h,w,T,y;console.log("✅ renderEquipment تعمل");const e=document.getElementById("equipment-list");if(!e)return;const t=ze(),n=Array.isArray(t)?t:Se(),s=n.map((u,p)=>({item:u,index:p})),i=((h=document.getElementById("search-equipment"))==null?void 0:h.value)||"",a=g(i).toLowerCase().trim(),o=((w=document.getElementById("filter-category"))==null?void 0:w.value)||"",l=((T=document.getElementById("filter-sub"))==null?void 0:T.value)||"",c=((y=document.getElementById("filter-status"))==null?void 0:y.value)||"",d=s.filter(({item:u})=>{const p=ne(u.barcode).toLowerCase(),C=!a||u.name&&u.name.toLowerCase().includes(a)||u.desc&&u.desc.toLowerCase().includes(a)||u.description&&u.description.toLowerCase().includes(a)||p&&p.includes(a)||u.category&&u.category.toLowerCase().includes(a)||u.sub&&u.sub.toLowerCase().includes(a)||u.subcategory&&u.subcategory.toLowerCase().includes(a),I=!o||u.category===o,S=!l||u.sub===l,B=!c||u.status===c;return C&&I&&S&&B}).sort((u,p)=>{const C=ne(u.item.barcode),I=ne(p.item.barcode),S=parseInt(C,10),B=parseInt(I,10),E=!Number.isNaN(S),D=!Number.isNaN(B);return E&&D&&S!==B?S-B:C.localeCompare(I,"ar",{numeric:!0,sensitivity:"base"})}),v=r("equipment.list.emptyFiltered","⚠️ لا توجد معدات مطابقة.");e.innerHTML=d.length?d.map(Yn).join(""):`<em>${v}</em>`;const b=document.getElementById("equipment-list-count");if(b){const u=r("equipment.list.countSuffix","عنصر"),p=g(String(d.length)),C=d.length?`${p} ${u}`:`0 ${u}`;b.textContent=C}Vn(n)}function Vn(e){const t=[...new Set(e.map(a=>a.category).filter(Boolean))],n=[...new Set(e.map(a=>a.sub).filter(Boolean))],s=document.getElementById("filter-category"),i=document.getElementById("filter-sub");if(s){const a=s.value;for(;s.options.length>1;)s.remove(1);t.forEach(o=>{const l=document.createElement("option");l.value=o,l.textContent=o,s.appendChild(l)}),t.includes(a)&&(s.value=a)}if(i){const a=i.value;for(;i.options.length>1;)i.remove(1);n.forEach(o=>{const l=document.createElement("option");l.value=o,l.textContent=o,i.appendChild(l)}),n.includes(a)&&(i.value=a)}}function vt(e){return e.image||e.imageUrl||e.img||""}function Yn({item:e,index:t}){const n=vt(e),s=r("equipment.item.actions.edit","✏️ تعديل"),i=r("equipment.item.actions.delete","🗑️ حذف"),a=r("equipment.item.imageAlt","صورة"),o=r("equipment.item.currency","ريال");return`
    <div class="border-bottom py-3 d-flex align-items-center">
      <div class="equipment-image me-3" style="width:120px;height:120px;">
        ${n?`<img src="${n}" alt="${a}" class="img-fluid rounded" style="width:100%;height:100%;object-fit:cover;">`:'<div class="no-image d-flex align-items-center justify-content-center bg-light rounded" style="width:100%;height:100%;font-size:36px;">📦</div>'}
      </div>

      <div class="flex-grow-1">
        <div><strong>🏷️ ${e.desc||"-"}</strong></div>
        <div class="text-muted">${e.category||"-"} - ${e.sub||"-"}</div>

        <div class="mt-1">
          📦 <strong>${e.qty||0}</strong> | 💵 <strong>${e.price||0}</strong> ${o} | 🔖 ${e.barcode||"-"}
        </div>

        <div class="mt-1">⚙️ ${Gn(e.status)}</div>
      </div>

      <div class="ms-3 d-flex flex-column gap-2">
        <button class="btn btn-sm btn-warning" onclick="editEquipmentModal(${t})">${s}</button>
        <button class="btn btn-sm btn-danger" onclick="deleteEquipment(${t})">${i}</button>
      </div>
    </div>
  `}function Qn(e){var w,T,y,u,p,C,I,S,B,E,D,$;e.preventDefault();const t=e.target,n=((T=(w=t.querySelector("#new-equipment-desc"))==null?void 0:w.value)==null?void 0:T.trim())||"",s=((y=t.querySelector("#new-equipment-barcode"))==null?void 0:y.value)||"",i=g(s).trim(),a=parseFloat(((u=t.querySelector("#new-equipment-price"))==null?void 0:u.value)||"0")||0,o=parseInt(((p=t.querySelector("#new-equipment-qty"))==null?void 0:p.value)||"1",10)||1,l=((I=(C=t.querySelector("#new-equipment-image"))==null?void 0:C.value)==null?void 0:I.trim())||"",c=((B=(S=t.querySelector("#new-equipment-category"))==null?void 0:S.value)==null?void 0:B.trim())||"",m=((D=(E=t.querySelector("#new-equipment-sub"))==null?void 0:E.value)==null?void 0:D.trim())||"",d=(($=t.querySelector("#new-equipment-status"))==null?void 0:$.value)||"متاح";if(!n||!i){f(r("equipment.toast.missingFields","⚠️ يرجى إدخال الوصف والباركود"));return}if(Se().some(L=>ne(L.barcode)===i)){f(r("equipment.toast.duplicateBarcode","⚠️ هذا الباركود مستخدم مسبقًا"));return}const b={id:Date.now(),category:c,sub:m,desc:n,qty:o,price:a,barcode:i,status:d,image:l};Xn(b),f(r("equipment.toast.addSuccess","✅ تم إضافة المعدة")),t.reset();const h=t.querySelector("#new-equipment-status");h&&(h.value="متاح"),W()}function Gn(e){const t=String(e||"").toLowerCase();return t==="available"||e==="متاح"?`<span class="badge bg-success">${r("equipment.form.options.available","✅ متاح")}</span>`:t==="reserved"||e==="محجوز"?`<span class="badge bg-warning text-dark">${r("equipment.form.options.booked","📌 محجوز")}</span>`:t==="maintenance"||e==="صيانة"?`<span class="badge bg-danger">${r("equipment.form.options.maintenance","🛠️ صيانة")}</span>`:`<span class="badge bg-secondary">${e||"-"}</span>`}window.editEquipmentModal=function(e){const{equipment:t}=A(),n=t[e];if(!n)return;document.getElementById("edit-equipment-index").value=e,document.getElementById("edit-equipment-category").value=n.category||"",document.getElementById("edit-equipment-subcategory").value=n.sub||"",document.getElementById("edit-equipment-description").value=n.desc||"",document.getElementById("edit-equipment-quantity").value=n.qty||1,document.getElementById("edit-equipment-price").value=n.price||0,document.getElementById("edit-equipment-barcode").value=n.barcode||"",document.getElementById("edit-equipment-status").value=n.status||"متاح",document.getElementById("edit-equipment-image").value=vt(n)||"",new bootstrap.Modal(document.getElementById("editEquipmentModal")).show()};var at;(at=document.getElementById("save-equipment-changes"))==null||at.addEventListener("click",()=>{const e=document.getElementById("edit-equipment-index").value,t={category:document.getElementById("edit-equipment-category").value,sub:document.getElementById("edit-equipment-subcategory").value,desc:document.getElementById("edit-equipment-description").value,qty:parseInt(document.getElementById("edit-equipment-quantity").value)||1,price:parseFloat(document.getElementById("edit-equipment-price").value)||0,barcode:document.getElementById("edit-equipment-barcode").value,status:document.getElementById("edit-equipment-status").value,image:document.getElementById("edit-equipment-image").value};Wn(e,t),bootstrap.Modal.getInstance(document.getElementById("editEquipmentModal")).hide(),f(r("equipment.toast.updateSuccess","✅ تم تحديث بيانات المعدة بنجاح"))});window.deleteEquipment=zn;window.clearEquipment=On;var rt;(rt=document.getElementById("search-equipment"))==null||rt.addEventListener("input",W);var it;(it=document.getElementById("filter-category"))==null||it.addEventListener("change",W);var ot;(ot=document.getElementById("filter-sub"))==null||ot.addEventListener("change",W);var ct;(ct=document.getElementById("filter-status"))==null||ct.addEventListener("change",W);var lt;(lt=document.getElementById("add-equipment-form"))==null||lt.addEventListener("submit",Qn);document.addEventListener("DOMContentLoaded",W);document.addEventListener("language:changed",W);function Ce(e={}){return e.image||e.imageUrl||e.img||""}function ft(e){if(!e)return null;const t=N(e),{equipment:n=[]}=A();return(n||[]).find(s=>N(s==null?void 0:s.barcode)===t)||null}function ve(e){const t=ft(e);return(t==null?void 0:t.status)==="صيانة"}function Jn(e){const t=N(e);if(!t)return null;const{equipment:n=[]}=A();return(n||[]).find(s=>N(s==null?void 0:s.barcode)===t)||null}function G(e=""){return g(String(e)).trim().toLowerCase()}function qe(e){if(!(e!=null&&e.end))return!1;const t=new Date(e.end);return Number.isNaN(t.getTime())?!1:t<new Date}let Oe=null,bt=[];const Pe="pendingReservationProjectContext";function ht(e){bt=Array.isArray(e)?[...e]:[]}function Kn(){return bt}function We(e){return e&&Kn().find(t=>String(t.id)===String(e))||null}function Fe(e=""){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function ke(e,t,n){if(!n)return;const{date:s,time:i}=pt(n),a=document.getElementById(e),o=document.getElementById(t);a&&s&&(a.value=s,a.dispatchEvent(new Event("input")),a.dispatchEvent(new Event("change"))),o&&i&&(o.value=i,o.dispatchEvent(new Event("input")),o.dispatchEvent(new Event("change")))}function gt(e,{forceNotes:t=!1}={}){if(!e)return;const s=(_e()||[]).find(o=>String(o.id)===String(e.clientId)),i=document.getElementById("res-customer");i&&(s!=null&&s.customerName)&&(i.value=s.customerName),e.start&&ke("res-start","res-start-time",e.start),e.end&&ke("res-end","res-end-time",e.end);const a=document.getElementById("res-notes");a&&e.description&&(t||!a.value)&&(a.value=e.description),Be(),P()}function Ve({projectsList:e=null,preselectId:t=null}={}){const n=document.getElementById("res-project");if(!n)return;const{projects:s}=e?{projects:e}:A(),i=Array.isArray(s)?s:[];ht(i);const a=t!=null?String(t):n.value,o=r("reservations.create.placeholders.project","اختر مشروعاً (اختياري)"),l=[...i].sort((m,d)=>String(d.createdAt||d.start||"").localeCompare(String(m.createdAt||m.start||""))),c=[`<option value="">${Fe(o)}</option>`].concat(l.map(m=>`<option value="${Fe(m.id)}">${Fe(m.title||o)}</option>`)).join("");n.innerHTML=c,a&&i.some(m=>String(m.id)===a)?n.value=a:t!=null?n.value=String(t):n.value="",Be()}function Be(){const e=document.getElementById("res-project"),t=document.getElementById("res-tax");if(!t)return;if(!!(e!=null&&e.value))t.checked=!1,t.disabled=!0,t.classList.add("disabled");else{const s=t.disabled;t.disabled=!1,t.classList.remove("disabled"),s&&(t.checked=!1)}}function Zn(){const e=document.getElementById("res-project");!e||e.dataset.listenerAttached||(e.addEventListener("change",()=>{const t=We(e.value);t?gt(t):(Be(),P())}),e.dataset.listenerAttached="true")}function es(){try{const e=localStorage.getItem(Pe);if(!e)return;const t=JSON.parse(e);if(localStorage.removeItem(Pe),!t||!t.projectId)return;const n=document.getElementById("res-project");n&&(n.value=String(t.projectId),Be());const s=We(t.projectId);if(s?gt(s,{forceNotes:!!t.forceNotes}):P(),t.start&&ke("res-start","res-start-time",t.start),t.end&&ke("res-end","res-end-time",t.end),t.customerId){const a=(_e()||[]).find(o=>String(o.id)===String(t.customerId));if(a!=null&&a.customerName){const o=document.getElementById("res-customer");o&&(o.value=a.customerName)}}}catch(e){console.warn("⚠️ [reservations/createForm] Failed to apply pending project context",e),localStorage.removeItem(Pe)}}function Ye(){var i,a,o,l,c,m,d,v;const e=(a=(i=document.getElementById("res-start"))==null?void 0:i.value)==null?void 0:a.trim(),t=(l=(o=document.getElementById("res-end"))==null?void 0:o.value)==null?void 0:l.trim(),n=((m=(c=document.getElementById("res-start-time"))==null?void 0:c.value)==null?void 0:m.trim())||"00:00",s=((v=(d=document.getElementById("res-end-time"))==null?void 0:d.value)==null?void 0:v.trim())||"00:00";return!e||!t?{start:null,end:null}:{start:Ee(e,n),end:Ee(t,s)}}function yt(e){const t=G(e);return t&&(An()||[]).find(s=>G((s==null?void 0:s.desc)||(s==null?void 0:s.description)||"").includes(t))||null}function fe(){const e=document.getElementById("equipment-description-options"),t=document.getElementById("edit-res-equipment-description-options"),{equipment:n=[]}=A(),s=Array.isArray(n)?n:[];Ln(s);const a=Array.from(new Set(s.map(o=>(o==null?void 0:o.desc)||(o==null?void 0:o.description)||"").filter(Boolean))).sort((o,l)=>o.localeCompare(l,"ar",{sensitivity:"base"})).map(o=>`<option value="${o}"></option>`).join("");e&&(e.innerHTML=a),t&&(t.innerHTML=a)}function qt(e){if(!e)return;const t=e.value.trim();if(!t)return;const n=yt(t);if(!n){f(r("reservations.toast.equipmentNameNotFound","❌ لم يتم العثور على معدة بالاسم المدخل"));return}const s=ft(n.barcode);if((s==null?void 0:s.status)==="صيانة"){f(r("reservations.toast.equipmentMaintenance","⚠️ هذه المعدة قيد الصيانة ولا يمكن إضافتها حالياً"));return}const i=N(n.barcode);if(!i){f(r("reservations.toast.equipmentMissingBarcode","⚠️ هذه المعدة لا تحتوي على باركود معرف"));return}const a={id:n.id,barcode:i,desc:n.desc||n.description||n.name||"",qty:1,price:Number.isFinite(Number(n.price))?Number(n.price):0,image:Ce(n)},{start:o,end:l}=Ye();if(!o||!l){f(r("reservations.toast.requireDatesBeforeAdd","⚠️ يرجى تحديد تاريخ ووقت البداية والنهاية قبل إضافة المعدات"));return}if(Ie().some(d=>N(d.barcode)===i)){f(r("reservations.toast.equipmentDuplicate","⚠️ هذه المعدة موجودة بالفعل في الحجز"));return}if(pe(i,o,l)){f(r("reservations.toast.equipmentTimeConflict","⚠️ لا يمكن إضافة المعدة لأنها محجوزة في نفس الفترة الزمنية"));return}if(ve(i)){f(r("reservations.toast.equipmentMaintenance","⚠️ هذه المعدة قيد الصيانة ولا يمكن إضافتها حالياً"));return}dt(a),be(),P(),e.value=""}function ts(){fe();const e=document.getElementById("equipment-description");e&&!e.dataset.listenerAttached&&(e.addEventListener("keydown",t=>{t.key==="Enter"&&(t.preventDefault(),qt(e))}),e.dataset.listenerAttached="true")}function be(e="reservation-items"){const t=document.getElementById(e);if(!t)return;const n=Ie(),s=r("reservations.create.equipment.noneAdded","لا توجد معدات مضافة"),i=r("reservations.create.summary.currency","ريال"),a=r("reservations.create.equipment.imageAlt","صورة");if(n.length===0){t.innerHTML=`<tr><td colspan="5">${s}</td></tr>`;return}t.innerHTML=n.map((o,l)=>{const c=Ce(o),m=`${g(String(o.price??0))} ${i}`,d=c?`<img src="${c}" alt="${a}" class="reservation-item-thumb">`:"-";return`
        <tr>
          <td>${o.barcode||"-"}</td>
          <td>${o.desc}</td>
          <td>${m}</td>
          <td>${d}</td>
          <td><button type="button" class="btn btn-sm btn-danger" data-action="remove-item" data-index="${l}">🗑️</button></td>
        </tr>
      `}).join("")}function P(){var m,d,v,b;const e=((m=document.getElementById("res-discount"))==null?void 0:m.value)||"0",t=parseFloat(g(e))||0,n=((d=document.getElementById("res-discount-type"))==null?void 0:d.value)||"percent",s=!!((v=document.getElementById("res-project"))!=null&&v.value),i=document.getElementById("res-tax"),a=s?!1:(i==null?void 0:i.checked)||!1,o=((b=document.getElementById("res-payment-status"))==null?void 0:b.value)||"unpaid",{start:l,end:c}=Ye();Tn({selectedItems:Ie(),discount:t,discountType:n,applyTax:a,paidStatus:o,start:l,end:c})}function ns(){const e=document.getElementById("res-discount");e&&!e.dataset.listenerAttached&&(e.addEventListener("input",i=>{i.target.value=g(i.target.value),P()}),e.dataset.listenerAttached="true");const t=document.getElementById("res-discount-type");t&&!t.dataset.listenerAttached&&(t.addEventListener("change",P),t.dataset.listenerAttached="true");const n=document.getElementById("res-tax");n&&!n.dataset.listenerAttached&&(n.addEventListener("change",P),n.dataset.listenerAttached="true");const s=document.getElementById("res-payment-status");s&&!s.dataset.listenerAttached&&(s.addEventListener("change",P),s.dataset.listenerAttached="true")}function ss(){var i;const e=document.getElementById("res-start-time"),t=document.getElementById("res-end-time");if(!e||!t||e.dataset.timeSyncAttached)return;let n=!1;const s=()=>{var c,m;const a=(c=e.value)==null?void 0:c.trim();if(!a){P();return}const o=t.dataset.syncedWithStart;(!((m=t.value)!=null&&m.trim())||o!=="false")&&(n=!0,t.value=a,t.dataset.syncedWithStart="true",t.dataset.syncedValue=a,t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0})),n=!1),P()};e.addEventListener("change",s),e.addEventListener("input",s),e.addEventListener("blur",s),t.addEventListener("input",()=>{n||(t.value===e.value?(t.dataset.syncedWithStart="true",t.dataset.syncedValue=t.value):t.dataset.syncedWithStart="false")}),(i=t.value)!=null&&i.trim()||s(),e.dataset.timeSyncAttached="true"}function nt(){var L,R,x,j,F,V;const e=document.getElementById("res-customer").value.trim().toLowerCase(),t=document.getElementById("res-project"),n=t!=null&&t.value?String(t.value):"",{customers:s,reservations:i}=A();let a=s.find(M=>{var U;return((U=M.customerName)==null?void 0:U.trim().toLowerCase())===e});if(a||(a=s.find(M=>{var U;return(U=M.customerName)==null?void 0:U.toLowerCase().includes(e)})),!a){f(r("reservations.toast.customerNotFound","⚠️ لم يتم العثور على العميل بالاسم المدخل"));return}const o=a.id,l=document.getElementById("res-start").value,c=document.getElementById("res-end").value,m=((L=document.getElementById("res-start-time"))==null?void 0:L.value)||"00:00",d=((R=document.getElementById("res-end-time"))==null?void 0:R.value)||"00:00";if(!l||!c){f(r("reservations.toast.requireDates","⚠️ يرجى تحديد تاريخ البداية والنهاية"));return}const v=`${l}T${m}`,b=`${c}T${d}`,h=new Date(v),w=new Date(b);if(Number.isNaN(h.getTime())||Number.isNaN(w.getTime())||h>=w){f(r("reservations.toast.invalidDateRange","⚠️ تأكد من أن تاريخ ووقت البداية يسبق تاريخ ووقت النهاية"));return}const T=Ie();if(T.length===0){f(r("reservations.toast.noItems","⚠️ لا يمكنك إنشاء حجز بدون معدات"));return}const y=((x=document.getElementById("res-notes"))==null?void 0:x.value)||"",u=parseFloat(g((j=document.getElementById("res-discount"))==null?void 0:j.value))||0,p=((F=document.getElementById("res-discount-type"))==null?void 0:F.value)||"percent",C=((V=document.getElementById("res-payment-status"))==null?void 0:V.value)||"unpaid",I=xn(),S=n?We(n):null;if(n&&!S){f(r("reservations.toast.projectNotFound","⚠️ لم يتم العثور على المشروع المحدد. حاول تحديث الصفحة."));return}for(const M of T)if(ve(M.barcode)){f(r("reservations.toast.cannotCreateEquipmentMaintenance","⚠️ لا يمكن إتمام الحجز لأن إحدى المعدات قيد الصيانة"));return}for(const M of T){const U=N(M.barcode);if(pe(U,v,b)){f(r("reservations.toast.cannotCreateEquipmentConflict","⚠️ لا يمكن إتمام الحجز، إحدى المعدات محجوزة في نفس الفترة الزمنية"));return}}for(const M of I)if(ut(M,v,b)){f(r("reservations.toast.cannotCreateCrewConflict","⚠️ لا يمكن إتمام الحجز، أحد أعضاء الطاقم مرتبط بحجز آخر في نفس الفترة"));return}const B=document.getElementById("res-tax"),D=!!n?!1:(B==null?void 0:B.checked)||!1,$={id:Date.now(),reservationId:Cn(),customerId:parseInt(o,10),start:v,end:b,items:[...T],technicians:I,notes:y,discount:u,discountType:p,applyTax:D,paid:C==="paid",cost:mt(T,u,p,D,I,{start:v,end:b}),confirmed:!1,projectId:n||null};i.push($),Y({reservations:i}),ze(),fe(),Le(),as(),f(r("reservations.toast.created","✅ تم إنشاء الحجز")),typeof Oe=="function"&&Oe({type:"created",reservation:$})}function as(){document.getElementById("res-customer").value="",document.getElementById("res-start").value="",document.getElementById("res-start-time").value="",document.getElementById("res-end").value="",document.getElementById("res-end-time").value="",document.getElementById("res-notes").value="",document.getElementById("res-discount").value="";const e=document.getElementById("res-tax");e&&(e.checked=!1,e.disabled=!1,e.classList.remove("disabled"));const t=document.getElementById("res-project");t&&(t.value="");const n=document.getElementById("equipment-description");n&&(n.value="");const s=document.getElementById("res-payment-status");s&&(s.value="unpaid"),kn(),Dn([]),be(),Be(),P()}function rs(){const e=document.getElementById("reservation-items");!e||e.dataset.listenerAttached||(e.addEventListener("click",t=>{const n=t.target.closest('button[data-action="remove-item"]');if(!n)return;const s=Number(n.dataset.index);Bn(s),be(),P()}),e.dataset.listenerAttached="true")}function is(){const e=document.getElementById("equipment-barcode");!e||e.dataset.listenerAttached||(e.addEventListener("keydown",t=>{if(t.key!=="Enter")return;t.preventDefault();const n=N(e.value);if(!n)return;const{start:s,end:i}=Ye();if(!s||!i){f(r("reservations.toast.requireDatesBeforeAdd","⚠️ يرجى تحديد تاريخ ووقت البداية والنهاية قبل إضافة المعدات"));return}if(Ie().some(m=>N(m.barcode)===n)){f(r("reservations.toast.equipmentDuplicate","⚠️ هذه المعدة موجودة بالفعل في الحجز"));return}if(pe(n,s,i)){f(r("reservations.toast.equipmentTimeConflict","⚠️ لا يمكن إضافة المعدة لأنها محجوزة في نفس الفترة الزمنية"));return}const{equipment:l}=A(),c=(l||[]).find(m=>N(m.barcode)===n);if(!c){f(r("reservations.toast.barcodeNotFound","❌ الباركود غير موجود"));return}if(ve(c.barcode)){f(r("reservations.toast.equipmentMaintenance","⚠️ هذه المعدة قيد الصيانة ولا يمكن إضافتها حالياً"));return}dt({id:c.id,barcode:N(c.barcode),desc:c.desc,qty:1,price:c.price,image:Ce(c)}),e.value="",be(),P(),f(r("reservations.toast.equipmentAdded","✅ تم إضافة المعدة بنجاح"))}),e.dataset.listenerAttached="true")}function os(){const e=document.getElementById("reservation-form");e&&!e.dataset.listenerAttached&&(e.addEventListener("submit",n=>{n.preventDefault(),nt()}),e.dataset.listenerAttached="true");const t=document.getElementById("create-reservation-btn");t&&!t.dataset.listenerAttached&&(t.addEventListener("click",n=>{n.preventDefault(),nt()}),t.dataset.listenerAttached="true")}function cs(){const e=document.getElementById("res-customer"),t=document.getElementById("customer-suggestions");if(!e||!t)return;const n=a=>{if(!a||a.length===0){t.style.display="none",t.innerHTML="";return}t.innerHTML=a.map(o=>`<div class="suggestion-item" data-name="${o}">${o}</div>`).join(""),t.style.display="block",t.querySelectorAll(".suggestion-item").forEach(o=>{o.addEventListener("mousedown",l=>{l.preventDefault();const c=l.target.getAttribute("data-name");e.value=c,t.style.display="none"})})},s=()=>{const a=_e()||[];return[...new Set(a.map(o=>o.customerName).filter(Boolean))]},i=()=>{const a=G(e.value),o=s(),l=a?o.filter(c=>G(c).startsWith(a)).slice(0,10):o.slice(0,10);n(l)};e.addEventListener("input",()=>{i()}),e.addEventListener("focus",()=>{i()}),e.addEventListener("blur",()=>{setTimeout(()=>{t.style.display="none"},150)})}function Ls({onAfterSubmit:e}={}){Oe=typeof e=="function"?e:null;const{customers:t,projects:n}=A();$n(t||[]),ht(n||[]),Ve({projectsList:n}),Zn(),fe(),ts(),ss(),ns(),rs(),is(),os(),cs(),es(),P(),be()}function Et(){fe(),Ve(),be(),P()}if(typeof document<"u"){const e=()=>Ve();document.addEventListener("language:changed",e),document.addEventListener("language:translationsReady",e,{once:!1})}function wt(e){const t=new Date;if(t.setHours(0,0,0,0),e==="today")return{startDate:te(t),endDate:te(t)};if(e==="week"){const n=new Date(t),s=n.getDay(),i=s===0?6:s-1;n.setDate(n.getDate()-i);const a=new Date(n);return a.setDate(n.getDate()+6),{startDate:te(n),endDate:te(a)}}if(e==="month"){const n=new Date(t.getFullYear(),t.getMonth(),1),s=new Date(t.getFullYear(),t.getMonth()+1,0);return{startDate:te(n),endDate:te(s)}}return e==="upcoming"?{startDate:te(t),endDate:""}:{startDate:"",endDate:""}}function ls(){const e=document.getElementById("search-reservation"),t=document.getElementById("filter-start-date"),n=document.getElementById("filter-end-date"),s=document.getElementById("reservation-date-range"),i=document.getElementById("reservation-status-filter");let a=g((t==null?void 0:t.value)||"").trim(),o=g((n==null?void 0:n.value)||"").trim(),l=(s==null?void 0:s.value)||"";if(new Set(["","today","week","month"]).has(l)||(l="",s&&(s.value=""),De(t),De(n),a="",o=""),!a&&!o&&l){const m=wt(l);a=m.startDate,o=m.endDate}return{searchTerm:G((e==null?void 0:e.value)||""),startDate:a,endDate:o,status:(i==null?void 0:i.value)||"",quickRange:l}}function $s(e){const t=()=>{typeof e=="function"&&e()},n=document.getElementById("search-reservation");n&&!n.dataset.listenerAttached&&(n.addEventListener("input",()=>{n.value=g(n.value),t()}),n.dataset.listenerAttached="true");const s=document.getElementById("filter-start-date");s&&!s.dataset.listenerAttached&&(s.addEventListener("change",()=>{const c=document.getElementById("reservation-date-range");c&&(c.value=""),t()}),s.dataset.listenerAttached="true");const i=document.getElementById("filter-end-date");i&&!i.dataset.listenerAttached&&(i.addEventListener("change",()=>{const c=document.getElementById("reservation-date-range");c&&(c.value=""),t()}),i.dataset.listenerAttached="true");const a=document.getElementById("reservation-date-range");a&&!a.dataset.listenerAttached&&(a.addEventListener("change",()=>{ds(a.value),t()}),a.dataset.listenerAttached="true");const o=document.getElementById("reservation-status-filter");o&&!o.dataset.listenerAttached&&(o.addEventListener("change",t),o.dataset.listenerAttached="true");const l=document.getElementById("clear-filters");l&&!l.dataset.listenerAttached&&(l.addEventListener("click",()=>{n&&(n.value=""),De(s),De(i),a&&(a.value=""),o&&(o.value=""),t()}),l.dataset.listenerAttached="true")}function ds(e){const t=document.getElementById("filter-start-date"),n=document.getElementById("filter-end-date");if(!t||!n)return;const{startDate:s,endDate:i}=wt(e);t._flatpickr?s?t._flatpickr.setDate(s,!1,"Y-m-d"):t._flatpickr.clear():t.value=s,n._flatpickr?i?n._flatpickr.setDate(i,!1,"Y-m-d"):n._flatpickr.clear():n.value=i}function te(e){if(!e)return"";const t=e.getTimezoneOffset()*6e4;return new Date(e.getTime()-t).toISOString().split("T")[0]}function De(e){e&&(e._flatpickr&&e._flatpickr.clear(),e.value="")}function us({reservations:e=[],filters:t={},customersMap:n,techniciansMap:s,projectsMap:i}){const a=e.map((u,p)=>({reservation:u,index:p})),o=t.searchTerm||"",l=t.searchReservationId||"",c=t.searchCustomerName||"",m=t.startDate||"",d=t.endDate||"",v=t.status||"",b=Object.prototype.hasOwnProperty.call(t,"customerId")?t.customerId:null,h=Object.prototype.hasOwnProperty.call(t,"technicianId")?t.technicianId:null,w=m?new Date(`${m}T00:00:00`):null,T=d?new Date(`${d}T23:59:59`):null,y=a.filter(({reservation:u})=>{var L,R,x;const p=n.get(String(u.customerId)),C=(L=i==null?void 0:i.get)==null?void 0:L.call(i,String(u.projectId)),I=u.start?new Date(u.start):null,S=u.confirmed===!0||u.confirmed==="true",B=qe(u);if(b!=null&&String(u.customerId)!==String(b)||h!=null&&!(Array.isArray(u.technicians)?u.technicians.map(F=>String(F)):[]).includes(String(h))||v==="confirmed"&&!S||v==="pending"&&S||v==="completed"&&!B||w&&I&&I<w||T&&I&&I>T||l&&!G([u.reservationId,u.id].filter(Boolean).map(String).join(" ")).includes(l)||c&&!G((p==null?void 0:p.customerName)||"").includes(c))return!1;if(!o)return!0;const E=((x=(R=u.items)==null?void 0:R.map)==null?void 0:x.call(R,j=>`${j.barcode} ${j.desc}`).join(" "))||"",D=(u.technicians||[]).map(j=>{var F;return(F=s.get(String(j)))==null?void 0:F.name}).filter(Boolean).join(" ");return G([u.reservationId,p==null?void 0:p.customerName,u.notes,E,D,C==null?void 0:C.title].filter(Boolean).join(" ")).includes(o)});return y.sort((u,p)=>{const C=qe(u.reservation),I=qe(p.reservation);if(C!==I)return C?1:-1;const S=u.reservation.start?new Date(u.reservation.start).getTime():0;return(p.reservation.start?new Date(p.reservation.start).getTime():0)-S}),y}function ms({entries:e,customersMap:t,techniciansMap:n,projectsMap:s}){const i=r("reservations.create.summary.currency","ريال"),a=r("reservations.list.taxIncludedShort","(شامل الضريبة)"),o=r("reservations.list.unknownCustomer","غير معروف"),l=r("reservations.list.noNotes","لا توجد ملاحظات"),c=r("reservations.list.itemsCountShort","{count} عنصر"),m=r("reservations.list.crew.separator","، "),d=r("reservations.list.status.confirmed","✅ مؤكد"),v=r("reservations.list.status.pending","⏳ غير مؤكد"),b=r("reservations.list.payment.paid","💳 مدفوع"),h=r("reservations.list.payment.unpaid","💳 غير مدفوع"),w=r("reservations.list.actions.confirm","✔️ تأكيد"),T=r("reservations.list.project.unlinked","غير مرتبط بمشروع"),y=r("reservations.edit.project.missing","⚠️ المشروع غير متوفر (تم حذفه)"),u={client:r("reservations.list.labels.client","👤 العميل"),project:r("reservations.list.labels.project","📁 المشروع"),start:r("reservations.list.labels.start","🗓️ بداية الحجز"),end:r("reservations.list.labels.end","🗓️ نهاية الحجز"),cost:r("reservations.list.labels.cost","💵 التكلفة"),equipment:r("reservations.list.labels.equipment","📦 المعدات"),crew:r("reservations.list.labels.crew","😎 الفريق")};return e.map(({reservation:p,index:C})=>{var K,Z;const I=t.get(String(p.customerId)),S=p.projectId?(K=s==null?void 0:s.get)==null?void 0:K.call(s,String(p.projectId)):null,B=p.confirmed===!0||p.confirmed==="true",E=qe(p),D=p.paid===!0||p.paid==="paid";let $=B?`<span class="badge bg-success reservation-chip">${d}</span>`:`<span class="badge bg-warning text-dark reservation-chip">${v}</span>`,L=D?`<span class="badge bg-primary reservation-chip">${b}</span>`:`<span class="badge bg-danger reservation-chip">${h}</span>`,R=D?" tile-paid":" tile-unpaid";E&&(R+=" tile-completed");let x="";E&&($=`<span class="badge reservation-chip chip-completed">${d}</span>`,L=`<span class="badge reservation-chip chip-completed">${D?b:h}</span>`,x=` data-completed-label="${r("reservations.list.ribbon.completed","منتهي").replace(/"/g,"&quot;")}"`);const j=B?"":`<button class="btn btn-sm btn-success tile-confirm" data-reservation-index="${C}" data-action="confirm">${w}</button>`,F=((Z=p.items)==null?void 0:Z.length)||0,V=(p.technicians||[]).map(H=>n.get(String(H))).filter(Boolean),M=V.map(H=>H.name).join(m)||"—",U=g(String(p.reservationId??"")),se=p.start?g(Ae(p.start)):"-",ae=p.end?g(Ae(p.end)):"-",re=g(String(p.cost??0)),ie=g(String(F)),oe=p.notes?g(p.notes):l,ce=c.replace("{count}",ie),O=p.applyTax?`<small>${a}</small>`:"";let J=T;return p.projectId&&(J=S!=null&&S.title?g(S.title):y),`
      <div class="reservation-tile${R}"${x} data-reservation-index="${C}" data-action="details">
        <div class="tile-top">
          <div class="tile-id">${U}</div>
          <div class="tile-badges">
            ${$}
            ${L}
          </div>
        </div>
        <div class="tile-body">
          <div class="tile-row">
            <span class="tile-label">${u.client}</span>
            <span class="tile-value">${(I==null?void 0:I.customerName)||o}</span>
          </div>
          <div class="tile-row">
            <span class="tile-label">${u.project}</span>
            <span class="tile-value">${J}</span>
          </div>
          <div class="tile-row">
            <span class="tile-label">${u.start}</span>
            <span class="tile-value tile-inline">${se}</span>
          </div>
          <div class="tile-row">
            <span class="tile-label">${u.end}</span>
            <span class="tile-value tile-inline">${ae}</span>
          </div>
          <div class="tile-row">
            <span class="tile-label">${u.cost}</span>
            <span class="tile-value">${re} ${i} ${O}</span>
          </div>
          <div class="tile-row">
            <span class="tile-label">${u.equipment}</span>
            <span class="tile-value">${ce}</span>
          </div>
          <div class="tile-row">
            <span class="tile-label">${u.crew}</span>
            <span class="tile-value">${V.length?M:"—"}</span>
          </div>
        </div>
        <div class="tile-footer">
          <span class="tile-notes">📝 ${oe}</span>
          ${j}
        </div>
      </div>
    `}).join("")}function Ue(e=""){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function ps(e,t,n=[],s,i=null){const a=e.confirmed===!0||e.confirmed==="true",o=e.paid===!0||e.paid==="paid",l=qe(e),c=e.items||[],{technicians:m=[]}=A(),d=[].concat(Array.isArray(n)?n:[]).concat(Array.isArray(m)?m:[]),v=new Map;d.forEach(q=>{if(!q||q.id==null)return;const k=String(q.id),X=v.get(k)||{};v.set(k,{...X,...q})});const b=(e.technicians||[]).map(q=>v.get(String(q))).filter(Boolean),h=Nn(e.start,e.end),w=(q={})=>{const k=[q.dailyWage,q.daily_rate,q.dailyRate,q.wage,q.rate];for(const X of k){if(X==null)continue;const me=parseFloat(g(String(X)));if(Number.isFinite(me))return me}return 0},y=c.reduce((q,k)=>q+(k.qty||1)*(k.price||0),0)*h,p=b.reduce((q,k)=>q+w(k),0)*h,C=y+p,I=parseFloat(e.discount)||0,S=e.discountType==="amount"?I:C*(I/100),B=Math.max(0,C-S),E=!!e.projectId,D=E?!1:e.applyTax,$=D?B*.15:0,L=Number(e.cost),R=Number.isFinite(L),x=B+$,j=E?Math.round(x):R?L:Math.round(x),F=g(String(e.reservationId??e.id??"")),V=e.start?g(Ae(e.start)):"-",M=e.end?g(Ae(e.end)):"-",U=g(String(b.length)),se=g(y.toFixed(2)),ae=g(S.toFixed(2)),re=g(B.toFixed(2)),ie=g($.toFixed(2)),oe=g((j??0).toFixed(2)),ce=g(String(h)),O=r("reservations.create.summary.currency","ريال"),J=r("reservations.details.labels.discount","الخصم"),K=r("reservations.details.labels.tax","الضريبة (15%)"),Z=r("reservations.details.labels.crewTotal","إجمالي الفريق"),H=r("reservations.details.labels.subtotalAfterDiscount","الإجمالي"),le=r("reservations.details.labels.duration","عدد الأيام"),de={index:"#",code:r("reservations.details.table.headers.code","الكود"),description:r("reservations.details.table.headers.description","الوصف"),quantity:r("reservations.details.table.headers.quantity","الكمية"),price:r("reservations.details.table.headers.price","السعر"),image:r("reservations.details.table.headers.image","الصورة")},Dt=r("reservations.details.noItems","📦 لا توجد معدات ضمن هذا الحجز حالياً."),Lt=r("reservations.details.noCrew","😎 لا يوجد فريق مرتبط بهذا الحجز."),$t=r("reservations.details.technicians.roleUnknown","غير محدد"),Nt=r("reservations.details.technicians.phoneUnknown","غير متوفر"),jt=r("reservations.details.technicians.wage","{amount} {currency} / اليوم"),Rt=r("reservations.list.status.confirmed","✅ مؤكد"),Mt=r("reservations.list.status.pending","⏳ غير مؤكد"),Pt=r("reservations.list.payment.paid","💳 مدفوع"),Ft=r("reservations.list.payment.unpaid","💳 غير مدفوع"),Ut=r("reservations.list.status.completed","📁 منتهي"),Ht=r("reservations.details.labels.id","🆔 رقم الحجز"),Ot=r("reservations.details.section.bookingInfo","بيانات الحجز"),Xt=r("reservations.details.section.paymentSummary","ملخص الدفع"),_t=r("reservations.details.labels.finalTotal","المجموع النهائي"),zt=r("reservations.details.section.crew","😎 الفريق الفني"),Wt=r("reservations.details.crew.count","{count} عضو"),Vt=r("reservations.details.section.items","📦 المعدات المرتبطة"),Yt=r("reservations.details.items.count","{count} عنصر"),Qt=r("reservations.details.actions.edit","✏️ تعديل"),Gt=r("reservations.details.actions.delete","🗑️ حذف"),Jt=r("reservations.details.labels.customer","العميل"),Kt=r("reservations.details.labels.contact","رقم التواصل"),Zt=r("reservations.details.labels.project","📁 المشروع المرتبط");r("reservations.details.project.unlinked","غير مرتبط بأي مشروع.");const en=r("reservations.edit.project.missing","⚠️ المشروع غير متوفر (تم حذفه)"),tn=r("reservations.details.actions.openProject","📁 فتح المشروع"),nn=r("reservations.details.labels.start","بداية الحجز"),sn=r("reservations.details.labels.end","نهاية الحجز"),an=r("reservations.details.labels.notes","ملاحظات"),rn=r("reservations.list.noNotes","لا توجد ملاحظات"),on=r("reservations.details.labels.itemsCount","عدد المعدات"),cn=r("reservations.details.labels.itemsTotal","إجمالي المعدات"),ln=r("reservations.details.labels.paymentStatus","حالة الدفع"),dn=r("reservations.list.unknownCustomer","غير معروف"),Ke=o?Pt:Ft,Ze=c.length,un=g(String(Ze)),et=Yt.replace("{count}",un),mn=Wt.replace("{count}",U),pn=e.notes?g(e.notes):rn,vn=g(p.toFixed(2)),ue=[{icon:"💳",label:ln,value:Ke},{icon:"📦",label:on,value:et},{icon:"⏱️",label:le,value:ce},{icon:"💼",label:cn,value:`${se} ${O}`}];ue.push({icon:"😎",label:Z,value:`${vn} ${O}`}),S>0&&ue.push({icon:"💸",label:J,value:`${ae} ${O}`}),ue.push({icon:"📊",label:H,value:`${re} ${O}`}),D&&$>0&&ue.push({icon:"🧾",label:K,value:`${ie} ${O}`}),ue.push({icon:"💰",label:_t,value:`${oe} ${O}`});const fn=ue.map(({icon:q,label:k,value:X})=>`
    <div class="summary-details-row">
      <span class="summary-details-label">${q} ${k}</span>
      <span class="summary-details-value">${X}</span>
    </div>
  `).join(""),tt=[{text:a?Rt:Mt,className:a?"status-confirmed":"status-pending"},{text:Ke,className:o?"status-paid":"status-unpaid"}];l&&tt.push({text:Ut,className:"status-completed"});const bn=tt.map(({text:q,className:k})=>`<span class="status-chip ${k}">${q}</span>`).join(""),he=(q,k,X)=>`
    <div class="res-info-row">
      <span class="label">${q} ${k}</span>
      <span class="value">${X}</span>
    </div>
  `;let Re="";if(e.projectId){let q=Ue(en);if(i){const k=i.title||r("projects.fallback.untitled","مشروع بدون اسم");q=`${Ue(k)} <button type="button" class="btn btn-sm btn-outline-primary" data-action="open-project" data-project-id="${i.id}">${Ue(tn)}</button>`}Re=`
      <div class="res-info-row">
        <span class="label">📁 ${Zt}</span>
        <span class="value">${q}</span>
      </div>
    `}const ee=[];ee.push(he("👤",Jt,(t==null?void 0:t.customerName)||dn)),ee.push(he("📞",Kt,(t==null?void 0:t.phone)||"—")),ee.push(he("🗓️",nn,V)),ee.push(he("🗓️",sn,M)),ee.push(he("📝",an,pn)),Re&&ee.push(Re);const hn=ee.join(""),gn=Ze?c.map((q,k)=>{const X=Ce(q),me=g(String(q.barcode||"-")),Me=g(String(q.qty||1)),xe=g(String(q.price||0)),wn=g(String(k+1)),In=X?`<img src="${X}" alt="${q.desc||""}" class="reservation-modal-item-thumb">`:"-";return`
          <tr>
            <td>${wn}</td>
            <td>${me}</td>
            <td>${q.desc||"-"}</td>
            <td>${Me}</td>
            <td>${xe} ${O}</td>
            <td>${In}</td>
          </tr>
        `}).join(""):`<tr><td colspan="6" class="text-center">${Dt}</td></tr>`,yn=`
    <div class="table-responsive reservation-modal-items-wrapper">
      <table class="table table-sm table-hover align-middle reservation-modal-items-table">
        <thead>
          <tr>
            <th>${de.index}</th>
            <th>${de.code}</th>
            <th>${de.description}</th>
            <th>${de.quantity}</th>
            <th>${de.price}</th>
            <th>${de.image}</th>
          </tr>
        </thead>
        <tbody>${gn}</tbody>
      </table>
    </div>
  `,qn=b.map((q,k)=>{const X=g(String(k+1)),me=q.role||$t,Me=q.phone||Nt,xe=q.wage?jt.replace("{amount}",g(String(q.wage))).replace("{currency}",O):"";return`
      <div class="reservation-technician-card">
        <div class="technician-card-head">
          <span class="technician-index">${X}</span>
          <span class="technician-name">${q.name}</span>
        </div>
        <div class="technician-card-body">
          <div>🎯 ${me}</div>
          <div>📞 ${Me}</div>
          ${xe?`<div>💰 ${xe}</div>`:""}
        </div>
      </div>
    `}).join(""),En=b.length?`<div class="reservation-technicians-grid">${qn}</div>`:`<ul class="reservation-modal-technicians"><li>${Lt}</li></ul>`;return`
    <div class="reservation-modal">
      <div class="reservation-modal-header">
        <div class="reservation-modal-id">
          <span>${Ht}</span>
          <strong>${F}</strong>
        </div>
        <div class="status-chips">
          ${bn}
        </div>
      </div>

      <div class="reservation-modal-grid">
        <div class="reservation-info-card">
          <h6>${Ot}</h6>
          ${hn}
        </div>
        <div class="reservation-summary-card">
          <div class="summary-icon">💳</div>
          <div class="summary-body">
            <h6 class="summary-heading">${Xt}</h6>
            <div class="summary-details">
              ${fn}
            </div>
          </div>
        </div>
      </div>

      <div class="reservation-technicians-section">
        <div class="section-title">
          <span>${zt}</span>
          <span class="count">${mn}</span>
        </div>
        ${En}
      </div>

      <div class="reservation-items-section">
        <div class="section-title">
          <span>${Vt}</span>
          <span class="count">${et}</span>
        </div>
        ${yn}
      </div>

      <div class="reservation-modal-actions">
        <button type="button" class="btn btn-warning" id="reservation-details-edit-btn" data-index="${s}">${Qt}</button>
        <button type="button" class="btn btn-danger" id="reservation-details-delete-btn" data-index="${s}">${Gt}</button>
      </div>
    </div>
  `}const vs="pendingProjectDetailId";function fs({containerId:e="reservations-list",filters:t=null,onShowDetails:n,onConfirmReservation:s}={}){const i=Le(),{reservations:a=[],customers:o=[],technicians:l=[],projects:c=[]}=A(),m=Array.isArray(i)?i:l||[],d=new Map((c||[]).map(y=>[String(y.id),y])),v=document.getElementById(e);if(!v){console.warn("⚠️ [reservations/renderers] container not found",e);return}if(!a||a.length===0){v.innerHTML=`<p>${r("reservations.list.empty","⚠️ لا توجد حجوزات بعد.")}</p>`;return}const b=t||ls(),h=new Map(o.map(y=>[String(y.id),y])),w=new Map(m.map(y=>[String(y.id),y])),T=us({reservations:a,filters:b,customersMap:h,techniciansMap:w,projectsMap:d});if(T.length===0){v.innerHTML=`<p>${r("reservations.list.noResults","🔍 لا توجد حجوزات مطابقة للبحث.")}</p>`;return}v.innerHTML=`<div class="reservations-grid">${ms({entries:T,customersMap:h,techniciansMap:w,projectsMap:d})}</div>`,v.querySelectorAll('[data-action="details"]').forEach(y=>{const u=Number(y.dataset.reservationIndex);Number.isNaN(u)||y.addEventListener("click",()=>{typeof n=="function"&&n(u)})}),v.querySelectorAll('button[data-action="confirm"]').forEach(y=>{const u=Number(y.dataset.reservationIndex);Number.isNaN(u)||y.addEventListener("click",p=>{p.stopPropagation(),typeof s=="function"&&s(u,p)})})}function bs(e,{onEdit:t,onDelete:n,getEditContext:s}={}){var y;const{reservations:i=[],customers:a=[],projects:o=[]}=A(),l=i[e];if(!l)return f(r("reservations.toast.notFound","⚠️ تعذر العثور على بيانات الحجز")),!1;const c=a.find(u=>String(u.id)===String(l.customerId)),m=l.projectId?o.find(u=>String(u.id)===String(l.projectId)):null,d=document.getElementById("reservation-details-body");if(d){const u=Le()||[];d.innerHTML=ps(l,c,u,e,m)}const v=document.getElementById("reservationDetailsModal"),b=()=>{var u,p;v&&((u=window.bootstrap)!=null&&u.Modal)&&((p=window.bootstrap.Modal.getInstance(v))==null||p.hide())},h=document.getElementById("reservation-details-edit-btn");h&&(h.onclick=()=>{b(),typeof t=="function"&&t(e,{reservation:l,customer:c,getEditContext:s})});const w=document.getElementById("reservation-details-delete-btn");w&&(w.onclick=()=>{b(),typeof n=="function"&&n(e,{reservation:l,customer:c})});const T=d==null?void 0:d.querySelector('[data-action="open-project"]');return T&&m&&T.addEventListener("click",()=>{b();try{localStorage.setItem(vs,String(m.id))}catch(u){console.warn("⚠️ [reservations] Unable to persist pending project detail id",u)}window.location.href="projects.html"}),v&&((y=window.bootstrap)!=null&&y.Modal)&&window.bootstrap.Modal.getOrCreateInstance(v).show(),!0}function It(){ze(),Le()}function hs(e,{onAfterChange:t}={}){const{reservations:n=[]}=A();if(!Array.isArray(n)||!n[e])return f(r("reservations.toast.notFound","⚠️ تعذر العثور على بيانات الحجز")),!1;const[s]=n.splice(e,1);return Y({reservations:n}),It(),t==null||t({type:"deleted",reservation:s}),f(r("reservations.toast.deleted","🗑️ تم حذف الحجز")),!0}function gs(e,{onAfterChange:t}={}){const{reservations:n=[]}=A(),s=n[e];return s?(s.confirmed=!0,Y({reservations:n}),It(),t==null||t({type:"confirmed",reservation:s}),f(r("reservations.toast.confirmed","✅ تم تأكيد الحجز")),!0):(f(r("reservations.toast.notFound","⚠️ تعذر العثور على بيانات الحجز")),!1)}let we=null,Q=[],_=null,He={};function $e(){return{index:we,items:Q}}function Ne(e,t){we=typeof e=="number"?e:null,Q=Array.isArray(t)?[...t]:[]}function St(){we=null,Q=[],Mn()}function ys(e,t){var n;return e?typeof t=="function"?t(e):(n=window==null?void 0:window.bootstrap)!=null&&n.Modal?window.bootstrap.Modal.getOrCreateInstance(e):typeof bootstrap<"u"&&(bootstrap!=null&&bootstrap.Modal)?bootstrap.Modal.getOrCreateInstance(e):null:null}function ye(e=""){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function qs(e=[],t=null){const n=document.getElementById("edit-res-project");if(!n)return;const s=r("reservations.create.placeholders.project","اختر مشروعاً (اختياري)"),i=r("reservations.edit.project.missing","⚠️ المشروع غير متوفر (تم حذفه)"),a=t!=null&&t.projectId?String(t.projectId):"",o=Array.isArray(e)?[...e].sort((c,m)=>String(m.createdAt||m.start||"").localeCompare(String(c.createdAt||c.start||""))):[],l=[`<option value="">${ye(s)}</option>`];o.forEach(c=>{l.push(`<option value="${ye(c.id)}">${ye(c.title||s)}</option>`)}),a&&!o.some(c=>String(c.id)===a)&&l.push(`<option value="${ye(a)}">${ye(i)}</option>`),n.innerHTML=l.join(""),a?n.value=a:n.value=""}function Ct(){const e=document.getElementById("edit-res-project"),t=document.getElementById("edit-res-tax");if(!t)return;if(!!(e!=null&&e.value))t.checked=!1,t.disabled=!0,t.classList.add("disabled");else{const s=t.disabled;t.disabled=!1,t.classList.remove("disabled"),s&&(t.checked=!1)}}function st(e,{populateEquipmentDescriptionLists:t,setFlatpickrValue:n,splitDateTime:s,renderEditItems:i,updateEditReservationSummary:a,ensureModal:o}={}){var $,L,R;const{reservations:l,customers:c,projects:m}=A(),d=l==null?void 0:l[e];if(!d){f(r("reservations.toast.notFound","⚠️ تعذر العثور على بيانات الحجز"));return}t==null||t(),qs(m||[],d);const v=d.items?d.items.map(x=>({...x,barcode:N(x==null?void 0:x.barcode)})):[];Ne(e,v);const b=r("reservations.list.unknownCustomer","غير معروف"),h=($=c==null?void 0:c.find)==null?void 0:$.call(c,x=>String(x.id)===String(d.customerId));(L=document.getElementById("edit-res-index"))==null||L.setAttribute("value",String(e));const w=document.getElementById("edit-res-id");w&&(w.value=d.reservationId||d.id);const T=document.getElementById("edit-res-customer");T&&(T.value=(h==null?void 0:h.customerName)||b);const y=typeof s=="function"?s(d.start):{date:"",time:""},u=typeof s=="function"?s(d.end):{date:"",time:""};n==null||n("edit-res-start",y.date),n==null||n("edit-res-start-time",y.time),n==null||n("edit-res-end",u.date),n==null||n("edit-res-end-time",u.time);const p=document.getElementById("edit-res-notes");p&&(p.value=d.notes||"");const C=document.getElementById("edit-res-discount");C&&(C.value=g(d.discount??0));const I=document.getElementById("edit-res-discount-type");I&&(I.value=d.discountType||"percent");const S=document.getElementById("edit-res-tax");S&&(S.checked=d.projectId?!1:!!d.applyTax);const B=document.getElementById("edit-res-confirmed");B&&(B.checked=d.confirmed===!0||d.confirmed==="true");const E=document.getElementById("edit-res-paid");E&&(E.value=d.paid===!0||d.paid==="paid"?"paid":"unpaid"),jn((d.technicians||[]).map(x=>String(x))),i==null||i(v),Ct(),a==null||a();const D=document.getElementById("editReservationModal");_=ys(D,o),(R=_==null?void 0:_.show)==null||R.call(_)}function Es({combineDateTime:e,hasEquipmentConflict:t,hasTechnicianConflict:n,updateEditReservationSummary:s,renderReservations:i,populateEquipmentDescriptionLists:a,handleReservationsMutation:o}={}){var j,F,V,M,U,se,ae,re,ie,oe,ce,O,J,K,Z;if(we===null){console.warn("⚠️ [reservationsEdit.js] No reservation selected for editing");return}const l=(F=(j=document.getElementById("edit-res-start"))==null?void 0:j.value)==null?void 0:F.trim(),c=((M=(V=document.getElementById("edit-res-start-time"))==null?void 0:V.value)==null?void 0:M.trim())||"00:00",m=(se=(U=document.getElementById("edit-res-end"))==null?void 0:U.value)==null?void 0:se.trim(),d=((re=(ae=document.getElementById("edit-res-end-time"))==null?void 0:ae.value)==null?void 0:re.trim())||"00:00",v=((ie=document.getElementById("edit-res-notes"))==null?void 0:ie.value)||"",b=g(((oe=document.getElementById("edit-res-discount"))==null?void 0:oe.value)||"0"),h=parseFloat(b)||0,w=((ce=document.getElementById("edit-res-discount-type"))==null?void 0:ce.value)||"percent",T=((O=document.getElementById("edit-res-confirmed"))==null?void 0:O.checked)||!1,y=((J=document.getElementById("edit-res-paid"))==null?void 0:J.value)||"unpaid",u=((K=document.getElementById("edit-res-project"))==null?void 0:K.value)||"",p=Rn();if(!l||!m){f(r("reservations.toast.requireDates","⚠️ يرجى تحديد تاريخ البداية والنهاية"));return}const C=typeof e=="function"?e:(H,le)=>`${H}T${le||"00:00"}`,I=C(l,c),S=C(m,d);if(I&&S&&new Date(I)>new Date(S)){f(r("reservations.toast.invalidDateOrder","⚠️ تاريخ البداية لا يمكن أن يكون بعد تاريخ النهاية"));return}const{reservations:B}=A(),E=B==null?void 0:B[we];if(!E){f(r("reservations.toast.reservationMissing","⚠️ تعذر العثور على الحجز المطلوب"));return}if(!Array.isArray(Q)||Q.length===0){f(r("reservations.toast.updateNoItems","⚠️ لا يمكن حفظ التعديلات لعدم وجود معدات"));return}for(const H of Q)if(ve(H.barcode)){f(r("reservations.toast.updateEquipmentMaintenance","⚠️ لا يمكن حفظ التعديلات لأن إحدى المعدات قيد الصيانة"));return}const D=typeof t=="function"?t:()=>!1;for(const H of Q){const le=N(H.barcode);if(D(le,I,S,E.id??E.reservationId)){f(r("reservations.toast.updateEquipmentConflict","⚠️ لا يمكن حفظ التعديلات بسبب تعارض في أحد المعدات"));return}}const $=typeof n=="function"?n:()=>!1;for(const H of p)if($(H,I,S,E.id??E.reservationId)){f(r("reservations.toast.updateCrewConflict","⚠️ لا يمكن حفظ التعديلات بسبب تعارض في جدول أحد أعضاء الطاقم"));return}E.start=I,E.end=S,E.notes=v,E.discount=h,E.discountType=w;const L=document.getElementById("edit-res-tax"),x=!!u?!1:(L==null?void 0:L.checked)||!1;E.applyTax=x,E.confirmed=T,E.paid=y==="paid",E.items=[...Q],E.technicians=[...p],E.projectId=u?String(u):null,E.cost=mt(E.items||[],h,w,x,E.technicians||[],{start:I,end:S}),Y({reservations:B}),f(r("reservations.toast.updated","✅ تم حفظ التعديلات على الحجز")),s==null||s(),St(),o==null||o({type:"updated",reservation:E}),i==null||i(),a==null||a(),(Z=_==null?void 0:_.hide)==null||Z.call(_)}function Ns(e={}){He={...e};const{updateEditReservationSummary:t,addEquipmentToEditingReservation:n,addEquipmentByDescription:s,renderEditItems:i}=He,a=document.getElementById("edit-res-discount");a&&!a.dataset.listenerAttached&&(a.addEventListener("input",()=>{a.value=g(a.value),t==null||t()}),a.dataset.listenerAttached="true");const o=document.getElementById("edit-res-discount-type");o&&!o.dataset.listenerAttached&&(o.addEventListener("change",()=>t==null?void 0:t()),o.dataset.listenerAttached="true");const l=document.getElementById("edit-res-tax");l&&!l.dataset.listenerAttached&&(l.addEventListener("change",()=>t==null?void 0:t()),l.dataset.listenerAttached="true");const c=document.getElementById("edit-res-project");c&&!c.dataset.listenerAttached&&(c.addEventListener("change",()=>{Ct(),t==null||t()}),c.dataset.listenerAttached="true");const m=document.getElementById("save-reservation-changes");m&&!m.dataset.listenerAttached&&(m.addEventListener("click",()=>Es(He)),m.dataset.listenerAttached="true");const d=document.getElementById("edit-res-equipment-barcode");d&&!d.dataset.listenerAttached&&(d.addEventListener("keydown",h=>{h.key==="Enter"&&(h.preventDefault(),n==null||n(d))}),d.dataset.listenerAttached="true");const v=document.getElementById("edit-res-equipment-description");v&&!v.dataset.listenerAttached&&(v.addEventListener("keydown",h=>{h.key==="Enter"&&(h.preventDefault(),s==null||s(v,"edit"))}),v.dataset.listenerAttached="true");const b=document.getElementById("editReservationModal");b&&!b.dataset.cleanupAttached&&(b.addEventListener("hidden.bs.modal",()=>{St(),t==null||t(),i==null||i([])}),b.dataset.cleanupAttached="true")}function Qe(){var i,a,o,l,c,m,d,v;const e=(a=(i=document.getElementById("edit-res-start"))==null?void 0:i.value)==null?void 0:a.trim(),t=(l=(o=document.getElementById("edit-res-end"))==null?void 0:o.value)==null?void 0:l.trim(),n=((m=(c=document.getElementById("edit-res-start-time"))==null?void 0:c.value)==null?void 0:m.trim())||"00:00",s=((v=(d=document.getElementById("edit-res-end-time"))==null?void 0:d.value)==null?void 0:v.trim())||"00:00";return!e||!t?{start:null,end:null}:{start:Ee(e,n),end:Ee(t,s)}}function je(e=[]){const t=document.getElementById("edit-res-items");if(!t)return;const n=r("reservations.create.equipment.none","لا توجد معدات"),s=r("reservations.create.summary.currency","ريال"),i=r("reservations.create.equipment.imageAlt","صورة");if(!e||e.length===0){t.innerHTML=`<tr><td colspan="6" class="text-center">${n}</td></tr>`;return}t.innerHTML=e.map((a,o)=>{const l=Ce(a),c=`${g(String(a.price??0))} ${s}`,m=g(String(a.qty||1)),d=l?`<img src="${l}" alt="${i}" class="reservation-item-thumb">`:"-";return`
        <tr>
          <td>${a.barcode||"-"}</td>
          <td>${a.desc||"-"}</td>
          <td>${c}</td>
          <td>${m}</td>
          <td>${d}</td>
          <td><button type="button" class="btn btn-sm btn-danger" onclick="removeEditReservationItem(${o})">🗑️</button></td>
        </tr>
      `}).join("")}function Te(){var w;const e=document.getElementById("edit-res-summary");if(!e)return;const t=document.getElementById("edit-res-discount"),n=document.getElementById("edit-res-discount-type"),s=document.getElementById("edit-res-paid");s&&!s.dataset.listenerAttached&&(s.addEventListener("change",Te),s.dataset.listenerAttached="true");const i=g((t==null?void 0:t.value)||"0");t&&(t.value=i);const a=parseFloat(i)||0,o=(n==null?void 0:n.value)||"percent",l=!!((w=document.getElementById("edit-res-project"))!=null&&w.value),c=document.getElementById("edit-res-tax"),m=l?!1:(c==null?void 0:c.checked)||!1,d=(s==null?void 0:s.value)||"unpaid",{items:v=[]}=$e(),{start:b,end:h}=Qe();e.innerHTML=Pn({items:v,discount:a,discountType:o,applyTax:m,paidStatus:d,start:b,end:h})}function ws(e){if(e==null)return;const{index:t,items:n}=$e();if(!Array.isArray(n))return;const s=n.filter((i,a)=>a!==e);Ne(t,s),je(s),Te()}function Is(e){const t=(e==null?void 0:e.value)??"",n=N(t);if(!n)return;const s=Jn(n);if(!s){f(r("reservations.toast.barcodeNotInCatalog","❌ الباركود غير موجود ضمن المعدات"));return}if(ve(n)){f(r("reservations.toast.equipmentMaintenance","⚠️ هذه المعدة قيد الصيانة ولا يمكن إضافتها حالياً"));return}const i=N(n),{index:a,items:o=[]}=$e();if(o.findIndex(w=>N(w.barcode)===i)>-1){f(r("reservations.toast.equipmentDuplicate","⚠️ هذه المعدة موجودة بالفعل في الحجز"));return}const{start:c,end:m}=Qe();if(!c||!m){f(r("reservations.toast.requireDatesBeforeAdd","⚠️ يرجى تحديد تاريخ ووقت البداية والنهاية قبل إضافة المعدات"));return}const{reservations:d=[]}=A(),v=a!=null&&d[a]||null,b=(v==null?void 0:v.id)??(v==null?void 0:v.reservationId)??null;if(pe(i,c,m,b)){f(r("reservations.toast.equipmentTimeConflictSimple","⚠️ هذه المعدة محجوزة في نفس الفترة الزمنية"));return}const h=[...o,{id:s.id,barcode:i,desc:s.desc,qty:1,price:s.price,image:s.image||s.imageUrl||s.img||null}];Ne(a,h),e&&(e.value=""),je(h),Te()}function Ge(e){if(!e)return;const t=e.value.trim();if(!t)return;const n=yt(t),s=N((n==null?void 0:n.barcode)||t);if(!n||!s){f(r("reservations.toast.equipmentNameNotFound","❌ لم يتم العثور على معدة بالاسم المدخل"));return}if(ve(s)){f(r("reservations.toast.equipmentMaintenanceStrict","⚠️ لا يمكن إضافة معدة قيد الصيانة إلى الحجز"));return}const{start:i,end:a}=Qe();if(!i||!a){f(r("reservations.toast.requireOverallDates","⚠️ يرجى تحديد تواريخ الحجز قبل إضافة المعدات"));return}const{index:o,items:l=[]}=$e();if(l.some(h=>N(h.barcode)===s)){f(r("reservations.toast.equipmentDuplicate","⚠️ هذه المعدة موجودة بالفعل في الحجز"));return}const{reservations:m=[]}=A(),d=o!=null&&m[o]||null,v=(d==null?void 0:d.id)??(d==null?void 0:d.reservationId)??null;if(pe(s,i,a,v)){f(r("reservations.toast.equipmentTimeConflictSimple","⚠️ هذه المعدة محجوزة في نفس الفترة الزمنية"));return}const b=[...l,{id:n.id,barcode:s,desc:n.desc,qty:1,price:n.price,image:n.image||n.imageUrl||n.img||null}];Ne(o,b),je(b),Te(),e.value=""}function Ss(){const e=document.getElementById("edit-res-equipment-description");e&&!e.dataset.listenerAttached&&(e.addEventListener("keydown",t=>{t.key==="Enter"&&(t.preventDefault(),Ge(e))}),e.dataset.listenerAttached="true")}function Cs(e,t="create"){if(!(!e||!e.value.trim())){if(t==="create"){qt(e);return}Ge(e)}}function js(){fe(),Ss()}function Bs(e,t){var s;const n=document.getElementById(e);if(n){if(n._flatpickr){if(t){const i=((s=n._flatpickr.config)==null?void 0:s.dateFormat)||"Y-m-d";n._flatpickr.setDate(t,!1,i)}else n._flatpickr.clear();return}n.value=t||""}}function Rs(){const{technicians:e}=A();Fn(e||[]),Et()}function Je(e=null){Et(),Bt(),typeof window.refreshCustomerReservationsViews=="function"&&window.refreshCustomerReservationsViews(),typeof window.refreshTechnicianReservationsViews=="function"&&window.refreshTechnicianReservationsViews();const t=e!=null?{detail:e}:{};document.dispatchEvent(new CustomEvent("reservations:changed",t))}function Ts(e){var t;return e?(t=window==null?void 0:window.bootstrap)!=null&&t.Modal?window.bootstrap.Modal.getOrCreateInstance(e):typeof bootstrap<"u"&&(bootstrap!=null&&bootstrap.Modal)?bootstrap.Modal.getOrCreateInstance(e):null:null}function Xe(){return{populateEquipmentDescriptionLists:fe,setFlatpickrValue:Bs,splitDateTime:pt,renderEditItems:je,updateEditReservationSummary:Te,addEquipmentByDescription:Cs,addEquipmentToEditingReservation:Is,addEquipmentToEditingByDescription:Ge,combineDateTime:Ee,hasEquipmentConflict:pe,hasTechnicianConflict:ut,renderReservations:Bt,handleReservationsMutation:Je,ensureModal:Ts}}function Bt(e="reservations-list",t=null){fs({containerId:e,filters:t,onShowDetails:Tt,onConfirmReservation:At})}function Tt(e){return bs(e,{getEditContext:Xe,onEdit:(t,{reservation:n})=>{kt(t,n)},onDelete:xt})}function xt(e){return window.confirm(r("reservations.toast.deleteConfirm","⚠️ هل أنت متأكد من حذف هذا الحجز؟"))?hs(e,{onAfterChange:Je}):!1}function At(e){return gs(e,{onAfterChange:Je})}function kt(e,t=null){if(document.getElementById("reservation-form")){st(e,Xe());return}if(document.getElementById("editReservationModal")){st(e,Xe());return}if(t!=null&&t.id||t!=null&&t.reservationId){const n=t.id??t.reservationId;localStorage.setItem("pendingReservationEditId",String(n))}else localStorage.setItem("pendingReservationEditId",String(e));window.location.href="dashboard.html#reservations"}function Ms(){typeof window>"u"||(window.showReservationDetails=Tt,window.deleteReservation=xt,window.confirmReservation=At,window.editReservation=kt,window.removeEditReservationItem=ws)}export{Bt as a,wt as b,Tt as c,Ms as d,Ls as e,$s as f,Ns as g,js as h,qe as i,Et as j,Te as k,Rs as l,Xe as m,P as n,Je as o,G as p,W as r,ze as s,Ds as u};
