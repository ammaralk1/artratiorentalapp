import{n as y,t as d,s as g}from"./auth-CNAfl19F.js";import{l as N,s as ge}from"./storage-DOnDLvtb.js";let $=[],he=[],pe=[];function tt(){return $}function nt(e){$=Array.isArray(e)?e:[]}function it(e){$=[...$,e]}function at(e){Number.isInteger(e)&&e>=0&&($=$.filter((t,n)=>n!==e))}function ct(){return he}function st(e){he=Array.isArray(e)?e:[]}function rt(){return pe}function ot(e){pe=Array.isArray(e)?e:[]}function lt(e){if(!e)return{date:"",time:""};const[t="",n=""]=e.split("T"),i=n?n.slice(0,5):"";return{date:t,time:i}}function z(e,t){if(!e)return"";const n=t&&t.length?t:"00:00";return`${e}T${n}`}function le(e){return y(String(e||"")).trim().toLowerCase()}function dt(e,t,n,i=null){if(!e||!t||!n)return!1;const a=new Date(t),c=new Date(n);if(Number.isNaN(a.getTime())||Number.isNaN(c.getTime()))return!1;const{reservations:s=[]}=N(),l=le(e);return s.some(r=>{if(!r||!r.items||r.items.length===0||i&&(String(r.id)===String(i)||String(r.reservationId)===String(i))||!r.start||!r.end)return!1;const o=new Date(r.start),u=new Date(r.end);return Number.isNaN(o.getTime())||Number.isNaN(u.getTime())||!(o<c&&u>a)?!1:r.items.some(f=>le(f==null?void 0:f.barcode)===l)})}function $e(e,t,n,i=null){if(!e||!t||!n)return!1;const a=new Date(t),c=new Date(n);if(Number.isNaN(a.getTime())||Number.isNaN(c.getTime()))return!1;const{reservations:s=[]}=N(),l=String(e);return s.some(r=>{if(!(r!=null&&r.start)||!(r!=null&&r.end)||i&&(String(r.id)===String(i)||String(r.reservationId)===String(i)))return!1;const o=new Date(r.start),u=new Date(r.end);return Number.isNaN(o.getTime())||Number.isNaN(u.getTime())||!(o<c&&u>a)?!1:(Array.isArray(r.technicians)?r.technicians:[]).some(h=>String(h)===l)})}let b=null,de=!1;function k(){const{technicians:e=[]}=N();return Array.isArray(e)?e:[]}function ye(){document.dispatchEvent(new CustomEvent("technicians:updated"))}function _(e){ge({technicians:e}),ye()}function F(e=""){return y(String(e)).trim().toLowerCase()}function ue(e){return e==null?"":String(e)}function B(e=""){return y(String(e)).replace(/[^0-9+]/g,"")}function C(e=""){const t=y(String(e)).replace(/[^0-9.]/g,"");if(!t.includes("."))return t;const[n,...i]=t.split(".");return`${n}.${i.join("")}`}function R(e,t){!e||e.dataset.normalizerAttached||(e.addEventListener("input",()=>{const n=t(e.value);if(e.value!==n){const i=e.selectionEnd;e.value=n,i!=null&&e.setSelectionRange(n.length,n.length)}}),e.dataset.normalizerAttached="true")}function O(e="add"){const t=document.getElementById("technician-submit-btn");if(!t)return;const n=e==="update"?"technicians.form.actions.update":"technicians.form.actions.submit",i=e==="update"?"💾 حفظ التعديل":"➕ إضافة عضو طاقم";t.textContent=d(n,i)}function U(e){const t=document.getElementById("technician-cancel-btn");t&&(e?t.classList.remove("d-none"):t.classList.add("d-none"),t.textContent=d("technicians.form.actions.cancel","إلغاء التعديل"))}function K(){O(b?"update":"add"),U(!!b),v()}function Ce(e=[]){const t=document.getElementById("technician-role-filter");if(!t)return"";const n=t.value,i=Array.from(new Set(e.map(c=>((c==null?void 0:c.role)||"").trim()).filter(Boolean))).sort((c,s)=>c.localeCompare(s,"ar",{sensitivity:"base"})),a=d("technicians.search.filters.allRoles","👔 كل الوظائف");return t.innerHTML=`<option value="">${a}</option>`+i.map(c=>`<option value="${c}">${c}</option>`).join(""),n&&i.includes(n)?t.value=n:t.value="",t.value}function P(){const e=document.getElementById("technician-form");if(!e)return;e.reset();const t=document.getElementById("technician-status");t&&(t.value="available"),b=null,O("add"),U(!1)}function De(e){const t=document.getElementById("technician-name"),n=document.getElementById("technician-phone"),i=document.getElementById("technician-role"),a=document.getElementById("technician-department"),c=document.getElementById("technician-wage"),s=document.getElementById("technician-status"),l=document.getElementById("technician-notes");!t||!n||!i||!c||!s||(t.value=e.name||"",n.value=B(e.phone||""),i.value=e.role||"",a&&(a.value=e.department||""),c.value=C(e.dailyWage!=null?e.dailyWage:""),s.value=e.baseStatus||e.status||"available",l&&(l.value=e.notes||""),b=String(e.id),O("update"),U(!0))}function ke(){const e=document.getElementById("technician-name"),t=document.getElementById("technician-phone"),n=document.getElementById("technician-role"),i=document.getElementById("technician-department"),a=document.getElementById("technician-wage"),c=document.getElementById("technician-status"),s=document.getElementById("technician-notes");if(!e||!t||!n||!a||!c)return null;const l=e.value.trim(),r=B(t.value.trim());t.value=r;const o=n.value.trim(),u=(i==null?void 0:i.value.trim())||"",m=C(a.value.trim());a.value=m;const f=m===""?0:parseFloat(m),h=c.value||"available",p=(s==null?void 0:s.value.trim())||"";return l?r?o?Number.isNaN(f)||f<0?(g(d("technicians.toast.invalidWage","⚠️ أدخل قيمة صحيحة للأجر اليومي")),a.focus(),null):{name:l,phone:r,role:o,department:u,dailyWage:Number.isFinite(f)?f:0,status:h,baseStatus:h,notes:p}:(g(d("technicians.toast.missingRole","⚠️ يرجى إدخال الوظيفة")),n.focus(),null):(g(d("technicians.toast.missingPhone","⚠️ يرجى إدخال رقم التواصل")),t.focus(),null):(g(d("technicians.toast.missingName","⚠️ يرجى إدخال اسم عضو الطاقم")),e.focus(),null)}function xe(e){e.preventDefault();const t=ke();if(!t)return;const n=k();let i=d("technicians.toast.addSuccess","✅ تم إضافة عضو الطاقم");if(b){const a=n.findIndex(c=>String(c.id)===String(b));if(a===-1){g(d("technicians.toast.notFound","⚠️ تعذر العثور على عضو الطاقم المطلوب"));return}n[a]={...n[a],...t,id:b},i=d("technicians.toast.updateSuccess","💾 تم حفظ بيانات عضو الطاقم")}else{const a=Date.now().toString();n.push({id:a,...t})}_(n),g(i),P(),v()}function Me(){P()}function ze(e){const t={id:document.getElementById("edit-technician-id"),name:document.getElementById("edit-technician-name"),phone:document.getElementById("edit-technician-phone"),role:document.getElementById("edit-technician-role"),department:document.getElementById("edit-technician-department"),wage:document.getElementById("edit-technician-wage"),status:document.getElementById("edit-technician-status"),notes:document.getElementById("edit-technician-notes")};if(!t.id||!t.name||!t.phone||!t.role||!t.wage||!t.status)return;t.id.value=e.id||"",t.name.value!==(e.name||"")&&(t.name.value=e.name||"");const n=B(e.phone||"");t.phone.value!==n&&(t.phone.value=n),t.role.value!==(e.role||"")&&(t.role.value=e.role||""),t.department&&t.department.value!==(e.department||"")&&(t.department.value=e.department||"");const i=C(e.dailyWage!=null?e.dailyWage:"");t.wage.value!==i&&(t.wage.value=i);const a=e.baseStatus||e.status||"available";t.status.value!==a&&(t.status.value=a),t.notes&&t.notes.value!==(e.notes||"")&&(t.notes.value=e.notes||""),R(t.phone,B),R(t.wage,C)}function Fe(){const e=document.getElementById("edit-technician-id"),t=document.getElementById("edit-technician-name"),n=document.getElementById("edit-technician-phone"),i=document.getElementById("edit-technician-role"),a=document.getElementById("edit-technician-department"),c=document.getElementById("edit-technician-wage"),s=document.getElementById("edit-technician-status"),l=document.getElementById("edit-technician-notes");if(!e||!t||!n||!i||!c||!s)return null;const r=e.value.trim(),o=t.value.trim(),u=B(n.value.trim());n.value=u;const m=i.value.trim(),f=(a==null?void 0:a.value.trim())||"",h=C(c.value.trim());c.value=h;const p=h===""?0:parseFloat(h),I=s.value||"available",w=(l==null?void 0:l.value.trim())||"";return r?o?u?m?Number.isNaN(p)||p<0?(g(d("technicians.toast.invalidWage","⚠️ أدخل قيمة صحيحة للأجر اليومي")),c.focus(),null):{id:r,name:o,phone:u,role:m,department:f,dailyWage:Number.isFinite(p)?p:0,status:I,baseStatus:I,notes:w}:(g(d("technicians.toast.missingRole","⚠️ يرجى إدخال الوظيفة")),i.focus(),null):(g(d("technicians.toast.missingPhone","⚠️ يرجى إدخال رقم التواصل")),n.focus(),null):(g(d("technicians.toast.missingName","⚠️ يرجى إدخال اسم عضو الطاقم")),t.focus(),null):(g(d("technicians.toast.unidentified","⚠️ تعذر تحديد عضو الطاقم المطلوب")),null)}function Re(){var a,c;const e=Fe();if(!e)return;const t=k(),n=t.findIndex(s=>String(s.id)===String(e.id));if(n===-1){g(d("technicians.toast.notFound","⚠️ تعذر العثور على عضو الطاقم المطلوب"));return}t[n]={...t[n],...e},_(t),g(d("technicians.toast.updateSuccess","💾 تم حفظ بيانات عضو الطاقم"));const i=document.getElementById("editTechnicianModal");i&&((a=window.bootstrap)!=null&&a.Modal)&&((c=window.bootstrap.Modal.getInstance(i))==null||c.hide()),v()}function v(){const e=document.getElementById("technicians-table");if(!e)return;const t=document.getElementById("search-technician-input"),n=F((t==null?void 0:t.value)||""),i=ve(),{reservations:a=[]}=N(),c=new Date;Ce(i);const s=document.getElementById("technician-role-filter"),l=F((s==null?void 0:s.value)||""),r=i.filter(o=>l&&F(o.role||"")!==l?!1:n?F([o.name,o.phone,o.role,o.department,o.notes].filter(Boolean).join(" ")).includes(n):!0);if(r.length===0){const o=d("technicians.table.empty","لا يوجد أعضاء في الطاقم بعد.");e.innerHTML=`<tr><td colspan='8' class='text-center'>${o}</td></tr>`;return}e.innerHTML=r.map(o=>{const u=b&&String(b)===String(o.id),h=(be(o.id,a,c)?"busy":o.status||o.baseStatus||"available")==="busy"?{label:d("technicians.status.busy","⛔ مشغول"),className:"badge bg-danger"}:{label:d("technicians.status.available","✅ متاح"),className:"badge bg-success"},p=Number(o.dailyWage),w=(Number.isFinite(p)?p:0).toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:2}),A=B(o.phone||""),L=d("technicians.table.wageSuffix","ريال"),x=d("technicians.actions.edit","✏️ تعديل"),M=d("technicians.actions.delete","🗑️ حذف");return`
      <tr${u?' class="table-info"':""}>
        <td><a href="technician.html?id=${o.id}" class="text-decoration-none">${o.name}</a></td>
        <td>${A}</td>
        <td>${o.role||""}</td>
        <td>${o.department||"—"}</td>
        <td>${w} ${L}</td>
        <td><span class="${h.className}">${h.label}</span></td>
        <td class="table-notes-cell">${o.notes||"—"}</td>
        <td class="table-actions-cell">
          <div class="table-action-buttons">
            <button class="btn btn-sm btn-warning technician-edit-btn" data-id="${o.id}">${x}</button>
            <button class="btn btn-sm btn-danger technician-delete-btn" data-id="${o.id}">${M}</button>
          </div>
        </td>
      </tr>
    `}).join("")}function We(e){const t=k().find(n=>String(n.id)===String(e));if(!t){g(d("technicians.toast.dataNotFound","⚠️ تعذر العثور على بيانات عضو الطاقم"));return}De(t),g(d("technicians.toast.editReady","✏️ يمكنك تعديل بيانات عضو الطاقم الآن ثم الضغط على حفظ التعديل"))}function qe(e){if(!confirm(d("technicians.toast.deleteConfirm","⚠️ هل أنت متأكد من حذف هذا العضو؟")))return;const t=k().filter(n=>String(n.id)!==String(e));_(t),g(d("technicians.toast.deleteSuccess","🗑️ تم حذف عضو الطاقم")),b&&String(b)===String(e)&&P(),v()}function ut(){Y(),v()}function mt(e){return k().find(t=>String(t.id)===String(e))||null}function be(e,t=[],n){const i=ue(e);return i?t.some(a=>{if(!a||!a.start||!a.end||!(Array.isArray(a.technicians)?a.technicians:[]).some(r=>ue(r)===i))return!1;const s=new Date(a.start),l=new Date(a.end);return Number.isNaN(s.getTime())||Number.isNaN(l.getTime())?!1:s<=n&&n<l}):!1}function ve(){const{technicians:e=[],reservations:t=[]}=N();if(!Array.isArray(e)||e.length===0)return Array.isArray(e)?e:[];const n=new Date;let i=!1;const a=e.map(c=>{if(!c)return c;const s=c.baseStatus||c.status||"available";let l=s==="busy"?"busy":"available";return be(c.id,t,n)&&(l="busy"),(l!==c.status||s!==c.baseStatus)&&(i=!0),{...c,baseStatus:s,status:l}});return i?(ge({technicians:a}),ye(),a):e}function Y(){const e=document.getElementById("technician-form"),t=e&&!e.dataset.initialized;e&&!e.dataset.listenerAttached&&(e.addEventListener("submit",xe),e.dataset.listenerAttached="true"),e&&(e.dataset.initialized="true");const n=document.getElementById("technician-cancel-btn");n&&!n.dataset.listenerAttached&&(n.addEventListener("click",Me),n.dataset.listenerAttached="true"),R(document.getElementById("technician-phone"),B),R(document.getElementById("technician-wage"),C);const i=document.getElementById("technicians-table");i&&!i.dataset.listenerAttached&&(i.addEventListener("click",l=>{const r=l.target;if(r instanceof HTMLElement){if(r.classList.contains("technician-edit-btn")){const o=r.dataset.id;We(o)}if(r.classList.contains("technician-delete-btn")){const o=r.dataset.id;qe(o)}}}),i.dataset.listenerAttached="true");const a=document.getElementById("search-technician-input");a&&!a.dataset.listenerAttached&&(a.addEventListener("input",()=>{a.value=y(a.value),v()}),a.dataset.listenerAttached="true");const c=document.getElementById("technician-role-filter");c&&!c.dataset.listenerAttached&&(c.addEventListener("change",()=>{v()}),c.dataset.listenerAttached="true");const s=document.getElementById("save-technician-changes");s&&!s.dataset.listenerAttached&&(s.addEventListener("click",Re),s.dataset.listenerAttached="true"),de||(document.addEventListener("technician:prefill",l=>{const r=l.detail;r&&ze(r)}),de=!0),t&&P()}document.addEventListener("DOMContentLoaded",()=>{Y(),v(),K()});document.addEventListener("technicians:updated",()=>{v()});document.addEventListener("technicians:refreshRequested",()=>{Y(),v(),K()});document.addEventListener("language:changed",()=>{K()});let T=[],S=[],E=[],W="create",G=()=>{},J=()=>{};function He(e={}){const t=[e.dailyWage,e.daily_rate,e.dailyRate,e.wage,e.rate];for(const n of t){if(n==null||n==="")continue;const i=y(String(n)),a=Number.parseFloat(i);if(Number.isFinite(a))return a}return 0}function Se(e={}){const t=He(e);if(!Number.isFinite(t)||t<=0)return"—";const n=d("technicians.table.wageSuffix","ريال");return`${y(String(t))} ${n}`}function me(e=""){return y(String(e)).trim().toLowerCase()}function Ee(e){return!T||!T.length?null:T.find(t=>String(t==null?void 0:t.id)===String(e))||null}function Pe(e,t="create"){t==="edit"?Z(E.filter(n=>String(n)!==String(e))):X(S.filter(n=>String(n)!==String(e)))}function q(e,t=[],n){const i=document.getElementById(e);if(i){if(!t||t.length===0){const a=d("reservations.crew.none","لم يتم اختيار أي عضو من الطاقم.");i.innerHTML=`<span class="text-muted">${a}</span>`;return}i.innerHTML=t.map(a=>{const c=Ee(a)||{},s=d("reservations.crew.fallbackName","عضو الطاقم {id}").replace("{id}",a),l=c.name||s,r=c.role?`<small class="technician-chip-role">${c.role}</small>`:"",o=Se(c),u=o!=="—"?`<small class="technician-chip-wage">💰 ${o}</small>`:"",m=d("reservations.crew.removeAria","إزالة");return`
        <span class="technician-chip" data-id="${a}">
          <span class="technician-chip-name">${l}</span>
          ${r}
          ${u}
          <button type="button" class="technician-chip-remove" data-context="${n}" data-id="${a}" aria-label="${m}">✖</button>
        </span>
      `}).join(""),i.querySelectorAll(".technician-chip-remove").forEach(a=>{a.dataset.listenerAttached||(a.addEventListener("click",()=>Pe(a.dataset.id,a.dataset.context)),a.dataset.listenerAttached="true")})}}function Ie(){return W==="edit"?E:S}function H(){const e=document.querySelector("#technician-picker-table tbody");if(!e)return;const t=document.getElementById("technician-picker-search"),n=me((t==null?void 0:t.value)||""),i=new Set(Ie().map(String)),c=(T||[]).filter(s=>n?me([s.name,s.phone,s.role,s.department,s.notes].filter(Boolean).join(" ")).includes(n):!0);if(c.length===0){const s=d("reservations.crew.searchEmpty","لا يوجد نتائج مطابقة.");e.innerHTML=`<tr><td colspan="5" class="text-center text-muted">${s}</td></tr>`;return}e.innerHTML=c.map(s=>{const l=Se(s);return`
      <tr>
        <td style="width:40px;">
          <input class="form-check-input technician-picker-checkbox" type="checkbox" value="${s.id}" ${i.has(String(s.id))?"checked":""}>
        </td>
        <td>${s.name||"-"}</td>
        <td>${s.role||"—"}</td>
        <td>${s.department||"—"}</td>
        <td>${l}</td>
      </tr>
    `}).join("")}function je(){return Array.from(document.querySelectorAll(".technician-picker-checkbox:checked")).map(e=>e.value).filter(Boolean)}function Ve(e="create"){var l,r,o,u,m,f,h,p,I,w,A,L,x,M,te,ne,ie;if(e==="edit"){const ae=(r=(l=document.getElementById("edit-res-start"))==null?void 0:l.value)==null?void 0:r.trim(),ce=(u=(o=document.getElementById("edit-res-end"))==null?void 0:o.value)==null?void 0:u.trim(),Be=((f=(m=document.getElementById("edit-res-start-time"))==null?void 0:m.value)==null?void 0:f.trim())||"00:00",Ne=((p=(h=document.getElementById("edit-res-end-time"))==null?void 0:h.value)==null?void 0:p.trim())||"00:00",Ae=ae?z(ae,Be):null,Le=ce?z(ce,Ne):null;let se=null;const re=(I=document.getElementById("edit-res-index"))==null?void 0:I.value;if(re!=null){const oe=Number.parseInt(re,10);if(Number.isInteger(oe)){const{reservations:j=[]}=N(),V=j==null?void 0:j[oe];V&&(se=V.id??V.reservationId??null)}}return{start:Ae,end:Le,ignoreReservationId:se}}const t=(A=(w=document.getElementById("res-start"))==null?void 0:w.value)==null?void 0:A.trim(),n=(x=(L=document.getElementById("res-end"))==null?void 0:L.value)==null?void 0:x.trim(),i=((te=(M=document.getElementById("res-start-time"))==null?void 0:M.value)==null?void 0:te.trim())||"00:00",a=((ie=(ne=document.getElementById("res-end-time"))==null?void 0:ne.value)==null?void 0:ie.trim())||"00:00",c=t?z(t,i):null,s=n?z(n,a):null;return{start:c,end:s,ignoreReservationId:null}}function D(){const e=document.getElementById("technician-picker-selection-info");if(!e)return;const t=Ie().length;if(t){const n=d("reservations.crew.selectedCount","تم اختيار {count} عضو").replace("{count}",y(String(t)));e.textContent=n}else e.textContent=d("reservations.crew.noneShort","لم يتم اختيار أي عضو بعد")}function _e(){var c;const e=je().map(String),{start:t,end:n,ignoreReservationId:i}=Ve(W);if(t&&n){const s=e.filter(l=>$e(l,t,n,i));if(s.length>0){const l=s.map(o=>{var u;return((u=Ee(o))==null?void 0:u.name)||o}).join(d("reservations.list.crew.separator","، ")),r=d("reservations.toast.technicianSelectionConflict","⚠️ لا يمكن اختيار {names} لأنهم مرتبطون بحجز آخر في نفس الفترة الزمنية").replace("{names}",l);s.forEach(o=>{const u=document.querySelector(`.technician-picker-checkbox[value="${CSS.escape(String(o))}"]`);u&&(u.checked=!1)}),g(r),D();return}}W==="edit"?Z(e):X(e),D();const a=document.getElementById("selectTechniciansModal");a&&((c=window.bootstrap)!=null&&c.Modal)&&window.bootstrap.Modal.getOrCreateInstance(a).hide()}function fe(e="create"){var a;W=e;const t=ve();Array.isArray(t)&&t.length&&(T=t);const n=document.getElementById("technician-picker-search");n&&(n.value=""),H(),D();const i=document.getElementById("selectTechniciansModal");i&&((a=window.bootstrap)!=null&&a.Modal)&&window.bootstrap.Modal.getOrCreateInstance(i).show()}function Oe(){var c;const e=document.getElementById("open-technician-picker");e&&!e.dataset.listenerAttached&&(e.addEventListener("click",()=>fe("create")),e.dataset.listenerAttached="true");const t=document.getElementById("open-edit-technician-picker");t&&!t.dataset.listenerAttached&&(t.addEventListener("click",()=>fe("edit")),t.dataset.listenerAttached="true");const n=document.getElementById("technician-picker-search");n&&!n.dataset.listenerAttached&&(n.addEventListener("input",()=>{H(),D()}),n.dataset.listenerAttached="true");const i=document.getElementById("apply-technician-selection");i&&!i.dataset.listenerAttached&&(i.addEventListener("click",_e),i.dataset.listenerAttached="true");const a=document.getElementById("selectTechniciansModal");a&&!a.dataset.listenerAttached&&((c=window.bootstrap)!=null&&c.Modal)&&(a.addEventListener("shown.bs.modal",()=>{D(),H()}),a.addEventListener("hidden.bs.modal",()=>{const s=document.getElementById("technician-picker-search");s&&(s.value="")}),a.dataset.listenerAttached="true"),Q()}function Q(){q("selected-technicians-list",S,"create"),q("edit-selected-technicians-list",E,"edit")}function ft({onDraftChange:e,onEditChange:t}={}){G=typeof e=="function"?e:()=>{},J=typeof t=="function"?t:()=>{},Q(),Oe()}function Ue(e=[]){T=Array.isArray(e)?e:[]}function Ke(){return[...S]}function Ye(){return[...E]}function X(e=[]){S=Array.isArray(e)?e.map(String):[],q("selected-technicians-list",S,"create"),G()}function Z(e=[]){E=Array.isArray(e)?e.map(String):[],q("edit-selected-technicians-list",E,"edit"),J()}function gt(){X([])}function ht(){Z([])}function pt(e=[]){Ue(e);const t=new Set(T.map(l=>String(l.id))),n=S.filter(l=>t.has(String(l))),i=E.filter(l=>t.has(String(l))),a=n.length!==S.length,c=i.length!==E.length;S=n,E=i,Q(),a&&G(),c&&J();const s=document.getElementById("selectTechniciansModal");s&&s.classList.contains("show")&&(H(),D())}function Ge(e={}){const t=[e.dailyWage,e.daily_rate,e.dailyRate,e.wage,e.rate];for(const n of t){const i=Number(n);if(Number.isFinite(i))return i}return 0}function Je(e=[]){if(!Array.isArray(e)||e.length===0)return 0;const{technicians:t=[]}=N();if(!Array.isArray(t)||t.length===0)return 0;const n=new Map(t.filter(i=>i&&(i.id!=null||i.ID!=null)).map(i=>[String(i.id??i.ID),i]));return e.reduce((i,a)=>{const c=n.get(String(a));return c?i+Ge(c):i},0)}const Qe=24*60*60*1e3;function ee(e,t){if(!e||!t)return 1;const n=new Date(e),i=new Date(t);if(Number.isNaN(n.getTime())||Number.isNaN(i.getTime()))return 1;const a=i.getTime()-n.getTime();if(a<=0)return 1;const c=a/Qe;return Math.max(1,Math.ceil(c))}function we(e=[],t=0,n="percent",i=!1,a=[],{start:c=null,end:s=null}={}){const l=ee(c,s),r=e.reduce((m,f)=>m+(f.qty||1)*(f.price||0),0)*l,o=Je(a);let u=r+o*l;return t&&(n==="percent"?u-=u*(t/100):n==="amount"&&(u-=t)),i&&(u+=u*.15),Math.max(0,Math.round(u))}function Te({total:e,itemsCount:t,rentalDays:n,techniciansCount:i,applyTax:a,paidStatus:c,totalKey:s="reservations.summary.total"}){const l=d("reservations.create.summary.currency","ريال"),r=y(String(e)),o=y(String(t)),u=y(String(n??1)),m=y(String(i)),f=a?d("reservations.summary.taxIncluded","شامل الضريبة 15%"):d("reservations.summary.taxExcluded","غير شامل الضريبة"),h=c==="paid"?d("reservations.create.paymentStatus.paid","مدفوع"):d("reservations.create.paymentStatus.unpaid","غير مدفوع"),p=d(s,"💰 التكلفة الإجمالية: <strong>{total} {currency}</strong>").replace("{total}",r).replace("{currency}",l),I=d("reservations.summary.itemsCount","📦 عدد المعدات: {count}").replace("{count}",o),w=d("reservations.summary.duration","⏱️ عدد الأيام: {count}").replace("{count}",u),A=d("reservations.summary.crewCount","😎 عدد الفريق: {count}").replace("{count}",m),L=d("reservations.summary.paymentLabel","💳 حالة الدفع: {status}").replace("{status}",h);return`
    <div class="alert alert-info">
      ${p}<br>
      ${I}<br>
      ${w}<br>
      ${A}<br>
      ${f}<br>
      ${L}
    </div>
  `}function yt({selectedItems:e,discount:t,discountType:n,applyTax:i,paidStatus:a,start:c,end:s}){const l=Ke(),r=l.length,o=ee(c,s),u=we(e,t,n,i,l,{start:c,end:s}),m=Te({total:u,itemsCount:e.length,rentalDays:o,techniciansCount:r,applyTax:i,paidStatus:a});Xe(m)}function bt({items:e,discount:t,discountType:n,applyTax:i,paidStatus:a,start:c,end:s}){const l=Ye(),r=l.length,o=ee(c,s),u=we(e,t,n,i,l,{start:c,end:s});return Te({total:u,itemsCount:e.length,rentalDays:o,techniciansCount:r,applyTax:i,paidStatus:a,totalKey:"reservations.summary.totalAfterEdit"})}function Xe(e){const t=document.getElementById("reservation-preview");t&&(t.innerHTML=e);const n=document.getElementById("reservation-preview-bottom");n&&(n.innerHTML=e)}export{bt as A,pt as a,we as b,ee as c,at as d,tt as e,it as f,mt as g,dt as h,ft as i,ct as j,yt as k,z as l,Ke as m,le as n,$e as o,lt as p,rt as q,ut as r,ve as s,gt as t,nt as u,ot as v,st as w,Z as x,Ye as y,ht as z};
