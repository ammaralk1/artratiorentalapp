import{l as C,a as L}from"./reservationsUI-Nf5UWmZI.js";import{t as r,n as S,s as p}from"./utils-BcYEmFqz.js";let d=null;function l(){return C().customers||[]}function g(t){L({customers:t})}function m(){return{form:document.getElementById("customer-form"),idInput:document.getElementById("customer-id"),nameInput:document.getElementById("customer-name"),phoneInput:document.getElementById("customer-phone"),emailInput:document.getElementById("customer-email"),addressInput:document.getElementById("customer-address"),companyInput:document.getElementById("customer-company"),notesInput:document.getElementById("customer-notes"),submitBtn:document.getElementById("submit-btn"),cancelBtn:document.getElementById("customer-cancel-btn")}}function b(t="add"){const{submitBtn:e}=m();if(!e)return;const n=t==="update"?"customers.form.actions.update":"customers.form.actions.submit",s=t==="update"?"💾 حفظ التعديل":"➕ إضافة عميل";e.textContent=r(n,s)}function I(t){const{cancelBtn:e}=m();e&&(t?e.classList.remove("d-none"):e.classList.add("d-none"),e.textContent=r("customers.form.actions.cancel","إلغاء التعديل"))}function B(){const t=!!d;b(t?"update":"add"),I(t)}function v(){const{form:t,idInput:e,phoneInput:n}=m();t==null||t.reset(),e&&(e.value=""),n&&(n.value=n.value.trim()),d=null,b("add"),I(!1)}function $(t){const{idInput:e,nameInput:n,phoneInput:s,emailInput:a,addressInput:i,companyInput:o,notesInput:u}=m();!t||!n||!s||(e&&(e.value=t.id),n.value=t.customerName||"",s.value=t.phone||"",a&&(a.value=t.email||""),i&&(i.value=t.address||""),o&&(o.value=t.companyName||""),u&&(u.value=t.notes||""),d=t.id,b("update"),I(!0))}function w(){const{idInput:t,nameInput:e,phoneInput:n,emailInput:s,addressInput:a,companyInput:i,notesInput:o}=m();if(!e||!n)return null;const u=e.value.trim(),c=n.value.trim();return n.value=c,!u||!c?(p(r("customers.toast.missingFields","يرجى تعبئة الاسم ورقم الهاتف"),"error"),null):{id:(t==null?void 0:t.value)||d||Date.now().toString(),customerName:u,phone:c,email:(s==null?void 0:s.value.trim())||"",address:(a==null?void 0:a.value.trim())||"",companyName:(i==null?void 0:i.value.trim())||"",notes:(o==null?void 0:o.value.trim())||""}}function N(t){t.preventDefault();const e=w();if(!e)return;const n=l(),s=n.findIndex(a=>String(a.id)===String(e.id));s>=0?(n[s]={...n[s],...e},g(n),p(r("customers.toast.updateSuccess","تم تحديث بيانات العميل بنجاح"))):(n.push(e),g(n),p(r("customers.toast.createSuccess","تمت إضافة العميل بنجاح"))),f(),v()}function x(t){const e=t.target;if(e instanceof HTMLElement){if(e.classList.contains("customer-delete-btn")){const n=e.dataset.id;if(!confirm(r("customers.toast.deleteConfirm","⚠️ هل أنت متأكد من حذف هذا العميل؟")))return;const s=l().filter(a=>String(a.id)!==String(n));g(s),f(),d===n&&v(),p(r("customers.toast.deleteSuccess","تم حذف العميل"));return}if(e.classList.contains("customer-edit-btn")){const n=e.dataset.id,s=l().find(a=>String(a.id)===String(n));if(!s)return;$(s)}}}function M(t){const e=t.target.value.trim().toLowerCase(),s=l().filter(i=>{var y,h,E;const o=((y=i.customerName)==null?void 0:y.toLowerCase())||"",u=((h=i.phone)==null?void 0:h.toLowerCase())||"",c=((E=i.companyName)==null?void 0:E.toLowerCase())||"";return o.includes(e)||u.includes(e)||c.includes(e)}),a=e?r("customers.table.noResults","لا توجد نتائج مطابقة"):void 0;f(s,{emptyMessage:a})}function D(){const{form:t,cancelBtn:e}=m();t&&t.addEventListener("submit",N),e&&e.addEventListener("click",()=>{v()});const n=document.getElementById("customers-table");n&&n.addEventListener("click",x);const s=document.getElementById("search-customer-input");s&&s.addEventListener("input",M)}document.addEventListener("DOMContentLoaded",()=>{D(),f(),B()});document.addEventListener("language:changed",()=>{B(),f()});function f(t,e={}){const n=Array.isArray(t)?t:l(),s=document.getElementById("customers-table");if(!s)return;if(s.innerHTML="",n.length===0){const o=e.emptyMessage||r("customers.table.empty","لا يوجد عملاء");s.innerHTML=`<tr><td colspan='6'>${o}</td></tr>`;return}const a=r("customers.actions.edit","✏️ تعديل"),i=r("customers.actions.delete","🗑️ حذف");n.forEach(o=>{const u=d&&String(d)===String(o.id),c=document.createElement("tr");u&&c.classList.add("table-info"),c.innerHTML=`
      <td><a href="customer.html?id=${o.id}" class="text-decoration-none">${o.customerName}</a></td>
      <td>${S(o.phone)}</td>
      <td>${o.companyName||""}</td>
      <td class="table-notes-cell">${o.notes||"—"}</td>
      <td class="table-actions-cell">
        <div class="table-action-buttons">
          <button class="btn btn-sm btn-warning customer-edit-btn" data-id="${o.id}">${a}</button>
          <button class="btn btn-sm btn-danger customer-delete-btn" data-id="${o.id}">${i}</button>
        </div>
      </td>
    `,s.appendChild(c)})}function F(t){const{customers:e=[]}=C();return e.find(n=>String(n.id)===String(t))}export{F as g,f as r};
