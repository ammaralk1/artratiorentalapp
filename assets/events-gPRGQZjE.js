import{r as Bt,s as m,t as o,n as q,c as An,f as Ne}from"./theme-C7llKhek.js";Bt({ar:{"actions.logout":"🚪 تسجيل الخروج","actions.toggleTheme":"🌙 الوضع الليلي","theme.toggle.toLight":"☀️ الوضع العادي","theme.toggle.toDark":"🌙 الوضع الليلي","theme.toggle.titleLight":"التبديل إلى الوضع العادي","theme.toggle.titleDark":"التبديل إلى الوضع الليلي","theme.toggle.ariaLight":"الوضع العادي مفعل","theme.toggle.ariaDark":"الوضع الليلي مفعل","language.toggle.labelAr":"🇸🇦 العربية","language.toggle.labelEn":"🇬🇧 English","actions.clearFilters":"🔄 إعادة التصفية"},en:{"actions.logout":"🚪 Log Out","actions.toggleTheme":"🌙 Dark Mode","theme.toggle.toLight":"☀️ Light Mode","theme.toggle.toDark":"🌙 Dark Mode","theme.toggle.titleLight":"Switch to Light Mode","theme.toggle.titleDark":"Switch to Dark Mode","theme.toggle.ariaLight":"Light mode enabled","theme.toggle.ariaDark":"Dark mode enabled","language.toggle.labelAr":"🇸🇦 Arabic","language.toggle.labelEn":"🇬🇧 English","actions.clearFilters":"🔄 Reset filters"}});Bt({ar:{"dashboard.header.greeting":"👋 أهلاً بك في لوحة التحكم","tabs.customers":"👤 العملاء","tabs.equipment":"🎥 المعدات","tabs.maintenance":"🛠️ الصيانة","tabs.technicians":"😎 طاقم العمل","tabs.reservations":"📅 الحجوزات","actions.close":"إغلاق","actions.cancel":"إلغاء","customers.section.title":"📋 إدارة العملاء","customers.form.title":"📋 إضافة / تعديل عميل","customers.form.hint":"حدّث بيانات العميل وسيتم مزامنتها مع الحجوزات والفواتير.","customers.form.labels.name":"👤 الاسم","customers.form.labels.phone":"📞 الجوال","customers.form.labels.email":"📧 البريد","customers.form.labels.address":"📍 العنوان","customers.form.labels.company":"🏢 الشركة","customers.form.labels.notes":"📝 الملاحظات","customers.form.placeholders.name":"اسم العميل","customers.form.placeholders.phone":"05xxxxxxxx","customers.form.placeholders.email":"example@email.com","customers.form.placeholders.address":"عنوان العميل","customers.form.placeholders.company":"اسم الشركة","customers.form.placeholders.notes":"معلومات إضافية أو تذكيرات","customers.form.actions.cancel":"إلغاء التعديل","customers.form.actions.submit":"➕ إضافة عميل","customers.form.actions.update":"💾 حفظ التعديل","customers.search.placeholder":"🔍 ابحث عن عميل بالاسم أو الجوال أو الشركة...","customers.table.headers.name":"👤 الاسم","customers.table.headers.phone":"📞 الجوال","customers.table.headers.company":"🏢 الشركة","customers.table.headers.notes":"📝 ملاحظات","customers.table.headers.actions":"⚙️ الإجراءات","customers.table.loading":"جاري التحميل...","customers.table.empty":"لا يوجد عملاء","customers.table.noResults":"لا توجد نتائج مطابقة","customers.actions.edit":"✏️ تعديل","customers.actions.delete":"🗑️ حذف","customers.toast.updateSuccess":"تم تحديث بيانات العميل بنجاح","customers.toast.createSuccess":"تمت إضافة العميل بنجاح","customers.toast.missingFields":"يرجى تعبئة الاسم ورقم الهاتف","customers.toast.deleteConfirm":"⚠️ هل أنت متأكد من حذف هذا العميل؟","customers.toast.deleteSuccess":"تم حذف العميل","equipment.section.title":"🎥 إدارة المعدات","equipment.actions.clearAll":"🗑️ مسح الكل","equipment.actions.uploadExcel":"📤 رفع من Excel","equipment.form.title":"🎥 إضافة معدة","equipment.form.hint":"أدخل بيانات المعدة ليتم حفظها ضمن قائمة المعدات.","equipment.form.labels.description":"📝 الوصف","equipment.form.placeholders.description":"وصف المعدة","equipment.form.labels.barcode":"🏷️ الباركود","equipment.form.placeholders.barcode":"الباركود","equipment.form.labels.price":"💵 السعر","equipment.form.placeholders.price":"0","equipment.form.labels.quantity":"🔢 الكمية","equipment.form.placeholders.quantity":"1","equipment.form.labels.image":"🖼️ رابط الصورة","equipment.form.placeholders.image":"https://...","equipment.form.labels.category":"📂 القسم","equipment.form.placeholders.category":"القسم","equipment.form.labels.subcategory":"📑 القسم الثانوي","equipment.form.placeholders.subcategory":"القسم الثانوي","equipment.form.labels.status":"⚙️ الحالة","equipment.form.options.available":"✅ متاح","equipment.form.options.booked":"📌 محجوز","equipment.form.options.maintenance":"🛠️ صيانة","equipment.form.actions.submit":"➕ إضافة معدة","equipment.filters.search":"🔍 ابحث عن معدة...","equipment.filters.status.all":"⚙️ كل الحالات","equipment.filters.category.all":"📂 كل الأقسام","equipment.filters.subcategory.all":"📑 كل الأقسام الثانوية","equipment.list.title":"📋 كل المعدات","equipment.modal.title":"✏️ تعديل بيانات المعدة","equipment.modal.placeholders.image":"ضع رابط مباشر للصورة","equipment.modal.actions.cancel":"❌ إلغاء","equipment.modal.actions.save":"💾 حفظ التعديلات","equipment.toast.xlsxMissing":"⚠️ مكتبة Excel (XLSX) غير محملة. تحقق من الروابط في dashboard.html","equipment.toast.uploadSuccess":"✅ تم رفع المعدات بنجاح","equipment.toast.uploadEmpty":"⚠️ الملف لا يحتوي على بيانات يمكن استيرادها","equipment.toast.uploadFailed":"❌ حدث خطأ أثناء قراءة ملف الإكسل","equipment.toast.clearConfirm":"⚠️ هل أنت متأكد من حذف كل المعدات؟","equipment.toast.clearSuccess":"🗑️ تم مسح جميع المعدات","equipment.toast.deleteConfirm":"❌ هل أنت متأكد من حذف هذه المعدة؟","equipment.toast.deleteSuccess":"🗑️ تم حذف المعدة","equipment.toast.editSuccess":"✏️ تم تعديل بيانات المعدة","equipment.toast.addSuccess":"✅ تم إضافة المعدة","equipment.toast.updateSuccess":"✅ تم تحديث بيانات المعدة بنجاح","equipment.toast.missingFields":"⚠️ يرجى إدخال الوصف والباركود","equipment.toast.duplicateBarcode":"⚠️ هذا الباركود مستخدم مسبقًا","equipment.list.emptyFiltered":"⚠️ لا توجد معدات مطابقة.","equipment.list.countSuffix":"عنصر","equipment.item.imageAlt":"صورة","equipment.item.currency":"ريال","equipment.item.actions.edit":"✏️ تعديل","equipment.item.actions.delete":"🗑️ حذف","reservations.tabs.create":"➕ إنشاء حجز","reservations.tabs.mine":"📋 حجوزاتي","reservations.tabs.reports":"📊 تقارير","reservations.tabs.calendar":"📅 التقويم","reservations.create.title":"➕ إنشاء حجز جديد","reservations.create.labels.startDate":"📅 تاريخ البداية","reservations.create.labels.startTime":"⏰ وقت البداية","reservations.create.labels.endDate":"📅 تاريخ النهاية","reservations.create.labels.endTime":"⏰ وقت النهاية","reservations.create.labels.client":"👤 العميل","reservations.create.placeholders.client":"اكتب اسم العميل...","reservations.create.labels.notes":"📝 ملاحظات","reservations.create.placeholders.notes":"اكتب أي ملاحظات إضافية...","reservations.create.equipment.title":"🎥 أضف المعدات","reservations.create.equipment.placeholders.barcode":"🔍 امسح أو أدخل الباركود ثم اضغط Enter","reservations.create.equipment.placeholders.description":"🎥 اكتب اسم المعدة ثم اضغط Enter","reservations.create.equipment.table.code":"الكود","reservations.create.equipment.table.description":"الوصف","reservations.create.equipment.table.price":"السعر","reservations.create.equipment.table.image":"الصورة","reservations.create.equipment.table.delete":"حذف","reservations.create.billing.title":"💵 الخصم والضريبة","reservations.create.billing.discount":"ادخل قيمة الخصم","reservations.create.billing.discountPercent":"٪ نسبة","reservations.create.billing.discountAmount":"💵 مبلغ","reservations.create.billing.taxLabel":"شامل الضريبة (15٪)","reservations.create.labels.paymentStatus":"💳 حالة الدفع","reservations.create.paymentStatus.paid":"مدفوع","reservations.create.paymentStatus.unpaid":"لم يتم الدفع","reservations.create.actions.submit":"💾 إنشاء الحجز","reservations.section.title":"📅 إدارة الحجوزات","reservations.crew.none":"لم يتم اختيار أي عضو من الطاقم.","reservations.crew.noneShort":"لم يتم اختيار أي عضو بعد","reservations.crew.selectedCount":"تم اختيار {count} عضو","reservations.crew.fallbackName":"عضو الطاقم {id}","reservations.crew.removeAria":"إزالة","reservations.crew.searchEmpty":"لا يوجد نتائج مطابقة.","reservations.create.equipment.noResults":"لا يوجد نتائج مطابقة.","reservations.create.equipment.noneAdded":"لا توجد معدات مضافة","reservations.create.equipment.none":"لا توجد معدات","reservations.create.summary.currency":"ريال","reservations.create.equipment.imageAlt":"صورة","reservations.summary.total":"💰 التكلفة الإجمالية: <strong>{total} {currency}</strong>","reservations.summary.totalAfterEdit":"💰 التكلفة بعد التعديل: <strong>{total} {currency}</strong>","reservations.summary.itemsCount":"📦 عدد المعدات: {count}","reservations.summary.crewCount":"😎 عدد الفريق: {count}","reservations.summary.taxIncluded":"شامل الضريبة 15%","reservations.summary.taxExcluded":"غير شامل الضريبة","reservations.summary.paymentLabel":"💳 حالة الدفع: {status}","reservations.toast.customerNotFound":"⚠️ لم يتم العثور على العميل بالاسم المدخل","reservations.toast.invalidDateOrder":"⚠️ تاريخ البداية لا يمكن أن يكون بعد تاريخ النهاية","reservations.toast.reservationMissing":"⚠️ تعذر العثور على الحجز المطلوب","reservations.list.title":"📋 حجوزاتي","reservations.list.search.placeholder":"🔍 ابحث باسم العميل أو الكود...","reservations.list.filters.start":"📅 من تاريخ","reservations.list.filters.end":"📅 إلى تاريخ","reservations.list.filters.range.all":"⏱️ كل التواريخ","reservations.list.filters.range.today":"📅 اليوم","reservations.list.filters.range.week":"📆 هذا الأسبوع","reservations.list.filters.range.month":"🗓️ هذا الشهر","reservations.list.filters.status.all":"⚙️ كل الحالات","reservations.list.filters.status.confirmed":"✅ مؤكدة","reservations.list.filters.status.pending":"⏳ غير مؤكدة","reservations.list.filters.status.completed":"📁 منتهية","reservations.list.empty":"⚠️ لا توجد حجوزات بعد.","reservations.list.noResults":"🔍 لا توجد حجوزات مطابقة للبحث.","reservations.list.taxIncludedShort":"(شامل الضريبة)","reservations.list.unknownCustomer":"غير معروف","reservations.list.noNotes":"لا توجد ملاحظات","reservations.list.itemsCountShort":"{count} عنصر","reservations.list.crew.separator":"، ","reservations.list.status.confirmed":"✅ مؤكد","reservations.list.status.pending":"⏳ غير مؤكد","reservations.list.payment.paid":"💳 مدفوع","reservations.list.payment.unpaid":"💳 غير مدفوع","reservations.list.status.completed":"📁 منتهي","reservations.list.ribbon.completed":"منتهي","reservations.list.actions.confirm":"✔️ تأكيد","reservations.list.labels.client":"👤 العميل","reservations.edit.modalTitle":"✏️ تعديل الحجز","reservations.edit.labels.id":"🆔 رقم الحجز","reservations.edit.labels.customer":"👤 العميل","reservations.edit.labels.startDate":"📅 تاريخ البداية","reservations.edit.labels.startTime":"⏰ وقت البداية","reservations.edit.labels.endDate":"📅 تاريخ النهاية","reservations.edit.labels.endTime":"⏰ وقت النهاية","reservations.edit.labels.discount":"💵 الخصم","reservations.edit.placeholders.discount":"ادخل قيمة الخصم","reservations.edit.discount.percent":"٪ نسبة","reservations.edit.discount.amount":"💵 مبلغ","reservations.edit.labels.tax":"شامل الضريبة (15%)","reservations.edit.labels.confirmed":"✅ تم التأكيد","reservations.edit.labels.paymentStatus":"💳 حالة الدفع","reservations.edit.payment.paid":"مدفوع","reservations.edit.payment.unpaid":"لم يتم الدفع","reservations.edit.labels.notes":"📝 الملاحظات","reservations.edit.placeholders.notes":"اكتب أي ملاحظات...","reservations.edit.labels.addEquipment":"🎥 إضافة معدة","reservations.edit.placeholders.barcode":"🔍 امسح أو أدخل الباركود ثم اضغط Enter","reservations.edit.placeholders.description":"🎥 اكتب اسم المعدة ثم اضغط Enter","reservations.edit.table.headers.code":"الكود","reservations.edit.table.headers.description":"الوصف","reservations.edit.table.headers.price":"السعر","reservations.edit.table.headers.quantity":"الكمية","reservations.edit.table.headers.image":"الصورة","reservations.edit.table.headers.delete":"حذف","reservations.edit.table.empty":"لا توجد معدات","reservations.edit.actions.save":"💾 حفظ التعديلات","reservations.list.labels.start":"🗓️ بداية الحجز","reservations.list.labels.end":"🗓️ نهاية الحجز","reservations.list.labels.cost":"💵 التكلفة","reservations.list.labels.equipment":"📦 المعدات","reservations.list.labels.crew":"😎 الفريق","reservations.details.labels.discount":"الخصم","reservations.details.labels.tax":"الضريبة (15%)","reservations.details.table.headers.code":"الكود","reservations.details.table.headers.description":"الوصف","reservations.details.table.headers.quantity":"الكمية","reservations.details.table.headers.price":"السعر","reservations.details.table.headers.image":"الصورة","reservations.details.noItems":"📦 لا توجد معدات ضمن هذا الحجز حالياً.","reservations.details.noCrew":"😎 لا يوجد فريق مرتبط بهذا الحجز.","reservations.details.technicians.roleUnknown":"غير محدد","reservations.details.technicians.phoneUnknown":"غير متوفر","reservations.details.technicians.wage":"{amount} {currency} / اليوم","reservations.details.labels.id":"🆔 رقم الحجز","reservations.details.section.bookingInfo":"بيانات الحجز","reservations.details.section.statusSummary":"ملخص الحالة","reservations.details.section.paymentSummary":"💳 ملخص الدفع","reservations.details.labels.finalTotal":"المجموع النهائي","reservations.details.section.crew":"😎 الفريق الفني","reservations.details.crew.count":"{count} عضو","reservations.details.section.items":"📦 المعدات المرتبطة","reservations.details.items.count":"{count} عنصر","reservations.details.actions.edit":"✏️ تعديل","reservations.details.actions.delete":"🗑️ حذف","reservations.details.labels.customer":"العميل","reservations.details.labels.contact":"رقم التواصل","reservations.details.labels.start":"بداية الحجز","reservations.details.labels.end":"نهاية الحجز","reservations.details.labels.notes":"ملاحظات","reservations.details.labels.itemsCount":"عدد المعدات","reservations.details.labels.itemsTotal":"إجمالي المعدات","reservations.details.labels.paymentStatus":"حالة الدفع","reservations.details.modalTitle":"📋 تفاصيل الحجز","reservations.calendar.title":"📅 التقويم","reservations.reports.title":"📊 تقارير الأداء","reservations.reports.subtitle":"نظرة شاملة على الحجوزات والإيرادات ونسب الإشغال خلال الفترة المحددة.","reservations.reports.filters.rangeLabel":"الفترة","reservations.reports.filters.range.last30":"آخر 30 يوم","reservations.reports.filters.range.thisWeek":"هذا الأسبوع","reservations.reports.filters.range.thisMonth":"هذا الشهر","reservations.reports.filters.range.thisQuarter":"هذا الربع","reservations.reports.filters.range.thisYear":"هذا العام","reservations.reports.filters.range.all":"كل الوقت","reservations.reports.filters.range.custom":"مخصص","reservations.reports.filters.startLabel":"من","reservations.reports.filters.endLabel":"إلى","reservations.reports.filters.statusLabel":"الحالة","reservations.reports.filters.status.all":"كل الحالات","reservations.reports.filters.status.confirmed":"مؤكدة","reservations.reports.filters.status.pending":"قيد التأكيد","reservations.reports.filters.status.completed":"منتهية","reservations.reports.filters.paymentLabel":"الدفع","reservations.reports.filters.payment.all":"الكل","reservations.reports.filters.payment.paid":"مدفوعة","reservations.reports.filters.payment.unpaid":"غير مدفوعة","reservations.reports.filters.searchLabel":"البحث","reservations.reports.filters.searchPlaceholder":"ابحث باسم العميل، رقم الحجز، أو المعدة...","reservations.reports.actions.refresh":"🔄 تحديث","reservations.reports.kpi.total.label":"إجمالي الحجوزات","reservations.reports.kpi.total.meta":"لم يتم تسجيل بيانات بعد","reservations.reports.kpi.revenue.label":"إجمالي الإيرادات","reservations.reports.kpi.revenue.meta":"متوسط الحجز —","reservations.reports.kpi.confirmation.label":"معدل التأكيد","reservations.reports.kpi.confirmation.meta":"الحجوزات المؤكدة —","reservations.reports.kpi.paid.label":"نسبة المدفوع","reservations.reports.kpi.paid.meta":"الحجوزات المدفوعة —","reservations.reports.kpi.total.dynamicMeta":"منها {count} منتهية","reservations.reports.kpi.revenue.average":"متوسط قيمة الحجز {value}","reservations.reports.kpi.confirmed.detail":"{count} حجوزات مؤكدة","reservations.reports.kpi.paid.detail":"{count} حجوزات مدفوعة","reservations.reports.status.confirmedLabel":"مؤكدة","reservations.reports.status.pendingLabel":"قيد التأكيد","reservations.reports.status.completedLabel":"منتهية","reservations.reports.payment.paidLabel":"مدفوعة","reservations.reports.payment.unpaidLabel":"غير مدفوعة","reservations.reports.progress.empty":"لا توجد بيانات لعرضها.","reservations.reports.progress.meta":"{count} حجز","reservations.reports.chart.volume.title":"📈 تطور الحجوزات","reservations.reports.chart.volume.hint":"آخر 6 أشهر","reservations.reports.chart.status.title":"📊 توزيع الحالات والدفع","reservations.reports.chart.status.hint":"نسب مئوية","reservations.reports.chart.status.statusLabel":"الحالات","reservations.reports.chart.status.paymentLabel":"الدفع","reservations.reports.topCustomers.title":"👥 أفضل العملاء","reservations.reports.topCustomers.hint":"حسب إجمالي الإيراد","reservations.reports.topCustomers.headers.customer":"العميل","reservations.reports.topCustomers.headers.count":"عدد الحجوزات","reservations.reports.topCustomers.headers.revenue":"الإيراد الكلي","reservations.reports.topCustomers.unknown":"عميل غير معروف","reservations.reports.table.empty":"لا توجد بيانات","reservations.reports.table.emptyPeriod":"لا توجد بيانات في هذه الفترة.","reservations.reports.results.title":"📄 تفاصيل الحجوزات","reservations.reports.results.hint":"أحدث الحجوزات المطابقة لعوامل التصفية","reservations.reports.results.headers.id":"الحجز","reservations.reports.results.headers.customer":"العميل","reservations.reports.results.headers.date":"التاريخ","reservations.reports.results.headers.status":"الحالة","reservations.reports.results.headers.payment":"الدفع","reservations.reports.results.headers.total":"الإجمالي","reservations.reports.topEquipment.title":"🎥 المعدات الأكثر استخدامًا","reservations.reports.topEquipment.hint":"عدد مرات الحجز","reservations.reports.topEquipment.headers.item":"المعدة","reservations.reports.topEquipment.headers.usage":"عدد مرات الاستخدام","reservations.reports.topEquipment.headers.revenue":"الإيراد المرتبط","reservations.reports.topEquipment.unknown":"معدة بدون اسم","reservations.reports.empty.title":"لا توجد بيانات ضمن المعايير الحالية","reservations.reports.empty.subtitle":"جرّب تغيير الفترة الزمنية أو إزالة عوامل التصفية لعرض نتائج أخرى.","calendar.buttons.today":"اليوم","calendar.buttons.month":"شهر","calendar.buttons.week":"أسبوع","calendar.buttons.day":"يوم","calendar.badges.confirmed":"مؤكد","calendar.badges.pending":"غير مؤكد","calendar.badges.paid":"مدفوع","calendar.badges.unpaid":"غير مدفوع","calendar.badges.completed":"منتهي","calendar.labels.unknownCustomer":"غير معروف","calendar.labels.unknownEquipment":"معدة بدون اسم","calendar.labels.currencySuffix":"ريال","calendar.labels.noEquipment":"لا توجد معدات","calendar.labels.noNotes":"لا توجد ملاحظات","calendar.labels.reservationId":"رقم الحجز","calendar.labels.customer":"العميل","calendar.labels.start":"بداية الحجز","calendar.labels.end":"نهاية الحجز","calendar.labels.notes":"الملاحظات","calendar.sections.crew":"😎 الفريق الفني","calendar.sections.equipment":"📦 المعدات","calendar.emptyStates.noCrew":"😎 لا يوجد فريق مرتبط بهذا الحجز.","calendar.table.headers.barcode":"الباركود","calendar.table.headers.description":"الوصف","calendar.table.headers.quantity":"الكمية","calendar.table.headers.price":"السعر","calendar.table.headers.image":"الصورة","calendar.summary.baseCost":"💵 إجمالي المعدات: <strong>{value} ريال</strong>","calendar.summary.discount":"💸 الخصم: <strong>{value}</strong>","calendar.summary.tax":"🧾 الضريبة (15%): <strong>{value} ريال</strong>","calendar.summary.total":"💰 المجموع النهائي: <strong>{value} ريال</strong>","calendar.alerts.cannotShowDetails":"لا يمكن عرض تفاصيل الحجز","calendar.alerts.cannotOpenModal":"لا يمكن فتح نافذة التفاصيل","calendar.modal.title":"📅 تفاصيل الحجز","reservations.toast.equipmentNameNotFound":"❌ لم يتم العثور على معدة بالاسم المدخل","reservations.toast.equipmentMaintenance":"⚠️ هذه المعدة قيد الصيانة ولا يمكن إضافتها حالياً","reservations.toast.equipmentMissingBarcode":"⚠️ هذه المعدة لا تحتوي على باركود معرف","reservations.toast.requireDatesBeforeAdd":"⚠️ يرجى تحديد تاريخ ووقت البداية والنهاية قبل إضافة المعدات","reservations.toast.equipmentDuplicate":"⚠️ هذه المعدة موجودة بالفعل في الحجز","reservations.toast.equipmentTimeConflict":"⚠️ لا يمكن إضافة المعدة لأنها محجوزة في نفس الفترة الزمنية","reservations.toast.equipmentMaintenanceStrict":"⚠️ لا يمكن إضافة معدة قيد الصيانة إلى الحجز","reservations.toast.requireOverallDates":"⚠️ يرجى تحديد تواريخ الحجز قبل إضافة المعدات","reservations.toast.equipmentTimeConflictSimple":"⚠️ هذه المعدة محجوزة في نفس الفترة الزمنية","reservations.toast.barcodeNotFound":"❌ الباركود غير موجود","reservations.toast.equipmentAdded":"✅ تم إضافة المعدة بنجاح","reservations.toast.barcodeNotInCatalog":"❌ الباركود غير موجود ضمن المعدات","reservations.toast.requireDates":"⚠️ يرجى تحديد تاريخ البداية والنهاية","reservations.toast.invalidDateRange":"⚠️ تأكد من أن تاريخ ووقت البداية يسبق تاريخ ووقت النهاية","reservations.toast.missingFields":"⚠️ تأكد من تعبئة جميع الحقول","reservations.toast.noItems":"⚠️ لا يمكنك إنشاء حجز بدون معدات","reservations.toast.cannotCreateEquipmentMaintenance":"⚠️ لا يمكن إتمام الحجز لأن إحدى المعدات قيد الصيانة","reservations.toast.cannotCreateEquipmentConflict":"⚠️ لا يمكن إتمام الحجز، إحدى المعدات محجوزة في نفس الفترة الزمنية","reservations.toast.cannotCreateCrewConflict":"⚠️ لا يمكن إتمام الحجز، أحد أعضاء الطاقم مرتبط بحجز آخر في نفس الفترة","reservations.toast.technicianSelectionConflict":"⚠️ لا يمكن اختيار {names} لأنهم مرتبطون بحجز آخر في نفس الفترة الزمنية","reservations.toast.created":"✅ تم إنشاء الحجز","reservations.toast.notFound":"⚠️ تعذر العثور على بيانات الحجز","reservations.toast.updateNoItems":"⚠️ لا يمكن حفظ التعديلات لعدم وجود معدات","reservations.toast.updateEquipmentMaintenance":"⚠️ لا يمكن حفظ التعديلات لأن إحدى المعدات قيد الصيانة","reservations.toast.updateEquipmentConflict":"⚠️ لا يمكن حفظ التعديلات بسبب تعارض في أحد المعدات","reservations.toast.updateCrewConflict":"⚠️ لا يمكن حفظ التعديلات بسبب تعارض في جدول أحد أعضاء الطاقم","reservations.toast.updated":"✅ تم حفظ التعديلات على الحجز","reservations.toast.confirmed":"✅ تم تأكيد الحجز","reservations.toast.deleteConfirm":"⚠️ هل أنت متأكد من حذف هذا الحجز؟","maintenance.section.title":"🛠️ إدارة الصيانة","maintenance.form.title":"➕ إنشاء تذكرة صيانة","maintenance.form.hint":"حدد المعدة المتضررة وسجّل المشكلة لإيقافها عن الاستخدام لحين الإصلاح.","maintenance.form.labels.barcode":"🏷️ الباركود","maintenance.form.placeholders.barcode":"🖨️ امسح أو أدخل الباركود ثم اضغط Enter","maintenance.form.labels.search":"🎥 البحث باسم المعدة","maintenance.form.placeholders.search":"اكتب اسم المعدة...","maintenance.form.labels.priority":"⚠️ الأولوية","maintenance.form.options.priority.high":"مرتفعة","maintenance.form.options.priority.medium":"متوسطة","maintenance.form.options.priority.low":"منخفضة","maintenance.form.selectedInfo":"لم يتم اختيار معدة بعد.","maintenance.form.labels.issue":"📝 وصف المشكلة","maintenance.form.placeholders.issue":"اشرح المشكلة أو الأعراض الظاهرة للمعدة","maintenance.form.actions.submit":"🛠️ إنشاء التذكرة","maintenance.form.blockedSuffix":"(صيانة)","maintenance.list.title":"📋 تذاكر الصيانة","maintenance.list.hint":"تابع حالة الأعطال وقم بإغلاق التذاكر بعد إتمام الإصلاح.","maintenance.filters.status.label":"الحالة","maintenance.filters.status.all":"كل الحالات","maintenance.filters.status.open":"قيد الصيانة","maintenance.filters.status.closed":"مغلقة","maintenance.table.headers.equipment":"المعدة","maintenance.table.headers.issue":"وصف المشكلة","maintenance.table.headers.priority":"الأولوية","maintenance.table.headers.created":"تاريخ الإنشاء","maintenance.table.headers.status":"الحالة","maintenance.table.headers.actions":"الإجراءات","maintenance.table.empty":"لا توجد تذاكر بعد.","maintenance.table.emptyFiltered":"لا توجد تذاكر ضمن هذا الفلتر.","maintenance.table.noName":"بدون اسم","maintenance.empty.title":"لا توجد تذاكر صيانة","maintenance.empty.subtitle":"عند إنشاء تذكرة جديدة ستظهر في هذه القائمة.","maintenance.table.noBarcode":"بدون باركود","maintenance.stats.open":"{count} قيد الصيانة","maintenance.stats.closed":"{count} مغلقة","maintenance.stats.total":"{count} إجمالي التذاكر","maintenance.status.open":"قيد الصيانة","maintenance.status.closed":"مغلقة","maintenance.priority.high":"مرتفعة","maintenance.priority.medium":"متوسطة","maintenance.priority.low":"منخفضة","maintenance.actions.close":"🔧 إغلاق بعد الإصلاح","maintenance.actions.view":"👁️ عرض التقرير","maintenance.actions.delete":"🗑️ حذف التذكرة","maintenance.toast.equipmentBlocked":"⚠️ هذه المعدة قيد الصيانة ولا يمكن اختيارها حالياً","maintenance.toast.equipmentNotFoundBarcode":"❌ لم يتم العثور على معدة بهذا الباركود","maintenance.toast.equipmentNotFoundName":"❌ لم يتم العثور على معدة بالاسم المدخل","maintenance.toast.equipmentBecameBlocked":"⚠️ هذه المعدة أصبحت قيد الصيانة ولا يمكن اختيارها","maintenance.toast.selectEquipment":"⚠️ يرجى اختيار المعدة","maintenance.toast.selectedNotFound":"❌ لم يتم العثور على المعدة المختارة","maintenance.toast.equipmentAlreadyMaintenance":"⚠️ هذه المعدة بالفعل في حالة صيانة","maintenance.toast.ticketExists":"⚠️ توجد تذكرة صيانة مفتوحة لهذه المعدة","maintenance.toast.ticketCreated":"🛠️ تم إنشاء تذكرة الصيانة وإيقاف المعدة","maintenance.toast.storageError":"⚠️ تعذر حفظ بيانات الصيانة. يرجى المحاولة مجدداً.","maintenance.toast.submitError":"⚠️ تعذر إنشاء تذكرة الصيانة. يرجى المحاولة مجدداً.","maintenance.toast.ticketClosed":"✅ تم إغلاق تذكرة الصيانة وإعادة المعدة إلى الحالة المتاحة","maintenance.toast.ticketDeleted":"🗑️ تم حذف تذكرة الصيانة","maintenance.toast.ticketDeleteConfirm":"⚠️ هل أنت متأكد من حذف تذكرة الصيانة؟","maintenance.prompt.closeReport":"أدخل تقرير الإصلاح / الإجراءات المتخذة:","maintenance.report.equipment":"المعدة","maintenance.report.barcode":"الباركود","maintenance.report.issue":"الوصف","maintenance.report.createdAt":"تاريخ الإنشاء","maintenance.report.closedAt":"تاريخ الإغلاق","maintenance.report.summary":"التقرير","maintenance.report.notAvailable":"غير متوفر","maintenance.report.none":"—","maintenance.info.barcodeLabel":"باركود","technicians.section.title":"😎 إدارة طاقم العمل","technicians.form.title":"📝 إضافة / تعديل عضو طاقم","technicians.form.hint":"أدخل بيانات عضو الطاقم ليتم حفظها وتحديثها في سجلات الحجز.","technicians.form.labels.name":"😎 اسم العضو","technicians.form.labels.phone":"📞 الجوال","technicians.form.labels.role":"👔 الوظيفة","technicians.form.labels.department":"🧩 القسم","technicians.form.labels.wage":"💰 الأجر اليومي","technicians.form.labels.status":"⚙️ الحالة الأساسية","technicians.form.labels.notes":"📝 ملاحظات","technicians.form.placeholders.name":"اسم عضو الطاقم","technicians.form.placeholders.phone":"05xxxxxxxx","technicians.form.placeholders.role":"مثال: مصور","technicians.form.placeholders.department":"مثال: قسم الصوت","technicians.form.placeholders.wage":"0","technicians.form.placeholders.notes":"معلومات إضافية","technicians.form.actions.cancel":"إلغاء التعديل","technicians.form.actions.submit":"➕ إضافة عضو طاقم","technicians.form.actions.update":"💾 حفظ التعديل","technicians.picker.selectedLabel":"😎 طاقم العمل المشارك","technicians.picker.openButton":"➕ اختيار الطاقم","technicians.picker.editButton":"🔁 تعديل الطاقم","technicians.picker.modalTitle":"😎 اختيار طاقم العمل","technicians.picker.actions.apply":"تم","technicians.form.options.available":"✅ متاح","technicians.form.options.busy":"⛔ مشغول","technicians.search.placeholder":"🔍 ابحث عن عضو الطاقم بالاسم أو الجوال أو الوظيفة...","technicians.search.filters.allRoles":"👔 كل الوظائف","technicians.table.empty":"لا يوجد أعضاء في الطاقم بعد.","technicians.table.loading":"جاري التحميل...","technicians.table.headers.name":"😎 اسم العضو","technicians.table.headers.phone":"📞 الجوال","technicians.table.headers.role":"👔 الوظيفة","technicians.table.headers.department":"🧩 القسم","technicians.table.headers.wage":"💰 الأجر اليومي","technicians.table.headers.status":"⚙️ الحالة","technicians.table.headers.notes":"📝 ملاحظات","technicians.table.headers.actions":"⚙️ الإجراءات","technicians.status.available":"✅ متاح","technicians.status.busy":"⛔ مشغول","technicians.table.wageSuffix":"ريال","technicians.actions.edit":"✏️ تعديل","technicians.actions.delete":"🗑️ حذف","technicians.toast.missingName":"⚠️ يرجى إدخال اسم عضو الطاقم","technicians.toast.missingPhone":"⚠️ يرجى إدخال رقم التواصل","technicians.toast.missingRole":"⚠️ يرجى إدخال الوظيفة","technicians.toast.invalidWage":"⚠️ أدخل قيمة صحيحة للأجر اليومي","technicians.toast.addSuccess":"✅ تم إضافة عضو الطاقم","technicians.toast.updateSuccess":"💾 تم حفظ بيانات عضو الطاقم","technicians.toast.notFound":"⚠️ تعذر العثور على عضو الطاقم المطلوب","technicians.toast.unidentified":"⚠️ تعذر تحديد عضو الطاقم المطلوب","technicians.toast.dataNotFound":"⚠️ تعذر العثور على بيانات عضو الطاقم","technicians.toast.editReady":"✏️ يمكنك تعديل بيانات عضو الطاقم الآن ثم الضغط على حفظ التعديل","technicians.toast.deleteConfirm":"⚠️ هل أنت متأكد من حذف هذا العضو؟","technicians.toast.deleteSuccess":"🗑️ تم حذف عضو الطاقم"},en:{"dashboard.header.greeting":"👋 Welcome to the Dashboard","tabs.customers":"👤 Clients","tabs.equipment":"🎥 Equipment","tabs.maintenance":"🛠️ Maintenance","tabs.technicians":"😎 Crew","tabs.reservations":"📅 Reservations","actions.close":"Close","actions.cancel":"Cancel","customers.section.title":"📋 Client Management","customers.form.title":"📋 Add / Edit Client","customers.form.hint":"Update client details and they will sync with bookings and invoices.","customers.form.labels.name":"👤 Client","customers.form.labels.phone":"📞 Phone","customers.form.labels.email":"📧 Email","customers.form.labels.address":"📍 Address","customers.form.labels.company":"🏢 Company","customers.form.labels.notes":"📝 Notes","customers.form.placeholders.name":"Client name","customers.form.placeholders.phone":"05xxxxxxxx","customers.form.placeholders.email":"name@email.com","customers.form.placeholders.address":"Client address","customers.form.placeholders.company":"Company name","customers.form.placeholders.notes":"Additional info or reminders","customers.form.actions.cancel":"Cancel edit","customers.form.actions.submit":"➕ Add Client","customers.form.actions.update":"💾 Update Client","customers.search.placeholder":"🔍 Search by name, phone, or company...","customers.table.headers.name":"👤 Client","customers.table.headers.phone":"📞 Phone","customers.table.headers.company":"🏢 Company","customers.table.headers.notes":"📝 Notes","customers.table.headers.actions":"⚙️ Actions","customers.table.loading":"Loading...","customers.table.empty":"No clients found","customers.table.noResults":"No matching results","customers.actions.edit":"✏️ Edit","customers.actions.delete":"🗑️ Delete","customers.toast.updateSuccess":"Client updated successfully","customers.toast.createSuccess":"Client added successfully","customers.toast.missingFields":"Please fill in the name and phone number","customers.toast.deleteConfirm":"⚠️ Are you sure you want to delete this client?","customers.toast.deleteSuccess":"Client removed","equipment.section.title":"🎥 Equipment Management","equipment.actions.clearAll":"🗑️ Clear All","equipment.actions.uploadExcel":"📤 Import from Excel","equipment.form.title":"🎥 Add Equipment","equipment.form.hint":"Enter equipment details to store them in the catalog.","equipment.form.labels.description":"📝 Description","equipment.form.placeholders.description":"Equipment description","equipment.form.labels.barcode":"🏷️ Barcode","equipment.form.placeholders.barcode":"Barcode","equipment.form.labels.price":"💵 Price","equipment.form.placeholders.price":"0","equipment.form.labels.quantity":"🔢 Quantity","equipment.form.placeholders.quantity":"1","equipment.form.labels.image":"🖼️ Image URL","equipment.form.placeholders.image":"https://...","equipment.form.labels.category":"📂 Category","equipment.form.placeholders.category":"Category","equipment.form.labels.subcategory":"📑 Subcategory","equipment.form.placeholders.subcategory":"Subcategory","equipment.form.labels.status":"⚙️ Status","equipment.form.options.available":"✅ Available","equipment.form.options.booked":"📌 Booked","equipment.form.options.maintenance":"🛠️ Maintenance","equipment.form.actions.submit":"➕ Add Equipment","equipment.filters.search":"🔍 Search equipment...","equipment.filters.status.all":"⚙️ All statuses","equipment.filters.category.all":"📂 All categories","equipment.filters.subcategory.all":"📑 All subcategories","equipment.list.title":"📋 All Equipment","equipment.modal.title":"✏️ Edit Equipment","equipment.modal.placeholders.image":"Paste a direct image link","equipment.modal.actions.cancel":"❌ Cancel","equipment.modal.actions.save":"💾 Save Changes","equipment.toast.xlsxMissing":"⚠️ Excel library (XLSX) is not loaded. Check dashboard.html links","equipment.toast.uploadSuccess":"✅ Equipment imported successfully","equipment.toast.uploadEmpty":"⚠️ The file did not contain any rows to import","equipment.toast.uploadFailed":"❌ Something went wrong while reading the Excel file","equipment.toast.clearConfirm":"⚠️ Are you sure you want to delete all equipment?","equipment.toast.clearSuccess":"🗑️ All equipment cleared","equipment.toast.deleteConfirm":"❌ Are you sure you want to delete this equipment item?","equipment.toast.deleteSuccess":"🗑️ Equipment item deleted","equipment.toast.editSuccess":"✏️ Equipment updated","equipment.toast.addSuccess":"✅ Equipment added","equipment.toast.updateSuccess":"✅ Equipment updated successfully","equipment.toast.missingFields":"⚠️ Please enter the description and barcode","equipment.toast.duplicateBarcode":"⚠️ This barcode is already in use","equipment.list.emptyFiltered":"⚠️ No matching equipment.","equipment.list.countSuffix":"item(s)","equipment.item.imageAlt":"Image","equipment.item.currency":"SAR","equipment.item.actions.edit":"✏️ Edit","equipment.item.actions.delete":"🗑️ Delete","reservations.tabs.create":"➕ Create Reservation","reservations.tabs.mine":"📋 My Reservations","reservations.tabs.reports":"📊 Reports","reservations.tabs.calendar":"📅 Calendar","reservations.create.title":"➕ Create New Reservation","reservations.create.labels.startDate":"📅 Start date","reservations.create.labels.startTime":"⏰ Start time","reservations.create.labels.endDate":"📅 End date","reservations.create.labels.endTime":"⏰ End time","reservations.create.labels.client":"👤 Client","reservations.create.placeholders.client":"Type client name...","reservations.create.labels.notes":"📝 Notes","reservations.create.placeholders.notes":"Add any additional notes...","reservations.create.equipment.title":"🎥 Add Equipment","reservations.create.equipment.placeholders.barcode":"🔍 Scan or enter a barcode then press Enter","reservations.create.equipment.placeholders.description":"🎥 Type the equipment name then press Enter","reservations.create.equipment.table.code":"Code","reservations.create.equipment.table.description":"Description","reservations.create.equipment.table.price":"Price","reservations.create.equipment.table.image":"Image","reservations.create.equipment.table.delete":"Delete","reservations.create.billing.title":"💵 Discount & Tax","reservations.create.billing.discount":"Enter discount value","reservations.create.billing.discountPercent":"% Percent","reservations.create.billing.discountAmount":"💵 Amount","reservations.create.billing.taxLabel":"Include VAT (15%)","reservations.create.labels.paymentStatus":"💳 Payment status","reservations.create.paymentStatus.paid":"Paid","reservations.create.paymentStatus.unpaid":"Unpaid","reservations.create.actions.submit":"💾 Create reservation","reservations.section.title":"📅 Reservation Management","reservations.crew.none":"No crew members selected yet.","reservations.crew.noneShort":"No crew members selected","reservations.crew.selectedCount":"{count} crew member(s) selected","reservations.crew.fallbackName":"Crew member {id}","reservations.crew.removeAria":"Remove","reservations.crew.searchEmpty":"No matching results.","reservations.create.equipment.noResults":"No matching equipment.","reservations.create.equipment.noneAdded":"No equipment added","reservations.create.equipment.none":"No equipment","reservations.create.summary.currency":"SAR","reservations.create.equipment.imageAlt":"Image","reservations.summary.total":"💰 Total cost: <strong>{total} {currency}</strong>","reservations.summary.totalAfterEdit":"💰 Updated total: <strong>{total} {currency}</strong>","reservations.summary.itemsCount":"📦 Items: {count}","reservations.summary.crewCount":"😎 Crew members: {count}","reservations.summary.taxIncluded":"Includes 15% VAT","reservations.summary.taxExcluded":"VAT not included","reservations.summary.paymentLabel":"💳 Payment status: {status}","reservations.toast.customerNotFound":"⚠️ Customer not found for the entered name","reservations.toast.invalidDateOrder":"⚠️ Start date cannot be after the end date","reservations.toast.reservationMissing":"⚠️ Unable to locate the selected reservation","reservations.list.title":"📋 My Reservations","reservations.list.search.placeholder":"🔍 Search by client name or code...","reservations.list.filters.start":"📅 From date","reservations.list.filters.end":"📅 To date","reservations.list.filters.range.all":"⏱️ All dates","reservations.list.filters.range.today":"📅 Today","reservations.list.filters.range.week":"📆 This week","reservations.list.filters.range.month":"🗓️ This month","reservations.list.filters.status.all":"⚙️ All statuses","reservations.list.filters.status.confirmed":"✅ Confirmed","reservations.list.filters.status.pending":"⏳ Pending","reservations.list.filters.status.completed":"📁 Completed","reservations.list.empty":"⚠️ No reservations yet.","reservations.list.noResults":"🔍 No reservations match the search.","reservations.list.taxIncludedShort":"(Tax included)","reservations.list.unknownCustomer":"Unknown","reservations.list.noNotes":"No notes","reservations.list.itemsCountShort":"{count} item(s)","reservations.list.crew.separator":", ","reservations.list.status.confirmed":"✅ Confirmed","reservations.list.status.pending":"⏳ Pending","reservations.list.payment.paid":"💳 Paid","reservations.list.payment.unpaid":"💳 Unpaid","reservations.list.status.completed":"📁 Completed","reservations.list.ribbon.completed":"Completed","reservations.list.actions.confirm":"✔️ Confirm","reservations.list.labels.client":"👤 Client","reservations.edit.modalTitle":"✏️ Edit Reservation","reservations.edit.labels.id":"🆔 Reservation ID","reservations.edit.labels.customer":"👤 Customer","reservations.edit.labels.startDate":"📅 Start date","reservations.edit.labels.startTime":"⏰ Start time","reservations.edit.labels.endDate":"📅 End date","reservations.edit.labels.endTime":"⏰ End time","reservations.edit.labels.discount":"💵 Discount","reservations.edit.placeholders.discount":"Enter discount value","reservations.edit.discount.percent":"% Percent","reservations.edit.discount.amount":"💵 Amount","reservations.edit.labels.tax":"Include VAT (15%)","reservations.edit.labels.confirmed":"✅ Confirmed","reservations.edit.labels.paymentStatus":"💳 Payment status","reservations.edit.payment.paid":"Paid","reservations.edit.payment.unpaid":"Unpaid","reservations.edit.labels.notes":"📝 Notes","reservations.edit.placeholders.notes":"Add any notes...","reservations.edit.labels.addEquipment":"🎥 Add equipment","reservations.edit.placeholders.barcode":"🔍 Scan or enter a barcode then press Enter","reservations.edit.placeholders.description":"🎥 Type the equipment name then press Enter","reservations.edit.table.headers.code":"Code","reservations.edit.table.headers.description":"Description","reservations.edit.table.headers.price":"Price","reservations.edit.table.headers.quantity":"Qty","reservations.edit.table.headers.image":"Image","reservations.edit.table.headers.delete":"Delete","reservations.edit.table.empty":"No equipment","reservations.edit.actions.save":"💾 Save changes","reservations.list.labels.start":"🗓️ Start","reservations.list.labels.end":"🗓️ End","reservations.list.labels.cost":"💵 Cost","reservations.list.labels.equipment":"📦 Equipment","reservations.list.labels.crew":"😎 Crew","reservations.details.labels.discount":"Discount","reservations.details.labels.tax":"Tax (15%)","reservations.details.table.headers.code":"Code","reservations.details.table.headers.description":"Description","reservations.details.table.headers.quantity":"Qty","reservations.details.table.headers.price":"Price","reservations.details.table.headers.image":"Image","reservations.details.noItems":"📦 No equipment is linked to this reservation yet.","reservations.details.noCrew":"😎 No crew assigned to this reservation.","reservations.details.technicians.roleUnknown":"Not specified","reservations.details.technicians.phoneUnknown":"Not available","reservations.details.technicians.wage":"{amount} {currency} / day","reservations.details.labels.id":"🆔 Reservation ID","reservations.details.section.bookingInfo":"Booking details","reservations.details.section.statusSummary":"Status summary","reservations.details.section.paymentSummary":"💳 Payment summary","reservations.details.labels.finalTotal":"Final total","reservations.details.section.crew":"😎 Crew members","reservations.details.crew.count":"{count} member(s)","reservations.details.section.items":"📦 Linked equipment","reservations.details.items.count":"{count} item(s)","reservations.details.actions.edit":"✏️ Edit","reservations.details.actions.delete":"🗑️ Delete","reservations.details.labels.customer":"Customer","reservations.details.labels.contact":"Contact","reservations.details.labels.start":"Start","reservations.details.labels.end":"End","reservations.details.labels.notes":"Notes","reservations.details.labels.itemsCount":"Equipment count","reservations.details.labels.itemsTotal":"Equipment total","reservations.details.labels.paymentStatus":"Payment status","reservations.details.modalTitle":"📋 Reservation Details","reservations.calendar.title":"📅 Calendar","reservations.reports.title":"📊 Performance Reports","reservations.reports.subtitle":"A holistic view of reservations, revenue, and utilization for the selected period.","reservations.reports.filters.rangeLabel":"Period","reservations.reports.filters.range.last30":"Last 30 days","reservations.reports.filters.range.thisWeek":"This week","reservations.reports.filters.range.thisMonth":"This month","reservations.reports.filters.range.thisQuarter":"This quarter","reservations.reports.filters.range.thisYear":"This year","reservations.reports.filters.range.all":"All time","reservations.reports.filters.range.custom":"Custom","reservations.reports.filters.startLabel":"From","reservations.reports.filters.endLabel":"To","reservations.reports.filters.statusLabel":"Status","reservations.reports.filters.status.all":"All statuses","reservations.reports.filters.status.confirmed":"Confirmed","reservations.reports.filters.status.pending":"Pending confirmation","reservations.reports.filters.status.completed":"Completed","reservations.reports.filters.paymentLabel":"Payment","reservations.reports.filters.payment.all":"All","reservations.reports.filters.payment.paid":"Paid","reservations.reports.filters.payment.unpaid":"Unpaid","reservations.reports.filters.searchLabel":"Search","reservations.reports.filters.searchPlaceholder":"Search by customer, reservation number, or equipment...","reservations.reports.actions.refresh":"🔄 Refresh","reservations.reports.kpi.total.label":"Total reservations","reservations.reports.kpi.total.meta":"No data recorded yet","reservations.reports.kpi.revenue.label":"Total revenue","reservations.reports.kpi.revenue.meta":"Average reservation —","reservations.reports.kpi.confirmation.label":"Confirmation rate","reservations.reports.kpi.confirmation.meta":"Confirmed reservations —","reservations.reports.kpi.paid.label":"Paid ratio","reservations.reports.kpi.paid.meta":"Paid reservations —","reservations.reports.kpi.total.dynamicMeta":"Includes {count} completed","reservations.reports.kpi.revenue.average":"Average reservation value {value}","reservations.reports.kpi.confirmed.detail":"{count} confirmed reservations","reservations.reports.kpi.paid.detail":"{count} paid reservations","reservations.reports.status.confirmedLabel":"Confirmed","reservations.reports.status.pendingLabel":"Pending confirmation","reservations.reports.status.completedLabel":"Completed","reservations.reports.payment.paidLabel":"Paid","reservations.reports.payment.unpaidLabel":"Unpaid","reservations.reports.progress.empty":"No data to display.","reservations.reports.progress.meta":"{count} reservations","reservations.reports.chart.volume.title":"📈 Reservation trend","reservations.reports.chart.volume.hint":"Last 6 months","reservations.reports.chart.status.title":"📊 Status & payment breakdown","reservations.reports.chart.status.hint":"Percentages","reservations.reports.chart.status.statusLabel":"Status","reservations.reports.chart.status.paymentLabel":"Payment","reservations.reports.topCustomers.title":"👥 Top customers","reservations.reports.topCustomers.hint":"By total revenue","reservations.reports.topCustomers.headers.customer":"Customer","reservations.reports.topCustomers.headers.count":"Reservations","reservations.reports.topCustomers.headers.revenue":"Total revenue","reservations.reports.topCustomers.unknown":"Unknown customer","reservations.reports.table.empty":"No data available","reservations.reports.table.emptyPeriod":"No data for this period.","reservations.reports.results.title":"📄 Reservation Details","reservations.reports.results.hint":"Latest reservations matching the current filters","reservations.reports.results.headers.id":"Reservation","reservations.reports.results.headers.customer":"Customer","reservations.reports.results.headers.date":"Date","reservations.reports.results.headers.status":"Status","reservations.reports.results.headers.payment":"Payment","reservations.reports.results.headers.total":"Total","reservations.reports.topEquipment.title":"🎥 Most used equipment","reservations.reports.topEquipment.hint":"Total bookings","reservations.reports.topEquipment.headers.item":"Equipment","reservations.reports.topEquipment.headers.usage":"Usage count","reservations.reports.topEquipment.headers.revenue":"Linked revenue","reservations.reports.topEquipment.unknown":"Unnamed equipment","reservations.reports.empty.title":"No data matches the current filters","reservations.reports.empty.subtitle":"Try adjusting the date range or removing filters to see more results.","calendar.buttons.today":"Today","calendar.buttons.month":"Month","calendar.buttons.week":"Week","calendar.buttons.day":"Day","calendar.badges.confirmed":"Confirmed","calendar.badges.pending":"Pending","calendar.badges.paid":"Paid","calendar.badges.unpaid":"Unpaid","calendar.badges.completed":"Completed","calendar.labels.unknownCustomer":"Unknown","calendar.labels.unknownEquipment":"Unnamed equipment","calendar.labels.currencySuffix":"SAR","calendar.labels.noEquipment":"No equipment","calendar.labels.noNotes":"No notes","calendar.labels.reservationId":"Reservation ID","calendar.labels.customer":"Customer","calendar.labels.start":"Start","calendar.labels.end":"End","calendar.labels.notes":"Notes","calendar.sections.crew":"😎 Crew members","calendar.sections.equipment":"📦 Equipment","calendar.emptyStates.noCrew":"😎 No crew assigned to this reservation.","calendar.table.headers.barcode":"Barcode","calendar.table.headers.description":"Description","calendar.table.headers.quantity":"Qty","calendar.table.headers.price":"Price","calendar.table.headers.image":"Image","calendar.summary.baseCost":"💵 Equipment subtotal: <strong>{value} SAR</strong>","calendar.summary.discount":"💸 Discount: <strong>{value}</strong>","calendar.summary.tax":"🧾 Tax (15%): <strong>{value} SAR</strong>","calendar.summary.total":"💰 Grand total: <strong>{value} SAR</strong>","calendar.alerts.cannotShowDetails":"Unable to show reservation details","calendar.alerts.cannotOpenModal":"Unable to open details modal","calendar.modal.title":"📅 Reservation Details","reservations.toast.equipmentNameNotFound":"❌ No equipment found with that name","reservations.toast.equipmentMaintenance":"⚠️ This equipment is under maintenance and cannot be added","reservations.toast.equipmentMissingBarcode":"⚠️ This equipment has no barcode assigned","reservations.toast.requireDatesBeforeAdd":"⚠️ Set start and end date/time before adding equipment","reservations.toast.equipmentDuplicate":"⚠️ This equipment is already in the reservation","reservations.toast.equipmentTimeConflict":"⚠️ Cannot add equipment because it is booked in the same period","reservations.toast.equipmentMaintenanceStrict":"⚠️ Cannot add equipment while it is marked for maintenance","reservations.toast.requireOverallDates":"⚠️ Set the reservation dates before adding equipment","reservations.toast.equipmentTimeConflictSimple":"⚠️ This equipment is booked in the same period","reservations.toast.barcodeNotFound":"❌ Barcode not found","reservations.toast.equipmentAdded":"✅ Equipment added successfully","reservations.toast.barcodeNotInCatalog":"❌ Barcode not found in catalog","reservations.toast.requireDates":"⚠️ Please set start and end date","reservations.toast.invalidDateRange":"⚠️ Make sure start time is before end time","reservations.toast.missingFields":"⚠️ Please fill in all required fields","reservations.toast.noItems":"⚠️ You cannot create a reservation without equipment","reservations.toast.cannotCreateEquipmentMaintenance":"⚠️ Cannot create reservation because an item is under maintenance","reservations.toast.cannotCreateEquipmentConflict":"⚠️ Cannot create reservation because an item is already booked","reservations.toast.cannotCreateCrewConflict":"⚠️ Cannot create reservation because a crew member has another booking in that period","reservations.toast.technicianSelectionConflict":"⚠️ Cannot select {names}; they are already booked for the selected time range","reservations.toast.created":"✅ Reservation created","reservations.toast.notFound":"⚠️ Unable to locate reservation data","reservations.toast.updateNoItems":"⚠️ Cannot save changes without equipment","reservations.toast.updateEquipmentMaintenance":"⚠️ Cannot save changes because an item is under maintenance","reservations.toast.updateEquipmentConflict":"⚠️ Cannot save changes because an item conflicts with another booking","reservations.toast.updateCrewConflict":"⚠️ Cannot save changes because a crew member conflicts with another booking","reservations.toast.updated":"✅ Reservation updated","reservations.toast.confirmed":"✅ Reservation confirmed","reservations.toast.deleteConfirm":"⚠️ Are you sure you want to delete this reservation?","maintenance.section.title":"🛠️ Maintenance Management","maintenance.form.title":"➕ Create Maintenance Ticket","maintenance.form.hint":"Select the affected equipment and describe the issue to take it out of service.","maintenance.form.labels.barcode":"🏷️ Barcode","maintenance.form.placeholders.barcode":"🖨️ Scan or enter the barcode, then press Enter","maintenance.form.labels.search":"🎥 Search by equipment name","maintenance.form.placeholders.search":"Type the equipment name...","maintenance.form.labels.priority":"⚠️ Priority","maintenance.form.options.priority.high":"High","maintenance.form.options.priority.medium":"Medium","maintenance.form.options.priority.low":"Low","maintenance.form.selectedInfo":"No equipment selected yet.","maintenance.form.labels.issue":"📝 Issue description","maintenance.form.placeholders.issue":"Describe the issue or symptoms for the equipment","maintenance.form.actions.submit":"🛠️ Create Ticket","maintenance.form.blockedSuffix":"(In maintenance)","maintenance.list.title":"📋 Maintenance Tickets","maintenance.list.hint":"Track issues and close tickets once repairs are completed.","maintenance.filters.status.label":"Status","maintenance.filters.status.all":"All statuses","maintenance.filters.status.open":"In maintenance","maintenance.filters.status.closed":"Closed","maintenance.table.headers.equipment":"Equipment","maintenance.table.headers.issue":"Issue","maintenance.table.headers.priority":"Priority","maintenance.table.headers.created":"Created At","maintenance.table.headers.status":"Status","maintenance.table.headers.actions":"Actions","maintenance.table.empty":"No tickets yet.","maintenance.table.emptyFiltered":"No tickets match this filter.","maintenance.table.noName":"No name","maintenance.empty.title":"No maintenance tickets","maintenance.empty.subtitle":"Once you create a new ticket it will appear here.","maintenance.table.noBarcode":"No barcode","maintenance.stats.open":"{count} in maintenance","maintenance.stats.closed":"{count} closed","maintenance.stats.total":"{count} total tickets","maintenance.status.open":"In maintenance","maintenance.status.closed":"Closed","maintenance.priority.high":"High","maintenance.priority.medium":"Medium","maintenance.priority.low":"Low","maintenance.actions.close":"🔧 Close after repair","maintenance.actions.view":"👁️ View report","maintenance.actions.delete":"🗑️ Delete ticket","maintenance.toast.equipmentBlocked":"⚠️ This equipment is already under maintenance and can’t be selected","maintenance.toast.equipmentNotFoundBarcode":"❌ No equipment found with this barcode","maintenance.toast.equipmentNotFoundName":"❌ No equipment found with that name","maintenance.toast.equipmentBecameBlocked":"⚠️ This equipment is now under maintenance and can’t be selected","maintenance.toast.selectEquipment":"⚠️ Please select equipment","maintenance.toast.selectedNotFound":"❌ Selected equipment was not found","maintenance.toast.equipmentAlreadyMaintenance":"⚠️ This equipment is already marked as in maintenance","maintenance.toast.ticketExists":"⚠️ There is already an open maintenance ticket for this equipment","maintenance.toast.ticketCreated":"🛠️ Maintenance ticket created and equipment removed from service","maintenance.toast.storageError":"⚠️ Could not save maintenance data. Please try again.","maintenance.toast.submitError":"⚠️ Could not create the maintenance ticket. Please try again.","maintenance.toast.ticketClosed":"✅ Maintenance ticket closed and equipment set to available","maintenance.toast.ticketDeleted":"🗑️ Maintenance ticket deleted","maintenance.toast.ticketDeleteConfirm":"⚠️ Are you sure you want to delete this maintenance ticket?","maintenance.prompt.closeReport":"Enter repair report / actions taken:","maintenance.report.equipment":"Equipment","maintenance.report.barcode":"Barcode","maintenance.report.issue":"Issue","maintenance.report.createdAt":"Created at","maintenance.report.closedAt":"Closed at","maintenance.report.summary":"Report","maintenance.report.notAvailable":"Not available","maintenance.report.none":"—","maintenance.info.barcodeLabel":"Barcode","technicians.section.title":"😎 Crew Management","technicians.form.title":"📝 Add / Edit Crew Member","technicians.form.hint":"Enter crew member details to save and keep bookings updated.","technicians.form.labels.name":"😎 Crew Member","technicians.form.labels.phone":"📞 Phone","technicians.form.labels.role":"👔 Role","technicians.form.labels.department":"🧩 Department","technicians.form.labels.wage":"💰 Daily Rate","technicians.form.labels.status":"⚙️ Base Status","technicians.form.labels.notes":"📝 Notes","technicians.form.placeholders.name":"Crew member name","technicians.form.placeholders.phone":"05xxxxxxxx","technicians.form.placeholders.role":"e.g. Camera operator","technicians.form.placeholders.department":"e.g. Audio team","technicians.form.placeholders.wage":"0","technicians.form.placeholders.notes":"Additional information","technicians.form.actions.cancel":"Cancel edit","technicians.form.actions.submit":"➕ Add Crew Member","technicians.form.actions.update":"💾 Update Crew Member","technicians.picker.selectedLabel":"😎 Assigned crew","technicians.picker.openButton":"➕ Choose crew","technicians.picker.editButton":"🔁 Edit crew","technicians.picker.modalTitle":"😎 Select crew","technicians.picker.actions.apply":"Done","technicians.form.options.available":"✅ Available","technicians.form.options.busy":"⛔ Busy","technicians.search.placeholder":"🔍 Search crew member by name, phone, or role...","technicians.search.filters.allRoles":"👔 All roles","technicians.table.empty":"No crew members yet.","technicians.table.loading":"Loading...","technicians.table.headers.name":"😎 Crew Member","technicians.table.headers.phone":"📞 Phone","technicians.table.headers.role":"👔 Role","technicians.table.headers.department":"🧩 Department","technicians.table.headers.wage":"💰 Daily Rate","technicians.table.headers.status":"⚙️ Status","technicians.table.headers.notes":"📝 Notes","technicians.table.headers.actions":"⚙️ Actions","technicians.status.available":"✅ Available","technicians.status.busy":"⛔ Busy","technicians.table.wageSuffix":"SAR","technicians.actions.edit":"✏️ Edit","technicians.actions.delete":"🗑️ Delete","technicians.toast.missingName":"⚠️ Please enter the crew member name","technicians.toast.missingPhone":"⚠️ Please enter a contact number","technicians.toast.missingRole":"⚠️ Please enter the role","technicians.toast.invalidWage":"⚠️ Enter a valid daily wage","technicians.toast.addSuccess":"✅ Crew member added","technicians.toast.updateSuccess":"💾 Crew member updated","technicians.toast.notFound":"⚠️ Crew member not found","technicians.toast.unidentified":"⚠️ Unable to identify crew member","technicians.toast.dataNotFound":"⚠️ Crew member details not found","technicians.toast.editReady":"✏️ You can edit the crew member details now then press Save","technicians.toast.deleteConfirm":"⚠️ Are you sure you want to remove this crew member?","technicians.toast.deleteSuccess":"🗑️ Crew member removed"}});function x(){const e=JSON.parse(localStorage.getItem("customersList")||"[]"),t=JSON.parse(localStorage.getItem("reservationsList")||"[]"),n=JSON.parse(localStorage.getItem("equipmentList")||"[]"),s=JSON.parse(localStorage.getItem("techniciansList")||"[]"),a=JSON.parse(localStorage.getItem("maintenanceList")||"[]");return{customers:e,reservations:t,equipment:n,technicians:s,maintenance:a}}function F({customers:e,reservations:t,equipment:n,technicians:s,maintenance:a}){e&&localStorage.setItem("customersList",JSON.stringify(e)),t&&localStorage.setItem("reservationsList",JSON.stringify(t)),n&&localStorage.setItem("equipmentList",JSON.stringify(n)),s&&localStorage.setItem("techniciansList",JSON.stringify(s)),a&&localStorage.setItem("maintenanceList",JSON.stringify(a))}let{equipment:H}=x();H=H||[];const xn="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js";let we=null;function Ln(){return typeof XLSX<"u"?Promise.resolve():typeof window>"u"||typeof document>"u"?Promise.reject(new Error("XLSX library is not available in this environment")):we||(we=new Promise((e,t)=>{const n=document.querySelector('script[data-xlsx-loader="true"]');if(n){n.addEventListener("load",a,{once:!0}),n.addEventListener("error",i,{once:!0});return}const s=document.createElement("script");s.src=xn,s.async=!0,s.defer=!0,s.dataset.xlsxLoader="true",s.addEventListener("load",a,{once:!0}),s.addEventListener("error",i,{once:!0}),document.head.appendChild(s);function a(){if(typeof XLSX>"u"){t(new Error("XLSX did not load correctly"));return}e()}function i(){t(new Error("Failed to load XLSX library"))}}).catch(e=>{throw console.warn("⚠️ [equipment.js] ensureXLSXLoaded failed",e),we=null,e}),we)}async function na(e){if(!e)return;try{await Ln()}catch(n){console.error("❌ [equipment.js] Unable to load XLSX library",n),alert(o("equipment.toast.xlsxMissing","⚠️ مكتبة Excel (XLSX) غير محملة. تحقق من اتصال الإنترنت أو الروابط في dashboard.html"));return}const t=new FileReader;t.onload=function(n){try{const s=new Uint8Array(n.target.result),a=XLSX.read(s,{type:"array"}),i=a.Sheets[a.SheetNames[0]],r=XLSX.utils.sheet_to_json(i);if(!Array.isArray(r)||r.length===0){m(o("equipment.toast.uploadEmpty","⚠️ لم يتم العثور على بيانات في الملف"));return}const l=x().equipment||[];r.forEach(c=>{l.push({category:c.القسم||"",sub:c["القسم الثانوي"]||"",desc:c.الوصف||"",qty:c.الكمية||1,price:c.السعر||0,barcode:q(String(c.الباركود||"")),status:"متاح",image:c.الصورة||""})}),H=l,F({equipment:l}),m(o("equipment.toast.uploadSuccess","✅ تم رفع المعدات بنجاح")),U()}catch(s){console.error("❌ [equipment.js] Failed to process Excel file",s),m(o("equipment.toast.uploadFailed","❌ حدث خطأ أثناء قراءة ملف الإكسل"))}},t.onerror=function(){console.error("❌ [equipment.js] FileReader encountered an error",t.error),m(o("equipment.toast.uploadFailed","❌ حدث خطأ أثناء قراءة ملف الإكسل"))},t.readAsArrayBuffer(e)}function kn(){confirm(o("equipment.toast.clearConfirm","⚠️ هل أنت متأكد من حذف كل المعدات؟"))&&(H=[],F({equipment:[]}),m(o("equipment.toast.clearSuccess","🗑️ تم مسح جميع المعدات")),U())}function Dn(e){const t=Ce();t.push(e),H=t,F({equipment:t})}function Ce(){const{equipment:e}=x();return e||[]}function ie(e){return q(String(e||"")).trim().toLowerCase()}function Nn(e,t){if(!(e!=null&&e.start)||!(e!=null&&e.end))return!1;const n=new Date(e.start),s=new Date(e.end);return Number.isNaN(n.getTime())||Number.isNaN(s.getTime())?!1:n<=t&&t<s}function Ke(){const e=x();let{equipment:t=[],reservations:n=[],maintenance:s=[]}=e;if(!Array.isArray(t)||t.length===0)return H=t||[],H;const a=new Date;let i=!1;const r=new Set((s||[]).filter(c=>(c==null?void 0:c.status)==="open").map(c=>ie(c==null?void 0:c.equipmentBarcode))),l=t.map(c=>{var g;if(!c)return c;const d=ie(c.barcode),u=d&&r.has(d);let v=u||c.status==="صيانة"?"صيانة":"متاح";if(!u&&d)for(const p of n||[]){if(!Nn(p,a))continue;if((g=p.items)==null?void 0:g.some(y=>ie(y==null?void 0:y.barcode)===d)){v="محجوز";break}}return v!==c.status?(i=!0,{...c,status:v}):c});return i?(H=l,F({equipment:l}),l):(H=l,l)}function $n(e){const t=Ce();confirm(o("equipment.toast.deleteConfirm","❌ هل أنت متأكد من حذف هذه المعدة؟"))&&(t.splice(e,1),H=t,F({equipment:t}),m(o("equipment.toast.deleteSuccess","🗑️ تم حذف المعدة")),U())}function Mn(e,t){const n=Ce();n[e]={...n[e],...t},H=n,F({equipment:n}),m(o("equipment.toast.editSuccess","✏️ تم تعديل بيانات المعدة")),U()}function U(){var g,p,b,y;console.log("✅ renderEquipment تعمل");const e=document.getElementById("equipment-list");if(!e)return;const t=Ke(),n=Array.isArray(t)?t:Ce(),s=n.map((h,E)=>({item:h,index:E})),a=((g=document.getElementById("search-equipment"))==null?void 0:g.value)||"",i=q(a).toLowerCase().trim(),r=((p=document.getElementById("filter-category"))==null?void 0:p.value)||"",l=((b=document.getElementById("filter-sub"))==null?void 0:b.value)||"",c=((y=document.getElementById("filter-status"))==null?void 0:y.value)||"",u=s.filter(({item:h})=>{const E=ie(h.barcode).toLowerCase(),I=!i||h.name&&h.name.toLowerCase().includes(i)||h.desc&&h.desc.toLowerCase().includes(i)||h.description&&h.description.toLowerCase().includes(i)||E&&E.includes(i)||h.category&&h.category.toLowerCase().includes(i)||h.sub&&h.sub.toLowerCase().includes(i)||h.subcategory&&h.subcategory.toLowerCase().includes(i),S=!r||h.category===r,C=!l||h.sub===l,A=!c||h.status===c;return I&&S&&C&&A}).sort((h,E)=>{const I=ie(h.item.barcode),S=ie(E.item.barcode),C=parseInt(I,10),A=parseInt(S,10),w=!Number.isNaN(C),T=!Number.isNaN(A);return w&&T&&C!==A?C-A:I.localeCompare(S,"ar",{numeric:!0,sensitivity:"base"})}),f=o("equipment.list.emptyFiltered","⚠️ لا توجد معدات مطابقة.");e.innerHTML=u.length?u.map(Fn).join(""):`<em>${f}</em>`;const v=document.getElementById("equipment-list-count");if(v){const h=o("equipment.list.countSuffix","عنصر"),E=q(String(u.length)),I=u.length?`${E} ${h}`:`0 ${h}`;v.textContent=I}Rn(n)}function Rn(e){const t=[...new Set(e.map(i=>i.category).filter(Boolean))],n=[...new Set(e.map(i=>i.sub).filter(Boolean))],s=document.getElementById("filter-category"),a=document.getElementById("filter-sub");if(s){const i=s.value;for(;s.options.length>1;)s.remove(1);t.forEach(r=>{const l=document.createElement("option");l.value=r,l.textContent=r,s.appendChild(l)}),t.includes(i)&&(s.value=i)}if(a){const i=a.value;for(;a.options.length>1;)a.remove(1);n.forEach(r=>{const l=document.createElement("option");l.value=r,l.textContent=r,a.appendChild(l)}),n.includes(i)&&(a.value=i)}}function Tt(e){return e.image||e.imageUrl||e.img||""}function Fn({item:e,index:t}){const n=Tt(e),s=o("equipment.item.actions.edit","✏️ تعديل"),a=o("equipment.item.actions.delete","🗑️ حذف"),i=o("equipment.item.imageAlt","صورة"),r=o("equipment.item.currency","ريال");return`
    <div class="border-bottom py-3 d-flex align-items-center">
      <div class="equipment-image me-3" style="width:120px;height:120px;">
        ${n?`<img src="${n}" alt="${i}" class="img-fluid rounded" style="width:100%;height:100%;object-fit:cover;">`:'<div class="no-image d-flex align-items-center justify-content-center bg-light rounded" style="width:100%;height:100%;font-size:36px;">📦</div>'}
      </div>

      <div class="flex-grow-1">
        <div><strong>🏷️ ${e.desc||"-"}</strong></div>
        <div class="text-muted">${e.category||"-"} - ${e.sub||"-"}</div>

        <div class="mt-1">
          📦 <strong>${e.qty||0}</strong> | 💵 <strong>${e.price||0}</strong> ${r} | 🔖 ${e.barcode||"-"}
        </div>

        <div class="mt-1">⚙️ ${Hn(e.status)}</div>
      </div>

      <div class="ms-3 d-flex flex-column gap-2">
        <button class="btn btn-sm btn-warning" onclick="editEquipmentModal(${t})">${s}</button>
        <button class="btn btn-sm btn-danger" onclick="deleteEquipment(${t})">${a}</button>
      </div>
    </div>
  `}function Pn(e){var p,b,y,h,E,I,S,C,A,w,T,D;e.preventDefault();const t=e.target,n=((b=(p=t.querySelector("#new-equipment-desc"))==null?void 0:p.value)==null?void 0:b.trim())||"",s=((y=t.querySelector("#new-equipment-barcode"))==null?void 0:y.value)||"",a=q(s).trim(),i=parseFloat(((h=t.querySelector("#new-equipment-price"))==null?void 0:h.value)||"0")||0,r=parseInt(((E=t.querySelector("#new-equipment-qty"))==null?void 0:E.value)||"1",10)||1,l=((S=(I=t.querySelector("#new-equipment-image"))==null?void 0:I.value)==null?void 0:S.trim())||"",c=((A=(C=t.querySelector("#new-equipment-category"))==null?void 0:C.value)==null?void 0:A.trim())||"",d=((T=(w=t.querySelector("#new-equipment-sub"))==null?void 0:w.value)==null?void 0:T.trim())||"",u=((D=t.querySelector("#new-equipment-status"))==null?void 0:D.value)||"متاح";if(!n||!a){m(o("equipment.toast.missingFields","⚠️ يرجى إدخال الوصف والباركود"));return}if(Ce().some(k=>ie(k.barcode)===a)){m(o("equipment.toast.duplicateBarcode","⚠️ هذا الباركود مستخدم مسبقًا"));return}const v={id:Date.now(),category:c,sub:d,desc:n,qty:r,price:i,barcode:a,status:u,image:l};Dn(v),m(o("equipment.toast.addSuccess","✅ تم إضافة المعدة")),t.reset();const g=t.querySelector("#new-equipment-status");g&&(g.value="متاح"),U()}function Hn(e){const t=String(e||"").toLowerCase();return t==="available"||e==="متاح"?`<span class="badge bg-success">${o("equipment.form.options.available","✅ متاح")}</span>`:t==="reserved"||e==="محجوز"?`<span class="badge bg-warning text-dark">${o("equipment.form.options.booked","📌 محجوز")}</span>`:t==="maintenance"||e==="صيانة"?`<span class="badge bg-danger">${o("equipment.form.options.maintenance","🛠️ صيانة")}</span>`:`<span class="badge bg-secondary">${e||"-"}</span>`}window.editEquipmentModal=function(e){const{equipment:t}=x(),n=t[e];if(!n)return;document.getElementById("edit-equipment-index").value=e,document.getElementById("edit-equipment-category").value=n.category||"",document.getElementById("edit-equipment-subcategory").value=n.sub||"",document.getElementById("edit-equipment-description").value=n.desc||"",document.getElementById("edit-equipment-quantity").value=n.qty||1,document.getElementById("edit-equipment-price").value=n.price||0,document.getElementById("edit-equipment-barcode").value=n.barcode||"",document.getElementById("edit-equipment-status").value=n.status||"متاح",document.getElementById("edit-equipment-image").value=Tt(n)||"",new bootstrap.Modal(document.getElementById("editEquipmentModal")).show()};var qt;(qt=document.getElementById("save-equipment-changes"))==null||qt.addEventListener("click",()=>{const e=document.getElementById("edit-equipment-index").value,t={category:document.getElementById("edit-equipment-category").value,sub:document.getElementById("edit-equipment-subcategory").value,desc:document.getElementById("edit-equipment-description").value,qty:parseInt(document.getElementById("edit-equipment-quantity").value)||1,price:parseFloat(document.getElementById("edit-equipment-price").value)||0,barcode:document.getElementById("edit-equipment-barcode").value,status:document.getElementById("edit-equipment-status").value,image:document.getElementById("edit-equipment-image").value};Mn(e,t),bootstrap.Modal.getInstance(document.getElementById("editEquipmentModal")).hide(),m(o("equipment.toast.updateSuccess","✅ تم تحديث بيانات المعدة بنجاح"))});window.deleteEquipment=$n;window.clearEquipment=kn;var Et;(Et=document.getElementById("search-equipment"))==null||Et.addEventListener("input",U);var wt;(wt=document.getElementById("filter-category"))==null||wt.addEventListener("change",U);var It;(It=document.getElementById("filter-sub"))==null||It.addEventListener("change",U);var St;(St=document.getElementById("filter-status"))==null||St.addEventListener("change",U);var Ct;(Ct=document.getElementById("add-equipment-form"))==null||Ct.addEventListener("submit",Pn);document.addEventListener("DOMContentLoaded",U);document.addEventListener("language:changed",U);let ue=[],At=[],xt=[];function Be(){return ue}function On(e){ue=Array.isArray(e)?e:[]}function Lt(e){ue=[...ue,e]}function jn(e){Number.isInteger(e)&&e>=0&&(ue=ue.filter((t,n)=>n!==e))}function Un(){return At}function zn(e){At=Array.isArray(e)?e:[]}function Xn(){return xt}function _n(e){xt=Array.isArray(e)?e:[]}function Wn(e){if(!e)return{date:"",time:""};const[t="",n=""]=e.split("T"),s=n?n.slice(0,5):"";return{date:t,time:s}}function Q(e,t){if(!e)return"";const n=t&&t.length?t:"00:00";return`${e}T${n}`}function N(e){return q(String(e||"")).trim().toLowerCase()}function fe(e,t,n,s=null){if(!e||!t||!n)return!1;const a=new Date(t),i=new Date(n);if(Number.isNaN(a.getTime())||Number.isNaN(i.getTime()))return!1;const{reservations:r=[]}=x(),l=N(e);return r.some(c=>{if(!c||!c.items||c.items.length===0||s&&(String(c.id)===String(s)||String(c.reservationId)===String(s))||!c.start||!c.end)return!1;const d=new Date(c.start),u=new Date(c.end);return Number.isNaN(d.getTime())||Number.isNaN(u.getTime())||!(d<i&&u>a)?!1:c.items.some(v=>N(v==null?void 0:v.barcode)===l)})}function Ge(e,t,n,s=null){if(!e||!t||!n)return!1;const a=new Date(t),i=new Date(n);if(Number.isNaN(a.getTime())||Number.isNaN(i.getTime()))return!1;const{reservations:r=[]}=x(),l=String(e);return r.some(c=>{if(!(c!=null&&c.start)||!(c!=null&&c.end)||s&&(String(c.id)===String(s)||String(c.reservationId)===String(s)))return!1;const d=new Date(c.start),u=new Date(c.end);return Number.isNaN(d.getTime())||Number.isNaN(u.getTime())||!(d<i&&u>a)?!1:(Array.isArray(c.technicians)?c.technicians:[]).some(g=>String(g)===l)})}function Te(e={}){return e.image||e.imageUrl||e.img||""}function kt(e){if(!e)return null;const t=N(e),{equipment:n=[]}=x();return(n||[]).find(s=>N(s==null?void 0:s.barcode)===t)||null}function ve(e){const t=kt(e);return(t==null?void 0:t.status)==="صيانة"}function Yn(e){const t=N(e);if(!t)return null;const{equipment:n=[]}=x();return(n||[]).find(s=>N(s==null?void 0:s.barcode)===t)||null}let j=null,pt=!1;function Ae(){const{technicians:e=[]}=x();return Array.isArray(e)?e:[]}function Dt(){document.dispatchEvent(new CustomEvent("technicians:updated"))}function Ze(e){F({technicians:e}),Dt()}function De(e=""){return q(String(e)).trim().toLowerCase()}function ft(e){return e==null?"":String(e)}function oe(e=""){return q(String(e)).replace(/[^0-9+]/g,"")}function me(e=""){const t=q(String(e)).replace(/[^0-9.]/g,"");if(!t.includes("."))return t;const[n,...s]=t.split(".");return`${n}.${s.join("")}`}function $e(e,t){!e||e.dataset.normalizerAttached||(e.addEventListener("input",()=>{const n=t(e.value);if(e.value!==n){const s=e.selectionEnd;e.value=n,s!=null&&e.setSelectionRange(n.length,n.length)}}),e.dataset.normalizerAttached="true")}function et(e="add"){const t=document.getElementById("technician-submit-btn");if(!t)return;const n=e==="update"?"technicians.form.actions.update":"technicians.form.actions.submit",s=e==="update"?"💾 حفظ التعديل":"➕ إضافة عضو طاقم";t.textContent=o(n,s)}function tt(e){const t=document.getElementById("technician-cancel-btn");t&&(e?t.classList.remove("d-none"):t.classList.add("d-none"),t.textContent=o("technicians.form.actions.cancel","إلغاء التعديل"))}function Nt(){et(j?"update":"add"),tt(!!j),Z()}function Jn(e=[]){const t=document.getElementById("technician-role-filter");if(!t)return"";const n=t.value,s=Array.from(new Set(e.map(i=>((i==null?void 0:i.role)||"").trim()).filter(Boolean))).sort((i,r)=>i.localeCompare(r,"ar",{sensitivity:"base"})),a=o("technicians.search.filters.allRoles","👔 كل الوظائف");return t.innerHTML=`<option value="">${a}</option>`+s.map(i=>`<option value="${i}">${i}</option>`).join(""),n&&s.includes(n)?t.value=n:t.value="",t.value}function Oe(){const e=document.getElementById("technician-form");if(!e)return;e.reset();const t=document.getElementById("technician-status");t&&(t.value="available"),j=null,et("add"),tt(!1)}function Vn(e){const t=document.getElementById("technician-name"),n=document.getElementById("technician-phone"),s=document.getElementById("technician-role"),a=document.getElementById("technician-department"),i=document.getElementById("technician-wage"),r=document.getElementById("technician-status"),l=document.getElementById("technician-notes");!t||!n||!s||!i||!r||(t.value=e.name||"",n.value=oe(e.phone||""),s.value=e.role||"",a&&(a.value=e.department||""),i.value=me(e.dailyWage!=null?e.dailyWage:""),r.value=e.baseStatus||e.status||"available",l&&(l.value=e.notes||""),j=String(e.id),et("update"),tt(!0))}function Qn(){const e=document.getElementById("technician-name"),t=document.getElementById("technician-phone"),n=document.getElementById("technician-role"),s=document.getElementById("technician-department"),a=document.getElementById("technician-wage"),i=document.getElementById("technician-status"),r=document.getElementById("technician-notes");if(!e||!t||!n||!a||!i)return null;const l=e.value.trim(),c=oe(t.value.trim());t.value=c;const d=n.value.trim(),u=(s==null?void 0:s.value.trim())||"",f=me(a.value.trim());a.value=f;const v=f===""?0:parseFloat(f),g=i.value||"available",p=(r==null?void 0:r.value.trim())||"";return l?c?d?Number.isNaN(v)||v<0?(m(o("technicians.toast.invalidWage","⚠️ أدخل قيمة صحيحة للأجر اليومي")),a.focus(),null):{name:l,phone:c,role:d,department:u,dailyWage:Number.isFinite(v)?v:0,status:g,baseStatus:g,notes:p}:(m(o("technicians.toast.missingRole","⚠️ يرجى إدخال الوظيفة")),n.focus(),null):(m(o("technicians.toast.missingPhone","⚠️ يرجى إدخال رقم التواصل")),t.focus(),null):(m(o("technicians.toast.missingName","⚠️ يرجى إدخال اسم عضو الطاقم")),e.focus(),null)}function Kn(e){e.preventDefault();const t=Qn();if(!t)return;const n=Ae();let s=o("technicians.toast.addSuccess","✅ تم إضافة عضو الطاقم");if(j){const a=n.findIndex(i=>String(i.id)===String(j));if(a===-1){m(o("technicians.toast.notFound","⚠️ تعذر العثور على عضو الطاقم المطلوب"));return}n[a]={...n[a],...t,id:j},s=o("technicians.toast.updateSuccess","💾 تم حفظ بيانات عضو الطاقم")}else{const a=Date.now().toString();n.push({id:a,...t})}Ze(n),m(s),Oe(),Z()}function Gn(){Oe()}function Zn(e){const t={id:document.getElementById("edit-technician-id"),name:document.getElementById("edit-technician-name"),phone:document.getElementById("edit-technician-phone"),role:document.getElementById("edit-technician-role"),department:document.getElementById("edit-technician-department"),wage:document.getElementById("edit-technician-wage"),status:document.getElementById("edit-technician-status"),notes:document.getElementById("edit-technician-notes")};if(!t.id||!t.name||!t.phone||!t.role||!t.wage||!t.status)return;t.id.value=e.id||"",t.name.value!==(e.name||"")&&(t.name.value=e.name||"");const n=oe(e.phone||"");t.phone.value!==n&&(t.phone.value=n),t.role.value!==(e.role||"")&&(t.role.value=e.role||""),t.department&&t.department.value!==(e.department||"")&&(t.department.value=e.department||"");const s=me(e.dailyWage!=null?e.dailyWage:"");t.wage.value!==s&&(t.wage.value=s);const a=e.baseStatus||e.status||"available";t.status.value!==a&&(t.status.value=a),t.notes&&t.notes.value!==(e.notes||"")&&(t.notes.value=e.notes||""),$e(t.phone,oe),$e(t.wage,me)}function es(){const e=document.getElementById("edit-technician-id"),t=document.getElementById("edit-technician-name"),n=document.getElementById("edit-technician-phone"),s=document.getElementById("edit-technician-role"),a=document.getElementById("edit-technician-department"),i=document.getElementById("edit-technician-wage"),r=document.getElementById("edit-technician-status"),l=document.getElementById("edit-technician-notes");if(!e||!t||!n||!s||!i||!r)return null;const c=e.value.trim(),d=t.value.trim(),u=oe(n.value.trim());n.value=u;const f=s.value.trim(),v=(a==null?void 0:a.value.trim())||"",g=me(i.value.trim());i.value=g;const p=g===""?0:parseFloat(g),b=r.value||"available",y=(l==null?void 0:l.value.trim())||"";return c?d?u?f?Number.isNaN(p)||p<0?(m(o("technicians.toast.invalidWage","⚠️ أدخل قيمة صحيحة للأجر اليومي")),i.focus(),null):{id:c,name:d,phone:u,role:f,department:v,dailyWage:Number.isFinite(p)?p:0,status:b,baseStatus:b,notes:y}:(m(o("technicians.toast.missingRole","⚠️ يرجى إدخال الوظيفة")),s.focus(),null):(m(o("technicians.toast.missingPhone","⚠️ يرجى إدخال رقم التواصل")),n.focus(),null):(m(o("technicians.toast.missingName","⚠️ يرجى إدخال اسم عضو الطاقم")),t.focus(),null):(m(o("technicians.toast.unidentified","⚠️ تعذر تحديد عضو الطاقم المطلوب")),null)}function ts(){var a,i;const e=es();if(!e)return;const t=Ae(),n=t.findIndex(r=>String(r.id)===String(e.id));if(n===-1){m(o("technicians.toast.notFound","⚠️ تعذر العثور على عضو الطاقم المطلوب"));return}t[n]={...t[n],...e},Ze(t),m(o("technicians.toast.updateSuccess","💾 تم حفظ بيانات عضو الطاقم"));const s=document.getElementById("editTechnicianModal");s&&((a=window.bootstrap)!=null&&a.Modal)&&((i=window.bootstrap.Modal.getInstance(s))==null||i.hide()),Z()}function Z(){const e=document.getElementById("technicians-table");if(!e)return;const t=document.getElementById("search-technician-input"),n=De((t==null?void 0:t.value)||""),s=he(),{reservations:a=[]}=x(),i=new Date;Jn(s);const r=document.getElementById("technician-role-filter"),l=De((r==null?void 0:r.value)||""),c=s.filter(d=>l&&De(d.role||"")!==l?!1:n?De([d.name,d.phone,d.role,d.department,d.notes].filter(Boolean).join(" ")).includes(n):!0);if(c.length===0){const d=o("technicians.table.empty","لا يوجد أعضاء في الطاقم بعد.");e.innerHTML=`<tr><td colspan='8' class='text-center'>${d}</td></tr>`;return}e.innerHTML=c.map(d=>{const u=j&&String(j)===String(d.id),g=($t(d.id,a,i)?"busy":d.status||d.baseStatus||"available")==="busy"?{label:o("technicians.status.busy","⛔ مشغول"),className:"badge bg-danger"}:{label:o("technicians.status.available","✅ متاح"),className:"badge bg-success"},p=Number(d.dailyWage),y=(Number.isFinite(p)?p:0).toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:2}),h=oe(d.phone||""),E=o("technicians.table.wageSuffix","ريال"),I=o("technicians.actions.edit","✏️ تعديل"),S=o("technicians.actions.delete","🗑️ حذف");return`
      <tr${u?' class="table-info"':""}>
        <td><a href="technician.html?id=${d.id}" class="text-decoration-none">${d.name}</a></td>
        <td>${h}</td>
        <td>${d.role||""}</td>
        <td>${d.department||"—"}</td>
        <td>${y} ${E}</td>
        <td><span class="${g.className}">${g.label}</span></td>
        <td class="table-notes-cell">${d.notes||"—"}</td>
        <td class="table-actions-cell">
          <div class="table-action-buttons">
            <button class="btn btn-sm btn-warning technician-edit-btn" data-id="${d.id}">${I}</button>
            <button class="btn btn-sm btn-danger technician-delete-btn" data-id="${d.id}">${S}</button>
          </div>
        </td>
      </tr>
    `}).join("")}function ns(e){const t=Ae().find(n=>String(n.id)===String(e));if(!t){m(o("technicians.toast.dataNotFound","⚠️ تعذر العثور على بيانات عضو الطاقم"));return}Vn(t),m(o("technicians.toast.editReady","✏️ يمكنك تعديل بيانات عضو الطاقم الآن ثم الضغط على حفظ التعديل"))}function ss(e){if(!confirm(o("technicians.toast.deleteConfirm","⚠️ هل أنت متأكد من حذف هذا العضو؟")))return;const t=Ae().filter(n=>String(n.id)!==String(e));Ze(t),m(o("technicians.toast.deleteSuccess","🗑️ تم حذف عضو الطاقم")),j&&String(j)===String(e)&&Oe(),Z()}function sa(){Mt(),Z()}function aa(e){return Ae().find(t=>String(t.id)===String(e))||null}function $t(e,t=[],n){const s=ft(e);return s?t.some(a=>{if(!a||!a.start||!a.end||!(Array.isArray(a.technicians)?a.technicians:[]).some(c=>ft(c)===s))return!1;const r=new Date(a.start),l=new Date(a.end);return Number.isNaN(r.getTime())||Number.isNaN(l.getTime())?!1:r<=n&&n<l}):!1}function he(){const{technicians:e=[],reservations:t=[]}=x();if(!Array.isArray(e)||e.length===0)return Array.isArray(e)?e:[];const n=new Date;let s=!1;const a=e.map(i=>{if(!i)return i;const r=i.baseStatus||i.status||"available";let l=r==="busy"?"busy":"available";return $t(i.id,t,n)&&(l="busy"),(l!==i.status||r!==i.baseStatus)&&(s=!0),{...i,baseStatus:r,status:l}});return s?(F({technicians:a}),Dt(),a):e}function Mt(){const e=document.getElementById("technician-form"),t=e&&!e.dataset.initialized;e&&!e.dataset.listenerAttached&&(e.addEventListener("submit",Kn),e.dataset.listenerAttached="true"),e&&(e.dataset.initialized="true");const n=document.getElementById("technician-cancel-btn");n&&!n.dataset.listenerAttached&&(n.addEventListener("click",Gn),n.dataset.listenerAttached="true"),$e(document.getElementById("technician-phone"),oe),$e(document.getElementById("technician-wage"),me);const s=document.getElementById("technicians-table");s&&!s.dataset.listenerAttached&&(s.addEventListener("click",l=>{const c=l.target;if(c instanceof HTMLElement){if(c.classList.contains("technician-edit-btn")){const d=c.dataset.id;ns(d)}if(c.classList.contains("technician-delete-btn")){const d=c.dataset.id;ss(d)}}}),s.dataset.listenerAttached="true");const a=document.getElementById("search-technician-input");a&&!a.dataset.listenerAttached&&(a.addEventListener("input",()=>{a.value=q(a.value),Z()}),a.dataset.listenerAttached="true");const i=document.getElementById("technician-role-filter");i&&!i.dataset.listenerAttached&&(i.addEventListener("change",()=>{Z()}),i.dataset.listenerAttached="true");const r=document.getElementById("save-technician-changes");r&&!r.dataset.listenerAttached&&(r.addEventListener("click",ts),r.dataset.listenerAttached="true"),pt||(document.addEventListener("technician:prefill",l=>{const c=l.detail;c&&Zn(c)}),pt=!0),t&&Oe()}document.addEventListener("DOMContentLoaded",()=>{Mt(),Z(),Nt()});document.addEventListener("technicians:updated",()=>{Z()});document.addEventListener("language:changed",()=>{Nt()});let re=[],K=[],G=[],Me="create",nt=()=>{},st=()=>{};function as(e={}){const t=[e.dailyWage,e.daily_rate,e.dailyRate,e.wage,e.rate];for(const n of t){const s=Number(n);if(Number.isFinite(s))return s}return 0}function Rt(e={}){const t=as(e);if(!Number.isFinite(t)||t<=0)return"—";const n=o("technicians.table.wageSuffix","ريال");return`${q(String(t))} ${n}`}function vt(e=""){return q(String(e)).trim().toLowerCase()}function Ft(e){return!re||!re.length?null:re.find(t=>String(t==null?void 0:t.id)===String(e))||null}function is(e,t="create"){t==="edit"?je(G.filter(n=>String(n)!==String(e))):it(K.filter(n=>String(n)!==String(e)))}function Re(e,t=[],n){const s=document.getElementById(e);if(s){if(!t||t.length===0){const a=o("reservations.crew.none","لم يتم اختيار أي عضو من الطاقم.");s.innerHTML=`<span class="text-muted">${a}</span>`;return}s.innerHTML=t.map(a=>{const i=Ft(a)||{},r=o("reservations.crew.fallbackName","عضو الطاقم {id}").replace("{id}",a),l=i.name||r,c=i.role?`<small class="technician-chip-role">${i.role}</small>`:"",d=Rt(i),u=d!=="—"?`<small class="technician-chip-wage">💰 ${d}</small>`:"",f=o("reservations.crew.removeAria","إزالة");return`
        <span class="technician-chip" data-id="${a}">
          <span class="technician-chip-name">${l}</span>
          ${c}
          ${u}
          <button type="button" class="technician-chip-remove" data-context="${n}" data-id="${a}" aria-label="${f}">✖</button>
        </span>
      `}).join(""),s.querySelectorAll(".technician-chip-remove").forEach(a=>{a.dataset.listenerAttached||(a.addEventListener("click",()=>is(a.dataset.id,a.dataset.context)),a.dataset.listenerAttached="true")})}}function Pt(){return Me==="edit"?G:K}function Fe(){const e=document.querySelector("#technician-picker-table tbody");if(!e)return;const t=document.getElementById("technician-picker-search"),n=vt((t==null?void 0:t.value)||""),s=new Set(Pt().map(String)),i=(re||[]).filter(r=>n?vt([r.name,r.phone,r.role,r.department,r.notes].filter(Boolean).join(" ")).includes(n):!0);if(i.length===0){const r=o("reservations.crew.searchEmpty","لا يوجد نتائج مطابقة.");e.innerHTML=`<tr><td colspan="5" class="text-center text-muted">${r}</td></tr>`;return}e.innerHTML=i.map(r=>{const l=Rt(r);return`
      <tr>
        <td style="width:40px;">
          <input class="form-check-input technician-picker-checkbox" type="checkbox" value="${r.id}" ${s.has(String(r.id))?"checked":""}>
        </td>
        <td>${r.name||"-"}</td>
        <td>${r.role||"—"}</td>
        <td>${r.department||"—"}</td>
        <td>${l}</td>
      </tr>
    `}).join("")}function rs(){return Array.from(document.querySelectorAll(".technician-picker-checkbox:checked")).map(e=>e.value).filter(Boolean)}function os(e="create"){var l,c,d,u,f,v,g,p,b,y,h,E,I,S,C,A,w;if(e==="edit"){const T=(c=(l=document.getElementById("edit-res-start"))==null?void 0:l.value)==null?void 0:c.trim(),D=(u=(d=document.getElementById("edit-res-end"))==null?void 0:d.value)==null?void 0:u.trim(),k=((v=(f=document.getElementById("edit-res-start-time"))==null?void 0:f.value)==null?void 0:v.trim())||"00:00",B=((p=(g=document.getElementById("edit-res-end-time"))==null?void 0:g.value)==null?void 0:p.trim())||"00:00",$=T?Q(T,k):null,M=D?Q(D,B):null;let _=null;const W=(b=document.getElementById("edit-res-index"))==null?void 0:b.value;if(W!=null){const Y=Number.parseInt(W,10);if(Number.isInteger(Y)){const{reservations:z=[]}=x(),X=z==null?void 0:z[Y];X&&(_=X.id??X.reservationId??null)}}return{start:$,end:M,ignoreReservationId:_}}const t=(h=(y=document.getElementById("res-start"))==null?void 0:y.value)==null?void 0:h.trim(),n=(I=(E=document.getElementById("res-end"))==null?void 0:E.value)==null?void 0:I.trim(),s=((C=(S=document.getElementById("res-start-time"))==null?void 0:S.value)==null?void 0:C.trim())||"00:00",a=((w=(A=document.getElementById("res-end-time"))==null?void 0:A.value)==null?void 0:w.trim())||"00:00",i=t?Q(t,s):null,r=n?Q(n,a):null;return{start:i,end:r,ignoreReservationId:null}}function pe(){const e=document.getElementById("technician-picker-selection-info");if(!e)return;const t=Pt().length;if(t){const n=o("reservations.crew.selectedCount","تم اختيار {count} عضو").replace("{count}",q(String(t)));e.textContent=n}else e.textContent=o("reservations.crew.noneShort","لم يتم اختيار أي عضو بعد")}function cs(){var i;const e=rs().map(String),{start:t,end:n,ignoreReservationId:s}=os(Me);if(t&&n){const r=e.filter(l=>Ge(l,t,n,s));if(r.length>0){const l=r.map(d=>{var u;return((u=Ft(d))==null?void 0:u.name)||d}).join(o("reservations.list.crew.separator","، ")),c=o("reservations.toast.technicianSelectionConflict","⚠️ لا يمكن اختيار {names} لأنهم مرتبطون بحجز آخر في نفس الفترة الزمنية").replace("{names}",l);r.forEach(d=>{const u=document.querySelector(`.technician-picker-checkbox[value="${CSS.escape(String(d))}"]`);u&&(u.checked=!1)}),m(c),pe();return}}Me==="edit"?je(e):it(e),pe();const a=document.getElementById("selectTechniciansModal");a&&((i=window.bootstrap)!=null&&i.Modal)&&window.bootstrap.Modal.getOrCreateInstance(a).hide()}function ht(e="create"){var a;Me=e;const t=he();Array.isArray(t)&&t.length&&(re=t);const n=document.getElementById("technician-picker-search");n&&(n.value=""),Fe(),pe();const s=document.getElementById("selectTechniciansModal");s&&((a=window.bootstrap)!=null&&a.Modal)&&window.bootstrap.Modal.getOrCreateInstance(s).show()}function ls(){var i;const e=document.getElementById("open-technician-picker");e&&!e.dataset.listenerAttached&&(e.addEventListener("click",()=>ht("create")),e.dataset.listenerAttached="true");const t=document.getElementById("open-edit-technician-picker");t&&!t.dataset.listenerAttached&&(t.addEventListener("click",()=>ht("edit")),t.dataset.listenerAttached="true");const n=document.getElementById("technician-picker-search");n&&!n.dataset.listenerAttached&&(n.addEventListener("input",()=>{Fe(),pe()}),n.dataset.listenerAttached="true");const s=document.getElementById("apply-technician-selection");s&&!s.dataset.listenerAttached&&(s.addEventListener("click",cs),s.dataset.listenerAttached="true");const a=document.getElementById("selectTechniciansModal");a&&!a.dataset.listenerAttached&&((i=window.bootstrap)!=null&&i.Modal)&&(a.addEventListener("shown.bs.modal",()=>{pe(),Fe()}),a.addEventListener("hidden.bs.modal",()=>{const r=document.getElementById("technician-picker-search");r&&(r.value="")}),a.dataset.listenerAttached="true"),at()}function at(){Re("selected-technicians-list",K,"create"),Re("edit-selected-technicians-list",G,"edit")}function ds({onDraftChange:e,onEditChange:t}={}){nt=typeof e=="function"?e:()=>{},st=typeof t=="function"?t:()=>{},at(),ls()}function us(e=[]){re=Array.isArray(e)?e:[]}function Ht(){return[...K]}function Ot(){return[...G]}function it(e=[]){K=Array.isArray(e)?e.map(String):[],Re("selected-technicians-list",K,"create"),nt()}function je(e=[]){G=Array.isArray(e)?e.map(String):[],Re("edit-selected-technicians-list",G,"edit"),st()}function ms(){it([])}function ps(){je([])}function jt(e=[]){us(e);const t=new Set(re.map(l=>String(l.id))),n=K.filter(l=>t.has(String(l))),s=G.filter(l=>t.has(String(l))),a=n.length!==K.length,i=s.length!==G.length;K=n,G=s,at(),a&&nt(),i&&st();const r=document.getElementById("selectTechniciansModal");r&&r.classList.contains("show")&&(Fe(),pe())}function fs(e={}){const t=[e.dailyWage,e.daily_rate,e.dailyRate,e.wage,e.rate];for(const n of t){const s=Number(n);if(Number.isFinite(s))return s}return 0}function vs(e=[]){if(!Array.isArray(e)||e.length===0)return 0;const{technicians:t=[]}=x();if(!Array.isArray(t)||t.length===0)return 0;const n=new Map(t.filter(s=>s&&(s.id!=null||s.ID!=null)).map(s=>[String(s.id??s.ID),s]));return e.reduce((s,a)=>{const i=n.get(String(a));return i?s+fs(i):s},0)}function Ue(e=[],t=0,n="percent",s=!1,a=[]){let i=e.reduce((r,l)=>r+(l.qty||1)*(l.price||0),0);return i+=vs(a),t&&(n==="percent"?i-=i*(t/100):n==="amount"&&(i-=t)),s&&(i+=i*.15),Math.max(0,Math.round(i))}function Ut({total:e,itemsCount:t,techniciansCount:n,applyTax:s,paidStatus:a,totalKey:i="reservations.summary.total"}){const r=o("reservations.create.summary.currency","ريال"),l=q(String(e)),c=q(String(t)),d=q(String(n)),u=s?o("reservations.summary.taxIncluded","شامل الضريبة 15%"):o("reservations.summary.taxExcluded","غير شامل الضريبة"),f=a==="paid"?o("reservations.create.paymentStatus.paid","مدفوع"):o("reservations.create.paymentStatus.unpaid","غير مدفوع"),v=o(i,"💰 التكلفة الإجمالية: <strong>{total} {currency}</strong>").replace("{total}",l).replace("{currency}",r),g=o("reservations.summary.itemsCount","📦 عدد المعدات: {count}").replace("{count}",c),p=o("reservations.summary.crewCount","😎 عدد الفريق: {count}").replace("{count}",d),b=o("reservations.summary.paymentLabel","💳 حالة الدفع: {status}").replace("{status}",f);return`
    <div class="alert alert-info">
      ${v}<br>
      ${g}<br>
      ${p}<br>
      ${u}<br>
      ${b}
    </div>
  `}function hs({selectedItems:e,discount:t,discountType:n,applyTax:s,paidStatus:a}){const i=Ht(),r=i.length,l=Ue(e,t,n,s,i),c=Ut({total:l,itemsCount:e.length,techniciansCount:r,applyTax:s,paidStatus:a});bs(c)}function gs({items:e,discount:t,discountType:n,applyTax:s,paidStatus:a}){const i=Ot(),r=i.length,l=Ue(e,t,n,s,i);return Ut({total:l,itemsCount:e.length,techniciansCount:r,applyTax:s,paidStatus:a,totalKey:"reservations.summary.totalAfterEdit"})}function bs(e){const t=document.getElementById("reservation-preview");t&&(t.innerHTML=e);const n=document.getElementById("reservation-preview-bottom");n&&(n.innerHTML=e)}function ne(e=""){return q(String(e)).trim().toLowerCase()}function Ie(e){if(!(e!=null&&e.end))return!1;const t=new Date(e.end);return Number.isNaN(t.getTime())?!1:t<new Date}let Qe=null;function zt(){var a,i,r,l,c,d,u,f;const e=(i=(a=document.getElementById("res-start"))==null?void 0:a.value)==null?void 0:i.trim(),t=(l=(r=document.getElementById("res-end"))==null?void 0:r.value)==null?void 0:l.trim(),n=((d=(c=document.getElementById("res-start-time"))==null?void 0:c.value)==null?void 0:d.trim())||"00:00",s=((f=(u=document.getElementById("res-end-time"))==null?void 0:u.value)==null?void 0:f.trim())||"00:00";return!e||!t?{start:null,end:null}:{start:Q(e,n),end:Q(t,s)}}function Xt(e){const t=ne(e);return t&&(Xn()||[]).find(s=>ne((s==null?void 0:s.desc)||(s==null?void 0:s.description)||"").includes(t))||null}function ge(){const e=document.getElementById("equipment-description-options"),t=document.getElementById("edit-res-equipment-description-options"),{equipment:n=[]}=x(),s=Array.isArray(n)?n:[];_n(s);const i=Array.from(new Set(s.map(r=>(r==null?void 0:r.desc)||(r==null?void 0:r.description)||"").filter(Boolean))).sort((r,l)=>r.localeCompare(l,"ar",{sensitivity:"base"})).map(r=>`<option value="${r}"></option>`).join("");e&&(e.innerHTML=i),t&&(t.innerHTML=i)}function _t(e){if(!e)return;const t=e.value.trim();if(!t)return;const n=Xt(t);if(!n){m(o("reservations.toast.equipmentNameNotFound","❌ لم يتم العثور على معدة بالاسم المدخل"));return}const s=kt(n.barcode);if((s==null?void 0:s.status)==="صيانة"){m(o("reservations.toast.equipmentMaintenance","⚠️ هذه المعدة قيد الصيانة ولا يمكن إضافتها حالياً"));return}const a=N(n.barcode);if(!a){m(o("reservations.toast.equipmentMissingBarcode","⚠️ هذه المعدة لا تحتوي على باركود معرف"));return}const i={id:n.id,barcode:a,desc:n.desc||n.description||n.name||"",qty:1,price:Number.isFinite(Number(n.price))?Number(n.price):0,image:Te(n)},{start:r,end:l}=zt();if(!r||!l){m(o("reservations.toast.requireDatesBeforeAdd","⚠️ يرجى تحديد تاريخ ووقت البداية والنهاية قبل إضافة المعدات"));return}if(Be().some(u=>N(u.barcode)===a)){m(o("reservations.toast.equipmentDuplicate","⚠️ هذه المعدة موجودة بالفعل في الحجز"));return}if(fe(a,r,l)){m(o("reservations.toast.equipmentTimeConflict","⚠️ لا يمكن إضافة المعدة لأنها محجوزة في نفس الفترة الزمنية"));return}if(ve(a)){m(o("reservations.toast.equipmentMaintenance","⚠️ هذه المعدة قيد الصيانة ولا يمكن إضافتها حالياً"));return}Lt(i),be(),O(),e.value=""}function ys(){ge();const e=document.getElementById("equipment-description");e&&!e.dataset.listenerAttached&&(e.addEventListener("keydown",t=>{t.key==="Enter"&&(t.preventDefault(),_t(e))}),e.dataset.listenerAttached="true")}function be(e="reservation-items"){const t=document.getElementById(e);if(!t)return;const n=Be(),s=o("reservations.create.equipment.noneAdded","لا توجد معدات مضافة"),a=o("reservations.create.summary.currency","ريال"),i=o("reservations.create.equipment.imageAlt","صورة");if(n.length===0){t.innerHTML=`<tr><td colspan="5">${s}</td></tr>`;return}t.innerHTML=n.map((r,l)=>{const c=Te(r),d=`${q(String(r.price??0))} ${a}`,u=c?`<img src="${c}" alt="${i}" class="reservation-item-thumb">`:"-";return`
        <tr>
          <td>${r.barcode||"-"}</td>
          <td>${r.desc}</td>
          <td>${d}</td>
          <td>${u}</td>
          <td><button type="button" class="btn btn-sm btn-danger" data-action="remove-item" data-index="${l}">🗑️</button></td>
        </tr>
      `}).join("")}function O(){var i,r,l,c;const e=((i=document.getElementById("res-discount"))==null?void 0:i.value)||"0",t=parseFloat(q(e))||0,n=((r=document.getElementById("res-discount-type"))==null?void 0:r.value)||"percent",s=((l=document.getElementById("res-tax"))==null?void 0:l.checked)||!1,a=((c=document.getElementById("res-payment-status"))==null?void 0:c.value)||"unpaid";hs({selectedItems:Be(),discount:t,discountType:n,applyTax:s,paidStatus:a})}function qs(){const e=document.getElementById("res-discount");e&&!e.dataset.listenerAttached&&(e.addEventListener("input",a=>{a.target.value=q(a.target.value),O()}),e.dataset.listenerAttached="true");const t=document.getElementById("res-discount-type");t&&!t.dataset.listenerAttached&&(t.addEventListener("change",O),t.dataset.listenerAttached="true");const n=document.getElementById("res-tax");n&&!n.dataset.listenerAttached&&(n.addEventListener("change",O),n.dataset.listenerAttached="true");const s=document.getElementById("res-payment-status");s&&!s.dataset.listenerAttached&&(s.addEventListener("change",O),s.dataset.listenerAttached="true")}function gt(){var C,A,w,T,D,k,B;const e=document.getElementById("res-customer").value.trim().toLowerCase(),{customers:t,reservations:n}=x();let s=t.find($=>{var M;return((M=$.customerName)==null?void 0:M.trim().toLowerCase())===e});if(s||(s=t.find($=>{var M;return(M=$.customerName)==null?void 0:M.toLowerCase().includes(e)})),!s){m(o("reservations.toast.customerNotFound","⚠️ لم يتم العثور على العميل بالاسم المدخل"));return}const a=s.id,i=document.getElementById("res-start").value,r=document.getElementById("res-end").value,l=((C=document.getElementById("res-start-time"))==null?void 0:C.value)||"00:00",c=((A=document.getElementById("res-end-time"))==null?void 0:A.value)||"00:00";if(!i||!r){m(o("reservations.toast.requireDates","⚠️ يرجى تحديد تاريخ البداية والنهاية"));return}const d=`${i}T${l}`,u=`${r}T${c}`,f=new Date(d),v=new Date(u);if(Number.isNaN(f.getTime())||Number.isNaN(v.getTime())||f>=v){m(o("reservations.toast.invalidDateRange","⚠️ تأكد من أن تاريخ ووقت البداية يسبق تاريخ ووقت النهاية"));return}const g=Be();if(g.length===0){m(o("reservations.toast.noItems","⚠️ لا يمكنك إنشاء حجز بدون معدات"));return}const p=((w=document.getElementById("res-notes"))==null?void 0:w.value)||"",b=parseFloat(q((T=document.getElementById("res-discount"))==null?void 0:T.value))||0,y=((D=document.getElementById("res-discount-type"))==null?void 0:D.value)||"percent",h=((k=document.getElementById("res-tax"))==null?void 0:k.checked)||!1,E=((B=document.getElementById("res-payment-status"))==null?void 0:B.value)||"unpaid",I=Ht();for(const $ of g)if(ve($.barcode)){m(o("reservations.toast.cannotCreateEquipmentMaintenance","⚠️ لا يمكن إتمام الحجز لأن إحدى المعدات قيد الصيانة"));return}for(const $ of g){const M=N($.barcode);if(fe(M,d,u)){m(o("reservations.toast.cannotCreateEquipmentConflict","⚠️ لا يمكن إتمام الحجز، إحدى المعدات محجوزة في نفس الفترة الزمنية"));return}}for(const $ of I)if(Ge($,d,u)){m(o("reservations.toast.cannotCreateCrewConflict","⚠️ لا يمكن إتمام الحجز، أحد أعضاء الطاقم مرتبط بحجز آخر في نفس الفترة"));return}const S={id:Date.now(),reservationId:An(),customerId:parseInt(a,10),start:d,end:u,items:[...g],technicians:I,notes:p,discount:b,discountType:y,applyTax:h,paid:E==="paid",cost:Ue(g,b,y,h,I),confirmed:!1};n.push(S),F({reservations:n}),Ke(),ge(),he(),Es(),m(o("reservations.toast.created","✅ تم إنشاء الحجز")),typeof Qe=="function"&&Qe(S)}function Es(){document.getElementById("res-customer").value="",document.getElementById("res-start").value="",document.getElementById("res-start-time").value="",document.getElementById("res-end").value="",document.getElementById("res-end-time").value="",document.getElementById("res-notes").value="",document.getElementById("res-discount").value="",document.getElementById("res-tax").checked=!1;const e=document.getElementById("equipment-description");e&&(e.value="");const t=document.getElementById("res-payment-status");t&&(t.value="unpaid"),ms(),On([]),be(),O()}function ws(){const e=document.getElementById("reservation-items");!e||e.dataset.listenerAttached||(e.addEventListener("click",t=>{const n=t.target.closest('button[data-action="remove-item"]');if(!n)return;const s=Number(n.dataset.index);jn(s),be(),O()}),e.dataset.listenerAttached="true")}function Is(){const e=document.getElementById("equipment-barcode");!e||e.dataset.listenerAttached||(e.addEventListener("keydown",t=>{if(t.key!=="Enter")return;t.preventDefault();const n=N(e.value);if(!n)return;const{start:s,end:a}=zt();if(!s||!a){m(o("reservations.toast.requireDatesBeforeAdd","⚠️ يرجى تحديد تاريخ ووقت البداية والنهاية قبل إضافة المعدات"));return}if(Be().some(d=>N(d.barcode)===n)){m(o("reservations.toast.equipmentDuplicate","⚠️ هذه المعدة موجودة بالفعل في الحجز"));return}if(fe(n,s,a)){m(o("reservations.toast.equipmentTimeConflict","⚠️ لا يمكن إضافة المعدة لأنها محجوزة في نفس الفترة الزمنية"));return}const{equipment:l}=x(),c=(l||[]).find(d=>N(d.barcode)===n);if(!c){m(o("reservations.toast.barcodeNotFound","❌ الباركود غير موجود"));return}if(ve(c.barcode)){m(o("reservations.toast.equipmentMaintenance","⚠️ هذه المعدة قيد الصيانة ولا يمكن إضافتها حالياً"));return}Lt({id:c.id,barcode:N(c.barcode),desc:c.desc,qty:1,price:c.price,image:Te(c)}),e.value="",be(),O(),m(o("reservations.toast.equipmentAdded","✅ تم إضافة المعدة بنجاح"))}),e.dataset.listenerAttached="true")}function Ss(){const e=document.getElementById("reservation-form");e&&!e.dataset.listenerAttached&&(e.addEventListener("submit",n=>{n.preventDefault(),gt()}),e.dataset.listenerAttached="true");const t=document.getElementById("create-reservation-btn");t&&!t.dataset.listenerAttached&&(t.addEventListener("click",n=>{n.preventDefault(),gt()}),t.dataset.listenerAttached="true")}function Cs(){const e=document.getElementById("res-customer"),t=document.getElementById("customer-suggestions");if(!e||!t)return;const n=i=>{if(!i||i.length===0){t.style.display="none",t.innerHTML="";return}t.innerHTML=i.map(r=>`<div class="suggestion-item" data-name="${r}">${r}</div>`).join(""),t.style.display="block",t.querySelectorAll(".suggestion-item").forEach(r=>{r.addEventListener("mousedown",l=>{l.preventDefault();const c=l.target.getAttribute("data-name");e.value=c,t.style.display="none"})})},s=()=>{const i=Un()||[];return[...new Set(i.map(r=>r.customerName).filter(Boolean))]},a=()=>{const i=ne(e.value),r=s(),l=i?r.filter(c=>ne(c).startsWith(i)).slice(0,10):r.slice(0,10);n(l)};e.addEventListener("input",()=>{a()}),e.addEventListener("focus",()=>{a()}),e.addEventListener("blur",()=>{setTimeout(()=>{t.style.display="none"},150)})}function Bs({onAfterSubmit:e}={}){Qe=typeof e=="function"?e:null;const{customers:t}=x();zn(t||[]),ge(),ys(),qs(),ws(),Is(),Ss(),Cs(),O(),be()}function rt(){ge(),be(),O()}function Wt(e){const t=new Date;if(t.setHours(0,0,0,0),e==="today")return{startDate:ae(t),endDate:ae(t)};if(e==="week"){const n=new Date(t),s=n.getDay(),a=s===0?6:s-1;n.setDate(n.getDate()-a);const i=new Date(n);return i.setDate(n.getDate()+6),{startDate:ae(n),endDate:ae(i)}}if(e==="month"){const n=new Date(t.getFullYear(),t.getMonth(),1),s=new Date(t.getFullYear(),t.getMonth()+1,0);return{startDate:ae(n),endDate:ae(s)}}return e==="upcoming"?{startDate:ae(t),endDate:""}:{startDate:"",endDate:""}}function Ts(){const e=document.getElementById("search-reservation"),t=document.getElementById("filter-start-date"),n=document.getElementById("filter-end-date"),s=document.getElementById("reservation-date-range"),a=document.getElementById("reservation-status-filter");let i=q((t==null?void 0:t.value)||"").trim(),r=q((n==null?void 0:n.value)||"").trim(),l=(s==null?void 0:s.value)||"";if(new Set(["","today","week","month"]).has(l)||(l="",s&&(s.value=""),Pe(t),Pe(n),i="",r=""),!i&&!r&&l){const d=Wt(l);i=d.startDate,r=d.endDate}return{searchTerm:ne((e==null?void 0:e.value)||""),startDate:i,endDate:r,status:(a==null?void 0:a.value)||"",quickRange:l}}function As(e){const t=()=>{typeof e=="function"&&e()},n=document.getElementById("search-reservation");n&&!n.dataset.listenerAttached&&(n.addEventListener("input",()=>{n.value=q(n.value),t()}),n.dataset.listenerAttached="true");const s=document.getElementById("filter-start-date");s&&!s.dataset.listenerAttached&&(s.addEventListener("change",()=>{const c=document.getElementById("reservation-date-range");c&&(c.value=""),t()}),s.dataset.listenerAttached="true");const a=document.getElementById("filter-end-date");a&&!a.dataset.listenerAttached&&(a.addEventListener("change",()=>{const c=document.getElementById("reservation-date-range");c&&(c.value=""),t()}),a.dataset.listenerAttached="true");const i=document.getElementById("reservation-date-range");i&&!i.dataset.listenerAttached&&(i.addEventListener("change",()=>{xs(i.value),t()}),i.dataset.listenerAttached="true");const r=document.getElementById("reservation-status-filter");r&&!r.dataset.listenerAttached&&(r.addEventListener("change",t),r.dataset.listenerAttached="true");const l=document.getElementById("clear-filters");l&&!l.dataset.listenerAttached&&(l.addEventListener("click",()=>{n&&(n.value=""),Pe(s),Pe(a),i&&(i.value=""),r&&(r.value=""),t()}),l.dataset.listenerAttached="true")}function xs(e){const t=document.getElementById("filter-start-date"),n=document.getElementById("filter-end-date");if(!t||!n)return;const{startDate:s,endDate:a}=Wt(e);t._flatpickr?s?t._flatpickr.setDate(s,!1,"Y-m-d"):t._flatpickr.clear():t.value=s,n._flatpickr?a?n._flatpickr.setDate(a,!1,"Y-m-d"):n._flatpickr.clear():n.value=a}function ae(e){if(!e)return"";const t=e.getTimezoneOffset()*6e4;return new Date(e.getTime()-t).toISOString().split("T")[0]}function Pe(e){e&&(e._flatpickr&&e._flatpickr.clear(),e.value="")}function Ls({reservations:e=[],filters:t={},customersMap:n,techniciansMap:s}){const a=e.map((y,h)=>({reservation:y,index:h})),i=t.searchTerm||"",r=t.searchReservationId||"",l=t.searchCustomerName||"",c=t.startDate||"",d=t.endDate||"",u=t.status||"",f=Object.prototype.hasOwnProperty.call(t,"customerId")?t.customerId:null,v=Object.prototype.hasOwnProperty.call(t,"technicianId")?t.technicianId:null,g=c?new Date(`${c}T00:00:00`):null,p=d?new Date(`${d}T23:59:59`):null,b=a.filter(({reservation:y})=>{var T,D;const h=n.get(String(y.customerId)),E=y.start?new Date(y.start):null,I=y.confirmed===!0||y.confirmed==="true",S=Ie(y);if(f!=null&&String(y.customerId)!==String(f)||v!=null&&!(Array.isArray(y.technicians)?y.technicians.map(B=>String(B)):[]).includes(String(v))||u==="confirmed"&&!I||u==="pending"&&I||u==="completed"&&!S||g&&E&&E<g||p&&E&&E>p||r&&!ne([y.reservationId,y.id].filter(Boolean).map(String).join(" ")).includes(r)||l&&!ne((h==null?void 0:h.customerName)||"").includes(l))return!1;if(!i)return!0;const C=((D=(T=y.items)==null?void 0:T.map)==null?void 0:D.call(T,k=>`${k.barcode} ${k.desc}`).join(" "))||"",A=(y.technicians||[]).map(k=>{var B;return(B=s.get(String(k)))==null?void 0:B.name}).filter(Boolean).join(" ");return ne([y.reservationId,h==null?void 0:h.customerName,y.notes,C,A].filter(Boolean).join(" ")).includes(i)});return b.sort((y,h)=>{const E=Ie(y.reservation),I=Ie(h.reservation);if(E!==I)return E?1:-1;const S=y.reservation.start?new Date(y.reservation.start).getTime():0;return(h.reservation.start?new Date(h.reservation.start).getTime():0)-S}),b}function ks({entries:e,customersMap:t,techniciansMap:n}){const s=o("reservations.create.summary.currency","ريال"),a=o("reservations.list.taxIncludedShort","(شامل الضريبة)"),i=o("reservations.list.unknownCustomer","غير معروف"),r=o("reservations.list.noNotes","لا توجد ملاحظات"),l=o("reservations.list.itemsCountShort","{count} عنصر"),c=o("reservations.list.crew.separator","، "),d=o("reservations.list.status.confirmed","✅ مؤكد"),u=o("reservations.list.status.pending","⏳ غير مؤكد"),f=o("reservations.list.payment.paid","💳 مدفوع"),v=o("reservations.list.payment.unpaid","💳 غير مدفوع"),g=o("reservations.list.actions.confirm","✔️ تأكيد"),p={client:o("reservations.list.labels.client","👤 العميل"),start:o("reservations.list.labels.start","🗓️ بداية الحجز"),end:o("reservations.list.labels.end","🗓️ نهاية الحجز"),cost:o("reservations.list.labels.cost","💵 التكلفة"),equipment:o("reservations.list.labels.equipment","📦 المعدات"),crew:o("reservations.list.labels.crew","😎 الفريق")};return e.map(({reservation:b,index:y})=>{var se;const h=t.get(String(b.customerId)),E=b.confirmed===!0||b.confirmed==="true",I=Ie(b),S=b.paid===!0||b.paid==="paid";let C=E?`<span class="badge bg-success reservation-chip">${d}</span>`:`<span class="badge bg-warning text-dark reservation-chip">${u}</span>`,A=S?`<span class="badge bg-primary reservation-chip">${f}</span>`:`<span class="badge bg-danger reservation-chip">${v}</span>`,w=S?" tile-paid":" tile-unpaid";I&&(w+=" tile-completed");let T="";I&&(C=`<span class="badge reservation-chip chip-completed">${d}</span>`,A=`<span class="badge reservation-chip chip-completed">${S?f:v}</span>`,T=` data-completed-label="${o("reservations.list.ribbon.completed","منتهي").replace(/"/g,"&quot;")}"`);const D=E?"":`<button class="btn btn-sm btn-success tile-confirm" data-reservation-index="${y}" data-action="confirm">${g}</button>`,k=((se=b.items)==null?void 0:se.length)||0,B=(b.technicians||[]).map(J=>n.get(String(J))).filter(Boolean),$=B.map(J=>J.name).join(c)||"—",M=q(String(b.reservationId??"")),_=b.start?q(Ne(b.start)):"-",W=b.end?q(Ne(b.end)):"-",Y=q(String(b.cost??0)),z=q(String(k)),X=b.notes?q(b.notes):r,le=l.replace("{count}",z),de=b.applyTax?`<small>${a}</small>`:"";return`
      <div class="reservation-tile${w}"${T} data-reservation-index="${y}" data-action="details">
        <div class="tile-top">
          <div class="tile-id">${M}</div>
          <div class="tile-badges">
            ${C}
            ${A}
          </div>
        </div>
        <div class="tile-body">
          <div class="tile-row">
            <span class="tile-label">${p.client}</span>
            <span class="tile-value">${(h==null?void 0:h.customerName)||i}</span>
          </div>
          <div class="tile-row">
            <span class="tile-label">${p.start}</span>
            <span class="tile-value tile-inline">${_}</span>
          </div>
          <div class="tile-row">
            <span class="tile-label">${p.end}</span>
            <span class="tile-value tile-inline">${W}</span>
          </div>
          <div class="tile-row">
            <span class="tile-label">${p.cost}</span>
            <span class="tile-value">${Y} ${s} ${de}</span>
          </div>
          <div class="tile-row">
            <span class="tile-label">${p.equipment}</span>
            <span class="tile-value">${le}</span>
          </div>
          <div class="tile-row">
            <span class="tile-label">${p.crew}</span>
            <span class="tile-value">${B.length?$:"—"}</span>
          </div>
        </div>
        <div class="tile-footer">
          <span class="tile-notes">📝 ${X}</span>
          ${D}
        </div>
      </div>
    `}).join("")}function Ds(e,t,n=[],s){const a=e.confirmed===!0||e.confirmed==="true",i=e.paid===!0||e.paid==="paid",r=Ie(e),l=e.items||[],c=new Map(n.map(L=>[String(L.id),L])),d=(e.technicians||[]).map(L=>c.get(String(L))).filter(Boolean),u=l.reduce((L,R)=>L+(R.qty||1)*(R.price||0),0),f=parseFloat(e.discount)||0,v=e.discountType==="amount"?f:u*(f/100),g=Math.max(0,u-v),p=e.applyTax?g*.15:0,b=e.cost??Math.round(g+p),y=q(String(e.reservationId??e.id??"")),h=e.start?q(Ne(e.start)):"-",E=e.end?q(Ne(e.end)):"-",I=q(String(d.length)),S=q(u.toFixed(2)),C=q(v.toFixed(2)),A=q(p.toFixed(2)),w=q((b??0).toFixed(2)),T=o("reservations.create.summary.currency","ريال"),D=o("reservations.details.labels.discount","الخصم"),k=o("reservations.details.labels.tax","الضريبة (15%)"),B={index:"#",code:o("reservations.details.table.headers.code","الكود"),description:o("reservations.details.table.headers.description","الوصف"),quantity:o("reservations.details.table.headers.quantity","الكمية"),price:o("reservations.details.table.headers.price","السعر"),image:o("reservations.details.table.headers.image","الصورة")},$=o("reservations.details.noItems","📦 لا توجد معدات ضمن هذا الحجز حالياً."),M=o("reservations.details.noCrew","😎 لا يوجد فريق مرتبط بهذا الحجز."),_=o("reservations.details.technicians.roleUnknown","غير محدد"),W=o("reservations.details.technicians.phoneUnknown","غير متوفر"),Y=o("reservations.details.technicians.wage","{amount} {currency} / اليوم"),z=o("reservations.list.status.confirmed","✅ مؤكد"),X=o("reservations.list.status.pending","⏳ غير مؤكد"),le=o("reservations.list.payment.paid","💳 مدفوع"),de=o("reservations.list.payment.unpaid","💳 غير مدفوع"),se=o("reservations.list.status.completed","📁 منتهي"),J=o("reservations.details.labels.id","🆔 رقم الحجز"),ye=o("reservations.details.section.bookingInfo","بيانات الحجز"),xe=o("reservations.details.section.paymentSummary","ملخص الدفع"),V=o("reservations.details.labels.finalTotal","المجموع النهائي"),qe=o("reservations.details.section.crew","😎 الفريق الفني"),en=o("reservations.details.crew.count","{count} عضو"),tn=o("reservations.details.section.items","📦 المعدات المرتبطة"),nn=o("reservations.details.items.count","{count} عنصر"),sn=o("reservations.details.actions.edit","✏️ تعديل"),an=o("reservations.details.actions.delete","🗑️ حذف"),rn=o("reservations.details.labels.customer","العميل"),on=o("reservations.details.labels.contact","رقم التواصل"),cn=o("reservations.details.labels.start","بداية الحجز"),ln=o("reservations.details.labels.end","نهاية الحجز"),dn=o("reservations.details.labels.notes","ملاحظات"),un=o("reservations.list.noNotes","لا توجد ملاحظات"),mn=o("reservations.details.labels.itemsCount","عدد المعدات"),pn=o("reservations.details.labels.itemsTotal","إجمالي المعدات"),fn=o("reservations.details.labels.paymentStatus","حالة الدفع"),vn=o("reservations.list.unknownCustomer","غير معروف"),lt=i?le:de,dt=l.length,hn=q(String(dt)),ut=nn.replace("{count}",hn),gn=en.replace("{count}",I),bn=e.notes?q(e.notes):un,Le=[{icon:"💳",label:fn,value:lt},{icon:"📦",label:mn,value:ut},{icon:"💼",label:pn,value:`${S} ${T}`}];v>0&&Le.push({icon:"💸",label:D,value:`${C} ${T}`}),e.applyTax&&p>0&&Le.push({icon:"🧾",label:k,value:`${A} ${T}`}),Le.push({icon:"💰",label:V,value:`${w} ${T}`});const yn=Le.map(({icon:L,label:R,value:ee})=>`
    <div class="summary-details-row">
      <span class="summary-details-label">${L} ${R}</span>
      <span class="summary-details-value">${ee}</span>
    </div>
  `).join(""),mt=[{text:a?z:X,className:a?"status-confirmed":"status-pending"},{text:lt,className:i?"status-paid":"status-unpaid"}];r&&mt.push({text:se,className:"status-completed"});const qn=mt.map(({text:L,className:R})=>`<span class="status-chip ${R}">${L}</span>`).join(""),Ee=(L,R,ee)=>`
    <div class="res-info-row">
      <span class="label">${L} ${R}</span>
      <span class="value">${ee}</span>
    </div>
  `,En=[Ee("👤",rn,(t==null?void 0:t.customerName)||vn),Ee("📞",on,(t==null?void 0:t.phone)||"—"),Ee("🗓️",cn,h),Ee("🗓️",ln,E),Ee("📝",dn,bn)].join(""),wn=dt?l.map((L,R)=>{const ee=Te(L),Ye=q(String(L.barcode||"-")),Je=q(String(L.qty||1)),ke=q(String(L.price||0)),Bn=q(String(R+1)),Tn=ee?`<img src="${ee}" alt="${L.desc||""}" class="reservation-modal-item-thumb">`:"-";return`
          <tr>
            <td>${Bn}</td>
            <td>${Ye}</td>
            <td>${L.desc||"-"}</td>
            <td>${Je}</td>
            <td>${ke} ${T}</td>
            <td>${Tn}</td>
          </tr>
        `}).join(""):`<tr><td colspan="6" class="text-center">${$}</td></tr>`,In=`
    <div class="table-responsive reservation-modal-items-wrapper">
      <table class="table table-sm table-hover align-middle reservation-modal-items-table">
        <thead>
          <tr>
            <th>${B.index}</th>
            <th>${B.code}</th>
            <th>${B.description}</th>
            <th>${B.quantity}</th>
            <th>${B.price}</th>
            <th>${B.image}</th>
          </tr>
        </thead>
        <tbody>${wn}</tbody>
      </table>
    </div>
  `,Sn=d.map((L,R)=>{const ee=q(String(R+1)),Ye=L.role||_,Je=L.phone||W,ke=L.wage?Y.replace("{amount}",q(String(L.wage))).replace("{currency}",T):"";return`
      <div class="reservation-technician-card">
        <div class="technician-card-head">
          <span class="technician-index">${ee}</span>
          <span class="technician-name">${L.name}</span>
        </div>
        <div class="technician-card-body">
          <div>🎯 ${Ye}</div>
          <div>📞 ${Je}</div>
          ${ke?`<div>💰 ${ke}</div>`:""}
        </div>
      </div>
    `}).join(""),Cn=d.length?`<div class="reservation-technicians-grid">${Sn}</div>`:`<ul class="reservation-modal-technicians"><li>${M}</li></ul>`;return`
    <div class="reservation-modal">
      <div class="reservation-modal-header">
        <div class="reservation-modal-id">
          <span>${J}</span>
          <strong>${y}</strong>
        </div>
        <div class="status-chips">
          ${qn}
        </div>
      </div>

      <div class="reservation-modal-grid">
        <div class="reservation-info-card">
          <h6>${ye}</h6>
          ${En}
        </div>
        <div class="reservation-summary-card">
          <div class="summary-icon">💳</div>
          <div class="summary-body">
            <h6 class="summary-heading">${xe}</h6>
            <div class="summary-details">
              ${yn}
            </div>
          </div>
        </div>
      </div>

      <div class="reservation-technicians-section">
        <div class="section-title">
          <span>${qe}</span>
          <span class="count">${gn}</span>
        </div>
        ${Cn}
      </div>

      <div class="reservation-items-section">
        <div class="section-title">
          <span>${tn}</span>
          <span class="count">${ut}</span>
        </div>
        ${In}
      </div>

      <div class="reservation-modal-actions">
        <button type="button" class="btn btn-warning" id="reservation-details-edit-btn" data-index="${s}">${sn}</button>
        <button type="button" class="btn btn-danger" id="reservation-details-delete-btn" data-index="${s}">${an}</button>
      </div>
    </div>
  `}function Ns({containerId:e="reservations-list",filters:t=null,onShowDetails:n,onConfirmReservation:s}={}){const a=he(),{reservations:i=[],customers:r=[],technicians:l=[]}=x(),c=Array.isArray(a)?a:l||[],d=document.getElementById(e);if(!d){console.warn("⚠️ [reservations/renderers] container not found",e);return}if(!i||i.length===0){d.innerHTML=`<p>${o("reservations.list.empty","⚠️ لا توجد حجوزات بعد.")}</p>`;return}const u=t||Ts(),f=new Map(r.map(p=>[String(p.id),p])),v=new Map(c.map(p=>[String(p.id),p])),g=Ls({reservations:i,filters:u,customersMap:f,techniciansMap:v});if(g.length===0){d.innerHTML=`<p>${o("reservations.list.noResults","🔍 لا توجد حجوزات مطابقة للبحث.")}</p>`;return}d.innerHTML=`<div class="reservations-grid">${ks({entries:g,customersMap:f,techniciansMap:v})}</div>`,d.querySelectorAll('[data-action="details"]').forEach(p=>{const b=Number(p.dataset.reservationIndex);Number.isNaN(b)||p.addEventListener("click",()=>{typeof n=="function"&&n(b)})}),d.querySelectorAll('button[data-action="confirm"]').forEach(p=>{const b=Number(p.dataset.reservationIndex);Number.isNaN(b)||p.addEventListener("click",y=>{y.stopPropagation(),typeof s=="function"&&s(b,y)})})}function $s(e,{onEdit:t,onDelete:n,getEditContext:s}={}){var g;const{reservations:a=[],customers:i=[]}=x(),r=a[e];if(!r)return m(o("reservations.toast.notFound","⚠️ تعذر العثور على بيانات الحجز")),!1;const l=i.find(p=>String(p.id)===String(r.customerId)),c=document.getElementById("reservation-details-body");if(c){const p=he()||[];c.innerHTML=Ds(r,l,p,e)}const d=document.getElementById("reservationDetailsModal"),u=()=>{var p,b;d&&((p=window.bootstrap)!=null&&p.Modal)&&((b=window.bootstrap.Modal.getInstance(d))==null||b.hide())},f=document.getElementById("reservation-details-edit-btn");f&&(f.onclick=()=>{u(),typeof t=="function"&&t(e,{reservation:r,customer:l,getEditContext:s})});const v=document.getElementById("reservation-details-delete-btn");return v&&(v.onclick=()=>{u(),typeof n=="function"&&n(e,{reservation:r,customer:l})}),d&&((g=window.bootstrap)!=null&&g.Modal)&&window.bootstrap.Modal.getOrCreateInstance(d).show(),!0}function Yt(){Ke(),he()}function Ms(e,{onAfterChange:t}={}){const{reservations:n=[]}=x();return!Array.isArray(n)||!n[e]?(m(o("reservations.toast.notFound","⚠️ تعذر العثور على بيانات الحجز")),!1):(n.splice(e,1),F({reservations:n}),Yt(),t==null||t(),m(o("reservations.toast.deleted","🗑️ تم حذف الحجز")),!0)}function Rs(e,{onAfterChange:t}={}){const{reservations:n=[]}=x(),s=n[e];return s?(s.confirmed=!0,F({reservations:n}),Yt(),t==null||t(),m(o("reservations.toast.confirmed","✅ تم تأكيد الحجز")),!0):(m(o("reservations.toast.notFound","⚠️ تعذر العثور على بيانات الحجز")),!1)}let Se=null,te=[],P=null,Ve={};function ze(){return{index:Se,items:te}}function Xe(e,t){Se=typeof e=="number"?e:null,te=Array.isArray(t)?[...t]:[]}function Jt(){Se=null,te=[],ps()}function Fs(e,t){var n;return e?typeof t=="function"?t(e):(n=window==null?void 0:window.bootstrap)!=null&&n.Modal?window.bootstrap.Modal.getOrCreateInstance(e):typeof bootstrap<"u"&&(bootstrap!=null&&bootstrap.Modal)?bootstrap.Modal.getOrCreateInstance(e):null:null}function bt(e,{populateEquipmentDescriptionLists:t,setFlatpickrValue:n,splitDateTime:s,renderEditItems:a,updateEditReservationSummary:i,ensureModal:r}={}){var T,D,k;const{reservations:l,customers:c}=x(),d=l==null?void 0:l[e];if(!d){m(o("reservations.toast.notFound","⚠️ تعذر العثور على بيانات الحجز"));return}t==null||t();const u=d.items?d.items.map(B=>({...B,barcode:N(B==null?void 0:B.barcode)})):[];Xe(e,u);const f=o("reservations.list.unknownCustomer","غير معروف"),v=(T=c==null?void 0:c.find)==null?void 0:T.call(c,B=>String(B.id)===String(d.customerId));(D=document.getElementById("edit-res-index"))==null||D.setAttribute("value",String(e));const g=document.getElementById("edit-res-id");g&&(g.value=d.reservationId||d.id);const p=document.getElementById("edit-res-customer");p&&(p.value=(v==null?void 0:v.customerName)||f);const b=typeof s=="function"?s(d.start):{date:"",time:""},y=typeof s=="function"?s(d.end):{date:"",time:""};n==null||n("edit-res-start",b.date),n==null||n("edit-res-start-time",b.time),n==null||n("edit-res-end",y.date),n==null||n("edit-res-end-time",y.time);const h=document.getElementById("edit-res-notes");h&&(h.value=d.notes||"");const E=document.getElementById("edit-res-discount");E&&(E.value=q(d.discount??0));const I=document.getElementById("edit-res-discount-type");I&&(I.value=d.discountType||"percent");const S=document.getElementById("edit-res-tax");S&&(S.checked=!!d.applyTax);const C=document.getElementById("edit-res-confirmed");C&&(C.checked=d.confirmed===!0||d.confirmed==="true");const A=document.getElementById("edit-res-paid");A&&(A.value=d.paid===!0||d.paid==="paid"?"paid":"unpaid"),je((d.technicians||[]).map(B=>String(B))),a==null||a(u),i==null||i();const w=document.getElementById("editReservationModal");P=Fs(w,r),(k=P==null?void 0:P.show)==null||k.call(P)}function Ps({combineDateTime:e,hasEquipmentConflict:t,hasTechnicianConflict:n,updateEditReservationSummary:s,renderReservations:a,populateEquipmentDescriptionLists:i,handleReservationsMutation:r}={}){var k,B,$,M,_,W,Y,z,X,le,de,se,J,ye,xe;if(Se===null){console.warn("⚠️ [reservationsEdit.js] No reservation selected for editing");return}const l=(B=(k=document.getElementById("edit-res-start"))==null?void 0:k.value)==null?void 0:B.trim(),c=((M=($=document.getElementById("edit-res-start-time"))==null?void 0:$.value)==null?void 0:M.trim())||"00:00",d=(W=(_=document.getElementById("edit-res-end"))==null?void 0:_.value)==null?void 0:W.trim(),u=((z=(Y=document.getElementById("edit-res-end-time"))==null?void 0:Y.value)==null?void 0:z.trim())||"00:00",f=((X=document.getElementById("edit-res-notes"))==null?void 0:X.value)||"",v=q(((le=document.getElementById("edit-res-discount"))==null?void 0:le.value)||"0"),g=parseFloat(v)||0,p=((de=document.getElementById("edit-res-discount-type"))==null?void 0:de.value)||"percent",b=((se=document.getElementById("edit-res-tax"))==null?void 0:se.checked)||!1,y=((J=document.getElementById("edit-res-confirmed"))==null?void 0:J.checked)||!1,h=((ye=document.getElementById("edit-res-paid"))==null?void 0:ye.value)||"unpaid",E=Ot();if(!l||!d){m(o("reservations.toast.requireDates","⚠️ يرجى تحديد تاريخ البداية والنهاية"));return}const I=typeof e=="function"?e:(V,qe)=>`${V}T${qe||"00:00"}`,S=I(l,c),C=I(d,u);if(S&&C&&new Date(S)>new Date(C)){m(o("reservations.toast.invalidDateOrder","⚠️ تاريخ البداية لا يمكن أن يكون بعد تاريخ النهاية"));return}const{reservations:A}=x(),w=A==null?void 0:A[Se];if(!w){m(o("reservations.toast.reservationMissing","⚠️ تعذر العثور على الحجز المطلوب"));return}if(!Array.isArray(te)||te.length===0){m(o("reservations.toast.updateNoItems","⚠️ لا يمكن حفظ التعديلات لعدم وجود معدات"));return}for(const V of te)if(ve(V.barcode)){m(o("reservations.toast.updateEquipmentMaintenance","⚠️ لا يمكن حفظ التعديلات لأن إحدى المعدات قيد الصيانة"));return}const T=typeof t=="function"?t:()=>!1;for(const V of te){const qe=N(V.barcode);if(T(qe,S,C,w.id??w.reservationId)){m(o("reservations.toast.updateEquipmentConflict","⚠️ لا يمكن حفظ التعديلات بسبب تعارض في أحد المعدات"));return}}const D=typeof n=="function"?n:()=>!1;for(const V of E)if(D(V,S,C,w.id??w.reservationId)){m(o("reservations.toast.updateCrewConflict","⚠️ لا يمكن حفظ التعديلات بسبب تعارض في جدول أحد أعضاء الطاقم"));return}w.start=S,w.end=C,w.notes=f,w.discount=g,w.discountType=p,w.applyTax=b,w.confirmed=y,w.paid=h==="paid",w.items=[...te],w.technicians=[...E],w.cost=Ue(w.items||[],g,p,b,w.technicians||[]),F({reservations:A}),m(o("reservations.toast.updated","✅ تم حفظ التعديلات على الحجز")),s==null||s(),Jt(),r==null||r(),a==null||a(),i==null||i(),(xe=P==null?void 0:P.hide)==null||xe.call(P)}function Hs(e={}){Ve={...e};const{updateEditReservationSummary:t,addEquipmentToEditingReservation:n,addEquipmentByDescription:s,renderEditItems:a}=Ve,i=document.getElementById("edit-res-discount");i&&!i.dataset.listenerAttached&&(i.addEventListener("input",()=>{i.value=q(i.value),t==null||t()}),i.dataset.listenerAttached="true");const r=document.getElementById("edit-res-discount-type");r&&!r.dataset.listenerAttached&&(r.addEventListener("change",()=>t==null?void 0:t()),r.dataset.listenerAttached="true");const l=document.getElementById("edit-res-tax");l&&!l.dataset.listenerAttached&&(l.addEventListener("change",()=>t==null?void 0:t()),l.dataset.listenerAttached="true");const c=document.getElementById("save-reservation-changes");c&&!c.dataset.listenerAttached&&(c.addEventListener("click",()=>Ps(Ve)),c.dataset.listenerAttached="true");const d=document.getElementById("edit-res-equipment-barcode");d&&!d.dataset.listenerAttached&&(d.addEventListener("keydown",v=>{v.key==="Enter"&&(v.preventDefault(),n==null||n(d))}),d.dataset.listenerAttached="true");const u=document.getElementById("edit-res-equipment-description");u&&!u.dataset.listenerAttached&&(u.addEventListener("keydown",v=>{v.key==="Enter"&&(v.preventDefault(),s==null||s(u,"edit"))}),u.dataset.listenerAttached="true");const f=document.getElementById("editReservationModal");f&&!f.dataset.cleanupAttached&&(f.addEventListener("hidden.bs.modal",()=>{Jt(),t==null||t(),a==null||a([])}),f.dataset.cleanupAttached="true")}function Vt(){var a,i,r,l,c,d,u,f;const e=(i=(a=document.getElementById("edit-res-start"))==null?void 0:a.value)==null?void 0:i.trim(),t=(l=(r=document.getElementById("edit-res-end"))==null?void 0:r.value)==null?void 0:l.trim(),n=((d=(c=document.getElementById("edit-res-start-time"))==null?void 0:c.value)==null?void 0:d.trim())||"00:00",s=((f=(u=document.getElementById("edit-res-end-time"))==null?void 0:u.value)==null?void 0:f.trim())||"00:00";return!e||!t?{start:null,end:null}:{start:Q(e,n),end:Q(t,s)}}function _e(e=[]){const t=document.getElementById("edit-res-items");if(!t)return;const n=o("reservations.create.equipment.none","لا توجد معدات"),s=o("reservations.create.summary.currency","ريال"),a=o("reservations.create.equipment.imageAlt","صورة");if(!e||e.length===0){t.innerHTML=`<tr><td colspan="6" class="text-center">${n}</td></tr>`;return}t.innerHTML=e.map((i,r)=>{const l=Te(i),c=`${q(String(i.price??0))} ${s}`,d=q(String(i.qty||1)),u=l?`<img src="${l}" alt="${a}" class="reservation-item-thumb">`:"-";return`
        <tr>
          <td>${i.barcode||"-"}</td>
          <td>${i.desc||"-"}</td>
          <td>${c}</td>
          <td>${d}</td>
          <td>${u}</td>
          <td><button type="button" class="btn btn-sm btn-danger" onclick="removeEditReservationItem(${r})">🗑️</button></td>
        </tr>
      `}).join("")}function ce(){const e=document.getElementById("edit-res-summary");if(!e)return;const t=document.getElementById("edit-res-discount"),n=document.getElementById("edit-res-discount-type"),s=document.getElementById("edit-res-tax"),a=document.getElementById("edit-res-paid");a&&!a.dataset.listenerAttached&&(a.addEventListener("change",ce),a.dataset.listenerAttached="true");const i=q((t==null?void 0:t.value)||"0");t&&(t.value=i);const r=parseFloat(i)||0,l=(n==null?void 0:n.value)||"percent",c=(s==null?void 0:s.checked)||!1,d=(a==null?void 0:a.value)||"unpaid",{items:u=[]}=ze();e.innerHTML=gs({items:u,discount:r,discountType:l,applyTax:c,paidStatus:d})}function Os(e){if(e==null)return;const{index:t,items:n}=ze();if(!Array.isArray(n))return;const s=n.filter((a,i)=>i!==e);Xe(t,s),_e(s),ce()}function js(e){const t=(e==null?void 0:e.value)??"",n=N(t);if(!n)return;const s=Yn(n);if(!s){m(o("reservations.toast.barcodeNotInCatalog","❌ الباركود غير موجود ضمن المعدات"));return}if(ve(n)){m(o("reservations.toast.equipmentMaintenance","⚠️ هذه المعدة قيد الصيانة ولا يمكن إضافتها حالياً"));return}const a=N(n),{index:i,items:r=[]}=ze();if(r.findIndex(p=>N(p.barcode)===a)>-1){m(o("reservations.toast.equipmentDuplicate","⚠️ هذه المعدة موجودة بالفعل في الحجز"));return}const{start:c,end:d}=Vt();if(!c||!d){m(o("reservations.toast.requireDatesBeforeAdd","⚠️ يرجى تحديد تاريخ ووقت البداية والنهاية قبل إضافة المعدات"));return}const{reservations:u=[]}=x(),f=i!=null&&u[i]||null,v=(f==null?void 0:f.id)??(f==null?void 0:f.reservationId)??null;if(fe(a,c,d,v)){m(o("reservations.toast.equipmentTimeConflictSimple","⚠️ هذه المعدة محجوزة في نفس الفترة الزمنية"));return}const g=[...r,{id:s.id,barcode:a,desc:s.desc,qty:1,price:s.price,image:s.image||s.imageUrl||s.img||null}];Xe(i,g),e&&(e.value=""),_e(g),ce()}function ot(e){if(!e)return;const t=e.value.trim();if(!t)return;const n=Xt(t),s=N((n==null?void 0:n.barcode)||t);if(!n||!s){m(o("reservations.toast.equipmentNameNotFound","❌ لم يتم العثور على معدة بالاسم المدخل"));return}if(ve(s)){m(o("reservations.toast.equipmentMaintenanceStrict","⚠️ لا يمكن إضافة معدة قيد الصيانة إلى الحجز"));return}const{start:a,end:i}=Vt();if(!a||!i){m(o("reservations.toast.requireOverallDates","⚠️ يرجى تحديد تواريخ الحجز قبل إضافة المعدات"));return}const{index:r,items:l=[]}=ze();if(l.some(g=>N(g.barcode)===s)){m(o("reservations.toast.equipmentDuplicate","⚠️ هذه المعدة موجودة بالفعل في الحجز"));return}const{reservations:d=[]}=x(),u=r!=null&&d[r]||null,f=(u==null?void 0:u.id)??(u==null?void 0:u.reservationId)??null;if(fe(s,a,i,f)){m(o("reservations.toast.equipmentTimeConflictSimple","⚠️ هذه المعدة محجوزة في نفس الفترة الزمنية"));return}const v=[...l,{id:n.id,barcode:s,desc:n.desc,qty:1,price:n.price,image:n.image||n.imageUrl||n.img||null}];Xe(r,v),_e(v),ce(),e.value=""}function Us(){const e=document.getElementById("edit-res-equipment-description");e&&!e.dataset.listenerAttached&&(e.addEventListener("keydown",t=>{t.key==="Enter"&&(t.preventDefault(),ot(e))}),e.dataset.listenerAttached="true")}function zs(e,t="create"){if(!(!e||!e.value.trim())){if(t==="create"){_t(e);return}ot(e)}}function Xs(){ge(),Us()}function _s(e,t){var s;const n=document.getElementById(e);if(n){if(n._flatpickr){if(t){const a=((s=n._flatpickr.config)==null?void 0:s.dateFormat)||"Y-m-d";n._flatpickr.setDate(t,!1,a)}else n._flatpickr.clear();return}n.value=t||""}}function Ws(){const{technicians:e}=x();jt(e||[]),rt()}function We(){rt(),ct(),typeof window.refreshCustomerReservationsViews=="function"&&window.refreshCustomerReservationsViews(),typeof window.refreshTechnicianReservationsViews=="function"&&window.refreshTechnicianReservationsViews()}function Ys(e){var t;return e?(t=window==null?void 0:window.bootstrap)!=null&&t.Modal?window.bootstrap.Modal.getOrCreateInstance(e):typeof bootstrap<"u"&&(bootstrap!=null&&bootstrap.Modal)?bootstrap.Modal.getOrCreateInstance(e):null:null}function He(){return{populateEquipmentDescriptionLists:ge,setFlatpickrValue:_s,splitDateTime:Wn,renderEditItems:_e,updateEditReservationSummary:ce,addEquipmentByDescription:zs,addEquipmentToEditingReservation:js,addEquipmentToEditingByDescription:ot,combineDateTime:Q,hasEquipmentConflict:fe,hasTechnicianConflict:Ge,renderReservations:ct,handleReservationsMutation:We,ensureModal:Ys}}function ct(e="reservations-list",t=null){Ns({containerId:e,filters:t,onShowDetails:Qt,onConfirmReservation:Gt})}function Qt(e){return $s(e,{getEditContext:He,onEdit:(t,{reservation:n})=>{Zt(t,n)},onDelete:Kt})}function Kt(e){return window.confirm(o("reservations.toast.deleteConfirm","⚠️ هل أنت متأكد من حذف هذا الحجز؟"))?Ms(e,{onAfterChange:We}):!1}function Gt(e){return Rs(e,{onAfterChange:We})}function Zt(e,t=null){if(document.getElementById("reservation-form")){bt(e,He());return}if(document.getElementById("editReservationModal")){bt(e,He());return}if(t!=null&&t.id||t!=null&&t.reservationId){const n=t.id??t.reservationId;localStorage.setItem("pendingReservationEditId",String(n))}else localStorage.setItem("pendingReservationEditId",String(e));window.location.href="dashboard.html#reservations"}function Js(){typeof window>"u"||(window.showReservationDetails=Qt,window.deleteReservation=Kt,window.confirmReservation=Gt,window.editReservation=Zt,window.removeEditReservationItem=Os)}function Vs(){document.querySelectorAll('input[type="time"]').forEach(t=>{t.setAttribute("step","3600"),t.dataset.listenerAttached!=="true"&&(t.addEventListener("change",()=>{if(!t.value)return;const[n]=t.value.split(":");t.value=`${n.padStart(2,"0")}:00`}),t.dataset.listenerAttached="true")})}function Qs(){return typeof window<"u"&&typeof window.flatpickr=="function"?window.flatpickr.bind(window):typeof globalThis<"u"&&typeof globalThis.flatpickr=="function"?globalThis.flatpickr.bind(globalThis):(console.warn("⚠️ Flatpickr غير متاح - سيتم تخطي تهيئة عناصر التاريخ"),null)}function Ks(){const e=Qs();if(!e)return;const t=[["#res-start",{dateFormat:"Y-m-d"}],["#res-end",{dateFormat:"Y-m-d"}],["#filter-start-date",{dateFormat:"Y-m-d"}],["#filter-end-date",{dateFormat:"Y-m-d"}],["#edit-res-start",{dateFormat:"Y-m-d"}],["#edit-res-end",{dateFormat:"Y-m-d"}]],n=[["#res-start-time",{enableTime:!0,noCalendar:!0,dateFormat:"H:i",altInput:!0,altFormat:"h:i K",time_24hr:!1,defaultHour:9,defaultMinute:0}],["#res-end-time",{enableTime:!0,noCalendar:!0,dateFormat:"H:i",altInput:!0,altFormat:"h:i K",time_24hr:!1,defaultHour:10,defaultMinute:0}],["#edit-res-start-time",{enableTime:!0,noCalendar:!0,dateFormat:"H:i",altInput:!0,altFormat:"h:i K",time_24hr:!1,defaultHour:9,defaultMinute:0}],["#edit-res-end-time",{enableTime:!0,noCalendar:!0,dateFormat:"H:i",altInput:!0,altFormat:"h:i K",time_24hr:!1,defaultHour:10,defaultMinute:0}]];[...t,...n].forEach(([s,a])=>{document.querySelector(s)&&e(s,a)})}function Gs(){Vs(),As(()=>ct()),Hs(He()),ds({onDraftChange:O,onEditChange:ce}),Ws(),Xs()}function Zs(){const e=document.body;e&&e.dataset.reservationsTechListener!=="true"&&(document.addEventListener("technicians:updated",()=>{const{technicians:t=[]}=x();jt(t),rt(),ce()}),e.dataset.reservationsTechListener="true")}function yt(){Js(),Bs({onAfterSubmit:We}),Gs(),Ks(),Zs()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",yt,{once:!0}):yt();export{F as a,Ke as b,sa as c,ct as d,Gs as e,Ws as f,Wt as g,Qt as h,Ie as i,aa as j,x as l,U as r,he as s,na as u};
