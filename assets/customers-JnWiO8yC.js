import{l as S,s as w}from"./storage-DOnDLvtb.js";import{t as u,n as b,s as p}from"./auth-CNAfl19F.js";let d=null;function B(){document.dispatchEvent(new CustomEvent("customers:changed"))}function f(){return S().customers||[]}function g(t){w({customers:t})}function m(){return{form:document.getElementById("customer-form"),idInput:document.getElementById("customer-id"),nameInput:document.getElementById("customer-name"),phoneInput:document.getElementById("customer-phone"),emailInput:document.getElementById("customer-email"),addressInput:document.getElementById("customer-address"),companyInput:document.getElementById("customer-company"),notesInput:document.getElementById("customer-notes"),submitBtn:document.getElementById("submit-btn"),cancelBtn:document.getElementById("customer-cancel-btn")}}function v(t="add"){const{submitBtn:e}=m();if(!e)return;const n=t==="update"?"customers.form.actions.update":"customers.form.actions.submit",s=t==="update"?"💾 حفظ التعديل":"➕ إضافة عميل";e.textContent=u(n,s)}function I(t){const{cancelBtn:e}=m();e&&(t?e.classList.remove("d-none"):e.classList.add("d-none"),e.textContent=u("customers.form.actions.cancel","إلغاء التعديل"))}function h(){const t=!!d;v(t?"update":"add"),I(t)}function y(){const{form:t,idInput:e,phoneInput:n}=m();t==null||t.reset(),e&&(e.value=""),n&&(n.value=n.value.trim()),d=null,v("add"),I(!1)}function $(t){const{idInput:e,nameInput:n,phoneInput:s,emailInput:a,addressInput:i,companyInput:o,notesInput:r}=m();!t||!n||!s||(e&&(e.value=t.id),n.value=t.customerName||"",s.value=b(t.phone||""),a&&(a.value=t.email||""),i&&(i.value=t.address||""),o&&(o.value=t.companyName||""),r&&(r.value=t.notes||""),d=t.id,v("update"),I(!0))}function N(){const{idInput:t,nameInput:e,phoneInput:n,emailInput:s,addressInput:a,companyInput:i,notesInput:o}=m();if(!e||!n)return null;const r=e.value.trim(),c=b(n.value.trim());return n.value=c,!r||!c?(p(u("customers.toast.missingFields","يرجى تعبئة الاسم ورقم الهاتف"),"error"),null):{id:(t==null?void 0:t.value)||d||Date.now().toString(),customerName:r,phone:c,email:(s==null?void 0:s.value.trim())||"",address:(a==null?void 0:a.value.trim())||"",companyName:(i==null?void 0:i.value.trim())||"",notes:(o==null?void 0:o.value.trim())||""}}function x(t){t.preventDefault();const e=N();if(!e)return;const n=f(),s=n.findIndex(a=>String(a.id)===String(e.id));s>=0?(n[s]={...n[s],...e},g(n),p(u("customers.toast.updateSuccess","تم تحديث بيانات العميل بنجاح"))):(n.push(e),g(n),p(u("customers.toast.createSuccess","تمت إضافة العميل بنجاح"))),l(),y(),B()}function M(t){const e=t.target;if(e instanceof HTMLElement){if(e.classList.contains("customer-delete-btn")){const n=e.dataset.id;if(!confirm(u("customers.toast.deleteConfirm","⚠️ هل أنت متأكد من حذف هذا العميل؟")))return;const s=f().filter(a=>String(a.id)!==String(n));g(s),l(),d===n&&y(),p(u("customers.toast.deleteSuccess","تم حذف العميل")),B();return}if(e.classList.contains("customer-edit-btn")){const n=e.dataset.id,s=f().find(a=>String(a.id)===String(n));if(!s)return;$(s)}}}function D(t){const e=t.target.value.trim().toLowerCase(),s=f().filter(i=>{var E,C,L;const o=((E=i.customerName)==null?void 0:E.toLowerCase())||"",r=((C=i.phone)==null?void 0:C.toLowerCase())||"",c=((L=i.companyName)==null?void 0:L.toLowerCase())||"";return o.includes(e)||r.includes(e)||c.includes(e)}),a=e?u("customers.table.noResults","لا توجد نتائج مطابقة"):void 0;l(s,{emptyMessage:a})}function T(){const{form:t,cancelBtn:e}=m();t&&t.addEventListener("submit",x),e&&e.addEventListener("click",()=>{y()});const n=document.getElementById("customers-table");n&&n.addEventListener("click",M);const s=document.getElementById("search-customer-input");s&&s.addEventListener("input",D)}document.addEventListener("DOMContentLoaded",()=>{T(),l(),h()});document.addEventListener("language:changed",()=>{h(),l()});document.addEventListener("customers:refreshRequested",()=>{l(),h()});function l(t,e={}){const n=Array.isArray(t)?t:f(),s=document.getElementById("customers-table");if(!s)return;if(s.innerHTML="",n.length===0){const o=e.emptyMessage||u("customers.table.empty","لا يوجد عملاء");s.innerHTML=`<tr><td colspan='6'>${o}</td></tr>`;return}const a=u("customers.actions.edit","✏️ تعديل"),i=u("customers.actions.delete","🗑️ حذف");n.forEach(o=>{const r=d&&String(d)===String(o.id),c=document.createElement("tr");r&&c.classList.add("table-info"),c.innerHTML=`
      <td><a href="customer.html?id=${o.id}" class="text-decoration-none">${o.customerName}</a></td>
      <td>${b(o.phone)}</td>
      <td>${o.companyName||""}</td>
      <td class="table-notes-cell">${o.notes||"—"}</td>
      <td class="table-actions-cell">
        <div class="table-action-buttons">
          <button class="btn btn-sm btn-warning customer-edit-btn" data-id="${o.id}">${a}</button>
          <button class="btn btn-sm btn-danger customer-delete-btn" data-id="${o.id}">${i}</button>
        </div>
      </td>
    `,s.appendChild(c)})}export{l as r};
